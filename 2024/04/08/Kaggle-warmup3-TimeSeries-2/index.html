<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="继续上次的TimeSeries问题,这次看的notebook是另一个人写的hybridmodel preprocessing 首先前面数据处理和表合并部分大同小异. 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263">
<meta property="og:type" content="article">
<meta property="og:title" content="Kaggle_warmup3-TimeSeries(2)">
<meta property="og:url" content="http://example.com/2024/04/08/Kaggle-warmup3-TimeSeries-2/index.html">
<meta property="og:site_name" content="blacsheep&#39;s blog">
<meta property="og:description" content="继续上次的TimeSeries问题,这次看的notebook是另一个人写的hybridmodel preprocessing 首先前面数据处理和表合并部分大同小异. 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2024/04/08/Kaggle-warmup3-TimeSeries-2/full_data.png">
<meta property="og:image" content="http://example.com/2024/04/08/Kaggle-warmup3-TimeSeries-2/calendarFourier.png">
<meta property="og:image" content="http://example.com/2024/04/08/Kaggle-warmup3-TimeSeries-2/weekFourier.png">
<meta property="article:published_time" content="2024-04-08T09:29:24.000Z">
<meta property="article:modified_time" content="2024-04-09T12:14:55.358Z">
<meta property="article:author" content="blacsheep">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2024/04/08/Kaggle-warmup3-TimeSeries-2/full_data.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Kaggle_warmup3-TimeSeries(2)</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2024/04/09/Kaggle-warmup3-TimeSeries-3/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2024/04/08/%E5%AF%B9%E6%8A%97%E6%A0%B7%E6%9C%AC%E6%94%BB%E5%87%BB%E7%AE%80%E5%8D%95%E5%AD%A6%E4%B9%A0/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2024/04/08/Kaggle-warmup3-TimeSeries-2/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2024/04/08/Kaggle-warmup3-TimeSeries-2/&text=Kaggle_warmup3-TimeSeries(2)"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2024/04/08/Kaggle-warmup3-TimeSeries-2/&title=Kaggle_warmup3-TimeSeries(2)"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2024/04/08/Kaggle-warmup3-TimeSeries-2/&is_video=false&description=Kaggle_warmup3-TimeSeries(2)"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Kaggle_warmup3-TimeSeries(2)&body=Check out this article: http://example.com/2024/04/08/Kaggle-warmup3-TimeSeries-2/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2024/04/08/Kaggle-warmup3-TimeSeries-2/&title=Kaggle_warmup3-TimeSeries(2)"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2024/04/08/Kaggle-warmup3-TimeSeries-2/&title=Kaggle_warmup3-TimeSeries(2)"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2024/04/08/Kaggle-warmup3-TimeSeries-2/&title=Kaggle_warmup3-TimeSeries(2)"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2024/04/08/Kaggle-warmup3-TimeSeries-2/&title=Kaggle_warmup3-TimeSeries(2)"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2024/04/08/Kaggle-warmup3-TimeSeries-2/&name=Kaggle_warmup3-TimeSeries(2)&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2024/04/08/Kaggle-warmup3-TimeSeries-2/&t=Kaggle_warmup3-TimeSeries(2)"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#preprocessing"><span class="toc-number">1.</span> <span class="toc-text">preprocessing</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#statsmodels%E7%9B%B8%E5%85%B3"><span class="toc-number">2.</span> <span class="toc-text">statsmodels相关</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#prepare-training-data-for-hybrid-model"><span class="toc-number">3.</span> <span class="toc-text">prepare training data
for hybrid model</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hybrid-model"><span class="toc-number">4.</span> <span class="toc-text">hybrid model</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        Kaggle_warmup3-TimeSeries(2)
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">blacsheep</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2024-04-08T09:29:24.000Z" class="dt-published" itemprop="datePublished">2024-04-08</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/Kaggle-warmup/">Kaggle-warmup</a>
    </div>


      

    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <p>继续上次的TimeSeries问题,这次看的notebook是另一个人写的<a
target="_blank" rel="noopener" href="https://www.kaggle.com/code/closen/experimenting-with-a-hybrid-model">hybridmodel</a></p>
<h2 id="preprocessing">preprocessing</h2>
<p>首先前面数据处理和表合并部分大同小异. <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LinearRegression</span><br><span class="line"><span class="keyword">from</span> sklearn.multioutput <span class="keyword">import</span> RegressorChain</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> LabelEncoder</span><br><span class="line"><span class="keyword">from</span> xgboost <span class="keyword">import</span> XGBRegressor</span><br><span class="line"><span class="keyword">from</span> sklearn.multioutput <span class="keyword">import</span> RegressorChain</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> mean_squared_log_error</span><br><span class="line"><span class="keyword">from</span> statsmodels.tsa.deterministic <span class="keyword">import</span> DeterministicProcess, CalendarFourier</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> OneHotEncoder</span><br><span class="line"><span class="comment"># Input data files are available in the read-only &quot;../input/&quot; directory</span></span><br><span class="line"><span class="comment"># For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">for</span> dirname, _, filenames <span class="keyword">in</span> os.walk(<span class="string">&#x27;/kaggle/input&#x27;</span>):</span><br><span class="line">    <span class="keyword">for</span> filename <span class="keyword">in</span> filenames:</span><br><span class="line">        <span class="built_in">print</span>(os.path.join(dirname, filename))</span><br><span class="line"></span><br><span class="line">comp_dir = Path(<span class="string">&#x27;../input/store-sales-time-series-forecasting&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Importing oil prices dataset</span></span><br><span class="line">oil_prices = pd.read_csv(<span class="string">&quot;/kaggle/input/store-sales-time-series-forecasting/oil.csv&quot;</span>,</span><br><span class="line">                         parse_dates=[<span class="string">&#x27;date&#x27;</span>],</span><br><span class="line">                         infer_datetime_format=<span class="literal">True</span>)</span><br><span class="line">oil_prices[<span class="string">&#x27;date&#x27;</span>] = oil_prices.date.dt.to_period(<span class="string">&quot;D&quot;</span>)</span><br><span class="line">oil_prices.set_index(<span class="string">&#x27;date&#x27;</span>, inplace=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Importing holidays dataset</span></span><br><span class="line">holidays = pd.read_csv(<span class="string">&#x27;/kaggle/input/store-sales-time-series-forecasting/holidays_events.csv&#x27;</span>,</span><br><span class="line">                       parse_dates=[<span class="string">&#x27;date&#x27;</span>],</span><br><span class="line">                       infer_datetime_format=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">holidays[<span class="string">&#x27;date&#x27;</span>] = holidays.date.dt.to_period(<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line"></span><br><span class="line">store_sales = pd.read_csv(</span><br><span class="line">    comp_dir / <span class="string">&#x27;train.csv&#x27;</span>,</span><br><span class="line">    usecols=[<span class="string">&#x27;store_nbr&#x27;</span>, <span class="string">&#x27;family&#x27;</span>, <span class="string">&#x27;date&#x27;</span>, <span class="string">&#x27;sales&#x27;</span>, <span class="string">&#x27;onpromotion&#x27;</span>],</span><br><span class="line">    dtype=&#123;</span><br><span class="line">        <span class="string">&#x27;store_nbr&#x27;</span>: <span class="string">&#x27;category&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;family&#x27;</span>: <span class="string">&#x27;category&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;sales&#x27;</span>: <span class="string">&#x27;float32&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;onpromotion&#x27;</span>: <span class="string">&#x27;uint32&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    parse_dates=[<span class="string">&#x27;date&#x27;</span>],</span><br><span class="line">)</span><br><span class="line">store_sales[<span class="string">&#x27;date&#x27;</span>] = store_sales.date.dt.to_period(<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line">store_sales = store_sales.set_index([<span class="string">&#x27;store_nbr&#x27;</span>, <span class="string">&#x27;family&#x27;</span>, <span class="string">&#x27;date&#x27;</span>]).sort_index()</span><br><span class="line"></span><br><span class="line">family_sales = (</span><br><span class="line">    store_sales</span><br><span class="line">    .groupby([<span class="string">&#x27;family&#x27;</span>, <span class="string">&#x27;date&#x27;</span>],observed=<span class="literal">False</span>)</span><br><span class="line">    .mean()</span><br><span class="line">    .unstack(<span class="string">&#x27;family&#x27;</span>)</span><br><span class="line">    .loc[<span class="string">&#x27;2017&#x27;</span>]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">test = pd.read_csv(</span><br><span class="line">    comp_dir / <span class="string">&#x27;test.csv&#x27;</span>,</span><br><span class="line">    dtype=&#123;</span><br><span class="line">        <span class="string">&#x27;store_nbr&#x27;</span>: <span class="string">&#x27;category&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;family&#x27;</span>: <span class="string">&#x27;category&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;onpromotion&#x27;</span>: <span class="string">&#x27;uint32&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    parse_dates=[<span class="string">&#x27;date&#x27;</span>],</span><br><span class="line">)</span><br><span class="line">test[<span class="string">&#x27;date&#x27;</span>] = test.date.dt.to_period(<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line">test = test.set_index([<span class="string">&#x27;store_nbr&#x27;</span>, <span class="string">&#x27;family&#x27;</span>, <span class="string">&#x27;date&#x27;</span>]).sort_index()</span><br></pre></td></tr></table></figure>
这里主要是对时间类型进行转换,同时set一下index</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Splitting the holidays in three dataset on the basis of locale</span></span><br><span class="line">holidays_N = holidays[holidays.locale == <span class="string">&#x27;National&#x27;</span>]</span><br><span class="line"><span class="comment"># Dropping the locale column as we don&#x27;t need it anymore</span></span><br><span class="line">holidays_N.drop(<span class="string">&#x27;locale&#x27;</span>, axis=<span class="number">1</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">holidays_N.drop_duplicates(subset=<span class="string">&#x27;date&#x27;</span>, keep=<span class="string">&#x27;first&#x27;</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">holidays_N.set_index(<span class="string">&#x27;date&#x27;</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">OH = OneHotEncoder(sparse=<span class="literal">False</span>)</span><br><span class="line">holidays_N_OH = pd.DataFrame(</span><br><span class="line">    OH.fit_transform(holidays_N[[<span class="string">&#x27;description&#x27;</span>]]), </span><br><span class="line">    index=holidays_N.index, </span><br><span class="line">    columns=OH.get_feature_names_out([<span class="string">&#x27;description&#x27;</span>])</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">full_train_data = store_sales.merge(holidays_N_OH, how=<span class="string">&#x27;left&#x27;</span>, left_index=<span class="literal">True</span>, right_index=<span class="literal">True</span>)</span><br><span class="line">full_train_data.fillna(<span class="number">0</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">full_train_data = full_train_data.merge(oil_prices, how=<span class="string">&#x27;left&#x27;</span>, left_index=<span class="literal">True</span>, right_index=<span class="literal">True</span>)</span><br><span class="line">full_train_data[<span class="string">&#x27;dcoilwtico&#x27;</span>].fillna(method=<span class="string">&#x27;ffill&#x27;</span>, inplace=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># Create new columns</span></span><br><span class="line">date = full_train_data.index.get_level_values(<span class="string">&#x27;date&#x27;</span>)</span><br><span class="line">full_train_data[<span class="string">&#x27;week_day&#x27;</span>] = date.weekday</span><br><span class="line">full_train_data[<span class="string">&#x27;month_day&#x27;</span>] = date.day</span><br><span class="line">full_train_data[<span class="string">&#x27;year_day&#x27;</span>] = date.day_of_year</span><br><span class="line"></span><br><span class="line">full_train_data = full_train_data.fillna(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>这里时间还是按照week,month,year做了列分割,不过需要注意的是这里作者对holiday进行了one_hot_encoding,所以后面查看数据会有70多列.
<img src="full_data.png" alt="full_data" /></p>
<h2 id="statsmodels相关">statsmodels相关</h2>
<p>再后面作者写了一个hybrid模型,有点残差网络的意思,不过这个先放一放,先看看<code>statsmodels.tsa.deterministic</code>的相关内容,首先是<code>statsmodels.tsa.deterministic.CalendarFourier</code>,这个函数可以按日历生成相关傅立叶级数.
<img src="calendarFourier.png" alt="fourier" /></p>
<p>举个例子 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fourier = CalendarFourier(freq=<span class="string">&quot;W&quot;</span>, order=<span class="number">2</span>)</span><br><span class="line">dp_train = DeterministicProcess(</span><br><span class="line">    index=y_train.index,</span><br><span class="line">    constant=<span class="literal">True</span>,</span><br><span class="line">    order=<span class="number">1</span>,</span><br><span class="line">    seasonal=<span class="literal">True</span>,</span><br><span class="line">    additional_terms=[fourier],</span><br><span class="line">    drop=<span class="literal">True</span>,</span><br><span class="line">)</span><br><span class="line">fourier.in_sample(y_train.index)[:<span class="number">20</span>]</span><br></pre></td></tr></table></figure>
这里的freq我设置成了week,order设为2,那么每周一回到周期开始就会令sin为0,cos为1.</p>
<p>过一天到达周二就会令<code>$ \tau = 1$</code>, 即sin值变为
<code>$sin(order* \pi * \frac&#123;1&#125;&#123;7&#125;)$</code> ,
所以也有了下面这些计算</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> math</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>math.sin(<span class="number">0</span>)</span><br><span class="line"><span class="number">0.0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>math.sin(math.pi*<span class="number">2</span>/<span class="number">7</span>)</span><br><span class="line"><span class="number">0.7818314824680298</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>math.sin(<span class="number">2</span>*math.pi*<span class="number">2</span>/<span class="number">7</span>)</span><br><span class="line"><span class="number">0.9749279121818236</span></span><br></pre></td></tr></table></figure>
<p><img src="weekFourier.png" /></p>
<p>然后是<code>DeterministicProcess</code>的处理 <img
src="deterministic.png" /></p>
<p>这里指定了season,然后season是依据index来判断的 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://www.statsmodels.org/devel/_modules/statsmodels/tsa/deterministic.html#DeterministicProcess</span></span><br><span class="line"><span class="keyword">if</span> (seasonal <span class="keyword">or</span> fourier) <span class="keyword">and</span> period <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">if</span> period <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="variable language_">self</span>._period = period = freq_to_period(<span class="variable language_">self</span>._index_freq)</span><br></pre></td></tr></table></figure></p>
<p>其中我们的index_freq为day,跳转到freq_to_period <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://www.statsmodels.org/dev/_modules/statsmodels/tsa/tsatools.html</span></span><br><span class="line"><span class="keyword">if</span> freq <span class="keyword">in</span> (<span class="string">&quot;A&quot;</span>, <span class="string">&quot;Y&quot;</span>) <span class="keyword">or</span> freq.startswith(yearly_freqs):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">elif</span> freq == <span class="string">&quot;Q&quot;</span> <span class="keyword">or</span> freq.startswith((<span class="string">&quot;Q-&quot;</span>, <span class="string">&quot;QS&quot;</span>, <span class="string">&quot;QE&quot;</span>)):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">4</span></span><br><span class="line">    <span class="keyword">elif</span> freq == <span class="string">&quot;M&quot;</span> <span class="keyword">or</span> freq.startswith((<span class="string">&quot;M-&quot;</span>, <span class="string">&quot;MS&quot;</span>, <span class="string">&quot;ME&quot;</span>)):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">12</span></span><br><span class="line">    <span class="keyword">elif</span> freq == <span class="string">&quot;W&quot;</span> <span class="keyword">or</span> freq.startswith(<span class="string">&quot;W-&quot;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">52</span></span><br><span class="line">    <span class="keyword">elif</span> freq == <span class="string">&quot;D&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">7</span></span><br><span class="line">    <span class="keyword">elif</span> freq == <span class="string">&quot;B&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">5</span></span><br><span class="line">    <span class="keyword">elif</span> freq == <span class="string">&quot;H&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">24</span></span><br></pre></td></tr></table></figure></p>
<p>即可发现是相当于period为7的seasonal.
不过这里fourier并没有作为额外项加入,个人也不太理解出于什么考虑.
然后获取数据加丢入模型的代码如下,数据处理过程分析好了喂数据反而简单了.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Linear Regression</span></span><br><span class="line"></span><br><span class="line">y_train = full_train_data.unstack([<span class="string">&#x27;store_nbr&#x27;</span>, <span class="string">&#x27;family&#x27;</span>]).loc[<span class="string">&#x27;2016&#x27;</span>:]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create Training Data</span></span><br><span class="line">fourier = CalendarFourier(freq=<span class="string">&quot;D&quot;</span>, order=<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">dp_train = DeterministicProcess(</span><br><span class="line">    index=y_train.index,</span><br><span class="line">    constant=<span class="literal">True</span>,</span><br><span class="line">    order=<span class="number">1</span>,</span><br><span class="line">    seasonal=<span class="literal">True</span>,</span><br><span class="line">    additional_terms=[fourier],</span><br><span class="line">    drop=<span class="literal">True</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">X_train = dp_train.in_sample()</span><br><span class="line">X_train[<span class="string">&#x27;NewYear&#x27;</span>] = (X_train.index.dayofyear == <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">model_LR = LinearRegression()</span><br><span class="line">model_LR.fit(X_train,y_train)</span><br><span class="line">y_pred_LR = pd.DataFrame(model_LR.predict(X_train), index=y_train.index, columns=y_train.columns)</span><br></pre></td></tr></table></figure>
<h2 id="prepare-training-data-for-hybrid-model">prepare training data
for hybrid model</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># For the first model :</span></span><br><span class="line"></span><br><span class="line">y = full_train_data.unstack([<span class="string">&#x27;store_nbr&#x27;</span>, <span class="string">&#x27;family&#x27;</span>]).loc[<span class="string">&#x27;2017&#x27;</span>]</span><br><span class="line"></span><br><span class="line">fourier = CalendarFourier(freq=<span class="string">&#x27;D&#x27;</span>, order=<span class="number">4</span>)</span><br><span class="line">dp = DeterministicProcess(</span><br><span class="line">    index=y.index,</span><br><span class="line">    constant=<span class="literal">True</span>,</span><br><span class="line">    order=<span class="number">1</span>,</span><br><span class="line">    seasonal=<span class="literal">True</span>,</span><br><span class="line">    additional_terms=[fourier],</span><br><span class="line">    drop=<span class="literal">True</span>,</span><br><span class="line">)</span><br><span class="line">X_1 = dp.in_sample()</span><br><span class="line">X_1[<span class="string">&#x27;NewYear&#x27;</span>] = (X_1.index.dayofyear == <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># For the second model :</span></span><br><span class="line"></span><br><span class="line">X_2 = y.stack(future_stack=<span class="literal">True</span>)</span><br><span class="line">X_2 = X_2.stack(future_stack=<span class="literal">True</span>)</span><br><span class="line">X_2 = X_2.reset_index()</span><br><span class="line">X_2.set_index(<span class="string">&#x27;date&#x27;</span>, inplace = <span class="literal">True</span>)</span><br><span class="line">X_2[<span class="string">&#x27;day&#x27;</span>] = X_2.index.dayofweek</span><br><span class="line"><span class="keyword">for</span> colname <span class="keyword">in</span> X_2.select_dtypes([<span class="string">&quot;object&quot;</span>, <span class="string">&quot;category&quot;</span>]):</span><br><span class="line">    X_2[colname], _ = X_2[colname].factorize()</span><br><span class="line">X_2 = X_2.drop(<span class="string">&#x27;sales&#x27;</span>, axis =<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h2 id="hybrid-model">hybrid model</h2>
<p>到这里我们再回过头看最终预测的模型的结构, 这里看到模型1做对y的预测,
模型2在得到y和y_pred之后,对其差值进行预测,即我之前说的有点像残差网络.
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">make_lags</span>(<span class="params">ts, lags, lead_time=<span class="number">1</span></span>):</span><br><span class="line">    <span class="keyword">return</span> pd.concat(</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">f&#x27;y_lag_<span class="subst">&#123;i&#125;</span>&#x27;</span>: ts.shift(i)</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(lead_time, lags + lead_time)</span><br><span class="line">        &#125;,</span><br><span class="line">        axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_multistep_target</span>(<span class="params">ts, steps</span>):</span><br><span class="line">    <span class="keyword">return</span> pd.concat(</span><br><span class="line">        &#123;<span class="string">f&#x27;y_step_<span class="subst">&#123;i + <span class="number">1</span>&#125;</span>&#x27;</span>: ts.shift(-i)</span><br><span class="line">         <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(steps)&#125;,</span><br><span class="line">        axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Compute RMSLE</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rmsle</span>(<span class="params">y_true, y_pred</span>):</span><br><span class="line">    <span class="keyword">return</span> np.sqrt(mean_squared_log_error(y_true, y_pred))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BoostedHybrid</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, model_1, model_2</span>):</span><br><span class="line">        <span class="variable language_">self</span>.model_1 = model_1</span><br><span class="line">        <span class="variable language_">self</span>.model_2 = model_2</span><br><span class="line">        <span class="variable language_">self</span>.y_columns = <span class="literal">None</span>  <span class="comment"># store column names from fit method</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">fit</span>(<span class="params">self, y,X_1, X_2</span>):</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.model_1.fit(X_1, y)</span><br><span class="line">        y_fit = pd.DataFrame(</span><br><span class="line">            <span class="comment"># YOUR CODE HERE: make predictions with self.model_1</span></span><br><span class="line">            <span class="variable language_">self</span>.model_1.predict(X_1),</span><br><span class="line">            index=X_1.index, columns=y.columns,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        y_fit = y_fit.stack(future_stack=<span class="literal">True</span>)</span><br><span class="line">        y_fit =y_fit.stack(future_stack=<span class="literal">True</span>)</span><br><span class="line">        y_fit =y_fit.reset_index()</span><br><span class="line">        y_fit[<span class="string">&#x27;sales&#x27;</span>] = y_fit[<span class="string">&#x27;sales&#x27;</span>].astype(<span class="string">&#x27;int64&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        y_bis = y.stack(future_stack=<span class="literal">True</span>)</span><br><span class="line">        y_bis =y_bis.stack(future_stack=<span class="literal">True</span>)</span><br><span class="line">        y_bis = y_bis.reset_index()</span><br><span class="line"></span><br><span class="line">        y_resid = y_bis[<span class="string">&#x27;sales&#x27;</span>] - y_fit[<span class="string">&#x27;sales&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.model_2.fit(X_2, y_resid)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Save column names for predict method</span></span><br><span class="line">        <span class="variable language_">self</span>.y_columns = y.columns</span><br><span class="line">        <span class="comment"># Save data for question checking</span></span><br><span class="line">        <span class="variable language_">self</span>.y_fit = y_fit</span><br><span class="line">        <span class="variable language_">self</span>.y_resid = y_resid</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">predict</span>(<span class="params">self, X_test_1</span>):</span><br><span class="line"></span><br><span class="line">        y_submit = pd.DataFrame(<span class="variable language_">self</span>.model_1.predict(X_test_1), index=X_test_1.index, columns=y.columns)</span><br><span class="line">        y_submit = y_submit.stack()</span><br><span class="line">        y_submit = y_submit.stack()</span><br><span class="line">        X_test_2 = y_submit</span><br><span class="line">        X_test_2 = X_test_2.reset_index([<span class="string">&#x27;family&#x27;</span>,<span class="string">&#x27;store_nbr&#x27;</span>])</span><br><span class="line">        X_test_2[<span class="string">&#x27;day&#x27;</span>] = X_test_2.index.dayofweek</span><br><span class="line">        X_test_2 = X_test_2.drop(<span class="string">&#x27;sales&#x27;</span>,axis =<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> colname <span class="keyword">in</span> X_test_2.select_dtypes([<span class="string">&quot;object&quot;</span>, <span class="string">&quot;category&quot;</span>]):</span><br><span class="line">            X_test_2[colname], _ = X_test_2[colname].factorize()</span><br><span class="line">        y_test = <span class="variable language_">self</span>.model_2.predict(X_test_2) + y_submit[<span class="string">&#x27;sales&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        y_test = y_test.reset_index()</span><br><span class="line">        y_test = y_test.set_index([<span class="string">&#x27;store_nbr&#x27;</span>, <span class="string">&#x27;family&#x27;</span>, <span class="string">&#x27;date&#x27;</span>]).sort_index()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> y_test  <span class="comment"># long to wide</span></span><br></pre></td></tr></table></figure></p>
<p>定义结束了后续填充模型即可 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Fit the model</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Model 1 (trend)</span></span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> ElasticNet, Lasso, Ridge</span><br><span class="line"></span><br><span class="line"><span class="comment"># Model 2 (residuals)</span></span><br><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> ExtraTreesRegressor, RandomForestRegressor, GradientBoostingRegressor</span><br><span class="line"><span class="keyword">from</span> sklearn.neighbors <span class="keyword">import</span> KNeighborsRegressor</span><br><span class="line"><span class="keyword">from</span> sklearn.neural_network <span class="keyword">import</span> MLPRegressor</span><br><span class="line"></span><br><span class="line">model_hybrid = BoostedHybrid(</span><br><span class="line">    Ridge(),</span><br><span class="line">    RandomForestRegressor()</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">model_hybrid.fit(y,X_1,X_2)</span><br></pre></td></tr></table></figure></p>
<p>最后对submission的处理进行处理并丢进模型预测,输出存submission
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Preparing data for submission</span></span><br><span class="line"></span><br><span class="line">df_test = pd.read_csv(</span><br><span class="line">    <span class="string">&#x27;/kaggle/input/store-sales-time-series-forecasting/test.csv&#x27;</span>,</span><br><span class="line">    dtype=&#123;</span><br><span class="line">        <span class="string">&#x27;store_nbr&#x27;</span>: <span class="string">&#x27;category&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;family&#x27;</span>: <span class="string">&#x27;category&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;onpromotion&#x27;</span>: <span class="string">&#x27;uint32&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    parse_dates=[<span class="string">&#x27;date&#x27;</span>],</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">df_test[<span class="string">&#x27;date&#x27;</span>] = df_test.date.dt.to_period(<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line">df_test = df_test.set_index([<span class="string">&#x27;store_nbr&#x27;</span>, <span class="string">&#x27;family&#x27;</span>, <span class="string">&#x27;date&#x27;</span>]).sort_index()</span><br><span class="line">X_test_1 = dp.out_of_sample(steps=<span class="number">16</span>)</span><br><span class="line">X_test_1.index.name = <span class="string">&#x27;date&#x27;</span></span><br><span class="line">X_test_1[<span class="string">&#x27;NewYear&#x27;</span>] = (X_test_1.index.dayofyear == <span class="number">1</span>)</span><br><span class="line">sub = model_hybrid.predict(X_test_1).clip(<span class="number">0.0</span>)</span><br><span class="line">sub = sub.join(df_test.<span class="built_in">id</span>).reindex(columns=[<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;sales&#x27;</span>])</span><br><span class="line">sub.to_csv(<span class="string">&#x27;submission.csv&#x27;</span>, index=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a href="/categories/">Category</a></li>
        
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#preprocessing"><span class="toc-number">1.</span> <span class="toc-text">preprocessing</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#statsmodels%E7%9B%B8%E5%85%B3"><span class="toc-number">2.</span> <span class="toc-text">statsmodels相关</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#prepare-training-data-for-hybrid-model"><span class="toc-number">3.</span> <span class="toc-text">prepare training data
for hybrid model</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hybrid-model"><span class="toc-number">4.</span> <span class="toc-text">hybrid model</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2024/04/08/Kaggle-warmup3-TimeSeries-2/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2024/04/08/Kaggle-warmup3-TimeSeries-2/&text=Kaggle_warmup3-TimeSeries(2)"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2024/04/08/Kaggle-warmup3-TimeSeries-2/&title=Kaggle_warmup3-TimeSeries(2)"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2024/04/08/Kaggle-warmup3-TimeSeries-2/&is_video=false&description=Kaggle_warmup3-TimeSeries(2)"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Kaggle_warmup3-TimeSeries(2)&body=Check out this article: http://example.com/2024/04/08/Kaggle-warmup3-TimeSeries-2/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2024/04/08/Kaggle-warmup3-TimeSeries-2/&title=Kaggle_warmup3-TimeSeries(2)"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2024/04/08/Kaggle-warmup3-TimeSeries-2/&title=Kaggle_warmup3-TimeSeries(2)"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2024/04/08/Kaggle-warmup3-TimeSeries-2/&title=Kaggle_warmup3-TimeSeries(2)"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2024/04/08/Kaggle-warmup3-TimeSeries-2/&title=Kaggle_warmup3-TimeSeries(2)"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2024/04/08/Kaggle-warmup3-TimeSeries-2/&name=Kaggle_warmup3-TimeSeries(2)&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2024/04/08/Kaggle-warmup3-TimeSeries-2/&t=Kaggle_warmup3-TimeSeries(2)"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2025
    blacsheep
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
